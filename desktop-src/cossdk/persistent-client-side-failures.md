---
description: Errores de Client-Side persistentes
ms.assetid: f991db71-8319-414d-8a25-2d02bc7c8b51
title: Errores de Client-Side persistentes
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25d303e712257d62e4ae42497cb4463e782cfbb8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423375"
---
# <a name="persistent-client-side-failures"></a><span data-ttu-id="5c366-103">Errores de Client-Side persistentes</span><span class="sxs-lookup"><span data-stu-id="5c366-103">Persistent Client-Side Failures</span></span>

<span data-ttu-id="5c366-104">En algunos casos, [Message Queue Server](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) puede trasladar un mensaje a la cola de destino.</span><span class="sxs-lookup"><span data-stu-id="5c366-104">In some cases, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) can move a message to the destination queue.</span></span> <span data-ttu-id="5c366-105">Por ejemplo, si los controles de acceso a la cola no permiten que el mensaje se mueva del cliente al servidor, el mensaje infractor se mueve a la cola de mensajes no enviados del lado cliente.</span><span class="sxs-lookup"><span data-stu-id="5c366-105">For example, if the queue access controls do not permit the message to be moved from client to server, the offending message is moved to the client-side dead letter queue.</span></span> <span data-ttu-id="5c366-106">Cuando esto ocurre, el servicio de componentes en cola de COM+ permite asociar una clase de excepción a un componente.</span><span class="sxs-lookup"><span data-stu-id="5c366-106">When this occurs, the COM+ queued components service allows an exception class to be associated with a component.</span></span> <span data-ttu-id="5c366-107">Para asociar la clase de excepción al componente, utilice la pestaña **Opciones avanzadas** de la página Propiedades del componente de la herramienta de administración servicios de componentes.</span><span class="sxs-lookup"><span data-stu-id="5c366-107">To associate the exception class with the component, use the **Advanced** tab in the component properties page of the Component Services administration tool.</span></span> <span data-ttu-id="5c366-108">También puede asociar la clase de excepción mediante programación, mediante el atributo del componente de catálogo ExceptionClass de las funciones administrativas de COM+.</span><span class="sxs-lookup"><span data-stu-id="5c366-108">You can also associate the exception class programmatically, by using the ExceptionClass catalog component attribute of the COM+ Administrative functions.</span></span>

<span data-ttu-id="5c366-109">La clase de excepción se define como el ProgID o el CLSID de un componente que implementa [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span><span class="sxs-lookup"><span data-stu-id="5c366-109">The exception class is defined as either the ProgID or the CLSID of a component implementing [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span></span> <span data-ttu-id="5c366-110">El servicio de componentes en cola tiene un monitor de cola de mensajes con problemas de entrega que examina la cola de mensajes no enviados Xact.</span><span class="sxs-lookup"><span data-stu-id="5c366-110">The queued components service has a dead letter queue monitor that scans the Xact dead letter queue.</span></span> <span data-ttu-id="5c366-111">Si hay un mensaje en la cola, el monitor de cola de mensajes con problemas de entrega crea una instancia del controlador de excepciones asociado al componente de destino y llama a [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), lo que indica que se ha producido un error irrecuperable en el cliente.</span><span class="sxs-lookup"><span data-stu-id="5c366-111">If there is a message on the queue, the dead letter queue monitor instantiates the exception handler associated with the target component and calls [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), indicating that there has been a client-side, unrecoverable error.</span></span>

<span data-ttu-id="5c366-112">Además de [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), el controlador de excepciones debe implementar el mismo conjunto de interfaces que el componente de servidor para el que está controlando las excepciones.</span><span class="sxs-lookup"><span data-stu-id="5c366-112">In addition to [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), the exception handler should implement the same set of interfaces as the server component for which it is handling exceptions.</span></span> <span data-ttu-id="5c366-113">Cuando se llama a [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) , el tiempo de ejecución de los componentes en cola reproduce el mensaje con error al controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="5c366-113">When [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) is called, the queued components run-time plays back the failing message to the exception handler.</span></span> <span data-ttu-id="5c366-114">Esto permite al controlador de excepciones implementar un comportamiento alternativo para los mensajes que no se pueden pasar al servidor, por ejemplo, mediante la generación de una transacción de compensación.</span><span class="sxs-lookup"><span data-stu-id="5c366-114">This allows the exception handler to implement an alternative behavior for messages that cannot be moved to the server—for example, by generating a compensating transaction.</span></span>

<span data-ttu-id="5c366-115">Si el controlador de excepciones completa todas las llamadas al método reproducidas, el mensaje se quita de la cola de mensajes con problemas de entrega Xact y se descarta.</span><span class="sxs-lookup"><span data-stu-id="5c366-115">If the exception handler completes all the method calls played back, the message is removed from the Xact dead letter queue and is dismissed.</span></span> <span data-ttu-id="5c366-116">Sin embargo, si el controlador de excepciones anula el mensaje devolviendo un estado de error de una de las llamadas al método, el mensaje se devuelve a la cola de mensajes con problemas de entrega de transacciones.</span><span class="sxs-lookup"><span data-stu-id="5c366-116">If, however, the exception handler aborts the message by returning a failure status from one of the method calls, the message is returned to the Xact dead letter queue.</span></span> <span data-ttu-id="5c366-117">La siguiente secuencia de eventos muestra cómo se controlan las excepciones del cliente:</span><span class="sxs-lookup"><span data-stu-id="5c366-117">The following sequence of events shows how client-side exceptions are handled:</span></span>

1.  <span data-ttu-id="5c366-118">Message Queue Server no puede enviar un mensaje al servidor y lo coloca en la cola de mensajes con problemas de entrega de transacciones.</span><span class="sxs-lookup"><span data-stu-id="5c366-118">Message Queuing fails to deliver a message to the server and puts the message onto the Xact dead letter queue.</span></span>
2.  <span data-ttu-id="5c366-119">El agente de escucha de la cola de mensajes con problemas de entrega (DLQL) encuentra un mensaje en la cola de mensajes no enviados Xact.</span><span class="sxs-lookup"><span data-stu-id="5c366-119">The dead letter queue listener (DLQL) finds a message on the Xact dead letter queue.</span></span>
3.  <span data-ttu-id="5c366-120">DLQL recupera el CLSID del componente de destino del mensaje y comprueba si existe una clase de excepción.</span><span class="sxs-lookup"><span data-stu-id="5c366-120">The DLQL retrieves the target component CLSID from the message and checks for an exception class.</span></span>
4.  <span data-ttu-id="5c366-121">El DLQL crea una instancia de la clase de excepción.</span><span class="sxs-lookup"><span data-stu-id="5c366-121">The DLQL instantiates the exception class.</span></span>
5.  <span data-ttu-id="5c366-122">DLQL consulta para [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) para la clase de excepción.</span><span class="sxs-lookup"><span data-stu-id="5c366-122">The DLQL queries for [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) for the exception class.</span></span>
6.  <span data-ttu-id="5c366-123">DLQL llama al método [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) en la clase de excepción.</span><span class="sxs-lookup"><span data-stu-id="5c366-123">The DLQL calls the [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) method in the exception class.</span></span>
7.  <span data-ttu-id="5c366-124">DLQL reproduce todas las llamadas a propiedades y métodos desde el mensaje a la clase de excepción.</span><span class="sxs-lookup"><span data-stu-id="5c366-124">The DLQL plays back all property and method calls from the message to the exception class.</span></span>
8.  <span data-ttu-id="5c366-125">El DLQL elimina el mensaje si el controlador de excepciones completa la transacción correctamente.</span><span class="sxs-lookup"><span data-stu-id="5c366-125">The DLQL deletes the message if the exception handler completes the transaction successfully.</span></span> <span data-ttu-id="5c366-126">El controlador de excepciones puede emitir [**IObjectContext:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort)y el mensaje permanecerá en la cola de mensajes con problemas de entrega.</span><span class="sxs-lookup"><span data-stu-id="5c366-126">The exception handler may issue [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), and the message will remain on the dead letter queue.</span></span>

<span data-ttu-id="5c366-127">Si se produce un error en alguno de los pasos anteriores, el mensaje se deja en la cola de mensajes con problemas de entrega Xact.</span><span class="sxs-lookup"><span data-stu-id="5c366-127">If any of the preceding steps fail, the message is left on the Xact dead letter queue.</span></span>

<span data-ttu-id="5c366-128">Cuando se inicia, el DLQL Lee cada mensaje en la cola de mensajes con problemas de entrega transaccional de Message Queue Server y crea instancias de la clase de excepción para cada mensaje de componentes en cola.</span><span class="sxs-lookup"><span data-stu-id="5c366-128">When started, the DLQL reads each message on the Message Queuing transactional dead letter queue and instantiates the exception class for each queued components message.</span></span> <span data-ttu-id="5c366-129">Después de un paso a través de la cola, espera mensajes nuevos.</span><span class="sxs-lookup"><span data-stu-id="5c366-129">After one pass through the queue, it waits for new messages.</span></span> <span data-ttu-id="5c366-130">Después procesa cada nuevo mensaje de cola de mensajes con problemas de entrega cuando llega.</span><span class="sxs-lookup"><span data-stu-id="5c366-130">It then processes each new dead letter queue message as it arrives.</span></span>

<span data-ttu-id="5c366-131">Si necesita intervenir en el proceso que se describe aquí o si necesita mover un mensaje dudoso fuera de la cola de salida final, use la utilidad del Movedor de mensajes.</span><span class="sxs-lookup"><span data-stu-id="5c366-131">If you need to intervene in the process described here or if you need to move a poison message out of its final resting queue, use the message mover utility.</span></span> <span data-ttu-id="5c366-132">Para obtener más información sobre la utilidad del Movedor de mensajes, vea [control de errores](handling-errors-in-queued-components.md).</span><span class="sxs-lookup"><span data-stu-id="5c366-132">For more information on the message mover utility, see [Handling Errors](handling-errors-in-queued-components.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="5c366-133">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="5c366-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5c366-134">Errores del lado cliente</span><span class="sxs-lookup"><span data-stu-id="5c366-134">Client-Side Errors</span></span>](client-side-errors.md)
</dt> <dt>

[<span data-ttu-id="5c366-135">Errores del lado servidor</span><span class="sxs-lookup"><span data-stu-id="5c366-135">Server-Side Errors</span></span>](server-side-errors.md)
</dt> </dl>

 

 



