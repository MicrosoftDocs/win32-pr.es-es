---
description: Se llama a los controladores de vista previa cuando se selecciona un elemento para mostrar una vista previa ligera, enriquecida y de solo lectura del contenido del archivo en el panel de lectura de la vista. Esto se hace sin iniciar la aplicación asociada del archivo.
ms.assetid: 166a4001-d237-44a4-a457-e320e995639c
title: Controladores de vista previa y host de vista previa de Shell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 993c6c8e7b15d9bfc24b5dd42352407a3a53c45b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104985639"
---
# <a name="preview-handlers-and-shell-preview-host"></a><span data-ttu-id="d8052-104">Controladores de vista previa y host de vista previa de Shell</span><span class="sxs-lookup"><span data-stu-id="d8052-104">Preview Handlers and Shell Preview Host</span></span>

<span data-ttu-id="d8052-105">Se llama a los controladores de vista previa cuando se selecciona un elemento para mostrar una vista previa ligera, enriquecida y de *solo lectura* del contenido del archivo en el panel de lectura de la vista.</span><span class="sxs-lookup"><span data-stu-id="d8052-105">Preview handlers are called when an item is selected to show a lightweight, rich, *read-only* preview of the file's contents in the view's reading pane.</span></span> <span data-ttu-id="d8052-106">Esto se hace sin iniciar la aplicación asociada del archivo.</span><span class="sxs-lookup"><span data-stu-id="d8052-106">This is done without launching the file's associated application.</span></span>

<span data-ttu-id="d8052-107">En este tema se tratan los temas siguientes:</span><span class="sxs-lookup"><span data-stu-id="d8052-107">This topic discusses the following topics:</span></span>

-   [<span data-ttu-id="d8052-108">Arquitectura del controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-108">Preview Handler Architecture</span></span>](#preview-handler-architecture)
-   [<span data-ttu-id="d8052-109">Opciones del modelo de servidor</span><span class="sxs-lookup"><span data-stu-id="d8052-109">Server Model Options</span></span>](#server-model-options)
-   [<span data-ttu-id="d8052-110">Inicialización</span><span class="sxs-lookup"><span data-stu-id="d8052-110">Initialization</span></span>](#initialization)
-   [<span data-ttu-id="d8052-111">Flujo de datos del controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-111">Preview Handler Data Flow</span></span>](#preview-handler-data-flow)
-   [<span data-ttu-id="d8052-112">Depurar un controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-112">Debugging a Preview Handler</span></span>](#debugging-a-preview-handler)
-   [<span data-ttu-id="d8052-113">Proporcionar su propio proceso para un controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-113">Providing Your Own Process for a Preview Handler</span></span>](#providing-your-own-process-for-a-preview-handler)
-   [<span data-ttu-id="d8052-114">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d8052-114">Related topics</span></span>](#related-topics)

## <a name="preview-handler-architecture"></a><span data-ttu-id="d8052-115">Arquitectura del controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-115">Preview Handler Architecture</span></span>

<span data-ttu-id="d8052-116">Un controlador de vista previa es una aplicación hospedada.</span><span class="sxs-lookup"><span data-stu-id="d8052-116">A preview handler is a hosted application.</span></span> <span data-ttu-id="d8052-117">Los hosts incluyen el explorador de Windows en Windows Vista o Microsoft Outlook 2007.</span><span class="sxs-lookup"><span data-stu-id="d8052-117">Hosts include the Windows Explorer in Windows Vista or Microsoft Outlook 2007.</span></span> <span data-ttu-id="d8052-118">Los hosts implementan [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) como un método de comunicación entre el controlador de vista previa y el host.</span><span class="sxs-lookup"><span data-stu-id="d8052-118">Hosts implement [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) as a method of communication between the preview handler and the host.</span></span>

<span data-ttu-id="d8052-119">El controlador de vista previa implementa estas interfaces:</span><span class="sxs-lookup"><span data-stu-id="d8052-119">The preview handler itself implements these interfaces:</span></span>

-   [<span data-ttu-id="d8052-120">**IInitializeWithStream**</span><span class="sxs-lookup"><span data-stu-id="d8052-120">**IInitializeWithStream**</span></span>](/windows/desktop/api/Propsys/nn-propsys-iinitializewithstream)
-   [<span data-ttu-id="d8052-121">**IObjectWithSite**</span><span class="sxs-lookup"><span data-stu-id="d8052-121">**IObjectWithSite**</span></span>](/windows/win32/api/ocidl/nn-ocidl-iobjectwithsite)
-   [<span data-ttu-id="d8052-122">**IOleWindow**</span><span class="sxs-lookup"><span data-stu-id="d8052-122">**IOleWindow**</span></span>](/windows/win32/api/oleidl/nn-oleidl-iolewindow)
-   [<span data-ttu-id="d8052-123">**IPreviewHandler**</span><span class="sxs-lookup"><span data-stu-id="d8052-123">**IPreviewHandler**</span></span>](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandler)
-   <span data-ttu-id="d8052-124">[**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals) (opcional)</span><span class="sxs-lookup"><span data-stu-id="d8052-124">[**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals) (Optional)</span></span>

<span data-ttu-id="d8052-125">Se llama al controlador a través de su [**IObjectWithSite**](/windows/win32/api/ocidl/nn-ocidl-iobjectwithsite), que devuelve un puntero [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) a través del cual se solicita un objeto [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) para interactuar con el host.</span><span class="sxs-lookup"><span data-stu-id="d8052-125">Your handler is called through its [**IObjectWithSite**](/windows/win32/api/ocidl/nn-ocidl-iobjectwithsite), which returns an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer through which you request an [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) object to interact with the host.</span></span>

## <a name="server-model-options"></a><span data-ttu-id="d8052-126">Opciones del modelo de servidor</span><span class="sxs-lookup"><span data-stu-id="d8052-126">Server Model Options</span></span>

<span data-ttu-id="d8052-127">Los controladores de vista previa siempre se ejecutan fuera de proceso.</span><span class="sxs-lookup"><span data-stu-id="d8052-127">Preview handlers always run out of process.</span></span> <span data-ttu-id="d8052-128">Hay dos métodos para implementar esto:</span><span class="sxs-lookup"><span data-stu-id="d8052-128">There are two methods of implementing this:</span></span>

1.  <span data-ttu-id="d8052-129">Un controlador de vista previa se puede compilar como un servidor en proceso pero ejecutarse a través de un host suplente fuera de proceso.</span><span class="sxs-lookup"><span data-stu-id="d8052-129">A preview handler can be built as an in-process server but run through an out-of-process surrogate host.</span></span> <span data-ttu-id="d8052-130">Este es el método preferido.</span><span class="sxs-lookup"><span data-stu-id="d8052-130">This is the preferred method.</span></span> <span data-ttu-id="d8052-131">El sistema proporciona un host suplente para esto en el archivo de Prevhost.exe.</span><span class="sxs-lookup"><span data-stu-id="d8052-131">The system provides a surrogate host for this in the Prevhost.exe file.</span></span> <span data-ttu-id="d8052-132">Los controladores de vista previa creados por este método no son compatibles con Outlook 2007 en Windows XP.</span><span class="sxs-lookup"><span data-stu-id="d8052-132">Preview handlers built by this method are not compatible with Outlook 2007 on Windows XP.</span></span> <span data-ttu-id="d8052-133">Sin embargo, estos mismos controladores funcionarán en el explorador de Windows y Outlook 2007 en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="d8052-133">However, these same handlers will work in Windows Explorer and Outlook 2007 running on Windows Vista.</span></span>
2.  <span data-ttu-id="d8052-134">Un controlador de vista previa se puede compilar como un servidor de modelo de objetos componentes (COM) local.</span><span class="sxs-lookup"><span data-stu-id="d8052-134">A preview handler can be built as a local Component Object Model (COM) server.</span></span> <span data-ttu-id="d8052-135">Esto no se recomienda por varias razones.</span><span class="sxs-lookup"><span data-stu-id="d8052-135">This is not recommended for several reasons.</span></span> <span data-ttu-id="d8052-136">En primer lugar, la implementación de un servidor en proceso es más fácil.</span><span class="sxs-lookup"><span data-stu-id="d8052-136">First, implementation of an in-process server is easier.</span></span> <span data-ttu-id="d8052-137">Lo que es más importante, la implementación como un servidor en proceso proporciona un mayor control sobre la duración del objeto del controlador, lo que permite una mejor limpieza y eficacia.</span><span class="sxs-lookup"><span data-stu-id="d8052-137">More importantly, implementation as an in-process server provides greater control over the lifetime of the handler object, which allows for better cleanup and efficiency.</span></span>

<span data-ttu-id="d8052-138">De forma predeterminada, los controladores de vista previa se ejecutan en un proceso de nivel de integridad bajo (IL) por motivos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="d8052-138">By default, preview handlers run in a low integrity level (IL) process for security reasons.</span></span> <span data-ttu-id="d8052-139">Opcionalmente, puede deshabilitar la ejecución como un proceso IL bajo estableciendo el valor siguiente en el registro.</span><span class="sxs-lookup"><span data-stu-id="d8052-139">You can optionally disable running as a low IL process by setting the following value in the registry.</span></span> <span data-ttu-id="d8052-140">Sin embargo, no se recomienda hacerlo.</span><span class="sxs-lookup"><span data-stu-id="d8052-140">However, it is not recommended to do so.</span></span> <span data-ttu-id="d8052-141">Los sistemas podrían configurarse para rechazar cualquier proceso que no sea IL bajo.</span><span class="sxs-lookup"><span data-stu-id="d8052-141">Systems could eventually be configured to reject any process that is not low IL.</span></span>

```
HKEY_CLASSES_ROOT
   CLSID
      {YOUR HANDLER'S CLSID}
         DisableLowILProcessIsolation [DWORD] = 1
```

<span data-ttu-id="d8052-142">Los diferentes controladores de vista previa comparten el mismo proceso de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="d8052-142">Different preview handlers share the same process by default.</span></span> <span data-ttu-id="d8052-143">Dos instancias de Prevhost.exe pueden ejecutarse simultáneamente; uno para los controladores que se ejecutan como procesos de IL bajo, uno para los controladores que han decidido salir de ese comportamiento.</span><span class="sxs-lookup"><span data-stu-id="d8052-143">Two instances of Prevhost.exe can be running simultaneously; one for handlers running as low IL processes, one for handlers that have opted out of that behavior.</span></span>

## <a name="initialization"></a><span data-ttu-id="d8052-144">Inicialización</span><span class="sxs-lookup"><span data-stu-id="d8052-144">Initialization</span></span>

<span data-ttu-id="d8052-145">Al igual que con los controladores de miniaturas y de propiedades, se recomienda encarecidamente inicializar el controlador con una secuencia.</span><span class="sxs-lookup"><span data-stu-id="d8052-145">As with thumbnail and property handlers, it is strongly recommended that you initialize your handler with a stream.</span></span> <span data-ttu-id="d8052-146">Puede inicializar a través de un archivo o elemento si es necesario, pero las secuencias proporcionan el modo más seguro de implementar un controlador.</span><span class="sxs-lookup"><span data-stu-id="d8052-146">You can initialize through a file or item if necessary, but streams provide the most secure way to implement a handler.</span></span> <span data-ttu-id="d8052-147">La inicialización a través de una secuencia garantiza la integridad de los archivos y las ventajas de estabilidad para el sistema de ejecución del controlador como un proceso de IL bajo, como la protección del sistema de saturaciones del búfer, la limitación de la ubicación en la que un controlador puede escribir información y la limitación de la comunicación con otras ventanas.</span><span class="sxs-lookup"><span data-stu-id="d8052-147">Initialization through a stream ensures file integrity and the stability benefits to the system of running the handler as a low IL process, such as protecting the system from buffer overruns, limiting where a handler can write information, and limiting communication with other windows.</span></span>

<span data-ttu-id="d8052-148">Si debe inicializar con un archivo o un elemento de Shell, almacene la ruta de acceso del archivo o una referencia a [**IShellItem**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitem).</span><span class="sxs-lookup"><span data-stu-id="d8052-148">If you must initialize with a file or Shell item, store the file path or a reference to the [**IShellItem**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitem).</span></span> <span data-ttu-id="d8052-149">No lea datos de estos orígenes hasta que se llame a [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) .</span><span class="sxs-lookup"><span data-stu-id="d8052-149">Do not read data from these sources until [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) is called.</span></span>

<span data-ttu-id="d8052-150">En general, la inicialización no debe realizar ningún trabajo intenso, como crear y almacenar una imagen de vista previa.</span><span class="sxs-lookup"><span data-stu-id="d8052-150">In general, initialization should not do any heavy work such as composing and storing a preview image.</span></span> <span data-ttu-id="d8052-151">Para lograr una eficiencia óptima, ese tipo de procesamiento no debe realizarse hasta que se llame a la vista previa para.</span><span class="sxs-lookup"><span data-stu-id="d8052-151">For optimal efficiency, that sort of processing should not be done until the preview is called for.</span></span>

## <a name="preview-handler-data-flow"></a><span data-ttu-id="d8052-152">Flujo de datos del controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-152">Preview Handler Data Flow</span></span>

<span data-ttu-id="d8052-153">El flujo de datos en el proceso de vista previa sigue la ruta de acceso general que se muestra aquí.</span><span class="sxs-lookup"><span data-stu-id="d8052-153">The data flow in the preview process follows the general path shown here.</span></span> <span data-ttu-id="d8052-154">El host puede considerarse como el explorador de Windows en Windows Vista o Outlook 2007.</span><span class="sxs-lookup"><span data-stu-id="d8052-154">The host can be thought of as Windows Explorer in Windows Vista or Outlook 2007.</span></span>

1.  <span data-ttu-id="d8052-155">El controlador de vista previa se inicializa, preferiblemente con una secuencia.</span><span class="sxs-lookup"><span data-stu-id="d8052-155">The preview handler is initialized, preferably with a stream.</span></span>
2.  <span data-ttu-id="d8052-156">La ventana ver se pasa desde el host al controlador a través de [**IPreviewHandler:: SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span><span class="sxs-lookup"><span data-stu-id="d8052-156">The view window is passed from the host to the handler through [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span></span>
3.  <span data-ttu-id="d8052-157">En este momento, el controlador no debe hacer nada más hasta que se llama a [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) .</span><span class="sxs-lookup"><span data-stu-id="d8052-157">At this point, the handler should do nothing more until [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) is called.</span></span>
4.  <span data-ttu-id="d8052-158">La vista previa se muestra en el panel de lectura a través de una llamada a [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview).</span><span class="sxs-lookup"><span data-stu-id="d8052-158">The preview is displayed in the reading pane through a call to [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview).</span></span>
5.  <span data-ttu-id="d8052-159">El tamaño de la ventana se establece a través de [**IPreviewHandler:: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="d8052-159">The size of the window is set through [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span>
6.  <span data-ttu-id="d8052-160">Se cambia el tamaño de la ventana cuando es necesario a través de [**IPreviewHandler:: SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="d8052-160">The window is resized when needed through [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span>
7.  <span data-ttu-id="d8052-161">La versión preliminar se descarga y sus recursos se liberan cuando ya no se necesitan, a través de una llamada a [**IPreviewHandler:: Unload**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-unload).</span><span class="sxs-lookup"><span data-stu-id="d8052-161">The preview is unloaded and its resources released when it is no longer needed, through a call to [**IPreviewHandler::Unload**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-unload).</span></span>

## <a name="debugging-a-preview-handler"></a><span data-ttu-id="d8052-162">Depurar un controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-162">Debugging a Preview Handler</span></span>

<span data-ttu-id="d8052-163">Si ha seguido las recomendaciones para implementar el controlador de vista previa como un servidor en proceso, para depurar el controlador de vista previa, puede adjuntar a Prevhost.exe.</span><span class="sxs-lookup"><span data-stu-id="d8052-163">If you have followed the recommendations to implement your preview handler as an in-process server, to debug your preview handler, you can attach to Prevhost.exe.</span></span> <span data-ttu-id="d8052-164">Como se mencionó anteriormente, tenga en cuenta que podría haber dos instancias de Prevhost.exe, una para los procesos normales de IL bajo y otra para los controladores que han optado por no ejecutarse como un proceso IL bajo.</span><span class="sxs-lookup"><span data-stu-id="d8052-164">As mentioned earlier, be aware that there could be two instances of Prevhost.exe, one for normal low IL processes and one for those handlers that have opted out of running as a low IL process.</span></span>

<span data-ttu-id="d8052-165">Si no encuentra Prevhost.exe en la lista de procesos disponibles, es probable que no se haya cargado en ese momento.</span><span class="sxs-lookup"><span data-stu-id="d8052-165">If you do not find Prevhost.exe in your list of available processes, it probably has not been loaded at that point.</span></span> <span data-ttu-id="d8052-166">Al hacer clic en un archivo para obtener una vista previa, se carga el suplente y debe aparecer como un proceso que se podrá adjuntar.</span><span class="sxs-lookup"><span data-stu-id="d8052-166">Clicking on a file for a preview loads the surrogate and it should then appear as an attachable process.</span></span>

## <a name="providing-your-own-process-for-a-preview-handler"></a><span data-ttu-id="d8052-167">Proporcionar su propio proceso para un controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-167">Providing Your Own Process for a Preview Handler</span></span>

<span data-ttu-id="d8052-168">Si desea forzar la creación de un nuevo proceso para el controlador en lugar de ejecutarlo en el proceso predeterminado, cree una nueva subclave para el controlador en **AppID** y establezca su entrada DllSurrogate en "Prevhost.exe".</span><span class="sxs-lookup"><span data-stu-id="d8052-168">If you want to force the creation of a new process for your handler rather than running under the default process, create a new subkey for your handler under **AppID** and set its DllSurrogate entry to "Prevhost.exe".</span></span> <span data-ttu-id="d8052-169">Use esa subclave **AppID** en lugar del valor predeterminado Prevhost.exe **AppID**.</span><span class="sxs-lookup"><span data-stu-id="d8052-169">Use that **AppID** subkey instead of the default Prevhost.exe **AppID**.</span></span>

<span data-ttu-id="d8052-170">Al proporcionar un nuevo proceso, el controlador puede evitar que se ejecute en un proceso compartido, tal y como lo haría de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="d8052-170">By providing a new process, the handler can avoid running under a shared process as it would do by default.</span></span> <span data-ttu-id="d8052-171">Esto podría permitirle, por ejemplo, garantizar la versión específica del Common Language Runtime (CLR) en el proceso.</span><span class="sxs-lookup"><span data-stu-id="d8052-171">This could allow you, for example, to ensure the specific version of the common language runtime (CLR) in the process.</span></span> <span data-ttu-id="d8052-172">Esto es necesario si va a crear una implementación administrada de un controlador de vista previa.</span><span class="sxs-lookup"><span data-stu-id="d8052-172">This is required if you are building a managed implementation of a preview handler.</span></span>

> [!Note]  
> <span data-ttu-id="d8052-173">los controladores de vista previa de bits de 32 deben usar **AppID** {534A1E02-D58F-44f0-B58B-36CBED287C7C} cuando se instalan en sistemas operativos de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="d8052-173">32-bit preview handlers should use **AppID** {534A1E02-D58F-44f0-B58B-36CBED287C7C} when installed on 64-bit operating systems.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="d8052-174">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d8052-174">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d8052-175">Crear controladores de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-175">Building Preview Handlers</span></span>](building-preview-handlers.md)
</dt> <dt>

[<span data-ttu-id="d8052-176">Cómo registrar un controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-176">How to Register a Preview Handler</span></span>](how-to-register-a-preview-handler.md)
</dt> <dt>

[<span data-ttu-id="d8052-177">Instrucciones de controlador de vista previa</span><span class="sxs-lookup"><span data-stu-id="d8052-177">Preview Handler Guidelines</span></span>](preview-handler-guidelines.md)
</dt> </dl>

 

 
