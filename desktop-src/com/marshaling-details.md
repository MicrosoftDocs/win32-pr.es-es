---
title: Detalles de serialización
description: Si utiliza el cálculo de referencias estándar, COM controla todos los detalles que se describen aquí.
ms.assetid: bf3fe212-648e-4d00-ad1d-43d2e5e6a7ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4d0fd46ee29c712c6f2b5b286df76a30f1047e6
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/03/2021
ms.locfileid: "105717317"
---
# <a name="marshaling-details"></a><span data-ttu-id="66c43-103">Detalles de serialización</span><span class="sxs-lookup"><span data-stu-id="66c43-103">Marshaling Details</span></span>

<span data-ttu-id="66c43-104">Si utiliza el cálculo de referencias estándar, COM controla todos los detalles que se describen aquí.</span><span class="sxs-lookup"><span data-stu-id="66c43-104">If you use standard marshaling, COM handles all of the details described here for you.</span></span> <span data-ttu-id="66c43-105">Sin embargo, hay pocos programadores que necesitan estos detalles y para los interesados en la información subyacente.</span><span class="sxs-lookup"><span data-stu-id="66c43-105">However, there are those few programmers who need these details and for those interested in the underlying information.</span></span> <span data-ttu-id="66c43-106">El cálculo de referencias es el proceso de empaquetar y desempaquetar parámetros para que pueda tener lugar una llamada a procedimiento remoto.</span><span class="sxs-lookup"><span data-stu-id="66c43-106">Marshaling is the process of packaging and unpackaging parameters so a remote procedure call can take place.</span></span>

<span data-ttu-id="66c43-107">Los diferentes tipos de parámetros se serializan de maneras diferentes.</span><span class="sxs-lookup"><span data-stu-id="66c43-107">Different parameter types are marshaled in different ways.</span></span> <span data-ttu-id="66c43-108">Por ejemplo, la serialización de un parámetro de entero implica simplemente copiar el valor en el búfer de mensajes.</span><span class="sxs-lookup"><span data-stu-id="66c43-108">For example, marshaling an integer parameter involves simply copying the value into the message buffer.</span></span> <span data-ttu-id="66c43-109">(Aunque incluso en este caso simple, hay problemas como el orden de los bytes que se deben tratar en las llamadas entre equipos). Sin embargo, la serialización de una matriz es un proceso más complejo.</span><span class="sxs-lookup"><span data-stu-id="66c43-109">(Although even in this simple case, there are issues such as byte ordering to deal with in cross-computer calls.) Marshaling an array, however, is a more complex process.</span></span> <span data-ttu-id="66c43-110">Los miembros de la matriz se copian en un orden específico para que el otro lado pueda reconstruir la matriz exactamente.</span><span class="sxs-lookup"><span data-stu-id="66c43-110">Array members are copied in a specific order so that the other side can reconstruct the array exactly.</span></span> <span data-ttu-id="66c43-111">Cuando se calculan las referencias de un puntero, se copian los datos a los que apunta el puntero siguiendo reglas y convenciones para tratar con punteros anidados en estructuras.</span><span class="sxs-lookup"><span data-stu-id="66c43-111">When a pointer is marshaled, the data that the pointer is pointing to is copied following rules and conventions for dealing with nested pointers in structures.</span></span> <span data-ttu-id="66c43-112">Existen funciones únicas para controlar el cálculo de referencias de cada tipo de parámetro.</span><span class="sxs-lookup"><span data-stu-id="66c43-112">Unique functions exist to handle the marshaling of each parameter type.</span></span>

<span data-ttu-id="66c43-113">Con el cálculo de referencias estándar, los proxies y códigos auxiliares son recursos de todo el sistema para la interfaz e interactúan con el canal a través de un protocolo estándar.</span><span class="sxs-lookup"><span data-stu-id="66c43-113">With standard marshaling, the proxies and stubs are systemwide resources for the interface and they interact with the channel through a standard protocol.</span></span> <span data-ttu-id="66c43-114">La serialización estándar se puede usar tanto en interfaces definidas por COM estándar como en interfaces personalizadas, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="66c43-114">Standard marshaling can be used both by standard COM-defined interfaces and by custom interfaces, as follows:</span></span>

-   <span data-ttu-id="66c43-115">En el caso de la mayoría de las interfaces COM, los proxies y códigos auxiliares para el cálculo de referencias estándar son objetos de componentes en proceso que se cargan desde un archivo DLL para todo el sistema proporcionado por COM en Ole32.dll.</span><span class="sxs-lookup"><span data-stu-id="66c43-115">In the case of most COM interfaces, the proxies and stubs for standard marshaling are in-process component objects which are loaded from a systemwide DLL provided by COM in Ole32.dll.</span></span>
-   <span data-ttu-id="66c43-116">En el caso de las interfaces personalizadas, el diseñador de la interfaz genera los proxies y códigos auxiliares para la serialización estándar, normalmente con MIDL.</span><span class="sxs-lookup"><span data-stu-id="66c43-116">In the case of custom interfaces, the proxies and stubs for standard marshaling are generated by the interface designer, typically with MIDL.</span></span> <span data-ttu-id="66c43-117">Estos proxies y códigos auxiliares se configuran estáticamente en el registro, por lo que cualquier posible cliente puede usar la interfaz personalizada a través de los límites del proceso.</span><span class="sxs-lookup"><span data-stu-id="66c43-117">These proxies and stubs are statically configured in the registry, so any potential client can use the custom interface across process boundaries.</span></span> <span data-ttu-id="66c43-118">Estos proxies y códigos auxiliares se cargan desde un archivo DLL que se encuentra a través del registro del sistema, mediante el identificador de interfaz (IID) de la interfaz personalizada a la que se van a calcular las referencias.</span><span class="sxs-lookup"><span data-stu-id="66c43-118">These proxies and stubs are loaded from a DLL that is located via the system registry, using the interface ID (IID) for the custom interface they marshal.</span></span>
-   <span data-ttu-id="66c43-119">Una alternativa al uso de MIDL para generar servidores proxy y códigos auxiliares para las interfaces personalizadas, se puede generar una biblioteca de tipos en su lugar y el sistema proporcionado, el motor de serialización controlado de tipo-libraryâ, calculará las referencias de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="66c43-119">An alternative to using MIDL to generate proxies and stubs for custom interfaces, a type library can be generated instead and the system provided, type-libraryâ€“driven marshaling engine will marshal the interface.</span></span>

<span data-ttu-id="66c43-120">Como alternativa a la serialización estándar, una interfaz (estándar o personalizada) puede utilizar el cálculo de referencias personalizado.</span><span class="sxs-lookup"><span data-stu-id="66c43-120">As an alternative to standard marshaling, an interface (standard or custom) can use custom marshaling.</span></span> <span data-ttu-id="66c43-121">Con el cálculo de referencias personalizado, un objeto implementa dinámicamente los proxies en tiempo de ejecución para cada interfaz que admite.</span><span class="sxs-lookup"><span data-stu-id="66c43-121">With custom marshaling, an object dynamically implements the proxies at run time for each interface that it supports.</span></span> <span data-ttu-id="66c43-122">Para cualquier interfaz determinada, el objeto puede seleccionar el cálculo de referencias estándar proporcionado por COM o el cálculo de referencias personalizado.</span><span class="sxs-lookup"><span data-stu-id="66c43-122">For any given interface, the object can select COM-provided standard marshaling or custom marshaling.</span></span> <span data-ttu-id="66c43-123">Esta opción la realiza el objeto en función de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="66c43-123">This choice is made by the object on an interface-by-interface basis.</span></span> <span data-ttu-id="66c43-124">Una vez que se elige la opción para una interfaz determinada, permanece en vigor durante la duración del objeto.</span><span class="sxs-lookup"><span data-stu-id="66c43-124">Once the choice is made for a given interface, it remains in effect during the object's lifetime.</span></span> <span data-ttu-id="66c43-125">Sin embargo, una interfaz en un objeto puede utilizar el cálculo de referencias personalizado mientras que otro utiliza la serialización estándar.</span><span class="sxs-lookup"><span data-stu-id="66c43-125">However, one interface on an object can use custom marshaling while another uses standard marshaling.</span></span>

<span data-ttu-id="66c43-126">La serialización personalizada es intrínsecamente única para el objeto que la implementa.</span><span class="sxs-lookup"><span data-stu-id="66c43-126">Custom marshaling is inherently unique to the object that implements it.</span></span> <span data-ttu-id="66c43-127">Utiliza servidores proxy implementados por el objeto y proporcionados al sistema a petición en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="66c43-127">It uses proxies implemented by the object and provided to the system on request at run time.</span></span> <span data-ttu-id="66c43-128">Los objetos que implementan el cálculo de referencias personalizado deben implementar la interfaz [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , mientras que los objetos que admiten el cálculo de referencias estándar no lo hacen.</span><span class="sxs-lookup"><span data-stu-id="66c43-128">Objects that implement custom marshaling must implement the [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) interface, whereas objects that support standard marshaling do not.</span></span>

<span data-ttu-id="66c43-129">Si decide escribir una interfaz personalizada, debe proporcionar compatibilidad con la serialización.</span><span class="sxs-lookup"><span data-stu-id="66c43-129">If you decide to write a custom interface, you must provide marshaling support for it.</span></span> <span data-ttu-id="66c43-130">Normalmente, proporcionará un archivo DLL de serialización estándar para la interfaz que diseña.</span><span class="sxs-lookup"><span data-stu-id="66c43-130">Typically, you will provide a standard marshaling DLL for the interface you design.</span></span> <span data-ttu-id="66c43-131">Puede crear el código de proxy o stub y el archivo DLL de proxy/código auxiliar, o puede crear una biblioteca de tipos que COM usará para realizar la serialización controlada por datos (con los datos de la biblioteca de tipos).</span><span class="sxs-lookup"><span data-stu-id="66c43-131">You can create the proxy/stub code and the proxy/stub DLL, or you can create a type library that COM will use to do data-driven marshaling (using the data in the type library).</span></span>

<span data-ttu-id="66c43-132">Para que un cliente realice una llamada a un método de interfaz en un objeto de otro proceso, implica la cooperación de varios componentes.</span><span class="sxs-lookup"><span data-stu-id="66c43-132">For a client to make a call to an interface method in an object in another process involves the cooperation of several components.</span></span> <span data-ttu-id="66c43-133">El proxy estándar es un fragmento de código específico de la interfaz que reside en el espacio de proceso del cliente y prepara los parámetros de la interfaz para transmitir.</span><span class="sxs-lookup"><span data-stu-id="66c43-133">The standard proxy is a piece of interface-specific code that resides in the client's process space and prepares the interface parameters for transmittal.</span></span> <span data-ttu-id="66c43-134">Empaqueta, o calcula las referencias, de tal forma que se pueden volver a crear y comprender en el proceso de recepción.</span><span class="sxs-lookup"><span data-stu-id="66c43-134">It packages, or marshals, them in such a way that they can be re-created and understood in the receiving process.</span></span> <span data-ttu-id="66c43-135">El código auxiliar estándar, también un fragmento de código específico de la interfaz, reside en el espacio de proceso del servidor e invierte el trabajo del proxy.</span><span class="sxs-lookup"><span data-stu-id="66c43-135">The standard stub, also a piece of interface-specific code, resides in the server's process space and reverses the work of the proxy.</span></span> <span data-ttu-id="66c43-136">El código auxiliar desempaqueta o no calcula las referencias de los parámetros enviados y los reenvía a la aplicación de objeto.</span><span class="sxs-lookup"><span data-stu-id="66c43-136">The stub unpackages, or unmarshals, the sent parameters and forwards them to the object application.</span></span> <span data-ttu-id="66c43-137">También empaqueta la información de respuesta que se devuelve al cliente.</span><span class="sxs-lookup"><span data-stu-id="66c43-137">It also packages reply information to send back to the client.</span></span>

> [!Note]  
> <span data-ttu-id="66c43-138">Los lectores más familiarizados con RPC que COM pueden utilizarse para ver los términos stub de cliente y código auxiliar de servidor.</span><span class="sxs-lookup"><span data-stu-id="66c43-138">Readers more familiar with RPC than COM may be used to seeing the terms client stub and server stub.</span></span> <span data-ttu-id="66c43-139">Estos términos son análogos a proxy y código auxiliar.</span><span class="sxs-lookup"><span data-stu-id="66c43-139">These terms are analogous to proxy and stub.</span></span>

 

## <a name="components-of-interprocess-communications"></a><span data-ttu-id="66c43-140">Componentes de comunicaciones entre procesos</span><span class="sxs-lookup"><span data-stu-id="66c43-140">Components of Interprocess Communications</span></span>

<span data-ttu-id="66c43-141">En el diagrama siguiente se muestra el flujo de comunicación entre los componentes implicados.</span><span class="sxs-lookup"><span data-stu-id="66c43-141">The following diagram shows the flow of communication between the components involved.</span></span> <span data-ttu-id="66c43-142">En el lado del cliente del límite del proceso, la llamada al método del cliente atraviesa el proxy y, a continuación, en el canal, que forma parte de la biblioteca COM.</span><span class="sxs-lookup"><span data-stu-id="66c43-142">On the client side of the process boundary, the client's method call goes through the proxy and then onto the channel, which is part of the COM library.</span></span> <span data-ttu-id="66c43-143">El canal envía el búfer que contiene los parámetros de cálculo de referencias a la biblioteca en tiempo de ejecución de RPC, que lo transmite por el límite del proceso.</span><span class="sxs-lookup"><span data-stu-id="66c43-143">The channel sends the buffer containing the marshaled parameters to the RPC run-time library, which transmits it across the process boundary.</span></span> <span data-ttu-id="66c43-144">El tiempo de ejecución de RPC y las bibliotecas COM existen en ambos lados del proceso.</span><span class="sxs-lookup"><span data-stu-id="66c43-144">The RPC run time and the COM libraries exist on both sides of the process.</span></span> <span data-ttu-id="66c43-145">La distinción entre el canal y el tiempo de ejecución de RPC es una característica de esta implementación y no forma parte del modelo de programación ni del modelo conceptual para objetos de cliente/servidor COM.</span><span class="sxs-lookup"><span data-stu-id="66c43-145">The distinction between the channel and the RPC run time is a characteristic of this implementation and is not part of the programming model or the conceptual model for COM client/server objects.</span></span> <span data-ttu-id="66c43-146">Los servidores COM solo ven el proxy o el código auxiliar y, indirectamente, el canal.</span><span class="sxs-lookup"><span data-stu-id="66c43-146">COM servers see only the proxy or stub and, indirectly, the channel.</span></span> <span data-ttu-id="66c43-147">Las implementaciones futuras pueden utilizar diferentes capas por debajo del canal o ninguna capa.</span><span class="sxs-lookup"><span data-stu-id="66c43-147">Future implementations may use different layers below the channel or no layers.</span></span>

![Diagrama que muestra los flujos de Client.exe y Server.exe en cada lado del límite del proceso.](images/457036c1-98b8-4f35-aebe-70de38112b83.png)

## <a name="related-topics"></a><span data-ttu-id="66c43-149">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="66c43-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="66c43-150">Canal</span><span class="sxs-lookup"><span data-stu-id="66c43-150">Channel</span></span>](channel.md)
</dt> <dt>

[<span data-ttu-id="66c43-151">Comunicación entre objetos</span><span class="sxs-lookup"><span data-stu-id="66c43-151">Inter-Object Communication</span></span>](inter-object-communication.md)
</dt> <dt>

[<span data-ttu-id="66c43-152">Microsoft RPC</span><span class="sxs-lookup"><span data-stu-id="66c43-152">Microsoft RPC</span></span>](microsoft-rpc.md)
</dt> <dt>

[<span data-ttu-id="66c43-153">Proxy</span><span class="sxs-lookup"><span data-stu-id="66c43-153">Proxy</span></span>](proxy.md)
</dt> <dt>

[<span data-ttu-id="66c43-154">Stub</span><span class="sxs-lookup"><span data-stu-id="66c43-154">Stub</span></span>](stub.md)
</dt> </dl>

 

 