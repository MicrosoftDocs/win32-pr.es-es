---
description: La función WSADuplicateSocket se introduce para permitir el uso compartido de sockets entre los procesos.
ms.assetid: f7cf40e9-f3a6-4b62-8a78-df25464e2365
title: Sockets compartidos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb6753b01f6389254756254d2ebe196af8e2a8a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104001547"
---
# <a name="shared-sockets"></a><span data-ttu-id="e06cc-103">Sockets compartidos</span><span class="sxs-lookup"><span data-stu-id="e06cc-103">Shared Sockets</span></span>

<span data-ttu-id="e06cc-104">La función [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) se introduce para permitir el uso compartido de sockets entre los procesos.</span><span class="sxs-lookup"><span data-stu-id="e06cc-104">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function is introduced to enable socket sharing across processes.</span></span> <span data-ttu-id="e06cc-105">Un proceso de origen llama a **WSADuplicateSocket** para obtener una estructura especial de [**\_ información de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) para un identificador de proceso de destino.</span><span class="sxs-lookup"><span data-stu-id="e06cc-105">A source process calls **WSADuplicateSocket** to obtain a special [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a target process identifier.</span></span> <span data-ttu-id="e06cc-106">Utiliza algún mecanismo de comunicaciones entre procesos (IPC) para pasar el contenido de esta estructura a un proceso de destino.</span><span class="sxs-lookup"><span data-stu-id="e06cc-106">It uses some interprocess communications (IPC) mechanism to pass the contents of this structure to a target process.</span></span> <span data-ttu-id="e06cc-107">A continuación, el proceso de destino utiliza la estructura de **\_ información de WSAPROTOCOL** en una llamada a [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span><span class="sxs-lookup"><span data-stu-id="e06cc-107">The target process then uses the **WSAPROTOCOL\_INFO** structure in a call to [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span></span> <span data-ttu-id="e06cc-108">El descriptor de socket devuelto por esta función será un descriptor de socket adicional a un socket subyacente que, por tanto, se va a compartir.</span><span class="sxs-lookup"><span data-stu-id="e06cc-108">The socket descriptor returned by this function will be an additional socket descriptor to an underlying socket which thus becomes shared.</span></span> <span data-ttu-id="e06cc-109">Los sockets se pueden compartir entre subprocesos en un proceso determinado sin usar la función **WSADuplicateSocket** porque un descriptor de socket es válido en todos los subprocesos de un proceso.</span><span class="sxs-lookup"><span data-stu-id="e06cc-109">Sockets can be shared among threads in a given process without using the **WSADuplicateSocket** function because a socket descriptor is valid in all threads of a process.</span></span>

<span data-ttu-id="e06cc-110">Los dos (o más) descriptores que hacen referencia a un socket compartido se pueden usar de forma independiente en lo que respecta a la e/s.</span><span class="sxs-lookup"><span data-stu-id="e06cc-110">The two (or more) descriptors that reference a shared socket can be used independently as far as I/O is concerned.</span></span> <span data-ttu-id="e06cc-111">Sin embargo, la interfaz Winsock no implementa ningún tipo de control de acceso, por lo que los procesos deben coordinar las operaciones en un socket compartido.</span><span class="sxs-lookup"><span data-stu-id="e06cc-111">However, the Winsock interface does not implement any type of access control, so the processes must coordinate any operations on a shared socket.</span></span> <span data-ttu-id="e06cc-112">Un ejemplo típico de uso compartido de sockets es usar un proceso para crear sockets y establecer conexiones.</span><span class="sxs-lookup"><span data-stu-id="e06cc-112">A typical example of sharing sockets is to use one process for creating sockets and establishing connections.</span></span> <span data-ttu-id="e06cc-113">Este proceso, a continuación, entrega los sockets a otros procesos responsables del intercambio de información.</span><span class="sxs-lookup"><span data-stu-id="e06cc-113">This process then hands off sockets to other processes that are responsible for information exchange.</span></span>

<span data-ttu-id="e06cc-114">La función [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) crea descriptores de socket y no el socket subyacente.</span><span class="sxs-lookup"><span data-stu-id="e06cc-114">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function creates socket descriptors and not the underlying socket.</span></span> <span data-ttu-id="e06cc-115">Como resultado, todos los Estados asociados a un socket se mantienen en común en todos los descriptores.</span><span class="sxs-lookup"><span data-stu-id="e06cc-115">As a result, all the states associated with a socket are held in common across all the descriptors.</span></span> <span data-ttu-id="e06cc-116">Por ejemplo, una [**operación de**](/windows/desktop/api/winsock/nf-winsock-setsockopt) r realizada con un descriptor es visible posteriormente mediante un [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) de uno o todos los descriptores.</span><span class="sxs-lookup"><span data-stu-id="e06cc-116">For example, a [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) operation performed using one descriptor is subsequently visible using a [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) from any or all descriptors.</span></span> <span data-ttu-id="e06cc-117">Un proceso puede llamar a [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) en un socket duplicado y el descriptor se desasignará.</span><span class="sxs-lookup"><span data-stu-id="e06cc-117">A process can call [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) on a duplicated socket and the descriptor will become deallocated.</span></span> <span data-ttu-id="e06cc-118">Sin embargo, el socket subyacente permanece abierto hasta que se llama a **closesocket** con el último descriptor restante.</span><span class="sxs-lookup"><span data-stu-id="e06cc-118">The underlying socket, however, remains open until **closesocket** is called with the last remaining descriptor.</span></span>

<span data-ttu-id="e06cc-119">La notificación en sockets compartidos está sujeta a las restricciones habituales de las funciones [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) y [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) .</span><span class="sxs-lookup"><span data-stu-id="e06cc-119">Notification on shared sockets is subject to the usual constraints of the [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) and [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) functions.</span></span> <span data-ttu-id="e06cc-120">La emisión de cualquiera de estas llamadas mediante cualquiera de los descriptores compartidos cancela cualquier registro de eventos anterior para el socket, independientemente del descriptor que se haya utilizado para realizar ese registro.</span><span class="sxs-lookup"><span data-stu-id="e06cc-120">Issuing either of these calls using any of the shared descriptors cancels any previous event registration for the socket, regardless of which descriptor was used to make that registration.</span></span> <span data-ttu-id="e06cc-121">Por lo tanto, por ejemplo, no sería posible tener el procesamiento de eventos de lectura FD de recepción \_ y eventos de escritura FD de recepción de proceso B \_ .</span><span class="sxs-lookup"><span data-stu-id="e06cc-121">Thus, for example, it would not be possible to have process A receive FD\_READ events and process B receive FD\_WRITE events.</span></span> <span data-ttu-id="e06cc-122">En situaciones en las que se requiere una coordinación tan estrecha, se recomienda que los desarrolladores utilicen subprocesos en lugar de procesos independientes.</span><span class="sxs-lookup"><span data-stu-id="e06cc-122">For situations when such tight coordination is required, it is suggested that developers use threads instead of separate processes.</span></span>

 

 
