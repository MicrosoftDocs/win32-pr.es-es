---
description: Suministro de un Allocator-Presenter personalizado para VMR-9
ms.assetid: 61bb6b0d-25b5-481b-a241-74c6e421f109
title: Suministro de un Allocator-Presenter personalizado para VMR-9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f004e119fc1cbfc167c2130852a4f59700706fcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105678431"
---
# <a name="supplying-a-custom-allocator-presenter-for-vmr-9"></a><span data-ttu-id="55561-103">Suministro de un Allocator-Presenter personalizado para VMR-9</span><span class="sxs-lookup"><span data-stu-id="55561-103">Supplying a Custom Allocator-Presenter for VMR-9</span></span>

<span data-ttu-id="55561-104">Para usar un asignador personalizado con el filtro de mezclador de vídeo 9 (VMR-9), realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="55561-104">To use a custom allocator-presenter with the Video Mixing Renderer 9 (VMR-9) filter, perform the following steps:</span></span>

1.  <span data-ttu-id="55561-105">Implemente una clase que admita las interfaces [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) y [**IVMRImagePresenter9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrimagepresenter9) .</span><span class="sxs-lookup"><span data-stu-id="55561-105">Implement a class that supports the [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) and [**IVMRImagePresenter9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrimagepresenter9) interfaces.</span></span>
2.  <span data-ttu-id="55561-106">Llame a **QueryInterface** en el filtro VMR-9 para la interfaz [**IVMRFilterConfig9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrfilterconfig9) .</span><span class="sxs-lookup"><span data-stu-id="55561-106">Call **QueryInterface** on the VMR-9 filter for the [**IVMRFilterConfig9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrfilterconfig9) interface.</span></span>
3.  <span data-ttu-id="55561-107">Llame al método [**IVMRFilterConfig9:: SetRenderingMode**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrfilterconfig9-setrenderingmode) y pase la marca **sin \_ representación VMR9Mode** .</span><span class="sxs-lookup"><span data-stu-id="55561-107">Call the [**IVMRFilterConfig9::SetRenderingMode**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrfilterconfig9-setrenderingmode) method and pass in the **VMR9Mode\_Renderless** flag.</span></span>
4.  <span data-ttu-id="55561-108">**QueryInterface** en el filtro VMR-9 para la interfaz [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) .</span><span class="sxs-lookup"><span data-stu-id="55561-108">**QueryInterface** on the VMR-9 filter for the [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) interface.</span></span>
5.  <span data-ttu-id="55561-109">Llame al método [**IVMRSurfaceAllocatorNotify9:: AdviseSurfaceAllocator**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-advisesurfaceallocator) y pase un puntero al método [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) de la persona que presenta el asignador.</span><span class="sxs-lookup"><span data-stu-id="55561-109">Call the [**IVMRSurfaceAllocatorNotify9::AdviseSurfaceAllocator**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-advisesurfaceallocator) method and pass in a pointer to your allocator-presenter's [**IVMRSurfaceAllocator9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocator9) method.</span></span>
6.  <span data-ttu-id="55561-110">Llame al método [**IVMRSurfaceAllocator9:: AdviseNotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify) de allocator-Presenter y pase un puntero a la interfaz [**IVMRSURFACEALLOCATORNOTIFY9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) del filtro VMR-9.</span><span class="sxs-lookup"><span data-stu-id="55561-110">Call your allocator-presenter's [**IVMRSurfaceAllocator9::AdviseNotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify) method and pass in a pointer to the VMR-9 filter's [**IVMRSurfaceAllocatorNotify9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatornotify9) interface.</span></span>
7.  <span data-ttu-id="55561-111">En la implementación de [**IVMRSurfaceAllocator9:: AdviseNotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify), llame a [**IVMRSurfaceAllocatorNotify9:: SetD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-setd3ddevice) pase un puntero al dispositivo Direct3D y un identificador al monitor en el que aparecerá el vídeo.</span><span class="sxs-lookup"><span data-stu-id="55561-111">In your implementation of [**IVMRSurfaceAllocator9::AdviseNotify**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-advisenotify), call [**IVMRSurfaceAllocatorNotify9::SetD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-setd3ddevice) Pass in a pointer to the Direct3D device and a handle to the monitor where the video will appear.</span></span>
8.  <span data-ttu-id="55561-112">En la implementación del método [**IVMRSurfaceAllocator9:: InitializeDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-initializedevice) , cree superficies de Direct3D que coincidan con los parámetros proporcionados en el método **InitializeDevice** .</span><span class="sxs-lookup"><span data-stu-id="55561-112">In your implementation of the [**IVMRSurfaceAllocator9::InitializeDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-initializedevice) method, Create Direct3D surfaces that match the parameters given in the **InitializeDevice** method.</span></span> <span data-ttu-id="55561-113">Opcionalmente, puede usar el método [**IVMRSurfaceAllocatorNotify9:: AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) del filtro VMR-9 para asignar estas superficies.</span><span class="sxs-lookup"><span data-stu-id="55561-113">Optionally, you can use the VMR-9 filter's [**IVMRSurfaceAllocatorNotify9::AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) method to allocate these surfaces.</span></span> <span data-ttu-id="55561-114">Almacenar los punteros de superficie en una matriz.</span><span class="sxs-lookup"><span data-stu-id="55561-114">Store the surface pointers in an array.</span></span>
    > [!Note]  
    > <span data-ttu-id="55561-115">Si desea que VMR-9 dibuje los fotogramas de vídeo en una superficie de textura, agregue la marca **VMR9AllocFlag \_ TextureSurface** a la estructura [**VMR9AllocationInfo**](/previous-versions/windows/desktop/api/Vmr9/ns-vmr9-vmr9allocationinfo) .</span><span class="sxs-lookup"><span data-stu-id="55561-115">If you want the VMR-9 to draw the video frames onto a texture surface, add the **VMR9AllocFlag\_TextureSurface** flag to the [**VMR9AllocationInfo**](/previous-versions/windows/desktop/api/Vmr9/ns-vmr9-vmr9allocationinfo) structure.</span></span> <span data-ttu-id="55561-116">Si el dispositivo no admite texturas en el formato de vídeo nativo, es posible que tenga que crear una superficie de textura independiente y, a continuación, copiar los fotogramas de vídeo de la superficie de vídeo a la textura.</span><span class="sxs-lookup"><span data-stu-id="55561-116">If the device does not support textures in the native video format, you might need to create a separate texture surface, and then copy the video frames from the video surface to the texture.</span></span>

     

9.  <span data-ttu-id="55561-117">Durante el streaming, VMR-9 obtiene las superficies del asignador-Presenter llamando al método [**IVMRSurfaceAllocator9:: GetSurface**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-getsurface) .</span><span class="sxs-lookup"><span data-stu-id="55561-117">During streaming, the VMR-9 gets surfaces from the allocator-presenter by calling the [**IVMRSurfaceAllocator9::GetSurface**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-getsurface) method.</span></span> <span data-ttu-id="55561-118">VMR-9 especifica la superficie por su índice dentro de la matriz de la superficie (paso 8).</span><span class="sxs-lookup"><span data-stu-id="55561-118">The VMR-9 specifies the surface by its index within the surface array (step 8).</span></span>
10. <span data-ttu-id="55561-119">Presente la imagen cuando VMR-9 llama al método [**IVMRImagePresenter9::P resentimage**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrimagepresenter9-presentimage) .</span><span class="sxs-lookup"><span data-stu-id="55561-119">Present the image when the VMR-9 calls the [**IVMRImagePresenter9::PresentImage**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrimagepresenter9-presentimage) method.</span></span> <span data-ttu-id="55561-120">Los parámetros incluyen un puntero a la superficie de Direct3D que contiene la imagen de vídeo.</span><span class="sxs-lookup"><span data-stu-id="55561-120">The parameters include a pointer to the Direct3D surface that contains the video image.</span></span>
11. <span data-ttu-id="55561-121">Si el dispositivo Direct3D se pierde en cualquier momento, el asignador debe restaurar el dispositivo y volver a crear las superficies.</span><span class="sxs-lookup"><span data-stu-id="55561-121">If the Direct3D device is lost at any time, the allocator-presenter must restore the device and recreate the surfaces.</span></span> <span data-ttu-id="55561-122">Por ejemplo, se puede perder el dispositivo si cambia el modo de presentación o si el usuario mueve la ventana a otro monitor.</span><span class="sxs-lookup"><span data-stu-id="55561-122">For example, the device can be lost if the display mode changes or the user moves the window to another monitor.</span></span> <span data-ttu-id="55561-123">Si el dispositivo Direct3D cambia, llame al método [**IVMRSurfaceAllocatorNotify9:: ChangeD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-changed3ddevice) del filtro VMR-9.</span><span class="sxs-lookup"><span data-stu-id="55561-123">If the Direct3D device changes, call the VMR-9 filter's [**IVMRSurfaceAllocatorNotify9::ChangeD3DDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-changed3ddevice) method.</span></span>
12. <span data-ttu-id="55561-124">Cuando se detiene el streaming, VMR-9 llama al método [**IVMRSurfaceAllocator9:: TerminateDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-terminatedevice) .</span><span class="sxs-lookup"><span data-stu-id="55561-124">When streaming stops, the VMR-9 calls the [**IVMRSurfaceAllocator9::TerminateDevice**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocator9-terminatedevice) method.</span></span> <span data-ttu-id="55561-125">Allocator-Presenter debe liberar todos sus recursos de Direct3D.</span><span class="sxs-lookup"><span data-stu-id="55561-125">The allocator-presenter should release all of its Direct3D resources.</span></span>

<span data-ttu-id="55561-126">Hay algunas diferencias entre la VMR-7 y la VMR-9 en la forma en que se administran los presentadores personalizados:</span><span class="sxs-lookup"><span data-stu-id="55561-126">There are some differences between the VMR-7 and the VMR-9 in the way custom allocator-presenters are managed:</span></span>

-   <span data-ttu-id="55561-127">El método [**AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) del filtro VMR-9 está disponible para que lo use el presentador del asignador cuando se asignan superficies.</span><span class="sxs-lookup"><span data-stu-id="55561-127">The VMR-9 filter's [**AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) method is available for the allocator-presenter to use when allocating surfaces.</span></span> <span data-ttu-id="55561-128">Este método hace que resulte innecesario que un asignador personalizado reenvíe las llamadas al asignador predeterminado.</span><span class="sxs-lookup"><span data-stu-id="55561-128">This method makes it unnecessary for a custom allocator-presenter to forward any calls to the default allocator-presenter.</span></span> <span data-ttu-id="55561-129">Por esta razón, el CLSID del asignador predeterminado del filtro VMR-9 no se publica.</span><span class="sxs-lookup"><span data-stu-id="55561-129">For this reason, the CLSID of the VMR-9 filter's default allocator-presenter is not published.</span></span>
-   <span data-ttu-id="55561-130">A diferencia de la de VMR-7, el modelo VMR-9 no proporciona un asignador de modo exclusivo de DirectDraw (el presentador).</span><span class="sxs-lookup"><span data-stu-id="55561-130">Unlike the VMR-7, the VMR-9 does not provide a special DirectDraw Exclusive Mode allocator-presenter.</span></span> <span data-ttu-id="55561-131">El método [**IVMRSurfaceAllocatorNotify9:: AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) hace que este objeto sea innecesario.</span><span class="sxs-lookup"><span data-stu-id="55561-131">The [**IVMRSurfaceAllocatorNotify9::AllocateSurfaceHelper**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrsurfaceallocatornotify9-allocatesurfacehelper) method makes this object unnecessary.</span></span>
-   <span data-ttu-id="55561-132">En el caso del vídeo entrelazado, VMR-9 siempre anula el entrelazado del vídeo antes de presentar la imagen.</span><span class="sxs-lookup"><span data-stu-id="55561-132">For interlaced video, the VMR-9 always de-interlaces the video before it presents the image.</span></span> <span data-ttu-id="55561-133">Allocator-Presenter ya no es responsable de quitar el entrelazado de la imagen antes de mostrarla.</span><span class="sxs-lookup"><span data-stu-id="55561-133">The allocator-presenter is no longer responsible for de-interlacing the image before displaying it.</span></span>

## <a name="related-topics"></a><span data-ttu-id="55561-134">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="55561-134">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="55561-135">Modo de reproducción no representativo de VMR (asignador personalizado)</span><span class="sxs-lookup"><span data-stu-id="55561-135">VMR Renderless Playback Mode (Custom Allocator-Presenters)</span></span>](vmr-renderless-playback-mode--custom-allocator-presenters.md)
</dt> </dl>

 

 



