---
title: Enlazar a un objeto Active Directory
description: La forma más común de enlazar a un objeto Active Directory es usar la función GetObject entre un cliente ADSI y un proveedor ADSI.
ms.assetid: d278ea26-2fd5-4343-8d87-ff85515325fb
ms.tgt_platform: multiple
keywords:
- Enlazar a un objeto Active Directory ADSI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59992dbc88c00be6306dec24523ec4e030d4a516
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/21/2020
ms.locfileid: "103904817"
---
# <a name="binding-to-an-active-directory-object"></a><span data-ttu-id="82981-104">Enlazar a un objeto Active Directory</span><span class="sxs-lookup"><span data-stu-id="82981-104">Binding to an Active Directory Object</span></span>

<span data-ttu-id="82981-105">La forma más común de enlazar a un objeto Active Directory es usar la función **GetObject** entre un cliente ADSI y un proveedor ADSI.</span><span class="sxs-lookup"><span data-stu-id="82981-105">The most common way to bind to an Active Directory object is to use the **GetObject** function between an ADSI client and an ADSI provider.</span></span> <span data-ttu-id="82981-106">Esta es también la forma más fácil de mostrar cómo el componente de proveedor recibe las solicitudes de servicio y.</span><span class="sxs-lookup"><span data-stu-id="82981-106">This is also the easiest way to show how the provider component receives and services requests.</span></span> <span data-ttu-id="82981-107">Tanto la función [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) de la API ADSI como la función Visual Basic **GetObject** siguen los mismos pasos para el enlace.</span><span class="sxs-lookup"><span data-stu-id="82981-107">Both the ADSI API function [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) or the Visual Basic function **GetObject** follow the same steps for binding.</span></span>

<span data-ttu-id="82981-108">En este ejemplo, suponga que el cliente ADSI es una aplicación de visor ADSI que ha recibido el ADsPath "Sample://Seattle/Redmond/Shelly" de la interfaz de usuario (1).</span><span class="sxs-lookup"><span data-stu-id="82981-108">For this example, assume the ADSI client is an ADSI viewer application that has received the ADsPath "Sample://Seattle/Redmond/Shelly" from its user interface (1).</span></span> <span data-ttu-id="82981-109">En la siguiente ilustración se detalla la secuencia de eventos mediante la numeración de las flechas de flujo.</span><span class="sxs-lookup"><span data-stu-id="82981-109">The following figure details the sequence of events by numbering the flow arrows.</span></span>

![vista detallada de los componentes ADSI](images/dscsex.png)

<span data-ttu-id="82981-111">En la ilustración anterior, el cliente inicia la solicitud de un puntero de interfaz en el objeto Active Directory representado por el ADsPath "Sample://Seattle/Redmond/Shelly" de los servicios ADSI (2).</span><span class="sxs-lookup"><span data-stu-id="82981-111">In the preceding figure, the client initiates the request for an interface pointer on the Active Directory object represented by the ADsPath "Sample://Seattle/Redmond/Shelly" from ADSI services (2).</span></span> <span data-ttu-id="82981-112">Durante la inicialización, el software de servicios llenó una tabla de identificadores de programación (ProgID) del proveedor instalados desde el registro ("LDAP:", "Sample:", "WinNT:", etc.) y emparejarlos con los **CLSID** correspondientes que identifican el módulo de software adecuado.</span><span class="sxs-lookup"><span data-stu-id="82981-112">During initialization, the services software populated a table of installed provider programmatic identifiers (ProgIDs) from the registry ("LDAP:","Sample:", "WinNT:", and so on) and paired them with the matching **CLSID** s which identify the appropriate software module.</span></span>

<span data-ttu-id="82981-113">El servidor ADSI comprueba que el ProgID, en este caso "Sample:", existe en ADsPath.</span><span class="sxs-lookup"><span data-stu-id="82981-113">The ADSI server verifies that the ProgID, in this case "Sample:", exists in the ADsPath.</span></span> <span data-ttu-id="82981-114">A continuación, crea un contexto de enlace para optimizar más referencias a este objeto y llama a la función COM estándar [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) para crear un moniker com que se puede usar para buscar y enlazar al objeto que representa al usuario "Shelly".</span><span class="sxs-lookup"><span data-stu-id="82981-114">It then creates a bind context to optimize further references to this object, and calls the standard COM function [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) to create a COM moniker that can be used to find and bind to the object that represents the user "Shelly".</span></span>

<span data-ttu-id="82981-115">En la sección siguiente, los nombres de archivo del código fuente del componente de proveedor de ejemplo se incluyen entre paréntesis cuando corresponda.</span><span class="sxs-lookup"><span data-stu-id="82981-115">In the following section, the file names of the example provider component source code are included in parentheses where appropriate.</span></span>

<span data-ttu-id="82981-116">Como en otras implementaciones de servidor COM, [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) examina el identificador de programa (ProgID) y busca el **CLSID** adecuado en el registro (3) para buscar el código de generador de clases proporcionado por el proveedor correspondiente (Cprovcf. cpp) en la implementación de proveedor adecuada (4).</span><span class="sxs-lookup"><span data-stu-id="82981-116">As in other COM server implementations, [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) examines the ProgID, and looks up the proper **CLSID** in the registry (3) to find the corresponding provider-supplied class factory code (Cprovcf.cpp) in the appropriate provider implementation (4).</span></span> <span data-ttu-id="82981-117">Este código crea un objeto de nivel superior inicial que implementa el método [**IParseDisplayName::P arsedisplayname**](/windows/win32/api/oleidl/nf-oleidl-iparsedisplayname-parsedisplayname) (Cprov. cpp).</span><span class="sxs-lookup"><span data-stu-id="82981-117">This code creates an initial top-level object that implements the [**IParseDisplayName::ParseDisplayName**](/windows/win32/api/oleidl/nf-oleidl-iparsedisplayname-parsedisplayname) method (Cprov.cpp).</span></span> <span data-ttu-id="82981-118">La implementación del proveedor de **ParseDisplayName** resuelve la ruta de acceso en el espacio de nombres propio del proveedor.</span><span class="sxs-lookup"><span data-stu-id="82981-118">The provider's implementation of **ParseDisplayName** resolves the path in the provider's own namespace.</span></span> <span data-ttu-id="82981-119">En este momento, se llama a ADsObject y se invoca el analizador proporcionado con el componente de proveedor (Parse. cpp) para comprobar que el ADsPath es sintácticamente correcto para este espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="82981-119">This eventually calls ADsObject and invokes the parser supplied with the provider component (Parse.cpp) to verify that the ADsPath is syntactically correct for this namespace.</span></span>

<span data-ttu-id="82981-120">**GetObject**, que se define en Getobj. cpp, determina si el objeto solicitado es un objeto de espacio de nombres, un objeto de esquema o algún otro tipo de objeto.</span><span class="sxs-lookup"><span data-stu-id="82981-120">**GetObject**, that is defined in Getobj.cpp, then determines if the object requested is a namespace object, a schema object, or some other type of object.</span></span> <span data-ttu-id="82981-121">Si uno de los dos primeros, se crea ese tipo de objeto de clase de esquema y se recupera el puntero de interfaz adecuado.</span><span class="sxs-lookup"><span data-stu-id="82981-121">If either of the first two, that type of schema class object is created and the appropriate interface pointer retrieved.</span></span> <span data-ttu-id="82981-122">De lo contrario, la ruta de acceso del directorio de ejemplo se crea a partir de la ADsPath (por ejemplo, " \\ Seattle \\ Redmond \\ Shelly", pero en un servicio de directorio diferente podría haber tenido que ser " \\ ou = Seattle \\ ou = Redmond \\ CN = Shelly") y el control pasa a SampleDSOpenObject, que abre el objeto en el almacenamiento de datos de ejemplo y también recupera su tipo de objeto</span><span class="sxs-lookup"><span data-stu-id="82981-122">Otherwise the Sample directory path is created from the ADsPath (for example, "\\Seattle\\Redmond\\Shelly", but in a different directory service it might have had to be "\\OU=Seattle\\OU=Redmond\\CN=Shelly") and control passes to SampleDSOpenObject which opens the object in the example data storage and also retrieves its object type (in this case, "User") (5).</span></span>

<span data-ttu-id="82981-123">Con los datos recopilados, se crea un nuevo objeto (6) para representar el elemento descrito por ADsPath y se recupera un puntero a la interfaz [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) en ese objeto.</span><span class="sxs-lookup"><span data-stu-id="82981-123">With the data gathered, a new object is created (6) to represent the item described by the ADsPath, and a pointer to the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) interface on that object is retrieved.</span></span> <span data-ttu-id="82981-124">En este caso, se crea un objeto de Active Directory genérico que admite los métodos **IUnknown** y [**IADs**](/windows/desktop/api/Iads/nn-iads-iads) (Cgenobj. cpp, Core. cpp).</span><span class="sxs-lookup"><span data-stu-id="82981-124">In this case, a generic Active Directory object is created that supports the **IUnknown** and [**IADs**](/windows/desktop/api/Iads/nn-iads-iads) methods (Cgenobj.cpp, Core.cpp).</span></span> <span data-ttu-id="82981-125">La rutina CSampleDSGenObject:: AllocateGenObject Lee los datos de la biblioteca de tipos para crear las entradas de envío adecuadas para estos objetos nuevos con el fin de admitir [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch).</span><span class="sxs-lookup"><span data-stu-id="82981-125">The CSampleDSGenObject::AllocateGenObject routine reads the type library data to create the proper dispatch entries for these new objects in order to support [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch).</span></span>

<span data-ttu-id="82981-126">Al ajustar este puntero de interfaz en un moniker, se completa la función ResolvePathName (Cprov. cpp) y se analiza el nombre para mostrar.</span><span class="sxs-lookup"><span data-stu-id="82981-126">Wrapping this interface pointer into a moniker completes the ResolvePathName (Cprov.cpp) function and parses the display name.</span></span>

<span data-ttu-id="82981-127">Todos los objetos COM creados durante este proceso se almacenan en caché por motivos de rendimiento y se administran a través del contexto de enlace.</span><span class="sxs-lookup"><span data-stu-id="82981-127">All the COM objects created during this process are cached for performance reasons and managed through the binding context.</span></span> <span data-ttu-id="82981-128">Esto mejora el rendimiento de otras operaciones en el mismo objeto que sigue inmediatamente al enlace de moniker.</span><span class="sxs-lookup"><span data-stu-id="82981-128">This improves performance for other operations on the same object that immediately follows the moniker binding.</span></span>

<span data-ttu-id="82981-129">Ahora se consulta el objeto Active Directory con formato correcto para el identificador de interfaz solicitado para la llamada inicial de [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) y se recupera un puntero a esa interfaz (7) y se devuelve a través del servidor ADSI al cliente (8&9).</span><span class="sxs-lookup"><span data-stu-id="82981-129">This well-formed Active Directory object is now queried for the interface identifier requested for the initial [**ADsGetObject**](/windows/desktop/api/Adshlp/nf-adshlp-adsgetobject) call and a pointer to that interface is retrieved (7) and passed back through the ADSI server to the client (8&9).</span></span> <span data-ttu-id="82981-130">Desde entonces, el cliente trabaja directamente con el componente de proveedor a través de los métodos de interfaz hasta que se cumple la solicitud inicial (10).</span><span class="sxs-lookup"><span data-stu-id="82981-130">From then on, the client works directly with the provider component through the interface methods until the initial request is satisfied (10).</span></span>

<span data-ttu-id="82981-131">Además, las solicitudes de datos de objetos del cliente normalmente adoptan la forma de solicitudes de las propiedades obtiene y put de la propiedad, que se optimizan mediante la implementación de proveedor de una caché de propiedades (Cprops. cpp).</span><span class="sxs-lookup"><span data-stu-id="82981-131">Furthermore, requests for object data from the client usually take the form of requests for property gets and puts, all of which are optimized through the provider implementation of a property cache (Cprops.cpp).</span></span> <span data-ttu-id="82981-132">Empaquetar y desempaquetar datos de forma inteligente, que a menudo incluye la copia y liberación de estructuras y cadenas, entre los tipos de datos nativos del sistema operativo del componente de proveedor de ejemplo y el tipo de [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) de automatización que admite ADSI tiene lugar antes de que se carguen las propiedades en la memoria caché (Smpoper. cpp).</span><span class="sxs-lookup"><span data-stu-id="82981-132">Intelligently packing and unpacking data, often including copying and freeing structures and strings, between the native data types on the example provider component's operating system and the Automation [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) type supported by ADSI takes place before the properties are loaded into the cache (Smpoper.cpp).</span></span>

<span data-ttu-id="82981-133">El componente de proveedor de ejemplo está diseñado para que las llamadas reales al sistema operativo estén aisladas lógicamente del componente de proveedor, lo que crea un software portable a más de un sistema operativo (RegDSAPI. cpp).</span><span class="sxs-lookup"><span data-stu-id="82981-133">The example provider component is designed so that the actual calls to the operating system are logically isolated from the provider component, creating software portable to more than one operating system (RegDSAPI.cpp).</span></span>

 

 