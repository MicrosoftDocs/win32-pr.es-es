---
description: Para iniciar un servicio o un servicio de controlador, el programa de control de servicios utiliza la función StartService.
ms.assetid: 7d2ee779-1554-436a-a65c-f0322745f46a
title: Inicio del servicio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0f5fcd9ee820357e75bf07649da8e6c5445d3f42
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105668464"
---
# <a name="service-startup"></a><span data-ttu-id="ba8ea-103">Inicio del servicio</span><span class="sxs-lookup"><span data-stu-id="ba8ea-103">Service Startup</span></span>

<span data-ttu-id="ba8ea-104">Para iniciar un servicio o un servicio de controlador, el programa de control de servicios utiliza la función [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-104">To start a service or driver service, the service control program uses the [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) function.</span></span> <span data-ttu-id="ba8ea-105">Se produce un error en la función **StartService** si la base de datos está bloqueada.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-105">The **StartService** function fails if the database is locked.</span></span> <span data-ttu-id="ba8ea-106">Si esto ocurre, el programa de control de servicios debe esperar unos segundos y volver a llamar a **StartService** .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-106">If this occurs, the service control program should wait a few seconds and call **StartService** again.</span></span> <span data-ttu-id="ba8ea-107">Puede comprobar el estado de bloqueo actual de la base de datos mediante una llamada a la función [**QueryServiceLockStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicelockstatusa) .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-107">It can check the current lock status of the database by calling the [**QueryServiceLockStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicelockstatusa) function.</span></span>

<span data-ttu-id="ba8ea-108">Si el programa de control de servicios está iniciando un servicio, puede usar la función [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) para especificar una matriz de argumentos que se van a pasar a la función [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) del servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-108">If the service control program is starting a service, it can use the [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) function to specify an array of arguments to be passed to the service's [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function.</span></span> <span data-ttu-id="ba8ea-109">La función **StartService** devuelve después de crear un nuevo subproceso para ejecutar la función **ServiceMain** .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-109">The **StartService** function returns after a new thread is created to execute the **ServiceMain** function.</span></span> <span data-ttu-id="ba8ea-110">El programa de control de servicios puede recuperar el estado del servicio recién iniciado en una estructura de [**\_ Estado de servicio**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) llamando a la función [**QueryServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatus) .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-110">The service control program can retrieve the status of the newly started service in a [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure by calling the [**QueryServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatus) function.</span></span> <span data-ttu-id="ba8ea-111">Durante la inicialización, el miembro **dwCurrentState** debe ser un inicio de servicio \_ \_ pendiente.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-111">During initialization, the **dwCurrentState** member should be SERVICE\_START\_PENDING.</span></span> <span data-ttu-id="ba8ea-112">El miembro **dwWaitHint** es un intervalo de tiempo, en milisegundos, que indica cuánto tiempo debe esperar el programa de control de servicio antes de volver a llamar a **QueryServiceStatus** .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-112">The **dwWaitHint** member is a time interval, in milliseconds, that indicates how long the service control program should wait before calling **QueryServiceStatus** again.</span></span> <span data-ttu-id="ba8ea-113">Una vez completada la inicialización, el servicio cambia **dwCurrentState** al servicio en \_ ejecución.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-113">When the initialization is complete, the service changes **dwCurrentState** to SERVICE\_RUNNING.</span></span>

<span data-ttu-id="ba8ea-114">El administrador de control de servicios no permite pasar variables de entorno personalizadas a un servicio en el inicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-114">The service control manager does not support passing custom environment variables to a service at startup.</span></span> <span data-ttu-id="ba8ea-115">Además, el administrador de control de servicios no detecta ni pasa los cambios en las variables de entorno cuando el servicio se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-115">Also, the service control manager does not detect and pass on changes to environment variables as the service is running.</span></span> <span data-ttu-id="ba8ea-116">En lugar de que un servicio dependa de una variable de entorno, use valores del registro o argumentos de [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-116">Instead of making a service dependent on an environment variable, use registry values or [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) arguments.</span></span>

<span data-ttu-id="ba8ea-117">A continuación se ofrece una introducción simplificada de lo que ocurre cuando el administrador de control de servicios inicia un servicio típico:</span><span class="sxs-lookup"><span data-stu-id="ba8ea-117">The following is a simplified overview of what happens when a typical service is started by the service control manager:</span></span>

-   <span data-ttu-id="ba8ea-118">El SCM lee la ruta de acceso del servicio desde el registro y se prepara para iniciar el servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-118">The SCM reads the service path from the registry and prepares to start the service.</span></span> <span data-ttu-id="ba8ea-119">Esto incluye la adquisición del bloqueo de servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-119">This includes acquiring the service lock.</span></span> <span data-ttu-id="ba8ea-120">Cualquier intento de iniciar otro servicio mientras se mantiene el bloqueo del servicio se bloqueará hasta que se libere el bloqueo del servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-120">Any attempt to start another service while the service lock is held will block until the service lock is released.</span></span>
-   <span data-ttu-id="ba8ea-121">El SCM inicia el proceso y espera hasta que se cierra el proceso secundario (lo que indica un error) o informa del \_ Estado de ejecución del servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-121">The SCM starts the process and waits until either the child process exits (indicating a failure) or reports the SERVICE\_RUNNING status.</span></span>
-   <span data-ttu-id="ba8ea-122">La aplicación realiza su inicialización muy sencilla y llama a la función [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) .</span><span class="sxs-lookup"><span data-stu-id="ba8ea-122">The application performs its very simple initialization and calls the [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) function.</span></span>
-   <span data-ttu-id="ba8ea-123">[**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) se conecta al administrador de control de servicios e inicia un segundo subproceso que llama a la función [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) para el servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-123">[**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) connects to the service control manager and starts a second thread that calls the [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function for the service.</span></span> <span data-ttu-id="ba8ea-124">**ServiceMain** debe notificar el servicio \_ en ejecución lo antes posible.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-124">**ServiceMain** should report SERVICE\_RUNNING as soon as possible.</span></span>
-   <span data-ttu-id="ba8ea-125">Cuando el administrador de control de servicios recibe una notificación de que el servicio se está ejecutando, libera el bloqueo del servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-125">When the service control manager is notified that the service is running, it releases the service lock.</span></span>

<span data-ttu-id="ba8ea-126">Si el servicio no actualiza su estado en 80 segundos, más la sugerencia de última espera, el administrador de control de servicios determina que el servicio ha dejado de responder.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-126">If service does not update its status within 80 seconds, plus the last wait hint, the service control manager determines that the service has stopped responding.</span></span> <span data-ttu-id="ba8ea-127">El administrador de control de servicios registrará un evento y detendrá el servicio.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-127">The service control manager will log an event and stop the service.</span></span>

<span data-ttu-id="ba8ea-128">Si el programa está iniciando un servicio de controlador, [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) vuelve una vez que el controlador de dispositivo ha completado su inicialización.</span><span class="sxs-lookup"><span data-stu-id="ba8ea-128">If the program is starting a driver service, [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) returns after the device driver has completed its initialization.</span></span>

<span data-ttu-id="ba8ea-129">Para obtener más información, consulte [Inicio de un servicio](starting-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="ba8ea-129">For more information, see [Starting a Service](starting-a-service.md).</span></span>

 

 
