---
title: Directrices para aplicaciones
description: Las aplicaciones que se ejecutan en Windows Vista y Windows Server 2008 deben cumplir estas directrices para asegurarse de que el administrador de reinicio puede apagar y reiniciar las aplicaciones si es necesario para instalar las actualizaciones.
ms.assetid: 97b1df63-65a9-47b4-891b-e4a754882b89
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ebace21e09956c68d34c90775c5ea646a8b2dd0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "103793371"
---
# <a name="guidelines-for-applications"></a><span data-ttu-id="bb1c4-103">Directrices para aplicaciones</span><span class="sxs-lookup"><span data-stu-id="bb1c4-103">Guidelines for Applications</span></span>

<span data-ttu-id="bb1c4-104">Las aplicaciones que se ejecutan en Windows Vista y Windows Server 2008 deben cumplir estas directrices para asegurarse de que el administrador de reinicio puede apagar y reiniciar las aplicaciones si es necesario para instalar las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-104">Applications running on Windows Vista and Windows Server 2008 should adhere to these guidelines to ensure that the Restart Manager can shut down and restart applications if necessary to install updates.</span></span> <span data-ttu-id="bb1c4-105">Los servicios pueden usar las directrices que se describen en [directrices para servicios](guidelines-for-services.md).</span><span class="sxs-lookup"><span data-stu-id="bb1c4-105">Services can use the guidelines that are described in [Guidelines for Services](guidelines-for-services.md).</span></span>

-   <span data-ttu-id="bb1c4-106">El administrador de reinicio consulta las aplicaciones GUI para el cierre mediante el envío de una notificación de [**\_ QUERYENDSESSION de WM**](/windows/desktop/Shutdown/wm-queryendsession) que tenga el parámetro *lParam* establecido en **ENDSESSION \_ CLOSEAPP** (0x1).</span><span class="sxs-lookup"><span data-stu-id="bb1c4-106">The Restart Manager queries GUI applications for shutdown by sending a [**WM\_QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) notification that has the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1).</span></span> <span data-ttu-id="bb1c4-107">Las aplicaciones no deben cerrarse cuando reciban un mensaje de **\_ QUERYENDSESSION de WM** porque es posible que otra aplicación no esté lista para cerrarse.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-107">Applications should not shut down when they receive a **WM\_QUERYENDSESSION** message because another application may not be ready to shut down.</span></span> <span data-ttu-id="bb1c4-108">Las aplicaciones GUI deben escuchar el mensaje de **\_ QUERYENDSESSION de WM** y devolver el valor **true** si la aplicación está preparada para cerrarse y reiniciarse.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-108">GUI applications should listen for the **WM\_QUERYENDSESSION** message and return a value of **TRUE** if the application is prepared to shut down and restart.</span></span> <span data-ttu-id="bb1c4-109">Si ninguna aplicación devuelve el valor **false**, el administrador de reinicio envía un mensaje de [**WM \_ ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) con el parámetro *lParam* establecido en **ENDSESSION \_ CLOSEAPP** (0x1) y el parámetro *wParam* establecido en **true**.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-109">If no application returns a value of **FALSE**, the Restart Manager sends a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message with the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1) and the *wparam* parameter set to **TRUE**.</span></span> <span data-ttu-id="bb1c4-110">Las aplicaciones deben cerrarse solo cuando reciben el mensaje de **WM \_ ENDSESSION** .</span><span class="sxs-lookup"><span data-stu-id="bb1c4-110">Applications should shut down only when they receive the **WM\_ENDSESSION** message.</span></span> <span data-ttu-id="bb1c4-111">El administrador de reinicio también envía un mensaje de [**\_ cierre de WM**](../winmsg/wm-close.md) para aplicaciones GUI que no se cierran al recibir la **\_ ENDSESSION de WM**.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-111">The Restart Manager also sends a [**WM\_CLOSE**](../winmsg/wm-close.md) message for GUI applications that do not shut down on receiving **WM\_ENDSESSION**.</span></span> <span data-ttu-id="bb1c4-112">Si alguna aplicación de GUI responde a un mensaje de **\_ QUERYENDSESSION de WM** devolviendo un valor de **false**, se cancela el cierre.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-112">If any GUI application responds to a **WM\_QUERYENDSESSION** message by returning a value of **FALSE**, the shutdown is canceled.</span></span> <span data-ttu-id="bb1c4-113">Sin embargo, si se fuerza el cierre, la aplicación se termina independientemente de.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-113">However, if the shutdown is forced, the application is terminated regardless.</span></span>
-   <span data-ttu-id="bb1c4-114">Cuando una aplicación GUI recibe un mensaje de [**WM \_ ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) , la aplicación debe prepararse para cerrarse dentro del período de tiempo de espera especificado.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-114">When a GUI application receives a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message, the application should prepare itself to shut down within the specified timeout period.</span></span> <span data-ttu-id="bb1c4-115">Como mínimo, las aplicaciones se deben preparar guardando los datos de usuario y la información de estado que se necesita después de un reinicio.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-115">At a minimum, applications should prepare by saving any user data and state information that is needed after a restart.</span></span> <span data-ttu-id="bb1c4-116">Se recomienda que las aplicaciones guarden periódicamente los datos de usuario y el estado.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-116">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="bb1c4-117">El administrador de reinicio envía una notificación de **\_ \_ evento Ctrl C** a las aplicaciones de consola que deben cerrarse y reiniciarse.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-117">The Restart Manager sends a **CTRL\_C\_EVENT** notification to console applications that must be shut down and restarted.</span></span> <span data-ttu-id="bb1c4-118">Cuando una aplicación de consola recibe una notificación de **\_ \_ eventos Ctrl C** , la aplicación debe tomar las medidas necesarias para preparar un cierre dentro del período de tiempo de espera especificado.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-118">When a console application receives a **CTRL\_C\_EVENT** notification, the application should take actions necessary to prepare for a shutdown within the specified timeout period.</span></span> <span data-ttu-id="bb1c4-119">Como mínimo, las aplicaciones de consola deben definir una función [*HandlerRoutine*](/windows/console/handlerroutine) para controlar la notificación de **\_ \_ eventos Ctrl C** y guardar los datos de usuario y la información de estado que se va a necesitar después de un reinicio.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-119">At a minimum, console applications should define a [*HandlerRoutine*](/windows/console/handlerroutine) function to handle the **CTRL\_C\_EVENT** notification and should save any user data and state information that is going to be needed after a restart.</span></span> <span data-ttu-id="bb1c4-120">Se recomienda que las aplicaciones guarden periódicamente los datos de usuario y el estado.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-120">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="bb1c4-121">Si alguna aplicación no se cierra en respuesta a los mensajes de cierre, los instaladores pueden usar la opción **RmForceShutdown** de la función [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) para forzar el cierre de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-121">If any applications do not shut down in response to the shutdown messages, installers can use the **RmForceShutdown** option of the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function to force the applications to shut down.</span></span> <span data-ttu-id="bb1c4-122">Cuando el instalador especifica un cierre forzado, el administrador de reinicio intenta cerrar las aplicaciones de forma limpia mediante el envío de los mensajes de cierre, pero obliga a que se cierren si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-122">When the installer specifies a forced shutdown, Restart Manager attempts to shut down the applications cleanly by sending the shutdown messages, but will force them shut if this fails.</span></span> <span data-ttu-id="bb1c4-123">Las aplicaciones de la interfaz gráfica de usuario y las aplicaciones de consola pueden verse obligadas a cerrarse para habilitar la instalación de una actualización de seguridad crítica.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-123">GUI applications and console applications can be forced to shut down to enable the installation of a critical security update.</span></span> <span data-ttu-id="bb1c4-124">Como esto puede dar lugar a la pérdida de datos, las aplicaciones deben controlar los mensajes de cierre y cerrarse correctamente cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-124">Because this can result in data loss, applications should handle the shutdown messages and shut down cleanly when required.</span></span>
-   <span data-ttu-id="bb1c4-125">Las aplicaciones deben registrarse para un reinicio mediante la función [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="bb1c4-125">Applications should register for a restart by using the [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="bb1c4-126">El administrador de reinicio solo puede reiniciar las aplicaciones que se han registrado para reiniciarse.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-126">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="bb1c4-127">Esta es la única manera en que el administrador de reinicio puede determinar el comando de línea de comandos que se utilizará al reiniciar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-127">This is the only way that the Restart Manager can determine the command-line command to use when restarting the application.</span></span> <span data-ttu-id="bb1c4-128">Si la aplicación debe volver a abrirse con algún Estado o dato guardado, esa información debe incluirse en el comando de línea de comandos registrado para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-128">If the application must reopen with some saved state or data, that information must be included in the command-line command that is registered for the application.</span></span>
    > [!Note]  
    > <span data-ttu-id="bb1c4-129">Si la aplicación reiniciada debe ejecutarse en el mismo directorio en el que se ejecutó antes de apagarse, la aplicación debe guardar la información del directorio y, a continuación, cambiar al directorio después de reiniciar.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-129">If the restarted application must run in the same directory it ran in before being shut down, the application must save the directory information and then change to the directory after restarting.</span></span>

     

    > [!Note]  
    > <span data-ttu-id="bb1c4-130">La función [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) no reinicia las aplicaciones que no se ejecutan como el usuario que ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-130">The [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function does not restart applications that do not run as the currently-logged on user.</span></span> <span data-ttu-id="bb1c4-131">Por ejemplo, la función **RmRestart** no reinicia las aplicaciones iniciadas con el comando **Ejecutar como** que no se ejecutan como el usuario que ha iniciado sesión actualmente.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-131">For example, the **RmRestart** function does not restart applications started with the **Run As** command that do not run as the currently-logged on user.</span></span> <span data-ttu-id="bb1c4-132">Estas aplicaciones se deben reiniciar manualmente.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-132">These applications must be manually restarted.</span></span>

     

-   <span data-ttu-id="bb1c4-133">Cuando el administrador de reinicio determina que es necesario reiniciar el sistema para instalar una actualización, no apaga las aplicaciones y los servicios.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-133">When Restart Manager determines that a system restart is required to install an update, it does not shut down any applications and services.</span></span> <span data-ttu-id="bb1c4-134">En su lugar, lo deja al instalador para decidir cuándo programar un reinicio del sistema e instalar la actualización.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-134">Instead, it leaves this to the installer to decide when to schedule a system restart and install the update.</span></span> <span data-ttu-id="bb1c4-135">Los instaladores pueden reducir la interrupción de los usuarios causados por actualizaciones que requieren un reinicio del sistema mediante la función [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) con la marca **EWX \_ RESTARTAPPS** o la función [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) con la marca **Shutdown \_ RESTARTAPPS** .</span><span class="sxs-lookup"><span data-stu-id="bb1c4-135">Installers can reduce the disruption to users caused by updates that require a system restart by using the [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) function with the **EWX\_RESTARTAPPS** flag or the [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) function with the **SHUTDOWN\_RESTARTAPPS** flag.</span></span> <span data-ttu-id="bb1c4-136">El uso de estas marcas garantiza que las aplicaciones registradas para el reinicio se reinician después de un reinicio del sistema, lo que minimiza el impacto en el usuario.</span><span class="sxs-lookup"><span data-stu-id="bb1c4-136">Using these flags ensures that applications registered for restart are restarted after a system reboot, which minimizes the impact on the user.</span></span>

 

 