---
description: En esta sección se proporciona información general sobre el modelo de subprocesos de manipulación directa, cómo se procesan los mensajes de ventana mediante la manipulación directa y cómo cambia el estado de una ventanilla a medida que la entrada está asignada a los movimientos de salida.
ms.assetid: 0818E34E-990E-4C36-9954-EF87EB226AF6
title: Procesar la entrada con DirectManipulation
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 284a0a1866a2082e2c34c65de347b0dcdfab3a64
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "105720258"
---
# <a name="processing-input-with-directmanipulation"></a><span data-ttu-id="b87b6-103">Procesar la entrada con DirectManipulation</span><span class="sxs-lookup"><span data-stu-id="b87b6-103">Processing input with DirectManipulation</span></span>

<span data-ttu-id="b87b6-104">En esta sección se proporciona información general sobre el modelo de subprocesos de [manipulación directa](direct-manipulation-portal.md) , cómo se procesan los mensajes de ventana mediante la manipulación directa y cómo cambia el estado de una ventanilla a medida que la entrada está asignada a los movimientos de salida.</span><span class="sxs-lookup"><span data-stu-id="b87b6-104">This section provides an overview of the [Direct Manipulation](direct-manipulation-portal.md) threading model, how window messages are processed by Direct Manipulation, and how the state of a viewport changes as input is mapped to output motions.</span></span>

- [<span data-ttu-id="b87b6-105">Flujo de entrada</span><span class="sxs-lookup"><span data-stu-id="b87b6-105">Input flow</span></span>](#input-flow)
- [<span data-ttu-id="b87b6-106">Comentarios:</span><span class="sxs-lookup"><span data-stu-id="b87b6-106">Remarks</span></span>](#remarks)

<span data-ttu-id="b87b6-107">La [manipulación directa](direct-manipulation-portal.md) usa dos subprocesos para coordinar las operaciones asincrónicas:</span><span class="sxs-lookup"><span data-stu-id="b87b6-107">[Direct Manipulation](direct-manipulation-portal.md) uses two threads to coordinate asynchronous operations:</span></span>

<span data-ttu-id="b87b6-108">*Subproceso de interfaz de usuario* : el subproceso que posee el **hWnd** asociado a la entrada.</span><span class="sxs-lookup"><span data-stu-id="b87b6-108">*UI thread* - the thread that owns the **HWND** associated with input.</span></span> <span data-ttu-id="b87b6-109">Este subproceso es propietario de la inicialización de la [manipulación directa](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="b87b6-109">This thread owns initialization of [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="b87b6-110">El procesamiento de entradas de mouse y teclado también se produce en el subproceso de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="b87b6-110">Mouse and keyboard input processing also happens on the UI thread.</span></span>

<span data-ttu-id="b87b6-111">*Delegate Thread* : el subproceso creado y propiedad de la [manipulación directa](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="b87b6-111">*Delegate thread* - the thread created and owned by [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="b87b6-112">El procesamiento de la entrada táctil se produce en el subproceso delegado.</span><span class="sxs-lookup"><span data-stu-id="b87b6-112">Touch input processing happens on the delegate thread.</span></span>

## <a name="input-flow"></a><span data-ttu-id="b87b6-113">Flujo de entrada</span><span class="sxs-lookup"><span data-stu-id="b87b6-113">Input flow</span></span>

<span data-ttu-id="b87b6-114">En una configuración típica en la que se realiza la prueba de posicionamiento en el subproceso de la interfaz de usuario, la [manipulación directa](direct-manipulation-portal.md) procesa los mensajes de ventana en el orden siguiente:</span><span class="sxs-lookup"><span data-stu-id="b87b6-114">In a typical configuration where hit testing is done on the UI thread, window messages are processed by [Direct Manipulation](direct-manipulation-portal.md) in the following order:</span></span>

![diagrama que muestra el orden en el que se procesan los mensajes.](images/inputprocessing.png)

<span data-ttu-id="b87b6-116">Para una ventanilla en reposo:</span><span class="sxs-lookup"><span data-stu-id="b87b6-116">For a viewport at rest:</span></span>

1. <span data-ttu-id="b87b6-117">Una serie de mensajes de ventana alcanza el subproceso delegado.</span><span class="sxs-lookup"><span data-stu-id="b87b6-117">A series of window messages reach the delegate thread.</span></span>
2. <span data-ttu-id="b87b6-118">El subproceso delegado envía los mensajes de [WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) y [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) al subproceso de prueba de posicionamiento independiente (IHT).</span><span class="sxs-lookup"><span data-stu-id="b87b6-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages are sent by the delegate thread to the Independent Hit Test (IHT) thread.</span></span>
3. <span data-ttu-id="b87b6-119">Si se llama a [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) desde el subproceso IHT, el subproceso delegado podría enviar mensajes al subproceso de la interfaz de usuario, dependiendo del valor de [**DIRECTMANIPULATION \_ HITTEST \_ Type**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) cuando se llamó a [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) .</span><span class="sxs-lookup"><span data-stu-id="b87b6-119">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called from the IHT thread, messages might get sent to the UI thread by the delegate thread, depending on the value of [**DIRECTMANIPULATION\_HITTEST\_TYPE**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) when [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) was called.</span></span>
4. <span data-ttu-id="b87b6-120">Si no se llama a [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) desde el subproceso IHT, el subproceso delegado siempre envía los mensajes al subproceso de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="b87b6-120">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is not called from the IHT thread, messages are always sent by the delegate thread to the UI thread.</span></span>
5. <span data-ttu-id="b87b6-121">El cliente puede llamar a [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) desde el subproceso de interfaz de usuario para permitir que la [manipulación directa](direct-manipulation-portal.md) detecte una manipulación.</span><span class="sxs-lookup"><span data-stu-id="b87b6-121">The client can call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) from the UI thread to let [Direct Manipulation](direct-manipulation-portal.md) detect a manipulation.</span></span>
6. <span data-ttu-id="b87b6-122">Si se detecta una manipulación, la [manipulación directa](direct-manipulation-portal.md) envía un mensaje de [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) para notificar al cliente que la entrada se administra mediante la manipulación directa.</span><span class="sxs-lookup"><span data-stu-id="b87b6-122">If a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message to notify the client that the input is being handled by Direct Manipulation.</span></span> <span data-ttu-id="b87b6-123">El estado de la ventanilla se establece en Running (en **ejecución** ) y se actualizará la transformación de salida.</span><span class="sxs-lookup"><span data-stu-id="b87b6-123">The viewport status is set to **RUNNING** and the output transform will be updated.</span></span>
7. <span data-ttu-id="b87b6-124">Si se detecta una interacción distinta de una manipulación, la [manipulación directa](direct-manipulation-portal.md) envía los mensajes restantes al subproceso de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="b87b6-124">If an interaction other than a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends remaining messages to the UI thread.</span></span>

<span data-ttu-id="b87b6-125">En el caso de una ventanilla en movimiento (con el estado de en ejecución o inercia), el mensaje de ventana llega primero al subproceso delegado, donde las pruebas de posicionamiento de [manipulación directa](direct-manipulation-portal.md) en todas las ventanillas en ejecución.</span><span class="sxs-lookup"><span data-stu-id="b87b6-125">For a viewport in motion (with a status of RUNNING or INERTIA), the window message reaches the delegate thread first, where [Direct Manipulation](direct-manipulation-portal.md) hit tests against all running viewports.</span></span> <span data-ttu-id="b87b6-126">La manipulación directa asigna automáticamente el contacto a las ventanillas adecuadas identificadas por la prueba de posicionamiento.</span><span class="sxs-lookup"><span data-stu-id="b87b6-126">Direct Manipulation automatically assigns the contact to the appropriate viewports identified by hit testing.</span></span> <span data-ttu-id="b87b6-127">El estado de la ventanilla se está ejecutando y se actualizará la transformación de salida.</span><span class="sxs-lookup"><span data-stu-id="b87b6-127">The viewport status is RUNNING and the output transform will be updated.</span></span>

<span data-ttu-id="b87b6-128">En algunos casos, es posible que un subproceso de interfaz de usuario de la aplicación sea demasiado lento para responder a las pruebas de posicionamiento.</span><span class="sxs-lookup"><span data-stu-id="b87b6-128">In some cases, an application UI thread may be too slow to respond to hit testing.</span></span> <span data-ttu-id="b87b6-129">Se puede usar un subproceso de prueba de posicionamiento ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) para permitir que el cliente mueva los mensajes de [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) y [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) a un subproceso específico para permitir la realización de pruebas de posicionamiento.</span><span class="sxs-lookup"><span data-stu-id="b87b6-129">A hit test thread may be used ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) to allow the client to move [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to a specific thread to allow for hit testing.</span></span>

## <a name="remarks"></a><span data-ttu-id="b87b6-130">Observaciones</span><span class="sxs-lookup"><span data-stu-id="b87b6-130">Remarks</span></span>

<span data-ttu-id="b87b6-131">Normalmente, la [manipulación directa](direct-manipulation-portal.md) solo envía mensajes [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) y [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) al subproceso de la interfaz de usuario, retrasando los mensajes posteriores mientras se espera una respuesta del cliente.</span><span class="sxs-lookup"><span data-stu-id="b87b6-131">Typically, [Direct Manipulation](direct-manipulation-portal.md) sends only [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to the UI thread, withholding later messages while waiting for a response from the client.</span></span> <span data-ttu-id="b87b6-132">Si el cliente llama a [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), los únicos mensajes que recibe el subproceso de interfaz de usuario cuando se detecta una manipulación son [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) y [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md), y el [mensaje de WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md).</span><span class="sxs-lookup"><span data-stu-id="b87b6-132">If the client calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), the only messages the UI thread receives when a manipulation is detected are [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md), and [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md).</span></span>

<span data-ttu-id="b87b6-133">Es posible que el cliente no llame a [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) al procesar los mensajes de [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) y [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="b87b6-133">The client might not call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) when processing [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages.</span></span> <span data-ttu-id="b87b6-134">En este caso, la [manipulación directa](direct-manipulation-portal.md) envía todos los mensajes al subproceso de interfaz de usuario sin analizar los mensajes para ver si hay una manipulación.</span><span class="sxs-lookup"><span data-stu-id="b87b6-134">In this case, [Direct Manipulation](direct-manipulation-portal.md) sends all messages to the UI thread without analyzing the messages to see if there is a manipulation.</span></span> <span data-ttu-id="b87b6-135">A continuación, el cliente puede elegir cualquier punto para llamar a **SetContact** y hacer que la manipulación directa empiece a detectar manipulaciones, y enviar mensajes de [WM/_POINTERCAPTURECHANGED mensaje](../inputmsg/wm-pointercapturechanged.md) cuando se detecte uno.</span><span class="sxs-lookup"><span data-stu-id="b87b6-135">The client can then choose any point to call **SetContact** and have Direct Manipulation start detecting manipulations, and send [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md) messages when one is detected.</span></span>

<span data-ttu-id="b87b6-136">**Windows 10 y versiones posteriores:** Puede decidir qué manipulaciones desea controlar llamando a [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) antes de llamar a [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) en un mensaje de [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) o [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="b87b6-136">**Windows 10 and later:** You can decide which manipulations you want to handle by calling [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) before calling [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) on a [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) or [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) message.</span></span> <span data-ttu-id="b87b6-137">**DeferContact** garantiza que todos los mensajes subsiguientes se envíen al subproceso de interfaz de usuario durante el período de tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="b87b6-137">**DeferContact** ensures all subsequent messages are sent to the UI thread for the specified period of time.</span></span>
