---
description: El material siguiente se proporciona como aclaración para el cierre de las conexiones de socket que cierran los sockets. Es importante distinguir la diferencia entre apagar una conexión de socket y cerrar un socket.
ms.assetid: 383747c3-dd3d-4a18-b4e8-2815d5e5c0c7
title: Cierre estable, opciones de permanencia y cierre de socket
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59f6791eaa803da561fc9f3c175b5270950cbec3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104275402"
---
# <a name="graceful-shutdown-linger-options-and-socket-closure"></a><span data-ttu-id="d6bf4-104">Cierre estable, opciones de permanencia y cierre de socket</span><span class="sxs-lookup"><span data-stu-id="d6bf4-104">Graceful Shutdown, Linger Options, and Socket Closure</span></span>

<span data-ttu-id="d6bf4-105">El material siguiente se proporciona como aclaración para el cierre de las conexiones de socket que cierran los sockets.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-105">The following material is provided as clarification for the subject of shutting down socket connections closing the sockets.</span></span> <span data-ttu-id="d6bf4-106">Es importante distinguir la diferencia entre apagar una conexión de socket y cerrar un socket.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-106">It is important to distinguish the difference between shutting down a socket connection and closing a socket.</span></span>

<span data-ttu-id="d6bf4-107">Cerrar una conexión de socket implica un intercambio de mensajes de protocolo entre los dos extremos, lo que se conoce ahora como una secuencia de cierre.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-107">Shutting down a socket connection involves an exchange of protocol messages between the two endpoints, hereafter referred to as a shutdown sequence.</span></span> <span data-ttu-id="d6bf4-108">Se definen dos clases generales de secuencias de cierre: correcto y anulación (también denominada Hard).</span><span class="sxs-lookup"><span data-stu-id="d6bf4-108">Two general classes of shutdown sequences are defined: graceful and abortive (also called hard).</span></span> <span data-ttu-id="d6bf4-109">En una secuencia de cierre correcto, se pueden enviar todos los datos que se han puesto en cola, pero que aún no se han transmitido, antes de que se cierre la conexión.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-109">In a graceful shutdown sequence, any data that has been queued, but not yet transmitted can be sent prior to the connection being closed.</span></span> <span data-ttu-id="d6bf4-110">En un cierre anulado, se pierden los datos no enviados.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-110">In an abortive shutdown, any unsent data is lost.</span></span> <span data-ttu-id="d6bf4-111">La aparición de una secuencia de apagado (correcta o anulación) también se puede usar para proporcionar una \_ indicación de cierre FD a las aplicaciones asociadas, lo que significa que hay un apagado en curso.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-111">The occurrence of a shutdown sequence (graceful or abortive) can also be used to provide an FD\_CLOSE indication to the associated applications signifying that a shutdown is in progress.</span></span>

<span data-ttu-id="d6bf4-112">Al cerrar un socket, por otro lado, el controlador de socket se desasigna para que la aplicación ya no pueda hacer referencia o usar el socket de ninguna manera.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-112">Closing a socket, on the other hand, causes the socket handle to become deallocated so that the application can no longer reference or use the socket in any manner.</span></span>

<span data-ttu-id="d6bf4-113">En Windows Sockets, la función [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) y la función [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) se pueden usar para iniciar una secuencia de apagado, mientras que la función [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) se usa para desasignar identificadores de socket y liberar los recursos asociados.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-113">In Windows Sockets, both the [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) function, and the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function can be used to initiate a shutdown sequence, while the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function is used to deallocate socket handles and free up any associated resources.</span></span> <span data-ttu-id="d6bf4-114">No obstante, se produce cierta cantidad de confusión, desde el hecho de que la función **closesocket** produce implícitamente una secuencia de cierre si aún no se ha producido.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-114">Some amount of confusion arises, however, from the fact that the **closesocket** function implicitly causes a shutdown sequence to occur if it has not already happened.</span></span> <span data-ttu-id="d6bf4-115">De hecho, se ha convertido en una práctica de programación bastante común que se basa en esta característica y que usa **closesocket** para iniciar la secuencia de apagado y desasignar el identificador de socket.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-115">In fact, it has become a rather common programming practice to rely on this feature and to use **closesocket** to both initiate the shutdown sequence and deallocate the socket handle.</span></span>

<span data-ttu-id="d6bf4-116">Para facilitar este uso, la interfaz de sockets proporciona controles por medio del mecanismo de la opción de socket que permite al programador indicar si la secuencia de apagado implícita debe ser correcta o anulada, y también si la función [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) debe ser persistente (que no se completa inmediatamente) para dejar tiempo para que se complete una secuencia de cierre correcto.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-116">To facilitate this usage, the sockets interface provides for controls by way of the socket option mechanism that allow the programmer to indicate whether the implicit shutdown sequence should be graceful or abortive, and also whether the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function should linger (that is not complete immediately) to allow time for a graceful shutdown sequence to complete.</span></span> <span data-ttu-id="d6bf4-117">Estas distinciones importantes y las consecuencias del uso de **closesocket** de esta manera todavía no se entienden ampliamente.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-117">These important distinctions and the ramifications of using **closesocket** in this manner are still not widely understood.</span></span>

<span data-ttu-id="d6bf4-118">Mediante el establecimiento de los valores adecuados para las opciones de socket, por lo tanto \_ \_ , DONTLINGER, se pueden obtener los siguientes tipos de comportamiento con la función [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) :</span><span class="sxs-lookup"><span data-stu-id="d6bf4-118">By establishing appropriate values for the socket options SO\_LINGER and SO\_DONTLINGER, the following types of behavior can be obtained with the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function:</span></span>

-   <span data-ttu-id="d6bf4-119">Secuencia de apagado anulada, devolución inmediata desde [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="d6bf4-119">Abortive shutdown sequence, immediate return from [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>
-   <span data-ttu-id="d6bf4-120">Cierre estable, retraso en la devolución hasta que se complete la secuencia de cierre o transcurra un intervalo de tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-120">Graceful shutdown, delaying return until either shutdown sequence completes or a specified time interval elapses.</span></span> <span data-ttu-id="d6bf4-121">Si el intervalo de tiempo expira antes de que se complete la secuencia de cierre correcto, se produce una secuencia de apagado anulado y [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) devuelve.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-121">If the time interval expires before the graceful shutdown sequence completes, an abortive shutdown sequence occurs, and [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) returns.</span></span>
-   <span data-ttu-id="d6bf4-122">Cierre estable, devolución inmediata, que permite que la secuencia de apagado se complete en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-122">Graceful shutdown, immediate return—allowing the shutdown sequence to complete in the background.</span></span> <span data-ttu-id="d6bf4-123">Aunque este es el comportamiento predeterminado, la aplicación no tiene ninguna manera de saber cuándo se completa realmente la secuencia de cierre correcto.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-123">Although this is the default behavior, the application has no way of knowing when (or whether) the graceful shutdown sequence actually completes.</span></span>

<span data-ttu-id="d6bf4-124">El uso de las \_ Opciones de socket SO y so \_ DONTLINGER y la estructura de [**permanencia**](/windows/desktop/api/winsock/ns-winsock-linger) asociada se describe con más detalle en las secciones de referencia de [**\_ las opciones de socket de sockets sol**](sol-socket-socket-options.md) y la estructura de **permanencia** .</span><span class="sxs-lookup"><span data-stu-id="d6bf4-124">The use of the SO\_LINGER and SO\_DONTLINGER socket options and the associated [**linger**](/windows/desktop/api/winsock/ns-winsock-linger) structure is discussed in more detail in the reference sections on [**SOL\_SOCKET Socket Options**](sol-socket-socket-options.md) and the **linger** structure.</span></span>

<span data-ttu-id="d6bf4-125">Una técnica que se puede usar para minimizar la posibilidad de que se produzcan problemas durante la destrucción de la conexión es evitar que se confíe en un apagado implícito Iniciado por [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="d6bf4-125">One technique that can be used to minimize the chance of problems occurring during connection teardown is to avoid relying on an implicit shutdown being initiated by [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span> <span data-ttu-id="d6bf4-126">En su lugar, utilice una de las dos funciones de cierre explícita, [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) o [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect).</span><span class="sxs-lookup"><span data-stu-id="d6bf4-126">Instead, use one of the two explicit shutdown functions, [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) or [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect).</span></span> <span data-ttu-id="d6bf4-127">Esto, a su vez, hace que \_ la aplicación del mismo nivel reciba una indicación de cierre FD que indica que se han recibido todos los datos pendientes.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-127">This in turn causes an FD\_CLOSE indication to be received by the peer application indicating that all pending data has been received.</span></span> <span data-ttu-id="d6bf4-128">Para ilustrar esto, en la tabla siguiente se muestran las funciones que invocarían los componentes de cliente y servidor de una aplicación, donde el cliente es responsable de iniciar un cierre estable.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-128">To illustrate this, the following table shows the functions that would be invoked by the client and server components of an application, where the client is responsible for initiating a graceful shutdown.</span></span>

| <span data-ttu-id="d6bf4-129">En el cliente</span><span class="sxs-lookup"><span data-stu-id="d6bf4-129">Client side</span></span>                                                                                                                | <span data-ttu-id="d6bf4-130">En el servidor</span><span class="sxs-lookup"><span data-stu-id="d6bf4-130">Server side</span></span>                                                                                           |
|----------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="d6bf4-131">(1) invoca [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD \_ send) para señalar el final de la sesión y ese cliente no tiene más datos para enviar.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-131">(1) Invokes [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD\_SEND) to signal end of session and that client has no more data to send.</span></span> |                                                                                                       |
|                                                                                                                            | <span data-ttu-id="d6bf4-132">(2) recibe FD \_ Close, lo que indica un cierre correcto en curso y que se han recibido todos los datos.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-132">(2) Receives FD\_CLOSE, indicating graceful shutdown in progress and that all data has been received.</span></span> |
|                                                                                                                            | <span data-ttu-id="d6bf4-133">(3) envía los datos de respuesta restantes.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-133">(3) Sends any remaining response data.</span></span>                                                                |
| <span data-ttu-id="d6bf4-134">(solo significado de sincronización local) Obtiene FD \_ Read y llama a [**RECV**](/windows/desktop/api/winsock/nf-winsock-recv) para obtener los datos de respuesta enviados por el servidor.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-134">(local timing significance only) Gets FD\_READ and calls [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) to get any response data sent by server .</span></span>  | <span data-ttu-id="d6bf4-135">(4) invoca [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD \_ send) para indicar que el servidor no tiene más datos para enviar.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-135">(4) Invokes [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD\_SEND) to indicate server has no more data to send.</span></span>  |
| <span data-ttu-id="d6bf4-136">(5) recibe la \_ indicación FD de cierre.</span><span class="sxs-lookup"><span data-stu-id="d6bf4-136">(5) Receives FD\_CLOSE indication.</span></span>                                                                                         | <span data-ttu-id="d6bf4-137">(solo significado de sincronización local) Invoca [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) .</span><span class="sxs-lookup"><span data-stu-id="d6bf4-137">(local timing significance only) Invokes [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) .</span></span>                       |
| <span data-ttu-id="d6bf4-138">(6) invoca [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="d6bf4-138">(6) Invokes [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                          |                                                                                                       |



 

 

 



