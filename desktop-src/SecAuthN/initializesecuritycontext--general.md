---
description: Inicia el lado cliente, el contexto de [*seguridad*](../secgloss/s-gly.md) de salida de un identificador de credencial.
ms.assetid: 21d965d4-3c03-4e29-a70d-4538c5c366b0
title: Función InitializeSecurityContext (General, Sspi.h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: bc96fe74202f1380d2d85946a373f176e14dfd6d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104361214"
---
# <a name="initializesecuritycontext-general-function"></a><span data-ttu-id="a576e-103">InitializeSecurityContext (general), función</span><span class="sxs-lookup"><span data-stu-id="a576e-103">InitializeSecurityContext (General) function</span></span>

<span data-ttu-id="a576e-104">La función **InitializeSecurityContext (general)** inicia el lado cliente, el contexto de [*seguridad*](../secgloss/s-gly.md) de salida de un identificador de credencial.</span><span class="sxs-lookup"><span data-stu-id="a576e-104">The **InitializeSecurityContext (General)** function initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle.</span></span> <span data-ttu-id="a576e-105">La función se usa para crear un [*contexto de seguridad*](../secgloss/s-gly.md) entre la aplicación cliente y un elemento remoto del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="a576e-105">The function is used to build a [*security context*](../secgloss/s-gly.md) between the client application and a remote peer.</span></span> <span data-ttu-id="a576e-106">**InitializeSecurityContext (general)** devuelve un token que el cliente debe pasar al elemento remoto del mismo nivel, que, a su vez, envía a la implementación de seguridad local a través de la llamada a [**AcceptSecurityContext (general)**](acceptsecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-106">**InitializeSecurityContext (General)** returns a token that the client must pass to the remote peer, which the peer in turn submits to the local security implementation through the [**AcceptSecurityContext (General)**](acceptsecuritycontext--general.md) call.</span></span> <span data-ttu-id="a576e-107">El token generado debe considerarse opaco por todos los llamadores.</span><span class="sxs-lookup"><span data-stu-id="a576e-107">The token generated should be considered opaque by all callers.</span></span>

<span data-ttu-id="a576e-108">Normalmente, se llama a la función **InitializeSecurityContext (general)** en un bucle hasta que se establece un [*contexto de seguridad*](../secgloss/s-gly.md) suficiente.</span><span class="sxs-lookup"><span data-stu-id="a576e-108">Typically, the **InitializeSecurityContext (General)** function is called in a loop until a sufficient [*security context*](../secgloss/s-gly.md) is established.</span></span>

<span data-ttu-id="a576e-109">Para obtener información sobre el uso de esta función con un [*proveedor de compatibilidad de seguridad*](../secgloss/s-gly.md) (SSP) específico, vea los temas siguientes.</span><span class="sxs-lookup"><span data-stu-id="a576e-109">For information about using this function with a specific [*security support provider*](../secgloss/s-gly.md) (SSP), see the following topics.</span></span>



| <span data-ttu-id="a576e-110">Tema</span><span class="sxs-lookup"><span data-stu-id="a576e-110">Topic</span></span>                                                                                  | <span data-ttu-id="a576e-111">Descripción</span><span class="sxs-lookup"><span data-stu-id="a576e-111">Description</span></span>                                                                                                                                |
|----------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="a576e-112">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="a576e-112">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)     | <span data-ttu-id="a576e-113">Inicia el lado cliente, el contexto de [*seguridad*](../secgloss/s-gly.md) de salida de un identificador de credencial mediante el [*paquete de seguridad*](../secgloss/s-gly.md)del proveedor de compatibilidad para seguridad de credenciales (CredSSP).</span><span class="sxs-lookup"><span data-stu-id="a576e-113">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Credential Security Support Provider (CredSSP) [*security package*](../secgloss/s-gly.md).</span></span>  
| [<span data-ttu-id="a576e-114">**InitializeSecurityContext (Resumen)**</span><span class="sxs-lookup"><span data-stu-id="a576e-114">**InitializeSecurityContext (Digest)**</span></span>](initializesecuritycontext--digest.md)       | <span data-ttu-id="a576e-115">Inicia el [*contexto de seguridad*](../secgloss/s-gly.md) de salida del lado cliente desde un identificador de credencial mediante el [*paquete de seguridad*](../secgloss/s-gly.md)de síntesis.</span><span class="sxs-lookup"><span data-stu-id="a576e-115">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Digest [*security package*](../secgloss/s-gly.md).</span></span>                        |
| [<span data-ttu-id="a576e-116">**InitializeSecurityContext (Kerberos)**</span><span class="sxs-lookup"><span data-stu-id="a576e-116">**InitializeSecurityContext (Kerberos)**</span></span>](initializesecuritycontext--kerberos.md)   | <span data-ttu-id="a576e-117">Inicia el [*contexto de seguridad*](../secgloss/s-gly.md) de salida del lado cliente desde un identificador de credencial mediante el [*paquete de seguridad*](../secgloss/s-gly.md)de Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a576e-117">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Kerberos [*security package*](../secgloss/s-gly.md).</span></span>                      |
| [<span data-ttu-id="a576e-118">**InitializeSecurityContext (negociar)**</span><span class="sxs-lookup"><span data-stu-id="a576e-118">**InitializeSecurityContext (Negotiate)**</span></span>](initializesecuritycontext--negotiate.md) | <span data-ttu-id="a576e-119">Inicia el [*contexto de seguridad*](../secgloss/s-gly.md) de salida del lado cliente desde un identificador de credencial mediante el [*paquete de seguridad*](../secgloss/s-gly.md)Negotiate.</span><span class="sxs-lookup"><span data-stu-id="a576e-119">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Negotiate [*security package*](../secgloss/s-gly.md).</span></span>                     |
| [<span data-ttu-id="a576e-120">**InitializeSecurityContext (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="a576e-120">**InitializeSecurityContext (NTLM)**</span></span>](initializesecuritycontext--ntlm.md)           | <span data-ttu-id="a576e-121">Inicia el [*contexto de seguridad*](../secgloss/s-gly.md) de salida del lado cliente desde un identificador de credencial mediante el [*paquete de seguridad*](../secgloss/s-gly.md)de NTLM.</span><span class="sxs-lookup"><span data-stu-id="a576e-121">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the NTLM [*security package*](../secgloss/s-gly.md).</span></span>                          |
| [<span data-ttu-id="a576e-122">**InitializeSecurityContext (Schannel)**</span><span class="sxs-lookup"><span data-stu-id="a576e-122">**InitializeSecurityContext (Schannel)**</span></span>](initializesecuritycontext--schannel.md)   | <span data-ttu-id="a576e-123">Inicia el [*contexto de seguridad*](../secgloss/s-gly.md) de salida del lado cliente desde un identificador de credencial mediante el [*paquete de seguridad*](../secgloss/s-gly.md)Schannel.</span><span class="sxs-lookup"><span data-stu-id="a576e-123">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Schannel [*security package*](../secgloss/s-gly.md).</span></span>                      |



 

## <a name="syntax"></a><span data-ttu-id="a576e-124">Sintaxis</span><span class="sxs-lookup"><span data-stu-id="a576e-124">Syntax</span></span>


```C++
SECURITY_STATUS SEC_Entry InitializeSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    SEC_CHAR       *pszTargetName,
  _In_        ULONG          fContextReq,
  _In_        ULONG          Reserved1,
  _In_        ULONG          TargetDataRep,
  _In_opt_    PSecBufferDesc pInput,
  _In_        ULONG          Reserved2,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       PULONG         pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a><span data-ttu-id="a576e-125">Parámetros</span><span class="sxs-lookup"><span data-stu-id="a576e-125">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="a576e-126">*phCredential* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-126">*phCredential* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-127">Identificador de las credenciales devueltas por [**AcquireCredentialsHandle (general)**](acquirecredentialshandle--general.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-127">A handle to the credentials returned by [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md).</span></span> <span data-ttu-id="a576e-128">Este identificador se utiliza para compilar el [*contexto de seguridad*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-128">This handle is used to build the [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="a576e-129">La función **InitializeSecurityContext (general)** requiere al menos credenciales de salida.</span><span class="sxs-lookup"><span data-stu-id="a576e-129">The **InitializeSecurityContext (General)** function requires at least OUTBOUND credentials.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-130">*phContext* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-130">*phContext* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-131">Puntero a una estructura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-131">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="a576e-132">En la primera llamada a **InitializeSecurityContext (general)**, este puntero es **null**.</span><span class="sxs-lookup"><span data-stu-id="a576e-132">On the first call to **InitializeSecurityContext (General)**, this pointer is **NULL**.</span></span> <span data-ttu-id="a576e-133">En la segunda llamada, este parámetro es un puntero al identificador para el contexto parcialmente formado devuelto en el parámetro *phNewContext* por la primera llamada a.</span><span class="sxs-lookup"><span data-stu-id="a576e-133">On the second call, this parameter is a pointer to the handle to the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="a576e-134">Este parámetro es opcional con el Microsoft Digest SSP y se puede establecer en **null**.</span><span class="sxs-lookup"><span data-stu-id="a576e-134">This parameter is optional with the Microsoft Digest SSP and can be set to **NULL**.</span></span>

<span data-ttu-id="a576e-135">Al usar Schannel SSP, en la primera llamada a **InitializeSecurityContext (general)**, especifique **null**.</span><span class="sxs-lookup"><span data-stu-id="a576e-135">When using the Schannel SSP, on the first call to **InitializeSecurityContext (General)**, specify **NULL**.</span></span> <span data-ttu-id="a576e-136">En futuras llamadas, especifique el token recibido en el parámetro *phNewContext* después de la primera llamada a esta función.</span><span class="sxs-lookup"><span data-stu-id="a576e-136">On future calls, specify the token received in the *phNewContext* parameter after the first call to this function.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-137">*pTargetName* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-137">*pTargetName* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-138">Puntero a una cadena terminada en null que indica el destino del contexto.</span><span class="sxs-lookup"><span data-stu-id="a576e-138">A pointer to a null-terminated string that indicates the target of the context.</span></span> <span data-ttu-id="a576e-139">El contenido de la cadena es específico del [*paquete de seguridad*](../secgloss/s-gly.md) , tal y como se describe en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="a576e-139">The string contents are [*security package*](../secgloss/s-gly.md) specific, as described in the following table.</span></span> <span data-ttu-id="a576e-140">Esta lista no es exhaustiva.</span><span class="sxs-lookup"><span data-stu-id="a576e-140">This list is not exhaustive.</span></span> <span data-ttu-id="a576e-141">Se pueden agregar a un sistema SSP de sistema adicionales y SSP de terceros.</span><span class="sxs-lookup"><span data-stu-id="a576e-141">Additional system SSPs and third party SSPs can be added to a system.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="a576e-142">SSP en uso</span><span class="sxs-lookup"><span data-stu-id="a576e-142">SSP in use</span></span></th><th><span data-ttu-id="a576e-143">Significado</span><span class="sxs-lookup"><span data-stu-id="a576e-143">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="Digest"></span><span id="digest"></span><span id="DIGEST"></span><dl> <span data-ttu-id="a576e-144"><dt><strong>Resumen</strong></dt> de <dt></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-144"><dt><strong>Digest</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="a576e-145">Cadena terminada en null que identifica de forma única el URI del recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="a576e-145">Null-terminated string that uniquely identifies the URI of the requested resource.</span></span> <span data-ttu-id="a576e-146">La cadena debe estar formada por caracteres que se permiten en un URI y deben ser representables por el conjunto de código ASCII de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="a576e-146">The string must be composed of characters that are allowed in a URI and must be representable by the US ASCII code set.</span></span> <span data-ttu-id="a576e-147">La codificación de porcentaje puede usarse para representar caracteres fuera del conjunto de código ASCII de EE. UU.</span><span class="sxs-lookup"><span data-stu-id="a576e-147">Percent encoding can be used to represent characters outside the US ASCII code set.</span></span><br/></td></tr><tr class="even"><td><span id="Kerberos_or_Negotiate"></span><span id="kerberos_or_negotiate"></span><span id="KERBEROS_OR_NEGOTIATE"></span><dl> <span data-ttu-id="a576e-148"><dt><strong>Kerberos o Negotiate</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-148"><dt><strong>Kerberos or Negotiate</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="a576e-149">Nombre principal de servicio (SPN) o el [*contexto de seguridad*](../secgloss/s-gly.md) del servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="a576e-149">Service principal name (SPN) or the [*security context*](../secgloss/s-gly.md) of the destination server.</span></span><br/></td></tr><tr class="odd"><td><span id="NTLM"></span><span id="ntlm"></span><dl> <span data-ttu-id="a576e-150"><dt><strong>NTLM</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-150"><dt><strong>NTLM</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="a576e-151">Nombre principal de servicio (SPN) o el [*contexto de seguridad*](../secgloss/s-gly.md) del servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="a576e-151">Service principal name (SPN) or the [*security context*](../secgloss/s-gly.md) of the destination server.</span></span><br/></td></tr><tr class="even"><td><span id="Schannel_SSL"></span><span id="schannel_ssl"></span><span id="SCHANNEL_SSL"></span><dl> <span data-ttu-id="a576e-152"><dt><strong>Schannel/SSL</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-152"><dt><strong>Schannel/SSL</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="a576e-153">Cadena terminada en null que identifica de forma única el servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="a576e-153">Null-terminated string that uniquely identifies the target server.</span></span> <span data-ttu-id="a576e-154">Schannel usa este valor para comprobar el certificado del servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-154">Schannel uses this value to verify the server certificate.</span></span> <span data-ttu-id="a576e-155">Schannel también usa este valor para buscar la sesión en la memoria caché de la sesión al volver a establecer una conexión.</span><span class="sxs-lookup"><span data-stu-id="a576e-155">Schannel also uses this value to locate the session in the session cache when reestablishing a connection.</span></span> <span data-ttu-id="a576e-156">La sesión almacenada en caché solo se utiliza si se cumplen todas las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="a576e-156">The cached session is used only if all of the following conditions are met:</span></span><ul><li><span data-ttu-id="a576e-157">El nombre de destino es el mismo.</span><span class="sxs-lookup"><span data-stu-id="a576e-157">The target name is the same.</span></span></li><li><span data-ttu-id="a576e-158">La entrada de caché no ha expirado.</span><span class="sxs-lookup"><span data-stu-id="a576e-158">The cache entry has not expired.</span></span></li><li><span data-ttu-id="a576e-159">El proceso de aplicación que llama a la función es el mismo.</span><span class="sxs-lookup"><span data-stu-id="a576e-159">The application process that calls the function is the same.</span></span></li><li><span data-ttu-id="a576e-160">La sesión de inicio de sesión es la misma.</span><span class="sxs-lookup"><span data-stu-id="a576e-160">The logon session is the same.</span></span></li><li><span data-ttu-id="a576e-161">El identificador de la credencial es el mismo.</span><span class="sxs-lookup"><span data-stu-id="a576e-161">The credential handle is the same.</span></span></li></ul><br/></td></tr></tbody></table>



 

</dd> <dt>

<span data-ttu-id="a576e-162">*fContextReq* \[ de\]</span><span class="sxs-lookup"><span data-stu-id="a576e-162">*fContextReq* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-163">Marcas de bits que indican las solicitudes para el contexto.</span><span class="sxs-lookup"><span data-stu-id="a576e-163">Bit flags that indicate requests for the context.</span></span> <span data-ttu-id="a576e-164">No todos los paquetes pueden admitir todos los requisitos.</span><span class="sxs-lookup"><span data-stu-id="a576e-164">Not all packages can support all requirements.</span></span> <span data-ttu-id="a576e-165">Las marcas usadas para este parámetro llevan el prefijo de ISC \_ req \_ , por ejemplo, el delegado de REQ de ISC \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="a576e-165">Flags used for this parameter are prefixed with ISC\_REQ\_, for example, ISC\_REQ\_DELEGATE.</span></span> <span data-ttu-id="a576e-166">Este parámetro puede ser uno o varios de los siguientes marcadores de atributos.</span><span class="sxs-lookup"><span data-stu-id="a576e-166">This parameter can be one or more of the following attributes flags.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="a576e-167">Value</span><span class="sxs-lookup"><span data-stu-id="a576e-167">Value</span></span></th><th><span data-ttu-id="a576e-168">Significado</span><span class="sxs-lookup"><span data-stu-id="a576e-168">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="ISC_REQ_ALLOCATE_MEMORY"></span><span id="isc_req_allocate_memory"></span><dl> <span data-ttu-id="a576e-169"><dt><strong>ISC_REQ_ALLOCATE_MEMORY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-169"><dt><strong>ISC_REQ_ALLOCATE_MEMORY</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-170">El [*paquete de seguridad*](../secgloss/s-gly.md) asigna los búferes de salida.</span><span class="sxs-lookup"><span data-stu-id="a576e-170">The [*security package*](../secgloss/s-gly.md) allocates output buffers for you.</span></span> <span data-ttu-id="a576e-171">Cuando haya terminado de usar los búferes de salida, liberelos mediante una llamada a la función [<strong>FreeContextBuffer</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-freecontextbuffer).</span><span class="sxs-lookup"><span data-stu-id="a576e-171">When you have finished using the output buffers, free them by calling the [<strong>FreeContextBuffer</strong>](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_CONFIDENTIALITY"></span><span id="isc_req_confidentiality"></span><dl> <span data-ttu-id="a576e-172"><dt><strong>ISC_REQ_CONFIDENTIALITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-172"><dt><strong>ISC_REQ_CONFIDENTIALITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-173">Cifre los mensajes mediante la función [<strong>EncryptMessage</strong>] (encryptmessage--general.MD).</span><span class="sxs-lookup"><span data-stu-id="a576e-173">Encrypt messages by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) function.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_CONNECTION"></span><span id="isc_req_connection"></span><dl> <span data-ttu-id="a576e-174"><dt><strong>ISC_REQ_CONNECTION</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-174"><dt><strong>ISC_REQ_CONNECTION</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-175">El [*contexto de seguridad*](../secgloss/s-gly.md) no controlará los mensajes de formato.</span><span class="sxs-lookup"><span data-stu-id="a576e-175">The [*security context*](../secgloss/s-gly.md) will not handle formatting messages.</span></span> <span data-ttu-id="a576e-176">Este valor es el predeterminado para la [*delegación restringida*](../secgloss/s-gly.md)de Kerberos, Negotiate y NTLM.</span><span class="sxs-lookup"><span data-stu-id="a576e-176">This value is the default for the Kerberos, Negotiate, and NTLM [*constrained delegation*](../secgloss/s-gly.md)s.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_DELEGATE"></span><span id="isc_req_delegate"></span><dl> <span data-ttu-id="a576e-177"><dt><strong>ISC_REQ_DELEGATE</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-177"><dt><strong>ISC_REQ_DELEGATE</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-178">El servidor puede usar el contexto para autenticarse en otros servidores como cliente.</span><span class="sxs-lookup"><span data-stu-id="a576e-178">The server can use the context to authenticate to other servers as the client.</span></span> <span data-ttu-id="a576e-179">Se debe establecer la marca de ISC_REQ_MUTUAL_AUTH para que esta marca funcione.</span><span class="sxs-lookup"><span data-stu-id="a576e-179">The ISC_REQ_MUTUAL_AUTH flag must be set for this flag to work.</span></span> <span data-ttu-id="a576e-180">Válido para Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a576e-180">Valid for Kerberos.</span></span> <span data-ttu-id="a576e-181">Omita esta marca para la [*delegación restringida*](../secgloss/c-gly.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-181">Ignore this flag for [*constrained delegation*](../secgloss/c-gly.md).</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_EXTENDED_ERROR"></span><span id="isc_req_extended_error"></span><dl> <span data-ttu-id="a576e-182"><dt><strong>ISC_REQ_EXTENDED_ERROR</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-182"><dt><strong>ISC_REQ_EXTENDED_ERROR</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-183">Cuando se produzcan errores, se notificará a la parte remota.</span><span class="sxs-lookup"><span data-stu-id="a576e-183">When errors occur, the remote party will be notified.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_HTTP"></span><span id="isc_req_http"></span><dl> <span data-ttu-id="a576e-184"><dt><strong>ISC_REQ_HTTP</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-184"><dt><strong>ISC_REQ_HTTP</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-185">Usar síntesis para HTTP.</span><span class="sxs-lookup"><span data-stu-id="a576e-185">Use Digest for HTTP.</span></span> <span data-ttu-id="a576e-186">Omita esta marca para usar Digest como mecanismo SASL.</span><span class="sxs-lookup"><span data-stu-id="a576e-186">Omit this flag to use Digest as a SASL mechanism.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_INTEGRITY"></span><span id="isc_req_integrity"></span><dl> <span data-ttu-id="a576e-187"><dt><strong>ISC_REQ_INTEGRITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-187"><dt><strong>ISC_REQ_INTEGRITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-188">Firmar mensajes y comprobar firmas mediante las funciones [<strong>EncryptMessage</strong>] (encryptmessage--general.MD) y [<strong>MakeSignature</strong>] (makesignature.MD).</span><span class="sxs-lookup"><span data-stu-id="a576e-188">Sign messages and verify signatures by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) and [<strong>MakeSignature</strong>](makesignature.md) functions.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_MANUAL_CRED_VALIDATION"></span><span id="isc_req_manual_cred_validation"></span><dl> <span data-ttu-id="a576e-189"><dt><strong>ISC_REQ_MANUAL_CRED_VALIDATION</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-189"><dt><strong>ISC_REQ_MANUAL_CRED_VALIDATION</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-190">Schannel no debe autenticar el servidor automáticamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-190">Schannel must not authenticate the server automatically.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_MUTUAL_AUTH"></span><span id="isc_req_mutual_auth"></span><dl> <span data-ttu-id="a576e-191"><dt><strong>ISC_REQ_MUTUAL_AUTH</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-191"><dt><strong>ISC_REQ_MUTUAL_AUTH</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-192">Se satisfará la Directiva de autenticación mutua del servicio.</span><span class="sxs-lookup"><span data-stu-id="a576e-192">The mutual authentication policy of the service will be satisfied.</span></span><br/><blockquote>[!Caution]<br />
<span data-ttu-id="a576e-193">Esto no significa necesariamente que se realice la autenticación mutua, solo que se cumple la Directiva de autenticación del servicio.</span><span class="sxs-lookup"><span data-stu-id="a576e-193">This does not necessarily mean that mutual authentication is performed, only that the authentication policy of the service is satisfied.</span></span> <span data-ttu-id="a576e-194">Para asegurarse de que se realiza la autenticación mutua, llame a la función [<strong>QueryContextAttributes (general)</strong>] (querycontextattributes--general.MD).</span><span class="sxs-lookup"><span data-stu-id="a576e-194">To ensure that mutual authentication is performed, call the [<strong>QueryContextAttributes (General)</strong>](querycontextattributes--general.md) function.</span></span></blockquote><br/></td></tr><tr class="even"><td><span id="ISC_REQ_NO_INTEGRITY"></span><span id="isc_req_no_integrity"></span><dl> <span data-ttu-id="a576e-195"><dt><strong>ISC_REQ_NO_INTEGRITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-195"><dt><strong>ISC_REQ_NO_INTEGRITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-196">Si se establece esta marca, se omite la marca <strong>ISC_REQ_INTEGRITY</strong> .</span><span class="sxs-lookup"><span data-stu-id="a576e-196">If this flag is set, the <strong>ISC_REQ_INTEGRITY</strong> flag is ignored.</span></span><br/> <span data-ttu-id="a576e-197">Este valor solo es compatible con la [*delegación restringida*](../secgloss/s-gly.md)de Kerberos y Negotiate.</span><span class="sxs-lookup"><span data-stu-id="a576e-197">This value is supported only by the Negotiate and Kerberos [*constrained delegation*](../secgloss/s-gly.md)s.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_REPLAY_DETECT"></span><span id="isc_req_replay_detect"></span><dl> <span data-ttu-id="a576e-198"><dt><strong>ISC_REQ_REPLAY_DETECT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-198"><dt><strong>ISC_REQ_REPLAY_DETECT</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-199">Detectar los mensajes reproducidos que se han codificado mediante las funciones [<strong>EncryptMessage</strong>] (encryptmessage--general.MD) o [<strong>MakeSignature</strong>] (makesignature.MD).</span><span class="sxs-lookup"><span data-stu-id="a576e-199">Detect replayed messages that have been encoded by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) or [<strong>MakeSignature</strong>](makesignature.md) functions.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_SEQUENCE_DETECT"></span><span id="isc_req_sequence_detect"></span><dl> <span data-ttu-id="a576e-200"><dt><strong>ISC_REQ_SEQUENCE_DETECT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-200"><dt><strong>ISC_REQ_SEQUENCE_DETECT</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-201">Detecta mensajes recibidos de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="a576e-201">Detect messages received out of sequence.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_STREAM"></span><span id="isc_req_stream"></span><dl> <span data-ttu-id="a576e-202"><dt><strong>ISC_REQ_STREAM</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-202"><dt><strong>ISC_REQ_STREAM</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-203">Admitir una conexión orientada a flujos.</span><span class="sxs-lookup"><span data-stu-id="a576e-203">Support a stream-oriented connection.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_USE_SESSION_KEY"></span><span id="isc_req_use_session_key"></span><dl> <span data-ttu-id="a576e-204"><dt><strong>ISC_REQ_USE_SESSION_KEY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-204"><dt><strong>ISC_REQ_USE_SESSION_KEY</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-205">Se debe negociar una nueva [*clave de sesión*](../secgloss/s-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-205">A new [*session key*](../secgloss/s-gly.md) must be negotiated.</span></span><br/> <span data-ttu-id="a576e-206">Este valor solo es compatible con la [*delegación restringida*](../secgloss/s-gly.md)de Kerberos.</span><span class="sxs-lookup"><span data-stu-id="a576e-206">This value is supported only by the Kerberos [*constrained delegation*](../secgloss/s-gly.md).</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_USE_SUPPLIED_CREDS"></span><span id="isc_req_use_supplied_creds"></span><dl> <span data-ttu-id="a576e-207"><dt><strong>ISC_REQ_USE_SUPPLIED_CREDS</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="a576e-207"><dt><strong>ISC_REQ_USE_SUPPLIED_CREDS</strong></dt> </span></span></dl></td><td><span data-ttu-id="a576e-208">Schannel no debe intentar proporcionar credenciales para el cliente automáticamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-208">Schannel must not attempt to supply credentials for the client automatically.</span></span><br/></td></tr></tbody></table>



 

<span data-ttu-id="a576e-209">Es posible que el cliente no admita los atributos solicitados.</span><span class="sxs-lookup"><span data-stu-id="a576e-209">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="a576e-210">Para obtener más información, consulte el parámetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="a576e-210">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="a576e-211">Para obtener más descripciones de los distintos atributos, vea [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-211">For further descriptions of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

</dd> <dt>

<span data-ttu-id="a576e-212">*Reserved1* \[ de\]</span><span class="sxs-lookup"><span data-stu-id="a576e-212">*Reserved1* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-213">Este parámetro está reservado y debe establecerse en cero.</span><span class="sxs-lookup"><span data-stu-id="a576e-213">This parameter is reserved and must be set to zero.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-214">*TargetDataRep* \[ de\]</span><span class="sxs-lookup"><span data-stu-id="a576e-214">*TargetDataRep* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-215">Representación de los datos, como el orden de los bytes, en el destino.</span><span class="sxs-lookup"><span data-stu-id="a576e-215">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="a576e-216">Este parámetro puede ser \_ \_ DREP nativo de seguridad o DREP de seguridad de \_ red \_ .</span><span class="sxs-lookup"><span data-stu-id="a576e-216">This parameter can be either SECURITY\_NATIVE\_DREP or SECURITY\_NETWORK\_DREP.</span></span>

<span data-ttu-id="a576e-217">Este parámetro no se utiliza con Digest ni Schannel.</span><span class="sxs-lookup"><span data-stu-id="a576e-217">This parameter is not used with Digest or Schannel.</span></span> <span data-ttu-id="a576e-218">Establézcalo en cero.</span><span class="sxs-lookup"><span data-stu-id="a576e-218">Set it to zero.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-219">*pInput* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-219">*pInput* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-220">Puntero a una estructura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) que contiene punteros a los búferes proporcionados como entrada para el paquete.</span><span class="sxs-lookup"><span data-stu-id="a576e-220">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains pointers to the buffers supplied as input to the package.</span></span> <span data-ttu-id="a576e-221">A menos que el servidor inicie el contexto del cliente, el valor de este parámetro debe ser **null** en la primera llamada a la función.</span><span class="sxs-lookup"><span data-stu-id="a576e-221">Unless the client context was initiated by the server, the value of this parameter must be **NULL** on the first call to the function.</span></span> <span data-ttu-id="a576e-222">En las llamadas subsiguientes a la función o cuando el servidor inició el contexto de cliente, el valor de este parámetro es un puntero a un búfer asignado con suficiente memoria para contener el token devuelto por el equipo remoto.</span><span class="sxs-lookup"><span data-stu-id="a576e-222">On subsequent calls to the function or when the client context was initiated by the server, the value of this parameter is a pointer to a buffer allocated with enough memory to hold the token returned by the remote computer.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-223">*Reserved2* \[ de\]</span><span class="sxs-lookup"><span data-stu-id="a576e-223">*Reserved2* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-224">Este parámetro está reservado y debe establecerse en cero.</span><span class="sxs-lookup"><span data-stu-id="a576e-224">This parameter is reserved and must be set to zero.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-225">*phNewContext* \[ in, out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-225">*phNewContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-226">Puntero a una estructura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-226">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="a576e-227">En la primera llamada a **InitializeSecurityContext (general)**, este puntero recibe el nuevo identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="a576e-227">On the first call to **InitializeSecurityContext (General)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="a576e-228">En la segunda llamada, *phNewContext* puede ser el mismo que el identificador especificado en el parámetro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="a576e-228">On the second call, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="a576e-229">Cuando se usa Schannel SSP, en las llamadas posteriores a la primera llamada, se pasa el identificador que se devuelve aquí como parámetro *phContext* y se especifica **null** para *phNewContext*.</span><span class="sxs-lookup"><span data-stu-id="a576e-229">When using the Schannel SSP, on calls after the first call, pass the handle returned here as the *phContext* parameter and specify **NULL** for *phNewContext*.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-230">*pOutput* \[ in, out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-230">*pOutput* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-231">Puntero a una estructura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) que contiene punteros a la estructura [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) que recibe los datos de salida.</span><span class="sxs-lookup"><span data-stu-id="a576e-231">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains pointers to the [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure that receives the output data.</span></span> <span data-ttu-id="a576e-232">Si se ha escrito un búfer como lectura en segundo/lectura \_ en la entrada, se mostrará en la salida.</span><span class="sxs-lookup"><span data-stu-id="a576e-232">If a buffer was typed as SEC\_READWRITE in the input, it will be there on output.</span></span> <span data-ttu-id="a576e-233">El sistema asignará un búfer para el token de seguridad si se solicita (a través de \_ \_ \_ la solicitud de asignación de memoria de ISC) y rellenará la dirección en el descriptor de búfer para el token de seguridad.</span><span class="sxs-lookup"><span data-stu-id="a576e-233">The system will allocate a buffer for the security token if requested (through ISC\_REQ\_ALLOCATE\_MEMORY) and fill in the address in the buffer descriptor for the security token.</span></span>

<span data-ttu-id="a576e-234">Cuando se usa el Microsoft Digest SSP, este parámetro recibe la respuesta de desafío que se debe enviar al servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-234">When using the Microsoft Digest SSP, this parameter receives the challenge response that must be sent to the server.</span></span>

<span data-ttu-id="a576e-235">Cuando se usa Schannel SSP, si \_ \_ se especifica la marca de memoria de asignación de solicitudes de ISC \_ , el SSP de Schannel asignará memoria para el búfer y colocará la información adecuada en [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc).</span><span class="sxs-lookup"><span data-stu-id="a576e-235">When using the Schannel SSP, if the ISC\_REQ\_ALLOCATE\_MEMORY flag is specified, the Schannel SSP will allocate memory for the buffer and put the appropriate information in the [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc).</span></span> <span data-ttu-id="a576e-236">Además, el llamador debe pasar un búfer de tipo **SECBUFFER \_ Alert**.</span><span class="sxs-lookup"><span data-stu-id="a576e-236">In addition, the caller must pass in a buffer of type **SECBUFFER\_ALERT**.</span></span> <span data-ttu-id="a576e-237">En la salida, si se genera una alerta, este búfer contiene información sobre esa alerta y se produce un error en la función.</span><span class="sxs-lookup"><span data-stu-id="a576e-237">On output, if an alert is generated, this buffer contains information about that alert, and the function fails.</span></span>

</dd> <dt>

<span data-ttu-id="a576e-238">*pfContextAttr* \[ enuncia\]</span><span class="sxs-lookup"><span data-stu-id="a576e-238">*pfContextAttr* \[out\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-239">Puntero a una variable para recibir un conjunto de marcadores de bits que indican los [*atributos*](../secgloss/a-gly.md#_security_attribute_gly) del contexto establecido.</span><span class="sxs-lookup"><span data-stu-id="a576e-239">A pointer to a variable to receive a set of bit flags that indicate the [*attributes*](../secgloss/a-gly.md#_security_attribute_gly) of the established context.</span></span> <span data-ttu-id="a576e-240">Para obtener una descripción de los distintos atributos, vea [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-240">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

<span data-ttu-id="a576e-241">Las marcas usadas para este parámetro llevan el prefijo ISC \_ RET, como el \_ delegado de ISC RET \_ .</span><span class="sxs-lookup"><span data-stu-id="a576e-241">Flags used for this parameter are prefixed with ISC\_RET, such as ISC\_RET\_DELEGATE.</span></span> <span data-ttu-id="a576e-242">Para obtener una lista de valores válidos, vea el parámetro *fContextReq* .</span><span class="sxs-lookup"><span data-stu-id="a576e-242">For a list of valid values, see the *fContextReq* parameter.</span></span>

<span data-ttu-id="a576e-243">No Compruebe los atributos relacionados con la seguridad hasta que la llamada a la función final se devuelva correctamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-243">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="a576e-244">Las marcas de atributo que no están relacionadas con la seguridad, como la marca ASC RET allocated \_ \_ \_ Memory, se pueden comprobar antes de la devolución final.</span><span class="sxs-lookup"><span data-stu-id="a576e-244">Attribute flags that are not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

> [!Note]  
> <span data-ttu-id="a576e-245">Los atributos de contexto concretos pueden cambiar durante la negociación con un elemento remoto del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="a576e-245">Particular context attributes can change during negotiation with a remote peer.</span></span>

 

</dd> <dt>

<span data-ttu-id="a576e-246">*ptsExpiry* \[ out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="a576e-246">*ptsExpiry* \[out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="a576e-247">Puntero a una estructura de [**marca**](timestamp.md) de tiempo que recibe la hora de expiración del contexto.</span><span class="sxs-lookup"><span data-stu-id="a576e-247">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="a576e-248">Se recomienda que el [*paquete de seguridad*](../secgloss/s-gly.md) devuelva siempre este valor en la hora local.</span><span class="sxs-lookup"><span data-stu-id="a576e-248">It is recommended that the [*security package*](../secgloss/s-gly.md) always return this value in local time.</span></span> <span data-ttu-id="a576e-249">Este parámetro es opcional y se debe pasar **null** para los clientes de corta duración.</span><span class="sxs-lookup"><span data-stu-id="a576e-249">This parameter is optional and **NULL** should be passed for short-lived clients.</span></span>

<span data-ttu-id="a576e-250">No hay ningún tiempo de expiración para las credenciales o el [*contexto de seguridad*](../secgloss/s-gly.md)de SSP de Microsoft Digest.</span><span class="sxs-lookup"><span data-stu-id="a576e-250">There is no expiration time for Microsoft Digest SSP [*security context*](../secgloss/s-gly.md)s or credentials.</span></span>

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="a576e-251">Valor devuelto</span><span class="sxs-lookup"><span data-stu-id="a576e-251">Return value</span></span>

<span data-ttu-id="a576e-252">Si la función se ejecuta correctamente, la función devuelve uno de los siguientes códigos de éxito.</span><span class="sxs-lookup"><span data-stu-id="a576e-252">If the function succeeds, the function returns one of the following success codes.</span></span>



| <span data-ttu-id="a576e-253">Código devuelto</span><span class="sxs-lookup"><span data-stu-id="a576e-253">Return code</span></span>                                                                                                    | <span data-ttu-id="a576e-254">Descripción</span><span class="sxs-lookup"><span data-stu-id="a576e-254">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <span data-ttu-id="a576e-255"><dt>**s \_ \_ finalización \_ y \_ continuación**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-255"><dt>**SEC\_I\_COMPLETE\_AND\_CONTINUE**</dt></span></span> </dl> | <span data-ttu-id="a576e-256">El cliente debe llamar a [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) y, a continuación, pasar la salida al servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-256">The client must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and then pass the output to the server.</span></span> <span data-ttu-id="a576e-257">Después, el cliente espera un token devuelto y lo pasa, en otra llamada, a [**InitializeSecurityContext (general)**](initializesecuritycontext--general.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-257">The client then waits for a returned token and passes it, in another call, to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span><br/>                                                                                                                                                                                                                                                                                     |
| <dl> <span data-ttu-id="a576e-258"><dt>**s \_ \_ finalización \_ necesaria**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-258"><dt>**SEC\_I\_COMPLETE\_NEEDED**</dt></span></span> </dl>        | <span data-ttu-id="a576e-259">El cliente debe terminar de compilar el mensaje y, a continuación, llamar a la función [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) .</span><span class="sxs-lookup"><span data-stu-id="a576e-259">The client must finish building the message and then call the [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <dl> <span data-ttu-id="a576e-260"><dt>**s \_ \_ \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-260"><dt>**SEC\_I\_CONTINUE\_NEEDED**</dt></span></span> </dl>        | <span data-ttu-id="a576e-261">El cliente debe enviar el token de salida al servidor y esperar a que se devuelva un token.</span><span class="sxs-lookup"><span data-stu-id="a576e-261">The client must send the output token to the server and wait for a return token.</span></span> <span data-ttu-id="a576e-262">Después, el token devuelto se pasa en otra llamada a [**InitializeSecurityContext (general)**](initializesecuritycontext--general.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-262">The returned token is then passed in another call to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span> <span data-ttu-id="a576e-263">El token de salida puede estar vacío.</span><span class="sxs-lookup"><span data-stu-id="a576e-263">The output token can be empty.</span></span><br/>                                                                                                                                                                                                                                                                                                          |
| <dl> <span data-ttu-id="a576e-264"><dt>**s \_ I \_ credenciales incompletas \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-264"><dt>**SEC\_I\_INCOMPLETE\_CREDENTIALS**</dt></span></span> </dl> | <span data-ttu-id="a576e-265">Use con Schannel.</span><span class="sxs-lookup"><span data-stu-id="a576e-265">Use with Schannel.</span></span> <span data-ttu-id="a576e-266">El servidor solicitó la autenticación del cliente y las credenciales proporcionadas no incluyen un certificado o el certificado no fue emitido por una entidad de certificación que sea de confianza para el servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-266">The server has requested client authentication, and the supplied credentials either do not include a certificate or the certificate was not issued by a certification authority that is trusted by the server.</span></span> <span data-ttu-id="a576e-267">Para obtener más información, vea la sección Comentarios.</span><span class="sxs-lookup"><span data-stu-id="a576e-267">For more information, see Remarks.</span></span><br/>                                                                                                                                                                                              |
| <dl> <span data-ttu-id="a576e-268"><dt>**s \_ E \_ mensaje incompleto \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-268"><dt>**SEC\_E\_INCOMPLETE\_MESSAGE**</dt></span></span> </dl>     | <span data-ttu-id="a576e-269">Use con Schannel.</span><span class="sxs-lookup"><span data-stu-id="a576e-269">Use with Schannel.</span></span> <span data-ttu-id="a576e-270">Los datos de todo el mensaje no se leyeron desde la conexión.</span><span class="sxs-lookup"><span data-stu-id="a576e-270">Data for the whole message was not read from the wire.</span></span><br/> <span data-ttu-id="a576e-271">Cuando se devuelve este valor, el búfer *pInput* contiene una estructura [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) con un miembro **BufferType** de **SecBuffer \_ que falta**.</span><span class="sxs-lookup"><span data-stu-id="a576e-271">When this value is returned, the *pInput* buffer contains a [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure with a **BufferType** member of **SECBUFFER\_MISSING**.</span></span> <span data-ttu-id="a576e-272">El miembro **cbBuffer** de **SecBuffer** contiene un valor que indica el número de bytes adicionales que la función debe leer del cliente antes de que esta función se ejecute correctamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-272">The **cbBuffer** member of **SecBuffer** contains a value that indicates the number of additional bytes that the function must read from the client before this function succeeds.</span></span> <span data-ttu-id="a576e-273">Aunque este número no siempre es preciso, su uso puede ayudar a mejorar el rendimiento al evitar varias llamadas a esta función.</span><span class="sxs-lookup"><span data-stu-id="a576e-273">While this number is not always accurate, using it can help improve performance by avoiding multiple calls to this function.</span></span><br/> |
| <dl> <span data-ttu-id="a576e-274"><dt>**s \_ E \_ Aceptar**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-274"><dt>**SEC\_E\_OK**</dt></span></span> </dl>                      | <span data-ttu-id="a576e-275">El [*contexto de seguridad*](../secgloss/s-gly.md) se inicializó correctamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-275">The [*security context*](../secgloss/s-gly.md) was successfully initialized.</span></span> <span data-ttu-id="a576e-276">No es necesario otra llamada [**InitializeSecurityContext (general)**](initializesecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-276">There is no need for another [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) call.</span></span> <span data-ttu-id="a576e-277">Si la función devuelve un token de salida, es decir, si el \_ token de SECBUFFER en *pOutput* tiene una longitud distinto de cero, ese token se debe enviar al servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-277">If the function returns an output token, that is, if the SECBUFFER\_TOKEN in *pOutput* is of nonzero length, that token must be sent to the server.</span></span><br/>                                                                                                                                                    |



 

<span data-ttu-id="a576e-278">Si se produce un error en la función, la función devuelve uno de los siguientes códigos de error.</span><span class="sxs-lookup"><span data-stu-id="a576e-278">If the function fails, the function returns one of the following error codes.</span></span>



| <span data-ttu-id="a576e-279">Código devuelto</span><span class="sxs-lookup"><span data-stu-id="a576e-279">Return code</span></span>                                                                                                          | <span data-ttu-id="a576e-280">Descripción</span><span class="sxs-lookup"><span data-stu-id="a576e-280">Description</span></span>                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <span data-ttu-id="a576e-281"><dt>**s \_ E \_ memoria insuficiente \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-281"><dt>**SEC\_E\_INSUFFICIENT\_MEMORY**</dt></span></span> </dl>          | <span data-ttu-id="a576e-282">No hay suficiente memoria disponible para completar la acción solicitada.</span><span class="sxs-lookup"><span data-stu-id="a576e-282">There is not enough memory available to complete the requested action.</span></span><br/>                                                                                                                                                                                                                   |
| <dl> <span data-ttu-id="a576e-283"><dt>**s \_ E \_ interno \_ error**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-283"><dt>**SEC\_E\_INTERNAL\_ERROR**</dt></span></span> </dl>               | <span data-ttu-id="a576e-284">Error que no se ha asignado a un código de error SSPI.</span><span class="sxs-lookup"><span data-stu-id="a576e-284">An error occurred that did not map to an SSPI error code.</span></span><br/>                                                                                                                                                                                                                                |
| <dl> <span data-ttu-id="a576e-285"><dt>**s \_ E \_ identificador no válido \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-285"><dt>**SEC\_E\_INVALID\_HANDLE**</dt></span></span> </dl>               | <span data-ttu-id="a576e-286">El identificador pasado a la función no es válido.</span><span class="sxs-lookup"><span data-stu-id="a576e-286">The handle passed to the function is not valid.</span></span><br/>                                                                                                                                                                                                                                          |
| <dl> <span data-ttu-id="a576e-287"><dt>**s \_ E \_ token no válido \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-287"><dt>**SEC\_E\_INVALID\_TOKEN**</dt></span></span> </dl>                | <span data-ttu-id="a576e-288">El error se debe a un token de entrada mal formado, como un token dañado en tránsito, un token de tamaño incorrecto o un token pasado al [*paquete de seguridad*](../secgloss/s-gly.md)equivocado.</span><span class="sxs-lookup"><span data-stu-id="a576e-288">The error is due to a malformed input token, such as a token corrupted in transit, a token of incorrect size, or a token passed into the wrong [*security package*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="a576e-289">El paso de un token al paquete equivocado puede producirse si el cliente y el servidor no negociaron el [*paquete de seguridad*](../secgloss/s-gly.md)adecuado.</span><span class="sxs-lookup"><span data-stu-id="a576e-289">Passing a token to the wrong package can happen if the client and server did not negotiate the proper [*security package*](../secgloss/s-gly.md).</span></span><br/> |
| <dl> <span data-ttu-id="a576e-290"><dt>**s \_ E \_ Inicio de sesión \_ denegado**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-290"><dt>**SEC\_E\_LOGON\_DENIED**</dt></span></span> </dl>                 | <span data-ttu-id="a576e-291">Error de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="a576e-291">The logon failed.</span></span><br/>                                                                                                                                                                                                                                                                        |
| <dl> <span data-ttu-id="a576e-292"><dt>**s \_ E \_ sin \_ entidad de autenticación \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-292"><dt>**SEC\_E\_NO\_AUTHENTICATING\_AUTHORITY**</dt></span></span> </dl> | <span data-ttu-id="a576e-293">No se pudo establecer contacto con ninguna autoridad para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="a576e-293">No authority could be contacted for authentication.</span></span> <span data-ttu-id="a576e-294">El nombre de dominio de la entidad de autenticación podría ser incorrecto, el dominio podría estar inaccesible o podría haber un error de relación de confianza.</span><span class="sxs-lookup"><span data-stu-id="a576e-294">The domain name of the authenticating party could be wrong, the domain could be unreachable, or there might have been a trust relationship failure.</span></span><br/>                                                                                  |
| <dl> <span data-ttu-id="a576e-295"><dt>**s \_ E \_ sin \_ credenciales**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-295"><dt>**SEC\_E\_NO\_CREDENTIALS**</dt></span></span> </dl>               | <span data-ttu-id="a576e-296">No hay credenciales disponibles en el [*paquete de seguridad*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-296">No credentials are available in the [*security package*](../secgloss/s-gly.md).</span></span><br/>                                                                                                                                                  |
| <dl> <span data-ttu-id="a576e-297"><dt>**s \_ E \_ destino \_ desconocido**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-297"><dt>**SEC\_E\_TARGET\_UNKNOWN**</dt></span></span> </dl>               | <span data-ttu-id="a576e-298">No se reconoció el destino.</span><span class="sxs-lookup"><span data-stu-id="a576e-298">The target was not recognized.</span></span><br/>                                                                                                                                                                                                                                                           |
| <dl> <span data-ttu-id="a576e-299"><dt>**SEC \_ E \_ función no admitida \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-299"><dt>**SEC\_E\_UNSUPPORTED\_FUNCTION**</dt></span></span> </dl>         | <span data-ttu-id="a576e-300">Una marca de atributo de contexto que no es válida (el \_ \_ delegado de REQ de ISC o \_ \_ el símbolo del sistema \_ de solicitudes de ISC para \_ las credenciales) se especificó en el parámetro *fContextReq* .</span><span class="sxs-lookup"><span data-stu-id="a576e-300">A context attribute flag that is not valid (ISC\_REQ\_DELEGATE or ISC\_REQ\_PROMPT\_FOR\_CREDS) was specified in the *fContextReq* parameter.</span></span><br/>                                                                                                                                            |
| <dl> <span data-ttu-id="a576e-301"><dt>**s \_ E \_ entidad de seguridad equivocada \_**</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-301"><dt>**SEC\_E\_WRONG\_PRINCIPAL**</dt></span></span> </dl>              | <span data-ttu-id="a576e-302">La entidad de seguridad que recibió la solicitud de autenticación no es la misma que la que se pasa al parámetro *pszTargetName* .</span><span class="sxs-lookup"><span data-stu-id="a576e-302">The principal that received the authentication request is not the same as the one passed into the *pszTargetName* parameter.</span></span> <span data-ttu-id="a576e-303">Esto indica un error en la autenticación mutua.</span><span class="sxs-lookup"><span data-stu-id="a576e-303">This indicates a failure in mutual authentication.</span></span><br/>                                                                                                          |



 

## <a name="remarks"></a><span data-ttu-id="a576e-304">Observaciones</span><span class="sxs-lookup"><span data-stu-id="a576e-304">Remarks</span></span>

<span data-ttu-id="a576e-305">El autor de la llamada es responsable de determinar si los atributos de contexto finales son suficientes.</span><span class="sxs-lookup"><span data-stu-id="a576e-305">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="a576e-306">Si, por ejemplo, se solicitó la confidencialidad, pero no se pudo establecer, algunas aplicaciones pueden optar por cerrar la conexión inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-306">If, for example, confidentiality was requested, but could not be established, some applications may choose to shut down the connection immediately.</span></span>

<span data-ttu-id="a576e-307">Si los atributos del [*contexto de seguridad*](../secgloss/s-gly.md) no son suficientes, el cliente debe liberar el contexto creado parcialmente mediante una llamada a la función [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="a576e-307">If attributes of the [*security context*](../secgloss/s-gly.md) are not sufficient, the client must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span>

<span data-ttu-id="a576e-308">Un cliente utiliza la función **InitializeSecurityContext (general)** para inicializar un contexto de salida.</span><span class="sxs-lookup"><span data-stu-id="a576e-308">The **InitializeSecurityContext (General)** function is used by a client to initialize an outbound context.</span></span>

<span data-ttu-id="a576e-309">Para un [*contexto de seguridad*](../secgloss/s-gly.md)de dos tramos, la secuencia de llamada es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="a576e-309">For a two-leg [*security context*](../secgloss/s-gly.md), the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="a576e-310">El cliente llama a la función con *phContext* establecido en **null** y rellena el descriptor del búfer con el mensaje de entrada.</span><span class="sxs-lookup"><span data-stu-id="a576e-310">The client calls the function with *phContext* set to **NULL** and fills in the buffer descriptor with the input message.</span></span>
2.  <span data-ttu-id="a576e-311">El [*paquete de seguridad*](../secgloss/s-gly.md) examina los parámetros y construye un token opaco, colocándolo en el elemento de token en la matriz de búferes.</span><span class="sxs-lookup"><span data-stu-id="a576e-311">The [*security package*](../secgloss/s-gly.md) examines the parameters and constructs an opaque token, placing it in the TOKEN element in the buffer array.</span></span> <span data-ttu-id="a576e-312">Si el parámetro *fContextReq* incluye la \_ marca ISC req \_ allocate \_ Memory, el [*paquete de seguridad*](../secgloss/s-gly.md) asigna la memoria y devuelve el puntero en el elemento token.</span><span class="sxs-lookup"><span data-stu-id="a576e-312">If the *fContextReq* parameter includes the ISC\_REQ\_ALLOCATE\_MEMORY flag, the [*security package*](../secgloss/s-gly.md) allocates the memory and returns the pointer in the TOKEN element.</span></span>
3.  <span data-ttu-id="a576e-313">El cliente envía el token devuelto en el búfer de *pOutput* al servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="a576e-313">The client sends the token returned in the *pOutput* buffer to the target server.</span></span> <span data-ttu-id="a576e-314">A continuación, el servidor pasa el token como argumento de entrada en una llamada a la función [**AcceptSecurityContext (general)**](acceptsecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-314">The server then passes the token as an input argument in a call to the [**AcceptSecurityContext (General)**](acceptsecuritycontext--general.md) function.</span></span>
4.  <span data-ttu-id="a576e-315">[**AcceptSecurityContext (general)**](acceptsecuritycontext--general.md) puede devolver un token, que el servidor envía al cliente para una segunda llamada a **InitializeSecurityContext (general)** si la primera llamada que se devuelve \_ es que se \_ \_ necesita.</span><span class="sxs-lookup"><span data-stu-id="a576e-315">[**AcceptSecurityContext (General)**](acceptsecuritycontext--general.md) may return a token, which the server sends to the client for a second call to **InitializeSecurityContext (General)** if the first call returned SEC\_I\_CONTINUE\_NEEDED.</span></span>

<span data-ttu-id="a576e-316">En el caso de los [*contextos de seguridad*](../secgloss/s-gly.md)de varios tramos, como la autenticación mutua, la secuencia de llamada es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="a576e-316">For multiple-leg [*security context*](../secgloss/s-gly.md)s, such as mutual authentication, the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="a576e-317">El cliente llama a la función tal y como se describió anteriormente, pero el paquete devuelve el código de éxito de las SEC \_ que sigo \_ siendo \_ necesarios.</span><span class="sxs-lookup"><span data-stu-id="a576e-317">The client calls the function as described earlier, but the package returns the SEC\_I\_CONTINUE\_NEEDED success code.</span></span>
2.  <span data-ttu-id="a576e-318">El cliente envía el token de salida al servidor y espera la respuesta del servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-318">The client sends the output token to the server and waits for the server's reply.</span></span>
3.  <span data-ttu-id="a576e-319">Tras recibir la respuesta del servidor, el cliente llama a **InitializeSecurityContext (general)** de nuevo, con *phContext* establecido en el identificador que se devolvió desde la última llamada.</span><span class="sxs-lookup"><span data-stu-id="a576e-319">Upon receipt of the server's response, the client calls **InitializeSecurityContext (General)** again, with *phContext* set to the handle that was returned from the last call.</span></span> <span data-ttu-id="a576e-320">El token recibido del servidor se proporciona en el parámetro *pInput* .</span><span class="sxs-lookup"><span data-stu-id="a576e-320">The token received from the server is supplied in the *pInput* parameter.</span></span>

<span data-ttu-id="a576e-321">Si el servidor ha respondido correctamente, el [*paquete de seguridad*](../secgloss/s-gly.md) devuelve sec \_ e \_ OK y se establece una sesión segura.</span><span class="sxs-lookup"><span data-stu-id="a576e-321">If the server has successfully responded, the [*security package*](../secgloss/s-gly.md) returns SEC\_E\_OK and a secure session is established.</span></span>

<span data-ttu-id="a576e-322">Si la función devuelve una de las respuestas de error, no se acepta la respuesta del servidor y no se establece la sesión.</span><span class="sxs-lookup"><span data-stu-id="a576e-322">If the function returns one of the error responses, the server's response is not accepted, and the session is not established.</span></span>

<span data-ttu-id="a576e-323">Si la función devuelve los segundos que \_ se \_ necesitan para continuar, \_ \_ \_ es necesario que se complete la segunda vez o se \_ \_ \_ \_ \_ repiten los pasos 2 y 3.</span><span class="sxs-lookup"><span data-stu-id="a576e-323">If the function returns SEC\_I\_CONTINUE\_NEEDED, SEC\_I\_COMPLETE\_NEEDED, or SEC\_I\_COMPLETE\_AND\_CONTINUE, steps 2 and 3 are repeated.</span></span>

<span data-ttu-id="a576e-324">Para inicializar un [*contexto de seguridad*](../secgloss/s-gly.md), es posible que se requiera más de una llamada a esta función, dependiendo del mecanismo de autenticación subyacente, así como de las opciones especificadas en el parámetro *fContextReq* .</span><span class="sxs-lookup"><span data-stu-id="a576e-324">To initialize a [*security context*](../secgloss/s-gly.md), more than one call to this function may be required, depending on the underlying authentication mechanism as well as the choices specified in the *fContextReq* parameter.</span></span>

<span data-ttu-id="a576e-325">Los parámetros *fContextReq* y *pfContextAttributes* son máscaras de texto que representan varios atributos de contexto.</span><span class="sxs-lookup"><span data-stu-id="a576e-325">The *fContextReq* and *pfContextAttributes* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="a576e-326">Para obtener una descripción de los distintos atributos, vea [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="a576e-326">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="a576e-327">El parámetro *pfContextAttributes* es válido en cualquier devolución correcta, pero solo en la devolución correcta final debe examinar las marcas que pertenecen a los aspectos de seguridad del contexto.</span><span class="sxs-lookup"><span data-stu-id="a576e-327">The *pfContextAttributes* parameter is valid on any successful return, but only on the final successful return should you examine the flags that pertain to security aspects of the context.</span></span> <span data-ttu-id="a576e-328">Las devoluciones intermedias se pueden establecer, por ejemplo, la \_ \_ marca de memoria asignada de ISC \_ .</span><span class="sxs-lookup"><span data-stu-id="a576e-328">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="a576e-329">Si \_ \_ \_ se establece la marca de credenciales proporcionadas por el uso de ISC \_ , el [*paquete de seguridad*](../secgloss/s-gly.md) debe buscar un \_ tipo de búfer params de SECBUFFER pkg \_ en el búfer de entrada *pInput* .</span><span class="sxs-lookup"><span data-stu-id="a576e-329">If the ISC\_REQ\_USE\_SUPPLIED\_CREDS flag is set, the [*security package*](../secgloss/s-gly.md) must look for a SECBUFFER\_PKG\_PARAMS buffer type in the *pInput* input buffer.</span></span> <span data-ttu-id="a576e-330">Esta no es una solución genérica, pero permite un fuerte emparejamiento del [*paquete de seguridad*](../secgloss/s-gly.md) y de la aplicación cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="a576e-330">This is not a generic solution, but it allows for a strong pairing of [*security package*](../secgloss/s-gly.md) and application when appropriate.</span></span>

<span data-ttu-id="a576e-331">Si \_ se especificó la solicitud de asignación de memoria de ISC \_ \_ , el llamador debe liberar la memoria mediante una llamada a la función [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="a576e-331">If ISC\_REQ\_ALLOCATE\_MEMORY was specified, the caller must free the memory by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span>

<span data-ttu-id="a576e-332">Por ejemplo, el token de entrada podría ser el desafío de un administrador de LAN.</span><span class="sxs-lookup"><span data-stu-id="a576e-332">For example, the input token could be the challenge from a LAN Manager.</span></span> <span data-ttu-id="a576e-333">En este caso, el token de salida sería la respuesta cifrada NTLM al desafío.</span><span class="sxs-lookup"><span data-stu-id="a576e-333">In this case, the output token would be the NTLM-encrypted response to the challenge.</span></span>

<span data-ttu-id="a576e-334">La acción que realiza el cliente depende del código de retorno de esta función.</span><span class="sxs-lookup"><span data-stu-id="a576e-334">The action the client takes depends on the return code from this function.</span></span> <span data-ttu-id="a576e-335">Si el código de retorno es en segundos \_ E \_ OK, no habrá ninguna segunda llamada a **InitializeSecurityContext (general)** y no se espera ninguna respuesta del servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-335">If the return code is SEC\_E\_OK, there will be no second **InitializeSecurityContext (General)** call, and no response from the server is expected.</span></span> <span data-ttu-id="a576e-336">Si el código de retorno es \_ la \_ necesidad de continuar \_ , el cliente espera un token en respuesta del servidor y lo pasa en una segunda llamada a **InitializeSecurityContext (general)**.</span><span class="sxs-lookup"><span data-stu-id="a576e-336">If the return code is SEC\_I\_CONTINUE\_NEEDED, the client expects a token in response from the server and passes it in a second call to **InitializeSecurityContext (General)**.</span></span> <span data-ttu-id="a576e-337">El código de retorno seg. de \_ \_ finalización \_ necesario indica que el cliente debe terminar de compilar el mensaje y llamar a la función [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) .</span><span class="sxs-lookup"><span data-stu-id="a576e-337">The SEC\_I\_COMPLETE\_NEEDED return code indicates that the client must finish building the message and call the [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span> <span data-ttu-id="a576e-338">El \_ código sec I \_ Complete \_ y \_ continue incorpora ambas acciones.</span><span class="sxs-lookup"><span data-stu-id="a576e-338">The SEC\_I\_COMPLETE\_AND\_CONTINUE code incorporates both of these actions.</span></span>

<span data-ttu-id="a576e-339">Si **InitializeSecurityContext (general)** devuelve SUCCESS en la primera llamada (o solo), el llamador debe llamar finalmente a la función [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) en el identificador devuelto, aunque se produzca un error en la llamada en un segmento posterior del intercambio de autenticación.</span><span class="sxs-lookup"><span data-stu-id="a576e-339">If **InitializeSecurityContext (General)** returns success on the first (or only) call, then the caller must eventually call the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function on the returned handle, even if the call fails on a later leg of the authentication exchange.</span></span>

<span data-ttu-id="a576e-340">El cliente puede llamar a **InitializeSecurityContext (general)** una vez que se haya completado correctamente.</span><span class="sxs-lookup"><span data-stu-id="a576e-340">The client may call **InitializeSecurityContext (General)** again after it has completed successfully.</span></span> <span data-ttu-id="a576e-341">Esto indica al [*paquete de seguridad*](../secgloss/s-gly.md) que se desea una reautenticación.</span><span class="sxs-lookup"><span data-stu-id="a576e-341">This indicates to the [*security package*](../secgloss/s-gly.md) that a reauthentication is wanted.</span></span>

<span data-ttu-id="a576e-342">Los llamadores del modo kernel tienen las siguientes diferencias: el nombre de destino es una cadena [*Unicode*](../secgloss/u-gly.md) que debe asignarse en la memoria virtual mediante [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc); no debe estar asignado desde el grupo.</span><span class="sxs-lookup"><span data-stu-id="a576e-342">Kernel mode callers have the following differences: the target name is a [*Unicode*](../secgloss/u-gly.md) string that must be allocated in virtual memory by using [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc); it must not be allocated from the pool.</span></span> <span data-ttu-id="a576e-343">Los búferes pasados y proporcionados en *pInput* y *pOutput* deben estar en la memoria virtual, no en el grupo.</span><span class="sxs-lookup"><span data-stu-id="a576e-343">Buffers passed and supplied in *pInput* and *pOutput* must be in virtual memory, not in the pool.</span></span>

<span data-ttu-id="a576e-344">Cuando se usa Schannel SSP, si la función devuelve \_ \_ \_ las CREDENCIALes de s incompletas, compruebe que especificó un certificado válido y de confianza en sus credenciales.</span><span class="sxs-lookup"><span data-stu-id="a576e-344">When using the Schannel SSP, if the function returns SEC\_I\_INCOMPLETE\_CREDENTIALS, check that you specified a valid and trusted certificate in your credentials.</span></span> <span data-ttu-id="a576e-345">El certificado se especifica cuando se llama a la función [**AcquireCredentialsHandle (general)**](acquirecredentialshandle--general.md) .</span><span class="sxs-lookup"><span data-stu-id="a576e-345">The certificate is specified when calling the [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) function.</span></span> <span data-ttu-id="a576e-346">El certificado debe ser un certificado de autenticación de cliente emitido por una entidad de certificación (CA) que sea de confianza para el servidor.</span><span class="sxs-lookup"><span data-stu-id="a576e-346">The certificate must be a client authentication certificate issued by a certification authority (CA) trusted by the server.</span></span> <span data-ttu-id="a576e-347">Para obtener una lista de las entidades de certificación de confianza del servidor, llame a la función [**QueryContextAttributes (general)**](querycontextattributes--general.md) y especifique el \_ atributo de lista de emisores de SECPKG ATTR \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="a576e-347">To obtain a list of the CAs trusted by the server, call the [**QueryContextAttributes (General)**](querycontextattributes--general.md) function and specify the SECPKG\_ATTR\_ISSUER\_LIST\_EX attribute.</span></span>

<span data-ttu-id="a576e-348">Cuando se usa Schannel SSP, una vez que una aplicación cliente recibe un certificado de autenticación de una CA que es de confianza para el servidor, la aplicación crea una nueva credencial mediante una llamada a la función [**AcquireCredentialsHandle (general)**](acquirecredentialshandle--general.md) y, a continuación, llama a **InitializeSecurityContext (general)** de nuevo, especificando la nueva credencial en el parámetro *phCredential* .</span><span class="sxs-lookup"><span data-stu-id="a576e-348">When using the Schannel SSP, after a client application receives an authentication certificate from a CA that is trusted by the server, the application creates a new credential by calling the [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) function and then calling **InitializeSecurityContext (General)** again, specifying the new credential in the *phCredential* parameter.</span></span>

## <a name="requirements"></a><span data-ttu-id="a576e-349">Requisitos</span><span class="sxs-lookup"><span data-stu-id="a576e-349">Requirements</span></span>



| <span data-ttu-id="a576e-350">Requisito</span><span class="sxs-lookup"><span data-stu-id="a576e-350">Requirement</span></span> | <span data-ttu-id="a576e-351">Value</span><span class="sxs-lookup"><span data-stu-id="a576e-351">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a576e-352">Cliente mínimo compatible</span><span class="sxs-lookup"><span data-stu-id="a576e-352">Minimum supported client</span></span><br/> | <span data-ttu-id="a576e-353">Solo aplicaciones de escritorio de Windows XP \[\]</span><span class="sxs-lookup"><span data-stu-id="a576e-353">Windows XP \[desktop apps only\]</span></span><br/>                                                            |
| <span data-ttu-id="a576e-354">Servidor mínimo compatible</span><span class="sxs-lookup"><span data-stu-id="a576e-354">Minimum supported server</span></span><br/> | <span data-ttu-id="a576e-355">Solo aplicaciones de escritorio de Windows Server 2003 \[\]</span><span class="sxs-lookup"><span data-stu-id="a576e-355">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                                   |
| <span data-ttu-id="a576e-356">Encabezado</span><span class="sxs-lookup"><span data-stu-id="a576e-356">Header</span></span><br/>                   | <dl> <span data-ttu-id="a576e-357"><dt>SSPI. h (incluir Security. h)</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-357"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="a576e-358">Biblioteca</span><span class="sxs-lookup"><span data-stu-id="a576e-358">Library</span></span><br/>                  | <dl> <span data-ttu-id="a576e-359"><dt>SECUR32. lib</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-359"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="a576e-360">Archivo DLL</span><span class="sxs-lookup"><span data-stu-id="a576e-360">DLL</span></span><br/>                      | <dl> <span data-ttu-id="a576e-361"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="a576e-361"><dt>Secur32.dll</dt></span></span> </dl>                 |
| <span data-ttu-id="a576e-362">Nombres Unicode y ANSI</span><span class="sxs-lookup"><span data-stu-id="a576e-362">Unicode and ANSI names</span></span><br/>   | <span data-ttu-id="a576e-363">**InitializeSecurityContextW** (Unicode) y **InitializeSecurityContextA** (ANSI)</span><span class="sxs-lookup"><span data-stu-id="a576e-363">**InitializeSecurityContextW** (Unicode) and **InitializeSecurityContextA** (ANSI)</span></span><br/>          |



## <a name="see-also"></a><span data-ttu-id="a576e-364">Vea también</span><span class="sxs-lookup"><span data-stu-id="a576e-364">See also</span></span>

<dl> <dt>

[<span data-ttu-id="a576e-365">Funciones SSPI</span><span class="sxs-lookup"><span data-stu-id="a576e-365">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
</dt> <dt>

[<span data-ttu-id="a576e-366">**AcceptSecurityContext (general)**</span><span class="sxs-lookup"><span data-stu-id="a576e-366">**AcceptSecurityContext (General)**</span></span>](acceptsecuritycontext--general.md)
</dt> <dt>

[<span data-ttu-id="a576e-367">**AcquireCredentialsHandle (general)**</span><span class="sxs-lookup"><span data-stu-id="a576e-367">**AcquireCredentialsHandle (General)**</span></span>](acquirecredentialshandle--general.md)
</dt> <dt>

[<span data-ttu-id="a576e-368">**CompleteAuthToken**</span><span class="sxs-lookup"><span data-stu-id="a576e-368">**CompleteAuthToken**</span></span>](/windows/win32/api/sspi/nf-sspi-completeauthtoken)
</dt> <dt>

[<span data-ttu-id="a576e-369">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="a576e-369">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[<span data-ttu-id="a576e-370">**FreeContextBuffer**</span><span class="sxs-lookup"><span data-stu-id="a576e-370">**FreeContextBuffer**</span></span>](/windows/win32/api/sspi/nf-sspi-freecontextbuffer)
</dt> <dt>

[<span data-ttu-id="a576e-371">**SecBuffer**</span><span class="sxs-lookup"><span data-stu-id="a576e-371">**SecBuffer**</span></span>](/windows/win32/api/sspi/ns-sspi-secbuffer)
</dt> <dt>

[<span data-ttu-id="a576e-372">**SecBufferDesc**</span><span class="sxs-lookup"><span data-stu-id="a576e-372">**SecBufferDesc**</span></span>](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
</dt> </dl>

 

 
