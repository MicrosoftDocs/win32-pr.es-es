---
description: A medida que se agregan, eliminan y modifican archivos, directorios y otros objetos del sistema de archivos NTFS, el sistema de archivos NTFS escribe en secuencias los registros del diario de cambios, uno para cada volumen del equipo.
ms.assetid: c41aa3a8-c8d8-4bf2-9bbb-d6a6a556c5e4
title: Cambiar registros de diario
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 56580a28c01ca164af4598cb290a37c8e36828f5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105688474"
---
# <a name="change-journal-records"></a><span data-ttu-id="8df8f-103">Cambiar registros de diario</span><span class="sxs-lookup"><span data-stu-id="8df8f-103">Change Journal Records</span></span>

<span data-ttu-id="8df8f-104">A medida que se agregan, eliminan y modifican archivos, directorios y otros objetos del sistema de archivos NTFS, el sistema de archivos NTFS escribe en secuencias los registros del diario de cambios, uno para cada volumen del equipo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-104">As files, directories, and other NTFS file system objects are added, deleted, and modified, the NTFS file system enters change journal records in streams, one for each volume on the computer.</span></span> <span data-ttu-id="8df8f-105">Cada registro indica el tipo de cambio y el objeto cambiado.</span><span class="sxs-lookup"><span data-stu-id="8df8f-105">Each record indicates the type of change and the object changed.</span></span> <span data-ttu-id="8df8f-106">El desplazamiento desde el principio de la secuencia para un registro determinado se denomina número de secuencia de actualización (USN) para el registro en particular.</span><span class="sxs-lookup"><span data-stu-id="8df8f-106">The offset from the beginning of the stream for a particular record is called the update sequence number (USN) for the particular record.</span></span> <span data-ttu-id="8df8f-107">Los nuevos registros se anexan al final de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="8df8f-107">New records are appended to the end of the stream.</span></span>

<span data-ttu-id="8df8f-108">El sistema de archivos NTFS puede eliminar los registros antiguos para ahorrar espacio.</span><span class="sxs-lookup"><span data-stu-id="8df8f-108">The NTFS file system may delete old records to conserve space.</span></span> <span data-ttu-id="8df8f-109">Si se han eliminado registros necesarios, el servicio de indexación se recupera al volver a indexar el volumen, como cuando no existe ningún diario de cambios.</span><span class="sxs-lookup"><span data-stu-id="8df8f-109">If needed records have been deleted, the indexing service recovers by re-indexing the volume, as it does when no change journal exists.</span></span>

<span data-ttu-id="8df8f-110">El diario de cambios solo registra el hecho de un cambio en un archivo y el motivo del cambio (por ejemplo, operaciones de escritura, truncamiento, prolongación, eliminación, etc.).</span><span class="sxs-lookup"><span data-stu-id="8df8f-110">The change journal logs only the fact of a change to a file and the reason for the change (for example, write operations, truncation, lengthening, deletion, and so on).</span></span> <span data-ttu-id="8df8f-111">No registra suficiente información para permitir invertir el cambio.</span><span class="sxs-lookup"><span data-stu-id="8df8f-111">It does not record enough information to allow reversing the change.</span></span>

<span data-ttu-id="8df8f-112">Además, varios cambios en el mismo archivo pueden dar lugar a que solo se agregue una marca de motivo al registro actual.</span><span class="sxs-lookup"><span data-stu-id="8df8f-112">In addition, multiple changes to the same file may result in only one reason flag being added to the current record.</span></span> <span data-ttu-id="8df8f-113">Si el mismo tipo de cambio se produce más de una vez, el sistema de archivos NTFS no escribe un nuevo registro para los cambios después de la primera.</span><span class="sxs-lookup"><span data-stu-id="8df8f-113">If the same kind of change occurs more than once, the NTFS file system does not write a new record for the changes after the first.</span></span> <span data-ttu-id="8df8f-114">Por ejemplo, varias operaciones de escritura que no intervienen en operaciones de cierre y de reapertura, dan como resultado un solo registro de cambios con la marca de razón USN \_ motivo de \_ sobrescritura de datos \_ .</span><span class="sxs-lookup"><span data-stu-id="8df8f-114">For example, several write operations with no intervening close and reopen operations result in only one change record with the reason flag USN\_REASON\_DATA\_OVERWRITE set.</span></span>

<span data-ttu-id="8df8f-115">Para ilustrar el funcionamiento del diario de cambios, supongamos que un usuario tiene acceso a un archivo en el siguiente orden:</span><span class="sxs-lookup"><span data-stu-id="8df8f-115">To illustrate how the change journal works, suppose a user accesses a file in the following order:</span></span>

1.  <span data-ttu-id="8df8f-116">Escribe en el archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-116">Writes to the file.</span></span>
2.  <span data-ttu-id="8df8f-117">Establece la marca de tiempo para el archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-117">Sets the time stamp for the file.</span></span>
3.  <span data-ttu-id="8df8f-118">Escribe en el archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-118">Writes to the file.</span></span>
4.  <span data-ttu-id="8df8f-119">Trunca el archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-119">Truncates the file.</span></span>
5.  <span data-ttu-id="8df8f-120">Escribe en el archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-120">Writes to the file.</span></span>
6.  <span data-ttu-id="8df8f-121">Cierra el archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-121">Closes the file.</span></span>

<span data-ttu-id="8df8f-122">En este caso, el sistema de archivos NTFS realiza las siguientes acciones en el diario de cambios (donde \| indica una operación OR bit a bit).</span><span class="sxs-lookup"><span data-stu-id="8df8f-122">In this case, the NTFS file system takes the following actions in the change journal (where \| indicates a bitwise OR operation).</span></span>



| <span data-ttu-id="8df8f-123">Evento</span><span class="sxs-lookup"><span data-stu-id="8df8f-123">Event</span></span>                                 | <span data-ttu-id="8df8f-124">Acción del sistema de archivos NTFS</span><span class="sxs-lookup"><span data-stu-id="8df8f-124">NTFS file system action</span></span>                                                                                                                                                                                                                                                    |
|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="8df8f-125">Operación de escritura inicial</span><span class="sxs-lookup"><span data-stu-id="8df8f-125">Initial write operation</span></span><br/>    | <span data-ttu-id="8df8f-126">El sistema de archivos NTFS escribe un nuevo registro USN con el \_ valor de la marca de motivo de sobrescritura de datos de razón USN \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="8df8f-126">The NTFS file system writes a new USN record with the USN\_REASON\_DATA\_OVERWRITE reason flag set.</span></span> <span data-ttu-id="8df8f-127">Para obtener más información sobre las posibles marcas de motivo, consulte la estructura de [**\_ registro USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) .</span><span class="sxs-lookup"><span data-stu-id="8df8f-127">For more information on possible reason flags, see the [**USN\_RECORD**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) structure.</span></span><br/>                                                     |
| <span data-ttu-id="8df8f-128">Configuración de la marca de tiempo de archivo</span><span class="sxs-lookup"><span data-stu-id="8df8f-128">Setting of file time stamp</span></span><br/> | <span data-ttu-id="8df8f-129">El sistema de archivos NTFS escribe un nuevo registro USN con la opción de marca USN \_ razón USN \_ \_ sobrescribir datos \| USN \_ motivo \_ \_ información básica \_ cambiar.</span><span class="sxs-lookup"><span data-stu-id="8df8f-129">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE.</span></span><br/>                                                                                                                            |
| <span data-ttu-id="8df8f-130">Segunda operación de escritura</span><span class="sxs-lookup"><span data-stu-id="8df8f-130">Second write operation</span></span><br/>     | <span data-ttu-id="8df8f-131">El sistema de archivos NTFS no escribe un nuevo registro USN.</span><span class="sxs-lookup"><span data-stu-id="8df8f-131">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="8df8f-132">Dado \_ \_ \_ que ya se ha establecido el valor de USN Reason Data overwrite para el registro existente, no se realiza ningún cambio en el registro.</span><span class="sxs-lookup"><span data-stu-id="8df8f-132">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="8df8f-133">Truncamiento de archivo</span><span class="sxs-lookup"><span data-stu-id="8df8f-133">File truncation</span></span><br/>            | <span data-ttu-id="8df8f-134">El sistema de archivos NTFS escribe un nuevo registro USN con la configuración de la marca USN motivo de \_ \_ sobrescritura de datos \_ sobrescribir USN motivo de la \| \_ \_ información básica cambiar el valor del \_ \_ truncamiento de \| \_ \_ datos \_ .</span><span class="sxs-lookup"><span data-stu-id="8df8f-134">The NTFS file system writes a new USN record with the flag setting USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION.</span></span><br/>                                                                                           |
| <span data-ttu-id="8df8f-135">Tercera operación de escritura</span><span class="sxs-lookup"><span data-stu-id="8df8f-135">Third write operation</span></span><br/>      | <span data-ttu-id="8df8f-136">El sistema de archivos NTFS no escribe un nuevo registro USN.</span><span class="sxs-lookup"><span data-stu-id="8df8f-136">The NTFS file system does not write a new USN record.</span></span> <span data-ttu-id="8df8f-137">Dado \_ \_ \_ que ya se ha establecido el valor de USN Reason Data overwrite para el registro existente, no se realiza ningún cambio en el registro.</span><span class="sxs-lookup"><span data-stu-id="8df8f-137">Because USN\_REASON\_DATA\_OVERWRITE is already set for the existing record, no changes are made to the record.</span></span><br/>                                                                                           |
| <span data-ttu-id="8df8f-138">Operación de cierre</span><span class="sxs-lookup"><span data-stu-id="8df8f-138">Close operation</span></span><br/>            | <span data-ttu-id="8df8f-139">Si el usuario que realiza cambios es el único usuario del archivo, el sistema de archivos NTFS escribe un nuevo registro USN con la siguiente configuración de marca: USN \_ Reason \_ datos sobrescribir USN motivo de la \_ \| \_ \_ información básica cambiar el valor de \_ \_ \| USN motivo de \_ truncamiento de \_ datos \_ \| \_ \_ el valor de USN razón de USN.</span><span class="sxs-lookup"><span data-stu-id="8df8f-139">If the user making changes is the only user of the file, the NTFS file system writes a new USN record with the following flag setting: USN\_REASON\_DATA\_OVERWRITE \| USN\_REASON\_BASIC\_INFO\_CHANGE \| USN\_REASON\_DATA\_TRUNCATION \| USN\_REASON\_CLOSE.</span></span><br/> |



 

<span data-ttu-id="8df8f-140">El diario de cambios acumula una serie de registros entre la primera apertura y el último cierre de un archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-140">The change journal accumulates a series of records between the first opening and last closing of a file.</span></span> <span data-ttu-id="8df8f-141">Cada registro tiene un nuevo marcador de motivo establecido, que indica que se ha producido un nuevo tipo de cambio.</span><span class="sxs-lookup"><span data-stu-id="8df8f-141">Each record has a new reason flag set, indicating that a new kind of change has occurred.</span></span> <span data-ttu-id="8df8f-142">La secuencia de registros proporciona un historial parcial del archivo.</span><span class="sxs-lookup"><span data-stu-id="8df8f-142">The sequence of records gives a partial history of the file.</span></span> <span data-ttu-id="8df8f-143">El registro final, creado cuando se cierra el archivo, agrega la \_ marca de cierre de motivo USN \_ .</span><span class="sxs-lookup"><span data-stu-id="8df8f-143">The final record, created when the file is closed, adds the USN\_REASON\_CLOSE flag.</span></span> <span data-ttu-id="8df8f-144">Este registro representa un resumen de los cambios en el archivo, pero a diferencia de los registros anteriores, no proporciona ninguna indicación del orden de los cambios.</span><span class="sxs-lookup"><span data-stu-id="8df8f-144">This record represents a summary of changes to the file, but unlike the prior records, gives no indication of the order of the changes.</span></span>

<span data-ttu-id="8df8f-145">El siguiente usuario para tener acceso y cambiar el archivo genera un nuevo registro USN con una marca de motivo único.</span><span class="sxs-lookup"><span data-stu-id="8df8f-145">The next user to access and change the file generates a new USN record with a single reason flag.</span></span>

 

 




