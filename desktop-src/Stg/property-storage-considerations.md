---
title: Consideraciones sobre el almacenamiento de propiedades
description: IPropertyStorage ReadMultiple lee todas las propiedades especificadas en la matriz rgpspec que se encuentran en el conjunto de propiedades.
ms.assetid: 7540966f-a3b2-46c9-9e04-b15133a517eb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2aad6aabf8b22a7c01f91a090136e6cc8156c791
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105665829"
---
# <a name="property-storage-considerations"></a><span data-ttu-id="13679-103">Consideraciones sobre el almacenamiento de propiedades</span><span class="sxs-lookup"><span data-stu-id="13679-103">Property Storage Considerations</span></span>

<span data-ttu-id="13679-104">[**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) lee todas las propiedades especificadas en la matriz *rgpspec* que se encuentran en el conjunto de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-104">[**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) reads as many of the properties specified in the *rgpspec* array as are found in the property set.</span></span> <span data-ttu-id="13679-105">Siempre que se lea cualquiera de las propiedades solicitadas, una solicitud para recuperar una propiedad que no existe no es un error.</span><span class="sxs-lookup"><span data-stu-id="13679-105">As long as any of the properties requested is read, a request to retrieve a property that does not exist is not an error.</span></span> <span data-ttu-id="13679-106">En su lugar, debe provocar que \_ se escriba VT en blanco para esa propiedad en la matriz *rgvar* \[ \] en la devolución.</span><span class="sxs-lookup"><span data-stu-id="13679-106">Instead, this must cause VT\_EMPTY to be written for that property to the *rgvar*\[\] array on return.</span></span> <span data-ttu-id="13679-107">Cuando no existe ninguna de las propiedades solicitadas, el método debe devolver S \_ false y establecer VT \_ vacío en cada [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span><span class="sxs-lookup"><span data-stu-id="13679-107">When none of the requested properties exist, the method should return S\_FALSE, and set VT\_EMPTY in each [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span></span> <span data-ttu-id="13679-108">Si se devuelve cualquier otro error, no se recupera ningún valor de propiedad y el autor de la llamada no tiene que preocuparse por liberarlos.</span><span class="sxs-lookup"><span data-stu-id="13679-108">If any other error is returned, no property values are retrieved, and the caller need not worry about releasing them.</span></span>

<span data-ttu-id="13679-109">El parámetro *rgpspec* es una matriz de estructuras [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) , que especifican para cada propiedad su identificador de propiedad o, si se ha asignado una, un identificador de cadena.</span><span class="sxs-lookup"><span data-stu-id="13679-109">The *rgpspec* parameter is an array of [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) structures, which specify for each property either its property identifier or, if one is assigned, a string identifier.</span></span> <span data-ttu-id="13679-110">Puede asignar una cadena a un identificador de propiedad llamando a [**IPropertyStorage:: WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span><span class="sxs-lookup"><span data-stu-id="13679-110">You can map a string to a property identifier by calling [**IPropertyStorage::WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span></span> <span data-ttu-id="13679-111">El uso de identificadores de propiedad es, sin embargo, que probablemente sea mucho más eficaz que el uso de cadenas.</span><span class="sxs-lookup"><span data-stu-id="13679-111">The use of property identifiers is, however, likely to be significantly more efficient than the use of strings.</span></span>

<span data-ttu-id="13679-112">Las propiedades que se solicitan por nombre de cadena (PRSPEC \_ LPWStr) se asignan sin distinción entre mayúsculas y minúsculas en los identificadores de propiedad (ID), ya que se especifican en el conjunto de propiedades actual (y según la configuración regional actual del sistema).</span><span class="sxs-lookup"><span data-stu-id="13679-112">Properties that are requested by string name (PRSPEC\_LPWSTR) are mapped case-insensitively to property identifiers (IDs) as they are specified in the current property set (and according to the current system locale).</span></span>

<span data-ttu-id="13679-113">Cuando el tipo de propiedad es VT \_ LPSTR y la propiedad se lee desde un conjunto de propiedades ANSI, es decir, la página de códigos del conjunto de propiedades se establece en un valor distinto de Unicode, el valor de la propiedad utiliza la misma página de códigos que el conjunto de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-113">When the property type is VT\_LPSTR and the property is read from an ANSI property set, that is, the code page for the property set is set to something other than Unicode, the value of the property uses the same code page as the property set.</span></span> <span data-ttu-id="13679-114">Cuando \_ se lee una propiedad VT LPSTR desde un conjunto de propiedades Unicode, el valor de la propiedad utiliza la página de códigos ANSI predeterminada actual del sistema, es decir, la página de códigos devuelta por la función **GetACP** .</span><span class="sxs-lookup"><span data-stu-id="13679-114">When a VT\_LPSTR property is read from a Unicode property set, the value of the property uses the system's current default ANSI code page, that is, the code page returned from the **GetACP** function.</span></span>

<span data-ttu-id="13679-115">Un [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), excepto aquellos que son punteros a flujos y almacenamientos, se denomina **PROPVARIANT** simple.</span><span class="sxs-lookup"><span data-stu-id="13679-115">A [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), except for those that are pointers to streams and storages, is called a simple **PROPVARIANT**.</span></span> <span data-ttu-id="13679-116">Estos sencillos **PROPVARIANT** s reciben datos por valor, por lo que una llamada a [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) proporciona una copia de los datos a los que pertenece el llamador.</span><span class="sxs-lookup"><span data-stu-id="13679-116">These simple **PROPVARIANT** s receive data by value, so a call to [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) supplies a copy of the data that the caller then owns.</span></span> <span data-ttu-id="13679-117">Para crear o actualizar estas propiedades, llame a [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="13679-117">To create or update these properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span>

<span data-ttu-id="13679-118">En cambio, los tipos de variante VT \_ Stream, el \_ objeto de secuencia VT, el \_ \_ almacenamiento VT y el \_ objeto almacenado VT \_ son propiedades no simples, porque en lugar de proporcionar un valor, el método recupera un puntero a la interfaz indicada, desde la que se pueden leer los datos.</span><span class="sxs-lookup"><span data-stu-id="13679-118">In contrast, the variant types VT\_STREAM, VT\_STREAMED\_OBJECT, VT\_STORAGE, and VT\_STORED\_OBJECT are non-simple properties, because rather than supplying a value, the method retrieves a pointer to the indicated interface, from which the data can then be read.</span></span> <span data-ttu-id="13679-119">Estos tipos permiten el almacenamiento de grandes cantidades de información a través de una sola propiedad.</span><span class="sxs-lookup"><span data-stu-id="13679-119">These types permit the storage of large amounts of information through a single property.</span></span> <span data-ttu-id="13679-120">Hay varios problemas que surgen al usar propiedades no simples.</span><span class="sxs-lookup"><span data-stu-id="13679-120">There are several issues that arise in using nonsimple properties.</span></span>

<span data-ttu-id="13679-121">Para crear estas propiedades, como en el caso de las demás propiedades, llame a [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="13679-121">To create these properties, as for the other properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="13679-122">Sin embargo, en lugar de llamar al mismo método para actualizar, es más eficaz llamar primero a [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) para obtener el puntero de interfaz a la secuencia o almacenamiento y, después, escribir datos mediante los métodos [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) o [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="13679-122">Rather than calling the same method to update, however, it is more efficient to first call [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then write data using the [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) or [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) methods.</span></span> <span data-ttu-id="13679-123">Un flujo o almacenamiento abierto a través de una propiedad siempre se abre en modo directo, por lo que no se introduce un nivel adicional de transacción anidada.</span><span class="sxs-lookup"><span data-stu-id="13679-123">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="13679-124">No obstante, puede haber una transacción en el conjunto de propiedades como un todo, en función de cómo se haya abierto o creado a través de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span><span class="sxs-lookup"><span data-stu-id="13679-124">There may, however, still be a transaction on the property set as a whole, depending on how it was opened or created through [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span></span> <span data-ttu-id="13679-125">Además, las etiquetas de modo de acceso y uso compartido especificadas cuando se abre o se crea el conjunto de propiedades, se pasan a las secuencias o los almacenamientos basados en propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-125">Further, the access and share mode tags specified when the property set is opened or created, are passed to property-based streams or storages.</span></span>

<span data-ttu-id="13679-126">La duración de los punteros de flujo o de almacenamiento basados en propiedades, aunque teóricamente independiente de sus punteros [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) y [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) asociados, de hecho, depende de forma efectiva de ellos.</span><span class="sxs-lookup"><span data-stu-id="13679-126">The lifetimes of property-based stream or storage pointers, although theoretically independent of their associated [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) pointers, in fact, effectively depend on them.</span></span> <span data-ttu-id="13679-127">Los datos visibles a través de la secuencia o el almacenamiento se relacionan con la transacción en el objeto de almacenamiento de propiedad del que se recuperan, al igual que para un objeto de almacenamiento (compatible con [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) con subobjetos de almacenamiento y flujo contenidos.</span><span class="sxs-lookup"><span data-stu-id="13679-127">The data visible through the stream or storage is related to the transaction on the property storage object from which it is retrieved, just as for a storage object (supporting [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) with contained stream and storage sub-objects.</span></span> <span data-ttu-id="13679-128">Si se anula la transacción en el objeto primario, los punteros [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) y **IStorage** existentes subordinados a ese objeto dejarán de estar accesibles.</span><span class="sxs-lookup"><span data-stu-id="13679-128">If the transaction on the parent object is aborted, existing [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) and **IStorage** pointers subordinate to that object are no longer accessible.</span></span> <span data-ttu-id="13679-129">Dado que **IPropertyStorage** es la única interfaz en el objeto de almacenamiento de propiedades, la duración útil de los punteros **IStream** y **IStorage** contenidos está limitada por la duración de la interfaz **IPropertyStorage** .</span><span class="sxs-lookup"><span data-stu-id="13679-129">Because **IPropertyStorage** is the only interface on the property storage object, the useful lifetime of the contained **IStream** and **IStorage** pointers is bounded by the lifetime of the **IPropertyStorage** interface.</span></span>

<span data-ttu-id="13679-130">La implementación también debe tratar la situación en la que se solicita la misma propiedad de streaming o con valores de almacenamiento varias veces a través de la misma instancia de la interfaz [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="13679-130">The implementation must also deal with the situation where the same stream- or storage-valued property is requested multiple times through the same [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface instance.</span></span> <span data-ttu-id="13679-131">Por ejemplo, en la implementación de archivo compuesto COM, el abierto se realizará correctamente o producirá un error dependiendo de si la propiedad ya está abierta o no.</span><span class="sxs-lookup"><span data-stu-id="13679-131">For example, in the COM compound file implementation, the open will succeed or fail depending on whether or not the property is already open.</span></span>

<span data-ttu-id="13679-132">Otro problema es que se abren varias en el modo de transacción.</span><span class="sxs-lookup"><span data-stu-id="13679-132">Another issue is multiple opens in transacted mode.</span></span> <span data-ttu-id="13679-133">El resultado depende del nivel de aislamiento que se especificó mediante una llamada a los métodos de [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) , (ya sea el método [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) o [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , a través de las marcas STGM) en el momento en que se abrió el almacenamiento de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-133">The result depends on the isolation level that was specified through a call to [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) methods, (either the [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) or [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method, through the STGM flags) at the time that the property storage was opened.</span></span>

<span data-ttu-id="13679-134">Si la llamada para abrir el conjunto de propiedades especifica el acceso de lectura y escritura, las propiedades de [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) y de valor de [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)siempre se abren con acceso de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="13679-134">If the call to open the property set specifies read-write access, [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)-valued properties are always opened with read-write access.</span></span> <span data-ttu-id="13679-135">Después, los datos se pueden escribir a través de estas interfaces, cambiando el valor de la propiedad, que es la manera más eficaz de actualizar estas propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-135">Data can then be written through these interfaces, changing the value of the property, which is the most efficient way to update these properties.</span></span> <span data-ttu-id="13679-136">El propio valor de la propiedad no tiene un nivel adicional de anidamiento de transacciones, por lo que los cambios se encuentran en el ámbito de la transacción (si existe) en el objeto de almacenamiento de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-136">The property value itself does not have an additional level of transaction nesting, so changes are scoped under the transaction (if any) on the property storage object.</span></span>

## <a name="storage-and-stream-properties"></a><span data-ttu-id="13679-137">Propiedades de flujo y almacenamiento</span><span class="sxs-lookup"><span data-stu-id="13679-137">Storage and Stream Properties</span></span>

<span data-ttu-id="13679-138">Para escribir un flujo o un objeto de almacenamiento en un conjunto de propiedades, el conjunto de propiedades debe haberse creado como nonsimple.</span><span class="sxs-lookup"><span data-stu-id="13679-138">To write a stream or storage object to a property set, the property set must have been created as nonsimple.</span></span> <span data-ttu-id="13679-139">Para obtener más información sobre los conjuntos de propiedades simples y no simples, vea la sección titulada [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="13679-139">For more information on simple and nonsimple property sets, see the section titled [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span> <span data-ttu-id="13679-140">Los siguientes tipos de propiedades, como se especifica en el campo *VT* de los elementos de la matriz *rgvar* , son tipos de flujo o almacenamiento: VT \_ Stream, VT \_ Storage, VT \_ Streamed Object \_ y VT \_ Stored \_ Object.</span><span class="sxs-lookup"><span data-stu-id="13679-140">The following property types, as specified in the *vt* field of the *rgvar* array elements, are stream or storage types: VT\_STREAM, VT\_STORAGE, VT\_STREAMED\_OBJECT, VT\_STORED\_OBJECT.</span></span>

<span data-ttu-id="13679-141">Para escribir un flujo o un objeto de almacenamiento como una propiedad en un conjunto de propiedades no simples, llame a [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="13679-141">To write a stream or storage object as a property in a non-simple property set, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="13679-142">Aunque también llamaría a este método para actualizar las propiedades simples, no es una manera eficaz de actualizar los objetos de flujo y almacenamiento en un conjunto de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-142">While you would also call this method to update simple properties, it is not an efficient way to update stream and storage objects in a property set.</span></span> <span data-ttu-id="13679-143">Esto se debe a que la actualización de una de estas propiedades a través de una llamada a **WriteMultiple** crea en el objeto de almacenamiento de propiedades una copia de los datos pasados, y los punteros [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) o [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) no se conservan más allá de la duración de esta llamada.</span><span class="sxs-lookup"><span data-stu-id="13679-143">This is because updating one of these properties through a call to **WriteMultiple** creates in the property storage object a copy of the passed-in data, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) pointers are not retained beyond the duration of this call.</span></span> <span data-ttu-id="13679-144">Normalmente, es más eficaz actualizar los objetos de flujo o de almacenamiento directamente mediante una llamada a [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) para obtener el puntero de interfaz a la secuencia o el almacenamiento, y después escribir los datos mediante los métodos **IStream** o **IStorage** .</span><span class="sxs-lookup"><span data-stu-id="13679-144">It is usually more efficient to update stream or storage objects directly by first calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then writing data through the **IStream** or **IStorage** methods.</span></span>

<span data-ttu-id="13679-145">Por ejemplo, puede llamar a [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) para escribir una secuencia **null** o un objeto de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="13679-145">For example, you can call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) to write a **NULL** stream or storage object.</span></span> <span data-ttu-id="13679-146">La implementación creará un objeto vacío en el conjunto de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-146">The implementation will then create an empty object in the property set.</span></span> <span data-ttu-id="13679-147">Después, puede obtener acceso a este objeto llamando a [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span><span class="sxs-lookup"><span data-stu-id="13679-147">You can then get access to this object by calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span></span> <span data-ttu-id="13679-148">Cuando termine de actualizar este objeto, no es necesario que lo escriba en el conjunto de propiedades, ya que las actualizaciones estaban directamente en el conjunto de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-148">When you finish updating this object you need not write it to the property set, as your updates were going directly into the property set.</span></span>

<span data-ttu-id="13679-149">Un flujo o almacenamiento abierto a través de una propiedad siempre se abre en modo directo, por lo que no se introduce un nivel adicional de transacción anidada.</span><span class="sxs-lookup"><span data-stu-id="13679-149">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="13679-150">Todavía puede haber una transacción en el conjunto de propiedades como un todo.</span><span class="sxs-lookup"><span data-stu-id="13679-150">There still may be a transaction on the property set as a whole.</span></span> <span data-ttu-id="13679-151">(Por ejemplo, si el [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) se obtuvo llamando a [**IPropertySetStorage:: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) con STGM \_ Marca de transacción establecida en el parámetro *grfmode* ). Además, un flujo o almacenamiento basado en propiedad se abre en modo de lectura y escritura, si es posible, dado el modo en el conjunto de propiedades. de lo contrario, se usa el modo de lectura.</span><span class="sxs-lookup"><span data-stu-id="13679-151">(For example, if the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) was obtained by calling [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) with the STGM\_TRANSACTED flag set in the *grfmode* parameter.) Further, a property-based stream or storage is opened in read-write mode, if possible, given the mode on the property set; otherwise, read mode is used.</span></span>

<span data-ttu-id="13679-152">Como se mencionó anteriormente, cuando un flujo o un objeto de almacenamiento se escribe en un conjunto de propiedades con el método [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) , se realiza una copia del objeto.</span><span class="sxs-lookup"><span data-stu-id="13679-152">As mentioned earlier, when a stream or storage object is written to a property set with the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method, a copy of the object is made.</span></span> <span data-ttu-id="13679-153">Cuando se realiza una copia de este tipo en un objeto de secuencia, la operación de copia se inicia en la posición de búsqueda actual del origen.</span><span class="sxs-lookup"><span data-stu-id="13679-153">When such a copy is made on a stream object, the copy operation starts at the current seek position of the source.</span></span> <span data-ttu-id="13679-154">La posición de búsqueda no está definida en caso de error, pero si se realiza correctamente, se encuentra al final de la secuencia. el puntero de búsqueda no se restaura a su posición original.</span><span class="sxs-lookup"><span data-stu-id="13679-154">The seek position is undefined on failure, but on success it is at the end of the stream; the seek pointer is not restored to its original position.</span></span>

<span data-ttu-id="13679-155">Si se ha leído una secuencia o una propiedad de almacenamiento de una propiedad establecida con [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), sigue estando abierta y se realiza una llamada subsiguiente a [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) para la misma propiedad, la operación **WriteMultiple** se realizará correctamente.</span><span class="sxs-lookup"><span data-stu-id="13679-155">If a stream or storage property has been read from a property set with [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), is still held open, and a subsequent call to [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) for the same property is made, the **WriteMultiple** operation will succeed.</span></span> <span data-ttu-id="13679-156">La propiedad de almacenamiento o secuencia abierta anteriormente se coloca en el estado revertido (todas las llamadas a ella devolverán el \_ error STG E \_ revertido).</span><span class="sxs-lookup"><span data-stu-id="13679-156">The previously opened stream or storage property is placed in the reverted state (all calls to it will return STG\_E\_REVERTED error).</span></span>

<span data-ttu-id="13679-157">Si el método [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) devuelve un error al escribir una matriz de propiedades, o incluso propiedades individuales no simples, la cantidad de datos escritos realmente es indefinida.</span><span class="sxs-lookup"><span data-stu-id="13679-157">If the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method returns an error when writing an array of properties, or even individual non-simple properties, the amount of data actually written is undefined.</span></span>

## <a name="reference-properties"></a><span data-ttu-id="13679-158">Propiedades de referencia</span><span class="sxs-lookup"><span data-stu-id="13679-158">Reference Properties</span></span>

<span data-ttu-id="13679-159">Si una estructura de [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) especificada incluye la \_ marca de la BYREF de VT en su miembro de **VT** , la propiedad asociada es una propiedad de referencia.</span><span class="sxs-lookup"><span data-stu-id="13679-159">If a specified [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure includes the VT\_BYREF flag in its **vt** member, the associated property is a reference property.</span></span> <span data-ttu-id="13679-160">Se desreferencia automáticamente una propiedad de referencia antes de escribir el valor en el conjunto de propiedades.</span><span class="sxs-lookup"><span data-stu-id="13679-160">A reference property is automatically dereferenced before writing the value to the property set.</span></span> <span data-ttu-id="13679-161">Por ejemplo, si el miembro **VT** de la estructura **PROPVARIANT** especifica un valor de tipo VT \_ BYREF \| VT \_ I4, el valor real escrito es un tipo de VT \_ .</span><span class="sxs-lookup"><span data-stu-id="13679-161">For example, if the **vt** member of the **PROPVARIANT** structure specifies a value of type VT\_BYREF \| VT\_I4, the actual value written is a VT\_I4 type.</span></span> <span data-ttu-id="13679-162">Una llamada subsiguiente al método [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) devuelve un valor como VT \_ I4.</span><span class="sxs-lookup"><span data-stu-id="13679-162">A subsequent call to the [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) method returns a value as VT\_I4.</span></span> <span data-ttu-id="13679-163">El uso de propiedades de referencia es similar a llamar a la función [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) .</span><span class="sxs-lookup"><span data-stu-id="13679-163">Using reference properties is similar to calling the [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) function.</span></span> <span data-ttu-id="13679-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) libera la variante de destino y realiza una copia del VARIANTARG de origen, lo que realiza el direccionamiento indirecto necesario si se especifica que el origen sea VT \_ BYREF.</span><span class="sxs-lookup"><span data-stu-id="13679-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) frees the destination variant and makes a copy of the source VARIANTARG, performing the necessary indirection if the source is specified to be VT\_BYREF.</span></span> <span data-ttu-id="13679-165">Esta función es útil cuando se necesita una copia de una variante y para garantizar que no es VT \_ BYREF, por ejemplo, al controlar argumentos en una implementación de [**IDispatch:: Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span><span class="sxs-lookup"><span data-stu-id="13679-165">This function is useful when a copy of a variant is needed, and to guarantee that it is not VT\_BYREF, for example when handling arguments in an implementation of [**IDispatch::Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span></span>

## <a name="notes-to-callers"></a><span data-ttu-id="13679-166">Notas a los autores de las llamadas</span><span class="sxs-lookup"><span data-stu-id="13679-166">Notes to Callers</span></span>

<span data-ttu-id="13679-167">Se recomienda que los conjuntos de propiedades se creen como Unicode, si no se establece la \_ marca ANSI PROPSETFLAG en el parámetro *GrfFlags* de [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span><span class="sxs-lookup"><span data-stu-id="13679-167">It is recommended that property sets be created as Unicode, by not setting the PROPSETFLAG\_ANSI flag in the *grfFlags* parameter of [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span></span> <span data-ttu-id="13679-168">También se recomienda evitar el uso de \_ valores de VT LPSTR y usar valores de VT \_ LPWStr en su lugar.</span><span class="sxs-lookup"><span data-stu-id="13679-168">It is also recommended that you avoid using VT\_LPSTR values, and use VT\_LPWSTR values instead.</span></span> <span data-ttu-id="13679-169">Cuando la página de códigos del conjunto de propiedades es Unicode, \_ los valores de cadena de VT LPSTR se convierten a Unicode cuando se almacenan y de nuevo a valores de cadena multibyte cuando se recuperan.</span><span class="sxs-lookup"><span data-stu-id="13679-169">When the property set code page is Unicode, VT\_LPSTR string values are converted to Unicode when stored, and back to multibyte string values when retrieved.</span></span> <span data-ttu-id="13679-170">Cuando la página de códigos de la propiedad establecida no es Unicode, los nombres de propiedad, las \_ cadenas VT BSTR y los valores de propiedad no simples se convierten en cadenas multibyte cuando se almacenan y se convierten de nuevo a Unicode cuando se recuperan, todo el uso de la página de códigos ANSI del sistema actual.</span><span class="sxs-lookup"><span data-stu-id="13679-170">When the code page of the property set is not Unicode, property names, VT\_BSTR strings, and non-simple property values are converted to multibyte strings when stored, and converted back to Unicode when retrieved, all using the current system ANSI code page.</span></span>

## <a name="notes-to-implementers"></a><span data-ttu-id="13679-171">Notas a los implementadores</span><span class="sxs-lookup"><span data-stu-id="13679-171">Notes to Implementers</span></span>

<span data-ttu-id="13679-172">Al asignar un identificador de propiedad, la implementación puede elegir cualquier valor que no esté en uso en el conjunto de propiedades de un identificador de propiedad, siempre que no sea 0 ni 1 o mayor que 0x80000000, todos los cuales son valores reservados.</span><span class="sxs-lookup"><span data-stu-id="13679-172">When allocating a property identifier, the implementation can choose any value not currently in use in the property set for a property identifier, as long as it is not 0 or 1 or greater than 0x80000000, all of which are reserved values.</span></span> <span data-ttu-id="13679-173">El parámetro *propidNameFirst* establece un valor mínimo para los identificadores de propiedad dentro del conjunto y debe ser mayor que 1 y menor que 0x80000000.</span><span class="sxs-lookup"><span data-stu-id="13679-173">The *propidNameFirst* parameter establishes a minimum value for property identifiers within the set, and must be greater than 1 and less than 0x80000000.</span></span> <span data-ttu-id="13679-174">Vea la sección Comentarios anterior.</span><span class="sxs-lookup"><span data-stu-id="13679-174">See Remarks section above.</span></span>

## <a name="related-topics"></a><span data-ttu-id="13679-175">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="13679-175">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="13679-176">IPropertyStorage: implementación de archivos compuestos</span><span class="sxs-lookup"><span data-stu-id="13679-176">IPropertyStorage-Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="13679-177">IPropertyStorage: implementación del sistema de archivos NTFS</span><span class="sxs-lookup"><span data-stu-id="13679-177">IPropertyStorage-NTFS File System Implementation</span></span>](ipropertystorage-ntfs-file-system-implementation.md)
</dt> <dt>

[<span data-ttu-id="13679-178">IPropertyStorage: implementación independiente</span><span class="sxs-lookup"><span data-stu-id="13679-178">IPropertyStorage-Stand-alone Implementation</span></span>](ipropertystorage-stand-alone-implementation.md)
</dt> </dl>

 

 