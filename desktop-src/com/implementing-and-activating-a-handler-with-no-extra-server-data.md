---
title: Implementar y activar un controlador sin datos de servidor adicionales
description: Implementar y activar un controlador sin datos de servidor adicionales
ms.assetid: 9d91260a-4cec-4a10-bb57-d02999efae47
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6866b40e1257a865aa5068ffd46611c411498877
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/03/2021
ms.locfileid: "104003257"
---
# <a name="implementing-and-activating-a-handler-with-no-extra-server-data"></a><span data-ttu-id="73e73-103">Implementar y activar un controlador sin datos de servidor adicionales</span><span class="sxs-lookup"><span data-stu-id="73e73-103">Implementing and Activating a Handler with No Extra Server Data</span></span>

<span data-ttu-id="73e73-104">Para crear una instancia del controlador, si es una que no obtiene datos de servidor adicionales, el servidor debe implementar [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) pero no [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="73e73-104">To create an instance of your handler, if it is one that gets no extra server data, the server must implement [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) but not [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="73e73-105">**IStdMarshalInfo** tiene un método, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), que recupera el CLSID del controlador de objetos que se va a usar en el proceso de destino.</span><span class="sxs-lookup"><span data-stu-id="73e73-105">**IStdMarshalInfo** has one method, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), which retrieves the CLSID of the object handler to be used in the destination process.</span></span> <span data-ttu-id="73e73-106">COM lo llama cuando llama a [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) para usted y activa el controlador en el lado cliente.</span><span class="sxs-lookup"><span data-stu-id="73e73-106">COM calls this when it calls [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) for you and activates the handler on the client side.</span></span>

<span data-ttu-id="73e73-107">A continuación, las implementaciones del servidor y del controlador deben llamar a la función [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) .</span><span class="sxs-lookup"><span data-stu-id="73e73-107">Next, both the server and handler implementations must call the [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) function.</span></span> <span data-ttu-id="73e73-108">Esta función crea un serializador estándar en cada lado (denominado administrador de proxy en el lado cliente y un administrador de código auxiliar en el lado servidor).</span><span class="sxs-lookup"><span data-stu-id="73e73-108">This function creates a standard marshaler on each side (called a proxy manager on the client side and a stub manager on the server side).</span></span>

<span data-ttu-id="73e73-109">El servidor llama a [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), pasando el marcador SMEXF \_ Server.</span><span class="sxs-lookup"><span data-stu-id="73e73-109">The server calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_SERVER.</span></span> <span data-ttu-id="73e73-110">Esto crea un contador de referencias estándar del lado servidor (Administrador de código auxiliar).</span><span class="sxs-lookup"><span data-stu-id="73e73-110">This creates a server-side standard marshaler (stub manager).</span></span> <span data-ttu-id="73e73-111">La estructura del lado servidor se muestra en la siguiente ilustración:</span><span class="sxs-lookup"><span data-stu-id="73e73-111">The server-side structure is shown in the following illustration:</span></span>

![Diagrama que muestra la estructura del lado servidor.](images/b47b3bc0-3e7d-4be4-9767-7ae436bd1b21.png)

## <a name="server-side-structure"></a><span data-ttu-id="73e73-113">Estructura de Server-Side</span><span class="sxs-lookup"><span data-stu-id="73e73-113">Server-Side Structure</span></span>

<span data-ttu-id="73e73-114">El controlador llama a [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), pasando el controlador de marcador SMEXF \_ .</span><span class="sxs-lookup"><span data-stu-id="73e73-114">The handler calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_HANDLER.</span></span> <span data-ttu-id="73e73-115">Esto crea un serializador estándar del lado cliente (Administrador de proxy) y lo agrega con el controlador en el lado cliente.</span><span class="sxs-lookup"><span data-stu-id="73e73-115">This creates a client-side standard marshaler (proxy manager) and aggregates it with the handler on the client side.</span></span> <span data-ttu-id="73e73-116">La duración de ambos se administra mediante el objeto de identidad de control (que implementa [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) que el sistema implementa cuando el controlador llama a **CoGetStdMarshalEx**.</span><span class="sxs-lookup"><span data-stu-id="73e73-116">The lifetime of both are managed by the controlling identity object (implementing [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) that the system implements when the handler calls **CoGetStdMarshalEx**.</span></span> <span data-ttu-id="73e73-117">La estructura del lado cliente se muestra en la siguiente ilustración.</span><span class="sxs-lookup"><span data-stu-id="73e73-117">The client-side structure is shown in the following illustration.</span></span>

![Diagrama que muestra la estructura del lado cliente.](images/24ae70ef-dfa8-4784-90ac-dc6cfb043ee5.png)

## <a name="client-side-structure"></a><span data-ttu-id="73e73-119">Estructura de Client-Side</span><span class="sxs-lookup"><span data-stu-id="73e73-119">Client-Side Structure</span></span>

<span data-ttu-id="73e73-120">Tal y como se muestra en la ilustración anterior, el controlador se presenta en forma de sándwich entre el administrador del proxy y la identidad o el control desconocido.</span><span class="sxs-lookup"><span data-stu-id="73e73-120">As shown in the preceding illustration, the handler is actually sandwiched between the proxy manager and the identity/controlling unknown.</span></span> <span data-ttu-id="73e73-121">Esto proporciona al control del sistema la duración del objeto, a la vez que proporciona al controlador el control sobre las interfaces expuestas.</span><span class="sxs-lookup"><span data-stu-id="73e73-121">This gives the system control over the lifetime of the object while giving the handler control over the exposed interfaces.</span></span> <span data-ttu-id="73e73-122">La línea discontinua entre el administrador de identidades y el proxy indica que los dos comparten una estrecha integración a través de interfaces privadas internas.</span><span class="sxs-lookup"><span data-stu-id="73e73-122">The dashed line between the Identity and Proxy Manager indicates that the two share tight integration through internal private interfaces.</span></span>

<span data-ttu-id="73e73-123">Cuando COM llama a [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) para el cliente, crea la instancia de controlador y la agrega con la identidad.</span><span class="sxs-lookup"><span data-stu-id="73e73-123">When COM calls [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) for the client, it creates the handler instance, aggregating it with the Identity.</span></span> <span data-ttu-id="73e73-124">El controlador creará el serializador estándar (a través de la llamada a [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), pasando el control desconocido recibido cuando se creó).</span><span class="sxs-lookup"><span data-stu-id="73e73-124">The handler will create the standard marshaler (through the call to [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the controlling unknown it received when it was created).</span></span> <span data-ttu-id="73e73-125">El controlador no implementa [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , sino que solo devuelve **IMarshal** del serializador estándar.</span><span class="sxs-lookup"><span data-stu-id="73e73-125">The handler does not implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) but just returns **IMarshal** from the standard marshaler.</span></span> <span data-ttu-id="73e73-126">Incluso si el controlador implementa **IMarshal**, no se le llamará durante una conversión de referencias.</span><span class="sxs-lookup"><span data-stu-id="73e73-126">Even if the handler does implement **IMarshal**, it will not get called during an unmarshal.</span></span>

<span data-ttu-id="73e73-127">Si dos subprocesos anulan simultáneamente la serialización del mismo objeto por primera vez, es posible que se creen temporalmente dos controladores.</span><span class="sxs-lookup"><span data-stu-id="73e73-127">If two threads simultaneously unmarshal the same object for the first time, it is possible for two handlers to get created temporarily.</span></span> <span data-ttu-id="73e73-128">Posteriormente, se liberará uno.</span><span class="sxs-lookup"><span data-stu-id="73e73-128">One will subsequently be released.</span></span>

## <a name="related-topics"></a><span data-ttu-id="73e73-129">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="73e73-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="73e73-130">Controlador de Client-Side ligero</span><span class="sxs-lookup"><span data-stu-id="73e73-130">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 