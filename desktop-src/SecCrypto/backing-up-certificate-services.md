---
description: Cómo puede usar las funciones de copia de seguridad de servicios de servidor de certificados para realizar una copia de seguridad de una base de datos de servicios de certificados y sus archivos asociados.
ms.assetid: f5c9c9f9-5211-4151-b8e0-3351d462c71b
title: Copia de seguridad de servicios de Certificate Server
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1be929fcf3bd9b8b9655b48758a97d19af7abc7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "103913425"
---
# <a name="backing-up-certificate-services"></a><span data-ttu-id="f0067-103">Copia de seguridad de servicios de Certificate Server</span><span class="sxs-lookup"><span data-stu-id="f0067-103">Backing Up Certificate Services</span></span>

<span data-ttu-id="f0067-104">A continuación se muestra un escenario en el que se muestra cómo se pueden usar las funciones de copia de seguridad de servicios de servidor de certificados para realizar una copia de seguridad de una base de datos de servicios de certificados y</span><span class="sxs-lookup"><span data-stu-id="f0067-104">The following is a scenario showing how you can use the Certificate Services backup functions to back up a Certificate Services database and its associated files.</span></span>

1.  <span data-ttu-id="f0067-105">Cargue la biblioteca de Certadm.dll en la memoria (llamando a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span><span class="sxs-lookup"><span data-stu-id="f0067-105">Load the Certadm.dll library into memory (by calling [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span></span>
2.  <span data-ttu-id="f0067-106">Recupere la dirección de cada una de las funciones necesarias en Certadm.dll (mediante [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)).</span><span class="sxs-lookup"><span data-stu-id="f0067-106">Retrieve the address of each of the necessary functions in Certadm.dll (by means of [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)).</span></span> <span data-ttu-id="f0067-107">Use estas direcciones al llamar a las funciones en los pasos restantes.</span><span class="sxs-lookup"><span data-stu-id="f0067-107">Use these addresses when calling the functions in the remaining steps.</span></span>
3.  <span data-ttu-id="f0067-108">Llame a [**CertSrvIsServerOnline**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvisserveronlinew) para determinar si los servicios de Certificate Server están en línea.</span><span class="sxs-lookup"><span data-stu-id="f0067-108">Call [**CertSrvIsServerOnline**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvisserveronlinew) to determine whether Certificate Services is online.</span></span> <span data-ttu-id="f0067-109">Los servicios de Certificate Server deben estar en línea para que las operaciones de copia de seguridad se realicen correctamente.</span><span class="sxs-lookup"><span data-stu-id="f0067-109">Certificate Services must be online for the backup operations to be successful.</span></span>
4.  <span data-ttu-id="f0067-110">Llame a [**CertSrvBackupPrepare**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuppreparew) para iniciar una sesión de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-110">Call [**CertSrvBackupPrepare**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuppreparew) to start a backup session.</span></span> <span data-ttu-id="f0067-111">Muchas de las otras funciones de copia de seguridad utilizarán el identificador de contexto de copia de seguridad de servicios de certificados resultante.</span><span class="sxs-lookup"><span data-stu-id="f0067-111">The resulting Certificate Services backup context handle will be used by many of the other backup functions.</span></span>
5.  <span data-ttu-id="f0067-112">Llame a [**CertSrvRestoreGetDatabaseLocations**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvrestoregetdatabaselocationsw) para determinar la asignación de restauración.</span><span class="sxs-lookup"><span data-stu-id="f0067-112">Call [**CertSrvRestoreGetDatabaseLocations**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvrestoregetdatabaselocationsw) to determine the restore map.</span></span> <span data-ttu-id="f0067-113">La asignación de restauración contiene las rutas de acceso que se van a usar al restaurar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-113">The restore map contains the paths to be used when restoring the backup.</span></span> <span data-ttu-id="f0067-114">Guarde la información recuperada por **CertSrvRestoreGetDatabaseLocations** en una ubicación específica de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f0067-114">Save the information retrieved by **CertSrvRestoreGetDatabaseLocations** to an application-specific location.</span></span>
6.  <span data-ttu-id="f0067-115">Llame a [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) para determinar los nombres de los archivos de base de datos que se van a copiar.</span><span class="sxs-lookup"><span data-stu-id="f0067-115">Call [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) to determine the names of the database files to backup.</span></span> <span data-ttu-id="f0067-116">Para cada uno de estos archivos, ejecute los pasos del 7 al 9.</span><span class="sxs-lookup"><span data-stu-id="f0067-116">For each of these files, execute steps 7 through 9.</span></span>
7.  <span data-ttu-id="f0067-117">Llame a [**CertSrvBackupOpenFile**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupopenfilew) para abrir el archivo de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-117">Call [**CertSrvBackupOpenFile**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupopenfilew) to open the file for backup.</span></span>
8.  <span data-ttu-id="f0067-118">Llame a [**CertSrvBackupRead**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupread) para leer una parte de los bytes del archivo y, a continuación, llame a una rutina específica de la aplicación para almacenar los bytes en un medio de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-118">Call [**CertSrvBackupRead**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupread) to read a portion of bytes from the file, then call an application-specific routine to store the bytes on a backup medium.</span></span> <span data-ttu-id="f0067-119">Repita este paso hasta que se realice una copia de seguridad de todos los bytes del archivo.</span><span class="sxs-lookup"><span data-stu-id="f0067-119">Repeat this step until all of the bytes in the file are backed up.</span></span>
9.  <span data-ttu-id="f0067-120">Llame a [**CertSrvBackupClose**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupclose) para cerrar el archivo.</span><span class="sxs-lookup"><span data-stu-id="f0067-120">Call [**CertSrvBackupClose**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupclose) to close the file.</span></span>
10. <span data-ttu-id="f0067-121">Llame a [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) para determinar los nombres de los archivos de registro en los que se va a realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-121">Call [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) to determine the names of the log files to backup.</span></span> <span data-ttu-id="f0067-122">Para cada uno de estos archivos, ejecute los pasos del 7 al 9.</span><span class="sxs-lookup"><span data-stu-id="f0067-122">For each of these files, execute steps 7 through 9.</span></span>
11. <span data-ttu-id="f0067-123">Llame a [**CertSrvBackupTruncateLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuptruncatelogs) para truncar los archivos de registro de los que se realizó una copia de seguridad en los pasos 6 y 10.</span><span class="sxs-lookup"><span data-stu-id="f0067-123">Call [**CertSrvBackupTruncateLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuptruncatelogs) to truncate the log files which were backed up in steps 6 and 10.</span></span> <span data-ttu-id="f0067-124">Este paso es opcional; sin embargo, llame a **CertSrvBackupTruncateLogs** solo si se ha realizado una copia de seguridad de todos los archivos devueltos por [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) y [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) (de lo contrario, se producirá un error en la operación de restauración).</span><span class="sxs-lookup"><span data-stu-id="f0067-124">This step is optional; however, call **CertSrvBackupTruncateLogs** only if all files returned by [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) and [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) have been backed up (otherwise, the restore operation will fail).</span></span> <span data-ttu-id="f0067-125">Consulte la página de referencia de **CertSrvBackupTruncateLogs** para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="f0067-125">Consult the **CertSrvBackupTruncateLogs** reference page for details.</span></span>
12. <span data-ttu-id="f0067-126">Llame a [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) para determinar los nombres de los archivos que no son de base de datos para realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-126">Call [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) to determine the names of the non-database files to backup.</span></span> <span data-ttu-id="f0067-127">Estos archivos solo se identifican mediante la función y se deben realizar copias de seguridad de otros medios.</span><span class="sxs-lookup"><span data-stu-id="f0067-127">These files are only identified by the function, and must be backed up by some other means.</span></span>
13. <span data-ttu-id="f0067-128">Realice una copia de seguridad de los archivos dinámicos identificados en el paso 12, utilizando rutinas independientes de Certadm.dll.</span><span class="sxs-lookup"><span data-stu-id="f0067-128">Backup the dynamic files identified in step 12, using routines separate from Certadm.dll.</span></span>
14. <span data-ttu-id="f0067-129">Llame a [**CertSrvBackupEnd**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupend) para finalizar la sesión de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f0067-129">Call [**CertSrvBackupEnd**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupend) to end the backup session.</span></span>
15. <span data-ttu-id="f0067-130">Llame a [**CertSrvBackupFree**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupfree) según sea necesario para liberar los búferes asignados por determinadas funciones de copia de seguridad de servicios de certificados.</span><span class="sxs-lookup"><span data-stu-id="f0067-130">Call [**CertSrvBackupFree**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupfree) as needed to release buffers allocated by certain Certificate Services backup functions.</span></span> <span data-ttu-id="f0067-131">Las llamadas a [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw), [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw)y [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) asignarán los búferes que se pueden liberar mediante una llamada a **CertSrvBackupFree**.</span><span class="sxs-lookup"><span data-stu-id="f0067-131">Calls to [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw), [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw), and [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) will allocate buffers that can be freed by a call to **CertSrvBackupFree**.</span></span>
16. <span data-ttu-id="f0067-132">Libere los recursos de Certadm.dll llamando a [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary).</span><span class="sxs-lookup"><span data-stu-id="f0067-132">Release the Certadm.dll resources by calling [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary).</span></span>

<span data-ttu-id="f0067-133">Para obtener información acerca de los privilegios necesarios para realizar una copia de seguridad de la base de datos de servicios de certificados y los archivos asociados, vea [establecer los privilegios de copia de seguridad y restauración](setting-the-backup-and-restore-privileges.md).</span><span class="sxs-lookup"><span data-stu-id="f0067-133">For information about the privileges required to back up the Certificate Services database and associated files, see [Setting the Backup and Restore Privileges](setting-the-backup-and-restore-privileges.md).</span></span>

 

 
