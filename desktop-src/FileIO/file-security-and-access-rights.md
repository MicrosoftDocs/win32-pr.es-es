---
description: Dado que los archivos son objetos protegibles, el acceso a ellos está regulado por el modelo de control de acceso que rige el acceso a todos los demás objetos protegibles en Windows.
ms.assetid: 991d7d94-fae7-406f-b2e3-dee811279366
title: Derechos de acceso y seguridad de archivos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b161dd78c7585cf6de2781d7339787a22bde95dc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105666841"
---
# <a name="file-security-and-access-rights"></a><span data-ttu-id="aa4ef-103">Derechos de acceso y seguridad de archivos</span><span class="sxs-lookup"><span data-stu-id="aa4ef-103">File Security and Access Rights</span></span>

<span data-ttu-id="aa4ef-104">Dado que los archivos son [objetos protegibles](/windows/desktop/SecAuthZ/securable-objects), el acceso a ellos está regulado por el modelo de control de acceso que rige el acceso a todos los demás objetos protegibles en Windows.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-104">Because files are [securable objects](/windows/desktop/SecAuthZ/securable-objects), access to them is regulated by the access-control model that governs access to all other securable objects in Windows.</span></span> <span data-ttu-id="aa4ef-105">Para obtener una explicación detallada de este modelo, vea [Access Control](/windows/desktop/SecAuthZ/access-control).</span><span class="sxs-lookup"><span data-stu-id="aa4ef-105">For a detailed explanation of this model, see [Access Control](/windows/desktop/SecAuthZ/access-control).</span></span>

<span data-ttu-id="aa4ef-106">Puede especificar un [descriptor de seguridad](/windows/desktop/api/winnt/ns-winnt-security_descriptor) para un archivo o directorio cuando llame a la función [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya)o [**CreateDirectoryEx**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) .</span><span class="sxs-lookup"><span data-stu-id="aa4ef-106">You can specify a [security descriptor](/windows/desktop/api/winnt/ns-winnt-security_descriptor) for a file or directory when you call the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya), or [**CreateDirectoryEx**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) function.</span></span> <span data-ttu-id="aa4ef-107">Si especifica **null** para el parámetro *lpSecurityAttributes* , el archivo o el directorio obtiene un descriptor de seguridad predeterminado.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-107">If you specify **NULL** for the *lpSecurityAttributes* parameter, the file or directory gets a default security descriptor.</span></span> <span data-ttu-id="aa4ef-108">Las listas de control de acceso (ACL) del descriptor de seguridad predeterminado para un archivo o directorio se heredan de su directorio principal.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-108">The access control lists (ACL) in the default security descriptor for a file or directory are inherited from its parent directory.</span></span> <span data-ttu-id="aa4ef-109">Tenga en cuenta que se asigna un descriptor de seguridad predeterminado solo cuando se crea un archivo o un directorio recientemente, y no cuando se cambia el nombre o se mueve.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-109">Note that a default security descriptor is assigned only when a file or directory is newly created, and not when it is renamed or moved.</span></span>

<span data-ttu-id="aa4ef-110">Para recuperar el descriptor de seguridad de un archivo o un objeto de directorio, llame a la función [**GetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) o [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) .</span><span class="sxs-lookup"><span data-stu-id="aa4ef-110">To retrieve the security descriptor of a file or directory object, call the [**GetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) or [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) function.</span></span> <span data-ttu-id="aa4ef-111">Para cambiar el descriptor de seguridad de un archivo o un objeto de directorio, llame a la función [**SetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) o [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) .</span><span class="sxs-lookup"><span data-stu-id="aa4ef-111">To change the security descriptor of a file or directory object, call the [**SetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) or [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) function.</span></span>

<span data-ttu-id="aa4ef-112">Los derechos de acceso válidos para archivos y directorios incluyen los derechos de acceso de **eliminación**, **\_ control de lectura**, **escritura de \_ DAC**, **\_ propietario de escritura** y **sincronizar** [estándar](/windows/desktop/SecAuthZ/standard-access-rights).</span><span class="sxs-lookup"><span data-stu-id="aa4ef-112">The valid access rights for files and directories include the **DELETE**, **READ\_CONTROL**, **WRITE\_DAC**, **WRITE\_OWNER**, and **SYNCHRONIZE** [standard access rights](/windows/desktop/SecAuthZ/standard-access-rights).</span></span> <span data-ttu-id="aa4ef-113">La tabla de [**constantes de derechos de acceso a archivos**](file-access-rights-constants.md) enumera los derechos de acceso que son específicos de los archivos y directorios.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-113">The table in [**File Access Rights Constants**](file-access-rights-constants.md) lists the access rights that are specific to files and directories.</span></span>

<span data-ttu-id="aa4ef-114">Aunque el derecho de acceso **SYNCHRONIZE** se define en la lista de [derechos de acceso estándar](/windows/desktop/SecAuthZ/standard-access-rights) como el derecho a especificar un identificador de archivo en una de las funciones de espera, al usar operaciones asincrónicas de e/s de archivos, debe esperar en el controlador de eventos contenido en una estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) correctamente configurada en lugar de usar el identificador de archivo con el derecho de acceso **SYNCHRONIZE** para la sincronización</span><span class="sxs-lookup"><span data-stu-id="aa4ef-114">Although the **SYNCHRONIZE** access right is defined within the [standard access rights](/windows/desktop/SecAuthZ/standard-access-rights) list as the right to specify a file handle in one of the wait functions, when using asynchronous file I/O operations you should wait on the event handle contained in a properly configured [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure rather than using the file handle with the **SYNCHRONIZE** access right for synchronization.</span></span>

<span data-ttu-id="aa4ef-115">A continuación se muestran los [derechos de acceso genéricos](/windows/desktop/SecAuthZ/generic-access-rights) para archivos y directorios.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-115">The following are the [generic access rights](/windows/desktop/SecAuthZ/generic-access-rights) for files and directories.</span></span>



<table>
<thead>
<tr class="header">
<th><span data-ttu-id="aa4ef-116">Derecho de acceso</span><span class="sxs-lookup"><span data-stu-id="aa4ef-116">Access right</span></span></th>
<th><span data-ttu-id="aa4ef-117">Descripción</span><span class="sxs-lookup"><span data-stu-id="aa4ef-117">Description</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="aa4ef-118"><strong>FILE_GENERIC_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-118"><strong>FILE_GENERIC_EXECUTE</strong></span></span></td>
<td><dl> <span data-ttu-id="aa4ef-119"><strong>FILE_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-119"><strong>FILE_EXECUTE</strong></span></span><br /><span data-ttu-id="aa4ef-120">
<strong>FILE_READ_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-120">
<strong>FILE_READ_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="aa4ef-121">
<strong>STANDARD_RIGHTS_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-121">
<strong>STANDARD_RIGHTS_EXECUTE</strong></span></span><br /><span data-ttu-id="aa4ef-122">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-122">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
<tr class="even">
<td><span data-ttu-id="aa4ef-123"><strong>FILE_GENERIC_READ</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-123"><strong>FILE_GENERIC_READ</strong></span></span></td>
<td><dl> <span data-ttu-id="aa4ef-124"><strong>FILE_READ_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-124"><strong>FILE_READ_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="aa4ef-125">
<strong>FILE_READ_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-125">
<strong>FILE_READ_DATA</strong></span></span><br /><span data-ttu-id="aa4ef-126">
<strong>FILE_READ_EA</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-126">
<strong>FILE_READ_EA</strong></span></span><br /><span data-ttu-id="aa4ef-127">
<strong>STANDARD_RIGHTS_READ</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-127">
<strong>STANDARD_RIGHTS_READ</strong></span></span><br /><span data-ttu-id="aa4ef-128">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-128">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="aa4ef-129"><strong>FILE_GENERIC_WRITE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-129"><strong>FILE_GENERIC_WRITE</strong></span></span></td>
<td><dl> <span data-ttu-id="aa4ef-130"><strong>FILE_APPEND_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-130"><strong>FILE_APPEND_DATA</strong></span></span><br /><span data-ttu-id="aa4ef-131">
<strong>FILE_WRITE_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-131">
<strong>FILE_WRITE_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="aa4ef-132">
<strong>FILE_WRITE_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-132">
<strong>FILE_WRITE_DATA</strong></span></span><br /><span data-ttu-id="aa4ef-133">
<strong>FILE_WRITE_EA</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-133">
<strong>FILE_WRITE_EA</strong></span></span><br /><span data-ttu-id="aa4ef-134">
<strong>STANDARD_RIGHTS_WRITE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-134">
<strong>STANDARD_RIGHTS_WRITE</strong></span></span><br /><span data-ttu-id="aa4ef-135">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="aa4ef-135">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
</tbody>
</table>



 

<span data-ttu-id="aa4ef-136">Windows compara los derechos de acceso solicitados y la información del token de acceso del subproceso con la información del descriptor de seguridad del objeto de archivo o directorio.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-136">Windows compares the requested access rights and the information in the thread's access token with the information in the file or directory object's security descriptor.</span></span> <span data-ttu-id="aa4ef-137">Si la comparación no prohíbe que se concedan todos los derechos de acceso solicitados, se devuelve un identificador al objeto al subproceso y se conceden los derechos de acceso.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-137">If the comparison does not prohibit all of the requested access rights from being granted, a handle to the object is returned to the thread and the access rights are granted.</span></span> <span data-ttu-id="aa4ef-138">Para obtener más información sobre este proceso, vea [interacción entre subprocesos y objetos protegibles](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).</span><span class="sxs-lookup"><span data-stu-id="aa4ef-138">For more information about this process, see [Interaction between Threads and Securable Objects](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).</span></span>

<span data-ttu-id="aa4ef-139">De forma predeterminada, la autorización para el acceso a un archivo o directorio lo controlan estrictamente las ACL en el descriptor de seguridad asociado a ese archivo o directorio.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-139">By default, authorization for access to a file or directory is controlled strictly by the ACLs in the security descriptor associated with that file or directory.</span></span> <span data-ttu-id="aa4ef-140">En concreto, el descriptor de seguridad de un directorio primario no se utiliza para controlar el acceso a cualquier archivo o directorio secundario.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-140">In particular, the security descriptor of a parent directory is not used to control access to any child file or directory.</span></span> <span data-ttu-id="aa4ef-141">Se puede aplicar el [derecho de acceso a](/windows/desktop/SecAuthZ/access-rights-and-access-masks) **\_ recorrido de archivos** si se quita el [privilegio](/windows/desktop/SecAuthZ/privileges) **omitir \_ \_ comprobación de recorrido** de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-141">The **FILE\_TRAVERSE** [access right](/windows/desktop/SecAuthZ/access-rights-and-access-masks) can be enforced by removing the **BYPASS\_TRAVERSE\_CHECKING** [privilege](/windows/desktop/SecAuthZ/privileges) from users.</span></span> <span data-ttu-id="aa4ef-142">Esto no se recomienda en el caso general, ya que muchos programas no controlan correctamente los errores transversales del directorio.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-142">This is not recommended in the general case, as many programs do not correctly handle directory traversal errors.</span></span> <span data-ttu-id="aa4ef-143">El uso principal del derecho de acceso de **\_ recorrido de archivos** en los directorios es habilitar la conformidad con determinados estándares POSIX de IEEE e ISO cuando la interoperabilidad con sistemas Unix es un requisito.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-143">The primary use for the **FILE\_TRAVERSE** access right on directories is to enable conformance to certain IEEE and ISO POSIX standards when interoperability with Unix systems is a requirement.</span></span>

<span data-ttu-id="aa4ef-144">El modelo de seguridad de Windows proporciona una manera de que un directorio secundario herede o no se herede, una o varias de las ACE del descriptor de seguridad del directorio principal.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-144">The Windows security model provides a way for a child directory to inherit, or to be prevented from inheriting, one or more of the ACEs in the parent directory's security descriptor.</span></span> <span data-ttu-id="aa4ef-145">Cada ACE contiene información que determina cómo se puede heredar y si tendrá efecto en el objeto de directorio heredado.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-145">Each ACE contains information that determines how it can be inherited, and whether it will have an effect on the inheriting directory object.</span></span> <span data-ttu-id="aa4ef-146">Por ejemplo, algunas ACE heredadas controlan el acceso al objeto de directorio heredado, y se denominan *ACE efectivas*.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-146">For example, some inherited ACEs control access to the inherited directory object, and these are called *effective ACEs*.</span></span> <span data-ttu-id="aa4ef-147">Todas las demás ACE se denominan *ACE de solo herencia*.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-147">All other ACEs are called *inherit-only ACEs*.</span></span>

<span data-ttu-id="aa4ef-148">El modelo de seguridad de Windows también aplica la herencia automática de ACE a objetos secundarios de acuerdo con las [reglas de herencia de ACE](/windows/desktop/SecAuthZ/ace-inheritance-rules).</span><span class="sxs-lookup"><span data-stu-id="aa4ef-148">The Windows security model also enforces the automatic inheritance of ACEs to child objects according to the [ACE inheritance rules](/windows/desktop/SecAuthZ/ace-inheritance-rules).</span></span> <span data-ttu-id="aa4ef-149">Esta herencia automática, junto con la información de herencia en cada ACE, determina cómo se pasan las restricciones de seguridad a la jerarquía de directorios.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-149">This automatic inheritance, along with the inheritance information in each ACE, determines how security restrictions are passed down the directory hierarchy.</span></span>

<span data-ttu-id="aa4ef-150">Tenga en cuenta que no puede usar una ACE de acceso denegado para denegar solo el acceso de **\_ escritura** genérico o de solo **\_ lectura** a un archivo.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-150">Note that you cannot use an access-denied ACE to deny only **GENERIC\_READ** or only **GENERIC\_WRITE** access to a file.</span></span> <span data-ttu-id="aa4ef-151">Esto se debe a que, en el caso de los objetos de archivo, las asignaciones genéricas tanto para **\_ lectura** genérica como para **\_ escritura genérica** incluyen el derecho de acceso **SYNCHRONIZE** .</span><span class="sxs-lookup"><span data-stu-id="aa4ef-151">This is because for file objects, the generic mappings for both **GENERIC\_READ** or **GENERIC\_WRITE** include the **SYNCHRONIZE** access right.</span></span> <span data-ttu-id="aa4ef-152">Si una ACE deniega el acceso de **\_ escritura genérico** a un administrador de confianza y el administrador de confianza solicita acceso de **\_ lectura genérico** , se producirá un error en la solicitud porque la solicitud incluye implícitamente el acceso a la **sincronización** que la ACE deniega implícitamente y viceversa.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-152">If an ACE denies **GENERIC\_WRITE** access to a trustee, and the trustee requests **GENERIC\_READ** access, the request will fail because the request implicitly includes **SYNCHRONIZE** access which is implicitly denied by the ACE, and vice versa.</span></span> <span data-ttu-id="aa4ef-153">En lugar de usar ACE de acceso denegado, use ACE con acceso permitido para permitir explícitamente los derechos de acceso permitidos.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-153">Instead of using access-denied ACEs, use access-allowed ACEs to explicitly allow the permitted access rights.</span></span>

<span data-ttu-id="aa4ef-154">Otro medio para administrar el acceso a los objetos de almacenamiento es el cifrado.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-154">Another means of managing access to storage objects is encryption.</span></span> <span data-ttu-id="aa4ef-155">La implementación del cifrado del sistema de archivos en Windows es el sistema de archivos cifrado o EFS.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-155">The implementation of file system encryption in Windows is the Encrypted File System, or EFS.</span></span> <span data-ttu-id="aa4ef-156">EFS solo cifra archivos y no directorios.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-156">EFS encrypts only files and not directories.</span></span> <span data-ttu-id="aa4ef-157">La ventaja del cifrado es que proporciona protección adicional a los archivos que se aplican en los medios y no a través del sistema de archivos y la arquitectura estándar de control de acceso de Windows.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-157">The advantage of encryption is that it provides additional protection to files that is applied on the media and not through the file system and the standard Windows access control architecture.</span></span> <span data-ttu-id="aa4ef-158">Para obtener más información sobre el cifrado de archivos, vea [cifrado de archivos](file-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="aa4ef-158">For more information on file encryption, see [File Encryption](file-encryption.md).</span></span>

<span data-ttu-id="aa4ef-159">En la mayoría de los casos, la capacidad de leer y escribir la configuración de seguridad de un objeto de archivo o directorio está restringida a los procesos de modo kernel.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-159">In most cases, the ability to read and write the security settings of a file or directory object is restricted to kernel-mode processes.</span></span> <span data-ttu-id="aa4ef-160">Claramente, no desea que ningún proceso de usuario pueda cambiar la propiedad o la restricción de acceso en el archivo o directorio privado.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-160">Clearly, you would not want any user process to be able to change the ownership or access restriction on your private file or directory.</span></span> <span data-ttu-id="aa4ef-161">Sin embargo, una aplicación de copia de seguridad no podría completar su trabajo de copia de seguridad del archivo si las restricciones de acceso que ha colocado en el archivo o directorio no permiten que el proceso de modo de usuario de la aplicación lo lea.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-161">However, a backup application would not be able to complete its job of backing up your file if the access restrictions you have placed on your file or directory does not allow the application's user-mode process to read it.</span></span> <span data-ttu-id="aa4ef-162">Las aplicaciones de copia de seguridad deben poder invalidar la configuración de seguridad de los objetos de archivo y directorio para garantizar una copia de seguridad completa.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-162">Backup applications must be able to override the security settings of file and directory objects to ensure a complete backup.</span></span> <span data-ttu-id="aa4ef-163">Del mismo modo, si una aplicación de copia de seguridad intenta escribir una copia de seguridad del archivo a través de la copia residente en disco y deniega explícitamente privilegios de escritura al proceso de la aplicación de copia de seguridad, la operación de restauración no se puede completar.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-163">Similarly, if a backup application attempts to write a backup copy of your file over the disk-resident copy, and you explicitly deny write privileges to the backup application process, the restore operation cannot complete.</span></span> <span data-ttu-id="aa4ef-164">En este caso, la aplicación de copia de seguridad debe ser capaz de invalidar la configuración de control de acceso del archivo.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-164">In this case also, the backup application must be able to override the access control settings of your file.</span></span>

<span data-ttu-id="aa4ef-165">Los privilegios de acceso de nombre de **\_ copia de seguridad \_** y **\_ restauración \_** de se han creado específicamente para proporcionar esta capacidad para realizar copias de seguridad de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-165">The **SE\_BACKUP\_NAME** and **SE\_RESTORE\_NAME** access privileges were specifically created to provide this ability to backup applications.</span></span> <span data-ttu-id="aa4ef-166">Si estos privilegios se han concedido y habilitado en el token de acceso del proceso de la aplicación de copia de seguridad, puede llamar a [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) para abrir el archivo o directorio de la copia de seguridad, especificando el derecho de acceso de **\_ control de lectura** estándar como el valor del parámetro *dwDesiredAccess* .</span><span class="sxs-lookup"><span data-stu-id="aa4ef-166">If these privileges have been granted and enabled in the access token of the backup application process, it can then call [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) to open your file or directory for backup, specifying the standard **READ\_CONTROL** access right as the value of the *dwDesiredAccess* parameter.</span></span> <span data-ttu-id="aa4ef-167">Sin embargo, para identificar el proceso de llamada como un proceso de copia de seguridad, la llamada a **CreateFile** debe incluir la marca de **semántica de copia de \_ \_ seguridad \_ del marcador de archivo** en el parámetro *dwFlagsAndAttributes* .</span><span class="sxs-lookup"><span data-stu-id="aa4ef-167">However, to identify the calling process as a backup process, the call to **CreateFile** must include the **FILE\_FLAG\_BACKUP\_SEMANTICS** flag in the *dwFlagsAndAttributes* parameter.</span></span> <span data-ttu-id="aa4ef-168">La sintaxis completa de la llamada de función es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="aa4ef-168">The full syntax of the function call is the following:</span></span>


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           READ_CONTROL,               // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           OPEN_EXISTING,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



<span data-ttu-id="aa4ef-169">Esto permitirá al proceso de la aplicación de copia de seguridad abrir el archivo e invalidar la comprobación de seguridad estándar.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-169">This will allow the backup application process to open your file and override the standard security checking.</span></span> <span data-ttu-id="aa4ef-170">Para restaurar el archivo, la aplicación de copia de seguridad usaría la siguiente sintaxis de llamada [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) al abrir el archivo que se va a escribir.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-170">To restore your file, the backup application would use the following [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) call syntax when opening your file to be written.</span></span>


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           WRITE_OWNER | WRITE_DAC,    // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           CREATE_ALWAYS,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



<span data-ttu-id="aa4ef-171">Hay situaciones en las que una aplicación de copia de seguridad debe poder cambiar la configuración del control de acceso de un archivo o directorio.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-171">There are situations when a backup application must be able to change the access control settings of a file or directory.</span></span> <span data-ttu-id="aa4ef-172">Un ejemplo es cuando la configuración de control de acceso de la copia residente en disco de un archivo o directorio es diferente de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-172">An example is when the access control settings of the disk-resident copy of a file or directory is different from the backup copy.</span></span> <span data-ttu-id="aa4ef-173">Esto ocurrirá si se cambiara esta configuración después de que se realizara la copia de seguridad del archivo o directorio, o si estuviera dañado.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-173">This would happen if these settings were changed after the file or directory was backed up, or if it was corrupted.</span></span>

<span data-ttu-id="aa4ef-174">La marca de semántica de copia de seguridad del marcador de archivo especificada en la llamada a [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) proporciona al proceso de la aplicación de copia de seguridad permiso para leer la configuración de control de acceso del archivo o directorio. **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="aa4ef-174">The **FILE\_FLAG\_BACKUP\_SEMANTICS** flag specified in the call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) gives the backup application process permission to read the access-control settings of the file or directory.</span></span> <span data-ttu-id="aa4ef-175">Con este permiso, el proceso de la aplicación de copia de seguridad puede llamar a [**GetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) y [**SetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) para leer y restablecer la configuración de control de acceso.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-175">With this permission, the backup application process can then call [**GetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) and [**SetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) to read and than reset the access-control settings.</span></span>

<span data-ttu-id="aa4ef-176">Si una aplicación de copia de seguridad debe tener acceso a la [configuración de control de acceso](/windows/desktop/SecAuthZ/access-control-lists)de nivel de sistema, la marca de **\_ \_ seguridad del sistema de acceso** debe especificarse en el valor del parámetro *dwDesiredAccess* pasado a [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="aa4ef-176">If a backup application must have access to the system-level [access control settings](/windows/desktop/SecAuthZ/access-control-lists), the **ACCESS\_SYSTEM\_SECURITY** flag must be specified in the *dwDesiredAccess* parameter value passed to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span>

<span data-ttu-id="aa4ef-177">Las aplicaciones de copia de seguridad llaman a [**BackupRead**](/windows/desktop/api/winbase/nf-winbase-backupread) para leer los archivos y directorios especificados para la operación de restauración y [**BackupWrite**](/windows/desktop/api/winbase/nf-winbase-backupwrite) para escribirlos.</span><span class="sxs-lookup"><span data-stu-id="aa4ef-177">Backup applications call [**BackupRead**](/windows/desktop/api/winbase/nf-winbase-backupread) to read the files and directories specified for the restore operation, and [**BackupWrite**](/windows/desktop/api/winbase/nf-winbase-backupwrite) to write them.</span></span>

## <a name="related-topics"></a><span data-ttu-id="aa4ef-178">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="aa4ef-178">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="aa4ef-179">derechos de acceso estándar</span><span class="sxs-lookup"><span data-stu-id="aa4ef-179">standard access rights</span></span>](/windows/desktop/SecAuthZ/standard-access-rights)
</dt> </dl>

 

 
