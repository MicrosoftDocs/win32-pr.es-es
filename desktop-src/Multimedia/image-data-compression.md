---
title: Image-Data compresión
description: Image-Data compresión
ms.assetid: 689cf403-cbb5-4ccb-a05b-0caa617430ed
keywords:
- Administrador de compresión de vídeo (VCM), compresión de datos de imagen
- VCM (Administrador de compresión de vídeo), compresión de datos de imagen
- ICCompress función)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b8f59a163a9b5a74d2d2fe984417069985fa86a
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "104420596"
---
# <a name="image-data-compression"></a><span data-ttu-id="7649b-106">Image-Data compresión</span><span class="sxs-lookup"><span data-stu-id="7649b-106">Image-Data Compression</span></span>

<span data-ttu-id="7649b-107">La aplicación puede usar una serie de funciones y macros de [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) para comprimir los datos.</span><span class="sxs-lookup"><span data-stu-id="7649b-107">Your application can use a series of [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros to compress data.</span></span> <span data-ttu-id="7649b-108">Las funciones y macros pueden ayudarle a realizar las siguientes tareas:</span><span class="sxs-lookup"><span data-stu-id="7649b-108">The functions and macros can help you perform the following tasks:</span></span>

-   <span data-ttu-id="7649b-109">Determina el formato de compresión que se va a usar para un formato de entrada especificado.</span><span class="sxs-lookup"><span data-stu-id="7649b-109">Determine the compression format to use for a specified input format.</span></span>
-   <span data-ttu-id="7649b-110">Prepare el compresor.</span><span class="sxs-lookup"><span data-stu-id="7649b-110">Prepare the compressor.</span></span>
-   <span data-ttu-id="7649b-111">Comprimir los datos.</span><span class="sxs-lookup"><span data-stu-id="7649b-111">Compress the data.</span></span>
-   <span data-ttu-id="7649b-112">Finalizar compresión.</span><span class="sxs-lookup"><span data-stu-id="7649b-112">End compression.</span></span>

<span data-ttu-id="7649b-113">La aplicación puede aumentar el control sobre el proceso de compresión mediante el uso de las funciones y macros de [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) .</span><span class="sxs-lookup"><span data-stu-id="7649b-113">Your application can increase control over the compression process by using the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) functions and macros.</span></span> <span data-ttu-id="7649b-114">Este grupo de funciones y macros controla fotogramas individuales, en lugar de la secuencia en conjunto.</span><span class="sxs-lookup"><span data-stu-id="7649b-114">This group of functions and macros handles individual frames, rather than the sequence as a whole.</span></span> <span data-ttu-id="7649b-115">Por ejemplo, la aplicación puede identificar los fotogramas que se van a comprimir como fotogramas clave mediante la función **ICCompress** .</span><span class="sxs-lookup"><span data-stu-id="7649b-115">For example, your application can identify the frames to compress as key frames by using the **ICCompress** function.</span></span>

<span data-ttu-id="7649b-116">Un compresor recibe los datos en un formato, comprime los datos y devuelve una versión comprimida de los mismos usando un formato especificado.</span><span class="sxs-lookup"><span data-stu-id="7649b-116">A compressor receives data in one format, compresses the data, and returns a compressed version of the data using a specified format.</span></span> <span data-ttu-id="7649b-117">El formato de entrada típico especifica DIB mediante la estructura [**bitmapinfo (**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) .</span><span class="sxs-lookup"><span data-stu-id="7649b-117">The typical input format specifies DIBs using the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure.</span></span> <span data-ttu-id="7649b-118">El formato de salida típico especifica DIB comprimidos, también mediante la estructura **bitmapinfo (** .</span><span class="sxs-lookup"><span data-stu-id="7649b-118">The typical output format specifies compressed DIBs, also using the **BITMAPINFO** structure.</span></span>

> [!Note]  
> <span data-ttu-id="7649b-119">Para minimizar la degradación del audio y la imagen durante la reproducción, evite comprimir un archivo AVI más de una vez.</span><span class="sxs-lookup"><span data-stu-id="7649b-119">To minimize image and audio degradation during playback, avoid compressing an AVI file more than once.</span></span> <span data-ttu-id="7649b-120">Combine piezas sin comprimir de vídeo en el sistema de edición y, a continuación, comprima el producto final.</span><span class="sxs-lookup"><span data-stu-id="7649b-120">Combine uncompressed pieces of video in your editing system and then compress the final product.</span></span>

 

## <a name="compressor-and-compression-format-selection"></a><span data-ttu-id="7649b-121">Selección del compresor y del formato de compresión</span><span class="sxs-lookup"><span data-stu-id="7649b-121">Compressor and Compression Format Selection</span></span>

<span data-ttu-id="7649b-122">Si desea comprimir los datos y la aplicación requiere un formato de salida específico, envíe el mensaje de [**\_ \_ consulta de compresión ICM**](icm-compress-query.md) (o use la macro [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) ) para consultar el compresor y determinar si admite los formatos de entrada y salida.</span><span class="sxs-lookup"><span data-stu-id="7649b-122">If you want to compress data and your application requires a specific output format, send the [**ICM\_COMPRESS\_QUERY**](icm-compress-query.md) message (or use the [**ICCompressQuery**](/windows/desktop/api/Vfw/nf-vfw-iccompressquery) macro) to query the compressor to determine if it supports the input and output formats.</span></span>

<span data-ttu-id="7649b-123">Si el formato de salida no es importante para la aplicación, solo necesita buscar un compresor que pueda controlar el formato de entrada.</span><span class="sxs-lookup"><span data-stu-id="7649b-123">If the output format is not important to your application, you need only find a compressor that can handle the input format.</span></span> <span data-ttu-id="7649b-124">Para determinar si un compresor puede controlar el formato de entrada, puede enviar **la \_ \_ consulta de compresión ICM**, especificando **null** para el parámetro *lParam* .</span><span class="sxs-lookup"><span data-stu-id="7649b-124">To determine if a compressor can handle the input format, you can send **ICM\_COMPRESS\_QUERY**, specifying **NULL** for the *lParam* parameter.</span></span> <span data-ttu-id="7649b-125">Este mensaje no devuelve el formato de salida a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7649b-125">This message does not return the output format to your application.</span></span> <span data-ttu-id="7649b-126">La aplicación puede determinar el tamaño de búfer necesario para los datos que especifican el formato de compresión mediante el envío del mensaje de compresión [**ICM \_ \_ Get \_ Format**](icm-compress-get-format.md) (o use la macro [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) ).</span><span class="sxs-lookup"><span data-stu-id="7649b-126">Your application can determine the buffer size needed for the data specifying the compression format by sending the [**ICM\_COMPRESS\_GET\_FORMAT**](icm-compress-get-format.md) message (or use the [**ICCompressGetFormatSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformatsize) macro).</span></span> <span data-ttu-id="7649b-127">También puede recuperar los datos de formato mediante el envío del \_ formato de compresión ICM \_ Get \_ (o la macro [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) ).</span><span class="sxs-lookup"><span data-stu-id="7649b-127">You can also retrieve the format data by sending ICM\_COMPRESS\_GET\_FORMAT (or the [**ICCompressGetFormat**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetformat) macro).</span></span>

<span data-ttu-id="7649b-128">Si desea determinar el búfer más grande que el compresor podría requerir para la compresión, envíe el mensaje de [**\_ \_ \_ tamaño**](icm-compress-get-size.md) de compresión ICM para el usuario (o use la macro [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) ).</span><span class="sxs-lookup"><span data-stu-id="7649b-128">If you want to determine the largest buffer that the compressor could require for compression, send the [**ICM\_COMPRESS\_GET\_SIZE**](icm-compress-get-size.md) message (or use the [**ICCompressGetSize**](/windows/desktop/api/Vfw/nf-vfw-iccompressgetsize) macro).</span></span> <span data-ttu-id="7649b-129">Puede usar el número de bytes devueltos por la función [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) para asignar un búfer para las comparaciones de imagen posteriores.</span><span class="sxs-lookup"><span data-stu-id="7649b-129">You can use the number of bytes returned by the [**ICSendMessage**](/windows/desktop/api/Vfw/nf-vfw-icsendmessage) function to allocate a buffer for subsequent image compressions.</span></span>

## <a name="compressor-initialization"></a><span data-ttu-id="7649b-130">Inicialización del compresor</span><span class="sxs-lookup"><span data-stu-id="7649b-130">Compressor Initialization</span></span>

<span data-ttu-id="7649b-131">Una vez que la aplicación selecciona un compresor que puede controlar los formatos de entrada y salida que necesita, puede inicializar el compresor mediante el mensaje de [**\_ \_ Inicio de compresión ICM**](icm-compress-begin.md) (o utilizar la macro [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="7649b-131">After your application selects a compressor that can handle the input and output formats it needs, you can initialize the compressor by using the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span> <span data-ttu-id="7649b-132">Este mensaje requiere el controlador del compresor y los formatos de entrada y salida.</span><span class="sxs-lookup"><span data-stu-id="7649b-132">This message requires the compressor handle and the input and output formats.</span></span>

## <a name="data-compression"></a><span data-ttu-id="7649b-133">Data Compression</span><span class="sxs-lookup"><span data-stu-id="7649b-133">Data Compression</span></span>

<span data-ttu-id="7649b-134">Puede usar la función [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) para comprimir un fotograma.</span><span class="sxs-lookup"><span data-stu-id="7649b-134">You can use the [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) function to compress a frame.</span></span> <span data-ttu-id="7649b-135">La aplicación debe usar esta función repetidamente hasta que se compriman todos los marcos de una secuencia.</span><span class="sxs-lookup"><span data-stu-id="7649b-135">Your application must use this function repeatedly until all the frames in a sequence are compressed.</span></span> <span data-ttu-id="7649b-136">La aplicación también debe realizar un seguimiento e incrementar el número de cada fotograma comprimido con **ICCompress**.</span><span class="sxs-lookup"><span data-stu-id="7649b-136">Your application must also track and increment the number of each frame compressed with **ICCompress**.</span></span> <span data-ttu-id="7649b-137">El compresor usa este valor para comprobar si los fotogramas se envían fuera de orden durante la compresión temporal rápida (lo que almacena las diferencias entre los fotogramas sucesivos).</span><span class="sxs-lookup"><span data-stu-id="7649b-137">The compressor uses this value to check if frames are sent out of order during fast temporal compression (storing differences between successive frames).</span></span> <span data-ttu-id="7649b-138">Si la aplicación vuelve a comprimir un fotograma, debe utilizar el mismo número de fotograma que cuando el fotograma se comprimió por primera vez.</span><span class="sxs-lookup"><span data-stu-id="7649b-138">If your application recompresses a frame, it should use the same frame number as when the frame was first compressed.</span></span> <span data-ttu-id="7649b-139">Si la aplicación comprime una imagen de marco fijo, puede especificar un número de fotogramas de cero.</span><span class="sxs-lookup"><span data-stu-id="7649b-139">If your application compresses a still-frame image, it can specify a frame number of zero.</span></span>

<span data-ttu-id="7649b-140">La aplicación puede usar la marca de **\_ fotogramas clave ICCOMPRESS** para que el fotograma esté comprimido por [**ICCOMPRESS**](/windows/desktop/api/Vfw/nf-vfw-iccompress) en un fotograma clave.</span><span class="sxs-lookup"><span data-stu-id="7649b-140">Your application can use the **ICCOMPRESS\_KEYFRAME** flag to make the frame compressed by [**ICCompress**](/windows/desktop/api/Vfw/nf-vfw-iccompress) a key frame.</span></span>

<span data-ttu-id="7649b-141">Cuando VCM devuelve el control a la aplicación después de comprimir un fotograma, VCM almacena los datos comprimidos en las estructuras a las que hacen referencia los parámetros *lpbiOutput* y *lpData* .</span><span class="sxs-lookup"><span data-stu-id="7649b-141">When VCM returns control to your application after compressing a frame, VCM stores the compressed data in the structures referenced by the *lpbiOutput* and *lpData* parameters.</span></span> <span data-ttu-id="7649b-142">Si la aplicación necesita trasladar los datos comprimidos, puede encontrar su tamaño en el miembro *biSizeImage* de la estructura [**Bitmapinfo (**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) especificada en *lpbiOutput*.</span><span class="sxs-lookup"><span data-stu-id="7649b-142">If your application needs to move the compressed data, it can find its size in the *biSizeImage* member of the [**BITMAPINFO**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfo) structure specified in *lpbiOutput*.</span></span>

> [!Note]  
> <span data-ttu-id="7649b-143">La aplicación debe asignar las estructuras y los búferes que almacenan los datos sin comprimir y comprimidos.</span><span class="sxs-lookup"><span data-stu-id="7649b-143">Your application must allocate the structures and buffers that store the uncompressed and compressed data.</span></span> <span data-ttu-id="7649b-144">Si el compresor admite la compresión temporal, la aplicación también debe asignar una estructura y un búfer para contener el formato y los datos del marco de información anterior.</span><span class="sxs-lookup"><span data-stu-id="7649b-144">If the compressor supports temporal compression, your application must also allocate a structure and buffer to hold the format and data for the previous frame of information.</span></span>

 

## <a name="ending-compression"></a><span data-ttu-id="7649b-145">Finalización de la compresión</span><span class="sxs-lookup"><span data-stu-id="7649b-145">Ending Compression</span></span>

<span data-ttu-id="7649b-146">Una vez que la aplicación haya comprimido los datos, puede usar la macro [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) para notificar al compresor que ha finalizado.</span><span class="sxs-lookup"><span data-stu-id="7649b-146">After your application has compressed the data, it can use the [**ICCompressEnd**](/windows/desktop/api/Vfw/nf-vfw-iccompressend) macro to notify the compressor that it has finished.</span></span> <span data-ttu-id="7649b-147">Si desea reiniciar la compresión después de usar esta función, la aplicación debe reinicializar el compresor mediante el envío del mensaje de [**\_ \_ Inicio de compresión ICM**](icm-compress-begin.md) (o use la macro [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) ).</span><span class="sxs-lookup"><span data-stu-id="7649b-147">If you want to restart compression after using this function, your application must reinitialize the compressor by sending the [**ICM\_COMPRESS\_BEGIN**](icm-compress-begin.md) message (or use the [**ICCompressBegin**](/windows/desktop/api/Vfw/nf-vfw-iccompressbegin) macro).</span></span>

 

 