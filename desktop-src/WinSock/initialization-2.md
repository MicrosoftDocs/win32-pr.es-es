---
description: El \_32.dll Ws2 carga el archivo dll de la interfaz del proveedor de servicios en el sistema mediante el uso de los mecanismos estándar de carga de biblioteca dinámica de Microsoft Windows y lo inicializa llamando a WSPStartup.
ms.assetid: 6df28d93-8757-45b3-8f05-86381c3be64e
title: Inicialización
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84d6ef10db421ef15f2bb94eb67e96fc2cfc5924
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105705608"
---
# <a name="initialization"></a><span data-ttu-id="f7817-103">Inicialización</span><span class="sxs-lookup"><span data-stu-id="f7817-103">Initialization</span></span>

<span data-ttu-id="f7817-104">El *\_32.dllWs2* carga el archivo dll de la interfaz del proveedor de servicios en el sistema mediante el uso de los mecanismos estándar de carga de biblioteca dinámica de Microsoft Windows y lo inicializa llamando a [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="f7817-104">The *Ws2\_32.dll* loads the service provider's interface DLL into the system by using the standard Microsoft Windows dynamic library loading mechanisms, and initializes it by calling [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="f7817-105">Normalmente, esto lo desencadena una aplicación que llama a [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) o [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) para crear un nuevo socket que se va a asociar a un proveedor de servicios cuya dll de interfaz no está cargada actualmente en la memoria.</span><span class="sxs-lookup"><span data-stu-id="f7817-105">This is typically triggered by an application calling either [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) to create a new socket to be associated with a service provider whose interface DLL is not currently loaded into memory.</span></span> <span data-ttu-id="f7817-106">La ruta de acceso a la DLL de interfaz de cada proveedor de servicios se almacena mediante el *\_32.dllWs2* en el momento en que se instala el proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="f7817-106">The path to each service provider's interface DLL is stored by the *Ws2\_32.dll* at the time the service provider is being installed.</span></span> <span data-ttu-id="f7817-107">Consulte [funciones de instalación y configuración](installation-and-configuration-functions-2.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="f7817-107">See [Installation and Configuration Functions](installation-and-configuration-functions-2.md) for more information.</span></span>

<span data-ttu-id="f7817-108">Con el tiempo, pueden existir diferentes versiones de los archivos dll, las aplicaciones y los proveedores de servicios de Winsock.</span><span class="sxs-lookup"><span data-stu-id="f7817-108">Over time, different versions may exist for the Winsock DLLs, applications, and service providers.</span></span> <span data-ttu-id="f7817-109">Las nuevas versiones pueden definir nuevas características y nuevos parámetros para estructuras de datos y parámetros de bits, etc. Por lo tanto, los números de versión indican cómo interpretar varias estructuras de datos.</span><span class="sxs-lookup"><span data-stu-id="f7817-109">New versions may define new features and new parameters to data structures and bit parameters, etc. Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="f7817-110">Para permitir la combinación y coincidencia óptimas de distintas versiones de aplicaciones, las versiones de Ws2 \_32.dll y las versiones de los proveedores de servicios de diferentes proveedores, el SPI proporciona un mecanismo de negociación de la versión para su uso entre el *\_32.dllWs2* y los proveedores de servicios.</span><span class="sxs-lookup"><span data-stu-id="f7817-110">To allow optimal mixing and matching of different versions of applications, versions of the Ws2\_32.dll itself, and versions of service providers by different vendors, the SPI provides a version negotiation mechanism for use between the *Ws2\_32.dll* and the service providers.</span></span> <span data-ttu-id="f7817-111">Esta negociación de versión se controla mediante [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="f7817-111">This version negotiation is handled by [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="f7817-112">Básicamente, el *\_32.dllWs2* pasa al proveedor de servicios los números de versión más altos con los que es compatible.</span><span class="sxs-lookup"><span data-stu-id="f7817-112">Basically, the *Ws2\_32.dll* passes to the service provider the highest version numbers with which it is compatible.</span></span> <span data-ttu-id="f7817-113">El proveedor de servicios lo compara con su propio intervalo de versión compatible.</span><span class="sxs-lookup"><span data-stu-id="f7817-113">The service provider compares this with its own supported range of version numbers.</span></span> <span data-ttu-id="f7817-114">Si estos intervalos se superponen, el proveedor de servicios devuelve un valor dentro de la parte que se superpone del intervalo como resultado de la negociación.</span><span class="sxs-lookup"><span data-stu-id="f7817-114">If these ranges overlap, the service provider returns a value within the overlapping portion of the range as the result of the negotiation.</span></span> <span data-ttu-id="f7817-115">Normalmente, debe ser el valor más alto posible.</span><span class="sxs-lookup"><span data-stu-id="f7817-115">Usually, this should be the highest possible value.</span></span> <span data-ttu-id="f7817-116">Si los intervalos no se superponen, las dos partes son incompatibles y la función devuelve un error.</span><span class="sxs-lookup"><span data-stu-id="f7817-116">If the ranges do not overlap, the two parties are incompatible and the function returns an error.</span></span>

<span data-ttu-id="f7817-117">Se debe llamar a [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) al menos una vez por cada proceso de cliente y se le puede llamar varias veces por parte de Ws2 \_32.dll u otras entidades.</span><span class="sxs-lookup"><span data-stu-id="f7817-117">[**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) must be called at least once by each client process, and may be called multiple times by Ws2\_32.dll or other entities.</span></span> <span data-ttu-id="f7817-118">Se debe llamar a un [**WSPCleanup**](/previous-versions/windows/hardware/network/ff566270(v=vs.85)) coincidente para cada llamada **WSPStartup** correcta.</span><span class="sxs-lookup"><span data-stu-id="f7817-118">A matching [**WSPCleanup**](/previous-versions/windows/hardware/network/ff566270(v=vs.85)) must be called for each successful **WSPStartup** call.</span></span> <span data-ttu-id="f7817-119">El proveedor de servicios debe mantener un recuento de referencias por proceso.</span><span class="sxs-lookup"><span data-stu-id="f7817-119">The service provider should maintain a reference count on a per-process basis.</span></span> <span data-ttu-id="f7817-120">En cada llamada a **WSPStartup** , el autor de la llamada puede especificar cualquier número de versión compatible con la dll del SP.</span><span class="sxs-lookup"><span data-stu-id="f7817-120">On each **WSPStartup** call, the caller may specify any version number supported by the SP DLL.</span></span>

<span data-ttu-id="f7817-121">Un proveedor de servicios debe almacenar el puntero en la tabla de envío de llamadas de llamada del cliente que se recibe como parámetro [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) por proceso.</span><span class="sxs-lookup"><span data-stu-id="f7817-121">A service provider must store the pointer to the client's upcall dispatch table that is received as a [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) parameter on a per-process basis.</span></span> <span data-ttu-id="f7817-122">Si un proceso determinado llama a **WSPStartup** varias veces, el proveedor de servicios solo debe usar el puntero de tabla de envío proporcionado más recientemente.</span><span class="sxs-lookup"><span data-stu-id="f7817-122">If a given process calls **WSPStartup** multiple times, the service provider must use only the most recently supplied dispatch table pointer.</span></span>

<span data-ttu-id="f7817-123">Como parte del proceso de inicialización del proveedor de servicios, Ws2 \_32.dll recupera la tabla de envío del proveedor de servicios a través del parámetro *lpProcTable* para obtener los puntos de entrada al resto de las funciones SPI especificadas en este documento.</span><span class="sxs-lookup"><span data-stu-id="f7817-123">As part of the service provider initialization process The Ws2\_32.dll retrieves the service provider's dispatch table through the *lpProcTable* parameter in order to obtain entry points to the rest of the SPI functions specified in this document.</span></span>

<span data-ttu-id="f7817-124">El uso de una tabla de distribución (en contraposición a los mecanismos de DLL habituales para tener acceso a los puntos de entrada) sirve para dos propósitos:</span><span class="sxs-lookup"><span data-stu-id="f7817-124">Using a dispatch table (as opposed to the usual DLL mechanisms for accessing entry points) serves two purposes:</span></span>

-   <span data-ttu-id="f7817-125">Es más conveniente para el32.dll Ws2 \_ , ya que se puede realizar una única llamada para detectar todo el conjunto de puntos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f7817-125">It is more convenient for the Ws2\_32.dll since a single call can be made to discover the entire set of entry points.</span></span>
-   <span data-ttu-id="f7817-126">Permite que los proveedores de servicios en capas formados en cadenas de protocolo funcionen de forma más eficaz.</span><span class="sxs-lookup"><span data-stu-id="f7817-126">It enables layered service providers formed into protocol chains to operate more efficiently.</span></span>

## <a name="initializing-protocol-chains"></a><span data-ttu-id="f7817-127">Inicializando cadenas de protocolo</span><span class="sxs-lookup"><span data-stu-id="f7817-127">Initializing Protocol Chains</span></span>

<span data-ttu-id="f7817-128">En el momento en que se instala la estructura de [**\_ información de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) para una cadena de protocolos, también se especifica la ruta de acceso al primer proveedor en capas de la cadena.</span><span class="sxs-lookup"><span data-stu-id="f7817-128">At the time the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a protocol chain is installed, the path to the first layered provider in the chain is also specified.</span></span> <span data-ttu-id="f7817-129">Cuando se inicializa una cadena de protocolos, el \_32.dll Ws2 usa esta ruta de acceso para cargar la dll del proveedor y, a continuación, invoca [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="f7817-129">When a protocol chain is initialized, the Ws2\_32.dll uses this path to load the provider DLL and then invokes [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="f7817-130">Dado que **WSPStartup** incluye un puntero a la estructura **de \_ información de WSAPROTOCOL** de la cadena como uno de sus parámetros, los proveedores superpuestos pueden determinar el tipo de cadena en el que se están inicializando y la identidad de la siguiente capa inferior de la cadena.</span><span class="sxs-lookup"><span data-stu-id="f7817-130">Since **WSPStartup** includes a pointer to the chain's **WSAPROTOCOL\_INFO** structure as one of its parameters, layered providers can determine what type of chain they are being initialized into, and the identity of the next lower layer in the chain.</span></span> <span data-ttu-id="f7817-131">A su vez, un proveedor superpuesto carga el siguiente proveedor de protocolo en la cadena y lo inicializa con una llamada a **WSPStartup**, y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="f7817-131">A layered provider would then in turn load the next protocol provider in the chain and initialize it with a call to **WSPStartup**, and so forth.</span></span> <span data-ttu-id="f7817-132">Siempre que la capa inferior siguiente sea otro proveedor superpuesto, se debe hacer referencia a la estructura de **\_ información de WSAPROTOCOL** de la cadena en la llamada a **WSPStartup** .</span><span class="sxs-lookup"><span data-stu-id="f7817-132">Whenever the next lower layer is another layered provider, the chain's **WSAPROTOCOL\_INFO** structure must be referenced in the **WSPStartup** call.</span></span> <span data-ttu-id="f7817-133">Cuando la siguiente capa inferior es un protocolo base (que indica el final de la cadena), la estructura de **\_ información de WSAPROTOCOL** de la cadena deja de propagarse hacia abajo.</span><span class="sxs-lookup"><span data-stu-id="f7817-133">When the next lower layer is a base protocol (signifying the end of the chain), the chain's **WSAPROTOCOL\_INFO** structure is no longer propagated downward.</span></span> <span data-ttu-id="f7817-134">En su lugar, la capa actual debe hacer referencia a una estructura de **\_ información WSAPROTOCOL** que se corresponda con el protocolo que debe usar el proveedor base.</span><span class="sxs-lookup"><span data-stu-id="f7817-134">Instead, the current layer must reference a **WSAPROTOCOL\_INFO** structure that corresponds to the protocol that the base provider should use.</span></span> <span data-ttu-id="f7817-135">Por lo tanto, el proveedor base no tiene ninguna noción de estar implicado en una cadena de protocolos.</span><span class="sxs-lookup"><span data-stu-id="f7817-135">Thus, the base provider has no notion of being involved in a protocol chain.</span></span>

<span data-ttu-id="f7817-136">La tabla de distribución proporcionada por cualquier proveedor en capas determinado, en muchos casos, duplica los puntos de entrada de un proveedor subyacente.</span><span class="sxs-lookup"><span data-stu-id="f7817-136">The dispatch table provided by any given layered provider will, in many instances, duplicate the entry points of an underlying provider.</span></span> <span data-ttu-id="f7817-137">El proveedor en capas solo insertaría sus propios puntos de entrada para las funciones de las que necesitaba estar implicado directamente.</span><span class="sxs-lookup"><span data-stu-id="f7817-137">The layered provider would only insert its own entry points for functions that it needed to be directly involved in.</span></span> <span data-ttu-id="f7817-138">Sin embargo, tenga en cuenta que es imperativo que un proveedor superpuesto no modifique el contenido de la tabla de llamadas que recibió al llamar a [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) en la siguiente capa inferior en una cadena de protocolos.</span><span class="sxs-lookup"><span data-stu-id="f7817-138">Note, however, that it is imperative that a layered provider not modify the contents of the upcall table that it received when calling [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) on the next lower layer in a protocol chain.</span></span> <span data-ttu-id="f7817-139">Estas llamadas se deben realizar directamente en el archivo DLL de Windows Sockets 2.</span><span class="sxs-lookup"><span data-stu-id="f7817-139">These upcalls must be made directly to the Windows Sockets 2 DLL.</span></span>

 

 
