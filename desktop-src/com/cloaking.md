---
title: Cloaking (COM)
description: La ocultación es una funcionalidad de seguridad COM que determina qué identidad proyecta el cliente hacia el servidor durante la suplantación.
ms.assetid: 5b97d9d6-8fa9-4da2-8351-64772227d9a2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 588651cfa37def4e174ef0f2fdba9b79b0c60ca8
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/03/2021
ms.locfileid: "103913934"
---
# <a name="cloaking-com"></a><span data-ttu-id="24bae-103">Cloaking (COM)</span><span class="sxs-lookup"><span data-stu-id="24bae-103">Cloaking (COM)</span></span>

<span data-ttu-id="24bae-104">La ocultación es una funcionalidad de seguridad COM que determina qué identidad proyecta el cliente hacia el servidor durante la suplantación.</span><span class="sxs-lookup"><span data-stu-id="24bae-104">Cloaking is a COM security capability that determines what identity the client projects toward the server during impersonation.</span></span> <span data-ttu-id="24bae-105">Cuando se establece Cloaking, el servidor intermedio enmascara su propia identidad y presenta la identidad del cliente al servidor al que llama en nombre del cliente.</span><span class="sxs-lookup"><span data-stu-id="24bae-105">When cloaking is set, the intermediate server masks its own identity and presents the client's identity to the server that it calls on the client's behalf.</span></span> <span data-ttu-id="24bae-106">Básicamente la identidad del cliente que detecta el servidor es la identidad asociada con el proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-106">Basically; the client identity that is seen by the server is the identity associated with the proxy.</span></span> <span data-ttu-id="24bae-107">La identidad del proxy viene determinada por varios factores, uno de los cuales es el tipo de Cloaking que se establece (si existe).</span><span class="sxs-lookup"><span data-stu-id="24bae-107">The proxy's identity is determined by several factors, one of which is the type of cloaking that is set (if any).</span></span> <span data-ttu-id="24bae-108">La ocultación no es compatible con el proveedor de seguridad Schannel.</span><span class="sxs-lookup"><span data-stu-id="24bae-108">Cloaking is not supported by the Schannel security provider.</span></span>

<span data-ttu-id="24bae-109">En los temas siguientes se proporciona más información acerca de la ocultación:</span><span class="sxs-lookup"><span data-stu-id="24bae-109">The following topics provide more information about cloaking:</span></span>

-   [<span data-ttu-id="24bae-110">Tipos de Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-110">Types of Cloaking</span></span>](#types-of-cloaking)
-   [<span data-ttu-id="24bae-111">Cómo afecta la ocultación a la identidad del cliente</span><span class="sxs-lookup"><span data-stu-id="24bae-111">How Cloaking Affects Client Identity</span></span>](#how-cloaking-affects-client-identity)
-   [<span data-ttu-id="24bae-112">Establecer Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-112">Setting Cloaking</span></span>](#setting-cloaking)
-   [<span data-ttu-id="24bae-113">Ocultación y niveles de suplantación</span><span class="sxs-lookup"><span data-stu-id="24bae-113">Cloaking and Impersonation Levels</span></span>](#cloaking-and-impersonation-levels)
-   [<span data-ttu-id="24bae-114">Escenarios de ocultación</span><span class="sxs-lookup"><span data-stu-id="24bae-114">Cloaking Scenarios</span></span>](#cloaking-scenarios)
-   [<span data-ttu-id="24bae-115">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="24bae-115">Related topics</span></span>](#related-topics)

## <a name="types-of-cloaking"></a><span data-ttu-id="24bae-116">Tipos de Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-116">Types of Cloaking</span></span>

<span data-ttu-id="24bae-117">Hay dos tipos de Cloaking: ocultación *estática* y ocultación *dinámica* :</span><span class="sxs-lookup"><span data-stu-id="24bae-117">There are two types of cloaking: *static* cloaking and *dynamic* cloaking:</span></span>

-   <span data-ttu-id="24bae-118">Con el Cloaking estático (EOAC \_ static \_ Cloaking), el servidor Ve el token de subproceso de la primera llamada de un cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="24bae-118">With static cloaking (EOAC\_STATIC\_CLOAKING), the server sees the thread token from the first call from a client to the server.</span></span> <span data-ttu-id="24bae-119">En la primera llamada, si la identidad del proxy se estableció previamente durante una llamada a [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), se utiliza esa identidad del proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-119">For the first call, if the proxy identity was previously set during a call to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), that proxy identity is used.</span></span> <span data-ttu-id="24bae-120">Sin embargo, si la identidad del proxy no se estableció previamente, se utiliza el token de subproceso.</span><span class="sxs-lookup"><span data-stu-id="24bae-120">However, if the proxy identity was not previously set, the thread token is used.</span></span> <span data-ttu-id="24bae-121">Si no hay ningún token de subproceso, se utiliza el token de proceso.</span><span class="sxs-lookup"><span data-stu-id="24bae-121">If no thread token is present, the process token is used.</span></span> <span data-ttu-id="24bae-122">Para todas las llamadas futuras, se usa la identidad establecida en la primera llamada.</span><span class="sxs-lookup"><span data-stu-id="24bae-122">For all future calls, the identity set on the first call is used.</span></span>
-   <span data-ttu-id="24bae-123">Con el Cloaking dinámico (EOAC \_ Dynamic \_ Cloaking), se usa en cada llamada el token del subproceso actual (si hay un token de subproceso) para determinar la identidad del cliente.</span><span class="sxs-lookup"><span data-stu-id="24bae-123">With dynamic cloaking (EOAC\_DYNAMIC\_CLOAKING), on each call the current thread token (if there is a thread token) is used to determine the client's identity.</span></span> <span data-ttu-id="24bae-124">Si no hay ningún token de subproceso, se utiliza el token de proceso.</span><span class="sxs-lookup"><span data-stu-id="24bae-124">If there is no thread token, the process token is used.</span></span> <span data-ttu-id="24bae-125">Esto significa que los servidores a los que se llama en nombre del cliente durante la suplantación ven la identidad del cliente COM que originó la llamada, que suele ser el comportamiento deseado.</span><span class="sxs-lookup"><span data-stu-id="24bae-125">This means that servers called on the client's behalf during impersonation see the identity of the COM client that originated the call, which is generally the desired behavior.</span></span> <span data-ttu-id="24bae-126">(Por supuesto, para que la suplantación se realice correctamente, el cliente debe haber proporcionado la entidad de servidor para suplantar mediante el establecimiento de un nivel de suplantación adecuado.</span><span class="sxs-lookup"><span data-stu-id="24bae-126">(Of course, for impersonation to succeed, the client must have given the server authority to impersonate by setting an appropriate impersonation level.</span></span> <span data-ttu-id="24bae-127">Para obtener más información, vea [niveles de suplantación](impersonation-levels.md)). Este tipo de Cloaking es caro.</span><span class="sxs-lookup"><span data-stu-id="24bae-127">For more information, see [Impersonation Levels](impersonation-levels.md).) This type of cloaking is expensive.</span></span>

## <a name="how-cloaking-affects-client-identity"></a><span data-ttu-id="24bae-128">Cómo afecta la ocultación a la identidad del cliente</span><span class="sxs-lookup"><span data-stu-id="24bae-128">How Cloaking Affects Client Identity</span></span>

<span data-ttu-id="24bae-129">Cuando se realiza una llamada cifrada y el servidor pide su identidad al cliente, normalmente obtiene la identidad asociada al proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-129">When an encrypted call is made and the server asks the client for its identity, it usually gets the identity tied to the proxy.</span></span> <span data-ttu-id="24bae-130">(A veces, el servicio de autenticación realiza una traducción de la identidad real, pero generalmente la identidad del proxy es la identidad que el servidor ve). El proxy presenta una identidad al servidor que depende del tipo de Cloaking que se establece y de otros factores.</span><span class="sxs-lookup"><span data-stu-id="24bae-130">(Sometimes the authentication service performs a translation from the real identity, but generally the proxy identity is the identity the server sees.) The proxy presents an identity to the server that depends on the type of cloaking that is set and other factors.</span></span>

<span data-ttu-id="24bae-131">En Resumen, la identidad del cliente es una función del conjunto de marcas de ocultación, el token de proceso, la presencia o ausencia de un token de subproceso, y si la identidad del proxy se ha establecido previamente.</span><span class="sxs-lookup"><span data-stu-id="24bae-131">To summarize, the identity of the client is a function of the cloaking flag set, the process token, the presence or absence of a thread token, and whether the proxy identity has been previously set.</span></span> <span data-ttu-id="24bae-132">En la tabla siguiente se muestra la identidad del proxy resultante (identidad del cliente) cuando estos factores varían.</span><span class="sxs-lookup"><span data-stu-id="24bae-132">The following table shows the resulting proxy identity (client identity) when these factors vary.</span></span>



| <span data-ttu-id="24bae-133">Ocultar marcas</span><span class="sxs-lookup"><span data-stu-id="24bae-133">Cloaking Flags</span></span>                     | <span data-ttu-id="24bae-134">Presencia de token de subproceso</span><span class="sxs-lookup"><span data-stu-id="24bae-134">Thread Token Presence</span></span>  | <span data-ttu-id="24bae-135">Identidad de proxy previamente establecida</span><span class="sxs-lookup"><span data-stu-id="24bae-135">Proxy Identity Previously Set</span></span> | <span data-ttu-id="24bae-136">Identidad del proxy (identidad del cliente)</span><span class="sxs-lookup"><span data-stu-id="24bae-136">Proxy Identity (Client Identity)</span></span>                    |
|------------------------------------|------------------------|-------------------------------|-----------------------------------------------------|
| <span data-ttu-id="24bae-137">Cloaking no establecido</span><span class="sxs-lookup"><span data-stu-id="24bae-137">Cloaking not set</span></span><br/>        | <span data-ttu-id="24bae-138">No importa</span><span class="sxs-lookup"><span data-stu-id="24bae-138">Don't care</span></span><br/>  | <span data-ttu-id="24bae-139">No importa</span><span class="sxs-lookup"><span data-stu-id="24bae-139">Don't care</span></span><br/>         | <span data-ttu-id="24bae-140">Identidad de autenticación o token de proceso</span><span class="sxs-lookup"><span data-stu-id="24bae-140">Process token or authentication identity</span></span><br/> |
| <span data-ttu-id="24bae-141">EOAC \_ estático de \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-141">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="24bae-142">Presente</span><span class="sxs-lookup"><span data-stu-id="24bae-142">Present</span></span><br/>     | <span data-ttu-id="24bae-143">No</span><span class="sxs-lookup"><span data-stu-id="24bae-143">No</span></span><br/>                 | <span data-ttu-id="24bae-144">Token de subproceso</span><span class="sxs-lookup"><span data-stu-id="24bae-144">Thread token</span></span><br/>                             |
| <span data-ttu-id="24bae-145">EOAC \_ estático de \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-145">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="24bae-146">Presente</span><span class="sxs-lookup"><span data-stu-id="24bae-146">Present</span></span><br/>     | <span data-ttu-id="24bae-147">Sí</span><span class="sxs-lookup"><span data-stu-id="24bae-147">Yes</span></span><br/>                | <span data-ttu-id="24bae-148">Identidad del proxy actual</span><span class="sxs-lookup"><span data-stu-id="24bae-148">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="24bae-149">EOAC \_ estático de \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-149">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="24bae-150">No está presente</span><span class="sxs-lookup"><span data-stu-id="24bae-150">Not present</span></span><br/> | <span data-ttu-id="24bae-151">No</span><span class="sxs-lookup"><span data-stu-id="24bae-151">No</span></span><br/>                 | <span data-ttu-id="24bae-152">Token de proceso</span><span class="sxs-lookup"><span data-stu-id="24bae-152">Process token</span></span><br/>                            |
| <span data-ttu-id="24bae-153">EOAC \_ estático de \_ Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-153">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="24bae-154">No está presente</span><span class="sxs-lookup"><span data-stu-id="24bae-154">Not present</span></span><br/> | <span data-ttu-id="24bae-155">Sí</span><span class="sxs-lookup"><span data-stu-id="24bae-155">Yes</span></span><br/>                | <span data-ttu-id="24bae-156">Identidad del proxy actual</span><span class="sxs-lookup"><span data-stu-id="24bae-156">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="24bae-157">\_Cloaking dinámico de EOAC \_</span><span class="sxs-lookup"><span data-stu-id="24bae-157">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="24bae-158">Presente</span><span class="sxs-lookup"><span data-stu-id="24bae-158">Present</span></span><br/>     | <span data-ttu-id="24bae-159">No importa</span><span class="sxs-lookup"><span data-stu-id="24bae-159">Don't care</span></span><br/>         | <span data-ttu-id="24bae-160">Token de subproceso</span><span class="sxs-lookup"><span data-stu-id="24bae-160">Thread token</span></span><br/>                             |
| <span data-ttu-id="24bae-161">\_Cloaking dinámico de EOAC \_</span><span class="sxs-lookup"><span data-stu-id="24bae-161">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="24bae-162">No está presente</span><span class="sxs-lookup"><span data-stu-id="24bae-162">Not present</span></span><br/> | <span data-ttu-id="24bae-163">No importa</span><span class="sxs-lookup"><span data-stu-id="24bae-163">Don't care</span></span> <br/>        | <span data-ttu-id="24bae-164">Token de proceso</span><span class="sxs-lookup"><span data-stu-id="24bae-164">Process token</span></span><br/>                            |



 

<span data-ttu-id="24bae-165">En el diagrama de flujo siguiente se muestra cómo se determina la identidad del proxy en diferentes situaciones.</span><span class="sxs-lookup"><span data-stu-id="24bae-165">The following flowchart illustrates how the proxy identity is determined in different situations.</span></span>

![Diagrama que muestra el flujo para determinar la identidad del proxy.](images/9e8409b7-8475-4824-bdff-cf6b09c139c5.png)

## <a name="setting-cloaking"></a><span data-ttu-id="24bae-167">Establecer Cloaking</span><span class="sxs-lookup"><span data-stu-id="24bae-167">Setting Cloaking</span></span>

<span data-ttu-id="24bae-168">La ocultación se establece como una marca de capacidad en una llamada a [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), que establece la ocultación para todo el proceso.</span><span class="sxs-lookup"><span data-stu-id="24bae-168">Cloaking is set as a capability flag in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), which sets cloaking for the entire process.</span></span> <span data-ttu-id="24bae-169">A continuación, se establece la capacidad de Cloaking hasta que el cliente la cambia a través de una llamada a IClientSecurity::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (o a [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), que establece la ocultación del proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-169">The cloaking capability is then set until the client changes it through a call to IClientSecurity::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (or to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), which sets cloaking for the proxy.</span></span>

<span data-ttu-id="24bae-170">De forma predeterminada, no se establece la ocultación.</span><span class="sxs-lookup"><span data-stu-id="24bae-170">By default, cloaking is not set.</span></span> <span data-ttu-id="24bae-171">Para establecerlo, pase EOAC \_ static \_ CLOAKING o EOAC \_ Dynamic \_ Cloaking al parámetro *pCapabilities* de [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) o [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="24bae-171">To set it, pass EOAC\_STATIC\_CLOAKING or EOAC\_DYNAMIC\_CLOAKING to the *pCapabilities* parameter in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span>

<span data-ttu-id="24bae-172">Cuando se habilita el Cloaking estático mediante [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), cada proxy toma un token (subproceso o proceso) la primera vez que realiza una llamada en el proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-172">When static cloaking is enabled using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), each proxy picks up a token (thread or process) the first time you make a call on the proxy.</span></span> <span data-ttu-id="24bae-173">Cuando se habilita el Cloaking estático mediante [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), el proxy recoge el token en el subproceso en ese momento.</span><span class="sxs-lookup"><span data-stu-id="24bae-173">When static cloaking is enabled using [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), the proxy picks up the token on the thread at that time.</span></span> <span data-ttu-id="24bae-174">Si no hay ningún token de subproceso disponible cuando se llama a **SetBlanket** , el token de proceso se usa para la identidad del proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-174">If no thread token is available when **SetBlanket** is called, the process token is used for the proxy's identity.</span></span> <span data-ttu-id="24bae-175">Básicamente, **SetBlanket** corrige la identidad del proxy.</span><span class="sxs-lookup"><span data-stu-id="24bae-175">Basically, **SetBlanket** fixes the identity of the proxy.</span></span>

<span data-ttu-id="24bae-176">Con el Cloaking dinámico, la identidad del proxy se determina de la misma manera independientemente de si el Cloaking dinámico se establece mediante [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) o con [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="24bae-176">With dynamic cloaking, the proxy's identity is determined the same way regardless of whether dynamic cloaking is set using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or with [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span> <span data-ttu-id="24bae-177">El token de subproceso actual se utiliza si hay alguno; de lo contrario, se utiliza el token de proceso.</span><span class="sxs-lookup"><span data-stu-id="24bae-177">The current thread token is used if there is one; otherwise, the process token is used.</span></span>

<span data-ttu-id="24bae-178">Si se establece la ocultación para todo el proceso a través de una llamada a [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) y desea realizar llamadas con el token de proceso, no suplantar mientras realiza llamadas.</span><span class="sxs-lookup"><span data-stu-id="24bae-178">If cloaking is set for the entire process through a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and you want to make calls with the process token, do not impersonate while making calls.</span></span>

## <a name="cloaking-and-impersonation-levels"></a><span data-ttu-id="24bae-179">Ocultación y niveles de suplantación</span><span class="sxs-lookup"><span data-stu-id="24bae-179">Cloaking and Impersonation Levels</span></span>

<span data-ttu-id="24bae-180">Como se mencionó anteriormente, la funcionalidad de ocultación determina qué identidad se presenta a un servidor durante la suplantación.</span><span class="sxs-lookup"><span data-stu-id="24bae-180">As mentioned previously, the cloaking capability determines what identity is presented to a server during impersonation.</span></span> <span data-ttu-id="24bae-181">La ocultación proporciona una forma para que un servidor pueda proyectar una identidad que no sea la suya propia en otro servidor al que llama en nombre del cliente.</span><span class="sxs-lookup"><span data-stu-id="24bae-181">Cloaking provides a way for a server to project an identity other than its own to another server it is calling on behalf of the client.</span></span> <span data-ttu-id="24bae-182">El nivel de suplantación indica cuánta autoridad ha proporcionado el cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="24bae-182">The impersonation level indicates how much authority the client has given the server.</span></span>

<span data-ttu-id="24bae-183">La suplantación sin Cloaking funciona, pero puede que no sea la mejor opción porque, en algunos casos, el servidor final debe conocer la identidad del autor de la llamada inicial.</span><span class="sxs-lookup"><span data-stu-id="24bae-183">Impersonation without cloaking works, but it may not be the best choice because, in some cases, the final server needs to know the identity of the initial caller.</span></span> <span data-ttu-id="24bae-184">Esto no se puede lograr sin usar la ocultación, ya que es difícil asegurarse de que solo los clientes autorizados puedan tener acceso a un equipo remoto.</span><span class="sxs-lookup"><span data-stu-id="24bae-184">This cannot be achieved without using cloaking because it is difficult to ensure that only authorized clients can access a remote computer.</span></span> <span data-ttu-id="24bae-185">Cuando la suplantación se utiliza sin Cloaking, la identidad presentada a un servidor de nivel inferior es la del proceso de llamada inmediata.</span><span class="sxs-lookup"><span data-stu-id="24bae-185">When impersonation is used without cloaking, the identity presented to a downstream server is that of the immediate calling process.</span></span>

<span data-ttu-id="24bae-186">Sin embargo, el Cloaking no resulta útil sin la suplantación.</span><span class="sxs-lookup"><span data-stu-id="24bae-186">However, cloaking is not useful without impersonation.</span></span> <span data-ttu-id="24bae-187">La ocultación solo tiene sentido cuando el cliente ha establecido un nivel de suplantación de Impersonate o Delegate.</span><span class="sxs-lookup"><span data-stu-id="24bae-187">Cloaking makes sense only when the client has set an impersonation level of impersonate or delegate.</span></span> <span data-ttu-id="24bae-188">(Con niveles de suplantación inferiores, el servidor no puede realizar llamadas escondidas). El hecho de que la ocultación sea correcta depende del número de límites de equipo cruzados y en el nivel de suplantación, lo que indica cuánta autoridad debe actuar el servidor en nombre del cliente.</span><span class="sxs-lookup"><span data-stu-id="24bae-188">(With lower impersonation levels, the server cannot make cloaked calls.) Whether cloaking is successful depends on the number of computer boundaries crossed and on the impersonation level, which indicates how much authority the server has to act on behalf of the client.</span></span>

<span data-ttu-id="24bae-189">En algunas situaciones, tiene sentido que el servidor establezca la ocultación cuando el cliente establece el nivel de suplantación en la \_ \_ suplantación de nivel Imp de RPC C \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="24bae-189">In some situations, it makes sense for the server to set cloaking when the client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE.</span></span> <span data-ttu-id="24bae-190">Sin embargo, hay algunas limitaciones en vigor.</span><span class="sxs-lookup"><span data-stu-id="24bae-190">However, certain limitations are in effect.</span></span> <span data-ttu-id="24bae-191">Si el cliente original establece el nivel de suplantación en \_ el \_ nivel Imp de RPC C \_ \_ , el servidor intermedio (que actúa como cliente en el mismo equipo) puede esconder solo en un límite de equipo.</span><span class="sxs-lookup"><span data-stu-id="24bae-191">If the original client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE, the intermediate server (acting as a client on the same computer) can cloak across only one computer boundary.</span></span> <span data-ttu-id="24bae-192">Esto se debe a que un token de suplantación de nivel de suplantación solo se puede pasar a través de un límite de equipo.</span><span class="sxs-lookup"><span data-stu-id="24bae-192">This is because an impersonate-level impersonation token can be passed across only one computer boundary.</span></span> <span data-ttu-id="24bae-193">Una vez que se ha cruzado el límite del equipo, solo se puede tener acceso a los recursos locales.</span><span class="sxs-lookup"><span data-stu-id="24bae-193">After the computer boundary has been crossed, only local resources can be accessed.</span></span> <span data-ttu-id="24bae-194">La identidad presentada al servidor depende del tipo de Cloaking que se establece.</span><span class="sxs-lookup"><span data-stu-id="24bae-194">The identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="24bae-195">Si no se establece ningún Cloaking, la identidad presentada a un servidor será la del proceso que realiza la llamada inmediata.</span><span class="sxs-lookup"><span data-stu-id="24bae-195">If no cloaking is set, the identity presented to a server will be that of the process making the immediate call.</span></span>

<span data-ttu-id="24bae-196">Para esconder varios límites de equipo, debe especificar tanto una marca de capacidad de ocultación adecuada como la suplantación de nivel de delegado.</span><span class="sxs-lookup"><span data-stu-id="24bae-196">To cloak over multiple computer boundaries, you must specify both an appropriate cloaking capability flag and delegate-level impersonation.</span></span> <span data-ttu-id="24bae-197">Con este tipo de suplantación, las credenciales locales y de red del cliente se asignan al servidor, por lo que el token de suplantación puede cruzar cualquier número de límites del equipo.</span><span class="sxs-lookup"><span data-stu-id="24bae-197">With this type of impersonation, both the local and network credentials of the client are given to the server, so the impersonation token can cross any number of computer boundaries.</span></span> <span data-ttu-id="24bae-198">De nuevo, la identidad presentada al servidor depende del tipo de Cloaking que se establece.</span><span class="sxs-lookup"><span data-stu-id="24bae-198">Again, the identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="24bae-199">Si no se establece ningún Cloaking con la suplantación de nivel de delegado, la identidad presentada a un servidor es la del proceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="24bae-199">If no cloaking is set with delegate-level impersonation, the identity presented to a server is that of the process making the call.</span></span>

<span data-ttu-id="24bae-200">Por ejemplo, supongamos que el proceso A llama a B y B llama a C. B ha establecido el Cloaking y un ha establecido el nivel de suplantación en Impersonate.</span><span class="sxs-lookup"><span data-stu-id="24bae-200">For example, suppose Process A calls B, and B calls C. B has set cloaking and A has set the impersonation level to impersonate.</span></span> <span data-ttu-id="24bae-201">Si A, B y C están en el mismo equipo, pasando el token de suplantación de a a B y después a C funcionará.</span><span class="sxs-lookup"><span data-stu-id="24bae-201">If A, B, and C are on the same computer, passing the impersonation token from A to B and then to C will work.</span></span> <span data-ttu-id="24bae-202">Pero si A y C están en el mismo equipo y B no lo es, pasar el token funcionará entre A y B, pero no de B a C. Se producirá un error en la llamada de B a C porque B no puede llamar a C mientras se oculta.</span><span class="sxs-lookup"><span data-stu-id="24bae-202">But if A and C are on the same computer, and B is not, passing the token will work between A and B, but not from B to C. The call from B to C will fail because B cannot call C while cloaking.</span></span> <span data-ttu-id="24bae-203">Sin embargo, si un establece el nivel de suplantación en Delegate, el token se puede pasar de B a C y la llamada puede realizarse correctamente.</span><span class="sxs-lookup"><span data-stu-id="24bae-203">However, if A sets the impersonation level to delegate, the token can be passed from B to C and the call may succeed.</span></span>

## <a name="cloaking-scenarios"></a><span data-ttu-id="24bae-204">Escenarios de ocultación</span><span class="sxs-lookup"><span data-stu-id="24bae-204">Cloaking Scenarios</span></span>

<span data-ttu-id="24bae-205">En la ilustración siguiente, el proceso A llama a B, llama a C, llama a D cuando no se establece la ocultación.</span><span class="sxs-lookup"><span data-stu-id="24bae-205">In the following illustration, Process A calls B, calls C, calls D when cloaking is not set.</span></span> <span data-ttu-id="24bae-206">Como resultado, cada proceso intermedio ve la identidad del proceso que lo llamó.</span><span class="sxs-lookup"><span data-stu-id="24bae-206">As a result, each intermediate process sees the identity of the process that called it.</span></span>

![Diagrama que muestra el proceso cuando no se establece la ocultación.](images/0d2eb6cf-97d6-4c4e-b97e-abad854b1120.png)

<span data-ttu-id="24bae-208">Con el Cloaking estático, el servidor ve la identidad del proxy que se estableció durante la primera llamada desde el cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="24bae-208">With static cloaking, the server sees the proxy identity that was set during the first call from the client to the server.</span></span> <span data-ttu-id="24bae-209">En la siguiente ilustración se muestra un ejemplo de la identidad del proxy que se establece durante una llamada de B a C. En una llamada posterior, el proceso D ve la identidad de B cuando la ocultación estática está establecida por B y C.</span><span class="sxs-lookup"><span data-stu-id="24bae-209">The following figure shows an example of the proxy identity being set during a call from B to C. On a subsequent call, Process D sees B's identity when static cloaking is set by B and C.</span></span>

![Diagrama que muestra el proceso de Cloaking estático.](images/520938e0-c4a6-4ac1-937d-02baf2007a27.png)

<span data-ttu-id="24bae-211">Con el Cloaking dinámico, la identidad del autor de la llamada durante la suplantación se basa en el token del subproceso actual, si hay alguno.</span><span class="sxs-lookup"><span data-stu-id="24bae-211">With dynamic cloaking, the identity of the caller during impersonation is based on the current thread token, if there is one.</span></span> <span data-ttu-id="24bae-212">En la ilustración siguiente se muestra la situación en la que B y C establecen la ocultación dinámica y D ven la identidad de un, a pesar de una llamada anterior de B a C.</span><span class="sxs-lookup"><span data-stu-id="24bae-212">The following illustration shows the situation where B and C set dynamic cloaking and D sees the identity of A, despite an earlier call from B to C.</span></span>

![Diagrama que muestra el proceso de Cloaking dinámico.](images/d0848465-82f3-4d5a-851e-566d7800ada0.png)

## <a name="related-topics"></a><span data-ttu-id="24bae-214">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="24bae-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="24bae-215">Delegación y suplantación</span><span class="sxs-lookup"><span data-stu-id="24bae-215">Delegation and Impersonation</span></span>](delegation-and-impersonation.md)
</dt> </dl>

 

