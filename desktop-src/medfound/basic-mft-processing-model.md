---
description: En este tema se describe cómo un cliente utiliza una transformación de Media Foundation (MFT) para procesar los datos. El cliente es todo lo que llama directamente a los métodos de la MFT. Puede tratarse de la aplicación o la Media Foundation canalización.
ms.assetid: be977d75-999e-4e57-9672-00a89246a2c1
title: Modelo básico de procesamiento de MFT
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ca54df6d9765aaf54456c3d9dc4461a82a93d41
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104080333"
---
# <a name="basic-mft-processing-model"></a><span data-ttu-id="539c2-105">Modelo básico de procesamiento de MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-105">Basic MFT Processing Model</span></span>

<span data-ttu-id="539c2-106">En este tema se describe cómo un cliente utiliza una transformación de Media Foundation (MFT) para procesar los datos.</span><span class="sxs-lookup"><span data-stu-id="539c2-106">This topic describes how a client uses a Media Foundation transform (MFT) to process data.</span></span> <span data-ttu-id="539c2-107">El *cliente* es todo lo que llama directamente a los métodos de la MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-107">The *client* is anything that directly calls methods on the MFT.</span></span> <span data-ttu-id="539c2-108">Puede tratarse de la aplicación o la Media Foundation canalización.</span><span class="sxs-lookup"><span data-stu-id="539c2-108">This might be the application or the Media Foundation pipeline.</span></span>

<span data-ttu-id="539c2-109">Lea este tema si está:</span><span class="sxs-lookup"><span data-stu-id="539c2-109">Read this topic if you are:</span></span>

-   <span data-ttu-id="539c2-110">Escritura de una aplicación que realiza llamadas directas a uno o varios MFTs.</span><span class="sxs-lookup"><span data-stu-id="539c2-110">Writing an application that makes direct calls to one or more MFTs.</span></span>
-   <span data-ttu-id="539c2-111">Escribir una MFT personalizada y desea comprender el comportamiento esperado de una MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-111">Writing a custom MFT and want to understand the expected behavior of an MFT.</span></span>

<span data-ttu-id="539c2-112">En este tema se describe un modelo de procesamiento *sincrónico* .</span><span class="sxs-lookup"><span data-stu-id="539c2-112">This topic describes a *synchronous* processing model.</span></span> <span data-ttu-id="539c2-113">En este modelo, todos los métodos de procesamiento de datos se bloquean hasta que se completan.</span><span class="sxs-lookup"><span data-stu-id="539c2-113">In this model, all data-processing methods block until they complete.</span></span> <span data-ttu-id="539c2-114">MFTs también puede admitir un modelo *asincrónico* , que se describe en el tema [MFTs asincrónico](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="539c2-114">MFTs can also support an *asynchronous* model, which is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

-   [<span data-ttu-id="539c2-115">Modelo de procesamiento básico</span><span class="sxs-lookup"><span data-stu-id="539c2-115">Basic Processing Model</span></span>](#basic-processing-model)
    -   [<span data-ttu-id="539c2-116">Crear la MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-116">Create the MFT</span></span>](#create-the-mft)
    -   [<span data-ttu-id="539c2-117">Obtener los identificadores de secuencia</span><span class="sxs-lookup"><span data-stu-id="539c2-117">Get Stream Identifiers</span></span>](#get-stream-identifiers)
    -   [<span data-ttu-id="539c2-118">Establecer tipos de medios</span><span class="sxs-lookup"><span data-stu-id="539c2-118">Set Media Types</span></span>](#set-media-types)
    -   [<span data-ttu-id="539c2-119">Obtener los requisitos de búfer</span><span class="sxs-lookup"><span data-stu-id="539c2-119">Get Buffer Requirements</span></span>](#get-buffer-requirements)
    -   [<span data-ttu-id="539c2-120">Procesar datos</span><span class="sxs-lookup"><span data-stu-id="539c2-120">Process Data</span></span>](#process-data)
-   [<span data-ttu-id="539c2-121">Extensiones para el modelo básico</span><span class="sxs-lookup"><span data-stu-id="539c2-121">Extensions to the Basic Model</span></span>](#extensions-to-the-basic-model)
-   [<span data-ttu-id="539c2-122">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="539c2-122">IMF2DBuffer</span></span>](#imf2dbuffer)
-   [<span data-ttu-id="539c2-123">Vaciar un MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-123">Flushing an MFT</span></span>](#flushing-an-mft)
-   [<span data-ttu-id="539c2-124">Purga de un MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-124">Draining an MFT</span></span>](#draining-an-mft)
-   [<span data-ttu-id="539c2-125">Atributos de ejemplo</span><span class="sxs-lookup"><span data-stu-id="539c2-125">Sample Attributes</span></span>](#sample-attributes)
-   [<span data-ttu-id="539c2-126">Discontinuidades</span><span class="sxs-lookup"><span data-stu-id="539c2-126">Discontinuities</span></span>](#discontinuities)
-   [<span data-ttu-id="539c2-127">Cambios en el formato dinámico</span><span class="sxs-lookup"><span data-stu-id="539c2-127">Dynamic Format Changes</span></span>](#dynamic-format-changes)
-   [<span data-ttu-id="539c2-128">Eventos de secuencia</span><span class="sxs-lookup"><span data-stu-id="539c2-128">Stream Events</span></span>](#stream-events)
-   [<span data-ttu-id="539c2-129">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="539c2-129">Related topics</span></span>](#related-topics)

## <a name="basic-processing-model"></a><span data-ttu-id="539c2-130">Modelo de procesamiento básico</span><span class="sxs-lookup"><span data-stu-id="539c2-130">Basic Processing Model</span></span>

### <a name="create-the-mft"></a><span data-ttu-id="539c2-131">Crear la MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-131">Create the MFT</span></span>

<span data-ttu-id="539c2-132">Hay varias maneras de crear una MFT:</span><span class="sxs-lookup"><span data-stu-id="539c2-132">There are several ways to create an MFT:</span></span>

-   <span data-ttu-id="539c2-133">Llame a la función [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) .</span><span class="sxs-lookup"><span data-stu-id="539c2-133">Call the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function.</span></span>
-   <span data-ttu-id="539c2-134">Llame a la función [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) .</span><span class="sxs-lookup"><span data-stu-id="539c2-134">Call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function.</span></span>
-   <span data-ttu-id="539c2-135">Si ya conoce el CLSID de MFT, simplemente llame a **CoCreateInstance**.</span><span class="sxs-lookup"><span data-stu-id="539c2-135">If you already know the CLSID of the MFT, simply call **CoCreateInstance**.</span></span>

<span data-ttu-id="539c2-136">Algunos MFTs pueden proporcionar otras opciones, como una función de creación especializada.</span><span class="sxs-lookup"><span data-stu-id="539c2-136">Some MFTs might provide other options, such as a specialized creation function.</span></span>

### <a name="get-stream-identifiers"></a><span data-ttu-id="539c2-137">Obtener los identificadores de secuencia</span><span class="sxs-lookup"><span data-stu-id="539c2-137">Get Stream Identifiers</span></span>

<span data-ttu-id="539c2-138">Una MFT tiene una o más *secuencias*.</span><span class="sxs-lookup"><span data-stu-id="539c2-138">An MFT has one or more *streams*.</span></span> <span data-ttu-id="539c2-139">Los flujos de entrada reciben datos de entrada y los flujos de salida generan datos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-139">Input streams receive input data, and output streams generate output data.</span></span> <span data-ttu-id="539c2-140">Las secuencias no se representan como objetos distintos.</span><span class="sxs-lookup"><span data-stu-id="539c2-140">Streams are not represented as distinct objects.</span></span> <span data-ttu-id="539c2-141">En su lugar, varios métodos de MFT toman los identificadores de secuencia como parámetros.</span><span class="sxs-lookup"><span data-stu-id="539c2-141">Instead, various MFT methods take stream identifiers as parameters.</span></span>

<span data-ttu-id="539c2-142">Algunos MFTs permiten al cliente agregar o quitar flujos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-142">Some MFTs allow the client to add or remove input streams.</span></span> <span data-ttu-id="539c2-143">Durante el streaming, una MFT puede Agregar o quitar flujos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-143">During streaming, an MFT can add or remove output streams.</span></span> <span data-ttu-id="539c2-144">(El cliente no puede Agregar o quitar flujos de salida).</span><span class="sxs-lookup"><span data-stu-id="539c2-144">(The client cannot add or remove output streams.)</span></span>

1.  <span data-ttu-id="539c2-145">(Opcional). Llame a [**IMFTransform:: GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) para obtener el número mínimo y máximo de secuencias que puede admitir la MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-145">(Optional.) Call [**IMFTransform::GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) to get the minimum and maximum number of streams that the MFT can support.</span></span> <span data-ttu-id="539c2-146">Si los valores mínimo y máximo son los mismos, el MFT tiene un número fijo de secuencias.</span><span class="sxs-lookup"><span data-stu-id="539c2-146">If the minimum and maximum are the same, the MFT has a fixed number of streams.</span></span>
2.  <span data-ttu-id="539c2-147">Llame a [**IMFTransform:: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) para obtener el número inicial de secuencias.</span><span class="sxs-lookup"><span data-stu-id="539c2-147">Call [**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) to get the initial number of streams.</span></span>
3.  <span data-ttu-id="539c2-148">Llame a [**IMFTransform:: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) para obtener los identificadores de flujo.</span><span class="sxs-lookup"><span data-stu-id="539c2-148">Call [**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) to get the stream identifiers.</span></span> <span data-ttu-id="539c2-149">Si este método devuelve E \_ NOTIMPL, significa que la MFT tiene un número fijo de secuencias, y los identificadores de secuencia son consecutivos a partir de cero.</span><span class="sxs-lookup"><span data-stu-id="539c2-149">If this method returns E\_NOTIMPL, it means the MFT has a fixed number of streams, and the stream identifiers are consecutive starting from zero.</span></span>
4.  <span data-ttu-id="539c2-150">(Opcional). Si MFT no tiene un número fijo de flujos, llame a [**IMFTransform:: AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) para agregar más flujos de entrada o [**IMFTransform::D eleteinputstream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) para quitar flujos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-150">(Optional.) If the MFT does not have a fixed number of streams, call [**IMFTransform::AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) to add more input streams, or [**IMFTransform::DeleteInputStream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) to remove input streams.</span></span> <span data-ttu-id="539c2-151">(No se pueden agregar o quitar secuencias de salida).</span><span class="sxs-lookup"><span data-stu-id="539c2-151">(You cannot add or remove output streams.)</span></span>

### <a name="set-media-types"></a><span data-ttu-id="539c2-152">Establecer tipos de medios</span><span class="sxs-lookup"><span data-stu-id="539c2-152">Set Media Types</span></span>

<span data-ttu-id="539c2-153">Para que un MFT pueda procesar los datos, el cliente debe establecer un tipo de medio para cada una de las secuencias de la MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-153">Before an MFT can process data, the client must set a media types for each of the streams of the MFT.</span></span> <span data-ttu-id="539c2-154">Una MFT puede requerir que el cliente establezca los tipos de entrada antes de establecer los tipos de salida, o podría requerir el orden opuesto (los tipos de salida primero).</span><span class="sxs-lookup"><span data-stu-id="539c2-154">An MFT might require that the client set the input types before setting the output types, or might require the opposite order (output types first).</span></span> <span data-ttu-id="539c2-155">Algunos MFTs no tienen un requisito en el orden.</span><span class="sxs-lookup"><span data-stu-id="539c2-155">Some MFTs do not have a requirement on the order.</span></span>

<span data-ttu-id="539c2-156">Una MFT puede proporcionar una lista de los tipos de medios preferidos para un flujo.</span><span class="sxs-lookup"><span data-stu-id="539c2-156">An MFT can provide a list of preferred media types for a stream.</span></span> <span data-ttu-id="539c2-157">Además, MFTs puede indicar los formatos generales que admiten agregando esta información al registro.</span><span class="sxs-lookup"><span data-stu-id="539c2-157">Also, MFTs can indicate the general formats that they support by adding this information to the registry.</span></span>

<span data-ttu-id="539c2-158">Para establecer los tipos de medios, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="539c2-158">To set the media types, do the following:</span></span>

1.  <span data-ttu-id="539c2-159">(Opcional). Para cada flujo de entrada, llame a [**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) para obtener la lista de tipos preferidos para esa secuencia.</span><span class="sxs-lookup"><span data-stu-id="539c2-159">(Optional.) For each input stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) to get the list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="539c2-160">Si este método devuelve \_ \_ el tipo de transformación MF E \_ \_ no \_ establecido, debe establecer primero los tipos de salida; vaya al paso 3.</span><span class="sxs-lookup"><span data-stu-id="539c2-160">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the output types first; skip to step 3.</span></span>
    -   <span data-ttu-id="539c2-161">Si el método devuelve E \_ NOTIMPL, la MFT no tiene una lista de tipos de entrada preferidos. vaya al paso 2.</span><span class="sxs-lookup"><span data-stu-id="539c2-161">If the method returns E\_NOTIMPL, the MFT does not have a list of preferred input types; skip to step 2.</span></span>
2.  <span data-ttu-id="539c2-162">Para cada flujo de entrada, llame a [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) para establecer el tipo de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-162">For each input stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the input type.</span></span> <span data-ttu-id="539c2-163">Puede usar un tipo de medio del paso 1, o un tipo que describa los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-163">You can use a media type from step 1, or a type that describes your input data.</span></span> <span data-ttu-id="539c2-164">Si algún flujo devuelve el \_ \_ tipo de transformación MF E \_ \_ no \_ establecido, vaya al paso 3.</span><span class="sxs-lookup"><span data-stu-id="539c2-164">If any stream returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, skip to step 3.</span></span>
3.  <span data-ttu-id="539c2-165">(Opcional). Para cada flujo de salida, llame a [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) para obtener una lista de los tipos preferidos para esa secuencia.</span><span class="sxs-lookup"><span data-stu-id="539c2-165">(Optional.) For each output stream, call [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get a list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="539c2-166">Si este método devuelve \_ \_ el tipo de transformación MF E \_ \_ no \_ establecido, debe establecer los tipos de entrada en primer lugar; vuelva al paso 1.</span><span class="sxs-lookup"><span data-stu-id="539c2-166">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the input types first; go back to step 1.</span></span>
    -   <span data-ttu-id="539c2-167">Si algún flujo devuelve E \_ NOTIMPL, la MFT no tiene una lista de tipos de salida preferidos. vaya al paso 4.</span><span class="sxs-lookup"><span data-stu-id="539c2-167">If any stream returns E\_NOTIMPL, the MFT does not have a list of preferred output types; skip to step 4.</span></span>
4.  <span data-ttu-id="539c2-168">Para cada flujo de salida, llame a [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) para establecer el tipo de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-168">For each output stream, call [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set the output type.</span></span> <span data-ttu-id="539c2-169">Puede usar un tipo de medio del paso 3 o un tipo que describa el formato de salida necesario.</span><span class="sxs-lookup"><span data-stu-id="539c2-169">You can use a media type from step 3, or a type that describes your required output format.</span></span>
5.  <span data-ttu-id="539c2-170">Si algún flujo de entrada no tiene un tipo de medio, vuelva al paso 1.</span><span class="sxs-lookup"><span data-stu-id="539c2-170">If any input streams do not have a media type, go back to step 1.</span></span>

### <a name="get-buffer-requirements"></a><span data-ttu-id="539c2-171">Obtener los requisitos de búfer</span><span class="sxs-lookup"><span data-stu-id="539c2-171">Get Buffer Requirements</span></span>

<span data-ttu-id="539c2-172">Después de que el cliente establezca los tipos de medios, debe obtener los requisitos de búfer para cada flujo:</span><span class="sxs-lookup"><span data-stu-id="539c2-172">After the client sets the media types, it should get the buffer requirements for each stream:</span></span>

-   <span data-ttu-id="539c2-173">Para cada flujo de entrada, llame a [**IMFTransform:: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="539c2-173">For each input stream, call [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span></span>
-   <span data-ttu-id="539c2-174">Para cada flujo de salida, llame a [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="539c2-174">For each output stream, call [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span></span>

### <a name="process-data"></a><span data-ttu-id="539c2-175">Procesar datos</span><span class="sxs-lookup"><span data-stu-id="539c2-175">Process Data</span></span>

<span data-ttu-id="539c2-176">Una MFT está diseñada para ser un equipo de estado de confianza.</span><span class="sxs-lookup"><span data-stu-id="539c2-176">An MFT is designed to be a reliable state machine.</span></span> <span data-ttu-id="539c2-177">No vuelve a realizar ninguna llamada al cliente.</span><span class="sxs-lookup"><span data-stu-id="539c2-177">It does not make any calls back to the client.</span></span>

1.  <span data-ttu-id="539c2-178">Llame a [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con [**el \_ mensaje \_ de \_ Inicio Notify Begin \_ streaming**](mft-message-notify-begin-streaming.md) .</span><span class="sxs-lookup"><span data-stu-id="539c2-178">Call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_BEGIN\_STREAMING**](mft-message-notify-begin-streaming.md) message.</span></span> <span data-ttu-id="539c2-179">Este mensaje solicita a la MFT que asigne los recursos que necesita durante el streaming.</span><span class="sxs-lookup"><span data-stu-id="539c2-179">This message requests the MFT to allocate any resources it needs during streaming.</span></span>
2.  <span data-ttu-id="539c2-180">Llame a [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) en al menos un flujo de entrada para proporcionar un ejemplo de entrada a la MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-180">Call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on at least one input stream to deliver an input sample to the MFT.</span></span>
3.  <span data-ttu-id="539c2-181">(Opcional). Llame a [**IMFTransform:: GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) para consultar si el MFT puede generar un ejemplo de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-181">(Optional.) Call [**IMFTransform::GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) to query whether the MFT can generate an output sample.</span></span> <span data-ttu-id="539c2-182">Si el método devuelve S \_ correcto, compruebe el parámetro *pdwFlags* .</span><span class="sxs-lookup"><span data-stu-id="539c2-182">If the method returns S\_OK, check the *pdwFlags* parameter.</span></span> <span data-ttu-id="539c2-183">Si *pdwFlags* contiene el **indicador \_ ejemplo de estado de salida de MFT \_ \_ \_ listo** , vaya al paso 4.</span><span class="sxs-lookup"><span data-stu-id="539c2-183">If *pdwFlags* contains the **MFT\_OUTPUT\_STATUS\_SAMPLE\_READY** flag, go to step 4.</span></span> <span data-ttu-id="539c2-184">Si *pdwFlags* es cero, vuelva al paso 2.</span><span class="sxs-lookup"><span data-stu-id="539c2-184">If *pdwFlags* is zero, go back to step 2.</span></span> <span data-ttu-id="539c2-185">Si el método devuelve E \_ NOTIMPL, vaya al paso 4.</span><span class="sxs-lookup"><span data-stu-id="539c2-185">If the method returns E\_NOTIMPL, go to step 4.</span></span>
4.  <span data-ttu-id="539c2-186">Llame a [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obtener los datos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-186">Call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data.</span></span>
    -   <span data-ttu-id="539c2-187">Si el método devuelve **la \_ transformación MF E \_ \_ necesita \_ más \_** información, significa que la MFT requiere más datos de entrada. Vuelva al paso 2.</span><span class="sxs-lookup"><span data-stu-id="539c2-187">If the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**, it means the MFT requires more input data; go back to step 2.</span></span>
    -   <span data-ttu-id="539c2-188">Si el método devuelve **el \_ \_ cambio de \_ flujo \_ de transformación MF E**, significa que el número de flujos de salida ha cambiado o el formato de salida ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="539c2-188">If the method returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, it means the number of output streams has changed, or the output format has changed.</span></span> <span data-ttu-id="539c2-189">Es posible que el cliente necesite consultar nuevos identificadores de secuencia o establecer nuevos tipos de medios.</span><span class="sxs-lookup"><span data-stu-id="539c2-189">The client might need to query for new stream identifiers or set new media types.</span></span> <span data-ttu-id="539c2-190">Para obtener más información, consulte la documentación de [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="539c2-190">For more information, see the documentation for [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
5.  <span data-ttu-id="539c2-191">Si todavía hay datos de entrada para procesar, vaya al paso 2.</span><span class="sxs-lookup"><span data-stu-id="539c2-191">If there is still input data to process, go to step 2.</span></span> <span data-ttu-id="539c2-192">Si la MFT ha consumido todos los datos de entrada disponibles, continúe en el paso 6.</span><span class="sxs-lookup"><span data-stu-id="539c2-192">If the MFT has consumed all of the available input data, proceed to step 6.</span></span>
6.  <span data-ttu-id="539c2-193">Llame a [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con [**el \_ mensaje \_ de MFT notificación del \_ final \_ del mensaje de la \_ secuencia**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="539c2-193">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_END\_OF\_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
7.  <span data-ttu-id="539c2-194">Llame a [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con el mensaje de agotamiento del comando de mensaje de [**MFT \_ \_ \_**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="539c2-194">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
8.  <span data-ttu-id="539c2-195">Llame a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obtener el resultado restante.</span><span class="sxs-lookup"><span data-stu-id="539c2-195">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the remaining output.</span></span> <span data-ttu-id="539c2-196">Repita este paso hasta que el método devuelva la **\_ transformación MF E \_ \_ necesite \_ más \_ datos**.</span><span class="sxs-lookup"><span data-stu-id="539c2-196">Repeat this step until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span> <span data-ttu-id="539c2-197">Este valor devuelto indica que toda la salida se ha purgado de la MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-197">This return value signals that all of the output has been drained from the MFT.</span></span> <span data-ttu-id="539c2-198">(No lo trate como una condición de error).</span><span class="sxs-lookup"><span data-stu-id="539c2-198">(Do not treat this as an error condition.)</span></span>

<span data-ttu-id="539c2-199">La secuencia que se describe aquí mantiene la menor cantidad posible de datos en la MFT.</span><span class="sxs-lookup"><span data-stu-id="539c2-199">The sequence described here keeps as little data as possible in the MFT.</span></span> <span data-ttu-id="539c2-200">Después de cada llamada a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), el cliente intenta obtener la salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-200">After every call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), the client attempts to get output.</span></span> <span data-ttu-id="539c2-201">Pueden ser necesarios varios ejemplos de entrada para generar un ejemplo de salida, o un único ejemplo de entrada puede generar varios ejemplos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-201">Several input samples might be needed to produce one output sample, or a single input sample might generate several output samples.</span></span> <span data-ttu-id="539c2-202">El comportamiento óptimo para el cliente es extraer ejemplos de salida de la MFT hasta que la MFT requiera más entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-202">The optimal behavior for the client is to pull output samples from the MFT until the MFT requires more input.</span></span>

<span data-ttu-id="539c2-203">Sin embargo, el MFT debe ser capaz de controlar un orden diferente de llamadas a métodos por parte del cliente.</span><span class="sxs-lookup"><span data-stu-id="539c2-203">However, the MFT should be able to handle a different order of method calls by the client.</span></span> <span data-ttu-id="539c2-204">Por ejemplo, el cliente podría simplemente alternar entre las llamadas a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) y [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="539c2-204">For example, the client might simply alternate between calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="539c2-205">La MFT debe restringir la cantidad de entradas que obtiene al devolver **MF \_ E \_ NOTACCEPTING** de **ProcessInput** siempre que tenga una salida para generar.</span><span class="sxs-lookup"><span data-stu-id="539c2-205">The MFT should restrict the amount of input that it gets by returning **MF\_E\_NOTACCEPTING** from **ProcessInput** whenever it has some output to produce.</span></span>

<span data-ttu-id="539c2-206">El orden de las llamadas a métodos que se describen aquí no es la única secuencia válida de eventos.</span><span class="sxs-lookup"><span data-stu-id="539c2-206">The order of method calls described here is not the only valid sequence of events.</span></span> <span data-ttu-id="539c2-207">Por ejemplo, los pasos 3 y 4 suponen que el cliente se inicia con los tipos de entrada y, a continuación, prueba los tipos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-207">For example, steps 3 and 4 assume that the client starts with the input types and then tries the output types.</span></span> <span data-ttu-id="539c2-208">El cliente también puede invertir este orden e iniciar con los tipos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-208">The client can also reverse this order and start with the output types.</span></span> <span data-ttu-id="539c2-209">En cualquier caso, si la MFT requiere el orden contrario, debe devolver el tipo de transformación MF \_ E \_ \_ \_ no \_ establecido.</span><span class="sxs-lookup"><span data-stu-id="539c2-209">In either case, if the MFT requires the opposite order, it should return the error code MF\_E\_TRANSFORM\_TYPE\_NOT\_SET.</span></span>

<span data-ttu-id="539c2-210">El cliente puede llamar a métodos informativos, como [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) y [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), en cualquier momento durante el streaming.</span><span class="sxs-lookup"><span data-stu-id="539c2-210">The client can call informational methods, such as [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) and [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), at any time during streaming.</span></span> <span data-ttu-id="539c2-211">El cliente también puede intentar cambiar los tipos de medios en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="539c2-211">The client can also attempt to change the media types at any time.</span></span> <span data-ttu-id="539c2-212">La MFT debe devolver un código de error si no se trata de una operación válida.</span><span class="sxs-lookup"><span data-stu-id="539c2-212">The MFT should return an error code if this is not a valid operation.</span></span> <span data-ttu-id="539c2-213">En Resumen, MFTs debe asumir muy poco el orden de las operaciones, aparte de lo que se documenta en las propias llamadas.</span><span class="sxs-lookup"><span data-stu-id="539c2-213">In short, MFTs should assume very little about the order of operations, other than what is documented in the calls themselves.</span></span>

<span data-ttu-id="539c2-214">En el diagrama siguiente se muestra un gráfico de flujo de los procedimientos descritos en este tema.</span><span class="sxs-lookup"><span data-stu-id="539c2-214">The following diagram shows a flow chart of the procedures described in this topic.</span></span>

![diagrama de flujo que conduce de obtener identificadores de flujo mediante bucles que establecen tipos de entrada, obtienen entradas y procesan los resultados.](images/mft-processing.gif)

## <a name="extensions-to-the-basic-model"></a><span data-ttu-id="539c2-216">Extensiones para el modelo básico</span><span class="sxs-lookup"><span data-stu-id="539c2-216">Extensions to the Basic Model</span></span>

<span data-ttu-id="539c2-217">Opcionalmente, una MFT puede admitir algunas extensiones para el modelo básico de streaming.</span><span class="sxs-lookup"><span data-stu-id="539c2-217">Optionally, an MFT can support some extensions to the basic streaming model.</span></span>

-   <span data-ttu-id="539c2-218">Secuencias de lectura diferida.</span><span class="sxs-lookup"><span data-stu-id="539c2-218">Lazy-read streams.</span></span> <span data-ttu-id="539c2-219">Si el método [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) devuelve la marca de **\_ \_ \_ \_ lectura diferida del flujo de salida de MFT** para un flujo de salida, el cliente no tiene que recopilar datos de ese flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-219">If the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_LAZY\_READ** flag for an output stream, the client does not have to collect data from that output stream.</span></span> <span data-ttu-id="539c2-220">La MFT continúa aceptando la entrada y, en algún momento, la MFT descartará los datos de salida de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="539c2-220">The MFT continues to accept input, and at some point the MFT will discard the output data from that stream.</span></span> <span data-ttu-id="539c2-221">Si todos los flujos de salida tienen esta marca, la MFT nunca no aceptará la entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-221">If all of the output streams have this flag, the MFT will never fail to accept input.</span></span> <span data-ttu-id="539c2-222">Un ejemplo podría ser una transformación de visualización, donde el cliente obtiene la salida solo cuando tiene ciclos de CPU de reserva para dibujar la visualización.</span><span class="sxs-lookup"><span data-stu-id="539c2-222">An example might be a visualization transform, where the client gets the output only when it has spare CPU cycles to draw the visualization.</span></span>
-   <span data-ttu-id="539c2-223">Flujos descartables.</span><span class="sxs-lookup"><span data-stu-id="539c2-223">Discardable streams.</span></span> <span data-ttu-id="539c2-224">Si el método [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) devuelve la marca de **\_ salida \_ \_ descartable** de la MFT para un flujo de salida, el cliente puede solicitar a la MFT que descarte la salida, pero la MFT no descartará ningún resultado a menos que se solicite.</span><span class="sxs-lookup"><span data-stu-id="539c2-224">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_DISCARDABLE** flag for an output stream, the client can request the MFT to discard output, but the MFT will not discard any output unless requested.</span></span> <span data-ttu-id="539c2-225">Cuando el MFT alcanza su búfer de entrada máximo, el cliente debe recopilar algunos datos de salida o solicitar a la MFT que descarte la salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-225">When the MFT reaches its maximum input buffer, the client must either collect some output data or request the MFT to discard the output.</span></span>
-   <span data-ttu-id="539c2-226">Secuencias opcionales.</span><span class="sxs-lookup"><span data-stu-id="539c2-226">Optional streams.</span></span> <span data-ttu-id="539c2-227">Si el método [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) devuelve la **marca \_ \_ \_ opcional del flujo de salida de MFT** para un flujo de salida, o el método [**IMFTransform:: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) devuelve la marca **\_ \_ \_ opcional del flujo de entrada de MFT** para un flujo de entrada, esa secuencia es opcional.</span><span class="sxs-lookup"><span data-stu-id="539c2-227">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_OPTIONAL** flag for an output stream, or the [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) method returns the **MFT\_INPUT\_STREAM\_OPTIONAL** flag for an input stream, that stream is optional.</span></span> <span data-ttu-id="539c2-228">El cliente no tiene que establecer un tipo de medio en la secuencia.</span><span class="sxs-lookup"><span data-stu-id="539c2-228">The client does not have to set a media type on the stream.</span></span> <span data-ttu-id="539c2-229">Si el cliente no establece el tipo, se anula la selección de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="539c2-229">If the client does not set the type, the stream is deselected.</span></span> <span data-ttu-id="539c2-230">Un flujo de salida no seleccionado no produce ejemplos y el cliente no proporciona un búfer para la secuencia cuando llama a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="539c2-230">A deselected output stream does not produce samples, and the client does not provide a buffer for the stream when it calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="539c2-231">Un flujo de entrada anulada no acepta datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-231">A deselected input stream does not accept input data.</span></span> <span data-ttu-id="539c2-232">Una MFT puede marcar todos los flujos de entrada y salida como opcionales.</span><span class="sxs-lookup"><span data-stu-id="539c2-232">An MFT can mark all of its input and output streams as optional.</span></span> <span data-ttu-id="539c2-233">Sin embargo, se espera que se seleccione al menos una entrada y una salida para que el MFT funcione.</span><span class="sxs-lookup"><span data-stu-id="539c2-233">However, it is expected that at least one input and one output must be selected for the MFT to work.</span></span>
-   <span data-ttu-id="539c2-234">Procesamiento asincrónico.</span><span class="sxs-lookup"><span data-stu-id="539c2-234">Asynchronous processing.</span></span> <span data-ttu-id="539c2-235">El modelo de procesamiento asincrónico se presentó en Windows 7.</span><span class="sxs-lookup"><span data-stu-id="539c2-235">The asynchronous processing model was introduced in Windows 7.</span></span> <span data-ttu-id="539c2-236">Se describe en el tema [MFTs asincrónico](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="539c2-236">It is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

## <a name="imf2dbuffer"></a><span data-ttu-id="539c2-237">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="539c2-237">IMF2DBuffer</span></span>

<span data-ttu-id="539c2-238">Si una MFT procesa datos de vídeo sin comprimir, debe usar la interfaz [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) para manipular los búferes de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="539c2-238">If an MFT processes uncompressed video data, it should use the [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) interface to manipulate the sample buffers.</span></span> <span data-ttu-id="539c2-239">Para obtener esta interfaz, consulte la interfaz [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) en cualquier búfer de entrada o salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-239">To get this interface, query the [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) interface on any input or output buffer.</span></span> <span data-ttu-id="539c2-240">Si no se usa esta interfaz cuando está disponible, pueden producirse copias de búfer adicionales.</span><span class="sxs-lookup"><span data-stu-id="539c2-240">Not using this interface when it is available may result in additional buffer copies.</span></span> <span data-ttu-id="539c2-241">Para hacer un uso correcto de esta interfaz, la transformación no debe bloquear el búfer mediante la interfaz **IMFMediaBuffer** cuando **IMF2DBuffer** esté disponible.</span><span class="sxs-lookup"><span data-stu-id="539c2-241">To make proper use of this interface, the transform should not lock the buffer using the **IMFMediaBuffer** interface when **IMF2DBuffer** is available.</span></span>

<span data-ttu-id="539c2-242">Para obtener más información acerca del procesamiento de datos de vídeo, consulte [búferes de vídeo sin comprimir](uncompressed-video-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="539c2-242">For more information about processing video data, see [Uncompressed Video Buffers](uncompressed-video-buffers.md).</span></span>

## <a name="flushing-an-mft"></a><span data-ttu-id="539c2-243">Vaciar un MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-243">Flushing an MFT</span></span>

<span data-ttu-id="539c2-244">*Vaciar* una MFT hace que la MFT descarte todos los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-244">*Flushing* an MFT causes the MFT to discard all of its input data.</span></span> <span data-ttu-id="539c2-245">Esto puede producir una interrupción en el flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-245">This can cause a break in the output stream.</span></span> <span data-ttu-id="539c2-246">Un cliente normalmente vaciaría una MFT antes de buscar un nuevo punto en el flujo de entrada o cambiar a un nuevo flujo de entrada, cuando el cliente no se preocupa de perder datos.</span><span class="sxs-lookup"><span data-stu-id="539c2-246">A client would typically flush an MFT before seeking to a new point in the input stream or switching to a new input stream, when the client does not care about losing data.</span></span>

<span data-ttu-id="539c2-247">Para vaciar una MFT, llame a [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con el mensaje de [**\_ \_ \_ vaciado del comando del mensaje de MFT**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="539c2-247">To flush an MFT, call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_FLUSH**](mft-message-command-flush.md) message.</span></span>

## <a name="draining-an-mft"></a><span data-ttu-id="539c2-248">Purga de un MFT</span><span class="sxs-lookup"><span data-stu-id="539c2-248">Draining an MFT</span></span>

<span data-ttu-id="539c2-249">La *purga* de una MFT hace que la MFT genere tantas salidas como sea posible desde cualquier dato de entrada que ya se haya enviado.</span><span class="sxs-lookup"><span data-stu-id="539c2-249">*Draining* an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="539c2-250">Si el MFT no puede generar un ejemplo de salida completo a partir de la entrada disponible, quitará los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-250">If the MFT cannot produce a complete output sample from the available input, it will drop input data.</span></span> <span data-ttu-id="539c2-251">Un cliente normalmente agotaría un MFT cuando llegó al final de la secuencia de origen, o inmediatamente antes de un cambio de formato en el flujo de origen.</span><span class="sxs-lookup"><span data-stu-id="539c2-251">A client would typically drain an MFT when it reached the end of the source stream, or immediately before a format change in the source stream.</span></span> <span data-ttu-id="539c2-252">Para purgar un MFT, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="539c2-252">To drain an MFT, do the following:</span></span>

1.  <span data-ttu-id="539c2-253">Llame a [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con el mensaje de agotamiento del comando de mensaje de [**MFT \_ \_ \_**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="539c2-253">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span> <span data-ttu-id="539c2-254">Este mensaje notifica a la MFT que debe proporcionar tantos datos de salida como los datos de entrada que ya se han enviado.</span><span class="sxs-lookup"><span data-stu-id="539c2-254">This message notifies the MFT that it should deliver as much output data as it can from the input data that has already been sent.</span></span>
2.  <span data-ttu-id="539c2-255">Llame a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) para obtener los datos de salida, hasta que el método devuelva la **\_ transformación MF E \_ \_ necesite \_ más \_ entrada**.</span><span class="sxs-lookup"><span data-stu-id="539c2-255">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data, until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>

<span data-ttu-id="539c2-256">Mientras se está purgando la MFT, no aceptará más entradas.</span><span class="sxs-lookup"><span data-stu-id="539c2-256">While the MFT is being drained, it will not accept any more input.</span></span>

## <a name="sample-attributes"></a><span data-ttu-id="539c2-257">Atributos de ejemplo</span><span class="sxs-lookup"><span data-stu-id="539c2-257">Sample Attributes</span></span>

<span data-ttu-id="539c2-258">Los ejemplos de entrada pueden tener atributos que se deben copiar en los ejemplos de salida correspondientes.</span><span class="sxs-lookup"><span data-stu-id="539c2-258">The input samples might have attributes that must be copied to the corresponding output samples.</span></span>

-   <span data-ttu-id="539c2-259">Si MFT devuelve **Variant \_ true** para la propiedad [**MFPKEY \_ exattribute \_ Supported**](mfpkey-exattribute-supported-property.md) , el MFT debe copiar los atributos.</span><span class="sxs-lookup"><span data-stu-id="539c2-259">If the MFT returns **VARIANT\_TRUE** for the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property, the MFT must copy the attributes.</span></span>
-   <span data-ttu-id="539c2-260">Si la propiedad [**MFPKEY \_ exattribute \_ Supported**](mfpkey-exattribute-supported-property.md) es **Variant \_ false** o no está establecida, el cliente debe copiar los atributos.</span><span class="sxs-lookup"><span data-stu-id="539c2-260">If the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property is either **VARIANT\_FALSE** or is not set, the client must copy the attributes.</span></span>

<span data-ttu-id="539c2-261">En el caso de una MFT con una entrada y una salida, puede usar la siguiente regla general:</span><span class="sxs-lookup"><span data-stu-id="539c2-261">For an MFT with one input and one output, you can use the following general rule:</span></span>

-   <span data-ttu-id="539c2-262">Si cada ejemplo de entrada produce exactamente un ejemplo de salida, puede permitir que el cliente copie los atributos.</span><span class="sxs-lookup"><span data-stu-id="539c2-262">If each input sample produces exactly one output sample, you can let the client copy the attributes.</span></span> <span data-ttu-id="539c2-263">Deje la propiedad [**MFPKEY \_ \_ exsupported exattribute**](mfpkey-exattribute-supported-property.md) .</span><span class="sxs-lookup"><span data-stu-id="539c2-263">Leave the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property unset.</span></span>
-   <span data-ttu-id="539c2-264">Si no hay una correspondencia uno a uno entre los ejemplos de entrada y los ejemplos de salida, el MFT debe determinar los atributos correctos para los ejemplos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-264">If there is not a one-to-one correspondence between input samples and output samples, the MFT must determine the correct attributes for output samples.</span></span> <span data-ttu-id="539c2-265">Establezca la propiedad [**MFPKEY \_ exattribute \_ Supported**](mfpkey-exattribute-supported-property.md) en **Variant \_ true**.</span><span class="sxs-lookup"><span data-stu-id="539c2-265">Set the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property to **VARIANT\_TRUE**.</span></span>

## <a name="discontinuities"></a><span data-ttu-id="539c2-266">Discontinuidades</span><span class="sxs-lookup"><span data-stu-id="539c2-266">Discontinuities</span></span>

<span data-ttu-id="539c2-267">Una discontinuidad es una interrupción en una secuencia de audio o de vídeo.</span><span class="sxs-lookup"><span data-stu-id="539c2-267">A discontinuity is a break in an audio or video stream.</span></span> <span data-ttu-id="539c2-268">Las discontinuidades pueden deberse a la pérdida de paquetes en una conexión de red, a datos de archivos dañados, a un cambio de un flujo de origen a otro o a un amplio abanico de otras causas.</span><span class="sxs-lookup"><span data-stu-id="539c2-268">Discontinuities can be caused by dropped packets on a network connection, corrupt file data, a switch from one source stream to another, or a wide range of other causes.</span></span> <span data-ttu-id="539c2-269">Las discontinuidades se señalizan estableciendo el [**atributo \_ discontinuidad de MFSampleExtension**](mfsampleextension-discontinuity-attribute.md) en el primer ejemplo después de la discontinuidad.</span><span class="sxs-lookup"><span data-stu-id="539c2-269">Discontinuities are signaled by setting the [**MFSampleExtension\_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute on the first sample after the discontinuity.</span></span> <span data-ttu-id="539c2-270">No es posible señalar una discontinuidad en medio de un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="539c2-270">It is not possible to signal a discontinuity in the middle of a sample.</span></span> <span data-ttu-id="539c2-271">Por lo tanto, los datos descontinuos se deben enviar en ejemplos independientes.</span><span class="sxs-lookup"><span data-stu-id="539c2-271">Therefore, any discontinuous data should be sent in separate samples.</span></span>

<span data-ttu-id="539c2-272">Algunas transformaciones, especialmente las que controlan datos sin comprimir, como efectos de audio y vídeo, deben omitir las discontinuidades al procesar los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-272">Some transforms, especially those that handle uncompressed data, such as audio and video effects, should ignore discontinuities when they process input data.</span></span> <span data-ttu-id="539c2-273">Por lo general, estos MFTs están diseñados para administrar datos continuos y deben tratar los datos que reciben como continuos, incluso después de una discontinuidad.</span><span class="sxs-lookup"><span data-stu-id="539c2-273">These MFTs are generally designed to handle continuous data, and should treat any data they receive as continuous, even after a discontinuity.</span></span>

<span data-ttu-id="539c2-274">Si un MFT omite una discontinuidad en los datos de entrada, todavía debe establecer la marca de discontinuidad en el ejemplo de salida, si el ejemplo de salida tiene la misma marca de tiempo que la muestra de entrada.</span><span class="sxs-lookup"><span data-stu-id="539c2-274">If an MFT ignores a discontinuity on input data, it should still set the discontinuity flag on the output sample, if the output sample has the same time stamp as the input sample.</span></span> <span data-ttu-id="539c2-275">Sin embargo, si el ejemplo de salida tiene una marca de tiempo diferente, la MFT no debe propagar la discontinuidad.</span><span class="sxs-lookup"><span data-stu-id="539c2-275">If the output sample has a different time stamp, however, the MFT should not propagate the discontinuity.</span></span> <span data-ttu-id="539c2-276">(Este sería el caso en algunos remuestreadores de audio, por ejemplo). Una discontinuidad en el lugar equivocado de la secuencia es peor que ninguna discontinuidad.</span><span class="sxs-lookup"><span data-stu-id="539c2-276">(This would be the case in some audio resamplers, for example.) A discontinuity at the wrong place in the stream is worse than no discontinuity.</span></span>

<span data-ttu-id="539c2-277">La mayoría de los descodificadores no pueden omitir las discontinuidades, ya que una discontinuidad afecta a la interpretación de la siguiente muestra.</span><span class="sxs-lookup"><span data-stu-id="539c2-277">Most decoders cannot ignore discontinuities, because a discontinuity affects the interpretation of the next sample.</span></span> <span data-ttu-id="539c2-278">Cualquier tecnología de codificación que use la compresión entre fotogramas, como MPEG-2, entra en esta categoría.</span><span class="sxs-lookup"><span data-stu-id="539c2-278">Any encoding technology that uses inter-frame compression, such as MPEG-2, falls into this category.</span></span> <span data-ttu-id="539c2-279">Algunos esquemas de codificación solo usan la compresión intra-Frame, como DV y MJPEG.</span><span class="sxs-lookup"><span data-stu-id="539c2-279">Some encoding schemes use only intra-frame compression, such as DV and MJPEG.</span></span> <span data-ttu-id="539c2-280">Estos descodificadores pueden omitir de forma segura las discontinuidades.</span><span class="sxs-lookup"><span data-stu-id="539c2-280">These decoders can safely ignore discontinuities.</span></span>

<span data-ttu-id="539c2-281">Las transformaciones que responden a las discontinuidades normalmente deben generar la mayoría de los datos antes de la discontinuidad que puedan y descartar el resto.</span><span class="sxs-lookup"><span data-stu-id="539c2-281">Transforms that respond to discontinuities should generally output as much of the data before the discontinuity as they can, and discard the rest.</span></span> <span data-ttu-id="539c2-282">El ejemplo de entrada con la marca de discontinuidad debe procesarse como si fuera la primera muestra de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="539c2-282">The input sample with the discontinuity flag should be processed as though it were the first sample in the stream.</span></span> <span data-ttu-id="539c2-283">(Este comportamiento coincide con el especificado en el mensaje de [**agotamiento del comando del mensaje de MFT \_ \_ \_**](mft-message-command-drain.md) ). Sin embargo, los detalles exactos dependerán del formato del medio.</span><span class="sxs-lookup"><span data-stu-id="539c2-283">(This behavior matches what is specified for the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.) However, the exact details will depend on the media format.</span></span>

<span data-ttu-id="539c2-284">Si un descodificador no realiza ninguna acción para mitigar una discontinuidad, debe copiar la marca de discontinuidad en los datos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-284">If a decoder does nothing to mitigate a discontinuity, it should copy the discontinuity flag to the output data.</span></span> <span data-ttu-id="539c2-285">Los demultiplexadores y otros MFTs que funcionan completamente con datos comprimidos deben copiar cualquier interrupción en sus flujos de salida.</span><span class="sxs-lookup"><span data-stu-id="539c2-285">Demultiplexers and other MFTs that work entirely with compressed data must copy any discontinuities to their output streams.</span></span> <span data-ttu-id="539c2-286">De lo contrario, es posible que los componentes de nivel inferior no puedan descodificar los datos comprimidos correctamente.</span><span class="sxs-lookup"><span data-stu-id="539c2-286">Otherwise, the downstream components may not be able to decode the compressed data correctly.</span></span> <span data-ttu-id="539c2-287">En general, casi siempre es correcto para pasar las discontinuidad de nivel inferior, a menos que la MFT contenga código explícito para suavizar las discontinuidades.</span><span class="sxs-lookup"><span data-stu-id="539c2-287">In general, it is almost always correct to pass discontinuities downstream, unless the MFT contains explicit code to smooth out discontinuities.</span></span>

## <a name="dynamic-format-changes"></a><span data-ttu-id="539c2-288">Cambios en el formato dinámico</span><span class="sxs-lookup"><span data-stu-id="539c2-288">Dynamic Format Changes</span></span>

<span data-ttu-id="539c2-289">Los formatos pueden cambiar durante el streaming.</span><span class="sxs-lookup"><span data-stu-id="539c2-289">Formats can change during streaming.</span></span> <span data-ttu-id="539c2-290">Por ejemplo, la relación de aspecto puede cambiar en medio de una secuencia de vídeo.</span><span class="sxs-lookup"><span data-stu-id="539c2-290">For example, aspect ratio can change in the middle of a video stream.</span></span>

<span data-ttu-id="539c2-291">Para obtener más información sobre cómo se administran los cambios de flujo mediante un MFT, consulte [control de los cambios de flujo](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="539c2-291">For details about how stream changes are handled by an MFT, see [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="stream-events"></a><span data-ttu-id="539c2-292">Eventos de secuencia</span><span class="sxs-lookup"><span data-stu-id="539c2-292">Stream Events</span></span>

<span data-ttu-id="539c2-293">Para enviar un evento a un MFT, llame a [**IMFTransform::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="539c2-293">To send an event to an MFT, call [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="539c2-294">Si el método devuelve **MF \_ S \_ Transform \_ \_ no \_ Propagate \_ Event**, MFT devolverá el evento al llamador en una llamada subsiguiente a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="539c2-294">If the method returns **MF\_S\_TRANSFORM\_DO\_NOT\_PROPAGATE\_EVENT**, the MFT will return the event to the caller on a subsequent call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="539c2-295">Si el método devuelve cualquier otro valor **HRESULT** , el MFT no devolverá el evento al cliente en **ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="539c2-295">If the method returns any other **HRESULT** value, the MFT will not return the event to the client in **ProcessOutput**.</span></span> <span data-ttu-id="539c2-296">En ese caso, el cliente es responsable de propagar el evento de nivel inferior al siguiente componente de la canalización, si procede.</span><span class="sxs-lookup"><span data-stu-id="539c2-296">In that case, the client is responsible for propagating the event downstream to the next component in the pipeline, if applicable.</span></span> <span data-ttu-id="539c2-297">Para obtener más información, vea [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="539c2-297">For more information, see [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

## <a name="related-topics"></a><span data-ttu-id="539c2-298">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="539c2-298">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="539c2-299">Media Foundation transformaciones</span><span class="sxs-lookup"><span data-stu-id="539c2-299">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



