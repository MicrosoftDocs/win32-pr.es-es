---
description: Recomendaciones para las transacciones de sistema de archivos óptimas.
ms.assetid: 847939ff-5322-4023-8ef7-9d845e80d65c
title: Consideraciones de rendimiento para NTFS transaccional
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a71f7e100e1ddd8524932a4a259a12092bddcb6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104002608"
---
# <a name="performance-considerations-for-transactional-ntfs"></a><span data-ttu-id="e6990-103">Consideraciones de rendimiento para NTFS transaccional</span><span class="sxs-lookup"><span data-stu-id="e6990-103">Performance Considerations for Transactional NTFS</span></span>

<span data-ttu-id="e6990-104">NTFS transaccional (TxF) se ha diseñado cuidadosamente para mejorar el rendimiento y, por lo general, funciona mejor que las alternativas transaccionales de uso general en escenarios similares.</span><span class="sxs-lookup"><span data-stu-id="e6990-104">Transactional NTFS (TxF) has been carefully designed for performance and will typically perform better than general-purpose transactional alternatives under similar scenarios.</span></span> <span data-ttu-id="e6990-105">Sin embargo, las transacciones del sistema de archivos tienen más sobrecarga que las operaciones sin transacciones y se espera una reducción en el rendimiento de e/s en comparación con la e/s sin transacciones.</span><span class="sxs-lookup"><span data-stu-id="e6990-105">However, file system transactions have more overhead than non-transacted operations, and some reduction in I/O performance compared to non-transacted I/O is to be expected.</span></span> <span data-ttu-id="e6990-106">Las aplicaciones críticas para el rendimiento deben realizar un ciclo de calificación de adopción de tecnología y evaluar el impacto en el rendimiento de las operaciones del sistema de archivos transaccionales.</span><span class="sxs-lookup"><span data-stu-id="e6990-106">Performance-critical applications should perform a technology adoption qualification cycle, evaluating the performance impact of transacted file system operations.</span></span>

## <a name="overview-of-txf-operations"></a><span data-ttu-id="e6990-107">Información general de las operaciones de TxF</span><span class="sxs-lookup"><span data-stu-id="e6990-107">Overview of TxF Operations</span></span>

<span data-ttu-id="e6990-108">TxF usa el registro de *Deshacer* para registrar los cambios necesarios para volver a poner el sistema de archivos en un estado coherente, también conocido como reversión, en caso de que se produzca una anulación de transacción.</span><span class="sxs-lookup"><span data-stu-id="e6990-108">TxF uses *undo* logging to record the changes necessary to put the file system back into a consistent state, also referred to as a rollback, should a transaction abort occur.</span></span> <span data-ttu-id="e6990-109">Este registro de deshacer genera e/s adicional y es el origen de la sobrecarga de rendimiento de TxF en comparación con las operaciones del sistema de archivos no transaccionales.</span><span class="sxs-lookup"><span data-stu-id="e6990-109">This undo logging generates additional I/O and is the source of TxF performance overhead compared to non-transactional file system operations.</span></span>

<span data-ttu-id="e6990-110">A continuación se muestra un resumen de alto nivel de cómo funciona TxF:</span><span class="sxs-lookup"><span data-stu-id="e6990-110">A high-level summary of how TxF operates is as follows:</span></span>

-   <span data-ttu-id="e6990-111">A medida que progresa una transacción, TxF escribe los registros de *Deshacer* en su archivo de registro para cada modificación que realiza en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="e6990-111">As a transaction progresses, TxF writes *undo* records into its log file for each modification it makes to the file system.</span></span> <span data-ttu-id="e6990-112">Si se produce una anulación, estos registros de deshacer se analizan para volver a poner el sistema de archivos en el estado en que se encontraba antes de que comenzara la transacción.</span><span class="sxs-lookup"><span data-stu-id="e6990-112">If an abort occurs, these undo records are parsed to put the file system back in the state it was before the transaction began.</span></span>
-   <span data-ttu-id="e6990-113">Un registro de deshacer de *cambio de metadatos* describe un cambio solo en los metadatos del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="e6990-113">A *metadata change* undo record describes a change only to the file system's metadata.</span></span> <span data-ttu-id="e6990-114">Algunos ejemplos de esto son los movimientos, el cambio de nombre, los anexos y los cambios de atributo.</span><span class="sxs-lookup"><span data-stu-id="e6990-114">Some examples of this are moves, renames, appends, and attribute changes.</span></span> <span data-ttu-id="e6990-115">En el caso de los registros de deshacer de cambio de metadatos, toda la información necesaria para deshacer el cambio está en el registro y se almacena en el archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="e6990-115">For metadata change undo records, all of the information necessary to undo the change is in the record and stored in the log file.</span></span>
-   <span data-ttu-id="e6990-116">Un registro de deshacer *sobrescritura* describe una sobrescritura de una parte de un archivo.</span><span class="sxs-lookup"><span data-stu-id="e6990-116">An *overwrite* undo record describes an overwrite of a portion of a file.</span></span> <span data-ttu-id="e6990-117">Cuando se produce la sobrescritura de un archivo, el contenido original del archivo se almacena en un archivo de deshacer especial en un directorio oculto y el registro de deshacer sobrescritura apunta a este archivo.</span><span class="sxs-lookup"><span data-stu-id="e6990-117">When a file overwrite occurs, the file's original contents are stored in a special undo file in a hidden directory and the overwrite undo record points to this file.</span></span> <span data-ttu-id="e6990-118">Cuando las actualizaciones de archivos se vacían de la caché al disco, también se debe vaciar el contenido del archivo para deshacer, por lo que una sobrescritura de archivos de transacción podría generar hasta dos operaciones de e/s aleatorias adicionales: una para leer los datos antiguos y otra para escribirla en el archivo para deshacer.</span><span class="sxs-lookup"><span data-stu-id="e6990-118">When file updates are eventually flushed from cache to disk, the contents of the undo file must also be flushed, so a transacted file overwrite could generate up to two extra random I/O operations: one to read the old data and one to write it to the undo file.</span></span> <span data-ttu-id="e6990-119">Estas operaciones de e/s adicionales son un costo de rendimiento de TxF.</span><span class="sxs-lookup"><span data-stu-id="e6990-119">These extra I/O operations are a performance cost of TxF.</span></span>
-   <span data-ttu-id="e6990-120">Cuando se produce una confirmación, TxF vacía primero toda la información de deshacer, luego vacía los cambios reales del archivo y, a continuación, escribe y vacía un registro de confirmación.</span><span class="sxs-lookup"><span data-stu-id="e6990-120">When a commit occurs, TxF first flushes all undo information, then flushes the actual file changes, and then writes and flushes a commit record.</span></span> <span data-ttu-id="e6990-121">Si no hay ningún archivo para deshacer que vaciar, la única sobrecarga adicional de TxF relativa a la e/s sin transacciones es que el registro se vacíe a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="e6990-121">If there are no undo files to flush, the only additional TxF overhead relative to non-transacted I/O is the log flushes themselves.</span></span> <span data-ttu-id="e6990-122">Sin embargo, los vaciados del registro producen escrituras secuenciales grandes y eficaces para que el costo de rendimiento sea mínimo.</span><span class="sxs-lookup"><span data-stu-id="e6990-122">However, log flushes result in efficient large sequential writes so the performance cost is minimal.</span></span>
-   <span data-ttu-id="e6990-123">TxF está optimizado para la confirmación.</span><span class="sxs-lookup"><span data-stu-id="e6990-123">TxF is optimized for commit.</span></span> <span data-ttu-id="e6990-124">Se espera que la mayoría de las transacciones se realicen correctamente y no sea necesario revertir, por lo que se espera que todos los registros de deshacer de una transacción queden sin usar.</span><span class="sxs-lookup"><span data-stu-id="e6990-124">It is expected that most transactions will succeed and not need to rollback, therefore all undo records for a transaction are expected to go unused.</span></span> <span data-ttu-id="e6990-125">Desde el punto de vista del rendimiento, las operaciones de confirmación de TxF son rápidas y las reversiones hacen un uso intensivo de los recursos.</span><span class="sxs-lookup"><span data-stu-id="e6990-125">From a performance perspective, TxF commit operations are fast and rollbacks are resource-intensive.</span></span>
-   <span data-ttu-id="e6990-126">La reversión requiere más recursos que la confirmación.</span><span class="sxs-lookup"><span data-stu-id="e6990-126">Rollback is more resource-intensive than commit.</span></span> <span data-ttu-id="e6990-127">Durante la reversión, todos los cambios realizados en la transacción deben deshacerse.</span><span class="sxs-lookup"><span data-stu-id="e6990-127">During rollback, all the changes that were made in the transaction have to be un-done.</span></span> <span data-ttu-id="e6990-128">En general, la duración de la reversión puede ser aproximadamente la misma que tardó originalmente en realizar los cambios.</span><span class="sxs-lookup"><span data-stu-id="e6990-128">In general, rollback duration can be approximately the same it took to originally make the changes.</span></span> <span data-ttu-id="e6990-129">Por ejemplo, si tardó 1 segundo en realizar todos los cambios, podría tardar aproximadamente 1 segundo en deshacerlos.</span><span class="sxs-lookup"><span data-stu-id="e6990-129">For example, if it took 1 second to make all the changes then it could take about 1 second to undo them.</span></span> <span data-ttu-id="e6990-130">En el caso de transacciones muy largas, la reversión puede crear impactos de rendimiento adicionales.</span><span class="sxs-lookup"><span data-stu-id="e6990-130">For very long transactions, rollback can create additional performance impacts.</span></span> <span data-ttu-id="e6990-131">Por ejemplo, se puede retrasar el tiempo de arranque del sistema si el sistema debe revertir automáticamente una transacción en caso de que el sistema deje de responder y deba realizar un reinicio no programado.</span><span class="sxs-lookup"><span data-stu-id="e6990-131">For example, system boot time can be delayed if the system must automatically rollback a transaction in the event that the system stops responding and must perform an unscheduled restart.</span></span>

<span data-ttu-id="e6990-132">Las conclusiones de resumen sobre el rendimiento que se pueden extraer de la lista anterior son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="e6990-132">The summary conclusions about performance that can be drawn from the previous list are as follows:</span></span>

-   <span data-ttu-id="e6990-133">El costo de rendimiento de TxF para las transacciones que implican sobrescrituras de archivos puede ser significativo.</span><span class="sxs-lookup"><span data-stu-id="e6990-133">The performance cost of TxF for transactions involving file overwrites can be significant.</span></span>
-   <span data-ttu-id="e6990-134">El costo de rendimiento de TxF para las transacciones que implican solo operaciones de metadatos puede ser relativamente bajo, siempre que se usen transacciones grandes.</span><span class="sxs-lookup"><span data-stu-id="e6990-134">The performance cost of TxF for transactions involving only metadata operations can be relatively low, provided large transactions be used.</span></span> <span data-ttu-id="e6990-135">Una transacción grande es cuando hay muchos registros de deshacer para cada registro de confirmación.</span><span class="sxs-lookup"><span data-stu-id="e6990-135">A large transaction is when there are many undo records for every commit record.</span></span>

## <a name="recommendations-for-best-performance"></a><span data-ttu-id="e6990-136">Recomendaciones para obtener el mejor rendimiento</span><span class="sxs-lookup"><span data-stu-id="e6990-136">Recommendations For Best Performance</span></span>

<span data-ttu-id="e6990-137">Amortizar la sobrecarga de TxF en transacciones de mayor tamaño.</span><span class="sxs-lookup"><span data-stu-id="e6990-137">Amortize TxF overhead over larger transactions.</span></span> <span data-ttu-id="e6990-138">Por ejemplo, si tiene *n* conjuntos de cambios para que cada cambio tenga *m* pasos y tiene la opción de hacer esto como *n* transacciones de *m* pasos cada uno o hacer todo como una sola transacción con *m* \* *N* pasos, la última opción sería más eficaz.</span><span class="sxs-lookup"><span data-stu-id="e6990-138">For example, if you have *N* sets of changes to make where each change has *M* steps and you have the option to either do this as *N* transactions of *M* steps each or do it all as a single transaction with *M*\**N* steps, the latter option would be more efficient.</span></span>

<span data-ttu-id="e6990-139">Tenga en cuenta el posible impacto en el arranque de transacciones de gran tamaño.</span><span class="sxs-lookup"><span data-stu-id="e6990-139">Consider the possible impact on boot of very large transactions.</span></span> <span data-ttu-id="e6990-140">Como se indicó anteriormente, la reversión puede ser lenta y retrasará el tiempo de arranque si el sistema necesita realizar reversiones automáticas como hora de arranque.</span><span class="sxs-lookup"><span data-stu-id="e6990-140">As previously stated, rollback can be slow and will delay boot time if the system needs to perform automatic rollbacks as boot time.</span></span> <span data-ttu-id="e6990-141">Cuanto mayor sea la transacción, mayor será el retraso.</span><span class="sxs-lookup"><span data-stu-id="e6990-141">The larger the transaction, the longer the delay.</span></span>

<span data-ttu-id="e6990-142">Mantenga las transacciones a las operaciones de metadatos principalmente.</span><span class="sxs-lookup"><span data-stu-id="e6990-142">Keep transactions to mostly metadata operations.</span></span> <span data-ttu-id="e6990-143">Este es el modo en que TxF está optimizado para y, en general, el rendimiento es aproximadamente el mismo que la e/s de archivos sin transacciones para transacciones de metadatos de gran tamaño.</span><span class="sxs-lookup"><span data-stu-id="e6990-143">This is what TxF is optimized for and, in general, the performance is about the same as non-transacted file I/O for large metadata transactions.</span></span> <span data-ttu-id="e6990-144">Ejemplos de funciones de TxF de metadatos eficientes son [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda)y escrituras anexadas (llama a la función [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) cuando el puntero de archivo está al final del archivo o *EOF*).</span><span class="sxs-lookup"><span data-stu-id="e6990-144">Examples of efficient metadata TxF functions are [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda), and appended writes (calls to the [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) function when the file pointer as at the end the file, or *EOF*).</span></span> <span data-ttu-id="e6990-145">Un ejemplo de operaciones de metadatos que consumen muchos recursos son las llamadas a la función **WriteFile** cuando el puntero de archivo no está en EOF.</span><span class="sxs-lookup"><span data-stu-id="e6990-145">An example of resource-intensive non-metadata operations are calls to the **WriteFile** function when the file pointer is not at the EOF.</span></span>

## <a name="summary-of-txf-performance-expectations"></a><span data-ttu-id="e6990-146">Resumen de las expectativas de rendimiento de TxF</span><span class="sxs-lookup"><span data-stu-id="e6990-146">Summary of TxF Performance Expectations</span></span>

<span data-ttu-id="e6990-147">En el caso de las actualizaciones en contexto, las sobrescrituras en una sección de un archivo serán mucho más lentas que las de e/s de archivo sin transacciones, mientras que el rendimiento de TxF para las operaciones de metadatos del sistema de archivos (por ejemplo, crear, trasladar y anexar) es comparable a la e/s de archivos no transaccionales para transacciones grandes.</span><span class="sxs-lookup"><span data-stu-id="e6990-147">For in-place updates, overwrites to a section of a file will be much slower than non-transacted file I/O, while TxF performance for file system metadata operations (for example, create, move, and append) is comparable to non-transacted file I/O for large transactions.</span></span>

 

 



