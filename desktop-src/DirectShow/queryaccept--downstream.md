---
description: QueryAccept (Downstream)
ms.assetid: 3ca30f62-c320-40ea-9bf5-022abad912c4
title: QueryAccept (Downstream)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9015e0a246abb9fb996c0771e4bc935cccda054d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "104556622"
---
# <a name="queryaccept-downstream"></a><span data-ttu-id="52647-103">QueryAccept (Downstream)</span><span class="sxs-lookup"><span data-stu-id="52647-103">QueryAccept (Downstream)</span></span>

<span data-ttu-id="52647-104">Este mecanismo permite a un PIN de salida proponer un nuevo formato a su par inferior.</span><span class="sxs-lookup"><span data-stu-id="52647-104">This mechanism enables an output pin to propose a new format to its downstream peer.</span></span> <span data-ttu-id="52647-105">El nuevo formato no debe requerir un tamaño de búfer mayor.</span><span class="sxs-lookup"><span data-stu-id="52647-105">The new format must not require a larger buffer size.</span></span> <span data-ttu-id="52647-106">El PIN de salida hace lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="52647-106">The output pin does the following:</span></span>

1.  <span data-ttu-id="52647-107">Llama a [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) o [**IPinConnection::D ynamicqueryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) en el PIN de bajada, para comprobar si el otro pin puede aceptar el nuevo tipo de medio (vea la ilustración, paso A).</span><span class="sxs-lookup"><span data-stu-id="52647-107">Calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) or [**IPinConnection::DynamicQueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) on the downstream pin, to verify whether the other pin can accept the new media type (see illustration, step A).</span></span>
2.  <span data-ttu-id="52647-108">Si el valor devuelto del paso 1 es S \_ correcto, el PIN asocia el tipo de medio al siguiente ejemplo.</span><span class="sxs-lookup"><span data-stu-id="52647-108">If the return value from step 1 is S\_OK, the pin attaches the media type to the next sample.</span></span> <span data-ttu-id="52647-109">Para ello, primero llama a [**IMemAllocator:: getBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) para obtener el ejemplo (B).</span><span class="sxs-lookup"><span data-stu-id="52647-109">To do this, first it calls [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) to obtain the sample (B).</span></span> <span data-ttu-id="52647-110">A continuación, llama a [**IMediaSample:: SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) para adjuntar el tipo de medio a ese ejemplo (C).</span><span class="sxs-lookup"><span data-stu-id="52647-110">Then it calls [**IMediaSample::SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) to attach the media type to that sample (C).</span></span> <span data-ttu-id="52647-111">Al adjuntar el tipo de archivo multimedia al ejemplo, el filtro indica que el formato ha cambiado, empezando por ese ejemplo.</span><span class="sxs-lookup"><span data-stu-id="52647-111">By attaching the media type to the sample, the filter indicates that the format has changed, starting with that sample.</span></span>
3.  <span data-ttu-id="52647-112">El PIN proporciona el ejemplo (D).</span><span class="sxs-lookup"><span data-stu-id="52647-112">The pin delivers the sample (D).</span></span>
4.  <span data-ttu-id="52647-113">Cuando el filtro de nivel inferior recibe el ejemplo, llama a [**IMediaSample:: GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) para recuperar el nuevo tipo de archivo multimedia.</span><span class="sxs-lookup"><span data-stu-id="52647-113">When the downstream filter receives the sample, it calls [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) to retrieve the new media type.</span></span>

    ![queryaccept (Downstream)](images/dynformat3.png)

<span data-ttu-id="52647-115">Todos los pin admiten el `QueryAccept` método.</span><span class="sxs-lookup"><span data-stu-id="52647-115">All pins support the `QueryAccept` method.</span></span> <span data-ttu-id="52647-116">Sin embargo, este método es ligeramente ambiguo, ya que un valor devuelto de S \_ OK no garantiza siempre que se pueda cambiar el formato mientras el gráfico esté activo.</span><span class="sxs-lookup"><span data-stu-id="52647-116">However, this method is slightly ambiguous, because a return value of S\_OK does not always guarantee that you can change the format while the graph is active.</span></span> <span data-ttu-id="52647-117">Algunos filtros pueden devolver S \_ correcto, pero rechazar el cambio si el gráfico está activo.</span><span class="sxs-lookup"><span data-stu-id="52647-117">Some filters might return S\_OK but reject the change if the graph is active.</span></span> <span data-ttu-id="52647-118">El método **DynamicQueryAccept** , que es compatible con algunos PIN de entrada, define explícitamente S \_ OK para indicar que el pin puede cambiar los formatos mientras está activo.</span><span class="sxs-lookup"><span data-stu-id="52647-118">The **DynamicQueryAccept** method, which is supported by some input pins, explicitly defines S\_OK to mean the pin can change formats while active.</span></span> <span data-ttu-id="52647-119">Si un PIN de entrada es compatible con la interfaz **IPinConnection** , debe llamar a **DynamicQueryAccept** en lugar de `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="52647-119">If an input pin supports the **IPinConnection** interface, you should call **DynamicQueryAccept** rather than `QueryAccept`.</span></span>

<span data-ttu-id="52647-120">En la mayoría de los casos, este mecanismo no permite cambios drásticos en el formato, como cambiar la profundidad de bits.</span><span class="sxs-lookup"><span data-stu-id="52647-120">In most cases, this mechanism does not allow for drastic changes to the format, such as changing the bit depth.</span></span> <span data-ttu-id="52647-121">Una situación en la que se puede usar es cuando un descodificador de vídeo cambia las paletas.</span><span class="sxs-lookup"><span data-stu-id="52647-121">One situation in which it can be used is when a video decoder switches palettes.</span></span> <span data-ttu-id="52647-122">Los detalles básicos del formato permanecen invariables, como las dimensiones de la imagen y la profundidad de bits, pero el nuevo tipo de medio tiene un conjunto diferente de entradas de la paleta.</span><span class="sxs-lookup"><span data-stu-id="52647-122">The basic details of the format stay the same, such as the image dimensions and the bit depth, but the new media type has a different set of palette entries.</span></span>

<span data-ttu-id="52647-123">**Nota de implementación**</span><span class="sxs-lookup"><span data-stu-id="52647-123">**Implementation Note**</span></span>

<span data-ttu-id="52647-124">En las clases base de DirectShow, [**CBasePin:: QueryAccept**](cbasepin-queryaccept.md) llama al método **CheckMediaType** , al que también se llama durante la conexión inicial del PIN.</span><span class="sxs-lookup"><span data-stu-id="52647-124">In the DirectShow base classes, [**CBasePin::QueryAccept**](cbasepin-queryaccept.md) calls the **CheckMediaType** method, which is also called during the initial pin connection.</span></span> <span data-ttu-id="52647-125">En el caso de un filtro de transformación, el método **CheckMediaType** del PIN de entrada siempre debe comprobar si el PIN de salida está conectado y, en caso afirmativo, si el tipo de medio de entrada es compatible con el tipo de medio de salida.</span><span class="sxs-lookup"><span data-stu-id="52647-125">In the case of a transform filter, the input pin's **CheckMediaType** method should always check whether the output pin is connected, and if so, whether the input media type is compatible with the output media type.</span></span> <span data-ttu-id="52647-126">Por lo tanto, es probable que esta implementación sea válida para `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="52647-126">Therefore, this implementation will likely be valid for `QueryAccept`.</span></span> <span data-ttu-id="52647-127">Si no es así, debe reemplazar `QueryAccept` para realizar cualquier comprobación adicional que sea necesaria.</span><span class="sxs-lookup"><span data-stu-id="52647-127">If not, you should override `QueryAccept` in order to perform any additional checks that are needed.</span></span> <span data-ttu-id="52647-128">Además, tenga en cuenta que la clase [**CTransformFilter**](ctransformfilter.md) encapsula esta lógica dentro de los métodos **CheckInputType** y **CheckTransform** .</span><span class="sxs-lookup"><span data-stu-id="52647-128">Also, note that the [**CTransformFilter**](ctransformfilter.md) class encapsulates this logic within the **CheckInputType** and **CheckTransform** methods.</span></span> <span data-ttu-id="52647-129">La clase [**CTransInPlaceFilter**](ctransinplacefilter.md) , por otro lado, siempre llama a `QueryAccept` en el siguiente filtro ascendente o descendente.</span><span class="sxs-lookup"><span data-stu-id="52647-129">The [**CTransInPlaceFilter**](ctransinplacefilter.md) class, on the other hand, always calls `QueryAccept` on the next upstream or downstream filter.</span></span>

<span data-ttu-id="52647-130">El método [**CBaseInputPin:: Receive**](cbaseinputpin-receive.md) comprueba un tipo de medio en el ejemplo entrante y, si lo hay, llama a **CheckMediaType**.</span><span class="sxs-lookup"><span data-stu-id="52647-130">The [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method checks for a media type on the incoming sample, and if there is one, calls **CheckMediaType**.</span></span> <span data-ttu-id="52647-131">Sin embargo, no actualiza el miembro **m \_ MT** del PIN, que contiene el tipo de medio actual.</span><span class="sxs-lookup"><span data-stu-id="52647-131">However, it does not update the pin's **m\_mt** member, which holds the current media type.</span></span> <span data-ttu-id="52647-132">Cuando el filtro procesa el ejemplo, debe comprobar si hay un tipo de medio en el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="52647-132">When your filter processes the sample, you should check the sample for a media type.</span></span> <span data-ttu-id="52647-133">Si hay un nuevo tipo, probablemente necesitará almacenarlo, ya sea llamando a **SetMediaType** en el código PIN o estableciendo el valor de **m \_ MT** directamente.</span><span class="sxs-lookup"><span data-stu-id="52647-133">If there is a new type, you will probably need to store it, either by calling **SetMediaType** on your pin or by setting the value of **m\_mt** directly.</span></span> <span data-ttu-id="52647-134">Por otro lado, la clase [**CVideoTransformFilter**](cvideotransformfilter.md) , que está diseñada para los filtros de transformación de vídeo, almacena el tipo de medio cuando cambia.</span><span class="sxs-lookup"><span data-stu-id="52647-134">On the other hand, the [**CVideoTransformFilter**](cvideotransformfilter.md) class, which is designed for video transform filters, stores the media type when it changes.</span></span> <span data-ttu-id="52647-135">Para obtener más información, vea el código fuente de [**CVideoTransformFilter:: Receive**](cvideotransformfilter-receive.md) en la biblioteca de clases base de DirectShow.</span><span class="sxs-lookup"><span data-stu-id="52647-135">For details, see the source code for [**CVideoTransformFilter::Receive**](cvideotransformfilter-receive.md) in the DirectShow base class library.</span></span>

<span data-ttu-id="52647-136">En algunos casos, podría simplemente pasar la `QueryAccept` llamada de nivel inferior, adjuntar el tipo de medio al ejemplo de salida y dejar que el filtro de nivel inferior controle el cambio de formato.</span><span class="sxs-lookup"><span data-stu-id="52647-136">In some cases, you might simply pass the `QueryAccept` call downstream, then attach the media type to the output sample and let the downstream filter handle the format change.</span></span>

 

 



