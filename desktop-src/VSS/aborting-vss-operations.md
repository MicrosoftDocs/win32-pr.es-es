---
description: 'Los eventos de anulación se pueden generar durante una operación de copia de seguridad en cualquiera de los siguientes casos:'
ms.assetid: c2e39cdd-0ff8-4030-9bec-9e003b4d9520
title: Anular operaciones VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35e4b82ba4227dfeb02e3da91c9bc1e77f10f492
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105652723"
---
# <a name="aborting-vss-operations"></a><span data-ttu-id="8d022-103">Anular operaciones VSS</span><span class="sxs-lookup"><span data-stu-id="8d022-103">Aborting VSS Operations</span></span>

<span data-ttu-id="8d022-104">Los eventos de [*anulación*](vssgloss-a.md) se pueden generar durante una operación de copia de seguridad en cualquiera de los siguientes casos:</span><span class="sxs-lookup"><span data-stu-id="8d022-104">[*Abort*](vssgloss-a.md) events can be generated during a backup operation in any of the following cases:</span></span>

-   <span data-ttu-id="8d022-105">Un solicitante genera explícitamente un [*evento de anulación*](vssgloss-a.md) mediante una llamada a [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="8d022-105">A requester explicitly generates an [*Abort event*](vssgloss-a.md) by calling [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>
-   <span data-ttu-id="8d022-106">Los controladores de eventos [*Freeze*](vssgloss-f.md) y [*accongele de*](vssgloss-t.md) un escritor ([**CVssWriter:: alfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) y [**CVssWriter:: alreanudar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) devuelven **false** o no se pueden completar en la ventana de tiempo especificada en [**CVssWriter:: Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span><span class="sxs-lookup"><span data-stu-id="8d022-106">A writer's [*Freeze*](vssgloss-f.md) and [*Thaw*](vssgloss-t.md) event handlers ([**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) return **false**, or cannot complete in the time window specified in [**CVssWriter::Initialize**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-initialize).</span></span>
-   <span data-ttu-id="8d022-107">Existe un error del proveedor o VSS durante la creación de una instantánea después del evento [*PrepareForSnapshot*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="8d022-107">There is any failure of the provider or VSS during the creation of a shadow copy following the [*PrepareForSnapshot*](vssgloss-p.md) event.</span></span>

<span data-ttu-id="8d022-108">Las anulaciones no se admiten para las operaciones de restauración.</span><span class="sxs-lookup"><span data-stu-id="8d022-108">Aborts are not supported for restore operations.</span></span>

## <a name="requester-handling-and-creation-of-abort-events"></a><span data-ttu-id="8d022-109">Control del solicitante y creación de eventos de anulación</span><span class="sxs-lookup"><span data-stu-id="8d022-109">Requester Handling and Creation of Abort Events</span></span>

<span data-ttu-id="8d022-110">Una instancia de la interfaz [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) solo se puede usar para una copia de seguridad, por lo que si se produce un error en el procesamiento de una copia de seguridad, suele ser mejor liberar la instancia actual y volver a empezar.</span><span class="sxs-lookup"><span data-stu-id="8d022-110">An instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface can be used for only one backup, so if an error occurs in processing a backup it is generally best to release the current instance and start over.</span></span>

<span data-ttu-id="8d022-111">Un solicitante debe indicar explícitamente que se está anulando una operación de copia de seguridad (mediante [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) solo después de la preparación real de una copia de seguridad, que implique escritores, o de la creación de una instantánea.</span><span class="sxs-lookup"><span data-stu-id="8d022-111">A requester should explicitly signal that it is aborting a backup operation (using [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) only after the actual preparation for a backup, involving writers, or the creation of a shadow copy has taken place.</span></span>

<span data-ttu-id="8d022-112">De hecho, esto significa que cada vez que un solicitante necesita detener una operación de copia de seguridad después de generar un evento [*PrepareForBackup*](vssgloss-p.md) llamando a [**Ivssbackupcomponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), debe llamar a [**ivssbackupcomponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) y esperar su devolución antes de liberar la instancia de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) actual.</span><span class="sxs-lookup"><span data-stu-id="8d022-112">Effectively, this means that any time a requester needs to stop a backup operation after generating a [*PrepareForBackup*](vssgloss-p.md) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), it should call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) and await its return prior to releasing the current [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) instance.</span></span>

<span data-ttu-id="8d022-113">Por ejemplo, si un escritor impidió una operación de copia de seguridad, un solicitante debería usar [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) para notificar a todos los demás escritores que la operación de copia de seguridad no se completará.</span><span class="sxs-lookup"><span data-stu-id="8d022-113">For example, if a writer vetoed a backup operation, a requester should use [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup) to notify all other writers that the backup operation will not be completed.</span></span>

<span data-ttu-id="8d022-114">Antes de llamar a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), o si se produce un error en la llamada a **PrepareForBackup** , un solicitante puede liberar la instancia actual de la interfaz [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) sin necesidad de generar un evento de anulación.</span><span class="sxs-lookup"><span data-stu-id="8d022-114">Prior to calling [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or if the call to **PrepareForBackup** fails, a requester can release the current instance of the [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface without needing to generate an Abort event.</span></span>

<span data-ttu-id="8d022-115">Por ejemplo, si se usa la instancia actual de [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) simplemente para obtener información llamando a [**IVSSBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) y generando un evento de [*identificación*](vssgloss-i.md) , una vez que se ha devuelto la información, la instancia de **IVSSBackupComponents** solo se puede liberar.</span><span class="sxs-lookup"><span data-stu-id="8d022-115">For example, if the current instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) is being used merely to obtain information by calling [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) and generating an [*Identify*](vssgloss-i.md) event, once information has been returned the instance of **IVSSBackupComponents** can simply be released.</span></span>

<span data-ttu-id="8d022-116">Un solicitante genera una serie de eventos ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*reanudación*](vssgloss-t.md)y [*postsnapshot*](vssgloss-p.md)) cuando llama a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="8d022-116">A requester generates a number of events ([*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md)) when it calls [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="8d022-117">Al controlar los eventos Freeze y accongelate, un escritor puede producir un error y generar un evento de anulación por sí mismo.</span><span class="sxs-lookup"><span data-stu-id="8d022-117">While handling the Freeze and Thaw events, a writer may fail and can generate an Abort event on its own.</span></span> <span data-ttu-id="8d022-118">Si no se controlan los eventos PrepareForSnapshot y postsnapshot, no se genera un evento de anulación.</span><span class="sxs-lookup"><span data-stu-id="8d022-118">Failure to handle PrepareForSnapshot and PostSnapshot events does not generate an Abort event.</span></span>

<span data-ttu-id="8d022-119">No siempre es posible que un solicitante sepa si se generó un evento de anulación cuando [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indica un error.</span><span class="sxs-lookup"><span data-stu-id="8d022-119">It is not always possible for a requester to know if an Abort event was generated when [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) indicates failure.</span></span> <span data-ttu-id="8d022-120">Por lo tanto, un solicitante que necesita finalizar una operación de copia de seguridad porque el estado de **IVssBackupComponents::D osnapshotset** indica que un problema debe seguir llamando a [**IVssBackupComponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span><span class="sxs-lookup"><span data-stu-id="8d022-120">Therefore, a requester that needs to terminate a backup operation because the status of **IVssBackupComponents::DoSnapshotSet** indicates a problem should still call [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).</span></span>

<span data-ttu-id="8d022-121">Si un solicitante ha llamado a [**ivssbackupcomponents:: AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), no es necesario llamar a [**Ivssbackupcomponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) antes de liberar una instancia de [**ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="8d022-121">If a requester has called [**IVssBackupComponents::AbortBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup), it is not necessary to call [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) prior to releasing an instance of [**IVSSBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

## <a name="writer-handling-and-creation-of-abort-events"></a><span data-ttu-id="8d022-122">Control del escritor y creación de eventos de anulación</span><span class="sxs-lookup"><span data-stu-id="8d022-122">Writer Handling and Creation of Abort Events</span></span>

<span data-ttu-id="8d022-123">Como se indicó anteriormente, un escritor puede recibir un evento de anulación de un solicitante o el proveedor se puede desencadenar uno mismo.</span><span class="sxs-lookup"><span data-stu-id="8d022-123">As noted previously, a writer can receive an Abort event from a requester, or the provider can trigger one itself.</span></span> <span data-ttu-id="8d022-124">Además, es posible que un escritor reciba varios eventos de anulación en determinadas circunstancias.</span><span class="sxs-lookup"><span data-stu-id="8d022-124">Also, it is possible for a writer to receive multiple Abort events under certain circumstances.</span></span> <span data-ttu-id="8d022-125">Los desarrolladores del escritor deben codificar cualquier implementación de [**CVssWriter:: onabort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) con esto en mente.</span><span class="sxs-lookup"><span data-stu-id="8d022-125">Writer developers should code any implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) with this in mind.</span></span>

<span data-ttu-id="8d022-126">Al controlar un evento de anulación, un escritor debe intentar restaurar el proceso que administra en su estado de ejecución normal, así como realizar cualquier control de errores y registro.</span><span class="sxs-lookup"><span data-stu-id="8d022-126">In handling an Abort event, a writer should attempt to restore whatever process it managed to its normal running state, as well as perform any error handling and logging.</span></span>

<span data-ttu-id="8d022-127">Esto puede significar que una implementación de [**CVssWriter:: onabort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) podría tener que realizar muchas, si no todas, de las mismas tareas que el controlador de eventos procongelate ([**CVssWriter:: alreanudate**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) y el controlador de eventos postsnapshot ([**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), y se puede llamar a estos controladores desde **CVssWriter:: onabort**.</span><span class="sxs-lookup"><span data-stu-id="8d022-127">This may mean that an implementation of [**CVssWriter::OnAbort**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onabort) might have to perform many, if not all, of the same tasks as the Thaw event handler ([**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) and the PostSnapshot event handler ([**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)), and these handlers can be called from within **CVssWriter::OnAbort**.</span></span>

 

 



