---
title: Creación de reconciliadores de maletín
description: Un reconciliador de maletín da a mi maletín los medios para conciliar diferentes versiones de un documento.
ms.assetid: 86d66291-96ae-40ea-98ef-ef263f25aa82
keywords:
- reconciliadores de maletín
- conciliación
- IReconcilableObject
- IReconcileInitiator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b925e7055e15f6c7a49408aa28d147fb2eef5a7e
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "104420557"
---
# <a name="creating-briefcase-reconcilers"></a><span data-ttu-id="9a40f-107">Creación de reconciliadores de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-107">Creating Briefcase Reconcilers</span></span>

<span data-ttu-id="9a40f-108">Un reconciliador de maletín da a mi maletín los medios para conciliar diferentes versiones de un documento.</span><span class="sxs-lookup"><span data-stu-id="9a40f-108">A briefcase reconciler gives Briefcase the means to reconcile different versions of a document.</span></span>

-   [<span data-ttu-id="9a40f-109">Acerca de los reconciliadores de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-109">About Briefcase Reconcilers</span></span>](#about-briefcase-reconcilers)
    -   [<span data-ttu-id="9a40f-110">Conciliación</span><span class="sxs-lookup"><span data-stu-id="9a40f-110">Reconciliation</span></span>](#reconciliation)
    -   [<span data-ttu-id="9a40f-111">Creación de un reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-111">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
    -   [<span data-ttu-id="9a40f-112">Interacción del usuario en la conciliación</span><span class="sxs-lookup"><span data-stu-id="9a40f-112">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
    -   [<span data-ttu-id="9a40f-113">Reconciliar objetos incrustados</span><span class="sxs-lookup"><span data-stu-id="9a40f-113">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
    -   [<span data-ttu-id="9a40f-114">Residuos</span><span class="sxs-lookup"><span data-stu-id="9a40f-114">Residues</span></span>](#residues)
-   [<span data-ttu-id="9a40f-115">Referencia de reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-115">Briefcase Reconciler Reference</span></span>](#briefcase-reconciler-reference)
    -   [<span data-ttu-id="9a40f-116">Interfaces y métodos del reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-116">Briefcase Reconciler Interfaces and Methods</span></span>](#briefcase-reconciler-interfaces-and-methods)

## <a name="about-briefcase-reconcilers"></a><span data-ttu-id="9a40f-117">Acerca de los reconciliadores de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-117">About Briefcase Reconcilers</span></span>

<span data-ttu-id="9a40f-118">Un reconciliador de maletín combina diferentes versiones de entrada de un documento para generar una única versión de salida nueva del documento.</span><span class="sxs-lookup"><span data-stu-id="9a40f-118">A briefcase reconciler combines different input versions of a document to produce a single, new output version of the document.</span></span> <span data-ttu-id="9a40f-119">Es posible que tenga que crear un reconciliador de maletín para admitir el tipo de documento.</span><span class="sxs-lookup"><span data-stu-id="9a40f-119">You might need to create a briefcase reconciler to support your type of document.</span></span> <span data-ttu-id="9a40f-120">En esta información general se describen los reconciliadores de maletín y se explica cómo crearlos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-120">This overview describes briefcase reconcilers and explains how to create them.</span></span>

<span data-ttu-id="9a40f-121">Se tratan los temas siguientes:</span><span class="sxs-lookup"><span data-stu-id="9a40f-121">The following topics are discussed:</span></span>

-   [<span data-ttu-id="9a40f-122">Conciliación</span><span class="sxs-lookup"><span data-stu-id="9a40f-122">Reconciliation</span></span>](#reconciliation)
-   [<span data-ttu-id="9a40f-123">Creación de un reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-123">Creating a Briefcase Reconciler</span></span>](#creating-a-briefcase-reconciler)
-   [<span data-ttu-id="9a40f-124">Interacción del usuario en la conciliación</span><span class="sxs-lookup"><span data-stu-id="9a40f-124">User Interaction in Reconciliation</span></span>](#user-interaction-in-reconciliation)
-   [<span data-ttu-id="9a40f-125">Reconciliar objetos incrustados</span><span class="sxs-lookup"><span data-stu-id="9a40f-125">Reconciling Embedded Objects</span></span>](#reconciling-embedded-objects)
-   [<span data-ttu-id="9a40f-126">Residuos</span><span class="sxs-lookup"><span data-stu-id="9a40f-126">Residues</span></span>](#residues)

### <a name="reconciliation"></a><span data-ttu-id="9a40f-127">Conciliación</span><span class="sxs-lookup"><span data-stu-id="9a40f-127">Reconciliation</span></span>

<span data-ttu-id="9a40f-128">Un documento es una colección de información que se puede copiar y cambiar.</span><span class="sxs-lookup"><span data-stu-id="9a40f-128">A document is a collection of information that can be copied and changed.</span></span> <span data-ttu-id="9a40f-129">Un documento tiene versiones diferentes si el contenido de al menos dos copias del documento son diferentes.</span><span class="sxs-lookup"><span data-stu-id="9a40f-129">A document has different versions if the contents of at least two copies of the document are different.</span></span> <span data-ttu-id="9a40f-130">La reconciliación genera una versión única de un documento a partir de dos o más versiones iniciales.</span><span class="sxs-lookup"><span data-stu-id="9a40f-130">Reconciliation produces a single version of a document from two or more initial versions.</span></span> <span data-ttu-id="9a40f-131">Normalmente, la versión reconciliada es una combinación de información de las versiones iniciales con la información más reciente o más útil conservada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-131">Typically, the reconciled version is a combination of information from the initial versions with the most recent or most useful information preserved.</span></span>

<span data-ttu-id="9a40f-132">El maletín inicia la conciliación cuando determina que dos o más copias del mismo documento son diferentes.</span><span class="sxs-lookup"><span data-stu-id="9a40f-132">Reconciliation is initiated by Briefcase when it determines that two or more copies of the same document are different.</span></span> <span data-ttu-id="9a40f-133">Maletín, que actúa como iniciador en este contexto, localiza e inicia el reconciliador del maletín asociado con el tipo de documento especificado.</span><span class="sxs-lookup"><span data-stu-id="9a40f-133">Briefcase, which acts as the initiator in this context, locates and starts the briefcase reconciler associated with the given document type.</span></span> <span data-ttu-id="9a40f-134">El reconciliador compara los documentos y determina qué partes de los documentos se deben conservar.</span><span class="sxs-lookup"><span data-stu-id="9a40f-134">The reconciler compares the documents and determines which portions of the documents to retain.</span></span> <span data-ttu-id="9a40f-135">Algunos reconciliadores pueden requerir la interacción del usuario para completar la conciliación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-135">Some reconcilers might require user interaction to complete reconciliation.</span></span> <span data-ttu-id="9a40f-136">Otros pueden completar la reconciliación sin la interacción del usuario.</span><span class="sxs-lookup"><span data-stu-id="9a40f-136">Others might complete reconciliation without user interaction.</span></span> <span data-ttu-id="9a40f-137">El reconciliador puede estar incluido en una aplicación o ser una extensión implementada como un archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="9a40f-137">The reconciler can be contained within an application or be an extension implemented as a DLL.</span></span>

<span data-ttu-id="9a40f-138">Algunos reconciliadores de Maletin podrían crear residuos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-138">Some briefcase reconcilers might create residues.</span></span> <span data-ttu-id="9a40f-139">Un residuo es un documento, que normalmente tiene el mismo tipo de archivo que el documento inicial, que contiene información no guardada en la versión combinada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-139">A residue is a document, usually having the same file type as the initial document, that contains information not saved in the merged version.</span></span> <span data-ttu-id="9a40f-140">Los residuos se suelen usar para proporcionar a los autores una manera rápida de determinar qué información de su documento original no está en la última versión combinada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-140">Residues are typically used to give authors a quick way to determine what information from their original document is not in the final merged version.</span></span> <span data-ttu-id="9a40f-141">Si un reconciliador admite residuos, crea un residuo para cada una de las versiones originales del documento.</span><span class="sxs-lookup"><span data-stu-id="9a40f-141">If a reconciler supports residues, it creates one residue for each of the original versions of the document.</span></span> <span data-ttu-id="9a40f-142">Los residuos no se crean a menos que el iniciador los solicite.</span><span class="sxs-lookup"><span data-stu-id="9a40f-142">Residues are not created unless the initiator requests them.</span></span>

<span data-ttu-id="9a40f-143">Algunos reconciliadores de maletín funcionan con el maletín para permitir que el usuario finalice la conciliación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-143">Some briefcase reconcilers work with Briefcase to allow the user to terminate reconciliation.</span></span> <span data-ttu-id="9a40f-144">Se trata de una característica importante para un usuario que podría decidir que la reconciliación no debería continuar.</span><span class="sxs-lookup"><span data-stu-id="9a40f-144">This is an important feature for a user who might decide that the reconciliation should not proceed.</span></span> <span data-ttu-id="9a40f-145">Un reconciliador normalmente proporciona un objeto de terminación cuando la reconciliación requiere la interacción del usuario y puede ser prolongada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-145">A reconciler typically provides a termination object when the reconciliation requires user interaction and might be lengthy.</span></span> <span data-ttu-id="9a40f-146">En algunos entornos, un reconciliador podría permitir la reconciliación parcial, lo que permite a un usuario suspender temporalmente una conciliación y reanudarla más adelante.</span><span class="sxs-lookup"><span data-stu-id="9a40f-146">In some environments, a reconciler might allow partial reconciliation, enabling a user to temporarily suspend a reconciliation and resume it later.</span></span> <span data-ttu-id="9a40f-147">Sin embargo, el maletín no admite actualmente la conciliación parcial.</span><span class="sxs-lookup"><span data-stu-id="9a40f-147">Briefcase does not currently support partial reconciliation, however.</span></span>

### <a name="creating-a-briefcase-reconciler"></a><span data-ttu-id="9a40f-148">Creación de un reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-148">Creating a Briefcase Reconciler</span></span>

<span data-ttu-id="9a40f-149">Puede crear un reconciliador de maletín implementando las interfaces de conciliación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-149">You create a briefcase reconciler by implementing the reconciliation interfaces.</span></span> <span data-ttu-id="9a40f-150">Como mínimo, un reconciliador implementa la interfaz [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) y la interfaz [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) o [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-150">At a minimum, a reconciler implements the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface and the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="9a40f-151">Como iniciador, el maletín determina cuándo se necesita la conciliación y llama al método [**IReconcilableObject:: Reconciliate**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) para iniciar la conciliación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-151">As the initiator, Briefcase determines when reconciliation is needed and calls the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method to initiate reconciliation.</span></span>

<span data-ttu-id="9a40f-152">Aunque [**IReconcilableObject:: Reconciliate**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) proporciona un amplio conjunto de capacidades de conciliación, un reconciliador de maletín solo realiza una conciliación mínima en la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-152">Although [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) provides a wide-ranging set of reconciliation capabilities, a briefcase reconciler carries out only minimal reconciliation in most cases.</span></span> <span data-ttu-id="9a40f-153">En concreto, el maletín no requiere que el reconciliador admita la generación de residuos o que admita el objeto de terminación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-153">In particular, Briefcase does not require the reconciler to support residue generation or to support the termination object.</span></span> <span data-ttu-id="9a40f-154">Además, el reconciliador realiza una única conciliación de arriba a abajo y no debe devolver el valor de REC \_ E \_ NOTCOMPLETE; es decir, no debe intentar la reconciliación parcial.</span><span class="sxs-lookup"><span data-stu-id="9a40f-154">Also, the reconciler carries out a single top-to-bottom reconciliation and must not return the REC\_E\_NOTCOMPLETE value; that is, it should not attempt partial reconciliation.</span></span>

<span data-ttu-id="9a40f-155">El maletín proporciona la interfaz [**IReconcileInitiator**](ireconcileinitiator.md) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-155">Briefcase provides the [**IReconcileInitiator**](ireconcileinitiator.md) interface.</span></span> <span data-ttu-id="9a40f-156">El reconciliador del maletín puede usar el método [**IReconcileInitiator:: SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) para establecer el objeto de finalización.</span><span class="sxs-lookup"><span data-stu-id="9a40f-156">The briefcase reconciler can use the [**IReconcileInitiator::SetAbortCallback**](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback) method to set the termination object.</span></span> <span data-ttu-id="9a40f-157">El maletín no utiliza identificadores de versión y, por tanto, no puede proporcionar versiones anteriores de un documento si un reconciliador los solicita usando los métodos correspondientes en **IReconcileInitiator**.</span><span class="sxs-lookup"><span data-stu-id="9a40f-157">Briefcase does not use version identifiers and cannot, therefore, provide previous versions of a document if a reconciler requests them using the corresponding methods in **IReconcileInitiator**.</span></span>

<span data-ttu-id="9a40f-158">El maletín pasa a [**IReconcilableObject:: reconciliar**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) monikers de archivo que representan las versiones del documento que se va a conciliar.</span><span class="sxs-lookup"><span data-stu-id="9a40f-158">Briefcase passes to [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) file monikers representing the versions of the document to be reconciled.</span></span> <span data-ttu-id="9a40f-159">El reconciliador del maletín obtiene acceso a las versiones mediante el método [IMoniker:: BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) o [IMoniker:: BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-159">The briefcase reconciler gains access to the versions by using either the [IMoniker::BindToObject](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject) or [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) method.</span></span> <span data-ttu-id="9a40f-160">Esta última suele ser más rápida y se recomienda.</span><span class="sxs-lookup"><span data-stu-id="9a40f-160">The latter is generally faster and is recommended.</span></span> <span data-ttu-id="9a40f-161">El reconciliador debe liberar cualquier objeto o almacenamiento al que se enlaza.</span><span class="sxs-lookup"><span data-stu-id="9a40f-161">The reconciler must release any objects or storage to which it binds.</span></span>

<span data-ttu-id="9a40f-162">Cuando el reconciliador del maletín usa [IMoniker:: BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), se enlaza al almacenamiento que es almacenamiento plano (un flujo) o almacenamiento estructurado definido por OLE.</span><span class="sxs-lookup"><span data-stu-id="9a40f-162">When the briefcase reconciler uses [IMoniker::BindToStorage](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage), it binds to storage that is either flat storage (a stream) or OLE-defined structured storage.</span></span> <span data-ttu-id="9a40f-163">Si el reconciliador espera almacenamiento plano, debe usar IMoniker:: BindToStorage para solicitar la interfaz [IStream](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-163">If the reconciler expects flat storage, it should use IMoniker::BindToStorage to request the [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="9a40f-164">Si el reconciliador espera almacenamiento estructurado, debe solicitar la interfaz [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-164">If the reconciler expects structured storage, it should request the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="9a40f-165">En ambos casos, debe solicitar acceso directo de solo lectura (no transactd) al almacenamiento. es posible que el acceso de lectura y escritura no esté disponible.</span><span class="sxs-lookup"><span data-stu-id="9a40f-165">In both cases, it should request read-only direct (nontransacted) access to the storage; read/write access might not be available.</span></span>

<span data-ttu-id="9a40f-166">Normalmente, un reconciliador de maletín mínimo busca directamente en el almacenamiento de las otras versiones y trata los objetos incrustados de una manera muy primitiva, como la combinación de dos versiones del objeto incluyendo ambas versiones en la versión de salida.</span><span class="sxs-lookup"><span data-stu-id="9a40f-166">A minimal briefcase reconciler typically looks directly at the storage of the other versions and deals with embedded objects in a very primitive manner, such as merging two versions of the object by including both versions in the output version.</span></span>

<span data-ttu-id="9a40f-167">El iniciador ubica el reconciliador del maletín adecuado mediante un subconjunto de la lógica implementada por la función [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) para determinar el tipo de un archivo determinado y, a continuación, busca en el registro la clase de reconciliador asociada al tipo de archivo especificado.</span><span class="sxs-lookup"><span data-stu-id="9a40f-167">The initiator locates the appropriate briefcase reconciler by using a subset of the logic implemented by the [GetClassFile](/windows/win32/api/objbase/nf-objbase-getclassfile) function to determine the type of a given file and then looks in the registry for the reconciler class associated with the given file type.</span></span> <span data-ttu-id="9a40f-168">El maletín, al igual que otros componentes de Shell, determina el tipo de un archivo únicamente por la extensión de nombre de archivo.</span><span class="sxs-lookup"><span data-stu-id="9a40f-168">Briefcase, like other Shell components, determines the type of a file solely by the file name extension.</span></span> <span data-ttu-id="9a40f-169">La extensión de un archivo debe tener un tipo de archivo registrado para que el maletín invoque un reconciliador para el archivo.</span><span class="sxs-lookup"><span data-stu-id="9a40f-169">A file's extension must have a registered file type for Briefcase to invoke a reconciler for the file.</span></span> <span data-ttu-id="9a40f-170">Debe establecer una entrada del registro con el siguiente formato al instalar el reconciliador.</span><span class="sxs-lookup"><span data-stu-id="9a40f-170">You must set a registry entry of the following form when installing your reconciler.</span></span>

```
CLSID
   {the file CLSID}
      Roles
         Reconciler
            (Default) = {the reconciler-classid}
```

<span data-ttu-id="9a40f-171">La clase debe ser de carga rápida, debe designarse \_ como MULTIPLEUSE y, a menos que se proporcionen serializadores para la interfaz de conciliación, debe ser un servidor de tipo en curso (contenido en una DLL) en lugar de un servidor local (implementado en un archivo. exe).</span><span class="sxs-lookup"><span data-stu-id="9a40f-171">The class must be quick loading, must be designated \_MULTIPLEUSE, and, unless marshalers are provided for the reconciliation interface, must be an in-process server (contained in a DLL) rather than a local server (implemented in an .exe file).</span></span>

### <a name="user-interaction-in-reconciliation"></a><span data-ttu-id="9a40f-172">Interacción del usuario en la conciliación</span><span class="sxs-lookup"><span data-stu-id="9a40f-172">User Interaction in Reconciliation</span></span>

<span data-ttu-id="9a40f-173">Un reconciliador de maletín debería intentar realizar la reconciliación sin la interacción del usuario.</span><span class="sxs-lookup"><span data-stu-id="9a40f-173">A briefcase reconciler should attempt to carry out reconciliation without user interaction.</span></span> <span data-ttu-id="9a40f-174">Cuanto más automatizada sea la conciliación, mejor será la percepción del proceso por el usuario.</span><span class="sxs-lookup"><span data-stu-id="9a40f-174">The more automated the reconciliation, the better the user's perception of the process.</span></span>

<span data-ttu-id="9a40f-175">En algunos casos, la intervención del usuario puede ser valiosa.</span><span class="sxs-lookup"><span data-stu-id="9a40f-175">In some cases, user intervention can be valuable.</span></span> <span data-ttu-id="9a40f-176">Por ejemplo, un sistema de documentos podría requerir que un usuario Revise los cambios antes de aceptar la versión combinada de un documento o podría requerir comentarios del usuario en el que se explican los cambios realizados.</span><span class="sxs-lookup"><span data-stu-id="9a40f-176">For example, a document system might require a user to review changes before accepting the merged version of a document or might require comments from the user explaining the changes that have been made.</span></span> <span data-ttu-id="9a40f-177">En estos casos, el iniciador, no el reconciliador del maletín, es responsable de consultar al usuario y llevar a cabo las instrucciones del usuario.</span><span class="sxs-lookup"><span data-stu-id="9a40f-177">In these cases, the initiator, not the briefcase reconciler, is responsible for querying the user and carrying out the user's instructions.</span></span>

<span data-ttu-id="9a40f-178">En otros casos, puede ser necesaria la intervención del usuario, por ejemplo, cuando se han editado dos versiones de forma no compatible.</span><span class="sxs-lookup"><span data-stu-id="9a40f-178">In other cases, user intervention might be necessary—for example, when two versions have been edited in incompatible ways.</span></span> <span data-ttu-id="9a40f-179">En tales casos, el iniciador o el reconciliador del maletín deben consultar al usuario para obtener instrucciones sobre cómo resolver el conflicto.</span><span class="sxs-lookup"><span data-stu-id="9a40f-179">In such cases, either the initiator or briefcase reconciler must query the user for instructions on how to resolve the conflict.</span></span> <span data-ttu-id="9a40f-180">En general, ningún iniciador puede confiar en completar una conciliación sin esperar alguna interacción del usuario.</span><span class="sxs-lookup"><span data-stu-id="9a40f-180">In general, no initiator can rely on completing a reconciliation without expecting some user interaction.</span></span> <span data-ttu-id="9a40f-181">Los reconciliadores, por otro lado, tienen la opción de interactuar con el usuario para resolver conflictos o requerir que el iniciador lo haga.</span><span class="sxs-lookup"><span data-stu-id="9a40f-181">Reconcilers, on the other hand, have the option of interacting with the user to resolve conflicts or requiring the initiator to do so.</span></span>

### <a name="reconciling-embedded-objects"></a><span data-ttu-id="9a40f-182">Reconciliar objetos incrustados</span><span class="sxs-lookup"><span data-stu-id="9a40f-182">Reconciling Embedded Objects</span></span>

<span data-ttu-id="9a40f-183">Al reconciliar un documento, el propio reconciliador del maletín puede convertirse en iniciador si detecta un objeto incrustado de un tipo que no se puede conciliar.</span><span class="sxs-lookup"><span data-stu-id="9a40f-183">When reconciling a document, the briefcase reconciler itself can become an initiator if it discovers an embedded object of a type that it cannot reconcile.</span></span> <span data-ttu-id="9a40f-184">En este caso, el reconciliador necesita reconciliar de forma recursiva cada uno de los objetos incrustados y asumir todas las responsabilidades de un iniciador.</span><span class="sxs-lookup"><span data-stu-id="9a40f-184">In this case, the reconciler needs to recursively reconcile each of the embedded objects and assume all the responsibilities of an initiator.</span></span>

<span data-ttu-id="9a40f-185">Para llevar a cabo la recursividad, el reconciliador del maletín carga el objeto y las consultas para la interfaz adecuada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-185">To carry out the recursion, the briefcase reconciler loads the object and queries for the appropriate interface.</span></span> <span data-ttu-id="9a40f-186">El controlador del objeto debe admitir la interfaz.</span><span class="sxs-lookup"><span data-stu-id="9a40f-186">The handler for the object must support the interface.</span></span> <span data-ttu-id="9a40f-187">Si algún método de la interfaz devuelve el \_ valor OLE E \_ NOTRUNNING, el reconciliador debe ejecutar el objeto para llevar a cabo la operación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-187">If any method of the interface returns the OLE\_E\_NOTRUNNING value, the reconciler must run the object in order to carry out the operation.</span></span> <span data-ttu-id="9a40f-188">Dado que el código para los objetos incrustados no siempre está disponible, un reconciliador debe proporcionar una solución para esta condición.</span><span class="sxs-lookup"><span data-stu-id="9a40f-188">Because code for embedded objects is not always available, a reconciler must provide a solution for this condition.</span></span> <span data-ttu-id="9a40f-189">Por ejemplo, el reconciliador podría incluir versiones antiguas y nuevas del objeto incrustado en la versión reconciliada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-189">For example, the reconciler might include both old and new versions of the embedded object in the reconciled version.</span></span> <span data-ttu-id="9a40f-190">El reconciliador no debe intentar conciliar los vínculos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-190">The reconciler must not attempt to reconcile across links.</span></span>

<span data-ttu-id="9a40f-191">El iniciador almacena las versiones del documento que se están combinando.</span><span class="sxs-lookup"><span data-stu-id="9a40f-191">The initiator stores the document versions being merged.</span></span> <span data-ttu-id="9a40f-192">En muchos casos, el iniciador tiene acceso al almacenamiento de cada versión y guarda el resultado de la reconciliación con almacenamiento similar.</span><span class="sxs-lookup"><span data-stu-id="9a40f-192">In many cases, the initiator has access to the storage of each version and saves the result of reconciliation using similar storage.</span></span> <span data-ttu-id="9a40f-193">Sin embargo, a veces, el iniciador puede tener un objeto en memoria para el que no hay ninguna versión persistente disponible.</span><span class="sxs-lookup"><span data-stu-id="9a40f-193">Sometimes, however, the initiator might have an in-memory object for which no persistent version is available.</span></span> <span data-ttu-id="9a40f-194">Esta situación puede producirse cuando se debe conciliar un documento que contenga objetos incrustados abiertos antes de guardarlo.</span><span class="sxs-lookup"><span data-stu-id="9a40f-194">This situation can occur when a document containing open embedded objects must be reconciled before being saved.</span></span> <span data-ttu-id="9a40f-195">En tales casos, el iniciador guarda el resultado de la reconciliación en la versión encontrada en la memoria.</span><span class="sxs-lookup"><span data-stu-id="9a40f-195">In such cases, the initiator saves the result of the reconciliation in the version found in memory.</span></span>

<span data-ttu-id="9a40f-196">El iniciador utiliza la interfaz [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) para enlazar (cargar) la versión combinada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-196">The initiator uses the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) interface to bind (load) the merged version.</span></span> <span data-ttu-id="9a40f-197">El iniciador usa el método [IPersistStorage:: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) si ya se ha creado una versión inicial y usa el método [IPersistStorage:: InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) para la versión inicial.</span><span class="sxs-lookup"><span data-stu-id="9a40f-197">The initiator uses the [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) method if an initial version has already been created and uses the [IPersistStorage::InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew) method for the initial version.</span></span> <span data-ttu-id="9a40f-198">Cuando se carga la versión combinada, el iniciador usa [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) para recuperar la dirección de la interfaz [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-198">When the merged version is loaded, the initiator uses [QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to retrieve the address of the [**IReconcilableObject**](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) interface.</span></span> <span data-ttu-id="9a40f-199">Esta interfaz proporciona al iniciador acceso al almacenamiento de los residuos existentes y le proporciona una manera de crear almacenamiento para los nuevos residuos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-199">This interface gives the initiator access to the storage of the existing residues and gives it a way to create storage for any new residues.</span></span> <span data-ttu-id="9a40f-200">A continuación, el iniciador dirige la interfaz para llevar a cabo la conciliación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-200">Then the initiator directs the interface to carry out the reconciliation.</span></span> <span data-ttu-id="9a40f-201">En realidad, el iniciador consulta la interfaz [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) antes de IPersistStorage.</span><span class="sxs-lookup"><span data-stu-id="9a40f-201">The initiator actually queries for the [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface before IPersistStorage.</span></span> <span data-ttu-id="9a40f-202">Si el reconciliador admite IPersistFile, el iniciador manipula la réplica a través de IPersistFile en lugar de los métodos de IPersistStorage.</span><span class="sxs-lookup"><span data-stu-id="9a40f-202">If the reconciler supports IPersistFile, the initiator manipulates the replica through the IPersistFile rather than the IPersistStorage methods.</span></span> <span data-ttu-id="9a40f-203">Esto permite la reconciliación de archivos que no se almacenan como documentos compuestos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-203">This permits reconciliation of files that are not stored as compound documents.</span></span>

<span data-ttu-id="9a40f-204">Una vez completada la conciliación, el iniciador puede guardar la versión combinada mediante la interfaz [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) o [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-204">When the reconciliation is complete, the initiator can save the merged version by using the [IPersistStorage](/windows/win32/api/objidl/nn-objidl-ipersiststorage) or [IPersistFile](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="9a40f-205">Durante la conciliación, el reconciliador del maletín crea los residuos según sea necesario y escribe sus bits persistentes en el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="9a40f-205">During reconciliation, the briefcase reconciler creates residues as needed and writes their persistent bits to storage.</span></span> <span data-ttu-id="9a40f-206">Si la versión combinada es una secuencia, la interfaz [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) pasada a [IPersistStorage:: Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) contiene una secuencia denominada "contents" con su estado de almacenamiento establecido en STATEBITS \_ Flat.</span><span class="sxs-lookup"><span data-stu-id="9a40f-206">If the merged version is a stream, the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface passed to [IPersistStorage::Load](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) contains a stream named "Contents" with its storage state set to STATEBITS\_FLAT.</span></span> <span data-ttu-id="9a40f-207">(Puede establecer los bits de estado mediante el método [IStorage:: Stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) ). Después de la combinación, el iniciador guarda la versión combinada escribiendo los datos de una manera adecuada.</span><span class="sxs-lookup"><span data-stu-id="9a40f-207">(You can set the state bits by using the [IStorage::Stat](/windows/win32/api/objidl/nf-objidl-istorage-stat) method.) After the merge, the initiator saves the merged version by writing the data in an appropriate manner.</span></span> <span data-ttu-id="9a40f-208">Debe asegurarse de que STATEBITS \_ Flat esté establecido según sea adecuado para el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="9a40f-208">It should ensure that STATEBITS\_FLAT is set as appropriate for the storage.</span></span>

### <a name="residues"></a><span data-ttu-id="9a40f-209">Residuos</span><span class="sxs-lookup"><span data-stu-id="9a40f-209">Residues</span></span>

<span data-ttu-id="9a40f-210">El iniciador indica si quiere residuos estableciendo el parámetro *pstgNewResidues* en una dirección válida al llamar al método [**IReconcilableObject:: reconciliate**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-210">The initiator indicates whether it wants residues by setting the *pstgNewResidues* parameter to a valid address when calling the [**IReconcilableObject::Reconcile**](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile) method.</span></span> <span data-ttu-id="9a40f-211">Si el reconciliador no admite la creación de residuos, debe devolver inmediatamente el valor de REC \_ E \_ noresiduos, a menos que el parámetro *dwFlags* especifique el valor de **\_ NORESIDUESOK de RECONCILEF** .</span><span class="sxs-lookup"><span data-stu-id="9a40f-211">If the reconciler does not support the creation of residues, it must return immediately the REC\_E\_NORESIDUES value, unless the *dwFlags* parameter specifies the **RECONCILEF\_NORESIDUESOK** value.</span></span>

<span data-ttu-id="9a40f-212">El reconciliador del maletín devuelve los residuos al iniciador mediante la creación de nuevos elementos de almacenamiento y su copia en la matriz a la que señala *pstgNewResidues*.</span><span class="sxs-lookup"><span data-stu-id="9a40f-212">The briefcase reconciler returns residues to the initiator by creating new storage elements and copying them to the array pointed to by *pstgNewResidues*.</span></span> <span data-ttu-id="9a40f-213">En el caso de los residuos de almacenamiento estructurado, el reconciliador copia una interfaz [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) y, en el caso de los residuos de almacenamiento plano, copia una interfaz [IStream](/windows/win32/api/objidl/nn-objidl-istream) o IStorage con la \_ marca plana STATEBITS establecida.</span><span class="sxs-lookup"><span data-stu-id="9a40f-213">For structured storage residues, the reconciler copies an [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) interface, and for flat storage residues, it copies either an [IStream](/windows/win32/api/objidl/nn-objidl-istream) or an IStorage interface with the STATEBITS\_FLAT flag set.</span></span> <span data-ttu-id="9a40f-214">El reconciliador utiliza IStorage para crear el almacenamiento necesario, mediante [IStorage:: CreateStream (](/windows/win32/api/objidl/nf-objidl-istorage-createstream) para crear almacenamiento plano para un residuo que es una secuencia y [IStorage:: CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) para crear almacenamiento estructurado.</span><span class="sxs-lookup"><span data-stu-id="9a40f-214">The reconciler uses IStorage to create the necessary storage, using [IStorage::CreateStream](/windows/win32/api/objidl/nf-objidl-istorage-createstream) to create flat storage for a residue that is a stream and [IStorage::CreateStorage](/windows/win32/api/objidl/nf-objidl-istorage-createstorage) to create structured storage.</span></span>

<span data-ttu-id="9a40f-215">El iniciador prepara *pstgNewResidues* para que no contenga ningún elemento en la parte no reservada del espacio de nombres [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="9a40f-215">The initiator prepares *pstgNewResidues* so that it contains no elements in the nonreserved part of the [IStorage](/windows/win32/api/objidl/nn-objidl-istorage) namespace.</span></span> <span data-ttu-id="9a40f-216">El reconciliador del maletín coloca cada residuo en un elemento cuyo nombre corresponde al orden de su versión inicial.</span><span class="sxs-lookup"><span data-stu-id="9a40f-216">The briefcase reconciler places each residue in an element whose name corresponds to the order of its initial version.</span></span> <span data-ttu-id="9a40f-217">Por ejemplo, el primer residuo está contenido en "1", el segundo en "2", etc.</span><span class="sxs-lookup"><span data-stu-id="9a40f-217">For example, the first residue is contained in "1", the second in "2", and so on.</span></span> <span data-ttu-id="9a40f-218">Si el propio objeto reconciliado produce un residuo, se encuentra en el elemento denominado "0".</span><span class="sxs-lookup"><span data-stu-id="9a40f-218">If the reconciled object itself produces a residue, it is found in the element named "0".</span></span>

<span data-ttu-id="9a40f-219">El reconciliador del maletín confirma individualmente cada uno de los elementos recién creados, asegurándose de que el iniciador tenga acceso a la información.</span><span class="sxs-lookup"><span data-stu-id="9a40f-219">The briefcase reconciler commits each of the newly created elements individually, ensuring that the initiator has access to the information.</span></span> <span data-ttu-id="9a40f-220">Sin embargo, el reconciliador no confirma *pstgNewResidues* .</span><span class="sxs-lookup"><span data-stu-id="9a40f-220">The reconciler does not, however, commit *pstgNewResidues* itself.</span></span> <span data-ttu-id="9a40f-221">El iniciador es responsable de confirmar esto o de eliminarlo de otro modo.</span><span class="sxs-lookup"><span data-stu-id="9a40f-221">The initiator is responsible for committing this or otherwise disposing of it.</span></span>

## <a name="briefcase-reconciler-reference"></a><span data-ttu-id="9a40f-222">Referencia de reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-222">Briefcase Reconciler Reference</span></span>

<span data-ttu-id="9a40f-223">Esta sección contiene información sobre las interfaces de conciliación.</span><span class="sxs-lookup"><span data-stu-id="9a40f-223">This section contains information about the reconciliation interfaces.</span></span> <span data-ttu-id="9a40f-224">Al controlar los errores, un método solo puede devolver los valores de error que se definen explícitamente como posibles valores devueltos.</span><span class="sxs-lookup"><span data-stu-id="9a40f-224">When handling errors, a method can return only those error values that are explicitly defined as possible return values.</span></span> <span data-ttu-id="9a40f-225">Además, el método debe establecer todas las variables cuyas direcciones se pasan como parámetros a **null** antes de devolver el error.</span><span class="sxs-lookup"><span data-stu-id="9a40f-225">Furthermore, the method must set all variables whose addresses are passed as parameters to **NULL** before returning from the error.</span></span>

### <a name="briefcase-reconciler-interfaces-and-methods"></a><span data-ttu-id="9a40f-226">Interfaces y métodos del reconciliador de maletín</span><span class="sxs-lookup"><span data-stu-id="9a40f-226">Briefcase Reconciler Interfaces and Methods</span></span>

-   [<span data-ttu-id="9a40f-227">**IReconcilableObject**</span><span class="sxs-lookup"><span data-stu-id="9a40f-227">**IReconcilableObject**</span></span>](/windows/win32/api/reconcil/nn-reconcil-ireconcilableobject) 
    -   -   [<span data-ttu-id="9a40f-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span><span class="sxs-lookup"><span data-stu-id="9a40f-228">**IReconcilableObject::GetProgressFeedbackMaxEstimate**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-getprogressfeedbackmaxestimate)
        -   [<span data-ttu-id="9a40f-229">**IReconcilableObject:: reconcile**</span><span class="sxs-lookup"><span data-stu-id="9a40f-229">**IReconcilableObject::Reconcile**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcilableobject-reconcile)

-   [<span data-ttu-id="9a40f-230">**IReconcileInitiator**</span><span class="sxs-lookup"><span data-stu-id="9a40f-230">**IReconcileInitiator**</span></span>](ireconcileinitiator.md) 
    -   -   [<span data-ttu-id="9a40f-231">**IReconcileInitiator::SetAbortCallback**</span><span class="sxs-lookup"><span data-stu-id="9a40f-231">**IReconcileInitiator::SetAbortCallback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setabortcallback)
        -   [<span data-ttu-id="9a40f-232">**IReconcileInitiator::SetProgressFeedback**</span><span class="sxs-lookup"><span data-stu-id="9a40f-232">**IReconcileInitiator::SetProgressFeedback**</span></span>](/windows/win32/api/reconcil/nf-reconcil-ireconcileinitiator-setprogressfeedback)

-   [<span data-ttu-id="9a40f-233">**INotifyReplica**</span><span class="sxs-lookup"><span data-stu-id="9a40f-233">**INotifyReplica**</span></span>](/windows/desktop/api/reconcil/nn-reconcil-inotifyreplica) 
    -   -   [<span data-ttu-id="9a40f-234">**INotifyReplica::YouAreAReplica**</span><span class="sxs-lookup"><span data-stu-id="9a40f-234">**INotifyReplica::YouAreAReplica**</span></span>](/windows/desktop/api/reconcil/nf-reconcil-inotifyreplica-youareareplica)

 

 