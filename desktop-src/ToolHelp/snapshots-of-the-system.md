---
title: Instantáneas del sistema
description: Las instantáneas son el núcleo de las funciones de ayuda de la herramienta. Una instantánea es una copia de solo lectura del estado actual de una o varias de las listas siguientes que residen en los procesos, subprocesos, módulos y montones de memoria del sistema.
ms.assetid: a8122960-f078-4efb-8e01-bf6fb69ee0dd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6ab6f9a45ad2e12eda53d3143e43c9234c20aae3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "103904700"
---
# <a name="snapshots-of-the-system"></a><span data-ttu-id="c1adc-104">Instantáneas del sistema</span><span class="sxs-lookup"><span data-stu-id="c1adc-104">Snapshots of the System</span></span>

<span data-ttu-id="c1adc-105">Las instantáneas son el núcleo de las funciones de ayuda de la herramienta.</span><span class="sxs-lookup"><span data-stu-id="c1adc-105">Snapshots are at the core of the tool help functions.</span></span> <span data-ttu-id="c1adc-106">Una instantánea es una copia de solo lectura del estado actual de una o varias de las listas siguientes que residen en la memoria del sistema: procesos, subprocesos, módulos y montones.</span><span class="sxs-lookup"><span data-stu-id="c1adc-106">A snapshot is a read-only copy of the current state of one or more of the following lists that reside in system memory: processes, threads, modules, and heaps.</span></span>

<span data-ttu-id="c1adc-107">Los procesos que usan funciones de ayuda de herramientas de tienen acceso a estas listas desde instantáneas en lugar de hacerlo directamente desde el sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="c1adc-107">Processes that use tool help functions access these lists from snapshots instead of directly from the operating system.</span></span> <span data-ttu-id="c1adc-108">Las listas de la memoria del sistema cambian cuando se inician y finalizan los procesos, se crean y destruyen los subprocesos, los módulos ejecutables se cargan y descargan de la memoria del sistema, y se crean y destruyen los montones.</span><span class="sxs-lookup"><span data-stu-id="c1adc-108">The lists in system memory change when processes are started and ended, threads are created and destroyed, executable modules are loaded and unloaded from system memory, and heaps are created and destroyed.</span></span> <span data-ttu-id="c1adc-109">El uso de información de una instantánea evita incoherencias.</span><span class="sxs-lookup"><span data-stu-id="c1adc-109">The use of information from a snapshot prevents inconsistencies.</span></span> <span data-ttu-id="c1adc-110">De lo contrario, los cambios en una lista podrían provocar que un subproceso recorra la lista incorrectamente o cause una infracción de acceso (un error de GP).</span><span class="sxs-lookup"><span data-stu-id="c1adc-110">Otherwise, changes to a list could possibly cause a thread to incorrectly traverse the list or cause an access violation (a GP fault).</span></span> <span data-ttu-id="c1adc-111">Por ejemplo, si una aplicación atraviesa la lista de subprocesos mientras se crean o finalizan otros subprocesos, la información que utiliza la aplicación para atravesar la lista de subprocesos podría quedar obsoleta y podría provocar un error en la aplicación que atraviesa la lista.</span><span class="sxs-lookup"><span data-stu-id="c1adc-111">For example, if an application traverses the thread list while other threads are created or terminated, information that the application is using to traverse the thread list might become outdated and could cause an error for the application traversing the list.</span></span>

<span data-ttu-id="c1adc-112">Para tomar una instantánea de la memoria del sistema, utilice la función [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) .</span><span class="sxs-lookup"><span data-stu-id="c1adc-112">To take a snapshot of the system memory, use the [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) function.</span></span> <span data-ttu-id="c1adc-113">Puede controlar el contenido de una instantánea especificando uno o varios de los siguientes valores al llamar a esta función:</span><span class="sxs-lookup"><span data-stu-id="c1adc-113">You can control the content of a snapshot by specifying one or more of the following values when calling this function:</span></span>

-   <span data-ttu-id="c1adc-114">**TH32CS \_ SNAPHEAPLIST**</span><span class="sxs-lookup"><span data-stu-id="c1adc-114">**TH32CS\_SNAPHEAPLIST**</span></span>
-   <span data-ttu-id="c1adc-115">**TH32CS \_ SNAPMODULE**</span><span class="sxs-lookup"><span data-stu-id="c1adc-115">**TH32CS\_SNAPMODULE**</span></span>
-   <span data-ttu-id="c1adc-116">**TH32CS \_ SNAPPROCESS**</span><span class="sxs-lookup"><span data-stu-id="c1adc-116">**TH32CS\_SNAPPROCESS**</span></span>
-   <span data-ttu-id="c1adc-117">**TH32CS \_ SNAPTHREAD**</span><span class="sxs-lookup"><span data-stu-id="c1adc-117">**TH32CS\_SNAPTHREAD**</span></span>

<span data-ttu-id="c1adc-118">Los valores de **TH32CS \_ SNAPHEAPLIST** y **TH32CS \_ SNAPMODULE** son específicos del proceso.</span><span class="sxs-lookup"><span data-stu-id="c1adc-118">The **TH32CS\_SNAPHEAPLIST** and **TH32CS\_SNAPMODULE** values are process specific.</span></span> <span data-ttu-id="c1adc-119">Cuando se especifican estos valores, se incluyen en la instantánea las listas del montón y del módulo del proceso especificado.</span><span class="sxs-lookup"><span data-stu-id="c1adc-119">When these values are specified, the heap and module lists of the specified process are included in the snapshot.</span></span> <span data-ttu-id="c1adc-120">Si especifica cero como identificador de proceso, se utiliza el proceso actual.</span><span class="sxs-lookup"><span data-stu-id="c1adc-120">If you specify zero as the process identifier, the current process is used.</span></span> <span data-ttu-id="c1adc-121">El valor de **\_ SNAPTHREAD de TH32CS** siempre crea una instantánea en todo el sistema aunque se pase un identificador de proceso a [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span><span class="sxs-lookup"><span data-stu-id="c1adc-121">The **TH32CS\_SNAPTHREAD** value always creates a system-wide snapshot even if a process identifier is passed to [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span></span>

<span data-ttu-id="c1adc-122">Para enumerar el estado del montón o del módulo para todos los procesos, especifique el valor de **\_ SNAPALL de TH32CS** y el identificador de proceso del proceso actual.</span><span class="sxs-lookup"><span data-stu-id="c1adc-122">To enumerate the heap or module state for all processes, specify the **TH32CS\_SNAPALL** value and the process identifier of the current process.</span></span> <span data-ttu-id="c1adc-123">A continuación, para cada proceso adicional de la instantánea, llame de nuevo a [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) , especificando su identificador de proceso y el valor de **TH32CS \_ SNAPHEAPLIST** o **TH32CS \_ SNAPMODULE** .</span><span class="sxs-lookup"><span data-stu-id="c1adc-123">Then, for each additional process in the snapshot, call [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) again, specifying its process identifier and the **TH32CS\_SNAPHEAPLIST** or **TH32CS\_SNAPMODULE** value.</span></span>

<span data-ttu-id="c1adc-124">Puede recuperar un código de estado de error extendido para [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) mediante la función [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="c1adc-124">You can retrieve an extended error status code for [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) by using the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span>

<span data-ttu-id="c1adc-125">Cuando el proceso termine de usar una instantánea, destruya con la función [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="c1adc-125">When your process finishes using a snapshot, destroy it using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="c1adc-126">Si no destruye una instantánea, el proceso perderá memoria hasta que se cierre, momento en el que el sistema reclama la memoria.</span><span class="sxs-lookup"><span data-stu-id="c1adc-126">If you do not destroy a snapshot, the process will leak memory until the it exits, at which time the system reclaims the memory.</span></span>

> [!Note]  
> <span data-ttu-id="c1adc-127">El identificador de la instantánea actúa como un identificador de archivo y está sujeto a las mismas reglas en relación con los procesos y subprocesos en los que se puede usar.</span><span class="sxs-lookup"><span data-stu-id="c1adc-127">The snapshot handle acts like a file handle and is subject to the same rules regarding the processes and threads in which it can be used.</span></span> <span data-ttu-id="c1adc-128">Para especificar que el identificador sea heredable, cree la instantánea mediante el valor de **\_ herencia TH32CS** .</span><span class="sxs-lookup"><span data-stu-id="c1adc-128">To specify that the handle is inheritable, create the snapshot using the **TH32CS\_INHERIT** value.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="c1adc-129">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="c1adc-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c1adc-130">Tomar una instantánea y ver los procesos</span><span class="sxs-lookup"><span data-stu-id="c1adc-130">Taking a Snapshot and Viewing Processes</span></span>](taking-a-snapshot-and-viewing-processes.md)
</dt> </dl>

 

 