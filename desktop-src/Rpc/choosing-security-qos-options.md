---
title: Elegir opciones de QOS de seguridad
description: Las opciones de QOS de seguridad se pasan como parte del parámetro SecurityQOS dado a la función RpcBindingSetAuthInfoEx. Utilice las siguientes prácticas recomendadas.
ms.assetid: 43befe3d-079a-4389-a1ff-6bda90935769
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c286b516438eae78117ef8d73939c3b4bed396d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105676485"
---
# <a name="choosing-security-qos-options"></a><span data-ttu-id="8f71f-104">Elegir opciones de QOS de seguridad</span><span class="sxs-lookup"><span data-stu-id="8f71f-104">Choosing Security QOS Options</span></span>

<span data-ttu-id="8f71f-105">Las opciones de QOS de seguridad se pasan como parte del parámetro *SecurityQOS* dado a la función [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) .</span><span class="sxs-lookup"><span data-stu-id="8f71f-105">The security QOS options are passed as part of the *SecurityQOS* parameter given to the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function.</span></span> <span data-ttu-id="8f71f-106">Utilice las siguientes prácticas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="8f71f-106">Use the following best practices.</span></span>

## <a name="use-mutual-authentication"></a><span data-ttu-id="8f71f-107">Usar autenticación mutua</span><span class="sxs-lookup"><span data-stu-id="8f71f-107">Use Mutual Authentication</span></span>

<span data-ttu-id="8f71f-108">La autenticación mutua verdadera solo está disponible para determinados proveedores de seguridad: Negotiate (cuando negocia Kerberos), Kerberos y Schannel.</span><span class="sxs-lookup"><span data-stu-id="8f71f-108">True mutual authentication is available only for certain security providers: Negotiate (when it negotiates Kerberos), Kerberos, and Schannel.</span></span> <span data-ttu-id="8f71f-109">NTLM no admite la autenticación mutua.</span><span class="sxs-lookup"><span data-stu-id="8f71f-109">NTLM does not support mutual authentication.</span></span> <span data-ttu-id="8f71f-110">El uso de la autenticación mutua requiere que se proporcione un nombre de entidad de seguridad de servidor correcto.</span><span class="sxs-lookup"><span data-stu-id="8f71f-110">Using mutual authentication requires that a well formed server principal name be provided.</span></span> <span data-ttu-id="8f71f-111">Muchos desarrolladores usan la siguiente práctica de seguridad defectuosa: se llama al servidor para solicitar su nombre principal ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)) y, a continuación, se les solicita la autenticación mutua mediante ese nombre de entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="8f71f-111">Many developers use the following faulty security practice: The server is called to ask for its principal name ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), and then they blindly ask for mutual authentication using that principal name.</span></span> <span data-ttu-id="8f71f-112">Este enfoque interrumpe toda la idea de la autenticación mutua; la idea de la autenticación mutua es que solo se llama a determinados servidores porque son de confianza para analizar y controlar los datos.</span><span class="sxs-lookup"><span data-stu-id="8f71f-112">This approach breaks the whole idea of mutual authentication; the idea of mutual authentication is that only certain servers are called because they are trusted to parse and handle your data.</span></span> <span data-ttu-id="8f71f-113">Mediante el uso de la práctica de seguridad defectuosa que se acaba de describir, los desarrolladores proporcionan sus datos a cualquier persona lo suficientemente inteligente como para devolver su nombre.</span><span class="sxs-lookup"><span data-stu-id="8f71f-113">Using the faulty security practice just described, developers give their data to anyone smart enough to return their name.</span></span>

<span data-ttu-id="8f71f-114">Por ejemplo, si el software cliente debe llamar solo a un servidor que ejecute en las cuentas Joe, Ana o Alice, se debe llamar a la función [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) y debe comprobarse el nombre que se devuelve.</span><span class="sxs-lookup"><span data-stu-id="8f71f-114">As an example, if the client software should call only a server running under Joe, Pete, or Alice's accounts, the [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) function should be called, and the name sent back should be checked.</span></span> <span data-ttu-id="8f71f-115">Si es Joe, Pedro o Alice, se debe solicitar la autenticación mutua con el nombre de la entidad de seguridad del servidor.</span><span class="sxs-lookup"><span data-stu-id="8f71f-115">If it is Joe, Pete or Alice, mutual authentication should be requested using their server principal name.</span></span> <span data-ttu-id="8f71f-116">Esto garantiza que las dos mitades de la conversación vayan a la misma entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="8f71f-116">This ensures both halves of the conversation go to the same principal.</span></span>

<span data-ttu-id="8f71f-117">Si el software cliente debe llamar solo a un servicio que se ejecuta en la cuenta de Joe, cree directamente el nombre de entidad de seguridad de servidor de Joe y realice la llamada.</span><span class="sxs-lookup"><span data-stu-id="8f71f-117">If client software should call a service running under Joe's account only, directly compose Joe's server principal name and make the call.</span></span> <span data-ttu-id="8f71f-118">Si el servidor no es Joe, simplemente se producirá un error en la llamada.</span><span class="sxs-lookup"><span data-stu-id="8f71f-118">If the server is not Joe, the call will simply fail.</span></span>

<span data-ttu-id="8f71f-119">Muchas veces, los servicios se ejecutan como servicios del sistema de Windows, lo que significa que se ejecutan en la cuenta de la máquina.</span><span class="sxs-lookup"><span data-stu-id="8f71f-119">Many times, services run as Windows system services, which means they run under the machine account.</span></span> <span data-ttu-id="8f71f-120">Todavía se recomienda la autenticación mutua y la creación de un nombre de entidad de seguridad de servidor.</span><span class="sxs-lookup"><span data-stu-id="8f71f-120">Mutual authentication and creation of a server principal name is still recommended.</span></span>

## <a name="use-the-lowest-impersonationtype-that-allows-the-call-to-go-through"></a><span data-ttu-id="8f71f-121">Use el ImpersonationType más bajo que permite a la llamada pasar por</span><span class="sxs-lookup"><span data-stu-id="8f71f-121">Use the Lowest ImpersonationType that Allows the Call to Go Through</span></span>

<span data-ttu-id="8f71f-122">Este procedimiento recomendado es bastante descriptivo.</span><span class="sxs-lookup"><span data-stu-id="8f71f-122">This Best Practice is fairly self explanatory.</span></span> <span data-ttu-id="8f71f-123">Incluso si se usa la autenticación mutua, no proporcione al servidor más derechos de lo necesario. es posible que se haya puesto en peligro un servidor legítimo y, aunque los datos que envía se encuentren en las manos equivocadas, como mínimo, el servidor no podrá tener acceso a otros datos de la red en su nombre.</span><span class="sxs-lookup"><span data-stu-id="8f71f-123">Even if mutual authentication is used, do not give the server more rights than necessary; a legitimate server may have been compromised, and even though the data you send falls into the wrong hands in such cases, at least the server will not be able to access other data on the network on your behalf.</span></span> <span data-ttu-id="8f71f-124">Algunos servidores rechazarán una llamada que no tiene información suficiente para determinar y, posiblemente, suplantar al llamador.</span><span class="sxs-lookup"><span data-stu-id="8f71f-124">Some servers will reject a call that does not have sufficient information to determine, and possibly impersonate, the caller.</span></span> <span data-ttu-id="8f71f-125">Además, tenga en cuenta que algunas secuencias de protocolos admiten la seguridad de nivel de transporte ([**ncacn \_ NP**](/windows/desktop/Midl/ncacn-np) y [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span><span class="sxs-lookup"><span data-stu-id="8f71f-125">Also, be aware that some protocol sequences support transport level security ([**ncacn\_np**](/windows/desktop/Midl/ncacn-np) and [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span></span> <span data-ttu-id="8f71f-126">En tales casos, el servidor siempre puede suplantar al usuario si se especifica un nivel de suplantación lo suficientemente alto mediante el parámetro *NetworkOptions* al crear el identificador de enlace.</span><span class="sxs-lookup"><span data-stu-id="8f71f-126">In such cases, the server can always impersonate you if you specify a sufficiently high impersonation level through the *NetworkOptions* parameter when you create the binding handle.</span></span>

<span data-ttu-id="8f71f-127">Por último, algunos proveedores de seguridad o transportes pueden golpear de forma transparente ImpersonationType a un nivel superior al especificado.</span><span class="sxs-lookup"><span data-stu-id="8f71f-127">Finally, some security providers or transports may transparently bump ImpersonationType to a higher level than that specified.</span></span> <span data-ttu-id="8f71f-128">Al desarrollar un programa, asegúrese de intentar realizar llamadas con el ImpersonationType previsto y compruebe si está obteniendo más ImpersonationType en el servidor.</span><span class="sxs-lookup"><span data-stu-id="8f71f-128">When developing a program, make sure you try to make calls with the intended ImpersonationType and check whether you are getting higher ImpersonationType on the server.</span></span>

 

 