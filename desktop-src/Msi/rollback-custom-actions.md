---
description: Cuando el instalador procesa el script de instalación, genera simultáneamente un script de reversión.
ms.assetid: 5b9bfc5a-6a78-4b0e-aed8-f25aba089af1
title: Revertir acciones personalizadas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c4ad91f8f94145399d51ed2ef53999ab0a91d65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103908436"
---
# <a name="rollback-custom-actions"></a><span data-ttu-id="f3960-103">Revertir acciones personalizadas</span><span class="sxs-lookup"><span data-stu-id="f3960-103">Rollback Custom Actions</span></span>

<span data-ttu-id="f3960-104">Cuando el instalador procesa el script de instalación, genera simultáneamente un script de reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-104">When the installer processes the installation script, it simultaneously generates a rollback script.</span></span> <span data-ttu-id="f3960-105">Además del script de reversión, el instalador guarda una copia de todos los archivos que elimina durante la instalación.</span><span class="sxs-lookup"><span data-stu-id="f3960-105">In addition to the rollback script, the installer saves a copy of every file it deletes during the installation.</span></span> <span data-ttu-id="f3960-106">Estos archivos se conservan en un directorio oculto del sistema.</span><span class="sxs-lookup"><span data-stu-id="f3960-106">These files are kept in a hidden system directory.</span></span> <span data-ttu-id="f3960-107">Una vez completada la instalación, se eliminan el script de reversión y los archivos guardados.</span><span class="sxs-lookup"><span data-stu-id="f3960-107">Once the installation is complete, the rollback script and the saved files are deleted.</span></span> <span data-ttu-id="f3960-108">Si una instalación no se realiza correctamente, el instalador intenta revertir los cambios realizados durante la instalación y restaurar el estado original del equipo.</span><span class="sxs-lookup"><span data-stu-id="f3960-108">If an installation is unsuccessful, the installer attempts to rollback the changes made during the installation and restore the original state of the computer.</span></span>

<span data-ttu-id="f3960-109">Aunque las acciones personalizadas que programan las operaciones del sistema mediante la inserción de filas en la tabla de la base de datos se invierten mediante una reversión de la instalación, las acciones personalizadas que cambian el sistema directamente o que emiten comandos a otros servicios del sistema no se pueden invertir siempre mediante una reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-109">Although custom actions that schedule system operations by inserting rows into database table are reversed by a rollback of the installation, custom actions that change the system directly, or that issue commands to other system services, cannot always be reversed by a rollback.</span></span> <span data-ttu-id="f3960-110">Una acción de reversión personalizada es una acción que el instalador solo ejecuta durante una reversión de la instalación y su finalidad es invertir una acción personalizada que ha realizado cambios en el sistema.</span><span class="sxs-lookup"><span data-stu-id="f3960-110">A rollback custom action is an action that the installer executes only during an installation rollback, and its purpose is to reverse a custom action that has made changes to the system.</span></span>

<span data-ttu-id="f3960-111">Una acción personalizada rollback es un tipo de [acción personalizada de ejecución aplazada](deferred-execution-custom-actions.md), porque su ejecución se aplaza cuando se invoca durante la secuencia de instalación.</span><span class="sxs-lookup"><span data-stu-id="f3960-111">A rollback custom action is a type of [deferred execution custom action](deferred-execution-custom-actions.md), because its execution is deferred when it is invoked during the installation sequence.</span></span> <span data-ttu-id="f3960-112">Difiere de una acción personalizada diferida normal en que solo se ejecuta durante una reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-112">It differs from a regular deferred custom action in that it is only executed during a rollback.</span></span> <span data-ttu-id="f3960-113">Una acción personalizada rollback debe preceder siempre A la acción personalizada diferida que se revierte en la secuencia de acción.</span><span class="sxs-lookup"><span data-stu-id="f3960-113">A rollback custom action must always precede the deferred custom action it rolls back in the action sequence.</span></span> <span data-ttu-id="f3960-114">Una acción personalizada rollback también debe controlar el caso en el que se interrumpe la acción personalizada diferida en medio de la ejecución.</span><span class="sxs-lookup"><span data-stu-id="f3960-114">A rollback custom action should also handle the case where the deferred custom action is interrupted in the middle of execution.</span></span> <span data-ttu-id="f3960-115">Por ejemplo, si el usuario presiona el botón Cancelar mientras se ejecutaba la acción personalizada.</span><span class="sxs-lookup"><span data-stu-id="f3960-115">For example, if the user were to press the Cancel button while the custom action was executing.</span></span>

<span data-ttu-id="f3960-116">Tenga en cuenta que las acciones personalizadas de reversión no se pueden ejecutar de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="f3960-116">Note that Rollback Custom Actions cannot run asynchronously.</span></span> <span data-ttu-id="f3960-117">Vea [acciones personalizadas sincrónicas y asincrónicas](synchronous-and-asynchronous-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="f3960-117">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span>

<span data-ttu-id="f3960-118">El complemento de una acción personalizada rollback es una [acción personalizada commit](commit-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="f3960-118">The complement to a rollback custom action is a [commit custom action](commit-custom-actions.md).</span></span> <span data-ttu-id="f3960-119">El instalador ejecuta una acción personalizada commit durante la secuencia de instalación, copia la acción personalizada en el script de reversión, pero no ejecuta la acción durante la reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-119">The installer executes a commit custom action during the installation sequence, copies the custom action into the rollback script, but does not execute the action during rollback.</span></span>

<span data-ttu-id="f3960-120">Tenga en cuenta que es posible que una acción personalizada de reversión no pueda quitar todos los cambios realizados por las acciones de confirmación personalizadas.</span><span class="sxs-lookup"><span data-stu-id="f3960-120">Note that a rollback custom action may not be able to remove all of the changes made by commit custom actions.</span></span> <span data-ttu-id="f3960-121">Aunque el instalador escribe las acciones personalizadas de reversión y confirmación en el script de reversión, la confirmación de acciones personalizadas solo se ejecuta después de que el instalador haya procesado correctamente el script de instalación.</span><span class="sxs-lookup"><span data-stu-id="f3960-121">Although the installer writes both rollback and commit custom actions into the rollback script, commit custom actions only run after the installer has successfully processed the installation script.</span></span> <span data-ttu-id="f3960-122">La confirmación de acciones personalizadas son las primeras acciones que se ejecutan en el script de reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-122">Commit custom actions are the first actions to run in the rollback script.</span></span> <span data-ttu-id="f3960-123">Si se produce un error en una acción personalizada commit, el instalador inicia la reversión, pero solo puede revertir las operaciones ya escritas en el script de reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-123">If a commit custom action fails, the installer initiates rollback but can only rollback those operations already written to the rollback script.</span></span> <span data-ttu-id="f3960-124">Esto significa que, dependiendo de la acción personalizada commit, es posible que una operación de reversión no pueda deshacer los cambios realizados por la acción.</span><span class="sxs-lookup"><span data-stu-id="f3960-124">This means that depending on the commit custom action, a rollback may not be able to undo the changes made by the action.</span></span> <span data-ttu-id="f3960-125">Puede omitir los errores en confirmar acciones personalizadas mediante la creación de la acción personalizada para omitir los códigos de retorno.</span><span class="sxs-lookup"><span data-stu-id="f3960-125">You can ignore failures in commit custom actions by authoring the custom action to ignore return codes.</span></span>

<span data-ttu-id="f3960-126">Cuando el instalador ejecuta una acción personalizada de reversión, el único parámetro de modo que se establecerá es MSIRUNMODE \_ ROLLBACK.</span><span class="sxs-lookup"><span data-stu-id="f3960-126">When the installer runs a rollback custom action, the only mode parameter it will set is MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="f3960-127">Consulte [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) para obtener una descripción de los parámetros de modo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="f3960-127">See [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) for a description of the run mode parameters.</span></span>

<span data-ttu-id="f3960-128">Se puede especificar una acción de reversión personalizada agregando una marca de opción al campo de tipo de la [tabla CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="f3960-128">A rollback custom action can be specified by adding an option flag to the Type field of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="f3960-129">Consulte [acción personalizada In-Script opciones de ejecución](custom-action-in-script-execution-options.md) para la marca de opción que designa una acción personalizada de reversión.</span><span class="sxs-lookup"><span data-stu-id="f3960-129">See [Custom Action In-Script Execution Options](custom-action-in-script-execution-options.md) for the option flag designating a rollback custom action.</span></span>

<span data-ttu-id="f3960-130">Las acciones personalizadas de reversión y confirmación no se ejecutan cuando la reversión está deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="f3960-130">Rollback and commit custom actions do not run when rollback is disabled.</span></span> <span data-ttu-id="f3960-131">Si un autor de paquetes requiere estos tipos de acciones personalizadas para una instalación adecuada, deben usar la propiedad [**RollbackDisabled**](rollbackdisabled.md) en una condición que impida que la instalación continúe cuando la reversión está deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="f3960-131">If a package author requires these types of custom actions for proper installation, they should use the [**RollbackDisabled**](rollbackdisabled.md) property in a condition that prevents the installation from continuing when rollback is disabled.</span></span> <span data-ttu-id="f3960-132">Para obtener información sobre cómo deshabilitar la reversión [, vea instalación de reversión (Windows Installer)](rollback-installation.md).</span><span class="sxs-lookup"><span data-stu-id="f3960-132">For information on how to disable rollback see [Rollback Installation (Windows Installer)](rollback-installation.md).</span></span>

 

 



