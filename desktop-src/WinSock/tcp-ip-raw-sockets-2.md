---
description: Un socket sin formato es un tipo de socket que permite el acceso al proveedor de transporte subyacente.
ms.assetid: 4cbe5505-75e7-454f-9e6b-f38bdc60bf6d
title: Sockets sin formato de TCP/IP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25cc08d59d80089a4e655f363e4a899edac8d2b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105715853"
---
# <a name="tcpip-raw-sockets"></a><span data-ttu-id="38dd4-103">Sockets sin formato de TCP/IP</span><span class="sxs-lookup"><span data-stu-id="38dd4-103">TCP/IP Raw Sockets</span></span>

<span data-ttu-id="38dd4-104">Un socket sin formato es un tipo de socket que permite el acceso al proveedor de transporte subyacente.</span><span class="sxs-lookup"><span data-stu-id="38dd4-104">A raw socket is a type of socket that allows access to the underlying transport provider.</span></span> <span data-ttu-id="38dd4-105">Este tema se centra únicamente en los sockets sin formato y los protocolos IPv4 e IPv6.</span><span class="sxs-lookup"><span data-stu-id="38dd4-105">This topic focuses only on raw sockets and the IPv4 and IPv6 protocols.</span></span> <span data-ttu-id="38dd4-106">Esto se debe a que la mayoría de los demás protocolos con la excepción de ATM no admiten Sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-106">This is because most other protocols with the exception of ATM do not support raw sockets.</span></span> <span data-ttu-id="38dd4-107">Para usar sockets sin formato, una aplicación debe tener información detallada sobre el protocolo subyacente que se está usando.</span><span class="sxs-lookup"><span data-stu-id="38dd4-107">To use raw sockets, an application needs to have detailed information on the underlying protocol being used.</span></span>

<span data-ttu-id="38dd4-108">Los proveedores de servicios Winsock para el protocolo IP pueden admitir un *tipo* de socket de **sock \_ raw**.</span><span class="sxs-lookup"><span data-stu-id="38dd4-108">Winsock service providers for the IP protocol may support a socket *type* of **SOCK\_RAW**.</span></span> <span data-ttu-id="38dd4-109">El proveedor de Windows Sockets 2 para TCP/IP incluido en Windows es compatible con este tipo de socket **\_ sin formato sock** .</span><span class="sxs-lookup"><span data-stu-id="38dd4-109">The Windows Sockets 2 provider for TCP/IP included on Windows supports this **SOCK\_RAW** socket type.</span></span>

<span data-ttu-id="38dd4-110">Existen dos tipos básicos de estos Sockets sin formato:</span><span class="sxs-lookup"><span data-stu-id="38dd4-110">There are two basic types of such raw sockets:</span></span>

-   <span data-ttu-id="38dd4-111">El primer tipo utiliza un tipo de protocolo conocido escrito en el encabezado IP reconocido por un proveedor de servicios Winsock.</span><span class="sxs-lookup"><span data-stu-id="38dd4-111">The first type uses a known protocol type written in the IP header that is recognized by a Winsock service provider.</span></span> <span data-ttu-id="38dd4-112">Un ejemplo del primer tipo de socket es un socket para el protocolo ICMP (protocolo IP tipo = 1) o el protocolo ICMPv6 (IP Procotol Type = 58).</span><span class="sxs-lookup"><span data-stu-id="38dd4-112">An example of the first type of socket is a socket for the ICMP protocol (IP protocol type = 1) or the ICMPv6 protocol (IP procotol type = 58).</span></span>
-   <span data-ttu-id="38dd4-113">El segundo tipo permite especificar cualquier tipo de protocolo.</span><span class="sxs-lookup"><span data-stu-id="38dd4-113">The second type allows any protocol type to be specified.</span></span> <span data-ttu-id="38dd4-114">Un ejemplo del segundo tipo sería un protocolo experimental que no es directamente compatible con el proveedor de servicios Winsock como el protocolo de transmisión de control de transmisión (SCTP).</span><span class="sxs-lookup"><span data-stu-id="38dd4-114">An example of the second type would be an experimental protocol that is not directly supported by the Winsock service provider such as the Stream Control Transmission Protocol (SCTP).</span></span>

## <a name="determining-if-raw-sockets-are-supported"></a><span data-ttu-id="38dd4-115">Determinar si se admiten Sockets sin formato</span><span class="sxs-lookup"><span data-stu-id="38dd4-115">Determining if Raw Sockets are Supported</span></span>

<span data-ttu-id="38dd4-116">Si un proveedor de servicios Winsock admite Sockets **\_ sin formato de sock** para las \_ familias de direcciones AF inet o AF \_ inet6, el tipo de socket de **sock \_ raw** debe estar incluido en la estructura [**WSAPROTOCOL \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) devuelta por la función [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) para uno o varios de los proveedores de transporte disponibles.</span><span class="sxs-lookup"><span data-stu-id="38dd4-116">If a Winsock service provider supports **SOCK\_RAW** sockets for the AF\_INET or AF\_INET6 address families, the socket type of **SOCK\_RAW** should be included in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure returned by [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) function for one or more of the available transport providers.</span></span>

<span data-ttu-id="38dd4-117">El miembro **iAddressFamily** de la estructura de [**\_ información de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) debe especificar AF \_ inet o AF \_ inet6 y el miembro **ISocketType** de la estructura **WSAPROTOCOL \_ info** debe especificar **sock \_ raw** para uno de los proveedores de transporte.</span><span class="sxs-lookup"><span data-stu-id="38dd4-117">The **iAddressFamily** member in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure should specify AF\_INET or AF\_INET6 and the **iSocketType** member of the **WSAPROTOCOL\_INFO** structure should specify **SOCK\_RAW** for one of the transport providers.</span></span>

<span data-ttu-id="38dd4-118">El miembro **iProtocol** de la estructura de [**\_ información de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) se puede establecer en **IPROTO \_ IP**.</span><span class="sxs-lookup"><span data-stu-id="38dd4-118">The **iProtocol** member of the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure may be set to **IPROTO\_IP**.</span></span> <span data-ttu-id="38dd4-119">El miembro **iProtocol** de la estructura de **\_ información de WSAPROTOCOL** también se puede establecer en cero si el proveedor de servicios permite que una aplicación use un tipo de socket **\_ sin formato sock** para otros protocolos de red distintos del Protocolo de Internet para la familia de direcciones.</span><span class="sxs-lookup"><span data-stu-id="38dd4-119">The **iProtocol** member of the **WSAPROTOCOL\_INFO** structure may also be set to zero if the service provider allows an application to use a **SOCK\_RAW** socket type for other network protocols other than the Internet Protocol for the address family.</span></span>

<span data-ttu-id="38dd4-120">Los demás miembros de la estructura [**WSAPROTOCOL \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) indican otras propiedades de la compatibilidad con el protocolo para **sock \_ raw** e indican cómo se debe tratar un socket de **sock \_ raw** .</span><span class="sxs-lookup"><span data-stu-id="38dd4-120">The other members in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure indicate other properties of the protocol support for **SOCK\_RAW** and indicate how a socket of **SOCK\_RAW** should be treated.</span></span> <span data-ttu-id="38dd4-121">Estos otros miembros de la **\_ información de WSAPROTOCOL** para **sock \_ raw** normalmente especifican que el protocolo es sin conexión, orientado a mensajes, admite difusión/multidifusión (el XP1 \_ de conexión sin conexión, XP1 \_ , de compatibilidad con XP1, y XP1 admiten \_ \_ \_ \_ \_ bits Multipoint se establecen en el miembro dwServiceFlags1) y pueden tener un tamaño máximo de mensaje de 65.467 bytes.</span><span class="sxs-lookup"><span data-stu-id="38dd4-121">These other members of the **WSAPROTOCOL\_INFO** for **SOCK\_RAW** normally specify that the protocol is connectionless, message-oriented, supports broadcast/multicast (the XP1\_CONNECTIONLESS, XP1\_MESSAGE\_ORIENTED, XP1\_SUPPORT\_BROADCAST, and XP1\_SUPPORT\_MULTIPOINT bits are set in the dwServiceFlags1 member), and can have a maximum message size of 65,467 bytes.</span></span>

<span data-ttu-id="38dd4-122">En Windows XP y versiones posteriores, se puede usar el comando *NetSh.exe* para determinar si se admiten Sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-122">On Windows XP and later, the *NetSh.exe* command can be used to determine if raw sockets are supported.</span></span> <span data-ttu-id="38dd4-123">El siguiente comando que se ejecuta desde una ventana de CMD mostrará los datos del catálogo de Winsock en la consola de:</span><span class="sxs-lookup"><span data-stu-id="38dd4-123">The following command run from a CMD window will display data from the Winsock catalog on the console:</span></span>

<span data-ttu-id="38dd4-124">**netsh winsock show Catalog**</span><span class="sxs-lookup"><span data-stu-id="38dd4-124">**netsh winsock show catalog**</span></span>

<span data-ttu-id="38dd4-125">El resultado incluirá una lista que contiene algunos de los datos de las estructuras de [**\_ información de WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) admitidas en el equipo local.</span><span class="sxs-lookup"><span data-stu-id="38dd4-125">The output will include a list that contains some of the data from the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span> <span data-ttu-id="38dd4-126">Busque el término RAW/IP o RAW/IPv6 en el campo Descripción para encontrar los protocolos que admiten Sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-126">Search for the term RAW/IP or RAW/IPv6 in the Description field to find those protocols that support raw sockets.</span></span>

## <a name="creating-a-raw-socket"></a><span data-ttu-id="38dd4-127">Creación de un socket sin formato</span><span class="sxs-lookup"><span data-stu-id="38dd4-127">Creating a Raw Socket</span></span>

<span data-ttu-id="38dd4-128">Para crear un socket de tipo **sock \_ raw**, llame a la función [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) o [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) con el parámetro *AF* (Family Address) establecido en AF \_ inet o AF \_ inet6, el parámetro de *tipo* establecido en **sock \_ raw** y el parámetro *Protocol* establecido en el número de protocolo requerido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-128">To create a socket of type **SOCK\_RAW**, call the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the *af* parameter (address family) set to AF\_INET or AF\_INET6, the *type* parameter set to **SOCK\_RAW**, and the *protocol* parameter set to the protocol number required.</span></span> <span data-ttu-id="38dd4-129">El parámetro de *Protocolo* se convierte en el valor de protocolo del encabezado IP (SCTP es 132, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="38dd4-129">The *protocol* parameter becomes the protocol value in the IP header (SCTP is 132, for example).</span></span>

> [!Note]  
> <span data-ttu-id="38dd4-130">Una aplicación no puede especificar cero (0) como parámetro de *Protocolo* para las funciones [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)y [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) si el parámetro de *tipo* se establece en **sock \_ raw**.</span><span class="sxs-lookup"><span data-stu-id="38dd4-130">An application may not specify zero (0) as the *protocol* parameter for the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa), and [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) functions if the *type* parameter is set to **SOCK\_RAW**.</span></span>

 

<span data-ttu-id="38dd4-131">Los sockets sin formato ofrecen la capacidad de manipular el transporte subyacente, por lo que se pueden utilizar con fines malintencionados que supongan una amenaza para la seguridad.</span><span class="sxs-lookup"><span data-stu-id="38dd4-131">Raw sockets offer the capability to manipulate the underlying transport, so they can be used for malicious purposes that pose a security threat.</span></span> <span data-ttu-id="38dd4-132">Por lo tanto, solo los miembros del grupo administradores pueden crear sockets de tipo SOCK \_ raw en Windows 2000 y versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="38dd4-132">Therefore, only members of the Administrators group can create sockets of type SOCK\_RAW on Windows 2000 and later.</span></span>

## <a name="send-and-receive-operations"></a><span data-ttu-id="38dd4-133">Operaciones de envío y recepción</span><span class="sxs-lookup"><span data-stu-id="38dd4-133">Send and Receive Operations</span></span>

<span data-ttu-id="38dd4-134">Una vez que una aplicación crea un socket de tipo **sock \_ raw**, este socket se puede usar para enviar y recibir datos.</span><span class="sxs-lookup"><span data-stu-id="38dd4-134">Once an application creates a socket of type **SOCK\_RAW**, this socket may be used to send and receive data.</span></span> <span data-ttu-id="38dd4-135">Todos los paquetes enviados o recibidos en un socket de tipo **sock \_ raw** se tratan como datagramas en un socket no conectado.</span><span class="sxs-lookup"><span data-stu-id="38dd4-135">All packets sent or received on a socket of type **SOCK\_RAW** are treated as datagrams on an unconnected socket.</span></span>

<span data-ttu-id="38dd4-136">Las siguientes reglas se aplican a las operaciones a través de sockets **\_ sin formato de sock** :</span><span class="sxs-lookup"><span data-stu-id="38dd4-136">The following rules apply to the operations over **SOCK\_RAW** sockets:</span></span>

-   <span data-ttu-id="38dd4-137">Normalmente, la función [**SendTo**](/windows/desktop/api/winsock/nf-winsock-sendto) o [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) se usa para enviar datos en un socket de tipo **sock \_ raw**.</span><span class="sxs-lookup"><span data-stu-id="38dd4-137">The [**sendto**](/windows/desktop/api/winsock/nf-winsock-sendto) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) function is normally used to send data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="38dd4-138">La dirección de destino puede ser cualquier dirección válida en la familia de direcciones del socket, incluida una dirección de difusión o multidifusión.</span><span class="sxs-lookup"><span data-stu-id="38dd4-138">The destination address can be any valid address in the socket's address family, including a broadcast or multicast address.</span></span> <span data-ttu-id="38dd4-139">Para enviar a una dirección de difusión, una aplicación debe haber [**usado la**](/windows/desktop/api/winsock/nf-winsock-setsockopt) opción de r con la \_ difusión habilitada.</span><span class="sxs-lookup"><span data-stu-id="38dd4-139">To send to a broadcast address, an application must have used [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) with SO\_BROADCAST enabled.</span></span> <span data-ttu-id="38dd4-140">De lo contrario, se producirá un error en **SendTo** o **WSASendTo** con el código de error [WSAEACCES](windows-sockets-error-codes-2.md).</span><span class="sxs-lookup"><span data-stu-id="38dd4-140">Otherwise, **sendto** or **WSASendTo** will fail with the error code [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="38dd4-141">Para IP, una aplicación puede enviar a cualquier dirección de multidifusión (sin convertirse en miembro del grupo).</span><span class="sxs-lookup"><span data-stu-id="38dd4-141">For IP, an application can send to any multicast address (without becoming a group member).</span></span>
-   <span data-ttu-id="38dd4-142">Al enviar datos IPv4, una aplicación tiene la opción de especificar el encabezado IPv4 al principio del datagrama saliente para el paquete.</span><span class="sxs-lookup"><span data-stu-id="38dd4-142">When sending IPv4 data, an application has a choice on whether to specify the IPv4 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="38dd4-143">Si la opción de socket **\_ HDRINCL de IP** está establecida en true para un socket IPv4 (familia de direcciones de AF \_ inet), la aplicación debe proporcionar el encabezado IPv4 en los datos salientes para las operaciones de envío.</span><span class="sxs-lookup"><span data-stu-id="38dd4-143">If the **IP\_HDRINCL** socket option is set to true for an IPv4 socket (address family of AF\_INET), the application must supply the IPv4 header in the outgoing data for send operations.</span></span> <span data-ttu-id="38dd4-144">Si esta opción de socket es false (el valor predeterminado), el encabezado IPv4 no debe incluir los datos salientes para las operaciones de envío.</span><span class="sxs-lookup"><span data-stu-id="38dd4-144">If this socket option is false (the default setting), then the IPv4 header should not be in included the outgoing data for send operations.</span></span>
-   <span data-ttu-id="38dd4-145">Al enviar datos IPv6, una aplicación tiene la opción de especificar el encabezado IPv6 al principio del datagrama saliente para el paquete.</span><span class="sxs-lookup"><span data-stu-id="38dd4-145">When sending IPv6 data, an application has a choice on whether to specify the IPv6 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="38dd4-146">Si la opción de socket **\_ HDRINCL de IPv6** está establecida en true para un socket IPv6 (familia de direcciones de AF \_ inet6), la aplicación debe proporcionar el encabezado IPv6 en los datos salientes para las operaciones de envío.</span><span class="sxs-lookup"><span data-stu-id="38dd4-146">If the **IPV6\_HDRINCL** socket option is set to true for an IPv6 socket (address family of AF\_INET6), the application must supply the IPv6 header in the outgoing data for send operations.</span></span> <span data-ttu-id="38dd4-147">El valor predeterminado de esta opción es false.</span><span class="sxs-lookup"><span data-stu-id="38dd4-147">The default setting for this option is false.</span></span> <span data-ttu-id="38dd4-148">Si esta opción de socket es false (el valor predeterminado), el encabezado IPv6 no debe incluirse en los datos salientes para las operaciones de envío.</span><span class="sxs-lookup"><span data-stu-id="38dd4-148">If this socket option is false (the default setting), then the IPv6 header should not be included in the outgoing data for send operations.</span></span> <span data-ttu-id="38dd4-149">En el caso de IPv6, no es necesario incluir el encabezado IPv6.</span><span class="sxs-lookup"><span data-stu-id="38dd4-149">For IPv6, there should be no need to include the IPv6 header.</span></span> <span data-ttu-id="38dd4-150">Si la información está disponible mediante las funciones de socket, el encabezado IPv6 no debe incluirse para evitar problemas de compatibilidad en el futuro.</span><span class="sxs-lookup"><span data-stu-id="38dd4-150">If information is available using socket functions, then the IPv6 header should not be included to avoid compatibility problems in the future.</span></span> <span data-ttu-id="38dd4-151">Estos problemas se describen en RFC 3542 publicado por IETF.</span><span class="sxs-lookup"><span data-stu-id="38dd4-151">These issues are discussed in RFC 3542 published by the IETF.</span></span> <span data-ttu-id="38dd4-152">No se recomienda usar la opción de socket **\_ HDRINCL de IPv6** y puede estar en desuso en el futuro.</span><span class="sxs-lookup"><span data-stu-id="38dd4-152">Using the **IPV6\_HDRINCL** socket option is not recommended and may be deprecated in future.</span></span>
-   <span data-ttu-id="38dd4-153">La función [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) o [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) se usa normalmente para recibir datos en un socket de tipo **sock \_ raw**.</span><span class="sxs-lookup"><span data-stu-id="38dd4-153">The [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) function is normally used to receive data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="38dd4-154">Ambas funciones tienen una opción para devolver la dirección IP de origen desde la que se envió el paquete.</span><span class="sxs-lookup"><span data-stu-id="38dd4-154">Both of these functions have an option to return the source IP address where the packet was sent from.</span></span> <span data-ttu-id="38dd4-155">Los datos recibidos son un datagrama de un socket no conectado.</span><span class="sxs-lookup"><span data-stu-id="38dd4-155">The received data is a datagram from an unconnected socket.</span></span>
-   <span data-ttu-id="38dd4-156">En el caso de IPv4 (familia de direcciones de AF \_ inet), una aplicación recibe el encabezado IP al principio de cada datagrama recibido, con independencia de la opción de socket **\_ HDRINCL de IP** .</span><span class="sxs-lookup"><span data-stu-id="38dd4-156">For IPv4 (address family of AF\_INET), an application receives the IP header at the front of each received datagram regardless of the **IP\_HDRINCL** socket option.</span></span>
-   <span data-ttu-id="38dd4-157">Para IPv6 (familia de direcciones de AF \_ inet6), una aplicación recibe todo después del último encabezado IPv6 en cada datagrama recibido, con independencia de la opción de socket **\_ HDRINCL de IPv6** .</span><span class="sxs-lookup"><span data-stu-id="38dd4-157">For IPv6 (address family of AF\_INET6), an application receives everything after the last IPv6 header in each received datagram regardless of the **IPV6\_HDRINCL** socket option.</span></span> <span data-ttu-id="38dd4-158">La aplicación no recibe ningún encabezado IPv6 que use un socket sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-158">The application does not receive any IPv6 headers using a raw socket.</span></span>
-   <span data-ttu-id="38dd4-159">Los datagramas recibidos se copian en todos los sockets **\_ sin formato de sock** que cumplen las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="38dd4-159">Received datagrams are copied into all **SOCK\_RAW** sockets that satisfy the following conditions:</span></span>

    -   <span data-ttu-id="38dd4-160">El número de protocolo especificado en el parámetro *Protocol* cuando se creó el socket debe coincidir con el número de protocolo del encabezado IP del datagrama recibido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-160">The protocol number specified in the *protocol* parameter when the socket was created should match the protocol number in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="38dd4-161">Si se define una dirección IP local para el socket, debe corresponderse con la dirección de destino especificada en el encabezado IP del datagrama recibido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-161">If a local IP address is defined for the socket, it should correspond to the destination address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="38dd4-162">Una aplicación puede especificar la dirección IP local llamando a la función [**BIND**](/windows/desktop/api/winsock/nf-winsock-bind) .</span><span class="sxs-lookup"><span data-stu-id="38dd4-162">An application may specify the local IP address by calling the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function.</span></span> <span data-ttu-id="38dd4-163">Si no se especifica ninguna dirección IP local para el socket, los datagramas se copian en el socket sin tener en consideración la dirección IP de destino en el encabezado IP del datagrama recibido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-163">If no local IP address is specified for the socket, the datagrams are copied into the socket regardless of the destination IP address in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="38dd4-164">Si se define una dirección externa para el socket, debe corresponderse con la dirección de origen tal y como se especifica en el encabezado IP del datagrama recibido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-164">If a foreign address is defined for the socket, it should correspond to the source address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="38dd4-165">Una aplicación puede especificar la dirección IP externa mediante una llamada a la función [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) o [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) .</span><span class="sxs-lookup"><span data-stu-id="38dd4-165">An application may specify the foreign IP address by calling the [**connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) or [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function.</span></span> <span data-ttu-id="38dd4-166">Si no se especifica ninguna dirección IP externa para el socket, los datagramas se copian en el socket sin tener en consideración la dirección IP de origen en el encabezado IP del datagrama recibido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-166">If no foreign IP address is specified for the socket, the datagrams are copied into the socket regardless of the source IP address in the IP header of the received datagram.</span></span>

<span data-ttu-id="38dd4-167">Es importante comprender que algunos sockets de tipo **sock \_ raw** pueden recibir muchos datagramas inesperados.</span><span class="sxs-lookup"><span data-stu-id="38dd4-167">It is important to understand that some sockets of type **SOCK\_RAW** may receive many unexpected datagrams.</span></span> <span data-ttu-id="38dd4-168">Por ejemplo, un programa PING puede crear un socket de tipo **sock \_ raw** para enviar solicitudes de eco ICMP y recibir respuestas.</span><span class="sxs-lookup"><span data-stu-id="38dd4-168">For example, a PING program may create a socket of type **SOCK\_RAW** to send ICMP echo requests and receive responses.</span></span> <span data-ttu-id="38dd4-169">Mientras la aplicación espera respuestas de eco ICMP, \_ es posible que también se entreguen a esta aplicación todos los demás mensajes ICMP (como el host ICMP inaccesible).</span><span class="sxs-lookup"><span data-stu-id="38dd4-169">While the application is expecting ICMP echo responses, all other ICMP messages (such as ICMP HOST\_UNREACHABLE) may also be delivered to this application.</span></span> <span data-ttu-id="38dd4-170">Además, si hay varios Sockets **\_ sin formato de sock** abiertos en un equipo al mismo tiempo, se pueden entregar los mismos datagramas a todos los sockets abiertos.</span><span class="sxs-lookup"><span data-stu-id="38dd4-170">Moreover, if several **SOCK\_RAW** sockets are open on a computer at the same time, the same datagrams may be delivered to all the open sockets.</span></span> <span data-ttu-id="38dd4-171">Una aplicación debe tener un mecanismo para reconocer los datagramas de interés y omitir todos los demás.</span><span class="sxs-lookup"><span data-stu-id="38dd4-171">An application must have a mechanism to recognize the datagrams of interest and to ignore all others.</span></span> <span data-ttu-id="38dd4-172">En el caso de un programa PING, tal mecanismo podría incluir inspeccionar el encabezado IP recibido para los identificadores únicos en el encabezado ICMP (el identificador de proceso de la aplicación, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="38dd4-172">For a PING program, such a mechanism might include inspecting the received IP header for unique identifiers in the ICMP header (the application's process ID, for example).</span></span>

> [!Note]  
> <span data-ttu-id="38dd4-173">Para usar un socket de tipo **sock \_ raw** , es necesario disponer de privilegios administrativos.</span><span class="sxs-lookup"><span data-stu-id="38dd4-173">To use a socket of type **SOCK\_RAW** requires administrative privileges.</span></span> <span data-ttu-id="38dd4-174">Los usuarios que ejecutan aplicaciones Winsock que utilizan Sockets sin formato deben ser miembros del grupo administradores en el equipo local; de lo contrario, las llamadas de socket sin formato producirán un error con el código [WSAEACCES](windows-sockets-error-codes-2.md).</span><span class="sxs-lookup"><span data-stu-id="38dd4-174">Users running Winsock applications that use raw sockets must be a member of the Administrators group on the local computer, otherwise raw socket calls will fail with an error code of [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="38dd4-175">En Windows Vista y versiones posteriores, el acceso a los sockets sin formato se aplica al crear el socket.</span><span class="sxs-lookup"><span data-stu-id="38dd4-175">On Windows Vista and later, access for raw sockets is enforced at socket creation.</span></span> <span data-ttu-id="38dd4-176">En versiones anteriores de Windows, el acceso a los sockets sin formato se aplica durante otras operaciones de socket.</span><span class="sxs-lookup"><span data-stu-id="38dd4-176">In earlier versions of Windows, access for raw sockets is enforced during other socket operations.</span></span>

 

## <a name="common-uses-of-raw-sockets"></a><span data-ttu-id="38dd4-177">Usos comunes de los sockets sin formato</span><span class="sxs-lookup"><span data-stu-id="38dd4-177">Common Uses of Raw Sockets</span></span>

<span data-ttu-id="38dd4-178">Un uso común de los sockets sin formato es la solución de problemas de las aplicaciones que necesitan examinar los paquetes IP y los encabezados en detalle.</span><span class="sxs-lookup"><span data-stu-id="38dd4-178">One common use of raw sockets are troubleshooting applications that need to examine IP packets and headers in detail.</span></span> <span data-ttu-id="38dd4-179">Por ejemplo, se puede usar un socket sin formato con el \_ ioctl SiO RCVALL para permitir que un socket reciba todos los paquetes IPv4 o IPv6 que pasan a través de una interfaz de red.</span><span class="sxs-lookup"><span data-stu-id="38dd4-179">For example, a raw socket can be used with the SIO\_RCVALL IOCTL to enable a socket to receive all IPv4 or IPv6 packets passing through a network interface.</span></span> <span data-ttu-id="38dd4-180">Para obtener más información, consulte la referencia de [**SiO \_ RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="38dd4-180">For more information, see the [**SIO\_RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) reference.</span></span>

## <a name="limitations-on-raw-sockets"></a><span data-ttu-id="38dd4-181">Limitaciones de los sockets sin formato</span><span class="sxs-lookup"><span data-stu-id="38dd4-181">Limitations on Raw Sockets</span></span>

<span data-ttu-id="38dd4-182">En Windows 7, Windows Vista, Windows XP con Service Pack 2 (SP2) y Windows XP con Service Pack 3 (SP3), la capacidad de enviar tráfico a través de sockets sin formato se ha restringido de varias maneras:</span><span class="sxs-lookup"><span data-stu-id="38dd4-182">On Windows 7, Windows Vista, Windows XP with Service Pack 2 (SP2), and Windows XP with Service Pack 3 (SP3), the ability to send traffic over raw sockets has been restricted in several ways:</span></span>

-   <span data-ttu-id="38dd4-183">No se pueden enviar datos TCP a través de sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-183">TCP data cannot be sent over raw sockets.</span></span>
-   <span data-ttu-id="38dd4-184">Los datagramas UDP con una dirección de origen no válida no se pueden enviar a través de sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-184">UDP datagrams with an invalid source address cannot be sent over raw sockets.</span></span> <span data-ttu-id="38dd4-185">La dirección de origen IP de cualquier datagrama UDP saliente debe existir en una interfaz de red o se debe quitar el datagrama.</span><span class="sxs-lookup"><span data-stu-id="38dd4-185">The IP source address for any outgoing UDP datagram must exist on a network interface or the datagram is dropped.</span></span> <span data-ttu-id="38dd4-186">Este cambio se realizó para limitar la capacidad de código malintencionado para crear ataques de denegación de servicio distribuidos y limita la capacidad de enviar paquetes suplantados (paquetes TCP/IP con una dirección IP de origen falsificada).</span><span class="sxs-lookup"><span data-stu-id="38dd4-186">This change was made to limit the ability of malicious code to create distributed denial-of-service attacks and limits the ability to send spoofed packets (TCP/IP packets with a forged source IP address).</span></span>
-   <span data-ttu-id="38dd4-187">No se permite una llamada a la función de [**enlace**](/windows/desktop/api/winsock/nf-winsock-bind) con un socket sin formato para el \_ protocolo TCP IPPROTO.</span><span class="sxs-lookup"><span data-stu-id="38dd4-187">A call to the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket for the IPPROTO\_TCP protocol is not allowed.</span></span>
    > [!Note]  
    > <span data-ttu-id="38dd4-188">La función de [**enlace**](/windows/desktop/api/winsock/nf-winsock-bind) con un socket sin formato se permite para otros protocolos ( \_ por ejemplo, IPPROTO IP, IPPROTO \_ UDP o IPPROTO \_ SCTP).</span><span class="sxs-lookup"><span data-stu-id="38dd4-188">The [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket is allowed for other protocols (IPPROTO\_IP, IPPROTO\_UDP, or IPPROTO\_SCTP, for example).</span></span>

     

<span data-ttu-id="38dd4-189">Estas restricciones anteriores no se aplican a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 ni a las versiones del sistema operativo anteriores a Windows XP con SP2.</span><span class="sxs-lookup"><span data-stu-id="38dd4-189">These above restrictions do not apply to Windows Server 2008 R2, Windows Server 2008 , Windows Server 2003, or to versions of the operating system earlier than Windows XP with SP2.</span></span>

> [!Note]  
> <span data-ttu-id="38dd4-190">La implementación de Microsoft de TCP/IP en Windows es capaz de abrir un socket UDP o TCP sin formato en función de las restricciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="38dd4-190">The Microsoft implementation of TCP/IP on Windows is capable of opening a raw UDP or TCP socket based on the above restrictions.</span></span> <span data-ttu-id="38dd4-191">Es posible que otros proveedores Winsock no admitan el uso de sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-191">Other Winsock providers may not support the use of raw sockets.</span></span>

 

<span data-ttu-id="38dd4-192">Existen otras limitaciones para las aplicaciones que usan un socket de tipo **sock \_ raw**.</span><span class="sxs-lookup"><span data-stu-id="38dd4-192">There are further limitations for applications that use a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="38dd4-193">Por ejemplo, todas las aplicaciones que escuchan un protocolo específico recibirán todos los paquetes recibidos para este protocolo.</span><span class="sxs-lookup"><span data-stu-id="38dd4-193">For example, all applications listening for a specific protocol will receive all packets received for this protocol.</span></span> <span data-ttu-id="38dd4-194">Es posible que esto no sea lo que se desea para varias aplicaciones que usan un protocolo.</span><span class="sxs-lookup"><span data-stu-id="38dd4-194">This may not be what is desired for multiple applications using a protocol.</span></span> <span data-ttu-id="38dd4-195">Esto tampoco es adecuado para las aplicaciones de alto rendimiento.</span><span class="sxs-lookup"><span data-stu-id="38dd4-195">This is also not suitable for high-performance applications.</span></span> <span data-ttu-id="38dd4-196">Para solucionar estos problemas, puede que sea necesario escribir un controlador de protocolo de red de Windows (controlador de dispositivo) para el protocolo de red específico.</span><span class="sxs-lookup"><span data-stu-id="38dd4-196">To get around these issues, it may be required to write a Windows network protocol driver (device driver) for the specific network protocol.</span></span> <span data-ttu-id="38dd4-197">En Windows Vista y versiones posteriores, Winsock kernel (WSK), se puede usar una nueva interfaz de programación de red en modo kernel independiente del transporte para escribir un controlador de protocolo de red.</span><span class="sxs-lookup"><span data-stu-id="38dd4-197">On Windows Vista and later, Winsock Kernel (WSK), a new transport-independent kernel mode Network Programming Interface can be used to write a network protocol driver.</span></span> <span data-ttu-id="38dd4-198">En Windows Server 2003 y versiones anteriores, se puede escribir un proveedor de Interfaz de controlador de transporte (TDI) y una DLL de aplicación auxiliar de Winsock para admitir el protocolo de red.</span><span class="sxs-lookup"><span data-stu-id="38dd4-198">On Windows Server 2003 and earlier, a Transport Driver Interface (TDI) provider and a Winsock helper DLL can be written to support the network protocol.</span></span> <span data-ttu-id="38dd4-199">Después, el protocolo de red se agregaría al catálogo Winsock como un protocolo admitido.</span><span class="sxs-lookup"><span data-stu-id="38dd4-199">The network protocol would then be added to the Winsock catalog as a supported protocol.</span></span> <span data-ttu-id="38dd4-200">Esto permite que varias aplicaciones abran Sockets para este protocolo específico y el controlador del dispositivo puede realizar un seguimiento de qué socket recibe paquetes y errores específicos.</span><span class="sxs-lookup"><span data-stu-id="38dd4-200">This allows multiple applications to open sockets for this specific protocol and the device driver can keep track of which socket receives specific packets and errors.</span></span> <span data-ttu-id="38dd4-201">Para obtener información sobre cómo escribir un proveedor de protocolo de red, vea las secciones sobre WSK y TDI en el kit de controladores de Windows (WDK).</span><span class="sxs-lookup"><span data-stu-id="38dd4-201">For information on writing a network protocol provider, see the sections on WSK and TDI in the Windows Driver Kit (WDK).</span></span>

<span data-ttu-id="38dd4-202">Las aplicaciones también deben tener en cuenta el impacto que la configuración de Firewall puede tener al enviar y recibir paquetes mediante Sockets sin formato.</span><span class="sxs-lookup"><span data-stu-id="38dd4-202">Applications also need to be aware of the impact that firewall settings may have on sending and receiving packets using raw sockets.</span></span>

 

 
