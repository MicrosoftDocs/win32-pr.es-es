---
description: Inicialización de contexto de cliente
ms.assetid: 0c8aad3e-e726-49ce-8fc9-94dbd60cc5cb
title: Inicialización de contexto de cliente
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 615ce5c157371f1ebfec685d6227bd11a1d76531
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155909"
---
# <a name="client-context-initialization"></a><span data-ttu-id="e9247-103">Inicialización de contexto de cliente</span><span class="sxs-lookup"><span data-stu-id="e9247-103">Client Context Initialization</span></span>

<span data-ttu-id="e9247-104">Para establecer una conexión segura, el cliente adquiere un identificador de [*credenciales*](/windows/desktop/SecGloss/c-gly) de salida antes de enviar una solicitud de autenticación al servidor.</span><span class="sxs-lookup"><span data-stu-id="e9247-104">To establish a secure connection, the client acquires an outbound [*credentials*](/windows/desktop/SecGloss/c-gly) handle before sending an authentication request to the server.</span></span> <span data-ttu-id="e9247-105">El servidor crea un contexto de seguridad para el cliente desde la solicitud de autenticación.</span><span class="sxs-lookup"><span data-stu-id="e9247-105">The server creates a security context for the client from the authentication request.</span></span> <span data-ttu-id="e9247-106">Hay dos funciones SSPI del lado cliente implicadas en la configuración de la autenticación:</span><span class="sxs-lookup"><span data-stu-id="e9247-106">There are two client-side SSPI functions involved in authentication setup:</span></span>

-   <span data-ttu-id="e9247-107">[**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) obtiene una referencia a [*las credenciales*](/windows/desktop/SecGloss/c-gly)de inicio de sesión obtenidas previamente.</span><span class="sxs-lookup"><span data-stu-id="e9247-107">[**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) obtains a reference to previously obtained logon [*credentials*](/windows/desktop/SecGloss/c-gly).</span></span>
-   <span data-ttu-id="e9247-108">[**InitializeSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) crea los tokens de seguridad de la solicitud de autenticación inicial.</span><span class="sxs-lookup"><span data-stu-id="e9247-108">[**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) creates the initial authentication request security tokens.</span></span>

<span data-ttu-id="e9247-109">El código de este proceso puede verse en la función **GenClientContext** en el [uso de SSPI con un cliente de Windows Sockets](using-sspi-with-a-windows-sockets-client.md).</span><span class="sxs-lookup"><span data-stu-id="e9247-109">Code for this process can be seen in the **GenClientContext** function in [Using SSPI with a Windows Sockets Client](using-sspi-with-a-windows-sockets-client.md).</span></span>

<span data-ttu-id="e9247-110">Si un programa cliente necesita usar credenciales además de sus propias credenciales de inicio de sesión, como un nombre de usuario, un nombre de dominio y una contraseña diferentes, las proporciona en la llamada [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) con una estructura de [**identidad de \_ \_ autenticación \_ de WinNT**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) de la SEC que especifica las credenciales adicionales.</span><span class="sxs-lookup"><span data-stu-id="e9247-110">If a client program needs to use credentials in addition to its own logon credentials, such as a different user name, domain name, and password, it provides them in the [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) call with a [**SEC\_WINNT\_AUTH\_IDENTITY**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) structure specifying the additional credentials.</span></span> <span data-ttu-id="e9247-111">Para obtener más información sobre las funciones de credenciales, vea [Administración de credenciales](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="e9247-111">For more information on credentials functions, see [Credential Management](authentication-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="e9247-112">El miembro **Flags** de la estructura de [**identidad de \_ \_ autenticación \_ de WinNT**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) de la SEC se puede establecer en sec \_ autenticación de \_ autenticación \_ \_ ANSI ANSI cuando las cadenas de la estructura son ASCI o OEM.</span><span class="sxs-lookup"><span data-stu-id="e9247-112">The **Flags** member of the [**SEC\_WINNT\_AUTH\_IDENTITY**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) structure can be set to SEC\_WINNT\_AUTH\_IDENTITY\_ANSI when strings in the structure are ASCI or OEM.</span></span> <span data-ttu-id="e9247-113">Las cadenas ANSI se pueden usar con el miembro **Flags** de la estructura de **\_ identidad de \_ autenticación \_ de WinNT** de la SEC establecida en sec \_ WinNT \_ Authentication \_ Identity \_ Unicode si primero se convierten a [*Unicode*](/windows/desktop/SecGloss/u-gly) mediante la función [**MultiByteToWideChar**](/windows/desktop/api/stringapiset/nf-stringapiset-multibytetowidechar) .</span><span class="sxs-lookup"><span data-stu-id="e9247-113">ANSI strings can be used with the **Flags** member of the **SEC\_WINNT\_AUTH\_IDENTITY** structure set to SEC\_WINNT\_AUTH\_IDENTITY\_UNICODE if they are first converted to [*Unicode*](/windows/desktop/SecGloss/u-gly) by using the [**MultiByteToWideChar**](/windows/desktop/api/stringapiset/nf-stringapiset-multibytetowidechar) function.</span></span>

 

<span data-ttu-id="e9247-114">Para iniciar el primer segmento de la autenticación, el cliente llama a [**InitializeSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) para obtener un token de seguridad inicial que se va a enviar en un mensaje de solicitud de conexión al servidor.</span><span class="sxs-lookup"><span data-stu-id="e9247-114">To initiate the first leg of the authentication, the client calls [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) to obtain an initial security token to be sent in a connection request message to the server.</span></span>

<span data-ttu-id="e9247-115">El cliente utiliza la información del token de seguridad recibida en el descriptor del búfer de salida para generar un mensaje que se enviará al servidor.</span><span class="sxs-lookup"><span data-stu-id="e9247-115">The client uses the security token information received in the output buffer descriptor to generate a message to send to the server.</span></span> <span data-ttu-id="e9247-116">La construcción del mensaje, en lo que se refiere a la ubicación de varios búferes, etc., forma parte del [*Protocolo de aplicación*](/windows/desktop/SecGloss/a-gly) y debe ser entendida por ambas partes.</span><span class="sxs-lookup"><span data-stu-id="e9247-116">The construction of the message, in terms of placement of various buffers and so forth, is part of the [*application protocol*](/windows/desktop/SecGloss/a-gly) and must be understood by both parties.</span></span>

<span data-ttu-id="e9247-117">El cliente comprueba el estado de devolución de [**InitializeSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) para ver si la autenticación se completará en una sola llamada.</span><span class="sxs-lookup"><span data-stu-id="e9247-117">The client checks the return status from [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) to see if authentication will complete in a single call.</span></span> <span data-ttu-id="e9247-118">Un estado de devolución de los segundos \_ que se \_ siguen siendo \_ necesarios indica que el protocolo de seguridad requiere varios mensajes de autenticación.</span><span class="sxs-lookup"><span data-stu-id="e9247-118">A return status of SEC\_I\_CONTINUE\_NEEDED indicates that the security protocol requires multiple authentication messages.</span></span> <span data-ttu-id="e9247-119">Para obtener más información sobre las funciones de contexto, consulte [Administración de contexto](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="e9247-119">For more information on context functions, see [Context Management](authentication-functions.md).</span></span>

 

 
