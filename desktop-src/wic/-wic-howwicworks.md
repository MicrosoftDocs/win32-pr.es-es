---
description: Más información acerca de cómo funciona el componente de creación de imágenes de Windows
ms.assetid: c233e25b-bec6-4e67-8fbf-2bf9b70c7522
title: Cómo funciona el componente de creación de imágenes de Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bc9fe31ae4346f2c2d1f0b273e78ed10a0ec7e6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "103815470"
---
# <a name="how-the-windows-imaging-component-works"></a><span data-ttu-id="ba320-103">Cómo funciona el componente de creación de imágenes de Windows</span><span class="sxs-lookup"><span data-stu-id="ba320-103">How the Windows Imaging Component Works</span></span>

<span data-ttu-id="ba320-104">Este tema contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="ba320-104">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="ba320-105">Detección y arbitraje</span><span class="sxs-lookup"><span data-stu-id="ba320-105">Discovery and Arbitration</span></span>](#discovery-and-arbitration)
-   [<span data-ttu-id="ba320-106">Descodificación</span><span class="sxs-lookup"><span data-stu-id="ba320-106">Decoding</span></span>](#decoding)
-   [<span data-ttu-id="ba320-107">Encoding</span><span class="sxs-lookup"><span data-stu-id="ba320-107">Encoding</span></span>](#encoding)
-   [<span data-ttu-id="ba320-108">La duración de un códec</span><span class="sxs-lookup"><span data-stu-id="ba320-108">The Lifetime of a Codec</span></span>](#the-lifetime-of-a-codec)
-   [<span data-ttu-id="ba320-109">Cómo habilitar un códec con WIC</span><span class="sxs-lookup"><span data-stu-id="ba320-109">How to WIC-enabled a Codec</span></span>](#how-to-wic-enabled-a-codec)
-   [<span data-ttu-id="ba320-110">Compatibilidad con apartamento multiproceso en WIC</span><span class="sxs-lookup"><span data-stu-id="ba320-110">Multi-Threaded Apartment Support in WIC</span></span>](#multi-threaded-apartment-support-in-wic)
-   [<span data-ttu-id="ba320-111">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="ba320-111">Related topics</span></span>](#related-topics)

## <a name="discovery-and-arbitration"></a><span data-ttu-id="ba320-112">Detección y arbitraje</span><span class="sxs-lookup"><span data-stu-id="ba320-112">Discovery and Arbitration</span></span>

<span data-ttu-id="ba320-113">Antes de que se pueda descodificar una imagen, se debe encontrar un códec adecuado que pueda descodificar ese formato de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-113">Before an image can be decoded, an appropriate codec must be found that can decode that image format.</span></span> <span data-ttu-id="ba320-114">En la mayoría de los sistemas, dado que los formatos de imagen admitidos están codificados de forma rígida, no se requiere ningún proceso de detección.</span><span class="sxs-lookup"><span data-stu-id="ba320-114">In most systems, because the supported image formats are hard-coded, no discovery process is required.</span></span> <span data-ttu-id="ba320-115">Dado que la plataforma de componentes de imágenes de Windows (WIC) es extensible, es necesario poder identificar el formato de una imagen y hacerla coincidir con un códec adecuado.</span><span class="sxs-lookup"><span data-stu-id="ba320-115">Because the Windows Imaging Component (WIC) platform is extensible, it’s necessary to be able to identify the format of an image and match it with an appropriate codec.</span></span>

<span data-ttu-id="ba320-116">Para admitir la detección en tiempo de ejecución, cada formato de imagen debe tener un patrón de identificación que se pueda usar para identificar el descodificador adecuado para ese formato.</span><span class="sxs-lookup"><span data-stu-id="ba320-116">To support run-time discovery, each image format must have an identifying pattern that can be used to identify the appropriate decoder for that format.</span></span> <span data-ttu-id="ba320-117">(Se recomienda encarecidamente que, para los nuevos formatos de archivo, use un GUID para el patrón de identificación, ya que se garantiza que es único). El patrón de identificación debe estar incrustado en cada archivo de imagen que se ajuste a ese formato de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-117">(It is strongly recommended that, for new file formats, you use a GUID for the identifying pattern, because it is guaranteed to be unique.) The identifying pattern must be embedded in each image file that conforms to that image format.</span></span> <span data-ttu-id="ba320-118">Cada descodificador tiene una entrada del registro que especifica el patrón de identificación o patrones de los formatos de imagen que puede descodificar.</span><span class="sxs-lookup"><span data-stu-id="ba320-118">Each decoder has a registry entry that specifies the identifying pattern or patterns of the image formats it can decode.</span></span> <span data-ttu-id="ba320-119">Cuando una aplicación necesita abrir una imagen, solicita un descodificador de WIC.</span><span class="sxs-lookup"><span data-stu-id="ba320-119">When an application needs to open an image, it requests a decoder from WIC.</span></span> <span data-ttu-id="ba320-120">WIC busca los descodificadores disponibles en el registro y comprueba cada entrada del registro en busca de un patrón de identificación que coincida con el patrón incrustado en el archivo de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-120">WIC looks up the available decoders in the registry, and checks each registry entry for an identifying pattern that matches the pattern embedded in the image file.</span></span> <span data-ttu-id="ba320-121">Para obtener más información sobre las entradas del registro del descodificador, consulte [entradas del registro específicas del codificador](-wic-decoderregentries.md) .</span><span class="sxs-lookup"><span data-stu-id="ba320-121">For more information on decoder registry entries, see [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="ba320-122">Cuando WIC encuentra un único descodificador que coincide con el patrón de identificación de la imagen, crea una instancia del descodificador y le pasa el archivo de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-122">When WIC finds a single decoder that matches the identifying pattern in the image, it creates an instance of the decoder and passes the image file to it.</span></span> <span data-ttu-id="ba320-123">Si WIC encuentra más de una coincidencia, invoca un método denominado [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) en cada descodificador coincidente para arbitrar entre ellos y encontrar la mejor coincidencia.</span><span class="sxs-lookup"><span data-stu-id="ba320-123">If WIC finds more than one match, it invokes a method called [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) on each matching decoder to arbitrate among them and find the best match.</span></span> <span data-ttu-id="ba320-124">Para obtener más información, vea la sección [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) en el tema sobre la [implementación de IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="ba320-124">For more information, see the [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) section in the [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span></span>

## <a name="decoding"></a><span data-ttu-id="ba320-125">Descodificación</span><span class="sxs-lookup"><span data-stu-id="ba320-125">Decoding</span></span>

<span data-ttu-id="ba320-126">Una vez que se ha seleccionado el descodificador adecuado y se ha creado una instancia, la aplicación se comunica directamente con el descodificador.</span><span class="sxs-lookup"><span data-stu-id="ba320-126">After the appropriate decoder has been selected and instantiated, the application talks directly to the decoder.</span></span> <span data-ttu-id="ba320-127">El descodificador tiene varias responsabilidades, que implementa a través de varias interfaces.</span><span class="sxs-lookup"><span data-stu-id="ba320-127">The decoder has several responsibilities, which it implements through various interfaces.</span></span> <span data-ttu-id="ba320-128">Estos servicios se pueden clasificar como:</span><span class="sxs-lookup"><span data-stu-id="ba320-128">These services can be classified as:</span></span>

-   <span data-ttu-id="ba320-129">Servicios de nivel de contenedor</span><span class="sxs-lookup"><span data-stu-id="ba320-129">Container-level services</span></span>
-   <span data-ttu-id="ba320-130">Servicios de nivel de marco</span><span class="sxs-lookup"><span data-stu-id="ba320-130">Frame-level services</span></span>
-   <span data-ttu-id="ba320-131">Servicios de enumeración de metadatos</span><span class="sxs-lookup"><span data-stu-id="ba320-131">Metadata enumeration services</span></span>
-   <span data-ttu-id="ba320-132">Transformaciones nativas del descodificador</span><span class="sxs-lookup"><span data-stu-id="ba320-132">Native decoder transforms</span></span>
-   <span data-ttu-id="ba320-133">Notificaciones de progreso y compatibilidad de cancelación</span><span class="sxs-lookup"><span data-stu-id="ba320-133">Progress notifications and cancellation support</span></span>
-   <span data-ttu-id="ba320-134">Servicios de procesamiento sin procesar</span><span class="sxs-lookup"><span data-stu-id="ba320-134">Raw processing services</span></span>

<span data-ttu-id="ba320-135">Los servicios de nivel de contenedor incluyen la recuperación de la miniatura de nivel superior (si se admite), la vista previa, los contextos de color, la paleta (si es aplicable) y el formato de contenedor, así como proporcionar acceso a los fotogramas de imagen individuales dentro del contenedor.</span><span class="sxs-lookup"><span data-stu-id="ba320-135">Container-level services include retrieving the top-level thumbnail (if supported), preview, color contexts, palette (if applicable), and container format, as well as providing access to the individual image frames within the container.</span></span> <span data-ttu-id="ba320-136">(Algunos contenedores contienen un solo fotograma, mientras que otros, como Tagged Image File Format (TIFF), pueden contener varios fotogramas). Este conjunto de servicios también incluye proporcionar información sobre el propio descodificador y sus capacidades con respecto a un archivo de imagen específico.</span><span class="sxs-lookup"><span data-stu-id="ba320-136">(Some containers contain only a single frame while others, such as Tagged Image File Format (TIFF), can contain multiple frames.) This set of services also includes providing information about the decoder itself, and its capabilities with respect to a specific image file.</span></span>

<span data-ttu-id="ba320-137">Los fotogramas individuales tienen sus propias miniaturas y también pueden tener sus propios contextos de color, paletas y otras propiedades, que se exponen en el nivel de marco.</span><span class="sxs-lookup"><span data-stu-id="ba320-137">Individual frames have their own thumbnails, and may also have their own color contexts, palettes, and other properties, which are exposed at the frame level.</span></span> <span data-ttu-id="ba320-138">Sin embargo, la operación más importante realizada en el nivel de marco es la descodificación real de los bits de imagen para ese marco.</span><span class="sxs-lookup"><span data-stu-id="ba320-138">The most important operation performed at the frame level, though, is the actual decoding of the image bits for that frame.</span></span>

<span data-ttu-id="ba320-139">WIC proporciona a los lectores de metadatos los formatos de metadatos más comunes (IFD, EXIF, IPTC, XMP, APP0, APP1 y otros formatos) y también admite la extensibilidad para formatos de metadatos de terceros.</span><span class="sxs-lookup"><span data-stu-id="ba320-139">WIC provides metadata readers for the most common metadata formats (IFD, EXIF, IPTC, XMP, APP0, APP1, and other formats), and also supports extensibility for third-party metadata formats.</span></span> <span data-ttu-id="ba320-140">Esto libera el códec de la responsabilidad de analizar los metadatos.</span><span class="sxs-lookup"><span data-stu-id="ba320-140">This frees the codec of the responsibility for parsing metadata.</span></span> <span data-ttu-id="ba320-141">Sin embargo, el códec es responsable de enumerar los bloques de metadatos y de solicitar un lector de metadatos para cada bloque.</span><span class="sxs-lookup"><span data-stu-id="ba320-141">However, the codec is responsible for enumerating the metadata blocks and requesting a metadata reader for each block.</span></span> <span data-ttu-id="ba320-142">WIC realiza la detección de los controladores de metadatos de la misma manera que lo hace para los códecs, basándose en un patrón del encabezado de bloque que coincide con un patrón en la entrada del registro del controlador de metadatos.</span><span class="sxs-lookup"><span data-stu-id="ba320-142">WIC performs discovery for metadata handlers the same way it does for codecs, based on a pattern in the block header matching a pattern in the metadata handler’s registry entry.</span></span> <span data-ttu-id="ba320-143">Para obtener más información, consulte las [entradas del registro específicas del codificador](-wic-decoderregentries.md) .</span><span class="sxs-lookup"><span data-stu-id="ba320-143">For more information, see the [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="ba320-144">No es necesario que los descodificadores admitan de forma nativa las operaciones de transformación, pero esto permite optimizaciones de rendimiento significativas que proporcionan una mejor experiencia de usuario final.</span><span class="sxs-lookup"><span data-stu-id="ba320-144">Decoders are not required to natively support transform operations, but doing so enables significant performance optimizations that provide a better end-user experience.</span></span> <span data-ttu-id="ba320-145">Por ejemplo, una aplicación puede crear una canalización de varias transformaciones (escalado, recorte, rotación y conversión de formato de píxeles) para realizar en una imagen antes de que se represente la imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-145">For example, an application can create a pipeline of various transforms (scaling, cropping, rotation, and pixel format conversion) to perform on an image before the image is rendered.</span></span> <span data-ttu-id="ba320-146">Para obtener más información sobre las canalizaciones de transformación, vea [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span><span class="sxs-lookup"><span data-stu-id="ba320-146">For more information on transform pipelines, see [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span></span> <span data-ttu-id="ba320-147">Después de crear una canalización de transformación, la aplicación solicita la transformación final de la canalización para generar el mapa de bits que se obtiene al aplicar todas las transformaciones al origen de la imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-147">After creating a transform pipeline, the application requests the final transform in the pipeline to produce the bitmap that results from applying all the transforms to the image source.</span></span> <span data-ttu-id="ba320-148">En ese momento, si el propio descodificador puede realizar operaciones de transformación, WIC pregunta cuál de las transformaciones solicitadas puede realizar.</span><span class="sxs-lookup"><span data-stu-id="ba320-148">At that point, if the decoder itself is able to perform transform operations, WIC asks which of the requested transforms it can perform.</span></span> <span data-ttu-id="ba320-149">Las transformaciones solicitadas que no pueda realizar el descodificador se realizarán mediante WIC en la imagen descodificada antes de devolverla al autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="ba320-149">Any requested transforms the decoder cannot perform will be performed by WIC on the decoded image before returning it to the caller.</span></span> <span data-ttu-id="ba320-150">Esta canalización de transformación optimizada proporciona un mejor rendimiento que la realización de cada transformación secuencialmente en la memoria, especialmente cuando algunas o todas las transformaciones se pueden realizar durante el proceso de descodificación.</span><span class="sxs-lookup"><span data-stu-id="ba320-150">This optimized transform pipeline provides better performance than performing each transform sequentially in memory, particularly when some or all of the transforms can be accomplished during the decoding process.</span></span>

<span data-ttu-id="ba320-151">Las notificaciones de progreso y la compatibilidad con la cancelación permiten que una aplicación solicite notificaciones de progreso para las operaciones largas y también permite a la aplicación ofrecer al usuario la posibilidad de cancelar una operación que está tardando demasiado tiempo.</span><span class="sxs-lookup"><span data-stu-id="ba320-151">Progress notifications and cancellation support enable an application to request progress notifications for lengthy operations, and also enable the application to give the user an opportunity to cancel an operation that is taking too long.</span></span> <span data-ttu-id="ba320-152">Esto es importante porque si un usuario no puede cancelar una operación, puede sentir que el proceso se ha bloqueado e intentar cancelarlo cerrando la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba320-152">This is important because if a user cannot cancel an operation, he or she may feel the process has hung, and try to cancel it by closing the application.</span></span>

<span data-ttu-id="ba320-153">Estas interfaces se describen en detalle en la sección sobre la [implementación de un descodificador de WIC-Enabled](-wic-implementingwicdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="ba320-153">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Decoder](-wic-implementingwicdecoder.md).</span></span>

<span data-ttu-id="ba320-154">Los servicios de procesamiento sin formato incluyen el ajuste de la configuración de la cámara, como la exposición, el contraste y el enfoque, o el cambio del espacio de colores antes de procesar los bits sin formato.</span><span class="sxs-lookup"><span data-stu-id="ba320-154">Raw processing services include adjusting camera settings, such as exposure, contrast, and sharpening, or changing the color space before processing the raw bits.</span></span>

## <a name="encoding"></a><span data-ttu-id="ba320-155">Encoding</span><span class="sxs-lookup"><span data-stu-id="ba320-155">Encoding</span></span>

<span data-ttu-id="ba320-156">Al igual que los descodificadores, los codificadores tienen responsabilidades que implementan a través de interfaces.</span><span class="sxs-lookup"><span data-stu-id="ba320-156">Like decoders, encoders have responsibilities that they implement through interfaces.</span></span> <span data-ttu-id="ba320-157">Los servicios que proporcionan los codificadores son complementarios a los servicios proporcionados por los descodificadores, salvo que escriben datos de imagen en lugar de leerlo.</span><span class="sxs-lookup"><span data-stu-id="ba320-157">The services that encoders provide are complementary to the services provided by decoders, except they write out image data rather than reading it.</span></span> <span data-ttu-id="ba320-158">Los codificadores también proporcionan servicios en las siguientes categorías:</span><span class="sxs-lookup"><span data-stu-id="ba320-158">Encoders also provide services in the following categories:</span></span>

-   <span data-ttu-id="ba320-159">Servicios de nivel de contenedor</span><span class="sxs-lookup"><span data-stu-id="ba320-159">Container-level services</span></span>
-   <span data-ttu-id="ba320-160">Servicios de nivel de marco</span><span class="sxs-lookup"><span data-stu-id="ba320-160">Frame-level services</span></span>
-   <span data-ttu-id="ba320-161">Enumeración de metadatos y servicios de actualización</span><span class="sxs-lookup"><span data-stu-id="ba320-161">Metadata enumeration and update services</span></span>
-   <span data-ttu-id="ba320-162">Compatibilidad con notificaciones de progreso y cancelación</span><span class="sxs-lookup"><span data-stu-id="ba320-162">Progress notification and cancellation support</span></span>

<span data-ttu-id="ba320-163">Los servicios de nivel de contenedor para un codificador incluyen el establecimiento de la miniatura de nivel superior (si se admite), la vista previa y la paleta (si es aplicable) y la iteración por los fotogramas de imagen individuales para que se puedan serializar en el contenedor.</span><span class="sxs-lookup"><span data-stu-id="ba320-163">Container-level services for an encoder include setting the top-level thumbnail (if supported), preview, and palette (if applicable), and iterating through the individual image frames so they can be serialized into the container.</span></span>

<span data-ttu-id="ba320-164">Los servicios de nivel de marco de un codificador reflejan los del descodificador, salvo que escriben los datos de imagen, la miniatura y cualquier paleta asociada u otro componente, en lugar de leerlos.</span><span class="sxs-lookup"><span data-stu-id="ba320-164">Frame-level services for an encoder mirror those for the decoder, except that they write out the image data, thumbnail, and any associated palette or other component, rather than reading them.</span></span>

<span data-ttu-id="ba320-165">Además, los servicios de enumeración de metadatos para un codificador incluyen la iteración por los bloques de metadatos que se van a escribir y la invocación de los escritores de metadatos adecuados para serializar los metadatos en el disco.</span><span class="sxs-lookup"><span data-stu-id="ba320-165">Also, metadata enumeration services for an encoder include iterating through the metadata blocks to be written, and invoking the appropriate metadata writers to serialize the metadata to disk.</span></span>

<span data-ttu-id="ba320-166">Estas interfaces se describen en detalle en la sección sobre la [implementación de un codificador de WIC-Enabled](-wic-implementingwicencoder.md).</span><span class="sxs-lookup"><span data-stu-id="ba320-166">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Encoder](-wic-implementingwicencoder.md).</span></span>

## <a name="the-lifetime-of-a-codec"></a><span data-ttu-id="ba320-167">La duración de un códec</span><span class="sxs-lookup"><span data-stu-id="ba320-167">The Lifetime of a Codec</span></span>

<span data-ttu-id="ba320-168">Se crea una instancia de un códec WIC para controlar una sola imagen y, normalmente, tiene una duración breve.</span><span class="sxs-lookup"><span data-stu-id="ba320-168">A WIC codec is instantiated to handle a single image, and usually has a short lifetime.</span></span> <span data-ttu-id="ba320-169">Se crea cuando se carga una imagen y se libera cuando se cierra la imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-169">It’s created when an image is loaded and is released when the image is closed.</span></span> <span data-ttu-id="ba320-170">Una aplicación puede usar un gran número de códecs simultáneamente con una duración de superposición (es decir, desplazarse a través de un directorio que contenga cientos de imágenes) y varias aplicaciones pueden hacerlo al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="ba320-170">An application may use a large number of codecs simultaneously with overlapping lifetimes (think of scrolling through a directory containing hundreds of images), and multiple applications may be doing this at the same time.</span></span>

<span data-ttu-id="ba320-171">Aunque algunos códecs tienen una duración cuyo ámbito es la duración del proceso en el que residen, este no es el caso de los códecs WIC.</span><span class="sxs-lookup"><span data-stu-id="ba320-171">Although some codecs have a lifetime that is scoped to the lifetime of the process in which they live, this is not the case with WIC codecs.</span></span> <span data-ttu-id="ba320-172">La Galería fotográfica de Windows Vista, el explorador de Windows y el visor fotográfico, así como otras muchas aplicaciones, se basan en WIC y usarán el códec para mostrar imágenes y miniaturas.</span><span class="sxs-lookup"><span data-stu-id="ba320-172">The Windows Vista Photo Gallery, Windows Explorer, and Photo Viewer, as well as numerous other applications, are built on WIC and will be using your codec to display images and thumbnails.</span></span> <span data-ttu-id="ba320-173">Si el ámbito de la duración del códec es la duración del proceso, cada vez que se muestra una imagen o una miniatura en el explorador de Windows Vista, el códec del que se ha creado una instancia para descodificar esa imagen permanecerá en memoria hasta la próxima vez que el usuario reinicie su equipo.</span><span class="sxs-lookup"><span data-stu-id="ba320-173">If the lifetime of your codec were scoped to the lifetime of the process, every time an image or thumbnail was displayed in the Windows Vista Explorer, the codec instantiated to decode that image would remain in memory until the next time the user restarted his or her computer.</span></span> <span data-ttu-id="ba320-174">Si el códec nunca está descargado, sus recursos están, en efecto, "filtrados" porque no se pueden usar en ningún otro componente del sistema.</span><span class="sxs-lookup"><span data-stu-id="ba320-174">If your codec is never unloaded, its resources are, in effect, "leaked" because they can't be used by any other component in the system.</span></span>

## <a name="how-to-wic-enabled-a-codec"></a><span data-ttu-id="ba320-175">Cómo habilitar un códec con WIC</span><span class="sxs-lookup"><span data-stu-id="ba320-175">How to WIC-enabled a Codec</span></span>

1.  <span data-ttu-id="ba320-176">Implemente una clase de descodificador de nivel de contenedor y una clase de descodificador de nivel de marco que exponga las interfaces WIC necesarias para descodificar imágenes y recorrer en iteración los bloques de metadatos.</span><span class="sxs-lookup"><span data-stu-id="ba320-176">Implement a container-level decoder class and a frame-level decoder class that exposes the required WIC interfaces for decoding images and iterating through blocks of metadata.</span></span> <span data-ttu-id="ba320-177">Esto permite que todas las aplicaciones basadas en WIC interactúen con el códec de la misma manera que interactúan con los formatos de imagen estándar.</span><span class="sxs-lookup"><span data-stu-id="ba320-177">This enables all WIC-based applications to interact with your codec the same way they interact with standard image formats.</span></span>
2.  <span data-ttu-id="ba320-178">Implemente una clase de codificador de nivel de contenedor y una clase de codificador de nivel de marco que exponga las interfaces WIC necesarias para codificar imágenes y serializar bloques de metadatos en un archivo de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-178">Implement a container-level encoder class and a frame-level encoder class that exposes the required WIC interfaces for encoding images and serializing blocks of metadata into an image file.</span></span>
3.  <span data-ttu-id="ba320-179">Si el formato del contenedor no se basa en un contenedor TIFF o JPEG, puede que tenga que escribir controladores de metadatos para los formatos de metadatos comunes (EXIF, XMP).</span><span class="sxs-lookup"><span data-stu-id="ba320-179">If your container format is not based on a TIFF or JPEG container, you may need to write metadata handlers for the common metadata formats (EXIF, XMP).</span></span> <span data-ttu-id="ba320-180">Sin embargo, si usa un formato de contenedor basado en TIFF o JPEG, no es necesario porque puede delegar en los controladores de metadatos proporcionados por el sistema.</span><span class="sxs-lookup"><span data-stu-id="ba320-180">However, if you use a TIFF-based or JPEG-based container format, this is not necessary because you can delegate to the system-provided metadata handlers.</span></span>
4.  <span data-ttu-id="ba320-181">Inserte un patrón de identificación único (se recomienda un GUID) en todos los archivos de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-181">Embed a unique identifying pattern (we recommend a GUID) in all your image files.</span></span> <span data-ttu-id="ba320-182">Esto permite que el formato de la imagen coincida con el códec durante la detección.</span><span class="sxs-lookup"><span data-stu-id="ba320-182">This enables your image format to be matched against your codec during the discovery.</span></span> <span data-ttu-id="ba320-183">Si está escribiendo un contenedor WIC para un formato de imagen existente, debe buscar un patrón de bits que el codificador siempre escribe en los archivos de imagen que son únicos para ese formato de imagen y usarlos como el patrón de identificación).</span><span class="sxs-lookup"><span data-stu-id="ba320-183">If you are writing a WIC wrapper for an existing image format, you must find a pattern of bits that the encoder always writes into its image files that’s unique to that image format, and use this as the identifying pattern.)</span></span>
5.  <span data-ttu-id="ba320-184">Registre el códec en el momento de la instalación.</span><span class="sxs-lookup"><span data-stu-id="ba320-184">Register your codec at installation time.</span></span> <span data-ttu-id="ba320-185">Esto permite detectar el códec en tiempo de ejecución haciendo coincidir el patrón de identificación del registro con el patrón incrustado en el archivo de imagen.</span><span class="sxs-lookup"><span data-stu-id="ba320-185">This enables your codec to be discovered at run time by matching the identifying pattern in the registry with the pattern embedded in the image file.</span></span>
6.  <span data-ttu-id="ba320-186">A partir de Windows 7, WIC requiere que los códecs tengan el tipo de Apartamento COM "both".</span><span class="sxs-lookup"><span data-stu-id="ba320-186">As of Windows 7, WIC requires that codecs be of COM apartment type "Both".</span></span> <span data-ttu-id="ba320-187">Esto significa que debe realizar el bloqueo adecuado para administrar llamadores y llamadores entre apartamentos en escenarios de varios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="ba320-187">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="ba320-188">Para obtener más información, consulte la sección siguiente sobre compatibilidad con apartamento multiproceso.</span><span class="sxs-lookup"><span data-stu-id="ba320-188">For more information, see the next section on multi-threaded apartment support.</span></span>
7.  <span data-ttu-id="ba320-189">Compatibilidad con las plataformas de 64 bits: para Windows 7, WIC requiere que los códecs WIC de terceros se entreguen como archivos binarios nativos de 32 bits y de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="ba320-189">Support for 64-bit platforms: For Windows 7, WIC will require that third-party WIC codecs be delivered as both 32-bit and 64-bit native binaries.</span></span> <span data-ttu-id="ba320-190">Además, el formato de 32 bits debe instalarse y ejecutarse en sistemas de 64 bits, y el instalador de códecs de Windows 7 de terceros debe instalar los archivos binarios de 32 bits y de 64 bits en sistemas de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="ba320-190">Further, the 32-bit form must install and run on 64-bit systems, and the third party Windows 7 codec installer must install both the 32-bit and 64-bit binaries on 64-bit systems.</span></span>

## <a name="multi-threaded-apartment-support-in-wic"></a><span data-ttu-id="ba320-191">Compatibilidad con apartamento multiproceso en WIC</span><span class="sxs-lookup"><span data-stu-id="ba320-191">Multi-Threaded Apartment Support in WIC</span></span>

<span data-ttu-id="ba320-192">Se puede llamar a los objetos de un contenedor multiproceso (MTA) simultáneamente en cualquier número de subprocesos del MTA.</span><span class="sxs-lookup"><span data-stu-id="ba320-192">Objects within a Multi-Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA.</span></span> <span data-ttu-id="ba320-193">Esto permite un mejor rendimiento en los sistemas de varios núcleos y en determinados escenarios de servidor.</span><span class="sxs-lookup"><span data-stu-id="ba320-193">This allows for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="ba320-194">Además, los códecs WIC de un MTA pueden llamar a otros objetos del MTA sin el costo de serialización asociado a la llamada entre subprocesos en distintos apartamentos STA.</span><span class="sxs-lookup"><span data-stu-id="ba320-194">In addition, WIC codecs in an MTA can call other objects in the MTA without the marshalling cost associated with calling between threads in different STA apartments.</span></span> <span data-ttu-id="ba320-195">En Windows 7, todos los códecs WIC integrados se han actualizado para admitir MTA, como JPEG, TIFF, PNG, GIF, ICO y BMP.</span><span class="sxs-lookup"><span data-stu-id="ba320-195">In Windows 7, all in-box WIC codecs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="ba320-196">Se recomienda escribir códecs de terceros para admitir MTA.</span><span class="sxs-lookup"><span data-stu-id="ba320-196">It is highly recommended that third-party codecs be written to support MTAs.</span></span> <span data-ttu-id="ba320-197">Los códecs de terceros que no son compatibles con los MTA causan importantes costos de rendimiento en las aplicaciones multiproceso debido a la serialización.</span><span class="sxs-lookup"><span data-stu-id="ba320-197">Third-party codecs that do not to support MTAs cause significant performance costs in multi-threaded applications because of marshaling.</span></span> <span data-ttu-id="ba320-198">La habilitación de la compatibilidad con MTA requiere que se implemente la sincronización adecuada en el códec de terceros.</span><span class="sxs-lookup"><span data-stu-id="ba320-198">Enabling MTA support requires proper synchronization to be implemented in the third-party codec.</span></span> <span data-ttu-id="ba320-199">La implementación exacta de estas técnicas de sincronización está fuera del ámbito de este documento.</span><span class="sxs-lookup"><span data-stu-id="ba320-199">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="ba320-200">Para obtener más información sobre la sincronización de objetos COM, vea [Descripción y uso de modelos de subprocesos com](/previous-versions/ms809971(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="ba320-200">For more information on synchronizing COM objects, see [Understanding and Using COM Threading Models](/previous-versions/ms809971(v=msdn.10)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ba320-201">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="ba320-201">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="ba320-202">**Vista**</span><span class="sxs-lookup"><span data-stu-id="ba320-202">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="ba320-203">Introducción (cómo escribir un códec WIC-Enabled)</span><span class="sxs-lookup"><span data-stu-id="ba320-203">Introduction (How to Write a WIC-Enabled CODEC)</span></span>](-wic-howtowriteacodec-intro.md)
</dt> <dt>

[<span data-ttu-id="ba320-204">Implementar un descodificador de WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="ba320-204">Implementing a WIC-Enabled Decoder</span></span>](-wic-implementingwicdecoder.md)
</dt> <dt>

[<span data-ttu-id="ba320-205">Cómo escribir un códec de WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="ba320-205">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> <dt>

[<span data-ttu-id="ba320-206">Información general sobre componentes de Windows Imaging</span><span class="sxs-lookup"><span data-stu-id="ba320-206">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="ba320-207">Información general sobre metadatos de WIC</span><span class="sxs-lookup"><span data-stu-id="ba320-207">WIC Metadata Overview</span></span>](-wic-about-metadata.md)
</dt> </dl>

 

 



