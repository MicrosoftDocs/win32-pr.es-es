---
title: Control de cuentas de usuario y BITS
description: Cuando un usuario administrador inicia sesión en el equipo, se crean dos tokens de acceso. Uno es un token de acceso de usuario estándar filtrado y el otro es un token de acceso de administrador completo.
ms.assetid: 02439ab3-b885-4a2f-b507-0c48d2b30b76
ms.topic: article
ms.date: 7/12/2019
ms.openlocfilehash: 3017b3a0d816ba393d1427c5c1d2315a68b2dcc0
ms.sourcegitcommit: be77ed1f97d3be57a2f42070589de21b66034adf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/29/2020
ms.locfileid: "103995027"
---
# <a name="bits-security-tokens-and-administrator-accounts"></a><span data-ttu-id="2ab86-104">Seguridad de BITS, tokens y cuentas de administrador</span><span class="sxs-lookup"><span data-stu-id="2ab86-104">BITS Security, Tokens, and Administrator Accounts</span></span>

## <a name="http-server-certificate-callbacks"></a><span data-ttu-id="2ab86-105">Devoluciones de llamada de certificado de servidor HTTP</span><span class="sxs-lookup"><span data-stu-id="2ab86-105">HTTP Server certificate callbacks</span></span>
<span data-ttu-id="2ab86-106">La validación correcta de los certificados de servidor es una parte fundamental del mantenimiento de la seguridad HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2ab86-106">Correctly validating server certificates is a key part of maintaining HTTPS security.</span></span> <span data-ttu-id="2ab86-107">BITS ayuda a validar siempre los certificados de servidor con una lista de requisitos especificados por [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span><span class="sxs-lookup"><span data-stu-id="2ab86-107">BITS helps by always validating server certificates against a list of requirements specified by [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span></span> <span data-ttu-id="2ab86-108">De forma predeterminada, BITS usa la validación de certificados de estilo "explorador".</span><span class="sxs-lookup"><span data-stu-id="2ab86-108">By default, BITS uses "browser" style certificate validation.</span></span>

<span data-ttu-id="2ab86-109">También puede especificar una función personalizada a la que llamar para validar más el certificado.</span><span class="sxs-lookup"><span data-stu-id="2ab86-109">You can also specify a custom function to call in order to further validate the certificate.</span></span> <span data-ttu-id="2ab86-110">Establezca la devolución de llamada del certificado de servidor con el método [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) .</span><span class="sxs-lookup"><span data-stu-id="2ab86-110">Set the server certificate callback with the [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) method.</span></span> <span data-ttu-id="2ab86-111">Solo se llamará al método después de que el sistema operativo haya validado el certificado basándose en la llamada [ **SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) .</span><span class="sxs-lookup"><span data-stu-id="2ab86-111">Your method will only be called after the operating system has validated the certificate based on the [**SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) call.</span></span> 

## <a name="http-client-certificates"></a><span data-ttu-id="2ab86-112">Certificados de cliente HTTP</span><span class="sxs-lookup"><span data-stu-id="2ab86-112">HTTP Client certificates</span></span>
<span data-ttu-id="2ab86-113">Puede establecer un certificado de cliente en un trabajo HTTP con dos métodos diferentes de configuración de certificado.</span><span class="sxs-lookup"><span data-stu-id="2ab86-113">You can set a client certificate on an HTTP job with two different certificate settings methods.</span></span> <span data-ttu-id="2ab86-114">Puede establecer un certificado por el [identificador](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) o por el nombre de [sujeto](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname)del certificado.</span><span class="sxs-lookup"><span data-stu-id="2ab86-114">You can set a certificate either by [ID](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) or by the certificate [subject name](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname).</span></span> <span data-ttu-id="2ab86-115">El certificado de cliente se utilizará durante la negociación de TLS (o la renegociación) si el servidor requiere la autenticación del cliente.</span><span class="sxs-lookup"><span data-stu-id="2ab86-115">The client certificate will be used during TLS negotiation (or renegotiation) if the server requires client authentication.</span></span>

## <a name="write-only-http-headers"></a><span data-ttu-id="2ab86-116">Encabezados HTTP de solo escritura</span><span class="sxs-lookup"><span data-stu-id="2ab86-116">Write-only HTTP headers</span></span>
<span data-ttu-id="2ab86-117">BITS le ayuda a proteger los tokens de autenticación HTTP del acceso no deseado.</span><span class="sxs-lookup"><span data-stu-id="2ab86-117">BITS helps you protect HTTP authentication tokens from unwanted access.</span></span> <span data-ttu-id="2ab86-118">A menudo, un servidor HTTP necesitará algún tipo de token de seguridad o cadena al descargar o cargar un archivo en servidores HTTP.</span><span class="sxs-lookup"><span data-stu-id="2ab86-118">Often an HTTP server will need some kind of security token or string when downloading or uploading a file to HTTP servers.</span></span>

<span data-ttu-id="2ab86-119">BITS protege estos tokens de autenticación de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="2ab86-119">BITS protects these authentication tokens in several ways.</span></span>
* <span data-ttu-id="2ab86-120">BITS le permite usar conexiones HTTP protegidas por SSL y TLS especificando una dirección URL HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2ab86-120">BITS lets you use TLS- and SSL-protected HTTP connections by specifying an HTTPS URL.</span></span>
* <span data-ttu-id="2ab86-121">Los encabezados personalizados siempre se conservan en un formato cifrado en el disco.</span><span class="sxs-lookup"><span data-stu-id="2ab86-121">Custom headers are always persisted in an encrypted format on disk.</span></span>
* <span data-ttu-id="2ab86-122">Puede evitar que los encabezados de cliente se devuelvan a otros programas con el método [**IBackgroundCopyJobHttpOptions3:: MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) .</span><span class="sxs-lookup"><span data-stu-id="2ab86-122">You can prevent customer headers from being returned to other programs with the [**IBackgroundCopyJobHttpOptions3::MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) method.</span></span>


## <a name="standard-and-administrator-users"></a><span data-ttu-id="2ab86-123">Usuarios estándar y de administrador</span><span class="sxs-lookup"><span data-stu-id="2ab86-123">Standard and Administrator users</span></span>
<span data-ttu-id="2ab86-124">Un usuario que esté en el grupo de administradores puede ejecutar un proceso con acceso de usuario estándar o en un estado elevado (con privilegios de administrador).</span><span class="sxs-lookup"><span data-stu-id="2ab86-124">A user who is in the administrator group can run a process with standard user access or in an elevated state (with administrator privileges).</span></span> <span data-ttu-id="2ab86-125">BITS ejecutará el trabajo en cualquier estado siempre que el usuario haya iniciado sesión en el equipo.</span><span class="sxs-lookup"><span data-stu-id="2ab86-125">BITS will run the job in either state as long as the user is logged onto the computer.</span></span> <span data-ttu-id="2ab86-126">Sin embargo, si el usuario creó el trabajo o tomó posesión del trabajo en un estado elevado, el usuario debe tener el estado elevado para recuperar o modificar el trabajo (de lo contrario, se produce un error en la llamada con acceso denegado (0x80070005)).</span><span class="sxs-lookup"><span data-stu-id="2ab86-126">However, if the user created the job or took ownership of the job in an elevated state, the user must be in the elevated state to retrieve or modify the job (otherwise, the call fails with Access Denied (0x80070005)).</span></span> <span data-ttu-id="2ab86-127">Para determinar el estado con privilegios elevados de un trabajo, llame al método [**IBackgroundCopyJob4:: GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) .</span><span class="sxs-lookup"><span data-stu-id="2ab86-127">To determine the elevated state of a job, call the [**IBackgroundCopyJob4::GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) method.</span></span>

<span data-ttu-id="2ab86-128">Un usuario estándar no puede enumerar ni modificar trabajos que pertenecen a otros usuarios.</span><span class="sxs-lookup"><span data-stu-id="2ab86-128">A standard user cannot enumerate or modify jobs owned by other users.</span></span>

## <a name="integrity-level"></a><span data-ttu-id="2ab86-129">Nivel de integridad</span><span class="sxs-lookup"><span data-stu-id="2ab86-129">Integrity level</span></span>
<span data-ttu-id="2ab86-130">Además del estado elevado, el nivel de integridad del token puede determinar si el usuario puede modificar un trabajo.</span><span class="sxs-lookup"><span data-stu-id="2ab86-130">In addition to the elevated state, the integrity level of the token can determine if the user can modify a job.</span></span> <span data-ttu-id="2ab86-131">Un cliente no puede modificar trabajos creados por un token con un nivel de integridad superior.</span><span class="sxs-lookup"><span data-stu-id="2ab86-131">A client cannot modify jobs created by a token with a higher integrity level.</span></span> <span data-ttu-id="2ab86-132">En concreto, muchos tokens del sistema local llevan un nivel de integridad mayor que el nivel de integridad de una ventana con privilegios elevados, por lo que un administrador no puede modificarlos desde una ventana de comandos normal con privilegios elevados.</span><span class="sxs-lookup"><span data-stu-id="2ab86-132">In particular, many local-system tokens carry an integrity level higher than the integrity level of an elevated window, and so they cannot be modified by an administrator from an ordinary elevated command window.</span></span> <span data-ttu-id="2ab86-133">Por ejemplo, Windows Update y los trabajos de SMS se ejecutan como LocalSystem, que tiene un nivel de integridad mayor que un token con privilegios elevados, por lo que un administrador no puede modificar ni eliminar estos trabajos.</span><span class="sxs-lookup"><span data-stu-id="2ab86-133">For example, Windows Update and SMS jobs run as LocalSystem which has a higher integrity level than an elevated token so an administrator cannot modify or delete these jobs.</span></span> <span data-ttu-id="2ab86-134">Para modificar estos trabajos, cree una tarea Programador de tareas que se ejecute como sistema local.</span><span class="sxs-lookup"><span data-stu-id="2ab86-134">To modify these job, create a Task Scheduler task that runs as local system.</span></span> <span data-ttu-id="2ab86-135">La tarea puede ejecutar una aplicación de consola que usa la API de BITS, o bien la tarea podría ejecutar un script que llama a BitsAdmin.exe.</span><span class="sxs-lookup"><span data-stu-id="2ab86-135">The task can execute a console application that uses the BITS API, or the task could execute a script that calls BitsAdmin.exe.</span></span> <span data-ttu-id="2ab86-136">Para determinar el nivel de integridad usado, llame al método [**IBackgroundCopyJob4:: GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) .</span><span class="sxs-lookup"><span data-stu-id="2ab86-136">To determine the integrity level used, call the [**IBackgroundCopyJob4::GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) method.</span></span>

## <a name="service-identity"></a><span data-ttu-id="2ab86-137">Identidad de servicio</span><span class="sxs-lookup"><span data-stu-id="2ab86-137">Service identity</span></span>
<span data-ttu-id="2ab86-138">A partir de la actualización 2019 de mayo de Windows 10 (10,0; Compilación 18362), los trabajos de BITS iniciados desde un servicio conservarán la identidad del servicio.</span><span class="sxs-lookup"><span data-stu-id="2ab86-138">Starting in the Windows 10 May 2019 Update (10.0; Build 18362), BITS jobs started from a service will maintain the service identity.</span></span> <span data-ttu-id="2ab86-139">Esto permite que los servicios que desean usar BITS descarguen o carguen archivos de un directorio cuyos permisos están vinculados al SID del servicio.</span><span class="sxs-lookup"><span data-stu-id="2ab86-139">This allows for services that wish to use BITS to download files to or upload files from a directory whose permissions are tied to the service SID.</span></span> <span data-ttu-id="2ab86-140">Además, el tráfico de red se atribuye correctamente al servicio que solicitó el trabajo de BITS en lugar de atribuirse a BITS.</span><span class="sxs-lookup"><span data-stu-id="2ab86-140">Additionally, network traffic will be correctly attributed to the service that requested the BITS job instead of being attributed to BITS.</span></span>

 




