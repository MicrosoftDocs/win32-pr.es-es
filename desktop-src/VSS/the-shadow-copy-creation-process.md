---
description: Proceso de creación de instantáneas
ms.assetid: ca484eec-31c6-4790-9232-3ed67263f6fb
title: Proceso de creación de instantáneas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4239e2b671edcaeb35b404d9b9411b43316c0212
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103809848"
---
# <a name="the-shadow-copy-creation-process"></a><span data-ttu-id="dc27d-103">Proceso de creación de instantáneas</span><span class="sxs-lookup"><span data-stu-id="dc27d-103">The Shadow Copy Creation Process</span></span>

<span data-ttu-id="dc27d-104">A continuación se describe la función del proveedor de hardware en la creación de un conjunto de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-104">The following is a detailed description of the hardware provider's role in the creation of a shadow copy set.</span></span> <span data-ttu-id="dc27d-105">Para ver un diagrama de este proceso, vea [creación de instantáneas para proveedores](shadow-copy-creation-for-providers.md).</span><span class="sxs-lookup"><span data-stu-id="dc27d-105">For a diagram of this process, see [Shadow Copy Creation for Providers](shadow-copy-creation-for-providers.md).</span></span>

1.  <span data-ttu-id="dc27d-106">A medida que el solicitante agrega cada volumen al conjunto de instantáneas, VSS determina los LUN asociados.</span><span class="sxs-lookup"><span data-stu-id="dc27d-106">As the requester adds each volume to the shadow copy set, VSS determines the associated LUNs.</span></span> <span data-ttu-id="dc27d-107">Por ejemplo, un volumen distribuido podría estar compuesto de varios LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-107">For example, a spanned volume could be composed of multiple LUNs.</span></span> <span data-ttu-id="dc27d-108">VSS crea una [**\_ \_ información**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) inicial del LUN de VDS mediante la información de dispositivo físico para cada LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-108">VSS creates an initial [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) using physical device information for each LUN.</span></span>
2.  <span data-ttu-id="dc27d-109">VSS llama a [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) para determinar si el proveedor admite una instantánea para ese LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-109">VSS calls [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to determine if the provider supports a shadow copy for that LUN.</span></span> <span data-ttu-id="dc27d-110">El proveedor de hardware usa [**la \_ \_ información de LUN de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) para determinar si se admiten los LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-110">The hardware provider uses the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) to determine whether the LUNs are supported.</span></span> <span data-ttu-id="dc27d-111">Esta determinación debe ser All o Nothing; el mismo proveedor de hardware debe admitir todos los LUN que contribuyan a un volumen específico.</span><span class="sxs-lookup"><span data-stu-id="dc27d-111">This determination must be all or nothing—the same hardware provider must support all LUNs contributing to a specific volume.</span></span> <span data-ttu-id="dc27d-112">En el ejemplo de volumen distribuido, el proveedor no puede indicar que solo admite uno de los LUN que componen el volumen.</span><span class="sxs-lookup"><span data-stu-id="dc27d-112">In the spanned volume example, the provider cannot indicate that it supports only one of the LUNs that comprise the volume.</span></span>
3.  <span data-ttu-id="dc27d-113">Para cada volumen del conjunto de instantáneas, VSS llama a [**IVssHardwareSnapshotProvider:: BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) con la misma matriz de estructuras de [**información de \_ LUN \_ de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) .</span><span class="sxs-lookup"><span data-stu-id="dc27d-113">For each volume in the shadow copy set, VSS calls [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) with the same array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures.</span></span> <span data-ttu-id="dc27d-114">En una sola llamada, todos los LUN de la matriz son únicos, pero el mismo LUN puede aparecer en una llamada subsiguiente cada vez que el mismo LUN contribuye a varios volúmenes.</span><span class="sxs-lookup"><span data-stu-id="dc27d-114">Within a single call, all LUNs in the array are unique, but the same LUN may appear in a subsequent call whenever the same LUN contributes to multiple volumes.</span></span> <span data-ttu-id="dc27d-115">El proveedor debe controlar el caso correctamente.</span><span class="sxs-lookup"><span data-stu-id="dc27d-115">The provider must handle that case correctly.</span></span>
4.  <span data-ttu-id="dc27d-116">Inmediatamente después de [**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS establecerá las marcas de solo lectura, ocultas, sin letra de unidad y de instantánea en todos los LUN afectados.</span><span class="sxs-lookup"><span data-stu-id="dc27d-116">Immediately after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS will set the read-only, hidden, no drive letter, and shadow copy flags on all affected LUNs.</span></span> <span data-ttu-id="dc27d-117">Las marcas se implementan mediante sectores ocultos en discos MBR o bits específicos del sistema operativo en la entrada de encabezado de partición en discos GPT.</span><span class="sxs-lookup"><span data-stu-id="dc27d-117">The flags are implemented using hidden sectors on MBR disks or operating-system-specific bits in the partition header entry on GPT disks.</span></span> <span data-ttu-id="dc27d-118">Las marcas harán que todos los volúmenes de los discos afectados se muestren en los equipos receptores como de solo lectura y ocultos.</span><span class="sxs-lookup"><span data-stu-id="dc27d-118">The flags will cause all volumes on the affected disks to be surfaced on the receiving machines as read-only and hidden.</span></span> <span data-ttu-id="dc27d-119">Tenga en cuenta que los LUN de copia sombra no se han confirmado en esta fase, de modo que, en caso de bloqueo del sistema, las marcas se borrarán y el LUN original no se verá afectado.</span><span class="sxs-lookup"><span data-stu-id="dc27d-119">Note that the shadow-copied LUNs have not been committed at this stage, so that in the event of a system crash, the flags will be cleared and the original LUN will not be affected.</span></span> <span data-ttu-id="dc27d-120">Es decir, todos los volúmenes del LUN original se tratarán como normales y conservarán sus asignaciones originales de letra de unidad, carpetas montadas y estado de lectura/escritura.</span><span class="sxs-lookup"><span data-stu-id="dc27d-120">That is, all volumes on the original LUN will be treated as normal—and keep their original drive-letter assignments, mounted folders, and read/write status.</span></span>
    > [!Note]  
    > <span data-ttu-id="dc27d-121">Los proveedores no deben intentar modificar ninguna de las marcas de LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-121">Providers should not attempt to modify any of the LUN flags.</span></span>

     

5.  <span data-ttu-id="dc27d-122">En [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), se confirman los LUN de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-122">At [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), the shadow copy LUNs are committed.</span></span> <span data-ttu-id="dc27d-123">**CommitSnapshots** debe devolverse en pocos segundos o se producirá un error en todo el proceso de creación de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-123">**CommitSnapshots** should be returned within a few seconds or the whole shadow copy creation process will probably fail.</span></span>
6.  <span data-ttu-id="dc27d-124">Después de [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS borra las marcas de todos los LUN originales implicados en la instantánea.</span><span class="sxs-lookup"><span data-stu-id="dc27d-124">After [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS clears the flags on all original LUNs involved in the shadow copy.</span></span> <span data-ttu-id="dc27d-125">Dado que los LUN de instantáneas se han confirmado en este punto, los LUN de instantáneas conservan estas marcas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-125">Since the shadow copy LUNs have been committed at this point, the shadow copy LUNs retain these flags.</span></span>
7.  <span data-ttu-id="dc27d-126">Después de [**IVssProviderCreateSnapshotSet::P ostcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS borra las marcas de LUN (que estableció después de [**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) y notifica a los escritores que se reanudan.</span><span class="sxs-lookup"><span data-stu-id="dc27d-126">After [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS clears the LUN flags (that it set after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) and notifies the writers to thaw.</span></span> <span data-ttu-id="dc27d-127">A continuación, VSS llama a los métodos [**IVssProviderCreateSnapshotSet::P refinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) y [**IVssProviderCreateSnapshotSet::P ostfinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) del proveedor.</span><span class="sxs-lookup"><span data-stu-id="dc27d-127">VSS then calls the provider's [**IVssProviderCreateSnapshotSet::PreFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) and [**IVssProviderCreateSnapshotSet::PostFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) methods.</span></span>
8.  <span data-ttu-id="dc27d-128">VSS recupera una matriz de estructuras [**de \_ \_ información de LUN de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) , una para cada LUN de instantánea recién creado, llamando a [**IVssHardwareSnapshotProvider:: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span><span class="sxs-lookup"><span data-stu-id="dc27d-128">VSS retrieves an array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures, one for each newly created shadow copy LUN, by calling [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span></span> <span data-ttu-id="dc27d-129">El proveedor debe proporcionar información suficiente para permitir que VSS y el proveedor identifiquen las instantáneas en cualquier momento posterior y en cualquier sistema conectado al subsistema.</span><span class="sxs-lookup"><span data-stu-id="dc27d-129">The provider must provide enough information to allow VSS and the provider to identify the shadow copies at any later time and on any system connected to the subsystem.</span></span> <span data-ttu-id="dc27d-130">En este momento, no es posible tener acceso a los LUN de instantáneas en este equipo; el proveedor debe usar algún mecanismo distinto de simplemente leyendo la información del LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-130">At this time, the shadow copy LUNs should be inaccessible to this machine—the provider must use some mechanism other than by simply reading the information from the LUN.</span></span>
9.  <span data-ttu-id="dc27d-131">En el caso de las instantáneas transportables, VSS anexa lo siguiente al documento componentes de copia de seguridad que describe el conjunto de instantáneas:</span><span class="sxs-lookup"><span data-stu-id="dc27d-131">For transportable shadow copies, VSS appends the following to the Backup Components Document describing the shadow copy set:</span></span>
    1.  <span data-ttu-id="dc27d-132">La matriz de [**\_ \_ información de LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de LUN original.</span><span class="sxs-lookup"><span data-stu-id="dc27d-132">The original LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    2.  <span data-ttu-id="dc27d-133">La nueva matriz de [**\_ \_ información**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) del LUN VDS de LUN de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-133">The new shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    3.  <span data-ttu-id="dc27d-134">Las extensiones de disco para cada volumen del conjunto de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-134">The disk extents for each volume in the shadow copy set.</span></span>
10. <span data-ttu-id="dc27d-135">En el caso de las instantáneas de importación automática, comienza el proceso de importación.</span><span class="sxs-lookup"><span data-stu-id="dc27d-135">For auto-import shadow copies, the import process begins.</span></span> <span data-ttu-id="dc27d-136">En [**IVssHardwareSnapshotProvider:: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), al proveedor se le proporcionará [**la \_ \_ información de LUN de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generada en [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) en el momento de la creación.</span><span class="sxs-lookup"><span data-stu-id="dc27d-136">In [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the provider will be given the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generated in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) at creation time.</span></span> <span data-ttu-id="dc27d-137">Durante **LocateLuns**, el proveedor debe hacer que los LUN de instantáneas sean visibles para el sistema.</span><span class="sxs-lookup"><span data-stu-id="dc27d-137">During **LocateLuns**, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="dc27d-138">El proveedor no debe hacer que se vuelva a examinar el bus.</span><span class="sxs-lookup"><span data-stu-id="dc27d-138">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="dc27d-139">VSS hará que el nuevo examen y la enumeración permitan que PNP detecte los LUN y que los volúmenes se conecten.</span><span class="sxs-lookup"><span data-stu-id="dc27d-139">VSS will cause the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
11. <span data-ttu-id="dc27d-140">VSS llama a [**IVssHardwareSnapshotProvider:: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) para los discos recién llegados en el sistema.</span><span class="sxs-lookup"><span data-stu-id="dc27d-140">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="dc27d-141">VSS usa la matriz de [**\_ \_ información LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de LUN de instantáneas de **FillInLunInfo**, comparándola con **la \_ \_ información de LUN de VDS** generada durante la creación en [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) y las extensiones de disco para cada volumen del conjunto de instantáneas para identificar los LUN de instantánea recién llegados.</span><span class="sxs-lookup"><span data-stu-id="dc27d-141">VSS uses the shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
12. <span data-ttu-id="dc27d-142">En este momento, todos los volúmenes contenidos en los LUN de instantánea se montan ocultos y son de solo lectura, y VSS tiene una asignación desde el volumen original al volumen de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-142">At this point, all volumes contained on the shadow copy LUNs are mounted hidden and read-only, and VSS has a mapping from original volume to shadow copy volume.</span></span>

<span data-ttu-id="dc27d-143">Dado que un solo LUN puede contener partes de varios volúmenes, el conjunto de LUN de instantáneas puede incluir volúmenes "adicionales".</span><span class="sxs-lookup"><span data-stu-id="dc27d-143">Because a single LUN can contain portions of multiple volumes, the set of shadow copy LUNs may include "extra" volumes.</span></span> <span data-ttu-id="dc27d-144">Esos volúmenes no forman parte del conjunto de instantáneas y no deben usarse, ya que no se garantiza que sean coherentes.</span><span class="sxs-lookup"><span data-stu-id="dc27d-144">Those volumes are not part of the shadow copy set and should not be used as they are not guaranteed to be consistent.</span></span>

<span data-ttu-id="dc27d-145">Después de la importación, se puede tener acceso a la instantánea a través del método [**IVssBackupComponents:: query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) .</span><span class="sxs-lookup"><span data-stu-id="dc27d-145">After import, the shadow copy can be accessed via the [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) method.</span></span> <span data-ttu-id="dc27d-146">Una instantánea también se puede exponer como una letra de unidad, una carpeta montada o un recurso compartido mediante [**IVssBackupComponents:: ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span><span class="sxs-lookup"><span data-stu-id="dc27d-146">A shadow copy can also be exposed as a drive letter, mounted folder, or share using [**IVssBackupComponents::ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span></span> <span data-ttu-id="dc27d-147">Un conjunto de instantáneas también se puede convertir en un LUN normal mediante el método [**IVssBackupComponents:: BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="dc27d-147">A shadow copy set may also be converted to a regular LUN by using the [**IVssBackupComponents::BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) method.</span></span> <span data-ttu-id="dc27d-148">Desde allí, las aplicaciones de administración pueden usar las API de administración de discos adecuadas para administrar más el LUN (por ejemplo, cambiar los atributos de lectura y escritura).</span><span class="sxs-lookup"><span data-stu-id="dc27d-148">From there management applications can use appropriate disk management APIs to further manage the LUN (such as changing the read/write attributes).</span></span>

### <a name="transportable-shadow-copies-on-a-san"></a><span data-ttu-id="dc27d-149">Instantáneas transportables en una SAN</span><span class="sxs-lookup"><span data-stu-id="dc27d-149">Transportable Shadow Copies on a SAN</span></span>

<span data-ttu-id="dc27d-150">A partir de Windows Server 2003, Datacenter Edition y Windows Server 2003, Enterprise Edition, VSS habilita los conjuntos de instantáneas transportables en una red SAN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-150">Beginning with Windows Server 2003, Datacenter Edition and Windows Server 2003, Enterprise Edition, VSS enables transportable shadow copy sets on a SAN.</span></span> <span data-ttu-id="dc27d-151">Desde el punto de vista de un proveedor capaz de transportar LUN entre hosts, hay poca o ninguna diferencia entre un conjunto de instantáneas no transportables y un conjunto de instantáneas transportables.</span><span class="sxs-lookup"><span data-stu-id="dc27d-151">From the point of view of a provider capable of transporting LUNs between hosts, there is little or no difference between a non-transportable and a transportable shadow copy set.</span></span>

<span data-ttu-id="dc27d-152">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition y Windows XP:** No se admiten los conjuntos de instantáneas transportables.</span><span class="sxs-lookup"><span data-stu-id="dc27d-152">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="dc27d-153">Todas las ediciones de Windows Server 2003 con Service Pack 1 (SP1) admiten conjuntos de instantáneas transportables.</span><span class="sxs-lookup"><span data-stu-id="dc27d-153">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="dc27d-154">Los conjuntos de instantáneas transportables deben crearse con el atributo de **\_ \_ \_ transportable** de atributo VOLSNAP de VSS agregado al contexto de instantáneas descrito por la enumeración de [**\_ \_ \_ \_ atributos de instantáneas de volumen de VSS**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) .</span><span class="sxs-lookup"><span data-stu-id="dc27d-154">Transportable shadow copy sets must be created with the **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE** attribute added to the shadow copy context described by the [**\_VSS\_VOLUME\_SNAPSHOT\_ATTRIBUTES**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) enumeration.</span></span> <span data-ttu-id="dc27d-155">Todos los volúmenes del conjunto deben ser transportables.</span><span class="sxs-lookup"><span data-stu-id="dc27d-155">All volumes in the set must be transportable.</span></span> <span data-ttu-id="dc27d-156">Al devolver Success desde [**IVssHardwareSnapshotProvider:: AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), el proveedor indica que no solo admite el Lun, sino que también puede transportar el LUN.</span><span class="sxs-lookup"><span data-stu-id="dc27d-156">By returning success from [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), the provider is indicating that not only does it support the LUN, but also that it can transport the LUN.</span></span> <span data-ttu-id="dc27d-157">La creación de un conjunto de instantáneas transportables concluye cuando VSS registra la información del LUN en el documento componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="dc27d-157">The creation of a transportable shadow copy set concludes when VSS records the LUN information in the Backup Components Document.</span></span> <span data-ttu-id="dc27d-158">Un conjunto de instantáneas solo se puede importar una vez después de la creación inicial.</span><span class="sxs-lookup"><span data-stu-id="dc27d-158">A shadow copy set may only be imported once after initial creation.</span></span>

<span data-ttu-id="dc27d-159">En el equipo receptor, el solicitante importa el conjunto de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="dc27d-159">On the receiving machine, the requester imports the shadow copy set.</span></span> <span data-ttu-id="dc27d-160">El método [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) usa el documento componentes de copia de seguridad que describe el conjunto de instantáneas como entrada.</span><span class="sxs-lookup"><span data-stu-id="dc27d-160">The [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) method uses the Backup Components Document describing the shadow copy set as input.</span></span> <span data-ttu-id="dc27d-161">La importación continúa:</span><span class="sxs-lookup"><span data-stu-id="dc27d-161">Importing proceeds by:</span></span>

1.  <span data-ttu-id="dc27d-162">VSS crea una matriz de estructuras de [**información de \_ LUN \_ de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de instantáneas a partir del documento componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="dc27d-162">VSS constructs an array of shadow copy [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from the Backup Components Document.</span></span>
2.  <span data-ttu-id="dc27d-163">Cuando VSS llama a [**IVssHardwareSnapshotProvider:: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), la matriz de estructuras de [**información de \_ LUN \_ de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generadas en [**IVssHardwareSnapshotProvider:: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) se pasará al proveedor.</span><span class="sxs-lookup"><span data-stu-id="dc27d-163">When VSS calls [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures generated in [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) will be passed to the provider.</span></span> <span data-ttu-id="dc27d-164">Al procesar este método, el proveedor debe hacer que los LUN de instantáneas sean visibles para el sistema.</span><span class="sxs-lookup"><span data-stu-id="dc27d-164">While processing this method, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="dc27d-165">El proveedor no debe hacer que se vuelva a examinar el bus.</span><span class="sxs-lookup"><span data-stu-id="dc27d-165">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="dc27d-166">VSS desencadenará el nuevo análisis y la enumeración para permitir que PNP detecte los LUN y que los volúmenes se conecten.</span><span class="sxs-lookup"><span data-stu-id="dc27d-166">VSS will trigger the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
3.  <span data-ttu-id="dc27d-167">VSS llama a [**IVssHardwareSnapshotProvider:: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) para los discos recién llegados en el sistema.</span><span class="sxs-lookup"><span data-stu-id="dc27d-167">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="dc27d-168">VSS usa la matriz de LUN de instantánea de estructuras de [**\_ \_ información de LUN de VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) de **FillInLunInfo**, comparándola con la **\_ \_ información de LUN de VDS** generada durante la creación del conjunto de instantáneas en [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) y las extensiones de disco para cada volumen del conjunto de instantáneas para identificar los LUN de instantánea recién llegados.</span><span class="sxs-lookup"><span data-stu-id="dc27d-168">VSS uses the shadow copy LUN array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during shadow copy set creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
4.  <span data-ttu-id="dc27d-169">En este momento, todos los volúmenes contenidos en los LUN transportados se montan y son de solo lectura y VSS tiene una asignación del volumen original al volumen de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="dc27d-169">At this point, all volumes contained on the transported LUNs are mounted hidden and read-only and VSS has a mapping from the original volume to the shadow copy volume.</span></span>

<span data-ttu-id="dc27d-170">Tanto en el caso de una sola máquina como en el caso transportable, la secuencia es similar empezando por el punto en el que se llama a [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) .</span><span class="sxs-lookup"><span data-stu-id="dc27d-170">For both the single machine and transportable case, the sequence is similar starting with the point that [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) is called.</span></span> <span data-ttu-id="dc27d-171">Para la importación automática, los pasos se realizan directamente después de la creación.</span><span class="sxs-lookup"><span data-stu-id="dc27d-171">For auto-import, the steps happen directly after creation.</span></span>

 

 
