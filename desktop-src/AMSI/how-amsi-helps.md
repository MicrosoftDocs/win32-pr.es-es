---
title: Cómo AMSI ayuda a defender contra malware
description: Como desarrollador de aplicaciones, puede participar activamente en la defensa contra malware. En concreto, puede ayudar a proteger a sus clientes de malware basado en scripts dinámicos y de las vías no tradicionales de cyberattack.
ms.topic: article
ms.date: 02/27/2019
ms.openlocfilehash: 0d6aee30034312073123f5ab14b1924fd01e6eac
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "103773686"
---
# <a name="how-the-antimalware-scan-interface-amsi-helps-you-defend-against-malware"></a><span data-ttu-id="1030e-104">Cómo la interfaz de detección antimalware (AMSI) le ayuda a defenderse contra malware</span><span class="sxs-lookup"><span data-stu-id="1030e-104">How the Antimalware Scan Interface (AMSI) helps you defend against malware</span></span>

<span data-ttu-id="1030e-105">Para obtener una introducción a la interfaz de análisis antimalware de Windows (AMSI), consulte la [interfaz de examen antimalware (Amsi)](antimalware-scan-interface-portal.md).</span><span class="sxs-lookup"><span data-stu-id="1030e-105">For an introduction to the Windows Antimalware Scan Interface (AMSI), see [Antimalware Scan Interface (AMSI)](antimalware-scan-interface-portal.md).</span></span>

<span data-ttu-id="1030e-106">Como desarrollador de aplicaciones, puede participar activamente en la defensa contra malware.</span><span class="sxs-lookup"><span data-stu-id="1030e-106">As an application developer, you can actively participate in malware defense.</span></span> <span data-ttu-id="1030e-107">En concreto, puede ayudar a proteger a sus clientes de malware basado en scripts dinámicos y de las vías no tradicionales de cyberattack.</span><span class="sxs-lookup"><span data-stu-id="1030e-107">Specifically, you can help protect your customers from dynamic script-based malware, and from non-traditional avenues of cyberattack.</span></span>

<span data-ttu-id="1030e-108">A modo de ejemplo, supongamos que la aplicación admite scripts: acepta scripts arbitrarios y los ejecuta a través de un motor de scripting.</span><span class="sxs-lookup"><span data-stu-id="1030e-108">By way of an example, let's say that your application is scriptable: it accepts arbitrary script, and executes it via a scripting engine.</span></span> <span data-ttu-id="1030e-109">En el momento en que un script está listo para ser proporcionado al motor de scripting, la aplicación puede llamar a las API de Windows AMSI para solicitar un análisis del contenido.</span><span class="sxs-lookup"><span data-stu-id="1030e-109">At the point when a script is ready to be supplied to the scripting engine, your application can call the Windows AMSI APIs to request a scan of the content.</span></span> <span data-ttu-id="1030e-110">De este modo, puede determinar con seguridad si el script es malintencionado antes de decidir si desea continuar y ejecutarlo.</span><span class="sxs-lookup"><span data-stu-id="1030e-110">That way, you can safely determine whether or not the script is malicious before you decide to go ahead and execute it.</span></span>

<span data-ttu-id="1030e-111">Esto es así incluso si el script se generó en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1030e-111">This is true even if the script was generated at runtime.</span></span> <span data-ttu-id="1030e-112">El script (malintencionado o de otro tipo) puede pasar por varios pasos de desofuscación.</span><span class="sxs-lookup"><span data-stu-id="1030e-112">Script (malicious or otherwise), might go through several passes of de-obfuscation.</span></span> <span data-ttu-id="1030e-113">Pero en última instancia, es necesario proporcionar el motor de scripting con código sin sistema de ofuscación.</span><span class="sxs-lookup"><span data-stu-id="1030e-113">But you ultimately need to supply the scripting engine with plain, un-obfuscated code.</span></span> <span data-ttu-id="1030e-114">Y ese es el punto en el que se invocan las API de AMSI.</span><span class="sxs-lookup"><span data-stu-id="1030e-114">And that's the point at which you invoke the AMSI APIs.</span></span>

<span data-ttu-id="1030e-115">A continuación se muestra una ilustración de la arquitectura de AMSI, donde su propia aplicación se representa mediante uno de los cuadros de "otra aplicación".</span><span class="sxs-lookup"><span data-stu-id="1030e-115">Here's an illustration of the AMSI architecture, where your own application is represented by one of the "Other Application" boxes.</span></span>

![arquitectura de AMSI](images/AMSI7Archi.jpg)

<span data-ttu-id="1030e-117">La interfaz AMSI de Windows está abierta.</span><span class="sxs-lookup"><span data-stu-id="1030e-117">The Windows AMSI interface is open.</span></span> <span data-ttu-id="1030e-118">Lo que significa que cualquier aplicación puede llamarlo; y cualquier motor de antimalware registrado puede procesar el contenido que se le envía.</span><span class="sxs-lookup"><span data-stu-id="1030e-118">Which means that any application can call it; and any registered Antimalware engine can process the content submitted to it.</span></span>

<span data-ttu-id="1030e-119">No es posible limitar la explicación a los motores de scripting.</span><span class="sxs-lookup"><span data-stu-id="1030e-119">We needn't limit the discussion to scripting engines, either.</span></span> <span data-ttu-id="1030e-120">Quizás su aplicación es una aplicación de comunicación y examina los mensajes instantáneos en busca de virus antes de mostrarlos a los clientes.</span><span class="sxs-lookup"><span data-stu-id="1030e-120">Perhaps your application is a communication app, and it scans instant messages for viruses before it shows them to your customers.</span></span> <span data-ttu-id="1030e-121">O quizás el software es un juego que valida los complementos antes de instalarlos.</span><span class="sxs-lookup"><span data-stu-id="1030e-121">Or maybe your software is a game that validates plugins before installing them.</span></span> <span data-ttu-id="1030e-122">Hay muchas oportunidades y escenarios de uso de AMSI.</span><span class="sxs-lookup"><span data-stu-id="1030e-122">There are plenty of opportunities and scenarios for using AMSI.</span></span>

## <a name="amsi-in-action"></a><span data-ttu-id="1030e-123">AMSI en acción</span><span class="sxs-lookup"><span data-stu-id="1030e-123">AMSI in action</span></span>

<span data-ttu-id="1030e-124">Echemos un vistazo a AMSI en acción.</span><span class="sxs-lookup"><span data-stu-id="1030e-124">Let's take a look at AMSI in action.</span></span> <span data-ttu-id="1030e-125">En este ejemplo, Windows Defender es la aplicación que llama a las API de AMSI.</span><span class="sxs-lookup"><span data-stu-id="1030e-125">In this example, Windows Defender is the application that's calling AMSI APIs.</span></span> <span data-ttu-id="1030e-126">Sin embargo, puede llamar a las mismas API desde su propia aplicación.</span><span class="sxs-lookup"><span data-stu-id="1030e-126">But you can call the same APIs from within your own application.</span></span>

<span data-ttu-id="1030e-127">A continuación se muestra un ejemplo de un script que usa la técnica de codificación XOR para ocultar su intención (ya sea benigna o no).</span><span class="sxs-lookup"><span data-stu-id="1030e-127">Here's a sample of a script that uses the XOR-encoding technique to hide its intent (whether that intent is benign or not).</span></span> <span data-ttu-id="1030e-128">En esta ilustración, podemos imaginar que este script se ha descargado de Internet.</span><span class="sxs-lookup"><span data-stu-id="1030e-128">For this illustration, we can imagine that this script was downloaded from the Internet.</span></span>

![script de ejemplo codificado en Base64](images/AMSI8.png)

<span data-ttu-id="1030e-130">Para hacer cosas más interesantes, podemos escribir este script manualmente en la línea de comandos para que no haya ningún archivo real que supervisar.</span><span class="sxs-lookup"><span data-stu-id="1030e-130">To make things more interesting, we can enter this script manually at the command line so that there is no actual file to monitor.</span></span> <span data-ttu-id="1030e-131">Esto refleja lo que se conoce como "amenaza de archivos".</span><span class="sxs-lookup"><span data-stu-id="1030e-131">This mirrors what's known as a "fileless threat".</span></span> <span data-ttu-id="1030e-132">No es tan sencillo como analizar archivos en disco.</span><span class="sxs-lookup"><span data-stu-id="1030e-132">It's not as simple as scanning files on disk.</span></span> <span data-ttu-id="1030e-133">La amenaza puede ser una puerta trasera que solo vive en la memoria de una máquina.</span><span class="sxs-lookup"><span data-stu-id="1030e-133">The threat might be a backdoor that lives only in the memory of a machine.</span></span>

<span data-ttu-id="1030e-134">A continuación, vemos el resultado de la ejecución del script en Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="1030e-134">Below, we see the result of running the script in Windows PowerShell.</span></span> <span data-ttu-id="1030e-135">Verá que Windows Defender es capaz de detectar el ejemplo de prueba AMSI en este escenario complicado, simplemente mediante el uso de la firma de ejemplo de prueba estándar AMSI.</span><span class="sxs-lookup"><span data-stu-id="1030e-135">You'll see that Windows Defender is able to detect the AMSI test sample in this complicated scenario, merely by using the standard AMSI test sample signature.</span></span>

![Windows Defender que detecta el ejemplo de prueba AMSI](images/AMSI9proper.png)

## <a name="amsi-integration-with-javascriptvba"></a><span data-ttu-id="1030e-137">Integración de AMSI con JavaScript/VBA</span><span class="sxs-lookup"><span data-stu-id="1030e-137">AMSI integration with JavaScript/VBA</span></span>

<span data-ttu-id="1030e-138">En el flujo de trabajo mostrado a continuación se describe el flujo de un extremo a otro de un ejemplo, en el que se muestra la integración de AMSI con la ejecución de macros en Microsoft Office.</span><span class="sxs-lookup"><span data-stu-id="1030e-138">The illustrated workflow below describes the end-to-end flow of another example, in which we demonstrate AMSI's integration with macro execution within Microsoft Office.</span></span>

![Integración de AMSI con JavaScript/VBA](images/integ-js-vba.png)

- <span data-ttu-id="1030e-140">El usuario recibe un documento que contiene una macro (malintencionada), que eludi los análisis de software antivirus estáticos mediante técnicas como ofuscación, archivos protegidos por contraseña u otros.</span><span class="sxs-lookup"><span data-stu-id="1030e-140">The user receives a document containing a (malicious) macro, which evades static antivirus software scans by employing techniques such as obfuscation, password-protected files, or other.</span></span>
- <span data-ttu-id="1030e-141">Después, el usuario abre el documento que contiene la macro (malintencionada).</span><span class="sxs-lookup"><span data-stu-id="1030e-141">The user then opens the document containing the (malicious) macro.</span></span> <span data-ttu-id="1030e-142">Si el documento se abre en la vista protegida, el usuario hace clic en **Habilitar edición** para salir de la vista protegida.</span><span class="sxs-lookup"><span data-stu-id="1030e-142">If the document opens in Protected View, then the user clicks **Enable Editing** to exit Protected View.</span></span>
- <span data-ttu-id="1030e-143">El usuario hace clic en **Habilitar macros** para permitir que se ejecuten macros.</span><span class="sxs-lookup"><span data-stu-id="1030e-143">The user clicks **Enable Macros** to allow macros to run.</span></span>
- <span data-ttu-id="1030e-144">A medida que se ejecuta la macro, el tiempo de ejecución de VBA usa un búfer circular para registrar \[ 1 \] datos y parámetros relacionados con las llamadas a las API de Win32, com y VBA.</span><span class="sxs-lookup"><span data-stu-id="1030e-144">As the macro runs, the VBA runtime uses a circular buffer to log \[1\] data and parameters related to calls to Win32, COM, and VBA APIs.</span></span>
- <span data-ttu-id="1030e-145">Cuando se observan API de Win32 o COM específicas que se consideran de alto riesgo (también denominados *desencadenadores*) \[ 2 \] , se detiene la ejecución de la macro y el contenido del búfer circular se pasa a Amsi.</span><span class="sxs-lookup"><span data-stu-id="1030e-145">When specific Win32 or COM APIs that are considered high risk (also known as *triggers*) \[2\] are observed, macro execution is halted, and the contents of the circular buffer are passed to AMSI.</span></span>
- <span data-ttu-id="1030e-146">El proveedor de servicios antimalware de AMSI registrado responde con un veredicto para indicar si el comportamiento de la macro es malintencionado o no.</span><span class="sxs-lookup"><span data-stu-id="1030e-146">The registered AMSI anti-malware service provider responds with a verdict to indicate whether or not the macro behavior is malicious.</span></span>
- <span data-ttu-id="1030e-147">Si el comportamiento no es malintencionado, la ejecución de macros continúa.</span><span class="sxs-lookup"><span data-stu-id="1030e-147">If the behavior is non-malicious, then macro execution proceeds.</span></span>
- <span data-ttu-id="1030e-148">De lo contrario, si el comportamiento es malintencionado, Microsoft Office cierra la sesión en respuesta a la alerta \[ 3 \] y el antivirus puede poner en cuarentena el archivo.</span><span class="sxs-lookup"><span data-stu-id="1030e-148">Otherwise, if the behavior is malicious, then Microsoft Office closes the session in response to the alert \[3\], and the AV can quarantine the file.</span></span>

## <a name="what-does-this-mean-for-you"></a><span data-ttu-id="1030e-149">¿Qué significa esto para usted?</span><span class="sxs-lookup"><span data-stu-id="1030e-149">What does this mean for you?</span></span>

<span data-ttu-id="1030e-150">En el caso de los usuarios de Windows, cualquier software malintencionado que use técnicas de ofuscación y fraude en los hosts de scripting integrados de Windows 10 se inspeccionará automáticamente a un nivel mucho más profundo que nunca, proporcionando niveles adicionales de protección.</span><span class="sxs-lookup"><span data-stu-id="1030e-150">For Windows users, any malicious software that uses obfuscation and evasion techniques on Windows 10's built-in scripting hosts is automatically inspected at a much deeper level than ever before, providing additional levels of protection.</span></span>

<span data-ttu-id="1030e-151">Como desarrollador de aplicaciones, considere la posibilidad de hacer que la aplicación llame a la interfaz AMSI de Windows si desea beneficiarse de (y proteger a sus clientes con) análisis y análisis adicionales de contenido potencialmente malintencionado.</span><span class="sxs-lookup"><span data-stu-id="1030e-151">For you as an application developer, consider having your application call the Windows AMSI interface if you want to benefit from (and protect your customers with) extra scanning and analysis of potentially malicious content.</span></span>

<span data-ttu-id="1030e-152">Como proveedor de software antivirus, puede considerar la posibilidad de implementar la compatibilidad con la interfaz AMSI.</span><span class="sxs-lookup"><span data-stu-id="1030e-152">As an antivirus software vendor, you can consider implementing support for the AMSI interface.</span></span> <span data-ttu-id="1030e-153">Cuando lo haga, el motor tendrá mucha información más detallada sobre los datos que las aplicaciones (incluidos los hosts de scripting integrados de Windows 10) consideran potencialmente malintencionados.</span><span class="sxs-lookup"><span data-stu-id="1030e-153">When you do, your engine will have much deeper insight into the data that applications (including Windows 10's built-in scripting hosts) consider to be potentially malicious.</span></span>

## <a name="more-background-info-about-fileless-threats"></a><span data-ttu-id="1030e-154">Más información general acerca de las amenazas con archivos</span><span class="sxs-lookup"><span data-stu-id="1030e-154">More background info about fileless threats</span></span>

<span data-ttu-id="1030e-155">Puede que le resulte más fácil obtener información general sobre los tipos de amenazas de archivos que Windows AMSI está diseñado para ayudarle a defenderse.</span><span class="sxs-lookup"><span data-stu-id="1030e-155">You may be curious for more background info about the kinds of fileless threats that Windows AMSI is designed to help you defend against.</span></span> <span data-ttu-id="1030e-156">En esta sección, echaremos un vistazo al juego tradicional de CAT-and-mouse que se reproduce en el ecosistema de malware.</span><span class="sxs-lookup"><span data-stu-id="1030e-156">In this section, we'll take a look at the traditional cat-and-mouse game that plays out in the malware ecosystem.</span></span>

<span data-ttu-id="1030e-157">Usaremos PowerShell como ejemplo.</span><span class="sxs-lookup"><span data-stu-id="1030e-157">We'll use PowerShell as an example.</span></span> <span data-ttu-id="1030e-158">Pero puede aprovechar las mismas técnicas y los mismos procesos que mostraremos con cualquier lenguaje dinámico &mdash; VBScript, Perl, Python, Ruby, etc.</span><span class="sxs-lookup"><span data-stu-id="1030e-158">But you can leverage the same techniques and processes we'll demonstrate with any dynamic language&mdash;VBScript, Perl, Python, Ruby, and more.</span></span>

<span data-ttu-id="1030e-159">A continuación se muestra un ejemplo de un script de PowerShell malintencionado.</span><span class="sxs-lookup"><span data-stu-id="1030e-159">Here's an example of a malicious PowerShell script.</span></span>

![un ejemplo de un script de PowerShell malintencionado](images/AMSI1.png)

<span data-ttu-id="1030e-161">Aunque este script simplemente escribe un mensaje en la pantalla, el malware suele ser más fraudulento.</span><span class="sxs-lookup"><span data-stu-id="1030e-161">While this script simply writes a message to the screen, malware is typically more nefarious.</span></span> <span data-ttu-id="1030e-162">Pero podría escribir fácilmente una firma para detectarla.</span><span class="sxs-lookup"><span data-stu-id="1030e-162">But you could easily write a signature to detect this one.</span></span> <span data-ttu-id="1030e-163">Por ejemplo, la firma podría buscar la cadena "write-host ' PWND! '"</span><span class="sxs-lookup"><span data-stu-id="1030e-163">For example, the signature could search for the string "Write-Host 'pwnd!'"</span></span> <span data-ttu-id="1030e-164">en cualquier archivo que el usuario abra.</span><span class="sxs-lookup"><span data-stu-id="1030e-164">in any file that the user opens.</span></span> <span data-ttu-id="1030e-165">Excelente: hemos detectado nuestro primer malware.</span><span class="sxs-lookup"><span data-stu-id="1030e-165">Great: we've detected our first malware!</span></span>

<span data-ttu-id="1030e-166">A pesar de que la primera firma lo detecta, los autores de malware responderán.</span><span class="sxs-lookup"><span data-stu-id="1030e-166">After being detected by our first signature, though, malware authors will respond.</span></span> <span data-ttu-id="1030e-167">Responden creando scripts dinámicos como este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="1030e-167">They respond by creating dynamic scripts such as this example.</span></span>

![ejemplo de un script dinámico](images/AMSI2.png)

<span data-ttu-id="1030e-169">En ese escenario, los autores de malware crean una cadena que representa el script de PowerShell que se va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="1030e-169">In that scenario, malware authors create a string representing the PowerShell script to run.</span></span> <span data-ttu-id="1030e-170">Pero usan una técnica de concatenación de cadenas simple para romper la firma anterior.</span><span class="sxs-lookup"><span data-stu-id="1030e-170">But they use a simple string concatenation technique to break our earlier signature.</span></span> <span data-ttu-id="1030e-171">Si alguna vez Ve el origen de una página web con carga de anuncios, verá que se usan muchas instancias de esta técnica para evitar el software de bloqueo de anuncios.</span><span class="sxs-lookup"><span data-stu-id="1030e-171">If you ever view the source of an ad-laden web page, you'll see many instances of this technique being used to avoid ad-blocking software.</span></span>

<span data-ttu-id="1030e-172">Por último, el autor del malware pasa esta cadena concatenada `Invoke-Expression` al &mdash; mecanismo del cmdlet de PowerShell para evaluar los scripts que se componen o se crean en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1030e-172">Finally, the malware author passes this concatenated string to the `Invoke-Expression` cmdlet&mdash;PowerShell's mechanism to evaluate scripts that are composed or created at runtime.</span></span>

<span data-ttu-id="1030e-173">En respuesta, el software antimalware comienza a realizar la emulación de lenguaje básico.</span><span class="sxs-lookup"><span data-stu-id="1030e-173">In response, antimalware software starts to do basic language emulation.</span></span> <span data-ttu-id="1030e-174">Por ejemplo, si vemos que se concatenan dos cadenas, se emulará la concatenación de esas dos cadenas y, a continuación, se ejecutarán las firmas en el resultado.</span><span class="sxs-lookup"><span data-stu-id="1030e-174">For example, if we see two strings being concatenated, then we emulate the concatenation of those two strings, and then run our signatures on the result.</span></span> <span data-ttu-id="1030e-175">Desafortunadamente, se trata de un enfoque bastante frágil, ya que los lenguajes suelen tener muchas formas de representar y concatenar cadenas.</span><span class="sxs-lookup"><span data-stu-id="1030e-175">Unfortunately, this is a fairly fragile approach, because languages tend to have a lot of ways to represent and concatenate strings.</span></span>

<span data-ttu-id="1030e-176">Por lo tanto, después de ser detectado por esta firma, los autores de malware se moverán a algo más complicado, &mdash; por ejemplo, la codificación de contenido de script en Base64, como en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="1030e-176">So, after being caught by this signature, malware authors will move to something more complicated&mdash;for example, encoding script content in Base64, as in this next example.</span></span>

![ejemplo de contenido de script en Base64](images/AMSI3.png)

<span data-ttu-id="1030e-178">En ingenioso, la mayoría de los motores antimalware implementan también la emulación de descodificación Base64.</span><span class="sxs-lookup"><span data-stu-id="1030e-178">Being resourceful, most antimalware engines implement Base64 decoding emulation, as well.</span></span> <span data-ttu-id="1030e-179">Por lo tanto, puesto que también implementamos la emulación de descodificación de Base64, nos preparamos una vez.</span><span class="sxs-lookup"><span data-stu-id="1030e-179">So, since we also implement Base64 decoding emulation, we're ahead for a time.</span></span>

<span data-ttu-id="1030e-180">En respuesta, los autores de malware se mueven a ofuscación algorítmica &mdash; , como un sencillo mecanismo de codificación XOR en los scripts que ejecutan.</span><span class="sxs-lookup"><span data-stu-id="1030e-180">In response, malware authors move to algorithmic obfuscation&mdash;such as a simple XOR-encoding mechanism in the scripts they run.</span></span>

![ejemplo de un script de ofuscación algorítmica](images/AMSI4.png)

<span data-ttu-id="1030e-182">Llegados a este punto, por lo general, los motores antivirus se emularán o detectarán, por lo que no se detectará necesariamente lo que está haciendo este script.</span><span class="sxs-lookup"><span data-stu-id="1030e-182">At this point, we're generally past what antivirus engines will emulate or detect, so we won't necessarily detect what this script is doing.</span></span> <span data-ttu-id="1030e-183">Sin embargo, podemos empezar a escribir firmas en las técnicas de ofuscación y codificación.</span><span class="sxs-lookup"><span data-stu-id="1030e-183">However, we can start to write signatures against the obfuscation and encoding techniques.</span></span> <span data-ttu-id="1030e-184">De hecho, eso es lo que tiene en cuenta la inmensa mayoría de las firmas para el malware basado en script.</span><span class="sxs-lookup"><span data-stu-id="1030e-184">In fact, that's what accounts for the vast majority of signatures for script-based malware.</span></span>

<span data-ttu-id="1030e-185">Pero ¿qué ocurre si el ofuscador es tan trivial que parece un gran número de scripts bien comportados?</span><span class="sxs-lookup"><span data-stu-id="1030e-185">But what if the obfuscator is so trivial that it looks like many well-behaved scripts?</span></span> <span data-ttu-id="1030e-186">Una firma para ella generaría un número inaceptable de falsos positivos.</span><span class="sxs-lookup"><span data-stu-id="1030e-186">A signature for it would generate an unacceptable number of false positives.</span></span> <span data-ttu-id="1030e-187">Este es un script de *stager* de ejemplo que es demasiado benigno para detectarse por sí solo.</span><span class="sxs-lookup"><span data-stu-id="1030e-187">Here's a sample *stager* script that's too benign to detect on its own.</span></span>

![un script de stager de ejemplo demasiado benigno para detectarlo por sí mismo](images/AMSI5.png)

<span data-ttu-id="1030e-189">En ese ejemplo, se está descargando una página web e invocando parte de su contenido.</span><span class="sxs-lookup"><span data-stu-id="1030e-189">In that example, we're downloading a web page, and invoking some content from it.</span></span> <span data-ttu-id="1030e-190">Este es el equivalente en Visual Basic Script.</span><span class="sxs-lookup"><span data-stu-id="1030e-190">Here's the equivalent in Visual Basic script.</span></span>

![equivalente en Visual Basic Script](images/AMSI6.png)

<span data-ttu-id="1030e-192">Lo que es peor en estos dos ejemplos es que el motor antivirus Inspeccione los archivos abiertos por el usuario.</span><span class="sxs-lookup"><span data-stu-id="1030e-192">What makes things worse in both of these examples is that the antivirus engine inspects files being opened by the user.</span></span> <span data-ttu-id="1030e-193">Si el contenido malintencionado solo vive en la memoria, el ataque podría no ser detectado.</span><span class="sxs-lookup"><span data-stu-id="1030e-193">If the malicious content lives only in memory, then the attack can potentially go undetected.</span></span>

<span data-ttu-id="1030e-194">En esta sección se muestran las limitaciones de la detección mediante firmas tradicionales.</span><span class="sxs-lookup"><span data-stu-id="1030e-194">This section showed the limitations of detection using traditional signatures.</span></span> <span data-ttu-id="1030e-195">Sin embargo, mientras que un script malintencionado puede pasar por varios pasos de desofuscación, en última instancia debe proporcionar el motor de scripting con código sin formato y sin ofuscar.</span><span class="sxs-lookup"><span data-stu-id="1030e-195">But, while a malicious script might go through several passes of de-obfuscation, it ultimately needs to supply the scripting engine with plain, unobfuscated code.</span></span> <span data-ttu-id="1030e-196">Y en ese momento &mdash; , tal y como se describe en la primera sección sobre los &mdash; hosts integrados de scripting de Windows 10, se llama a las API de Amsi para solicitar un análisis de este contenido no protegido.</span><span class="sxs-lookup"><span data-stu-id="1030e-196">And at that point&mdash;as we described in the first section above&mdash;Windows 10's built-in scripting hosts call the AMSI APIs to request a scan of this unprotected content.</span></span> <span data-ttu-id="1030e-197">Y la aplicación puede hacer lo mismo.</span><span class="sxs-lookup"><span data-stu-id="1030e-197">And your application can do the same thing.</span></span>

## <a name="related-resources"></a><span data-ttu-id="1030e-198">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="1030e-198">Related resources</span></span>

* [<span data-ttu-id="1030e-199">Amenazas de archivos</span><span class="sxs-lookup"><span data-stu-id="1030e-199">Fileless threats</span></span>](/windows/security/threat-protection/intelligence/fileless-threats)
* [<span data-ttu-id="1030e-200">Office VBA + AMSI: parte del velo en macros malintencionadas</span><span class="sxs-lookup"><span data-stu-id="1030e-200">Office VBA + AMSI: Parting the veil on malicious macros</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/)
* [<span data-ttu-id="1030e-201">Fuera de la vista pero no invisible: derrotar el malware sin archivos con supervisión de comportamiento, AMSI y AV de próxima generación</span><span class="sxs-lookup"><span data-stu-id="1030e-201">Out of sight but not invisible: Defeating fileless malware with behavior monitoring, AMSI, and next-gen AV</span></span>](https://cloudblogs.microsoft.com/microsoftsecure/2018/09/27/out-of-sight-but-not-invisible-defeating-fileless-malware-with-behavior-monitoring-amsi-and-next-gen-av/)
