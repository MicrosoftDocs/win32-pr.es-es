---
description: Los módulos de combinación proporcionan un método estándar para que los desarrolladores entreguen componentes compartidos de Windows Installer y lógica de configuración a sus aplicaciones.
ms.assetid: 3eb087b1-0f44-40d8-a950-67d489f09408
title: Uso de la API para combinar un módulo de combinación en una base de datos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2e68298671045825dda41ad120896fa22c89f068
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105652847"
---
# <a name="using-the-api-to-merge-a-merge-module-into-a-database"></a><span data-ttu-id="070c8-103">Uso de la API para combinar un módulo de combinación en una base de datos</span><span class="sxs-lookup"><span data-stu-id="070c8-103">Using the API to Merge a Merge Module into a Database</span></span>

<span data-ttu-id="070c8-104">Los [módulos de combinación](merge-modules.md) proporcionan un método estándar para que los desarrolladores entreguen [*componentes*](c-gly.md) compartidos de Windows Installer y lógica de configuración a sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="070c8-104">[Merge modules](merge-modules.md) provide a standard method for developers to deliver shared Windows Installer [*components*](c-gly.md) and setup logic to their applications.</span></span> <span data-ttu-id="070c8-105">Los módulos de combinación se deben combinar en un paquete de instalación mediante una herramienta de combinación.</span><span class="sxs-lookup"><span data-stu-id="070c8-105">Merge modules must be merged into an installation package using a merge tool.</span></span> <span data-ttu-id="070c8-106">La mejor alternativa es obtener una herramienta de combinación distribuida libremente o adquirir una de las herramientas de combinación disponibles de proveedores de software independientes.</span><span class="sxs-lookup"><span data-stu-id="070c8-106">The best alternative is to obtain a freely distributed merge tool or purchase one of the merging tools available from independent software vendors.</span></span> <span data-ttu-id="070c8-107">Por ejemplo, puede usar la funcionalidad proporcionada por [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="070c8-107">For example you can use the functionality provided by [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="070c8-108">Siga los pasos que se indican a continuación en secuencia para combinar un módulo de combinación en una base de datos de instalación Windows Installerda por la API de [Mergemod.dll](merge-module-automation.md).</span><span class="sxs-lookup"><span data-stu-id="070c8-108">Use the following steps in sequence to merge a merge module into a Windows Installer installation database by the API of [Mergemod.dll](merge-module-automation.md).</span></span>

<span data-ttu-id="070c8-109">**Para combinar un módulo de combinación en una base de datos de instalación Windows Installer**</span><span class="sxs-lookup"><span data-stu-id="070c8-109">**To merge a merge module into a Windows Installer installation database**</span></span>

1.  <span data-ttu-id="070c8-110">Abra un archivo de registro mediante [**openlog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span><span class="sxs-lookup"><span data-stu-id="070c8-110">Open a log file using [**OpenLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog).</span></span> <span data-ttu-id="070c8-111">Este paso solo es necesario si necesita crear un archivo de registro o anexar un archivo de registro existente para el proceso de mezcla.</span><span class="sxs-lookup"><span data-stu-id="070c8-111">This step is required only if you need to create a log file, or append an existing log file, for the merge process.</span></span>
2.  <span data-ttu-id="070c8-112">Abra la base de datos de instalación, un [archivo. msi](windows-installer-file-extensions.md), que recibirá el módulo de combinación mediante [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span><span class="sxs-lookup"><span data-stu-id="070c8-112">Open the installation database, an [.msi file](windows-installer-file-extensions.md), that will receive the merge module using [**OpenDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase).</span></span> <span data-ttu-id="070c8-113">Este paso es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="070c8-113">This step is required.</span></span>
3.  <span data-ttu-id="070c8-114">Abra el módulo de combinación, un [archivo. MSM](windows-installer-file-extensions.md), que se está combinando en la base de datos mediante [**AbrirMódulo**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span><span class="sxs-lookup"><span data-stu-id="070c8-114">Open the merge module, an [.msm file](windows-installer-file-extensions.md), that is being merged into the database using [**OpenModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule).</span></span> <span data-ttu-id="070c8-115">Un módulo debe estar abierto antes de que se pueda combinar con una base de datos de instalación.</span><span class="sxs-lookup"><span data-stu-id="070c8-115">A module must be opened before it can be merged with an installation database.</span></span> <span data-ttu-id="070c8-116">Este paso es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="070c8-116">This step is required.</span></span>
4.  <span data-ttu-id="070c8-117">Combine el módulo en la base de datos de instalación mediante [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) o [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span><span class="sxs-lookup"><span data-stu-id="070c8-117">Merge the module into the installation database by using [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) or [**MergeEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex).</span></span> <span data-ttu-id="070c8-118">Tenga en cuenta que solo se puede llamar una vez a **Merge** o **MergeEx** para combinar una combinación determinada de archivos. msi y. msm.</span><span class="sxs-lookup"><span data-stu-id="070c8-118">Note that **Merge** or **MergeEx** can only be called once to merge a particular combination of .msi and .msm files.</span></span> <span data-ttu-id="070c8-119">**MergeEx** solo está disponible cuando se usa [Mergemod.dll versión 2,0](merge-module-automation.md) o posterior y solo cuando se usa la interfaz [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) .</span><span class="sxs-lookup"><span data-stu-id="070c8-119">**MergeEx** is only available when using [Mergemod.dll version 2.0](merge-module-automation.md) or later and only when using the [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) interface.</span></span> <span data-ttu-id="070c8-120">Este paso es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="070c8-120">This step is required.</span></span>
5.  <span data-ttu-id="070c8-121">Llame a [**Get \_ Errors**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) y examine la colección de errores recuperada para los conflictos de combinación u otros errores.</span><span class="sxs-lookup"><span data-stu-id="070c8-121">Call [**get\_Errors**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) and examine the retrieved collection of errors for merge conflicts or other errors.</span></span> <span data-ttu-id="070c8-122">La recuperación no es destructiva.</span><span class="sxs-lookup"><span data-stu-id="070c8-122">The retrieval is non-destructive.</span></span> <span data-ttu-id="070c8-123">Se pueden recuperar varias instancias de la colección de errores mediante la lectura repetida de **\_ errores de obtención** de llamadas.</span><span class="sxs-lookup"><span data-stu-id="070c8-123">Multiple instances of the error collection may be retrieved by repeatedly reading calling **get\_Errors**.</span></span> <span data-ttu-id="070c8-124">Tendrá que resolver los errores según corresponda para su caso.</span><span class="sxs-lookup"><span data-stu-id="070c8-124">You will need to resolve any errors as appropriate for your case.</span></span>
6.  <span data-ttu-id="070c8-125">Asocie los componentes del módulo de combinación con las características adicionales que se hayan combinado o se combinarán en la base de datos de instalación mediante [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span><span class="sxs-lookup"><span data-stu-id="070c8-125">Associate the components of the merge module with any additional features that have been, or will be, merged into the installation database using [**Connect**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect).</span></span> <span data-ttu-id="070c8-126">La característica ya debe existir antes de llamar a este método.</span><span class="sxs-lookup"><span data-stu-id="070c8-126">The feature must already exist before calling this method.</span></span> <span data-ttu-id="070c8-127">Este paso solo es necesario si tiene características adicionales. para obtener más información, vea [conectar un módulo de combinación a varias características](connecting-a-merge-module-to-multiple-features.md) .</span><span class="sxs-lookup"><span data-stu-id="070c8-127">This step is only required if you have additional features, for more information see [Connecting a Merge Module to Multiple Features](connecting-a-merge-module-to-multiple-features.md)</span></span>
7.  <span data-ttu-id="070c8-128">Si es necesario, extraiga los archivos de origen del módulo mediante uno o varios de los siguientes procedimientos.</span><span class="sxs-lookup"><span data-stu-id="070c8-128">If necessary, extract source files from the module by doing one or more of the following.</span></span>

    <span data-ttu-id="070c8-129">Para extraer archivos de un archivo. cab incrustado y, a continuación, copiarlos en un directorio especificado, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) o [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span><span class="sxs-lookup"><span data-stu-id="070c8-129">To extract files from an embedded .cab file and then copy into a specified directory, use [**ExtractFiles**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) or [**ExtractFilesEx**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex).</span></span> <span data-ttu-id="070c8-130">Tenga en cuenta que **ExtractFilesEx** requiere [Mergemod.dll versión 2,0](merge-module-automation.md) o posterior.</span><span class="sxs-lookup"><span data-stu-id="070c8-130">Note that **ExtractFilesEx** requires [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

    <span data-ttu-id="070c8-131">Para extraer archivos de un archivo. cab incrustado y guardarlos en un archivo especificado, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span><span class="sxs-lookup"><span data-stu-id="070c8-131">To extract files from an embedded .cab file and then save in a specified file, use [**ExtractCAB**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).</span></span>

    <span data-ttu-id="070c8-132">Para extraer archivos de un módulo y, a continuación, copiarlos en una imagen de origen en el disco después de la fusión mediante combinación, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span><span class="sxs-lookup"><span data-stu-id="070c8-132">To extract files from a module and then copy to a source image on disk after the merge, use [**CreateSourceImage**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage).</span></span> <span data-ttu-id="070c8-133">Tenga en cuenta que **CreateSourceImage** solo está disponible con [Mergemod.dll versión 2,0](merge-module-automation.md) o posterior.</span><span class="sxs-lookup"><span data-stu-id="070c8-133">Note that **CreateSourceImage** is only available with [Mergemod.dll version 2.0](merge-module-automation.md) or later.</span></span>

8.  <span data-ttu-id="070c8-134">Cierre el módulo abrir combinación actual mediante [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span><span class="sxs-lookup"><span data-stu-id="070c8-134">Close the current open merge module using [**CloseModule**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule).</span></span> <span data-ttu-id="070c8-135">Este paso es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="070c8-135">This step is required.</span></span>
9.  <span data-ttu-id="070c8-136">Cierre la base de datos de instalación abierta actual con [**CerrarBaseDeDatos**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span><span class="sxs-lookup"><span data-stu-id="070c8-136">Close the current open installation database using [**CloseDatabase**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase).</span></span> <span data-ttu-id="070c8-137">Este paso es obligatorio.</span><span class="sxs-lookup"><span data-stu-id="070c8-137">This step is required.</span></span> <span data-ttu-id="070c8-138">Al cerrar una base de datos se borra toda la información de dependencias, pero no se afecta a los errores que no se hayan recuperado.</span><span class="sxs-lookup"><span data-stu-id="070c8-138">Closing a database clears all dependency information but does not affect any errors that have not been retrieved.</span></span>
10. <span data-ttu-id="070c8-139">Cierre el archivo de registro actual mediante [**closelog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span><span class="sxs-lookup"><span data-stu-id="070c8-139">Close the current log file using [**CloseLog**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog).</span></span> <span data-ttu-id="070c8-140">Este paso es necesario si ha abierto un archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="070c8-140">This step is required if you have opened a log file.</span></span>

<span data-ttu-id="070c8-141">Una vez que el módulo se ha combinado en la base de datos mediante [Mergemod.dll](merge-module-automation.md), la [tabla de medios](media-table.md) debe actualizarse para describir el diseño de la imagen de origen deseada.</span><span class="sxs-lookup"><span data-stu-id="070c8-141">After the module has been merged into the database using [Mergemod.dll](merge-module-automation.md), the [Media Table](media-table.md) must be updated to describe the desired source image layout.</span></span> <span data-ttu-id="070c8-142">El proceso de mezcla proporcionado por Mergemod.dll no actualiza la tabla de medios porque el consumidor del módulo de combinación puede seleccionar varias maneras de diseñar la imagen de origen.</span><span class="sxs-lookup"><span data-stu-id="070c8-142">The merge process provided by Mergemod.dll does not update the Media Table because the consumer of the merge module can select various ways to layout the source image.</span></span>

 

 
