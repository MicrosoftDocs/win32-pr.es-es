---
description: Grabación de bucle invertido
ms.assetid: 71c567f7-fffa-4b75-897a-63ed30c4c9b0
title: Grabación de bucle invertido
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 374da7497096118905f5e4c79bbacda832a42a7b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104000718"
---
# <a name="loopback-recording"></a><span data-ttu-id="4c557-103">Grabación de bucle invertido</span><span class="sxs-lookup"><span data-stu-id="4c557-103">Loopback Recording</span></span>

<span data-ttu-id="4c557-104">En el modo de bucle invertido, un cliente de WASAPI puede capturar la secuencia de audio que reproduce un dispositivo de punto de conexión de representación.</span><span class="sxs-lookup"><span data-stu-id="4c557-104">In loopback mode, a client of WASAPI can capture the audio stream that is being played by a rendering endpoint device.</span></span> <span data-ttu-id="4c557-105">Para abrir un flujo en modo de bucle invertido, el cliente debe:</span><span class="sxs-lookup"><span data-stu-id="4c557-105">To open a stream in loopback mode, the client must:</span></span>

-   <span data-ttu-id="4c557-106">Obtenga una interfaz [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) para el dispositivo de punto de conexión de representación.</span><span class="sxs-lookup"><span data-stu-id="4c557-106">Obtain an [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface for the rendering endpoint device.</span></span>
-   <span data-ttu-id="4c557-107">Inicializa una secuencia de captura en modo de bucle invertido en el dispositivo de punto de conexión de representación.</span><span class="sxs-lookup"><span data-stu-id="4c557-107">Initialize a capture stream in loopback mode on the rendering endpoint device.</span></span>

<span data-ttu-id="4c557-108">Después de seguir estos pasos, el cliente puede llamar al método [**IAudioClient:: GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) para obtener una interfaz [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) en el dispositivo de punto de conexión de representación.</span><span class="sxs-lookup"><span data-stu-id="4c557-108">After following these steps, the client can call the [**IAudioClient::GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) method to obtain an [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) interface on the rendering endpoint device.</span></span>

<span data-ttu-id="4c557-109">WASAPI proporciona el modo de bucle invertido principalmente para admitir la cancelación del eco acústico (AEC).</span><span class="sxs-lookup"><span data-stu-id="4c557-109">WASAPI provides loopback mode primarily to support acoustic echo cancellation (AEC).</span></span> <span data-ttu-id="4c557-110">Sin embargo, otros tipos de aplicaciones de audio pueden encontrar el modo de bucle invertido útil para capturar la combinación del sistema que está reproduciendo por el motor de audio.</span><span class="sxs-lookup"><span data-stu-id="4c557-110">However, other types of audio applications might find loopback mode useful for capturing the system mix that is being played by the audio engine.</span></span>

<span data-ttu-id="4c557-111">En el ejemplo de código de la [captura de una secuencia](capturing-a-stream.md), la función RecordAudioStream se puede modificar fácilmente para configurar una secuencia de captura en modo de bucle invertido.</span><span class="sxs-lookup"><span data-stu-id="4c557-111">In the code example in [Capturing a Stream](capturing-a-stream.md), the RecordAudioStream function can be easily modified to configure a loopback-mode capture stream.</span></span> <span data-ttu-id="4c557-112">Las modificaciones necesarias son:</span><span class="sxs-lookup"><span data-stu-id="4c557-112">The required modifications are:</span></span>

-   <span data-ttu-id="4c557-113">En la llamada al método [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) , cambie el primer parámetro (*flujo de entrada*) de eCapture a eRender.</span><span class="sxs-lookup"><span data-stu-id="4c557-113">In the call to the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method, change the first parameter (*dataFlow*) from eCapture to eRender.</span></span>
-   <span data-ttu-id="4c557-114">En la llamada al método [**IAudioClient:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) , cambie el valor del segundo parámetro (*StreamFlags*) de 0 a AUDCLNT \_ StreamFlags \_ loopback.</span><span class="sxs-lookup"><span data-stu-id="4c557-114">In the call to the [**IAudioClient::Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) method, change the value of the second parameter (*StreamFlags*) from 0 to AUDCLNT\_STREAMFLAGS\_LOOPBACK.</span></span>

<span data-ttu-id="4c557-115">En las versiones de Windows anteriores a Windows 10 1703, el cliente de captura de modo de extracción no recibe ningún evento cuando una secuencia se inicializa con el almacenamiento en búfer basado en eventos y está habilitada para bucles invertidos.</span><span class="sxs-lookup"><span data-stu-id="4c557-115">In versions of Windows prior to Windows 10 1703, pull-mode capture client does not receive any events when a stream is initialized with event-driven buffering and is loopback-enabled.</span></span> <span data-ttu-id="4c557-116">Para evitar esto, inicialice una secuencia de representación en modo basado en eventos.</span><span class="sxs-lookup"><span data-stu-id="4c557-116">To work around this, initialize a render stream in event-driven mode.</span></span> <span data-ttu-id="4c557-117">Cada vez que el cliente recibe un evento para la secuencia de representación, debe indicar al cliente de captura que ejecute el subproceso de captura que lee el siguiente conjunto de muestras del búfer del extremo de captura.</span><span class="sxs-lookup"><span data-stu-id="4c557-117">Each time the client receives an event for the render stream, it must signal the capture client to run the capture thread that reads the next set of samples from the capture endpoint buffer.</span></span> <span data-ttu-id="4c557-118">En las versiones 1703 y posteriores de Windows 10, se admiten clientes de bucle invertido orientados a eventos y ya no se necesita la solución que implique la secuencia de representación.</span><span class="sxs-lookup"><span data-stu-id="4c557-118">In Windows 10 versions 1703 and higher, event-driven loopback clients are supported, and no longer need the workaround involving the render stream.</span></span>  

<span data-ttu-id="4c557-119">Un cliente puede habilitar el modo de bucle invertido solo para un flujo en modo compartido (AUDCLNT \_ SHAREMODE \_ Shared).</span><span class="sxs-lookup"><span data-stu-id="4c557-119">A client can enable loopback mode only for a shared-mode stream (AUDCLNT\_SHAREMODE\_SHARED).</span></span> <span data-ttu-id="4c557-120">Los flujos de modo exclusivo no pueden funcionar en modo de bucle invertido.</span><span class="sxs-lookup"><span data-stu-id="4c557-120">Exclusive-mode streams cannot operate in loopback mode.</span></span>

<span data-ttu-id="4c557-121">La implementación de bucle invertido por WASAPI depende de las capacidades del hardware.</span><span class="sxs-lookup"><span data-stu-id="4c557-121">The implementation of loopback by WASAPI depend on the capabilities of the hardware.</span></span> <span data-ttu-id="4c557-122">Si el hardware admite un PIN de bucle invertido en el punto de conexión de representación, WASAPI usa el audio proporcionado en este pin para la secuencia de bucle invertido.</span><span class="sxs-lookup"><span data-stu-id="4c557-122">If the hardware supports a loopback pin on the render endpoint, WASAPI uses the audio provided on this pin for the loopback stream.</span></span> <span data-ttu-id="4c557-123">Cuando el hardware no admite un PIN de bucle invertido, WASAPI copia el flujo de salida del motor de audio en el búfer de captura de la aplicación de bucle invertido, además de copiar los datos de audio en el PIN de representación del hardware.</span><span class="sxs-lookup"><span data-stu-id="4c557-123">When the hardware does not support a loopback pin, WASAPI copies the output stream from the audio engine into the loopback application's capture buffer, in addition to copying the audio data to the hardware's render pin.</span></span>

<span data-ttu-id="4c557-124">Algunos proveedores de hardware implementan dispositivos de bucle invertido (en lugar de anclar instancias en dispositivos de representación) en sus adaptadores de audio.</span><span class="sxs-lookup"><span data-stu-id="4c557-124">Some hardware vendors implement loopback devices (as opposed to pin instances on render devices) in their audio adapters.</span></span> <span data-ttu-id="4c557-125">Aunque los dispositivos de bucle invertido de hardware tienen una operación similar en el modo de bucle invertido WASAPI, pueden ser más difíciles de usar.</span><span class="sxs-lookup"><span data-stu-id="4c557-125">Although hardware loopback devices are similar in operation to the WASAPI loopback mode, they can be more difficult to use.</span></span>

<span data-ttu-id="4c557-126">Los dispositivos de bucle invertido de hardware tienen las siguientes desventajas para las aplicaciones de audio:</span><span class="sxs-lookup"><span data-stu-id="4c557-126">Hardware loopback devices have the following disadvantages for audio applications:</span></span>

-   <span data-ttu-id="4c557-127">No todos los adaptadores de audio tienen dispositivos de bucle invertido.</span><span class="sxs-lookup"><span data-stu-id="4c557-127">Not all audio adapters have loopback devices.</span></span> <span data-ttu-id="4c557-128">Por lo tanto, las aplicaciones que dependen de ellos no funcionarán en todos los sistemas.</span><span class="sxs-lookup"><span data-stu-id="4c557-128">Thus, applications that depend on them will not work on all systems.</span></span>
-   <span data-ttu-id="4c557-129">Para que una aplicación pueda grabar desde un dispositivo de bucle invertido, el usuario debe identificar el dispositivo de bucle invertido y habilitarlo para su uso.</span><span class="sxs-lookup"><span data-stu-id="4c557-129">Before an application can record from a loopback device, the user must identify the loopback device and enable it for use.</span></span>

<span data-ttu-id="4c557-130">Distintos proveedores asignan nombres diferentes a sus dispositivos de bucle invertido de hardware.</span><span class="sxs-lookup"><span data-stu-id="4c557-130">Different vendors assign different names to their hardware loopback devices.</span></span> <span data-ttu-id="4c557-131">Los nombres siguientes son ejemplos:</span><span class="sxs-lookup"><span data-stu-id="4c557-131">The following names are examples:</span></span>

-   <span data-ttu-id="4c557-132">Mezcla estéreo</span><span class="sxs-lookup"><span data-stu-id="4c557-132">Stereo Mix</span></span>
-   <span data-ttu-id="4c557-133">Combinación de WaveOut</span><span class="sxs-lookup"><span data-stu-id="4c557-133">Waveout Mix</span></span>
-   <span data-ttu-id="4c557-134">Salida mixta</span><span class="sxs-lookup"><span data-stu-id="4c557-134">Mixed Output</span></span>
-   <span data-ttu-id="4c557-135">Qué oye</span><span class="sxs-lookup"><span data-stu-id="4c557-135">What You Hear</span></span>

<span data-ttu-id="4c557-136">La falta de nombres normalizados puede hacer que los usuarios tengan dificultades para identificar un dispositivo de bucle invertido en una lista de nombres de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="4c557-136">The lack of standardized names might cause users to have difficulty identifying a loopback device in a list of device names.</span></span>

<span data-ttu-id="4c557-137">Un dispositivo de bucle invertido de hardware es un dispositivo de captura.</span><span class="sxs-lookup"><span data-stu-id="4c557-137">A hardware loopback device is a capture device.</span></span> <span data-ttu-id="4c557-138">Por lo tanto, si un adaptador es compatible con un dispositivo de bucle invertido, una aplicación de audio puede grabar desde el dispositivo de la misma manera que se registra desde cualquier otro dispositivo de captura.</span><span class="sxs-lookup"><span data-stu-id="4c557-138">Thus, if an adapter supports a loopback device, an audio application can record from the device in the same way that it records from any other capture device.</span></span>

<span data-ttu-id="4c557-139">Por ejemplo, si selecciona un dispositivo de bucle invertido de hardware para que sea el dispositivo de captura predeterminado, puede usar la función RecordAudioStream (sin modificación) en el ejemplo de código en la [captura de una secuencia](capturing-a-stream.md) para capturar la secuencia desde el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="4c557-139">For example, if you select a hardware loopback device to be the default capture device, you can use the RecordAudioStream function (without modification) in the code example in [Capturing a Stream](capturing-a-stream.md) to capture the stream from the device.</span></span> <span data-ttu-id="4c557-140">(También puede usar una API de audio heredada, como las funciones de **waveInXxx** multimedia de Windows, para capturar el flujo del dispositivo).</span><span class="sxs-lookup"><span data-stu-id="4c557-140">(You can also use a legacy audio API, such as the Windows multimedia **waveInXxx** functions, to capture the stream from the device.)</span></span>

<span data-ttu-id="4c557-141">Si el adaptador de audio contiene un dispositivo de bucle invertido de hardware, puede usar el panel de control multimedia de Windows, Mmsys.cpl, para designar el dispositivo como el dispositivo de captura predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4c557-141">If your audio adapter contains a hardware loopback device, you can use the Windows multimedia control panel, Mmsys.cpl, to designate the device as the default capture device.</span></span> <span data-ttu-id="4c557-142">Los pasos son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="4c557-142">The steps are as follows:</span></span>

1.  <span data-ttu-id="4c557-143">Para ejecutar Mmsys.cpl, abra una ventana del símbolo del sistema y escriba el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="4c557-143">To run Mmsys.cpl, open a Command Prompt window and enter the following command:</span></span>

    ```C++
    control mmsys.cpl,,1
    ```

    

    <span data-ttu-id="4c557-144">Como alternativa, puede ejecutar Mmsys.cpl haciendo clic con el botón secundario en el icono de altavoz en el área de notificación, que se encuentra en el lado derecho de la barra de tareas, y seleccionando **grabar dispositivos**.</span><span class="sxs-lookup"><span data-stu-id="4c557-144">Alternatively, you can run Mmsys.cpl by right-clicking the speaker icon in the notification area, which is located on the right side of the taskbar, and selecting **Recording Devices**.</span></span>

2.  <span data-ttu-id="4c557-145">Una vez que se abra la ventana de Mmsys.cpl, haga clic con el botón secundario en cualquier parte de la lista de dispositivos de grabación y compruebe que la opción **Mostrar dispositivos deshabilitados** está activada.</span><span class="sxs-lookup"><span data-stu-id="4c557-145">After the Mmsys.cpl window opens, right-click anywhere in the list of recording devices and verify that the **Show Disabled Devices** option is checked.</span></span> <span data-ttu-id="4c557-146">(De lo contrario, si el dispositivo de bucle invertido está deshabilitado, no aparecerá en la lista).</span><span class="sxs-lookup"><span data-stu-id="4c557-146">(Otherwise, if the loopback device is disabled, it will not appear in the list.)</span></span>
3.  <span data-ttu-id="4c557-147">Examine la lista de dispositivos de grabación para buscar el dispositivo de bucle invertido (si existe).</span><span class="sxs-lookup"><span data-stu-id="4c557-147">Browse the list of recording devices to locate the loopback device (if it exists).</span></span> <span data-ttu-id="4c557-148">Si el dispositivo de bucle invertido está deshabilitado, habilítelo haciendo clic con el botón secundario en el dispositivo y haciendo clic en **Habilitar**.</span><span class="sxs-lookup"><span data-stu-id="4c557-148">If the loopback device is disabled, enable it by right-clicking the device and clicking **Enable**.</span></span>
4.  <span data-ttu-id="4c557-149">Por último, para seleccionar el dispositivo de bucle invertido como dispositivo de captura predeterminado, haga clic con el botón derecho en el dispositivo y haga clic en **establecer como dispositivo predeterminado**.</span><span class="sxs-lookup"><span data-stu-id="4c557-149">Finally, to select the loopback device to be the default capture device, right-click the device and click **Set as Default Device**.</span></span>

<span data-ttu-id="4c557-150">WASAPI admite la grabación de bucle invertido independientemente de si el hardware de audio contiene un dispositivo de bucle invertido o si el usuario ha habilitado el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="4c557-150">WASAPI supports loopback recording regardless of whether the audio hardware contains a loopback device, or whether the user has enabled the device.</span></span>

<span data-ttu-id="4c557-151">Windows Vista ofrece administración de derechos digitales (DRM).</span><span class="sxs-lookup"><span data-stu-id="4c557-151">Windows Vista provides digital rights management (DRM).</span></span> <span data-ttu-id="4c557-152">Los proveedores de contenido se basan en DRM para proteger su música de su propiedad u otro contenido de la copia no autorizada y otros usos no válidos.</span><span class="sxs-lookup"><span data-stu-id="4c557-152">Content providers rely on DRM to protect their proprietary music or other content from unauthorized copying and other illegal uses.</span></span> <span data-ttu-id="4c557-153">De forma similar, un controlador de audio de confianza no permite que un dispositivo de bucle invertido Capture secuencias digitales que contengan contenido protegido.</span><span class="sxs-lookup"><span data-stu-id="4c557-153">Similarly, a trusted audio driver does not permit a loopback device to capture digital streams that contain protected content.</span></span> <span data-ttu-id="4c557-154">Windows Vista solo permite a los controladores de confianza reproducir contenido protegido.</span><span class="sxs-lookup"><span data-stu-id="4c557-154">Windows Vista allows only trusted drivers to play protected content.</span></span> <span data-ttu-id="4c557-155">Para obtener más información acerca de los controladores de confianza y DRM, consulte la documentación de DDK de Windows.</span><span class="sxs-lookup"><span data-stu-id="4c557-155">For more information about trusted drivers and DRM, see the Windows DDK documentation.</span></span>

<span data-ttu-id="4c557-156">WASAPI loopback contiene la combinación de todo el audio que se está reproduciendo, independientemente de la sesión de Terminal Services de la que se originó el audio.</span><span class="sxs-lookup"><span data-stu-id="4c557-156">WASAPI loopback contains the mix of all audio being played, regardless of the Terminal Services session the audio originated from.</span></span> <span data-ttu-id="4c557-157">Por ejemplo, puede ejecutar un cliente de bucle invertido en un servicio que se ejecuta en la sesión 0 y capturar audio de todas las sesiones de usuario, así como el audio que se reproduce desde la sesión 0.</span><span class="sxs-lookup"><span data-stu-id="4c557-157">For example, you can run a loopback client in a service running in session 0 and capture audio from all user sessions, as well as audio being played from session 0.</span></span>

<span data-ttu-id="4c557-158">Escritorio remoto permite redirigir el audio al cliente.</span><span class="sxs-lookup"><span data-stu-id="4c557-158">Remote Desktop allows redirecting audio to the client.</span></span> <span data-ttu-id="4c557-159">Esto se implementa mediante la creación de nuevos dispositivos de audio que solo aparecen para esa sesión.</span><span class="sxs-lookup"><span data-stu-id="4c557-159">This is implemented by creating new audio devices that only appear for that session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4c557-160">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="4c557-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4c557-161">Administración de flujos</span><span class="sxs-lookup"><span data-stu-id="4c557-161">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



