---
description: Entrega de ejemplos
ms.assetid: 31aabb6d-dec6-41fa-b24d-35a77b67bc4a
title: Entrega de ejemplos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 083bc8c88649c04bdf9f93f86ebcc277ee48e75e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "104423164"
---
# <a name="delivering-samples"></a><span data-ttu-id="d4651-103">Entrega de ejemplos</span><span class="sxs-lookup"><span data-stu-id="d4651-103">Delivering Samples</span></span>

<span data-ttu-id="d4651-104">En este artículo se describe cómo un filtro proporciona un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="d4651-104">This article describes how a filter delivers a sample.</span></span> <span data-ttu-id="d4651-105">Describe el modelo de inserción, el uso de métodos [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) y el modelo de extracción mediante [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span><span class="sxs-lookup"><span data-stu-id="d4651-105">It describes both the push model, using [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) methods, and the pull model, using [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span></span>

<span data-ttu-id="d4651-106">**Modelo de envío: entrega de un ejemplo**</span><span class="sxs-lookup"><span data-stu-id="d4651-106">**Push Model: Delivering a Sample**</span></span>

<span data-ttu-id="d4651-107">El PIN de salida proporciona una muestra llamando al método [**IMemInputPin:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) o al método [**IMemInputPin:: ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) , que es equivalente pero proporciona una matriz de ejemplos.</span><span class="sxs-lookup"><span data-stu-id="d4651-107">The output pin delivers a sample by calling the [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) method or the [**IMemInputPin::ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) method, which is equivalent but delivers an array of samples.</span></span> <span data-ttu-id="d4651-108">El PIN de entrada puede bloquearse dentro de la **recepción** (o **ReceiveMultiple**).</span><span class="sxs-lookup"><span data-stu-id="d4651-108">The input pin can block inside **Receive** (or **ReceiveMultiple**).</span></span> <span data-ttu-id="d4651-109">Si el PIN podría bloquearse, su método [**IMemInputPin:: ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) debe devolver S \_ correcto.</span><span class="sxs-lookup"><span data-stu-id="d4651-109">If the pin might block, its [**IMemInputPin::ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) method should return S\_OK.</span></span> <span data-ttu-id="d4651-110">Si el PIN no garantiza nunca el bloqueo, **ReceiveCanBlock** debe devolver S \_ false.</span><span class="sxs-lookup"><span data-stu-id="d4651-110">If the pin guarantees never to block, **ReceiveCanBlock** should return S\_FALSE.</span></span> <span data-ttu-id="d4651-111">El \_ valor devuelto de S correcto no significa que **reciba** siempre bloques, solo que podría.</span><span class="sxs-lookup"><span data-stu-id="d4651-111">The S\_OK return value does not mean that **Receive** always blocks, just that it might.</span></span>

<span data-ttu-id="d4651-112">Aunque **Receive** puede bloquearse para esperar a que un recurso esté disponible, no debe bloquearse para esperar más datos del filtro de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="d4651-112">Although **Receive** can block to wait for a resource to become available, it should not block to wait for more data from the upstream filter.</span></span> <span data-ttu-id="d4651-113">Si lo hace, puede producirse un interbloqueo en el que el filtro ascendente espera a que el filtro de nivel inferior libere el ejemplo, lo que nunca sucede porque el filtro de nivel inferior está esperando en el filtro de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="d4651-113">Doing so can cause a deadlock where the upstream filter waits for the downstream filter to release the sample, which never happens because the downstream filter is waiting on the upstream filter.</span></span> <span data-ttu-id="d4651-114">Sin embargo, si un filtro tiene varios PIN de entrada, un pin puede esperar a que otro PIN reciba datos.</span><span class="sxs-lookup"><span data-stu-id="d4651-114">If a filter has multiple input pins, however, one pin can wait for another pin to receive data.</span></span> <span data-ttu-id="d4651-115">Por ejemplo, el filtro de [AVI MUX](avi-mux-filter.md) hace esto para que pueda intercalar datos de audio y vídeo.</span><span class="sxs-lookup"><span data-stu-id="d4651-115">For example, the [AVI Mux](avi-mux-filter.md) filter does this so that it can interleave audio and video data.</span></span>

<span data-ttu-id="d4651-116">Un PIN podría rechazar un ejemplo por una serie de motivos:</span><span class="sxs-lookup"><span data-stu-id="d4651-116">A pin might reject a sample for a number of reasons:</span></span>

-   <span data-ttu-id="d4651-117">El PIN se está vaciando (vea el [vaciado](flushing.md)).</span><span class="sxs-lookup"><span data-stu-id="d4651-117">The pin is flushing (see [Flushing](flushing.md)).</span></span>
-   <span data-ttu-id="d4651-118">El PIN no está conectado.</span><span class="sxs-lookup"><span data-stu-id="d4651-118">The pin is not connected.</span></span>
-   <span data-ttu-id="d4651-119">El filtro está detenido.</span><span class="sxs-lookup"><span data-stu-id="d4651-119">The filter is stopped.</span></span>
-   <span data-ttu-id="d4651-120">Se produjo algún otro error.</span><span class="sxs-lookup"><span data-stu-id="d4651-120">Some other error occurred.</span></span>

<span data-ttu-id="d4651-121">El método **Receive** debe devolver S \_ false en el primer caso y un código de error en los demás casos.</span><span class="sxs-lookup"><span data-stu-id="d4651-121">The **Receive** method should return S\_FALSE in the first case, and a failure code in the other cases.</span></span> <span data-ttu-id="d4651-122">El filtro de nivel superior debe dejar de enviar ejemplos cuando el código de retorno es distinto de S \_ correcto.</span><span class="sxs-lookup"><span data-stu-id="d4651-122">The upstream filter should stop sending samples when the return code is anything other than S\_OK.</span></span>

<span data-ttu-id="d4651-123">Puede considerar que los tres primeros casos son errores "esperados", en el sentido de que el filtro se encontraba en un estado incorrecto para recibir ejemplos.</span><span class="sxs-lookup"><span data-stu-id="d4651-123">You can consider the first three cases to be "expected" failures, in the sense that the filter was in the wrong state to receive samples.</span></span> <span data-ttu-id="d4651-124">Un error inesperado sería el que provocaría que el PIN rechazara un ejemplo aunque el PIN esté en un estado de recepción.</span><span class="sxs-lookup"><span data-stu-id="d4651-124">An unexpected failure would be one that causes the pin to reject a sample even though the pin is in a receiving state.</span></span> <span data-ttu-id="d4651-125">Si se produce un error de este tipo, el PIN debe enviar una notificación de final de secuencia de nivel inferior y enviar un evento [**\_ ERRORABORT de EC**](ec-errorabort.md) al administrador de gráficos de filtro.</span><span class="sxs-lookup"><span data-stu-id="d4651-125">If an error of this type occurs, the pin should send an end-of-stream notification downstream, and send an [**EC\_ERRORABORT**](ec-errorabort.md) event to the Filter Graph Manager.</span></span>

<span data-ttu-id="d4651-126">En las clases base de DirectShow, el método [**CBaseInputPin:: CheckStreaming**](cbaseinputpin-checkstreaming.md) comprueba los casos de error generales: vaciado, detenido, etc.</span><span class="sxs-lookup"><span data-stu-id="d4651-126">In the DirectShow base classes, the [**CBaseInputPin::CheckStreaming**](cbaseinputpin-checkstreaming.md) method checks for the general failure cases—flushing, stopped, and so forth.</span></span> <span data-ttu-id="d4651-127">La clase derivada deberá comprobar si hay errores que sean específicos del filtro.</span><span class="sxs-lookup"><span data-stu-id="d4651-127">The derived class will need to check for failures that are specific to the filter.</span></span> <span data-ttu-id="d4651-128">En caso de error, el método [**CBaseInputPin:: Receive**](cbaseinputpin-receive.md) envía la notificación de final de secuencia y el \_ evento ERRORABORT de EC.</span><span class="sxs-lookup"><span data-stu-id="d4651-128">In case of an error, the [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method sends the end-of-stream notification and the EC\_ERRORABORT event.</span></span>

<span data-ttu-id="d4651-129">**Modelo de extracción: solicitar un ejemplo**</span><span class="sxs-lookup"><span data-stu-id="d4651-129">**Pull Model: Requesting a Sample**</span></span>

<span data-ttu-id="d4651-130">En la interfaz **IAsyncReader** , el PIN de entrada solicita ejemplos del PIN de salida llamando a uno de los métodos siguientes:</span><span class="sxs-lookup"><span data-stu-id="d4651-130">In the **IAsyncReader** interface, the input pin requests samples from the output pin by calling one of the following methods:</span></span>

-   [<span data-ttu-id="d4651-131">**IAsyncReader:: Request**</span><span class="sxs-lookup"><span data-stu-id="d4651-131">**IAsyncReader::Request**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-request)
-   [<span data-ttu-id="d4651-132">**IAsyncReader::SyncRead**</span><span class="sxs-lookup"><span data-stu-id="d4651-132">**IAsyncReader::SyncRead**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncread)
-   [<span data-ttu-id="d4651-133">**IAsyncReader::SyncReadAligned**</span><span class="sxs-lookup"><span data-stu-id="d4651-133">**IAsyncReader::SyncReadAligned**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncreadaligned)

<span data-ttu-id="d4651-134">El método de **solicitud** es asincrónico; el PIN de entrada llama a [**IAsyncReader:: WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) para esperar a que se complete la solicitud.</span><span class="sxs-lookup"><span data-stu-id="d4651-134">The **Request** method is asynchronous; the input pin calls [**IAsyncReader::WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) to wait for the request to complete.</span></span> <span data-ttu-id="d4651-135">Los otros dos métodos son sincrónicos.</span><span class="sxs-lookup"><span data-stu-id="d4651-135">The other two methods are synchronous.</span></span>

<span data-ttu-id="d4651-136">**Cuándo enviar datos**</span><span class="sxs-lookup"><span data-stu-id="d4651-136">**When to Deliver Data**</span></span>

<span data-ttu-id="d4651-137">Un filtro siempre entrega los ejemplos mientras se encuentra en el estado en ejecución.</span><span class="sxs-lookup"><span data-stu-id="d4651-137">A filter always delivers samples while it is in the running state.</span></span> <span data-ttu-id="d4651-138">En la mayoría de los casos, un filtro también proporciona ejemplos mientras están en pausa.</span><span class="sxs-lookup"><span data-stu-id="d4651-138">In most cases, a filter also delivers samples while paused.</span></span> <span data-ttu-id="d4651-139">Esto permite que el gráfico señale los datos para que la reproducción se inicie inmediatamente cuando se llame a **Run** (consulte [Estados de filtro](filter-states.md)).</span><span class="sxs-lookup"><span data-stu-id="d4651-139">This enables the graph to cue up the data so that playback starts immediately when **Run** is called (see [Filter States](filter-states.md)).</span></span> <span data-ttu-id="d4651-140">Si el filtro no entrega datos mientras está en pausa, el método **IMediaFilter:: GetState** del filtro debe devolver \_ la indicación VFW s \_ peralte \_ en el estado pausado.</span><span class="sxs-lookup"><span data-stu-id="d4651-140">If your filter does not deliver data while paused, the filter's **IMediaFilter::GetState** method should return VFW\_S\_CANT\_CUE in the paused state.</span></span> <span data-ttu-id="d4651-141">Este código de retorno indica al gráfico de filtro que no espere los datos del filtro antes de completar la transición de pausa.</span><span class="sxs-lookup"><span data-stu-id="d4651-141">This return code signals the filter graph not to wait for data from your filter before it completes the pause transition.</span></span> <span data-ttu-id="d4651-142">De lo contrario, el método **PAUSE** se bloqueará indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="d4651-142">Otherwise, the **Pause** method will block indefinitely.</span></span> <span data-ttu-id="d4651-143">Para obtener código de ejemplo, vea [**CBaseFilter:: GetState**](cbasefilter-getstate.md).</span><span class="sxs-lookup"><span data-stu-id="d4651-143">For example code, see [**CBaseFilter::GetState**](cbasefilter-getstate.md).</span></span>

<span data-ttu-id="d4651-144">Estos son algunos ejemplos de Cuándo puede ser necesario que un filtro devuelva la indicación de no \_ \_ peralte de VFW \_ :</span><span class="sxs-lookup"><span data-stu-id="d4651-144">Here are some examples of when a filter might need to return VFW\_S\_CANT\_CUE:</span></span>

-   <span data-ttu-id="d4651-145">Los orígenes en directo, como los filtros de captura, no deben enviar datos mientras están en pausa.</span><span class="sxs-lookup"><span data-stu-id="d4651-145">Live sources, such as capture filters, should not send data while paused.</span></span> <span data-ttu-id="d4651-146">Vea [generar datos en un filtro de captura](producing-data-in-a-capture-filter.md).</span><span class="sxs-lookup"><span data-stu-id="d4651-146">See [Producing Data in a Capture Filter](producing-data-in-a-capture-filter.md).</span></span>
-   <span data-ttu-id="d4651-147">Un filtro divisor podría o no enviar datos mientras están en pausa, dependiendo de la implementación.</span><span class="sxs-lookup"><span data-stu-id="d4651-147">A splitter filter might or might not send data while paused, depending on the implementation.</span></span> <span data-ttu-id="d4651-148">Si el filtro usa subprocesos independientes para poner en cola los datos en cada terminal de salida, puede enviar datos mientras están en pausa.</span><span class="sxs-lookup"><span data-stu-id="d4651-148">If the filter uses separate threads to queue data on each output pin, then it can send data while paused.</span></span> <span data-ttu-id="d4651-149">Pero si el filtro usa un solo subproceso para cada pin de salida, el primer PIN podría bloquear el subproceso cuando llame a **Receive**, lo que impedirá que los demás PIN envíen datos.</span><span class="sxs-lookup"><span data-stu-id="d4651-149">But if the filter uses a single thread for every output pin, the first pin might block the thread when it calls **Receive**, which will prevent the other pins from sending data.</span></span> <span data-ttu-id="d4651-150">En ese caso, debe devolver la \_ indicación VFW S \_ peralte \_ .</span><span class="sxs-lookup"><span data-stu-id="d4651-150">In that case, you should return VFW\_S\_CANT\_CUE.</span></span>
-   <span data-ttu-id="d4651-151">Un filtro podría proporcionar datos esporádicamente.</span><span class="sxs-lookup"><span data-stu-id="d4651-151">A filter might deliver data sporadically.</span></span> <span data-ttu-id="d4651-152">Por ejemplo, puede analizar un flujo de datos personalizado y filtrar algunos paquetes mientras entrega otros.</span><span class="sxs-lookup"><span data-stu-id="d4651-152">For example, it might parse a custom data stream and filter out some packets while delivering others.</span></span> <span data-ttu-id="d4651-153">En ese caso, es posible que no se garantice que el filtro entregue datos mientras esté en pausa.</span><span class="sxs-lookup"><span data-stu-id="d4651-153">In that case, the filter may not be guaranteed to deliver data while paused.</span></span>

<span data-ttu-id="d4651-154">Un filtro de origen (con el modelo de inserción) o un filtro de analizador (mediante el modelo de inserción/extracción) crea uno o más subprocesos de streaming, que proporcionan ejemplos lo más rápido posible.</span><span class="sxs-lookup"><span data-stu-id="d4651-154">A source filter (using the push model) or a parser filter (using the push/pull model) creates one or more streaming threads, which deliver samples as quickly as possible.</span></span> <span data-ttu-id="d4651-155">Los filtros de nivel inferior, como descodificadores y transformaciones, normalmente envían datos solo cuando se llama a **Receive** en sus clavijas de entrada.</span><span class="sxs-lookup"><span data-stu-id="d4651-155">Downstream filters, such as decoders and transforms, typically send data only when **Receive** is called on their input pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d4651-156">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d4651-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d4651-157">Recibir y entregar ejemplos</span><span class="sxs-lookup"><span data-stu-id="d4651-157">Receiving and Delivering Samples</span></span>](receiving-and-delivering-samples.md)
</dt> </dl>

 

 



