---
description: Windows proporciona las API que puede usar para adquirir marcas de tiempo de alta resolución o intervalos de tiempo de medida.
ms.assetid: D66E0FC2-3AF2-489B-B4B5-78648905B77B
title: Adquisición de marcas de tiempo de alta resolución
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c9a1300967738b717ab8d8c822bf2af3f6a4a7ed
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104003211"
---
# <a name="acquiring-high-resolution-time-stamps"></a><span data-ttu-id="dc104-103">Adquisición de marcas de tiempo de alta resolución</span><span class="sxs-lookup"><span data-stu-id="dc104-103">Acquiring high-resolution time stamps</span></span>

<span data-ttu-id="dc104-104">Windows proporciona las API que puede usar para adquirir marcas de tiempo de alta resolución o intervalos de tiempo de medida.</span><span class="sxs-lookup"><span data-stu-id="dc104-104">Windows provides APIs that you can use to acquire high-resolution time stamps or measure time intervals.</span></span> <span data-ttu-id="dc104-105">La API principal para código nativo es [**QueryPerformanceCounter (QPC)**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-105">The primary API for native code is [**QueryPerformanceCounter (QPC)**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-106">En el caso de los controladores de dispositivo, la API de modo kernel es [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-106">For device drivers, the kernel-mode API is [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter).</span></span> <span data-ttu-id="dc104-107">En el caso de código administrado, la clase [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) usa **QPC** como la hora exacta.</span><span class="sxs-lookup"><span data-stu-id="dc104-107">For managed code, the [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class uses **QPC** as its precise time basis.</span></span>

<span data-ttu-id="dc104-108">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) es independiente de y no se sincroniza con ninguna referencia de hora externa.</span><span class="sxs-lookup"><span data-stu-id="dc104-108">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is independent of and isn't synchronized to any external time reference.</span></span> <span data-ttu-id="dc104-109">Para recuperar las marcas de tiempo que se pueden sincronizar con una referencia de hora externa, como la hora universal coordinada (UTC) para su uso en las mediciones de la hora del día de alta resolución, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="dc104-109">To retrieve time stamps that can be synchronized to an external time reference, such as, Coordinated Universal Time (UTC) for use in high-resolution time-of-day measurements, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span>

<span data-ttu-id="dc104-110">Las marcas de tiempo y las medidas de intervalo de tiempo son una parte integral de las medidas de rendimiento de la red y del equipo.</span><span class="sxs-lookup"><span data-stu-id="dc104-110">Time stamps and time-interval measurements are an integral part of computer and network performance measurements.</span></span> <span data-ttu-id="dc104-111">Estas operaciones de medición de rendimiento incluyen el cálculo del tiempo de respuesta, el rendimiento y la latencia, así como la generación de perfiles de la ejecución de código.</span><span class="sxs-lookup"><span data-stu-id="dc104-111">These performance measurement operations include the computation of response time, throughput, and latency as well as profiling code execution.</span></span> <span data-ttu-id="dc104-112">Cada una de estas operaciones implica una medición de las actividades que se producen durante un intervalo de tiempo definido por un evento de inicio y de finalización que puede ser independiente de cualquier referencia de hora del día externa.</span><span class="sxs-lookup"><span data-stu-id="dc104-112">Each of these operations involves a measurement of activities that occur during a time interval that is defined by a start and an end event that can be independent of any external time-of-day reference.</span></span>

<span data-ttu-id="dc104-113">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) es normalmente el mejor método que se usa para los eventos de marca de tiempo y mide los pequeños intervalos de tiempo que se producen en el mismo sistema o máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="dc104-113">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is typically the best method to use to time-stamp events and measure small time intervals that occur on the same system or virtual machine.</span></span> <span data-ttu-id="dc104-114">Considere la posibilidad de usar [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) cuando desee realizar una marca de tiempo de los eventos en varios equipos, siempre que cada equipo participe en un esquema de sincronización de hora como el protocolo de tiempo de red (NTP).</span><span class="sxs-lookup"><span data-stu-id="dc104-114">Consider using [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) when you want to time-stamp events across multiple machines, provided that each machine is participating in a time synchronization scheme such as Network Time Protocol (NTP).</span></span> <span data-ttu-id="dc104-115">**QPC** ayuda a evitar dificultades que se pueden encontrar con otros enfoques de medición de tiempo, como la lectura directa del contador de marca de tiempo del procesador (TSC).</span><span class="sxs-lookup"><span data-stu-id="dc104-115">**QPC** helps you avoid difficulties that can be encountered with other time measurement approaches, such as reading the processor’s time stamp counter (TSC) directly.</span></span>

-   [<span data-ttu-id="dc104-116">Compatibilidad con QPC en versiones de Windows</span><span class="sxs-lookup"><span data-stu-id="dc104-116">QPC support in Windows versions</span></span>](#qpc-support-in-windows-versions)
-   [<span data-ttu-id="dc104-117">Instrucciones para adquirir marcas de tiempo</span><span class="sxs-lookup"><span data-stu-id="dc104-117">Guidance for acquiring time stamps</span></span>](#guidance-for-acquiring-time-stamps)
    -   [<span data-ttu-id="dc104-118">Virtualización</span><span class="sxs-lookup"><span data-stu-id="dc104-118">Virtualization</span></span>](#virtualization)
    -   [<span data-ttu-id="dc104-119">Uso de TSC directo</span><span class="sxs-lookup"><span data-stu-id="dc104-119">Direct TSC usage</span></span>](#direct-tsc-usage)
    -   [<span data-ttu-id="dc104-120">Ejemplos para adquirir marcas de tiempo</span><span class="sxs-lookup"><span data-stu-id="dc104-120">Examples for acquiring time stamps</span></span>](#examples-for-acquiring-time-stamps)
-   [<span data-ttu-id="dc104-121">Preguntas más frecuentes sobre QPC y TSC</span><span class="sxs-lookup"><span data-stu-id="dc104-121">General FAQ about QPC and TSC</span></span>](#general-faq-about-qpc-and-tsc)
-   [<span data-ttu-id="dc104-122">Preguntas más frecuentes sobre la programación con QPC y TSC</span><span class="sxs-lookup"><span data-stu-id="dc104-122">FAQ about programming with QPC and TSC</span></span>](#faq-about-programming-with-qpc-and-tsc)
-   [<span data-ttu-id="dc104-123">Características de reloj de hardware de bajo nivel</span><span class="sxs-lookup"><span data-stu-id="dc104-123">Low-level hardware clock characteristics</span></span>](#low-level-hardware-clock-characteristics)
    -   [<span data-ttu-id="dc104-124">Relojes absolutos y relojes de diferencia</span><span class="sxs-lookup"><span data-stu-id="dc104-124">Absolute Clocks and Difference Clocks</span></span>](#absolute-clocks-and-difference-clocks)
    -   [<span data-ttu-id="dc104-125">Resolución, precisión, precisión y estabilidad</span><span class="sxs-lookup"><span data-stu-id="dc104-125">Resolution, Precision, Accuracy, and Stability</span></span>](#resolution-precision-accuracy-and-stability)
-   [<span data-ttu-id="dc104-126">Información del temporizador de hardware</span><span class="sxs-lookup"><span data-stu-id="dc104-126">Hardware timer info</span></span>](#hardware-timer-info)

## <a name="qpc-support-in-windows-versions"></a><span data-ttu-id="dc104-127">Compatibilidad con QPC en versiones de Windows</span><span class="sxs-lookup"><span data-stu-id="dc104-127">QPC support in Windows versions</span></span>

<span data-ttu-id="dc104-128">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) se presentó en Windows 2000 y Windows XP, y ha evolucionado para aprovechar las mejoras en la plataforma de hardware y los procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-128">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) was introduced in Windows 2000 and Windows XP and has evolved to take advantage of improvements in the hardware platform and processors.</span></span> <span data-ttu-id="dc104-129">Aquí se describen las características de **QPC** en diferentes versiones de Windows para ayudarle a mantener el software que se ejecuta en esas versiones de Windows.</span><span class="sxs-lookup"><span data-stu-id="dc104-129">Here we describe the characteristics of **QPC** on different Windows versions to help you maintain software that runs on those Windows versions.</span></span>

### <a name="windows-xp-and-windows-2000"></a><span data-ttu-id="dc104-130">Windows XP y Windows 2000</span><span class="sxs-lookup"><span data-stu-id="dc104-130">Windows XP and Windows 2000</span></span>

<span data-ttu-id="dc104-131">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) está disponible en Windows XP y Windows 2000 y funciona bien en la mayoría de los sistemas.</span><span class="sxs-lookup"><span data-stu-id="dc104-131">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is available on Windows XP and Windows 2000 and works well on most systems.</span></span> <span data-ttu-id="dc104-132">Sin embargo, el BIOS de algunos sistemas de hardware no indicaba correctamente las características de la CPU de hardware (un TSC no invariable) y algunos sistemas de varios núcleos o varios procesadores usaban procesadores con TSCs que no se podían sincronizar entre núcleos.</span><span class="sxs-lookup"><span data-stu-id="dc104-132">However, some hardware systems' BIOS didn't indicate the hardware CPU characteristics correctly (a non-invariant TSC), and some multi-core or multi-processor systems used processors with TSCs that couldn't be synchronized across cores.</span></span> <span data-ttu-id="dc104-133">Los sistemas con firmware defectuoso que ejecuten estas versiones de Windows podrían no proporcionar la misma lectura de **QPC** en diferentes núcleos si usaban el TSC como base para **QPC**.</span><span class="sxs-lookup"><span data-stu-id="dc104-133">Systems with flawed firmware that run these versions of Windows might not provide the same **QPC** reading on different cores if they used the TSC as the basis for **QPC**.</span></span>

### <a name="windows-vista-and-windows-server-2008"></a><span data-ttu-id="dc104-134">Windows Vista y Windows Server 2008</span><span class="sxs-lookup"><span data-stu-id="dc104-134">Windows Vista and Windows Server 2008</span></span>

<span data-ttu-id="dc104-135">Todos los equipos incluidos con Windows Vista y Windows Server 2008 usaban un contador de plataforma (temporizador de eventos de alta precisión (HPET)) o el temporizador de administración de energía de ACPI (temporizador PM) como base para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-135">All computers that shipped with Windows Vista and Windows Server 2008 used a platform counter (High Precision Event Timer (HPET)) or the ACPI Power Management Timer (PM timer) as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-136">Estos temporizadores de plataforma tienen una mayor latencia de acceso que el TSC y se comparten entre varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-136">Such platform timers have higher access latency than the TSC and are shared between multiple processors.</span></span> <span data-ttu-id="dc104-137">Esto limita la escalabilidad de **QPC** si se llama a la vez desde varios procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-137">This limits scalability of **QPC** if it is called concurrently from multiple processors.</span></span>

### <a name="windows-7-and-windows-server-2008-r2"></a><span data-ttu-id="dc104-138">Windows 7 y Windows Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="dc104-138">Windows 7 and Windows Server 2008 R2</span></span>

<span data-ttu-id="dc104-139">La mayoría de los equipos con Windows 7 y Windows Server 2008 R2 tienen procesadores con TSCs de velocidad constante y usan estos contadores como base para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-139">The majority of Windows 7 and Windows Server 2008 R2 computers have processors with constant-rate TSCs and use these counters as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-140">TSCs son contadores de hardware por procesador de alta resolución a los que se puede tener acceso con una latencia y una sobrecarga muy bajas (en el orden de decenas o cientos de ciclos de equipo, en función del tipo de procesador).</span><span class="sxs-lookup"><span data-stu-id="dc104-140">TSCs are high-resolution per-processor hardware counters that can be accessed with very low latency and overhead (in the order of 10s or 100s of machine cycles, depending on the processor type).</span></span> <span data-ttu-id="dc104-141">Windows 7 y Windows Server 2008 R2 usan TSCs como base de **QPC** en sistemas de dominio de un solo reloj en los que el sistema operativo (o el hipervisor) puede sincronizar estrechamente la TSCs individual en todos los procesadores durante la inicialización del sistema.</span><span class="sxs-lookup"><span data-stu-id="dc104-141">Windows 7 and Windows Server 2008 R2 use TSCs as the basis of **QPC** on single-clock domain systems where the operating system (or the hypervisor) is able to tightly synchronize the individual TSCs across all processors during system initialization.</span></span> <span data-ttu-id="dc104-142">En estos sistemas, el costo de leer el contador de rendimiento es significativamente menor en comparación con los sistemas que utilizan un contador de plataforma.</span><span class="sxs-lookup"><span data-stu-id="dc104-142">On such systems, the cost of reading the performance counter is significantly lower compared to systems that use a platform counter.</span></span> <span data-ttu-id="dc104-143">Además, no hay ninguna sobrecarga adicional para las llamadas simultáneas y las consultas en modo de usuario suelen omitir las llamadas del sistema, lo que reduce aún más la sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="dc104-143">Furthermore, there is no added overhead for concurrent calls and user-mode queries often bypass system calls, which further reduces overhead.</span></span> <span data-ttu-id="dc104-144">En los sistemas en los que el TSC no es adecuado para timekeeping, Windows selecciona automáticamente un contador de plataforma (ya sea el temporizador de HPET o el temporizador de la ACPI PM) como base para **QPC**.</span><span class="sxs-lookup"><span data-stu-id="dc104-144">On systems where the TSC is not suitable for timekeeping, Windows automatically selects a platform counter (either the HPET timer or the ACPI PM timer) as the basis for **QPC**.</span></span>

### <a name="windows-8-windows-81-windows-server-2012-and-windows-server-2012-r2"></a><span data-ttu-id="dc104-145">Windows 8, Windows 8.1, Windows Server 2012 y Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="dc104-145">Windows 8, Windows 8.1, Windows Server 2012, and Windows Server 2012 R2</span></span>

<span data-ttu-id="dc104-146">Windows 8, Windows 8.1, Windows Server 2012 y Windows Server 2012 R2 usan TSCs como base para el contador de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="dc104-146">Windows 8, Windows 8.1, Windows Server 2012, and Windows Server 2012 R2 use TSCs as the basis for the performance counter.</span></span> <span data-ttu-id="dc104-147">El algoritmo de sincronización de TSC se mejoró significativamente para adaptarse mejor a los sistemas grandes con muchos procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-147">The TSC synchronization algorithm was significantly improved to better accommodate large systems with many processors.</span></span> <span data-ttu-id="dc104-148">Además, se ha agregado compatibilidad con la nueva API precisa de la hora del día, que permite adquirir marcas de tiempo de reloj de la pared precisas del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="dc104-148">In addition, support for the new precise time-of-day API was added, which enables acquiring precise wall clock time stamps from the operating system.</span></span> <span data-ttu-id="dc104-149">Para obtener más información, consulte [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="dc104-149">For more info, see [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span> <span data-ttu-id="dc104-150">En las plataformas de PC con Windows RT, el contador de rendimiento se basa en un contador de plataforma de propiedad o en el contador del sistema proporcionado por el temporizador genérico de Windows RT PC si la plataforma está equipada.</span><span class="sxs-lookup"><span data-stu-id="dc104-150">On Windows RT PC platforms, the performance counter is based on either a proprietary platform counter or the system counter provided by the Windows RT PC Generic Timer if the platform is so equipped.</span></span>

## <a name="guidance-for-acquiring-time-stamps"></a><span data-ttu-id="dc104-151">Instrucciones para adquirir marcas de tiempo</span><span class="sxs-lookup"><span data-stu-id="dc104-151">Guidance for acquiring time stamps</span></span>

<span data-ttu-id="dc104-152">Windows tiene y seguirá invirtiendo en proporcionar un contador de rendimiento confiable y eficaz.</span><span class="sxs-lookup"><span data-stu-id="dc104-152">Windows has and will continue to invest in providing a reliable and efficient performance counter.</span></span> <span data-ttu-id="dc104-153">Cuando necesite marcas de tiempo con una resolución de 1 microsegundo o superior y no necesite que las marcas de tiempo se sincronicen con una referencia de hora externa, elija [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter)o [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise).</span><span class="sxs-lookup"><span data-stu-id="dc104-153">When you need time stamps with a resolution of 1 microsecond or better and you don't need the time stamps to be synchronized to an external time reference, choose [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter), or [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise).</span></span> <span data-ttu-id="dc104-154">Cuando necesite marcas de tiempo sincronizadas con UTC con una resolución de 1 microsegundo o superior, elija [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) o [**KeQuerySystemTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequerysystemtimeprecise).</span><span class="sxs-lookup"><span data-stu-id="dc104-154">When you need UTC-synchronized time stamps with a resolution of 1 microsecond or better, choose [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) or [**KeQuerySystemTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequerysystemtimeprecise).</span></span>

<span data-ttu-id="dc104-155">En un número relativamente pequeño de plataformas que no pueden usar el registro de TSC como base de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) , por ejemplo, por las razones que se explican en [información del temporizador de hardware](#hardware-timer-info), la adquisición de marcas de tiempo de alta resolución puede ser significativamente más costosa que adquirir marcas de tiempo con una resolución inferior.</span><span class="sxs-lookup"><span data-stu-id="dc104-155">On a relatively small number of platforms that can't use the TSC register as the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) basis, for example, for reasons explained in [Hardware timer info](#hardware-timer-info), acquiring high resolution time stamps can be significantly more expensive than acquiring time stamps with lower resolution.</span></span> <span data-ttu-id="dc104-156">Si la resolución de 10 a 16 milisegundos es suficiente, puede usar [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64), [**QueryInterruptTime**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttime), [**QueryUnbiasedInterruptTime**](/windows/win32/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttime), [**KeQueryInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttime)o [**KeQueryUnbiasedInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryunbiasedinterrupttime) para obtener las marcas de tiempo que no se sincronizan con una referencia de hora externa.</span><span class="sxs-lookup"><span data-stu-id="dc104-156">If resolution of 10 to 16 milliseconds is sufficient, you can use [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64), [**QueryInterruptTime**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttime), [**QueryUnbiasedInterruptTime**](/windows/win32/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttime), [**KeQueryInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttime), or [**KeQueryUnbiasedInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryunbiasedinterrupttime) to obtain time stamps that aren't synchronized to an external time reference.</span></span> <span data-ttu-id="dc104-157">En el caso de las marcas de tiempo sincronizadas con UTC, use [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) o [**KeQuerySystemTime**](/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime~r1).</span><span class="sxs-lookup"><span data-stu-id="dc104-157">For UTC-synchronized time stamps, use [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) or [**KeQuerySystemTime**](/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime~r1).</span></span> <span data-ttu-id="dc104-158">Si es necesaria una resolución mayor, puede usar [**QueryInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttimeprecise), [**QueryUnbiasedInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttimeprecise)o [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise) para obtener las marcas de tiempo en su lugar.</span><span class="sxs-lookup"><span data-stu-id="dc104-158">If higher resolution is needed, you can use [**QueryInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttimeprecise), [**QueryUnbiasedInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttimeprecise), or [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise) to obtain time stamps instead.</span></span>

<span data-ttu-id="dc104-159">En general, los resultados del contador de rendimiento son coherentes en todos los procesadores de los sistemas de varios núcleos y varios procesadores, incluso cuando se miden en diferentes subprocesos o procesos.</span><span class="sxs-lookup"><span data-stu-id="dc104-159">In general, the performance counter results are consistent across all processors in multi-core and multi-processor systems, even when measured on different threads or processes.</span></span> <span data-ttu-id="dc104-160">Estas son algunas excepciones a esta regla:</span><span class="sxs-lookup"><span data-stu-id="dc104-160">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="dc104-161">Los sistemas operativos anteriores a Windows Vista que se ejecutan en determinados procesadores podrían infringir esta coherencia debido a una de estas razones:</span><span class="sxs-lookup"><span data-stu-id="dc104-161">Pre-Windows Vista operating systems that run on certain processors might violate this consistency because of one of these reasons:</span></span>

    -   <span data-ttu-id="dc104-162">Los procesadores de hardware tienen un TSC no invariable y el BIOS no indica correctamente esta condición.</span><span class="sxs-lookup"><span data-stu-id="dc104-162">The hardware processors have a non-invariant TSC and the BIOS doesn't indicate this condition correctly.</span></span>
    -   <span data-ttu-id="dc104-163">El algoritmo de sincronización de TSC que se usó no era adecuado para sistemas con un gran número de procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-163">The TSC synchronization algorithm that was used wasn't suitable for systems with large numbers of processors.</span></span>

-   <span data-ttu-id="dc104-164">Al comparar los resultados del contador de rendimiento que se adquieren de distintos subprocesos, considere la posibilidad de que los valores que difieren en ± 1 TICs tengan una ordenación ambigua.</span><span class="sxs-lookup"><span data-stu-id="dc104-164">When you compare performance counter results that are acquired from different threads, consider values that differ by ± 1 tick to have an ambiguous ordering.</span></span> <span data-ttu-id="dc104-165">Si las marcas de tiempo se toman del mismo subproceso, esta incertidumbre de ± 1 marca no se aplica.</span><span class="sxs-lookup"><span data-stu-id="dc104-165">If the time stamps are taken from the same thread, this ± 1 tick uncertainty doesn't apply.</span></span> <span data-ttu-id="dc104-166">En este contexto, el término tick hace referencia a un período de tiempo igual a 1 ÷ (la frecuencia del contador de rendimiento obtenida de [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span><span class="sxs-lookup"><span data-stu-id="dc104-166">In this context, the term tick refers to a period of time equal to 1 ÷ (the frequency of the performance counter obtained from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span></span>

<span data-ttu-id="dc104-167">Cuando se usa el contador de rendimiento en sistemas de servidor de gran tamaño con dominios de varios relojes que no están sincronizados en el hardware, Windows determina que el TSC no se puede usar para fines de temporización y selecciona un contador de plataforma como base para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-167">When you use the performance counter on large server systems with multiple-clock domains that aren't synchronized in hardware, Windows determines that the TSC can't be used for timing purposes and selects a platform counter as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-168">Aunque este escenario sigue produciendo marcas de tiempo confiables, la latencia de acceso y la escalabilidad se ven afectadas negativamente.</span><span class="sxs-lookup"><span data-stu-id="dc104-168">While this scenario still yields reliable time stamps, the access latency and scalability is adversely affected.</span></span> <span data-ttu-id="dc104-169">Por lo tanto, como se indicó anteriormente en la guía de uso anterior, use solo las API que proporcionan una resolución más o más microsegundos cuando se necesita dicha resolución.</span><span class="sxs-lookup"><span data-stu-id="dc104-169">Therefore, as previously stated in the preceding usage guidance, only use the APIs that provide 1 microsecond or better resolution when such resolution is necessary.</span></span> <span data-ttu-id="dc104-170">El TSC se usa como base para **QPC** en sistemas de dominio de varios relojes que incluyen la sincronización de hardware de todos los dominios de reloj de procesador, ya que de este modo, funcionan como un sistema de dominio de un solo reloj.</span><span class="sxs-lookup"><span data-stu-id="dc104-170">The TSC is used as the basis for **QPC** on multi-clock domain systems that include hardware synchronization of all processor clock domains, as this effectively makes them function as a single clock domain system.</span></span>

<span data-ttu-id="dc104-171">La frecuencia del contador de rendimiento se fija en el arranque del sistema y es coherente en todos los procesadores, por lo que solo necesita consultar la frecuencia de [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) cuando se inicializa la aplicación y, a continuación, almacenar en caché el resultado.</span><span class="sxs-lookup"><span data-stu-id="dc104-171">The frequency of the performance counter is fixed at system boot and is consistent across all processors so you only need to query the frequency from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) as the application initializes, and then cache the result.</span></span>

### <a name="virtualization"></a><span data-ttu-id="dc104-172">Virtualización</span><span class="sxs-lookup"><span data-stu-id="dc104-172">Virtualization</span></span>

<span data-ttu-id="dc104-173">Se espera que el contador de rendimiento funcione de forma confiable en todas las máquinas virtuales invitadas que se ejecutan en hipervisores implementados correctamente.</span><span class="sxs-lookup"><span data-stu-id="dc104-173">The performance counter is expected to work reliably on all guest virtual machines running on correctly implemented hypervisors.</span></span> <span data-ttu-id="dc104-174">Sin embargo, los hipervisores que cumplen con la interfaz de la versión 1,0 del hipervisor y muestran la habilitación del tiempo de referencia pueden ofrecer una sobrecarga sustancialmente inferior.</span><span class="sxs-lookup"><span data-stu-id="dc104-174">However, hypervisors that comply with the hypervisor version 1.0 interface and surface the reference time enlightenment can offer substantially lower overhead.</span></span> <span data-ttu-id="dc104-175">Para obtener más información sobre las interfaces y las optimizaciones de hipervisor, vea [Especificaciones de hipervisor](/virtualization/hyper-v-on-windows/reference/tlfs).</span><span class="sxs-lookup"><span data-stu-id="dc104-175">For more information about hypervisor interfaces and enlightenments, see [Hypervisor Specifications](/virtualization/hyper-v-on-windows/reference/tlfs).</span></span>

### <a name="direct-tsc-usage"></a><span data-ttu-id="dc104-176">Uso de TSC directo</span><span class="sxs-lookup"><span data-stu-id="dc104-176">Direct TSC usage</span></span>

<span data-ttu-id="dc104-177">Se desaconseja encarecidamente el uso de la instrucción de procesador **RDTSC** o **RDTSCP** para consultar directamente el TSC, ya que no se obtendrán resultados confiables en algunas versiones de Windows, en migraciones en vivo de máquinas virtuales y en sistemas de hardware sin invariantes o sincronizados de forma estricta.</span><span class="sxs-lookup"><span data-stu-id="dc104-177">We strongly discourage using the **RDTSC** or **RDTSCP** processor instruction to directly query the TSC because you won't get reliable results on some versions of Windows, across live migrations of virtual machines, and on hardware systems without invariant or tightly synchronized TSCs.</span></span> <span data-ttu-id="dc104-178">En su lugar, le recomendamos que use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) para aprovechar la abstracción, la coherencia y la portabilidad que ofrece.</span><span class="sxs-lookup"><span data-stu-id="dc104-178">Instead, we encourage you to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) to leverage the abstraction, consistency, and portability that it offers.</span></span>

### <a name="examples-for-acquiring-time-stamps"></a><span data-ttu-id="dc104-179">Ejemplos para adquirir marcas de tiempo</span><span class="sxs-lookup"><span data-stu-id="dc104-179">Examples for acquiring time stamps</span></span>

<span data-ttu-id="dc104-180">Los diversos ejemplos de código de estas secciones muestran cómo adquirir marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-180">The various code examples in these sections show how to acquire time stamps.</span></span>

### <a name="using-qpc-in-native-code"></a><span data-ttu-id="dc104-181">Usar QPC en código nativo</span><span class="sxs-lookup"><span data-stu-id="dc104-181">Using QPC in native code</span></span>

<span data-ttu-id="dc104-182">En este ejemplo se muestra cómo usar [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) en código nativo de C y C++.</span><span class="sxs-lookup"><span data-stu-id="dc104-182">This example shows how to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in C and C++ native code.</span></span>


```C++
LARGE_INTEGER StartingTime, EndingTime, ElapsedMicroseconds;
LARGE_INTEGER Frequency;

QueryPerformanceFrequency(&Frequency); 
QueryPerformanceCounter(&StartingTime);

// Activity to be timed

QueryPerformanceCounter(&EndingTime);
ElapsedMicroseconds.QuadPart = EndingTime.QuadPart - StartingTime.QuadPart;


//
// We now have the elapsed number of ticks, along with the
// number of ticks-per-second. We use these values
// to convert to the number of elapsed microseconds.
// To guard against loss-of-precision, we convert
// to microseconds *before* dividing by ticks-per-second.
//

ElapsedMicroseconds.QuadPart *= 1000000;
ElapsedMicroseconds.QuadPart /= Frequency.QuadPart;
```



### <a name="acquiring-high-resolution-time-stamps-from-managed-code"></a><span data-ttu-id="dc104-183">Adquirir marcas de tiempo de alta resolución del código administrado</span><span class="sxs-lookup"><span data-stu-id="dc104-183">Acquiring high resolution time stamps from managed code</span></span>

<span data-ttu-id="dc104-184">En este ejemplo se muestra cómo usar la clase Managed code [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) .</span><span class="sxs-lookup"><span data-stu-id="dc104-184">This example shows how to use the managed code [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class.</span></span>


```CSharp
using System.Diagnostics;

long StartingTime = Stopwatch.GetTimestamp();

// Activity to be timed

long EndingTime  = Stopwatch.GetTimestamp();
long ElapsedTime = EndingTime - StartingTime;

double ElapsedSeconds = ElapsedTime * (1.0 / Stopwatch.Frequency);
```



<span data-ttu-id="dc104-185">La clase [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) también proporciona varios métodos cómodos para realizar mediciones de intervalos de tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-185">The [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class also provides several convenient methods to perform time-interval measurements.</span></span>

### <a name="using-qpc-from-kernel-mode"></a><span data-ttu-id="dc104-186">Usar QPC desde el modo kernel</span><span class="sxs-lookup"><span data-stu-id="dc104-186">Using QPC from kernel mode</span></span>

<span data-ttu-id="dc104-187">El kernel de Windows proporciona acceso de modo kernel al contador de rendimiento a través de [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) desde el que se pueden obtener tanto el contador de rendimiento como la frecuencia de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="dc104-187">The Windows kernel provides kernel-mode access to the performance counter through [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) from which both the performance counter and performance frequency can be obtained.</span></span> <span data-ttu-id="dc104-188">**KeQueryPerformanceCounter** solo está disponible en modo kernel y se proporciona para los escritores de controladores de dispositivos y otros componentes de modo kernel.</span><span class="sxs-lookup"><span data-stu-id="dc104-188">**KeQueryPerformanceCounter** is available from kernel mode only and is provided for writers of device drivers and other kernel-mode components.</span></span>

<span data-ttu-id="dc104-189">En este ejemplo se muestra cómo usar [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) en el modo kernel de C y C++.</span><span class="sxs-lookup"><span data-stu-id="dc104-189">This example shows how to use [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) in C and C++ kernel mode.</span></span>


```C++
LARGE_INTEGER StartingTime, EndingTime, ElapsedMicroseconds;
LARGE_INTEGER Frequency;

StartingTime = KeQueryPerformanceCounter(&Frequency);

// Activity to be timed

EndingTime = KeQueryPerformanceCounter(NULL);
ElapsedMicroseconds.QuadPart = EndingTime.QuadPart - StartingTime.QuadPart;
ElapsedMicroseconds.QuadPart *= 1000000;
ElapsedMicroseconds.QuadPart /= Frequency.QuadPart;
```



## <a name="general-faq-about-qpc-and-tsc"></a><span data-ttu-id="dc104-190">Preguntas más frecuentes sobre QPC y TSC</span><span class="sxs-lookup"><span data-stu-id="dc104-190">General FAQ about QPC and TSC</span></span>

<span data-ttu-id="dc104-191">Este documento contiene respuestas a las preguntas más frecuentes sobre [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) y TSCs en general.</span><span class="sxs-lookup"><span data-stu-id="dc104-191">Here are answers to frequently-asked questions about [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) and TSCs in general.</span></span>

<dl> <dt>

<span data-ttu-id="dc104-192"><span id="Is_QueryPerformanceCounter___the_same_as_the_Win32_GetTickCount___or_________GetTickCount64___function_"></span><span id="is_queryperformancecounter___the_same_as_the_win32_gettickcount___or_________gettickcount64___function_"></span><span id="IS_QUERYPERFORMANCECOUNTER___THE_SAME_AS_THE_WIN32_GETTICKCOUNT___OR_________GETTICKCOUNT64___FUNCTION_"></span>**¿Es QueryPerformanceCounter () el mismo que la función GetTickCount de Win32 () o GetTickCount64 ()?**</span><span class="sxs-lookup"><span data-stu-id="dc104-192"><span id="Is_QueryPerformanceCounter___the_same_as_the_Win32_GetTickCount___or_________GetTickCount64___function_"></span><span id="is_queryperformancecounter___the_same_as_the_win32_gettickcount___or_________gettickcount64___function_"></span><span id="IS_QUERYPERFORMANCECOUNTER___THE_SAME_AS_THE_WIN32_GETTICKCOUNT___OR_________GETTICKCOUNT64___FUNCTION_"></span>**Is QueryPerformanceCounter() the same as the Win32 GetTickCount() or GetTickCount64() function?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-193">No.</span><span class="sxs-lookup"><span data-stu-id="dc104-193">No.</span></span> <span data-ttu-id="dc104-194">[**GetTickCount**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount) y [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64) no están relacionados con [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-194">[**GetTickCount**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount) and [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64) aren't related to [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-195">**GetTickCount** y **GetTickCount64** devuelven el número de milisegundos transcurridos desde que se inició el sistema.</span><span class="sxs-lookup"><span data-stu-id="dc104-195">**GetTickCount** and **GetTickCount64** return the number of milliseconds since the system was started.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-196"><span id="Should_I_use_QPC_or_call_the_RDTSC__RDTSCP_instructions_directly_"></span><span id="should_i_use_qpc_or_call_the_rdtsc__rdtscp_instructions_directly_"></span><span id="SHOULD_I_USE_QPC_OR_CALL_THE_RDTSC__RDTSCP_INSTRUCTIONS_DIRECTLY_"></span>**¿Debo usar QPC o llamar a las instrucciones de RDTSC/RDTSCP directamente?**</span><span class="sxs-lookup"><span data-stu-id="dc104-196"><span id="Should_I_use_QPC_or_call_the_RDTSC__RDTSCP_instructions_directly_"></span><span id="should_i_use_qpc_or_call_the_rdtsc__rdtscp_instructions_directly_"></span><span id="SHOULD_I_USE_QPC_OR_CALL_THE_RDTSC__RDTSCP_INSTRUCTIONS_DIRECTLY_"></span>**Should I use QPC or call the RDTSC /RDTSCP instructions directly?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-197">Para evitar problemas de inexactitud y portabilidad, recomendamos encarecidamente que use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) en lugar de usar el registro de TSC o las instrucciones de procesador **RDTSC** o **RDTSCP** .</span><span class="sxs-lookup"><span data-stu-id="dc104-197">To avoid incorrectness and portability issues, we strongly encourage you to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) instead of using the TSC register or the **RDTSC** or **RDTSCP** processor instructions.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-198"><span id="What_is_QPC_s_relation_to_an_external_time_epoch__Can_it_be_synchronized_to_an_________external_epoch_such_as_UTC_"></span><span id="what_is_qpc_s_relation_to_an_external_time_epoch__can_it_be_synchronized_to_an_________external_epoch_such_as_utc_"></span><span id="WHAT_IS_QPC_S_RELATION_TO_AN_EXTERNAL_TIME_EPOCH__CAN_IT_BE_SYNCHRONIZED_TO_AN_________EXTERNAL_EPOCH_SUCH_AS_UTC_"></span>**¿Cuál es la relación de QPC con una hora de tiempo externa? ¿Se puede sincronizar con una época externa, como UTC?**</span><span class="sxs-lookup"><span data-stu-id="dc104-198"><span id="What_is_QPC_s_relation_to_an_external_time_epoch__Can_it_be_synchronized_to_an_________external_epoch_such_as_UTC_"></span><span id="what_is_qpc_s_relation_to_an_external_time_epoch__can_it_be_synchronized_to_an_________external_epoch_such_as_utc_"></span><span id="WHAT_IS_QPC_S_RELATION_TO_AN_EXTERNAL_TIME_EPOCH__CAN_IT_BE_SYNCHRONIZED_TO_AN_________EXTERNAL_EPOCH_SUCH_AS_UTC_"></span>**What is QPC’s relation to an external time epoch? Can it be synchronized to an external epoch such as UTC?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-199">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) se basa en un contador de hardware que no se puede sincronizar con una referencia de hora externa, como la hora UTC.</span><span class="sxs-lookup"><span data-stu-id="dc104-199">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is based on a hardware counter that can't be synchronized to an external time reference, such as UTC.</span></span> <span data-ttu-id="dc104-200">Para obtener las marcas de tiempo exactas del día que se pueden sincronizar con una referencia UTC externa, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="dc104-200">For precise time-of-day time stamps that can be synchronized to an external UTC reference, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span>

</dd> <dt>

<span data-ttu-id="dc104-201"><span id="Is_QPC_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="is_qpc_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="IS_QPC_AFFECTED_BY_DAYLIGHT_SAVINGS_TIME__LEAP_SECONDS__TIME_ZONES__OR_SYSTEM_________TIME_CHANGES_MADE_BY_THE_ADMINISTRATOR_"></span>**¿Es QPC afectado por el horario de verano, los segundos bisiestos, las zonas horarias o los cambios de hora del sistema realizados por el administrador?**</span><span class="sxs-lookup"><span data-stu-id="dc104-201"><span id="Is_QPC_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="is_qpc_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="IS_QPC_AFFECTED_BY_DAYLIGHT_SAVINGS_TIME__LEAP_SECONDS__TIME_ZONES__OR_SYSTEM_________TIME_CHANGES_MADE_BY_THE_ADMINISTRATOR_"></span>**Is QPC affected by daylight savings time, leap seconds, time zones, or system time changes made by the administrator?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-202">No.</span><span class="sxs-lookup"><span data-stu-id="dc104-202">No.</span></span> <span data-ttu-id="dc104-203">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) es completamente independiente de la hora del sistema y UTC.</span><span class="sxs-lookup"><span data-stu-id="dc104-203">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is completely independent of the system time and UTC.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-204"><span id="Is_QPC_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_Turbo_Boost_technology_"></span><span id="is_qpc_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_turbo_boost_technology_"></span><span id="IS_QPC_ACCURACY_AFFECTED_BY_PROCESSOR_FREQUENCY_CHANGES_CAUSED_BY_POWER_________MANAGEMENT_OR_TURBO_BOOST_TECHNOLOGY_"></span>**¿La precisión QPC se ve afectada por los cambios de frecuencia del procesador causados por la administración de energía o la tecnología Turbo Boost?**</span><span class="sxs-lookup"><span data-stu-id="dc104-204"><span id="Is_QPC_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_Turbo_Boost_technology_"></span><span id="is_qpc_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_turbo_boost_technology_"></span><span id="IS_QPC_ACCURACY_AFFECTED_BY_PROCESSOR_FREQUENCY_CHANGES_CAUSED_BY_POWER_________MANAGEMENT_OR_TURBO_BOOST_TECHNOLOGY_"></span>**Is QPC accuracy affected by processor frequency changes caused by power management or Turbo Boost technology?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-205">No.</span><span class="sxs-lookup"><span data-stu-id="dc104-205">No.</span></span> <span data-ttu-id="dc104-206">Si el procesador tiene un TSC invariable, el [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) no se ve afectado por este tipo de cambios.</span><span class="sxs-lookup"><span data-stu-id="dc104-206">If the processor has an invariant TSC, the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is not affected by these sort of changes.</span></span> <span data-ttu-id="dc104-207">Si el procesador no tiene un TSC invariable, **QPC** revertirá a un temporizador de hardware de plataforma que no se verá afectado por los cambios de frecuencia del procesador o la tecnología Turbo Boost.</span><span class="sxs-lookup"><span data-stu-id="dc104-207">If the processor doesn't have an invariant TSC, **QPC** will revert to a platform hardware timer that won't be affected by processor frequency changes or Turbo Boost technology.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-208"><span id="Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="does_qpc_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="DOES_QPC_RELIABLY_WORK_ON_MULTI-PROCESSOR_SYSTEMS__MULTI-CORE_SYSTEM__AND_________SYSTEMS_WITH_HYPER-THREADING_"></span>**¿QPC funciona de forma confiable en sistemas de varios procesadores, sistemas de varios núcleos y sistemas con Hyper-Threading?**</span><span class="sxs-lookup"><span data-stu-id="dc104-208"><span id="Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="does_qpc_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="DOES_QPC_RELIABLY_WORK_ON_MULTI-PROCESSOR_SYSTEMS__MULTI-CORE_SYSTEM__AND_________SYSTEMS_WITH_HYPER-THREADING_"></span>**Does QPC reliably work on multi-processor systems, multi-core system, and systems with hyper-threading?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-209">Sí</span><span class="sxs-lookup"><span data-stu-id="dc104-209">Yes</span></span>

</dd> <dt>

<span data-ttu-id="dc104-210"><span id="How_do_I_determine_and_validate_that_QPC_works_on_my_machine_"></span><span id="how_do_i_determine_and_validate_that_qpc_works_on_my_machine_"></span><span id="HOW_DO_I_DETERMINE_AND_VALIDATE_THAT_QPC_WORKS_ON_MY_MACHINE_"></span>**Cómo determinar y validar que QPC funciona en mi máquina?**</span><span class="sxs-lookup"><span data-stu-id="dc104-210"><span id="How_do_I_determine_and_validate_that_QPC_works_on_my_machine_"></span><span id="how_do_i_determine_and_validate_that_qpc_works_on_my_machine_"></span><span id="HOW_DO_I_DETERMINE_AND_VALIDATE_THAT_QPC_WORKS_ON_MY_MACHINE_"></span>**How do I determine and validate that QPC works on my machine?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-211">No es necesario realizar estas comprobaciones.</span><span class="sxs-lookup"><span data-stu-id="dc104-211">You don't need to perform such checks.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-212"><span id="Which_processors_have_non-invariant_TSCs__How_can_I_check_if_my_system_has_a_________non-invariant_TSC_"></span><span id="which_processors_have_non-invariant_tscs__how_can_i_check_if_my_system_has_a_________non-invariant_tsc_"></span><span id="WHICH_PROCESSORS_HAVE_NON-INVARIANT_TSCS__HOW_CAN_I_CHECK_IF_MY_SYSTEM_HAS_A_________NON-INVARIANT_TSC_"></span>**¿Qué procesadores tienen TSCs no invariables? ¿Cómo puedo comprobar si el sistema tiene un TSC no invariable?**</span><span class="sxs-lookup"><span data-stu-id="dc104-212"><span id="Which_processors_have_non-invariant_TSCs__How_can_I_check_if_my_system_has_a_________non-invariant_TSC_"></span><span id="which_processors_have_non-invariant_tscs__how_can_i_check_if_my_system_has_a_________non-invariant_tsc_"></span><span id="WHICH_PROCESSORS_HAVE_NON-INVARIANT_TSCS__HOW_CAN_I_CHECK_IF_MY_SYSTEM_HAS_A_________NON-INVARIANT_TSC_"></span>**Which processors have non-invariant TSCs? How can I check if my system has a non-invariant TSC?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-213">No es necesario realizar esta comprobación.</span><span class="sxs-lookup"><span data-stu-id="dc104-213">You don't need to perform this check yourself.</span></span> <span data-ttu-id="dc104-214">Los sistemas operativos Windows realizan varias comprobaciones en la inicialización del sistema para determinar si el TSC es adecuado como base para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-214">Windows operating systems perform several checks at system initialization to determine if the TSC is suitable as a basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-215">Sin embargo, por motivos de referencia, puede determinar si el procesador tiene un TSC de invariable mediante uno de estos:</span><span class="sxs-lookup"><span data-stu-id="dc104-215">However, for reference purposes, you can determine whether your processor has an invariant TSC by using one of these:</span></span>

-   <span data-ttu-id="dc104-216">la utilidad de Coreinfo.exe de Windows Sysinternals</span><span class="sxs-lookup"><span data-stu-id="dc104-216">the Coreinfo.exe utility from Windows Sysinternals</span></span>
-   <span data-ttu-id="dc104-217">comprobar los valores devueltos por la instrucción CPUID relativa a las características de TSC</span><span class="sxs-lookup"><span data-stu-id="dc104-217">checking the values returned by the CPUID instruction pertaining to the TSC characteristics</span></span>
-   <span data-ttu-id="dc104-218">la documentación del fabricante del procesador</span><span class="sxs-lookup"><span data-stu-id="dc104-218">the processor manufacturer’s documentation</span></span>

<span data-ttu-id="dc104-219">A continuación se muestra la información de TSC-invariable proporcionada por la utilidad de Coreinfo.exe de Windows Sysinternals ([www.sysinternals.com](https://www.sysinternals.com)).</span><span class="sxs-lookup"><span data-stu-id="dc104-219">The following shows the TSC-INVARIANT info that is provided by the Windows Sysinternals Coreinfo.exe utility ([www.sysinternals.com](https://www.sysinternals.com)).</span></span> <span data-ttu-id="dc104-220">Un asterisco significa "true".</span><span class="sxs-lookup"><span data-stu-id="dc104-220">An asterisk means "True".</span></span>

``` syntax
> Coreinfo.exe 

Coreinfo v3.2 - Dump information on system CPU and memory topology
Copyright (C) 2008-2012 Mark Russinovich
Sysinternals - www.sysinternals.com

 <unrelated text removed>

RDTSCP          * Supports RDTSCP instruction
TSC             * Supports RDTSC instruction
TSC-DEADLINE    - Local APIC supports one-shot deadline timer
TSC-INVARIANT   * TSC runs at constant rate
```

</dd> <dt>

<span data-ttu-id="dc104-221"><span id="Does_QPC_work_reliably_on__hardware_platforms_"></span><span id="does_qpc_work_reliably_on__hardware_platforms_"></span><span id="DOES_QPC_WORK_RELIABLY_ON__HARDWARE_PLATFORMS_"></span>**¿QPC funciona de forma confiable en las plataformas de hardware de equipos con Windows RT?**</span><span class="sxs-lookup"><span data-stu-id="dc104-221"><span id="Does_QPC_work_reliably_on__hardware_platforms_"></span><span id="does_qpc_work_reliably_on__hardware_platforms_"></span><span id="DOES_QPC_WORK_RELIABLY_ON__HARDWARE_PLATFORMS_"></span>**Does QPC work reliably on Windows RT PC hardware platforms?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-222">Sí</span><span class="sxs-lookup"><span data-stu-id="dc104-222">Yes</span></span>

</dd> <dt>

<span data-ttu-id="dc104-223"><span id="How_often_does_QPC_roll_over_"></span><span id="how_often_does_qpc_roll_over_"></span><span id="HOW_OFTEN_DOES_QPC_ROLL_OVER_"></span>**¿Con qué frecuencia se revierte QPC?**</span><span class="sxs-lookup"><span data-stu-id="dc104-223"><span id="How_often_does_QPC_roll_over_"></span><span id="how_often_does_qpc_roll_over_"></span><span id="HOW_OFTEN_DOES_QPC_ROLL_OVER_"></span>**How often does QPC roll over?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-224">No menos de 100 años desde el arranque del sistema más reciente y, posiblemente, se basa en el temporizador de hardware subyacente usado.</span><span class="sxs-lookup"><span data-stu-id="dc104-224">Not less than 100 years from the most recent system boot, and potentially longer based on the underlying hardware timer used.</span></span> <span data-ttu-id="dc104-225">Para la mayoría de las aplicaciones, la sustitución no es un problema.</span><span class="sxs-lookup"><span data-stu-id="dc104-225">For most applications, rollover isn't a concern.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-226"><span id="What_is_the_computational_cost_of_calling_QPC_"></span><span id="what_is_the_computational_cost_of_calling_qpc_"></span><span id="WHAT_IS_THE_COMPUTATIONAL_COST_OF_CALLING_QPC_"></span>**¿Cuál es el costo computacional de llamar a QPC?**</span><span class="sxs-lookup"><span data-stu-id="dc104-226"><span id="What_is_the_computational_cost_of_calling_QPC_"></span><span id="what_is_the_computational_cost_of_calling_qpc_"></span><span id="WHAT_IS_THE_COMPUTATIONAL_COST_OF_CALLING_QPC_"></span>**What is the computational cost of calling QPC?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-227">El costo de la llamada de cálculo de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) está determinado principalmente por la plataforma de hardware subyacente.</span><span class="sxs-lookup"><span data-stu-id="dc104-227">The computational calling cost of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is determined primarily by the underlying hardware platform.</span></span> <span data-ttu-id="dc104-228">Si el registro de TSC se utiliza como base para QPC, el costo computacional se determina principalmente por el tiempo que tarda el procesador en procesar una instrucción **RDTSC** .</span><span class="sxs-lookup"><span data-stu-id="dc104-228">If the TSC register is used as the basis for QPC, the computational cost is determined primarily by how long the processor takes to process an **RDTSC** instruction.</span></span> <span data-ttu-id="dc104-229">Este intervalo de tiempo va de decenas de ciclos de CPU a varios cientos de ciclos de CPU según el procesador utilizado.</span><span class="sxs-lookup"><span data-stu-id="dc104-229">This time ranges from 10s of CPU cycles to several hundred CPU cycles depending upon the processor used.</span></span> <span data-ttu-id="dc104-230">Si no se puede usar el TSC, el sistema seleccionará una base de tiempo de hardware diferente.</span><span class="sxs-lookup"><span data-stu-id="dc104-230">If the TSC can't be used, the system will select a different hardware time basis.</span></span> <span data-ttu-id="dc104-231">Dado que estas bases de tiempo se encuentran en la placa base (por ejemplo, en el puente de sur de PCI o en el PCH), el costo de cálculo por llamada es mayor que el TSC y, con frecuencia, en proximidad de 0,8-1,0 microsegundos según la velocidad del procesador y otros factores de hardware.</span><span class="sxs-lookup"><span data-stu-id="dc104-231">Because these time bases are located on the motherboard (for example, on the PCI South Bridge or PCH), the per-call computational cost is higher than the TSC, and is frequently in the vicinity of 0.8 - 1.0 microseconds depending on processor speed and other hardware factors.</span></span> <span data-ttu-id="dc104-232">Este costo está dominado por el tiempo necesario para tener acceso al dispositivo de hardware de la placa base.</span><span class="sxs-lookup"><span data-stu-id="dc104-232">This cost is dominated by the time required to access the hardware device on the motherboard.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-233"><span id="Does_QPC_require_a_kernel_transition__system_call__"></span><span id="does_qpc_require_a_kernel_transition__system_call__"></span><span id="DOES_QPC_REQUIRE_A_KERNEL_TRANSITION__SYSTEM_CALL__"></span>**¿Requiere QPC una transición del kernel (llamada del sistema)?**</span><span class="sxs-lookup"><span data-stu-id="dc104-233"><span id="Does_QPC_require_a_kernel_transition__system_call__"></span><span id="does_qpc_require_a_kernel_transition__system_call__"></span><span id="DOES_QPC_REQUIRE_A_KERNEL_TRANSITION__SYSTEM_CALL__"></span>**Does QPC require a kernel transition (system call)?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-234">No es necesario realizar una transición del kernel si el sistema puede utilizar el registro de TSC como base para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-234">A kernel transition is not required if the system can use the TSC register as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-235">Si el sistema debe usar una base de tiempo diferente, como el temporizador HPET o PM, se requiere una llamada del sistema.</span><span class="sxs-lookup"><span data-stu-id="dc104-235">If the system must use a different time base, such as the HPET or PM timer, a system call is required.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-236"><span id="Is_the_performance_counter_monotonic__non-decreasing__"></span><span id="is_the_performance_counter_monotonic__non-decreasing__"></span><span id="IS_THE_PERFORMANCE_COUNTER_MONOTONIC__NON-DECREASING__"></span>**¿El contador de rendimiento es monotónico (no en disminución)?**</span><span class="sxs-lookup"><span data-stu-id="dc104-236"><span id="Is_the_performance_counter_monotonic__non-decreasing__"></span><span id="is_the_performance_counter_monotonic__non-decreasing__"></span><span id="IS_THE_PERFORMANCE_COUNTER_MONOTONIC__NON-DECREASING__"></span>**Is the performance counter monotonic (non-decreasing)?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-237">Sí</span><span class="sxs-lookup"><span data-stu-id="dc104-237">Yes</span></span>

</dd> <dt>

<span data-ttu-id="dc104-238"><span id="Can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="CAN_THE_PERFORMANCE_COUNTER_BE_USED_TO_ORDER_EVENTS_IN_TIME_"></span>**¿Se puede usar el contador de rendimiento para ordenar eventos en el tiempo?**</span><span class="sxs-lookup"><span data-stu-id="dc104-238"><span id="Can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="CAN_THE_PERFORMANCE_COUNTER_BE_USED_TO_ORDER_EVENTS_IN_TIME_"></span>**Can the performance counter be used to order events in time?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-239">Sí.</span><span class="sxs-lookup"><span data-stu-id="dc104-239">Yes.</span></span> <span data-ttu-id="dc104-240">Sin embargo, al comparar los resultados del contador de rendimiento que se adquieren de distintos subprocesos, los valores que difieren entre ± 1 TICs tienen una ordenación ambigua como si tuvieran una marca de tiempo idéntica.</span><span class="sxs-lookup"><span data-stu-id="dc104-240">However, when comparing performance counter results that are acquired from different threads, values that differ by ± 1 tick have an ambiguous ordering as if they had an identical time stamp.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-241"><span id="How_accurate_is_the_performance_counter_"></span><span id="how_accurate_is_the_performance_counter_"></span><span id="HOW_ACCURATE_IS_THE_PERFORMANCE_COUNTER_"></span>**¿Qué precisión tiene el contador de rendimiento?**</span><span class="sxs-lookup"><span data-stu-id="dc104-241"><span id="How_accurate_is_the_performance_counter_"></span><span id="how_accurate_is_the_performance_counter_"></span><span id="HOW_ACCURATE_IS_THE_PERFORMANCE_COUNTER_"></span>**How accurate is the performance counter?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-242">La respuesta depende de diversos factores.</span><span class="sxs-lookup"><span data-stu-id="dc104-242">The answer depends on a variety of factors.</span></span> <span data-ttu-id="dc104-243">Para obtener más información, vea [características del reloj de hardware de bajo nivel](#low-level-hardware-clock-characteristics).</span><span class="sxs-lookup"><span data-stu-id="dc104-243">For more info, see [Low-level hardware clock characteristics](#low-level-hardware-clock-characteristics).</span></span>

</dd> </dl>

## <a name="faq-about-programming-with-qpc-and-tsc"></a><span data-ttu-id="dc104-244">Preguntas más frecuentes sobre la programación con QPC y TSC</span><span class="sxs-lookup"><span data-stu-id="dc104-244">FAQ about programming with QPC and TSC</span></span>

<span data-ttu-id="dc104-245">Este documento contiene respuestas a las preguntas más frecuentes sobre la programación con [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) y TSCs.</span><span class="sxs-lookup"><span data-stu-id="dc104-245">Here are answers to frequently-asked questions about programming with [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) and TSCs.</span></span>

<dl> <dt>

<span data-ttu-id="dc104-246"><span id="I_need_to_convert_the_QPC_output_to_milliseconds._How_can_I_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="i_need_to_convert_the_qpc_output_to_milliseconds._how_can_i_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="I_NEED_TO_CONVERT_THE_QPC_OUTPUT_TO_MILLISECONDS._HOW_CAN_I_AVOID_LOSS_OF_________PRECISION_WITH_CONVERTING_TO_DOUBLE_OR_FLOAT_"></span>**Necesito convertir el resultado de QPC en milisegundos. ¿Cómo se puede evitar la pérdida de precisión con la conversión a Double o float?**</span><span class="sxs-lookup"><span data-stu-id="dc104-246"><span id="I_need_to_convert_the_QPC_output_to_milliseconds._How_can_I_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="i_need_to_convert_the_qpc_output_to_milliseconds._how_can_i_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="I_NEED_TO_CONVERT_THE_QPC_OUTPUT_TO_MILLISECONDS._HOW_CAN_I_AVOID_LOSS_OF_________PRECISION_WITH_CONVERTING_TO_DOUBLE_OR_FLOAT_"></span>**I need to convert the QPC output to milliseconds. How can I avoid loss of precision with converting to double or float?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-247">Hay varios aspectos que se deben tener en cuenta al realizar cálculos en contadores de rendimiento enteros:</span><span class="sxs-lookup"><span data-stu-id="dc104-247">There are several things to keep in mind when performing calculations on integer performance counters:</span></span>

-   <span data-ttu-id="dc104-248">La división de enteros perderá el resto.</span><span class="sxs-lookup"><span data-stu-id="dc104-248">Integer division will lose the remainder.</span></span> <span data-ttu-id="dc104-249">Esto puede provocar la pérdida de precisión en algunos casos.</span><span class="sxs-lookup"><span data-stu-id="dc104-249">This can cause loss of precision in some cases.</span></span>
-   <span data-ttu-id="dc104-250">La conversión entre enteros de 64 bits y punto flotante (Double) puede provocar la pérdida de precisión porque la mantisa de punto flotante no puede representar todos los valores enteros posibles.</span><span class="sxs-lookup"><span data-stu-id="dc104-250">Conversion between 64 bit integers and floating point (double) can cause loss of precision because the floating point mantissa can't represent all possible integral values.</span></span>
-   <span data-ttu-id="dc104-251">La multiplicación de enteros de 64 bits puede producir un desbordamiento de enteros.</span><span class="sxs-lookup"><span data-stu-id="dc104-251">Multiplication of 64 bit integers can result in integer overflow.</span></span>

<span data-ttu-id="dc104-252">Como principio general, retrase estos cálculos y conversiones siempre que sea posible para evitar la composición de los errores introducidos.</span><span class="sxs-lookup"><span data-stu-id="dc104-252">As a general principle, delay these computations and conversions as long as possible to avoid compounding the errors introduced.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-253"><span id="How_can_I_convert_QPC_to_100_nanosecond_ticks_so_I_can_add_it_to_a_________FILETIME_"></span><span id="how_can_i_convert_qpc_to_100_nanosecond_ticks_so_i_can_add_it_to_a_________filetime_"></span><span id="HOW_CAN_I_CONVERT_QPC_TO_100_NANOSECOND_TICKS_SO_I_CAN_ADD_IT_TO_A_________FILETIME_"></span>**¿Cómo puedo convertir QPC a TICs de 100 nanosegundos para poder agregarlo a un FILETIME?**</span><span class="sxs-lookup"><span data-stu-id="dc104-253"><span id="How_can_I_convert_QPC_to_100_nanosecond_ticks_so_I_can_add_it_to_a_________FILETIME_"></span><span id="how_can_i_convert_qpc_to_100_nanosecond_ticks_so_i_can_add_it_to_a_________filetime_"></span><span id="HOW_CAN_I_CONVERT_QPC_TO_100_NANOSECOND_TICKS_SO_I_CAN_ADD_IT_TO_A_________FILETIME_"></span>**How can I convert QPC to 100 nanosecond ticks so I can add it to a FILETIME?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-254">Una hora de archivo es un valor de 64 bits que representa el número de intervalos de 100 segundos que han transcurrido desde la 12:00 A.M.</span><span class="sxs-lookup"><span data-stu-id="dc104-254">A file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 A.M.</span></span> <span data-ttu-id="dc104-255">1 de enero de 1601 hora universal coordinada (UTC).</span><span class="sxs-lookup"><span data-stu-id="dc104-255">January 1, 1601 Coordinated Universal Time (UTC).</span></span> <span data-ttu-id="dc104-256">Los tiempos de archivo se usan en las llamadas de la API de Win32 que devuelven la hora del día, como [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) y [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="dc104-256">File times are used by Win32 API calls that return time-of-day, such as [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) and [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span> <span data-ttu-id="dc104-257">Por el contrario, [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) devuelve valores que representan el tiempo en unidades de 1/(la frecuencia del contador de rendimiento obtenida de [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span><span class="sxs-lookup"><span data-stu-id="dc104-257">By contrast, [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) returns values that represent time in units of 1/(the frequency of the performance counter obtained from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span></span> <span data-ttu-id="dc104-258">La conversión entre los dos requiere calcular la relación entre el intervalo de **QPC** y los intervalos de 100-nanosegundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-258">Conversion between the two requires calculating the ratio of the **QPC** interval and 100-nanoseconds intervals.</span></span> <span data-ttu-id="dc104-259">Tenga cuidado de evitar la pérdida de precisión porque los valores pueden ser pequeños (0,0000001/0,000000340).</span><span class="sxs-lookup"><span data-stu-id="dc104-259">Be careful to avoid losing precision because the values might be small (0.0000001 / 0.000000340).</span></span>

</dd> <dt>

<span data-ttu-id="dc104-260"><span id="Why_is_the_time_stamp_that_is_returned_from_QPC_a_signed_integer_"></span><span id="why_is_the_time_stamp_that_is_returned_from_qpc_a_signed_integer_"></span><span id="WHY_IS_THE_TIME_STAMP_THAT_IS_RETURNED_FROM_QPC_A_SIGNED_INTEGER_"></span>**¿Por qué la marca de tiempo que se devuelve de QPC es un entero con signo?**</span><span class="sxs-lookup"><span data-stu-id="dc104-260"><span id="Why_is_the_time_stamp_that_is_returned_from_QPC_a_signed_integer_"></span><span id="why_is_the_time_stamp_that_is_returned_from_qpc_a_signed_integer_"></span><span id="WHY_IS_THE_TIME_STAMP_THAT_IS_RETURNED_FROM_QPC_A_SIGNED_INTEGER_"></span>**Why is the time stamp that is returned from QPC a signed integer?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-261">Los cálculos que implican marcas de tiempo de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) pueden implicar la resta.</span><span class="sxs-lookup"><span data-stu-id="dc104-261">Calculations that involve [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) time stamps might involve subtraction.</span></span> <span data-ttu-id="dc104-262">Mediante el uso de un valor con signo, puede controlar los cálculos que pueden producir valores negativos.</span><span class="sxs-lookup"><span data-stu-id="dc104-262">By using a signed value, you can handle calculations that might yield negative values.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-263"><span id="How_can_I_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="how_can_i_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="HOW_CAN_I_OBTAIN_HIGH_RESOLUTION_TIME_STAMPS_FROM_MANAGED_CODE_"></span>**¿Cómo puedo obtener marcas de tiempo de alta resolución del código administrado?**</span><span class="sxs-lookup"><span data-stu-id="dc104-263"><span id="How_can_I_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="how_can_i_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="HOW_CAN_I_OBTAIN_HIGH_RESOLUTION_TIME_STAMPS_FROM_MANAGED_CODE_"></span>**How can I obtain high resolution time stamps from managed code?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-264">Llame al método [**Stopwatch. GetTimeStamp**](/previous-versions/windows/) desde la clase [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) .</span><span class="sxs-lookup"><span data-stu-id="dc104-264">Call the [**Stopwatch.GetTimeStamp**](/previous-versions/windows/) method from the [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class.</span></span> <span data-ttu-id="dc104-265">Para obtener un ejemplo sobre cómo usar **Stopwatch. GetTimeStamp**, vea [adquirir marcas de tiempo de alta resolución del código administrado](#acquiring-high-resolution-time-stamps-from-managed-code).</span><span class="sxs-lookup"><span data-stu-id="dc104-265">For an example about how to use **Stopwatch.GetTimeStamp**, see [Acquiring high resolution time stamps from managed code](#acquiring-high-resolution-time-stamps-from-managed-code).</span></span>

</dd> <dt>

<span data-ttu-id="dc104-266"><span id="Under_what_circumstances_does_QueryPerformanceFrequency_return_FALSE__or_________QueryPerformanceCounter_return_zero_"></span><span id="under_what_circumstances_does_queryperformancefrequency_return_false__or_________queryperformancecounter_return_zero_"></span><span id="UNDER_WHAT_CIRCUMSTANCES_DOES_QUERYPERFORMANCEFREQUENCY_RETURN_FALSE__OR_________QUERYPERFORMANCECOUNTER_RETURN_ZERO_"></span>**En ¿en qué circunstancias QueryPerformanceFrequency devuelve FALSE, o QueryPerformanceCounter devuelve cero?**</span><span class="sxs-lookup"><span data-stu-id="dc104-266"><span id="Under_what_circumstances_does_QueryPerformanceFrequency_return_FALSE__or_________QueryPerformanceCounter_return_zero_"></span><span id="under_what_circumstances_does_queryperformancefrequency_return_false__or_________queryperformancecounter_return_zero_"></span><span id="UNDER_WHAT_CIRCUMSTANCES_DOES_QUERYPERFORMANCEFREQUENCY_RETURN_FALSE__OR_________QUERYPERFORMANCECOUNTER_RETURN_ZERO_"></span>**Under what circumstances does QueryPerformanceFrequency return FALSE, or QueryPerformanceCounter return zero?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-267">Esto no ocurre en ningún sistema que ejecute Windows XP o posterior.</span><span class="sxs-lookup"><span data-stu-id="dc104-267">This won't occur on any system that runs Windows XP or later.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-268"><span id="Do_I_need_to_set_the_thread_affinity_to_a_single_core_to_use_QPC_"></span><span id="do_i_need_to_set_the_thread_affinity_to_a_single_core_to_use_qpc_"></span><span id="DO_I_NEED_TO_SET_THE_THREAD_AFFINITY_TO_A_SINGLE_CORE_TO_USE_QPC_"></span>**¿Es necesario establecer la afinidad de subprocesos en un solo núcleo para usar QPC?**</span><span class="sxs-lookup"><span data-stu-id="dc104-268"><span id="Do_I_need_to_set_the_thread_affinity_to_a_single_core_to_use_QPC_"></span><span id="do_i_need_to_set_the_thread_affinity_to_a_single_core_to_use_qpc_"></span><span id="DO_I_NEED_TO_SET_THE_THREAD_AFFINITY_TO_A_SINGLE_CORE_TO_USE_QPC_"></span>**Do I need to set the thread affinity to a single core to use QPC?**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-269">No.</span><span class="sxs-lookup"><span data-stu-id="dc104-269">No.</span></span> <span data-ttu-id="dc104-270">Para obtener más información, consulte la [Guía para adquirir marcas de tiempo](#guidance-for-acquiring-time-stamps).</span><span class="sxs-lookup"><span data-stu-id="dc104-270">For more info, see [Guidance for acquiring time stamps](#guidance-for-acquiring-time-stamps).</span></span> <span data-ttu-id="dc104-271">Este escenario no es necesario ni deseable.</span><span class="sxs-lookup"><span data-stu-id="dc104-271">This scenario is neither necessary nor desirable.</span></span> <span data-ttu-id="dc104-272">La realización de este escenario puede afectar negativamente al rendimiento de la aplicación mediante la restricción del procesamiento a un núcleo o la creación de un cuello de botella en un solo núcleo si varios subprocesos establecen su afinidad en el mismo núcleo al llamar a [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-272">Performing this scenario might adversely affect your application's performance by restricting processing to one core or by creating a bottleneck on a single core if multiple threads set their affinity to the same core when calling [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span>

</dd> </dl>

## <a name="low-level-hardware-clock-characteristics"></a><span data-ttu-id="dc104-273">Características de reloj de hardware de bajo nivel</span><span class="sxs-lookup"><span data-stu-id="dc104-273">Low-level hardware clock characteristics</span></span>

<span data-ttu-id="dc104-274">En estas secciones se muestran las características de reloj de hardware de bajo nivel.</span><span class="sxs-lookup"><span data-stu-id="dc104-274">These sections show low-level hardware clock characteristics.</span></span>

### <a name="absolute-clocks-and-difference-clocks"></a><span data-ttu-id="dc104-275">Relojes absolutos y relojes de diferencia</span><span class="sxs-lookup"><span data-stu-id="dc104-275">Absolute Clocks and Difference Clocks</span></span>

<span data-ttu-id="dc104-276">Los relojes absolutos proporcionan lecturas precisas de la hora del día.</span><span class="sxs-lookup"><span data-stu-id="dc104-276">Absolute clocks provide accurate time-of-day readings.</span></span> <span data-ttu-id="dc104-277">Normalmente se basan en la hora universal coordinada (UTC) y, por consiguiente, su exactitud depende en parte de lo bien que se sincronizan con una referencia de hora externa.</span><span class="sxs-lookup"><span data-stu-id="dc104-277">They are typically based on Coordinated Universal Time (UTC) and consequently their accuracy depends in part on how well they are synchronized to an external time reference.</span></span> <span data-ttu-id="dc104-278">Los relojes de diferencia miden los intervalos de tiempo y no suelen basarse en un tiempo externo.</span><span class="sxs-lookup"><span data-stu-id="dc104-278">Difference clocks measure time intervals and aren't typically based on an external time epoch.</span></span> <span data-ttu-id="dc104-279">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) es un reloj de diferencia y no se sincroniza con un tiempo o una referencia externos.</span><span class="sxs-lookup"><span data-stu-id="dc104-279">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is a difference clock and isn't synchronized to an external time epoch or reference.</span></span> <span data-ttu-id="dc104-280">Cuando se usa **QPC** para las mediciones de intervalos de tiempo, normalmente se obtiene una mejor precisión que el uso de marcas de tiempo que se derivan de un reloj absoluto.</span><span class="sxs-lookup"><span data-stu-id="dc104-280">When you use **QPC** for time-interval measurements, you typically get better accuracy than you would get by using time stamps that are derived from an absolute clock.</span></span> <span data-ttu-id="dc104-281">Esto se debe a que el proceso de sincronización de la hora de un reloj absoluto puede introducir turnos de fase y frecuencia que aumentan la incertidumbre de las mediciones de intervalo de tiempo a corto plazo.</span><span class="sxs-lookup"><span data-stu-id="dc104-281">This is because the process of synchronizing the time of an absolute clock can introduce phase and frequency shifts that increase the uncertainty of short term time-interval measurements.</span></span>

### <a name="resolution-precision-accuracy-and-stability"></a><span data-ttu-id="dc104-282">Resolución, precisión, precisión y estabilidad</span><span class="sxs-lookup"><span data-stu-id="dc104-282">Resolution, Precision, Accuracy, and Stability</span></span>

<span data-ttu-id="dc104-283">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) usa un contador de hardware como base.</span><span class="sxs-lookup"><span data-stu-id="dc104-283">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) uses a hardware counter as its basis.</span></span> <span data-ttu-id="dc104-284">Los temporizadores de hardware constan de tres partes: un generador de TICs, un contador que cuenta los tics y un medio para recuperar el valor del contador.</span><span class="sxs-lookup"><span data-stu-id="dc104-284">Hardware timers consist of three parts: a tick generator, a counter that counts the ticks, and a means of retrieving the counter value.</span></span> <span data-ttu-id="dc104-285">Las características de estos tres componentes determinan la resolución, la precisión, la precisión y la estabilidad de **QPC**.</span><span class="sxs-lookup"><span data-stu-id="dc104-285">The characteristics of these three components determine the resolution, precision, accuracy, and stability of **QPC**.</span></span>

<span data-ttu-id="dc104-286">Si un generador de hardware proporciona TICs a una velocidad constante, los intervalos de tiempo se pueden medir simplemente contando estos TICs.</span><span class="sxs-lookup"><span data-stu-id="dc104-286">If a hardware generator provides ticks at a constant rate, time intervals can be measured by simply counting these ticks.</span></span> <span data-ttu-id="dc104-287">La velocidad a la que se generan los tics se denomina frecuencia y se expresa en hercios (Hz).</span><span class="sxs-lookup"><span data-stu-id="dc104-287">The rate at which the ticks are generated is called the frequency and expressed in Hertz (Hz).</span></span> <span data-ttu-id="dc104-288">El recíproco de la frecuencia se denomina período o intervalo de TICs y se expresa en una unidad de tiempo del sistema internacional de unidades (SI) adecuada (por ejemplo, segundo, milisegundo, microsegundo o nanosegundos).</span><span class="sxs-lookup"><span data-stu-id="dc104-288">The reciprocal of the frequency is called the period or tick interval and is expressed in an appropriate International System of Units (SI) time unit (for example, second, millisecond, microsecond, or nanosecond).</span></span>

![intervalo de tiempo](images/tick-interval.png)

<span data-ttu-id="dc104-290">La resolución del temporizador es igual al período.</span><span class="sxs-lookup"><span data-stu-id="dc104-290">The resolution of the timer is equal to the period.</span></span> <span data-ttu-id="dc104-291">La resolución determina la capacidad de distinguir entre dos marcas de tiempo cualesquiera y coloca un límite inferior en los intervalos de tiempo más pequeños que se pueden medir.</span><span class="sxs-lookup"><span data-stu-id="dc104-291">Resolution determines the ability to distinguish between any two time stamps and places a lower bound on the smallest time intervals that can be measured.</span></span> <span data-ttu-id="dc104-292">A veces, esto se denomina resolución de marca.</span><span class="sxs-lookup"><span data-stu-id="dc104-292">This is sometimes called the tick resolution.</span></span>

<span data-ttu-id="dc104-293">La medición digital del tiempo introduce una incertidumbre de medidas de ± 1 TIC porque el contador digital avanza en pasos discretos, mientras que el tiempo avanza continuamente.</span><span class="sxs-lookup"><span data-stu-id="dc104-293">Digital measurement of time introduces a measurements uncertainty of ± 1 tick because the digital counter advances in discrete steps, while time is continuously advancing.</span></span> <span data-ttu-id="dc104-294">Esta incertidumbre se denomina error de cuantificación.</span><span class="sxs-lookup"><span data-stu-id="dc104-294">This uncertainty is called a quantization error.</span></span> <span data-ttu-id="dc104-295">En el caso de las mediciones de intervalos de tiempo habituales, este efecto se puede pasar por alto a menudo porque el error de cuantificación es mucho menor que el intervalo de tiempo que se está midiendo.</span><span class="sxs-lookup"><span data-stu-id="dc104-295">For typical time-interval measurements, this effect can often be ignored because the quantizing error is much smaller than the time interval being measured.</span></span>

![medida de tiempo digital](images/digital-time-measure.png)

<span data-ttu-id="dc104-297">Sin embargo, si el período que se va a medir es pequeño y se aproxima a la resolución del temporizador, tendrá que considerar este error de cuantificación.</span><span class="sxs-lookup"><span data-stu-id="dc104-297">However, if the period being measured is small and approaches the resolution of the timer, you will need to consider this quantizing error.</span></span> <span data-ttu-id="dc104-298">El tamaño del error introducido es el de un período de reloj.</span><span class="sxs-lookup"><span data-stu-id="dc104-298">The size of the error introduced is that of one clock period.</span></span>

<span data-ttu-id="dc104-299">Los dos diagramas siguientes ilustran el impacto de la incertidumbre de la ± 1 marca mediante un temporizador con una resolución de 1 unidad de tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-299">The following two diagrams illustrate the impact of the ± 1 tick uncertainty by using a timer with a resolution of 1 time unit.</span></span>

![incertidumbre de marca](images/tick-uncertainty.png)

<span data-ttu-id="dc104-301">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) devuelve la frecuencia de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)y el punto y la resolución son iguales que el recíproco de este valor.</span><span class="sxs-lookup"><span data-stu-id="dc104-301">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) returns the frequency of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), and the period and resolution are equal to the reciprocal of this value.</span></span> <span data-ttu-id="dc104-302">La frecuencia del contador de rendimiento que **QueryPerformanceFrequency** devuelve se determina durante la inicialización del sistema y no cambia mientras se ejecuta el sistema.</span><span class="sxs-lookup"><span data-stu-id="dc104-302">The performance counter frequency that **QueryPerformanceFrequency** returns is determined during system initialization and doesn't change while the system is running.</span></span>

> [!Note]  
> <span data-ttu-id="dc104-303">Pueden existir casos en los que [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) no devuelva la frecuencia real del generador de TICs de hardware.</span><span class="sxs-lookup"><span data-stu-id="dc104-303">Cases might exist where [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) doesn't return the actual frequency of the hardware tick generator.</span></span> <span data-ttu-id="dc104-304">Por ejemplo, en muchos casos, **QueryPerformanceFrequency** devuelve la frecuencia de TSC dividida entre 1024; y en Hyper-V, la frecuencia del contador de rendimiento es siempre de 10 MHz cuando la máquina virtual invitada se ejecuta en un [hipervisor](https://msdn.microsoft.com/library/Ff542584(v=VS.85).aspx) que implementa la interfaz de la [versión 1,0 del hipervisor](https://msdn.microsoft.com/library/Ff541458(v=VS.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="dc104-304">For example, in many cases, **QueryPerformanceFrequency** returns the TSC frequency divided by 1024; and on Hyper-V, the performance counter frequency is always 10 MHz when the guest virtual machine runs under a [hypervisor](https://msdn.microsoft.com/library/Ff542584(v=VS.85).aspx) that implements the [hypervisor version 1.0 interface](https://msdn.microsoft.com/library/Ff541458(v=VS.85).aspx).</span></span> <span data-ttu-id="dc104-305">Como resultado, no suponga que **QueryPerformanceFrequency** devolverá la frecuencia de TSC exacta.</span><span class="sxs-lookup"><span data-stu-id="dc104-305">As a result, don't assume that **QueryPerformanceFrequency** will return the precise TSC frequency.</span></span>

 

<span data-ttu-id="dc104-306">[**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) lee el contador de rendimiento y devuelve el número total de pasos que se han producido desde que se inició el sistema operativo Windows, incluida la hora en que el equipo estuvo en un estado de suspensión, como en espera, hibernación o en modo de espera conectado.</span><span class="sxs-lookup"><span data-stu-id="dc104-306">[**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) reads the performance counter and returns the total number of ticks that have occurred since the Windows operating system was started, including the time when the machine was in a sleep state such as standby, hibernate, or connected standby.</span></span>

<span data-ttu-id="dc104-307">En estos ejemplos se muestra cómo calcular el intervalo de TICs y la resolución y cómo convertir el contador en un valor de hora.</span><span class="sxs-lookup"><span data-stu-id="dc104-307">These examples show how to calculate the tick interval and resolution and how to convert the tick count into a time value.</span></span>

<dl> <dt>

<span data-ttu-id="dc104-308"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Ejemplo 1**</span><span class="sxs-lookup"><span data-stu-id="dc104-308"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Example 1**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-309">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) devuelve el valor 3.125.000 en un equipo determinado.</span><span class="sxs-lookup"><span data-stu-id="dc104-309">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) returns the value 3,125,000 on a particular machine.</span></span> <span data-ttu-id="dc104-310">¿Cuál es el intervalo de pasos y la resolución de las medidas [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) en esta máquina?</span><span class="sxs-lookup"><span data-stu-id="dc104-310">What is the tick interval and resolution of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) measurements on this machine?</span></span> <span data-ttu-id="dc104-311">El intervalo de marca, o punto, es el recíproco de 3.125.000, que es 0,000000320 (320 nanosegundos).</span><span class="sxs-lookup"><span data-stu-id="dc104-311">The tick interval, or period, is the reciprocal of 3,125,000, which is 0.000000320 (320 nanoseconds).</span></span> <span data-ttu-id="dc104-312">Por lo tanto, cada TIC representa el paso de 320 nanosegundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-312">Therefore, each tick represents the passing of 320 nanoseconds.</span></span> <span data-ttu-id="dc104-313">Los intervalos de tiempo inferiores a 320 nanosegundos no se pueden medir en este equipo.</span><span class="sxs-lookup"><span data-stu-id="dc104-313">Time intervals smaller than 320 nanoseconds can't be measured on this machine.</span></span>

<span data-ttu-id="dc104-314">Intervalo entre TICs = 1/(frecuencia de rendimiento)</span><span class="sxs-lookup"><span data-stu-id="dc104-314">Tick Interval = 1/(Performance Frequency)</span></span>

<span data-ttu-id="dc104-315">Intervalo entre TICs = 1/3125000 = 320 NS</span><span class="sxs-lookup"><span data-stu-id="dc104-315">Tick Interval = 1/3,125,000 = 320 ns</span></span>

</dd> <dt>

<span data-ttu-id="dc104-316"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Ejemplo 2**</span><span class="sxs-lookup"><span data-stu-id="dc104-316"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Example 2**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-317">En el mismo equipo que en el ejemplo anterior, la diferencia de los valores devueltos por dos llamadas sucesivas a [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) es 5.</span><span class="sxs-lookup"><span data-stu-id="dc104-317">On the same machine as the preceding example, the difference of the values returned from two successive calls to [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is 5.</span></span> <span data-ttu-id="dc104-318">¿Cuánto tiempo ha transcurrido entre las dos llamadas?</span><span class="sxs-lookup"><span data-stu-id="dc104-318">How much time has elapsed between the two calls?</span></span> <span data-ttu-id="dc104-319">5 TICs multiplicados por 320 nanosegundos produce 1,6 microsegundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-319">5 ticks multiplied by 320 nanoseconds yields 1.6 microseconds.</span></span>

<span data-ttu-id="dc104-320">ElapsedTime = intervalo de \* TICs de TICs</span><span class="sxs-lookup"><span data-stu-id="dc104-320">ElapsedTime = Ticks \* Tick Interval</span></span>

<span data-ttu-id="dc104-321">ElapsedTime = 5 \* 320 NS = 1,6 μs</span><span class="sxs-lookup"><span data-stu-id="dc104-321">ElapsedTime = 5 \* 320 ns = 1.6 μs</span></span>

</dd> </dl>

<span data-ttu-id="dc104-322">Se tarda en acceder (leer) el contador desde el software y este tiempo de acceso puede reducir la precisión del de la medición de tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-322">It takes time to access (read) the tick counter from software, and this access time can reduce the precision of the of the time measurement.</span></span> <span data-ttu-id="dc104-323">Esto se debe a que el tiempo de intervalo mínimo (el intervalo de tiempo más pequeño que se puede medir) es el mayor de la resolución y el tiempo de acceso.</span><span class="sxs-lookup"><span data-stu-id="dc104-323">This is because the minimum interval time (the smallest time interval that can be measured) is the larger of the resolution and the access time.</span></span>

<span data-ttu-id="dc104-324">Precisión = \[ resolución máxima, AccessTime\]</span><span class="sxs-lookup"><span data-stu-id="dc104-324">Precision = MAX \[ Resolution, AccessTime\]</span></span>

<span data-ttu-id="dc104-325">Por ejemplo, considere un temporizador de hardware hipotético con una resolución de 100 nanosegundos y un tiempo de acceso de 800 nanosegundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-325">For example, consider a hypothetical hardware timer with a 100 nanosecond resolution and an 800 nanosecond access time.</span></span> <span data-ttu-id="dc104-326">Este podría ser el caso si se usara el temporizador de plataforma en lugar del registro de TSC como base de [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="dc104-326">This might be the case if the platform timer were used instead of the TSC register as the basis of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="dc104-327">Por lo tanto, la precisión sería de 800 nanosegundos y no 100 nanosegundos, tal como se muestra en este cálculo.</span><span class="sxs-lookup"><span data-stu-id="dc104-327">Thus, the precision would be 800 nanoseconds not 100 nanoseconds as shown in this calculation.</span></span>

<span data-ttu-id="dc104-328">Precisión = MAX \[ 800 NS, 100 NS \] = 800 NS</span><span class="sxs-lookup"><span data-stu-id="dc104-328">Precision = MAX \[800 ns,100 ns\] = 800 ns</span></span>

<span data-ttu-id="dc104-329">Estas dos figuras describen este efecto.</span><span class="sxs-lookup"><span data-stu-id="dc104-329">These two figures depict this effect.</span></span>

![tiempo de acceso de QPC](images/qpc-access-time.png)

<span data-ttu-id="dc104-331">Si el tiempo de acceso es mayor que la resolución, no intente mejorar la precisión mediante adivinación.</span><span class="sxs-lookup"><span data-stu-id="dc104-331">If the access time is greater than the resolution, don't try to improve the precision by guessing.</span></span> <span data-ttu-id="dc104-332">En otras palabras, es un error asumir que la marca de tiempo se toma exactamente en el centro, o al principio o al final de la llamada.</span><span class="sxs-lookup"><span data-stu-id="dc104-332">In other words, it's an error to assume that the time stamp is taken precisely in the middle, or at the beginning or the end of the call.</span></span>

<span data-ttu-id="dc104-333">Por el contrario, considere el siguiente ejemplo en el que el tiempo de acceso [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) es solo de 20 nanosegundos y la resolución del reloj de hardware es de 100 nanosegundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-333">By contrast, consider the following example in which the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) access time is only 20 nanoseconds and the hardware clock resolution is 100 nanoseconds.</span></span> <span data-ttu-id="dc104-334">Este podría ser el caso si se usó el registro de TSC como base para **QPC**.</span><span class="sxs-lookup"><span data-stu-id="dc104-334">This might be the case if the TSC register was used as the basis for **QPC**.</span></span> <span data-ttu-id="dc104-335">Aquí la precisión está limitada por la resolución del reloj.</span><span class="sxs-lookup"><span data-stu-id="dc104-335">Here the precision is limited by the clock resolution.</span></span>

![precisión de QPC](images/qpc-precision.png)

<span data-ttu-id="dc104-337">En la práctica, puede buscar los orígenes de hora para los que el tiempo necesario para leer el contador es mayor o menor que la resolución.</span><span class="sxs-lookup"><span data-stu-id="dc104-337">In practice, you can find time sources for which the time required to read the counter is larger or smaller than the resolution.</span></span> <span data-ttu-id="dc104-338">En cualquier caso, la precisión será la más grande de las dos.</span><span class="sxs-lookup"><span data-stu-id="dc104-338">In either case, the precision will be the larger of the two.</span></span>

<span data-ttu-id="dc104-339">En esta tabla se proporciona información sobre la resolución aproximada, el tiempo de acceso y la precisión de una variedad de relojes.</span><span class="sxs-lookup"><span data-stu-id="dc104-339">This table provides info on the approximate resolution, access time, and precision of a variety of clocks.</span></span> <span data-ttu-id="dc104-340">Tenga en cuenta que algunos de los valores variarán con diferentes procesadores, plataformas de hardware y velocidades de procesador.</span><span class="sxs-lookup"><span data-stu-id="dc104-340">Note that some of the values will vary with different processors, hardware platforms, and processor speeds.</span></span>



| <span data-ttu-id="dc104-341">Origen del reloj</span><span class="sxs-lookup"><span data-stu-id="dc104-341">Clock Source</span></span>                                                      | <span data-ttu-id="dc104-342">Frecuencia del reloj nominal</span><span class="sxs-lookup"><span data-stu-id="dc104-342">Nominal Clock Frequency</span></span> | <span data-ttu-id="dc104-343">Resolución del reloj</span><span class="sxs-lookup"><span data-stu-id="dc104-343">Clock Resolution</span></span>    | <span data-ttu-id="dc104-344">Tiempo de acceso (típico)</span><span class="sxs-lookup"><span data-stu-id="dc104-344">Access Time (Typical)</span></span> | <span data-ttu-id="dc104-345">Precisión</span><span class="sxs-lookup"><span data-stu-id="dc104-345">Precision</span></span>       |
|-------------------------------------------------------------------|-------------------------|---------------------|-----------------------|-----------------|
| <span data-ttu-id="dc104-346">RTC DE PC</span><span class="sxs-lookup"><span data-stu-id="dc104-346">PC RTC</span></span>                                                            | <span data-ttu-id="dc104-347">64 Hz</span><span class="sxs-lookup"><span data-stu-id="dc104-347">64 Hz</span></span>                   | <span data-ttu-id="dc104-348">15,625 milisegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-348">15.625 milliseconds</span></span> | <span data-ttu-id="dc104-349">N/D</span><span class="sxs-lookup"><span data-stu-id="dc104-349">N/A</span></span>                   | <span data-ttu-id="dc104-350">N/D</span><span class="sxs-lookup"><span data-stu-id="dc104-350">N/A</span></span>             |
| <span data-ttu-id="dc104-351">Contador de rendimiento de consultas mediante TSC con un reloj de procesador de 3 GHz</span><span class="sxs-lookup"><span data-stu-id="dc104-351">Query performance counter using TSC with a 3 GHz processor clock</span></span>  | <span data-ttu-id="dc104-352">3 MHz</span><span class="sxs-lookup"><span data-stu-id="dc104-352">3 MHz</span></span>                   | <span data-ttu-id="dc104-353">333 nanosegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-353">333 nanoseconds</span></span>     | <span data-ttu-id="dc104-354">30 nanosegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-354">30 nanoseconds</span></span>        | <span data-ttu-id="dc104-355">333 nanosegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-355">333 nanoseconds</span></span> |
| <span data-ttu-id="dc104-356">**RDTSC** instrucción máquina en un sistema con un ciclo de 3 GHz</span><span class="sxs-lookup"><span data-stu-id="dc104-356">**RDTSC** machine instruction on a system with a 3 GHz cycle time</span></span> | <span data-ttu-id="dc104-357">3 GHz</span><span class="sxs-lookup"><span data-stu-id="dc104-357">3 GHz</span></span>                   | <span data-ttu-id="dc104-358">333 picoseconds</span><span class="sxs-lookup"><span data-stu-id="dc104-358">333 picoseconds</span></span>     | <span data-ttu-id="dc104-359">30 nanosegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-359">30 nanoseconds</span></span>        | <span data-ttu-id="dc104-360">30 nanosegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-360">30 nanoseconds</span></span>  |



 

<span data-ttu-id="dc104-361">Dado que [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) usa un contador de hardware, cuando comprenda algunas características básicas de los contadores de hardware, conocerá las capacidades y limitaciones de **QPC**.</span><span class="sxs-lookup"><span data-stu-id="dc104-361">Because [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) uses a hardware counter, when you understand some basic characteristics of hardware counters, you gain understanding about the capabilities and limitations of **QPC**.</span></span>

<span data-ttu-id="dc104-362">El generador de TICs de hardware que se usa con más frecuencia es un oscilador de cristal.</span><span class="sxs-lookup"><span data-stu-id="dc104-362">The most commonly used hardware tick generator is a crystal oscillator.</span></span> <span data-ttu-id="dc104-363">Crystal es una pequeña pieza de cuarzo u otro material cerámico que exhibe características de Piezoelectric que proporcionan una referencia de frecuencia económica con una estabilidad y precisión excelentes.</span><span class="sxs-lookup"><span data-stu-id="dc104-363">The crystal is a small piece of quartz or other ceramic material that exhibits piezoelectric characteristics that provide an inexpensive frequency reference with excellent stability and accuracy.</span></span> <span data-ttu-id="dc104-364">Esta frecuencia se usa para generar los tics contados por el reloj.</span><span class="sxs-lookup"><span data-stu-id="dc104-364">This frequency is used to generate the ticks counted by the clock.</span></span>

<span data-ttu-id="dc104-365">La precisión de un temporizador hace referencia al grado de conformidad con un valor true o estándar.</span><span class="sxs-lookup"><span data-stu-id="dc104-365">The accuracy of a timer refers to the degree of conformity to a true or standard value.</span></span> <span data-ttu-id="dc104-366">Esto depende principalmente de la capacidad del oscilador de cristal para proporcionar TICs con la frecuencia especificada.</span><span class="sxs-lookup"><span data-stu-id="dc104-366">This depends primarily on the crystal oscillator’s ability to provide ticks at the specified frequency.</span></span> <span data-ttu-id="dc104-367">Si la frecuencia de oscilación es demasiado alta, el reloj se ejecutará rápidamente y los intervalos medidos aparecerán más tiempo del que son. y si la frecuencia es demasiado baja, el reloj se ejecutará lentamente y los intervalos medidos aparecerán más cortos que en realidad.</span><span class="sxs-lookup"><span data-stu-id="dc104-367">If the frequency of oscillation is too high, the clock will 'run fast', and measured intervals will appear longer than they really are; and if the frequency is too low, the clock will 'run slow', and measured intervals will appear shorter than they really are.</span></span>

<span data-ttu-id="dc104-368">En el caso de las medidas típicas de intervalo de tiempo para una duración corta (por ejemplo, medidas de tiempo de respuesta, medidas de latencia de red, etc.), la precisión del oscilador de hardware suele ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="dc104-368">For typical time-interval measurements for short duration (for example, response time measurements, network latency measurements, and so on), the accuracy of the hardware oscillator is usually sufficient.</span></span> <span data-ttu-id="dc104-369">Sin embargo, para algunas mediciones la precisión de la frecuencia del oscilador es importante, especialmente para los intervalos de tiempo largos o cuando se desea comparar las medidas tomadas en diferentes equipos.</span><span class="sxs-lookup"><span data-stu-id="dc104-369">However, for some measurements the oscillator frequency accuracy becomes important, particularly for long time intervals or when you want to compare measurements taken on different machines.</span></span> <span data-ttu-id="dc104-370">En el resto de esta sección se exploran los efectos de la precisión del oscilador.</span><span class="sxs-lookup"><span data-stu-id="dc104-370">The remainder of this section explores the effects of the oscillator accuracy.</span></span>

<span data-ttu-id="dc104-371">La frecuencia de la oscilación de los cristales se establece durante el proceso de fabricación y la especifica el fabricante en términos de una frecuencia especificada más o menos una tolerancia de fabricación expresada en ' partes por millón ' (ppm), denominada el desplazamiento de frecuencia máximo.</span><span class="sxs-lookup"><span data-stu-id="dc104-371">The crystals' frequency of oscillation is set during the manufacturing process and is specified by the manufacturer in terms of a specified frequency plus or minus a manufacturing tolerance expressed in 'parts per million' (ppm), called the maximum frequency offset.</span></span> <span data-ttu-id="dc104-372">Un cristal con una frecuencia especificada de 1 millón Hz y un desplazamiento de frecuencia máximo de ± 10 ppm se encontrarán dentro de los límites de especificación si su frecuencia real estaba entre 999.990 Hz y 1.000.010 Hz.</span><span class="sxs-lookup"><span data-stu-id="dc104-372">A crystal with a specified frequency of 1,000,000 Hz and a maximum frequency offset of ± 10 ppm would be within specification limits if its actual frequency were between 999,990 Hz and 1,000,010 Hz.</span></span>

<span data-ttu-id="dc104-373">Al sustituir las partes de la frase por millón de microsegundos por segundo, se puede aplicar este error de desplazamiento de frecuencia a las mediciones de intervalo de tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-373">By substituting the phrase parts per million with microseconds per second, we can apply this frequency offset error to time-interval measurements.</span></span> <span data-ttu-id="dc104-374">Un oscilador con un desfase + 10 ppm producirá un error de 10 microsegundos por segundo.</span><span class="sxs-lookup"><span data-stu-id="dc104-374">An oscillator with a + 10 ppm offset would have an error of 10 microseconds per second.</span></span> <span data-ttu-id="dc104-375">En consecuencia, al medir un intervalo de 1 segundo, se ejecutaría rápido y mediría un intervalo de 1 segundo como 0,999990 segundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-375">Accordingly, when measuring a 1 second interval, it would run fast and measure a 1 second interval as 0.999990 seconds.</span></span>

<span data-ttu-id="dc104-376">Una referencia adecuada es que un error de frecuencia de 100 ppm produce un error de 8,64 segundos después de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="dc104-376">A convenient reference is that a frequency error of 100 ppm causes an error of 8.64 seconds after 24 hours.</span></span> <span data-ttu-id="dc104-377">En esta tabla se presenta la incertidumbre de medición debido al error acumulado durante intervalos de tiempo más largos.</span><span class="sxs-lookup"><span data-stu-id="dc104-377">This table presents the measurement uncertainty due to the accumulated error for longer time intervals.</span></span>



| <span data-ttu-id="dc104-378">Duración del intervalo de tiempo</span><span class="sxs-lookup"><span data-stu-id="dc104-378">Time interval duration</span></span> | <span data-ttu-id="dc104-379">Incertidumbre de medición debido a un error acumulado con una tolerancia de frecuencia de +/-10 PPM</span><span class="sxs-lookup"><span data-stu-id="dc104-379">Measurement uncertainty due to accumulated error with +/- 10 PPM frequency tolerance</span></span> |
|------------------------|--------------------------------------------------------------------------------------|
| <span data-ttu-id="dc104-380">1 microsegundo</span><span class="sxs-lookup"><span data-stu-id="dc104-380">1 microsecond</span></span>          | <span data-ttu-id="dc104-381">± 10 picoseconds (10-12)</span><span class="sxs-lookup"><span data-stu-id="dc104-381">± 10 picoseconds (10-12)</span></span>                                                             |
| <span data-ttu-id="dc104-382">1 milisegundo</span><span class="sxs-lookup"><span data-stu-id="dc104-382">1 millisecond</span></span>          | <span data-ttu-id="dc104-383">± 10 nanosegundos (10-9)</span><span class="sxs-lookup"><span data-stu-id="dc104-383">± 10 nanoseconds (10-9)</span></span>                                                              |
| <span data-ttu-id="dc104-384">1 segundo</span><span class="sxs-lookup"><span data-stu-id="dc104-384">1 second</span></span>               | <span data-ttu-id="dc104-385">± 10 microsegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-385">± 10 microseconds</span></span>                                                                    |
| <span data-ttu-id="dc104-386">1 hora</span><span class="sxs-lookup"><span data-stu-id="dc104-386">1 hour</span></span>                 | <span data-ttu-id="dc104-387">± 60 microsegundos</span><span class="sxs-lookup"><span data-stu-id="dc104-387">± 60 microseconds</span></span>                                                                    |
| <span data-ttu-id="dc104-388">1 día</span><span class="sxs-lookup"><span data-stu-id="dc104-388">1 day</span></span>                  | <span data-ttu-id="dc104-389">± 0,86 segundos</span><span class="sxs-lookup"><span data-stu-id="dc104-389">± 0.86 seconds</span></span>                                                                       |
| <span data-ttu-id="dc104-390">1 semana</span><span class="sxs-lookup"><span data-stu-id="dc104-390">1 week</span></span>                 | <span data-ttu-id="dc104-391">± 6,08 segundos</span><span class="sxs-lookup"><span data-stu-id="dc104-391">± 6.08 seconds</span></span>                                                                       |



 

<span data-ttu-id="dc104-392">En la tabla anterior se muestra que para los intervalos de tiempo pequeños, a menudo se puede pasar por alto el error de desplazamiento de frecuencia.</span><span class="sxs-lookup"><span data-stu-id="dc104-392">The preceding table shows that for small time intervals the frequency offset error can often be ignored.</span></span> <span data-ttu-id="dc104-393">Sin embargo, en intervalos de tiempo prolongados, incluso un pequeño desplazamiento de frecuencia puede dar lugar a una incertidumbre de medición sustancial.</span><span class="sxs-lookup"><span data-stu-id="dc104-393">However for long time intervals, even a small frequency offset can result in a substantial measurement uncertainty.</span></span>

<span data-ttu-id="dc104-394">Los microosciladores que se usan en equipos y servidores personales se fabrican normalmente con una tolerancia de frecuencia de ± 30 a 50 partes por millón y, en raras ocasiones, los cristales pueden estar desactivados hasta 500 ppm.</span><span class="sxs-lookup"><span data-stu-id="dc104-394">Crystal oscillators that are used in personal computers and servers are typically manufactured with a frequency tolerance of ± 30 to 50 parts per million, and rarely, crystals can be off by as much as 500 ppm.</span></span> <span data-ttu-id="dc104-395">Aunque los cristales con tolerancias de desplazamiento de frecuencia mucho más estrictas están disponibles, son más caros y, por tanto, no se usan en la mayoría de los equipos.</span><span class="sxs-lookup"><span data-stu-id="dc104-395">Although crystals with much tighter frequency offset tolerances are available, they are more expensive and thus are not used in most computers.</span></span>

<span data-ttu-id="dc104-396">Para reducir los efectos adversos de este error de desplazamiento de frecuencia, las versiones recientes de Windows, especialmente Windows 8, usan varios temporizadores de hardware para detectar el desplazamiento de frecuencia y compensarlo en la medida de lo posible.</span><span class="sxs-lookup"><span data-stu-id="dc104-396">To reduce the adverse effects of this frequency offset error, recent versions of Windows, particularly Windows 8, use multiple hardware timers to detect the frequency offset and compensate for it to the extent possible.</span></span> <span data-ttu-id="dc104-397">Este proceso de calibración se realiza cuando se inicia Windows.</span><span class="sxs-lookup"><span data-stu-id="dc104-397">This calibration process is performed when Windows is started.</span></span>

<span data-ttu-id="dc104-398">Como muestran los ejemplos siguientes, el error de desplazamiento de frecuencia de un reloj de hardware influye en la precisión alcanzable y la resolución del reloj puede ser menos importante.</span><span class="sxs-lookup"><span data-stu-id="dc104-398">As the following examples show, the frequency offset error of a hardware clock influences the achievable accuracy, and the resolution of the clock can be less important.</span></span>

![el error de desplazamiento de frecuencia afecta a la precisión alcanzable](images/freq-offset-error.png)

<dl> <dt>

<span data-ttu-id="dc104-400"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Ejemplo 1**</span><span class="sxs-lookup"><span data-stu-id="dc104-400"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Example 1**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-401">Supongamos que realiza mediciones de intervalo de tiempo mediante un oscilador de 1 MHz, que tiene una resolución de un microsegundo y un error de desplazamiento de frecuencia máximo de ± 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="dc104-401">Suppose you perform time-interval measurements by using a 1 MHz oscillator, which has a resolution of 1 microsecond, and a maximum frequency offset error of ±50 ppm.</span></span> <span data-ttu-id="dc104-402">Ahora, supongamos que el desplazamiento es exactamente + 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="dc104-402">Now, let us suppose the offset is exactly +50 ppm.</span></span> <span data-ttu-id="dc104-403">Esto significa que la frecuencia real sería de 1.000.050 Hz.</span><span class="sxs-lookup"><span data-stu-id="dc104-403">This means that the actual frequency would be 1,000,050 Hz.</span></span> <span data-ttu-id="dc104-404">Si medimos un intervalo de tiempo de 24 horas, nuestra medida sería de 4,3 segundos demasiado corto (23:59:55.700000 medidos en lugar de 24:00:00.000000 real).</span><span class="sxs-lookup"><span data-stu-id="dc104-404">If we measured a time interval of 24 hours, our measurement would be 4.3 seconds too short (23:59:55.700000 measured versus 24:00:00.000000 actual).</span></span>

<span data-ttu-id="dc104-405">Segundos en un día = 86400</span><span class="sxs-lookup"><span data-stu-id="dc104-405">Seconds in a day = 86400</span></span>

<span data-ttu-id="dc104-406">Error de desplazamiento de frecuencia = 50 ppm = 0,00005</span><span class="sxs-lookup"><span data-stu-id="dc104-406">Frequency offset error = 50 ppm = 0.00005</span></span>

<span data-ttu-id="dc104-407">86.400 segundos \* 0,00005 = 4,3 segundos</span><span class="sxs-lookup"><span data-stu-id="dc104-407">86,400 seconds \* 0.00005 = 4.3 seconds</span></span>

</dd> <dt>

<span data-ttu-id="dc104-408"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Ejemplo 2**</span><span class="sxs-lookup"><span data-stu-id="dc104-408"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Example 2**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-409">Supongamos que el reloj del TSC del procesador está controlado por un oscilador de cristal y tiene una frecuencia especificada de 3 GHz.</span><span class="sxs-lookup"><span data-stu-id="dc104-409">Suppose the processor TSC clock is controlled by a crystal oscillator and has specified frequency of 3 GHz.</span></span> <span data-ttu-id="dc104-410">Esto significa que la resolución sería 1/3000000000 o aproximadamente 333 picoseconds.</span><span class="sxs-lookup"><span data-stu-id="dc104-410">This means that the resolution would be 1/3,000,000,000 or about 333 picoseconds.</span></span> <span data-ttu-id="dc104-411">Supongamos que el cristal que se usa para controlar el reloj del procesador tiene una tolerancia de frecuencia de ± 50 ppm y es en realidad + 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="dc104-411">Assume the crystal used to control the processor clock has a frequency tolerance of ±50 ppm and is actually +50 ppm.</span></span> <span data-ttu-id="dc104-412">A pesar de la resolución impresionante, una medición del intervalo de tiempo de 24 horas seguirá siendo 4,3 segundos demasiado corto.</span><span class="sxs-lookup"><span data-stu-id="dc104-412">In spite of the impressive resolution, a time-interval measurement of 24 hours will still be 4.3 seconds too short.</span></span> <span data-ttu-id="dc104-413">(23:59:55.7000000000 medido frente a 24:00:00.0000000000 real).</span><span class="sxs-lookup"><span data-stu-id="dc104-413">(23:59:55.7000000000 measured versus 24:00:00.0000000000 actual).</span></span>

<span data-ttu-id="dc104-414">Segundos en un día = 86400</span><span class="sxs-lookup"><span data-stu-id="dc104-414">Seconds in a day = 86400</span></span>

<span data-ttu-id="dc104-415">Error de desplazamiento de frecuencia = 50 ppm = 0,00005</span><span class="sxs-lookup"><span data-stu-id="dc104-415">Frequency offset error = 50 ppm = 0.00005</span></span>

<span data-ttu-id="dc104-416">86.400 segundos \* 0,00005 = 4,3 segundos</span><span class="sxs-lookup"><span data-stu-id="dc104-416">86,400 seconds \* 0.00005 = 4.3 seconds</span></span>

<span data-ttu-id="dc104-417">Esto muestra que un reloj de TSC de alta resolución no proporciona necesariamente medidas más precisas que un reloj de resolución inferior.</span><span class="sxs-lookup"><span data-stu-id="dc104-417">This shows that a high resolution TSC clock doesn't necessarily provide more accurate measurements than a lower resolution clock.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-418"><span id="Example_3"></span><span id="example_3"></span><span id="EXAMPLE_3"></span>**Ejemplo 3**</span><span class="sxs-lookup"><span data-stu-id="dc104-418"><span id="Example_3"></span><span id="example_3"></span><span id="EXAMPLE_3"></span>**Example 3**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-419">Considere la posibilidad de usar dos equipos diferentes para medir el mismo intervalo de tiempo de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="dc104-419">Consider using two different computers to measure the same 24 hour time interval.</span></span> <span data-ttu-id="dc104-420">Ambos equipos tienen un oscilador con un desplazamiento de frecuencia máximo de ± 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="dc104-420">Both computers have an oscillator with a maximum frequency offset of ± 50 ppm.</span></span> <span data-ttu-id="dc104-421">¿Qué diferencia hay entre la medida del mismo intervalo de tiempo en estos dos sistemas?</span><span class="sxs-lookup"><span data-stu-id="dc104-421">How far apart can the measurement of the same time interval on these two systems be?</span></span> <span data-ttu-id="dc104-422">Como en los ejemplos anteriores, ± 50 ppm produce un error máximo de ± 4,3 segundos después de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="dc104-422">As in the previous examples, ± 50 ppm yields a maximum error of ± 4.3 seconds after 24 hours.</span></span> <span data-ttu-id="dc104-423">Si un sistema se ejecuta 4,3 segundos con rapidez y los otros 4,3 segundos, el error máximo después de 24 horas puede ser de 8,6 segundos.</span><span class="sxs-lookup"><span data-stu-id="dc104-423">If one system runs 4.3 seconds fast, and the other 4.3 seconds slow, the maximum error after 24 hours could be 8.6 seconds.</span></span>

<span data-ttu-id="dc104-424">Segundos en un día = 86400</span><span class="sxs-lookup"><span data-stu-id="dc104-424">Seconds in a day = 86400</span></span>

<span data-ttu-id="dc104-425">Error de desplazamiento de frecuencia = ± 50 ppm = ± 0,00005</span><span class="sxs-lookup"><span data-stu-id="dc104-425">Frequency offset error = ±50 ppm = ±0.00005</span></span>

<span data-ttu-id="dc104-426">± (86.400 segundos \* 0,00005) = ± 4,3 segundos</span><span class="sxs-lookup"><span data-stu-id="dc104-426">±(86,400 seconds \* 0.00005) = ±4.3 seconds</span></span>

<span data-ttu-id="dc104-427">Desplazamiento máximo entre los dos sistemas = 8,6 segundos</span><span class="sxs-lookup"><span data-stu-id="dc104-427">Maximum offset between the two systems = 8.6 seconds</span></span>

<span data-ttu-id="dc104-428">En Resumen, el error de desplazamiento de frecuencia es cada vez más importante cuando se miden intervalos de tiempo prolongados y cuando se comparan medidas entre distintos sistemas.</span><span class="sxs-lookup"><span data-stu-id="dc104-428">In summary, the frequency offset error becomes increasingly important when measuring long time intervals and when comparing measurements between different systems.</span></span>

<span data-ttu-id="dc104-429">La estabilidad de un temporizador describe si la frecuencia de la marca cambia con el tiempo, por ejemplo, como resultado de los cambios de temperatura.</span><span class="sxs-lookup"><span data-stu-id="dc104-429">The stability of a timer describes whether the tick frequency changes over time, for example as the result of temperatures changes.</span></span> <span data-ttu-id="dc104-430">Los cristales de cuarzo usados como generadores de TICs en los equipos presentarán pequeños cambios de frecuencia como una función de temperatura.</span><span class="sxs-lookup"><span data-stu-id="dc104-430">Quartz crystals used as the tick generators on computers will exhibit small changes in frequency as a function of temperature.</span></span> <span data-ttu-id="dc104-431">El error provocado por el desfase térmico suele ser pequeño en comparación con el error de desplazamiento de frecuencia para los intervalos de temperatura comunes.</span><span class="sxs-lookup"><span data-stu-id="dc104-431">The error caused by thermal drift is typically small compared to the frequency offset error for common temperature ranges.</span></span> <span data-ttu-id="dc104-432">Sin embargo, es posible que los diseñadores de software para equipos portátiles o equipos sujetos a fluctuaciones de temperatura grandes tengan que tener en cuenta este efecto.</span><span class="sxs-lookup"><span data-stu-id="dc104-432">However, designers of software for portable equipment or equipment subject to large temperature fluctuations might need to consider this effect.</span></span>

</dd> </dl>

## <a name="hardware-timer-info"></a><span data-ttu-id="dc104-433">Información del temporizador de hardware</span><span class="sxs-lookup"><span data-stu-id="dc104-433">Hardware timer info</span></span>

<dl> <dt>

<span data-ttu-id="dc104-434"><span id="TSC_Register"></span><span id="tsc_register"></span><span id="TSC_REGISTER"></span>**Registro de TSC**</span><span class="sxs-lookup"><span data-stu-id="dc104-434"><span id="TSC_Register"></span><span id="tsc_register"></span><span id="TSC_REGISTER"></span>**TSC Register**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-435">Algunos procesadores Intel y AMD contienen un registro de TSC que es un registro de 64 bits que aumenta a una velocidad alta, normalmente igual al reloj del procesador.</span><span class="sxs-lookup"><span data-stu-id="dc104-435">Some Intel and AMD processors contain a TSC register that is a 64-bit register that increases at a high rate, typically equal to the processor clock.</span></span> <span data-ttu-id="dc104-436">El valor de este contador puede leerse en las instrucciones de la máquina **RDTSC** o **RDTSCP** , lo que proporciona un tiempo de acceso muy bajo y un costo computacional en el orden de decenas o centenares de ciclos del equipo, dependiendo del procesador.</span><span class="sxs-lookup"><span data-stu-id="dc104-436">The value of this counter can be read through the **RDTSC** or **RDTSCP** machine instructions, providing very low access time and computational cost in the order of tens or hundreds of machine cycles, depending upon the processor.</span></span>

<span data-ttu-id="dc104-437">Aunque el registro de TSC parece un mecanismo de marca de tiempo ideal, aquí se indican las circunstancias en las que no puede funcionar de forma confiable con fines de timekeeping:</span><span class="sxs-lookup"><span data-stu-id="dc104-437">Although the TSC register seems like an ideal time stamp mechanism, here are circumstances in which it can't function reliably for timekeeping purposes:</span></span>

-   <span data-ttu-id="dc104-438">No todos los procesadores tienen registros de TSC, por lo que el uso del registro de TSC en el software crea directamente un problema de portabilidad.</span><span class="sxs-lookup"><span data-stu-id="dc104-438">Not all processors have TSC registers, so using the TSC register in software directly creates a portability problem.</span></span> <span data-ttu-id="dc104-439">(Windows seleccionará un origen de hora alternativo para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) en este caso, lo que evita el problema de portabilidad).</span><span class="sxs-lookup"><span data-stu-id="dc104-439">(Windows will select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in this case, which avoids the portability problem.)</span></span>
-   <span data-ttu-id="dc104-440">Algunos procesadores pueden variar la frecuencia del reloj de TSC o detener el avance del registro de TSC, lo que hace que el TSC no sea adecuado para fines de control de tiempo en estos procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-440">Some processors can vary the frequency of the TSC clock or stop the advancement of the TSC register, which makes the TSC unsuitable for timing purposes on these processors.</span></span> <span data-ttu-id="dc104-441">Se dice que estos procesadores tienen registros de TSC no invariable.</span><span class="sxs-lookup"><span data-stu-id="dc104-441">These processors are said to have non-invariant TSC registers.</span></span> <span data-ttu-id="dc104-442">(Windows lo detectará automáticamente y seleccionará un origen de hora alternativo para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="dc104-442">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="dc104-443">En sistemas de varios procesadores o varios núcleos, algunos procesadores y sistemas no pueden sincronizar los relojes de cada núcleo con el mismo valor.</span><span class="sxs-lookup"><span data-stu-id="dc104-443">On multi-processor or multi-core systems, some processors and systems are unable to synchronize the clocks on each core to the same value.</span></span> <span data-ttu-id="dc104-444">(Windows lo detectará automáticamente y seleccionará un origen de hora alternativo para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="dc104-444">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="dc104-445">En algunos sistemas de varios procesadores de gran tamaño, es posible que no pueda sincronizar los relojes del procesador con el mismo valor aunque el procesador tenga un TSC invariable.</span><span class="sxs-lookup"><span data-stu-id="dc104-445">On some large multi-processor systems, you might not be able to synchronize the processor clocks to the same value even if the processor has an invariant TSC.</span></span> <span data-ttu-id="dc104-446">(Windows lo detectará automáticamente y seleccionará un origen de hora alternativo para [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="dc104-446">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="dc104-447">Algunos procesadores ejecutarán las instrucciones de forma desordenada.</span><span class="sxs-lookup"><span data-stu-id="dc104-447">Some processors will execute instructions out of order.</span></span> <span data-ttu-id="dc104-448">Esto puede dar lugar a recuentos de ciclos incorrectos cuando se usa **RDTSC** para las secuencias de instrucciones, ya que la instrucción **RDTSC** se puede ejecutar en un momento diferente del especificado en el programa.</span><span class="sxs-lookup"><span data-stu-id="dc104-448">This can result in incorrect cycle counts when **RDTSC** is used to time instruction sequences because the **RDTSC** instruction might be executed at a different time than specified in your program.</span></span> <span data-ttu-id="dc104-449">La instrucción **RDTSCP** se ha introducido en algunos procesadores en respuesta a este problema.</span><span class="sxs-lookup"><span data-stu-id="dc104-449">The **RDTSCP** instruction has been introduced on some processors in response to this problem.</span></span>

<span data-ttu-id="dc104-450">Al igual que otros temporizadores, el TSC se basa en un oscilador de cristal cuya frecuencia exacta no se conoce de antemano y que tiene un error de desplazamiento de frecuencia.</span><span class="sxs-lookup"><span data-stu-id="dc104-450">Like other timers, the TSC is based on a crystal oscillator whose exact frequency is not known in advance and that has a frequency offset error.</span></span> <span data-ttu-id="dc104-451">Por lo tanto, antes de que se pueda usar, se debe calibrar mediante otra referencia de control de tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-451">Thus before it can be used, it must be calibrated using another timing reference.</span></span>

<span data-ttu-id="dc104-452">Durante la inicialización del sistema, Windows comprueba si el TSC es adecuado para fines de temporización y realiza la calibración de frecuencia y la sincronización de núcleos necesarias.</span><span class="sxs-lookup"><span data-stu-id="dc104-452">During system initialization, Windows checks if the TSC is suitable for timing purposes and performs the necessary frequency calibration and core synchronization.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-453"><span id="PM_Clock"></span><span id="pm_clock"></span><span id="PM_CLOCK"></span>**Reloj PM**</span><span class="sxs-lookup"><span data-stu-id="dc104-453"><span id="PM_Clock"></span><span id="pm_clock"></span><span id="PM_CLOCK"></span>**PM Clock**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-454">El temporizador de ACPI, también conocido como el reloj PM, se ha agregado a la arquitectura del sistema para proporcionar marcas de tiempo confiables independientemente de la velocidad de los procesadores.</span><span class="sxs-lookup"><span data-stu-id="dc104-454">The ACPI timer, also known as the PM clock, was added to the system architecture to provide reliable time stamps independently of the processors speed.</span></span> <span data-ttu-id="dc104-455">Dado que este era el único objetivo de este temporizador, proporciona una marca de tiempo en un solo ciclo de reloj, pero no proporciona ninguna otra funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="dc104-455">Because this was the single goal of this timer, it provides a time stamp in a single clock cycle, but it doesn't provide any other functionality.</span></span>

</dd> <dt>

<span data-ttu-id="dc104-456"><span id="HPET_Timer"></span><span id="hpet_timer"></span><span id="HPET_TIMER"></span>**Temporizador de HPET**</span><span class="sxs-lookup"><span data-stu-id="dc104-456"><span id="HPET_Timer"></span><span id="hpet_timer"></span><span id="HPET_TIMER"></span>**HPET Timer**</span></span>
</dt> <dd>

<span data-ttu-id="dc104-457">Intel y Microsoft desarrolló conjuntamente el temporizador de eventos de alta precisión (HPET) para satisfacer los requisitos de control de tiempo de multimedia y otras aplicaciones que dependen del tiempo.</span><span class="sxs-lookup"><span data-stu-id="dc104-457">The High Precision Event Timer (HPET) was developed jointly by Intel and Microsoft to meet the timing requirements of multimedia and other time-sensitive applications.</span></span> <span data-ttu-id="dc104-458">La compatibilidad con HPET se ha realizado en Windows, ya que la certificación del logotipo de hardware de Windows Vista y Windows 7 y Windows 8 requiere compatibilidad con HPET en la plataforma de hardware.</span><span class="sxs-lookup"><span data-stu-id="dc104-458">HPET support has been in Windows since Windows Vista, and Windows 7 and Windows 8 Hardware Logo certification requires HPET support in the hardware platform.</span></span>

</dd> </dl>

 

 
