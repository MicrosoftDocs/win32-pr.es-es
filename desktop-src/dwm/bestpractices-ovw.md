---
title: Consideraciones de rendimiento y prácticas recomendadas
description: En este tema se presenta un conjunto de prácticas recomendadas para usar las API de Administrador de ventanas de escritorio (DWM).
ms.assetid: 5b1f6ff8-1d3f-4a70-8efd-90f8802e8532
keywords:
- Administrador de ventanas de escritorio (DWM), procedimientos recomendados
- DWM (Administrador de ventanas de escritorio), procedimientos recomendados
- Administrador de ventanas de escritorio (DWM), prácticas de aplicación
- DWM (Administrador de ventanas de escritorio), prácticas de aplicación
- Administrador de ventanas de escritorio (DWM), prácticas de dibujo
- DWM (Administrador de ventanas de escritorio), prácticas de dibujo
- Administrador de ventanas de escritorio (DWM), efecto Desenfoque detrás
- DWM (Administrador de ventanas de escritorio), efecto Desenfoque detrás
- prácticas de aplicación
- prácticas de dibujo
- Desenfoque detrás del efecto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ec76a4920a91f9502940e866d58641a2550d9354
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105705011"
---
# <a name="performance-considerations-and-best-practices"></a><span data-ttu-id="1f467-114">Consideraciones de rendimiento y prácticas recomendadas</span><span class="sxs-lookup"><span data-stu-id="1f467-114">Performance Considerations and Best Practices</span></span>

<span data-ttu-id="1f467-115">En este tema se presenta un conjunto de prácticas recomendadas para usar las API de Administrador de ventanas de escritorio (DWM).</span><span class="sxs-lookup"><span data-stu-id="1f467-115">This topic presents a set of best practices for using the Desktop Window Manager (DWM) APIs.</span></span>

<span data-ttu-id="1f467-116">Este tema contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="1f467-116">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="1f467-117">Prácticas de aplicación para DWM</span><span class="sxs-lookup"><span data-stu-id="1f467-117">Application Practices for DWM</span></span>](#application-practices-for-dwm)
-   [<span data-ttu-id="1f467-118">Prácticas de dibujo para DWM</span><span class="sxs-lookup"><span data-stu-id="1f467-118">Drawing Practices for DWM</span></span>](#drawing-practices-for-dwm)
-   [<span data-ttu-id="1f467-119">Región de cliente de Blur-Behind DWM</span><span class="sxs-lookup"><span data-stu-id="1f467-119">DWM Blur-Behind Client Region</span></span>](#dwm-blur-behind-client-region)

## <a name="application-practices-for-dwm"></a><span data-ttu-id="1f467-120">Prácticas de aplicación para DWM</span><span class="sxs-lookup"><span data-stu-id="1f467-120">Application Practices for DWM</span></span>

<span data-ttu-id="1f467-121">Si la aplicación controla el escalado de puntos por pulgada (PPP), puede declarar una aplicación como compatible con PPP y evitar el escalado automático estableciendo la marca de reconocimiento de PPP en el manifiesto del programa o llamando a la función [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) durante la inicialización del programa.</span><span class="sxs-lookup"><span data-stu-id="1f467-121">If your application handles dots per inch (dpi) scaling, you can declare an application as dpi-aware and prevent automatic scaling by setting the dpi-aware flag in the program's manifest or by calling the [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) function during program initialization.</span></span>

<span data-ttu-id="1f467-122">Con la composición DWM activada, las aplicaciones ocultas ya no reciben mensajes de [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) y no se les pide que se vuelvan a representar.</span><span class="sxs-lookup"><span data-stu-id="1f467-122">With DWM composition turned on, obscured applications no longer receive [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) messages and are not asked to re-render.</span></span> <span data-ttu-id="1f467-123">El contenido de cada ventana ya está disponible para crear la imagen de la pantalla.</span><span class="sxs-lookup"><span data-stu-id="1f467-123">Each window's content is already available to compose the screen image.</span></span>

<span data-ttu-id="1f467-124">Las ventanas de nivel superior [**WS \_ ex \_ transparentes**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) deben combinarse con un estilo con **\_ \_ capas de WS ex** para la prueba de posicionamiento.</span><span class="sxs-lookup"><span data-stu-id="1f467-124">Top-level [**WS\_EX\_TRANSPARENT**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) windows should be combined with a **WS\_EX\_LAYERED** style for the purposes of hit testing.</span></span> <span data-ttu-id="1f467-125">**WS \_ Como es \_ transparente** en el sentido clásico, sin redireccionamiento, resulta útil para las ventanas secundarias de una jerarquía de ventanas que pertenecen al mismo subproceso, pero no está pensada para las ventanas de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="1f467-125">**WS\_EX\_TRANSPARENT** in the classic sense, without redirection, is useful for child windows in a hierarchy of windows that belong to the same thread, but is not intended for top-level windows.</span></span>

<span data-ttu-id="1f467-126">Utilice regiones o capas para crear ventanas con forma o mezcla.</span><span class="sxs-lookup"><span data-stu-id="1f467-126">Use regions or layering to create shaped or blended windows.</span></span> <span data-ttu-id="1f467-127">Tenga en cuenta que en Windows Vista y versiones posteriores de Windows, el dibujo personalizado solo parte de una ventana de nivel superior no proporcionará el contenido obsoleto deseado en regiones desdibujadas.</span><span class="sxs-lookup"><span data-stu-id="1f467-127">Note that in Windows Vista and later versions of Windows, custom drawing only part of a top-level window will not provide the desired stale content in undrawn regions.</span></span>

<span data-ttu-id="1f467-128">Las API como [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) se pueden usar para determinar ciertos valores reales.</span><span class="sxs-lookup"><span data-stu-id="1f467-128">APIs such as [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) can be used to determine certain actual values.</span></span> <span data-ttu-id="1f467-129">Si tiene un contexto de dispositivo (DC) para una ventana redirigida, el origen devuelto por **GetDCOrgEx** no coincidirá con el origen de la ventana en la pantalla.</span><span class="sxs-lookup"><span data-stu-id="1f467-129">If you have a device context (DC) for a redirected window, the origin returned by **GetDCOrgEx** will not match the origin of your window on the screen.</span></span> <span data-ttu-id="1f467-130">En su lugar, el origen será el origen de la superficie del búfer de reserva de la ventana: (0,0).</span><span class="sxs-lookup"><span data-stu-id="1f467-130">The origin will instead be the origin of the back-buffer surface for your window: (0, 0).</span></span>

<span data-ttu-id="1f467-131">Si se produce un error en todo lo demás, deshabilite la representación de la ventana mediante una llamada a la función [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) .</span><span class="sxs-lookup"><span data-stu-id="1f467-131">When all else fails, disable window rendering by calling the [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) function.</span></span>

## <a name="drawing-practices-for-dwm"></a><span data-ttu-id="1f467-132">Prácticas de dibujo para DWM</span><span class="sxs-lookup"><span data-stu-id="1f467-132">Drawing Practices for DWM</span></span>

<span data-ttu-id="1f467-133">Evite dibujar directamente en la superficie de visualización principal.</span><span class="sxs-lookup"><span data-stu-id="1f467-133">Avoid drawing directly to the primary display surface.</span></span> <span data-ttu-id="1f467-134">Al hacerlo, se forzará al DWM a deshabilitar la composición hasta que la aplicación libere la superficie del dispositivo principal.</span><span class="sxs-lookup"><span data-stu-id="1f467-134">Doing so will force the DWM to disable composition until your application releases the primary device surface.</span></span>

<span data-ttu-id="1f467-135">Evalúe si la aplicación debe proporcionar su propio almacenamiento en búfer doble.</span><span class="sxs-lookup"><span data-stu-id="1f467-135">Evaluate whether your application must provide its own double buffering.</span></span> <span data-ttu-id="1f467-136">De forma eficaz, el DWM almacena en búfer el contenido y presenta la ventana en un solo fotograma.</span><span class="sxs-lookup"><span data-stu-id="1f467-136">The DWM effectively double buffers content and presents the window in a single frame.</span></span>

<span data-ttu-id="1f467-137">Evite leer o escribir en un controlador de dominio de pantalla.</span><span class="sxs-lookup"><span data-stu-id="1f467-137">Avoid reading from or writing to a display DC.</span></span> <span data-ttu-id="1f467-138">Aunque es compatible con DWM, no se recomienda porque disminuye el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="1f467-138">Although supported by DWM, we do not recommend it because of decreased performance.</span></span>

<span data-ttu-id="1f467-139">Evite dibujar en el área no cliente.</span><span class="sxs-lookup"><span data-stu-id="1f467-139">Avoid drawing in the non-client area.</span></span> <span data-ttu-id="1f467-140">Aunque la aplicación puede obtener acceso a esta área y el dibujo de la API de Microsoft Win32 lo admite, esto puede hacer que la ventana pierda cualquier borde Glass que tenga.</span><span class="sxs-lookup"><span data-stu-id="1f467-140">Although this area can be accessed by the application, and drawing there is supported by the Microsoft Win32 API, doing this can cause the window to lose any glass border it has.</span></span>

<span data-ttu-id="1f467-141">Evite mezclar Windows Interfaz de dispositivo gráfico (GDI) y Microsoft DirectX a menos que no se superpongan.</span><span class="sxs-lookup"><span data-stu-id="1f467-141">Avoid mixing Windows Graphics Device Interface (GDI) and Microsoft DirectX unless they do not overlap.</span></span> <span data-ttu-id="1f467-142">Si es necesario mezclar, dibuje el contenido de GDI en una superficie de software de DirectX y combínelo antes de componerlo en la pantalla, o bien dibuje en ventanas independientes.</span><span class="sxs-lookup"><span data-stu-id="1f467-142">If mixing is necessary, either draw the GDI content into a DirectX software surface and combine them before composing to the screen, or else draw them in separate windows.</span></span>

<span data-ttu-id="1f467-143">Use la función [**bitblt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) o [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) en lugar de Windows GDI+ para presentar el dibujo para su representación.</span><span class="sxs-lookup"><span data-stu-id="1f467-143">Use [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) or [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) function instead of Windows GDI+ to present your drawing for rendering.</span></span> <span data-ttu-id="1f467-144">GDI+ representa una línea de recorrido a la vez con la representación de software.</span><span class="sxs-lookup"><span data-stu-id="1f467-144">GDI+ renders one scan line at a time with software rendering.</span></span> <span data-ttu-id="1f467-145">Esto puede provocar parpadeos en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="1f467-145">This can cause flickering in your applications.</span></span>

## <a name="dwm-blur-behind-client-region"></a><span data-ttu-id="1f467-146">Región de cliente de Blur-Behind DWM</span><span class="sxs-lookup"><span data-stu-id="1f467-146">DWM Blur-Behind Client Region</span></span>

<span data-ttu-id="1f467-147">La representación del efecto de desenfoque es una operación que consume muchos recursos tanto para la CPU como para la unidad de procesamiento de gráficos (GPU).</span><span class="sxs-lookup"><span data-stu-id="1f467-147">Rendering the blur-behind effect is a resource-intensive operation for both the CPU and the graphics processing unit (GPU).</span></span> <span data-ttu-id="1f467-148">Se recomienda a los desarrolladores de aplicaciones que tengan en cuenta las implicaciones de usar el desenfoque del área de cliente para que no consuma demasiados recursos.</span><span class="sxs-lookup"><span data-stu-id="1f467-148">Application developers are urged to consider the implications of using client-area blur so that it does not consume excessive resources.</span></span> <span data-ttu-id="1f467-149">Debe tener especial cuidado en los casos siguientes:</span><span class="sxs-lookup"><span data-stu-id="1f467-149">You should use particular caution in the following cases:</span></span>

-   <span data-ttu-id="1f467-150">Cuando se espera que el tamaño del desenfoque del área cliente sea significativo, incluso si no se producirán actualizaciones en el área desenfocada.</span><span class="sxs-lookup"><span data-stu-id="1f467-150">When you expect the size of the client-area blur to be significant, even if no updates will occur in the blurred area itself.</span></span> <span data-ttu-id="1f467-151">Se debe representar el desenfoque en caso de que se produzcan actualizaciones en el área desenfocada de la ventana, lo que incurre en costos de CPU y GPU.</span><span class="sxs-lookup"><span data-stu-id="1f467-151">The blur has to be rendered in case any updates occur under the blurred area of the window, which incurs CPU and GPU costs.</span></span> <span data-ttu-id="1f467-152">Además, las operaciones de ventana en la ventana (movimiento/cambio de tamaño/transiciones) incurrirán en costos.</span><span class="sxs-lookup"><span data-stu-id="1f467-152">In addition, window operations on the window (move/resize/transitions) will incur more costs.</span></span>
-   <span data-ttu-id="1f467-153">Cuando se esperan actualizaciones significativas en el área de cliente desenfocada.</span><span class="sxs-lookup"><span data-stu-id="1f467-153">When you expect significant updates in the blurred client area.</span></span> <span data-ttu-id="1f467-154">Esto requerirá que se vuelva a dibujar el desenfoque en cada actualización y consuma demasiados recursos.</span><span class="sxs-lookup"><span data-stu-id="1f467-154">This will require a repaint of the blur on every update and consume excessive resources.</span></span>
-   <span data-ttu-id="1f467-155">Si se espera que el desenfoque cubra un área significativa y también se esperan actualizaciones en esa área, se recomienda encarecidamente no desenfocar el área cliente.</span><span class="sxs-lookup"><span data-stu-id="1f467-155">If the blur is expected to cover a significant area, and updates to that area are also expected, we strongly recommended that you do not blur the client area.</span></span>

 

 