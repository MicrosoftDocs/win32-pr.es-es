---
description: Administrar identificadores de archivos de transacciones en NTFS transaccional.
ms.assetid: 29879a3f-14b4-462c-a001-46c3c3eb74d1
title: Cómo usar NTFS transaccional
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43681f0d5b27f0db03d8b6c44564b792fce4b467
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105688463"
---
# <a name="how-to-use-transactional-ntfs"></a><span data-ttu-id="72e34-103">Cómo usar NTFS transaccional</span><span class="sxs-lookup"><span data-stu-id="72e34-103">How to Use Transactional NTFS</span></span>

## <a name="transacted-file-handles"></a><span data-ttu-id="72e34-104">Identificadores de archivo de transacción</span><span class="sxs-lookup"><span data-stu-id="72e34-104">Transacted File Handles</span></span>

<span data-ttu-id="72e34-105">NTFS transaccional (TxF) enlaza un identificador de archivo a una transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-105">Transactional NTFS (TxF) binds a file handle to a transaction.</span></span> <span data-ttu-id="72e34-106">En el caso de las operaciones que funcionan en un identificador (por ejemplo, las funciones [**readfile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) y [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) ), la llamada de función de API real no cambia.</span><span class="sxs-lookup"><span data-stu-id="72e34-106">For operations that work on a handle (for example, the [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) functions), the actual API function call does not change.</span></span> <span data-ttu-id="72e34-107">En el caso de las operaciones de archivo que toman un nombre, existen funciones de transacción explícitas para estas operaciones.</span><span class="sxs-lookup"><span data-stu-id="72e34-107">For file operations that take a name, there are explicit transacted functions for these operations.</span></span> <span data-ttu-id="72e34-108">Por ejemplo, en lugar de llamar a [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), llame a [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span><span class="sxs-lookup"><span data-stu-id="72e34-108">For example, instead of calling [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), call [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span> <span data-ttu-id="72e34-109">Esto crea un identificador de archivo de transacción, que se puede usar para todas las operaciones de archivo que requieren un identificador.</span><span class="sxs-lookup"><span data-stu-id="72e34-109">This creates a transacted file handle, which can then be used for all file operations requiring a handle.</span></span> <span data-ttu-id="72e34-110">Todas las operaciones posteriores que usan este identificador son operaciones de transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-110">All subsequent operations using this handle are transacted operations.</span></span>

## <a name="basic-txf-usage"></a><span data-ttu-id="72e34-111">Uso básico de TxF</span><span class="sxs-lookup"><span data-stu-id="72e34-111">Basic TxF Usage</span></span>

<span data-ttu-id="72e34-112">La siguiente serie de pasos representa el uso más básico de TxF.</span><span class="sxs-lookup"><span data-stu-id="72e34-112">The following series of steps represents the most basic usage for TxF.</span></span> <span data-ttu-id="72e34-113">También se admiten escenarios más complejos, a discreción del diseñador de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="72e34-113">More complex scenarios are also supported, at the discretion of the application designer.</span></span>

1.  <span data-ttu-id="72e34-114">Cree una transacción mediante una llamada a la función KTM [**CreateTransaction**](/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction) o mediante la interfaz **IKernelTransaction** del [Coordinador de transacciones distribuidas](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC).</span><span class="sxs-lookup"><span data-stu-id="72e34-114">Create a transaction by calling the KTM function [**CreateTransaction**](/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction) or by using the **IKernelTransaction** interface of the [Distributed Transaction Coordinator](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC).</span></span>
2.  <span data-ttu-id="72e34-115">Obtiene los identificadores de archivo de transacción llamando a [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span><span class="sxs-lookup"><span data-stu-id="72e34-115">Get transacted file handle(s) by calling [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span>
3.  <span data-ttu-id="72e34-116">Modifique los archivos según sea necesario con los identificadores de archivo de transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-116">Modify the file(s) as necessary using the transacted file handle(s).</span></span>
4.  <span data-ttu-id="72e34-117">Cierre todos los identificadores de archivo de transacciones asociados a la transacción creada en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="72e34-117">Close all transacted file handles associated with the transaction created in step 1.</span></span>
5.  <span data-ttu-id="72e34-118">Confirme o anule la transacción mediante una llamada a la función KTM o DTC correspondiente.</span><span class="sxs-lookup"><span data-stu-id="72e34-118">Commit or abort the transaction by calling the corresponding KTM or DTC function.</span></span>

## <a name="key-points-of-the-txf-programming-model"></a><span data-ttu-id="72e34-119">Puntos clave del modelo de programación de TxF</span><span class="sxs-lookup"><span data-stu-id="72e34-119">Key Points of the TxF Programming Model</span></span>

<span data-ttu-id="72e34-120">El modelo de programación TxF tiene los siguientes puntos clave que se deben tener en cuenta al desarrollar una aplicación TxF:</span><span class="sxs-lookup"><span data-stu-id="72e34-120">The TxF programming model has the following key points for you to consider when you develop a TxF application:</span></span>

-   <span data-ttu-id="72e34-121">Se recomienda encarecidamente que una aplicación cierre todos los identificadores de archivo de transacción antes de confirmar o revertir una transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-121">It is highly recommended that an application close all transacted file handles before committing or rolling back a transaction.</span></span> <span data-ttu-id="72e34-122">El sistema invalida todos los identificadores de transacciones cuando finaliza una transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-122">The system invalidates all transacted handles when a transaction ends.</span></span> <span data-ttu-id="72e34-123">Cualquier operación, excepto Close, realizada en un identificador de transacción después de que finalice la transacción devuelve el siguiente error: el **identificador de error ya \_ \_ no \_ \_ es válido**.</span><span class="sxs-lookup"><span data-stu-id="72e34-123">Any operation, except close, performed on a transacted handle after the transaction ends returns the following error: **ERROR\_HANDLE\_NO\_LONGER\_VALID**.</span></span>
-   <span data-ttu-id="72e34-124">Un archivo se ve como una unidad de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="72e34-124">A file is viewed as a unit of storage.</span></span> <span data-ttu-id="72e34-125">Se admiten las actualizaciones parciales y las sobrescrituras de archivos completadas.</span><span class="sxs-lookup"><span data-stu-id="72e34-125">Partial updates and complete file overwrites are supported.</span></span> <span data-ttu-id="72e34-126">Varias transacciones no pueden modificar simultáneamente el mismo archivo.</span><span class="sxs-lookup"><span data-stu-id="72e34-126">Multiple transactions cannot concurrently modify the same file.</span></span>
-   <span data-ttu-id="72e34-127">La e/s asignada a la memoria es transparente y coherente con la e/s de archivos normal.</span><span class="sxs-lookup"><span data-stu-id="72e34-127">Memory mapped I/O is transparent and consistent with the regular file I/O.</span></span> <span data-ttu-id="72e34-128">Una aplicación debe vaciar y cerrar una sección abierta antes de confirmar una transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-128">An application must flush and close an opened section before committing a transaction.</span></span> <span data-ttu-id="72e34-129">Si no lo hace, pueden producirse cambios parciales en el archivo asignado dentro de la transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-129">Failure to do this can result in partial changes to the mapped file within the transaction.</span></span> <span data-ttu-id="72e34-130">Si no se hace, se produce un error en la reversión.</span><span class="sxs-lookup"><span data-stu-id="72e34-130">A rollback fails if this is not done.</span></span>

## <a name="common-programming-errors"></a><span data-ttu-id="72e34-131">Errores comunes de programación</span><span class="sxs-lookup"><span data-stu-id="72e34-131">Common Programming Errors</span></span>

<span data-ttu-id="72e34-132">Pueden producirse los siguientes errores comunes al desarrollar aplicaciones con transacciones:</span><span class="sxs-lookup"><span data-stu-id="72e34-132">The following common errors can occur when developing transacted applications:</span></span>

-   <span data-ttu-id="72e34-133">Usar un identificador de archivo una vez completada una transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-133">Using a file handle after a transaction is completed.</span></span>
-   <span data-ttu-id="72e34-134">No se pueden cerrar los identificadores de los archivos y directorios eliminados antes de confirmar una transacción, lo que impedirá que se produzcan las operaciones de eliminación.</span><span class="sxs-lookup"><span data-stu-id="72e34-134">Failing to close handles to deleted files and directories before committing a transaction, which will prevent the delete operations from occurring.</span></span> <span data-ttu-id="72e34-135">Este evento se debe producir antes de realizar la confirmación para que la operación de eliminación se considere parte de la transacción.</span><span class="sxs-lookup"><span data-stu-id="72e34-135">This event must occur before performing the commit for the delete operation to be considered part of the transaction.</span></span> <span data-ttu-id="72e34-136">Esto se debe a que el sistema no elimina realmente un archivo hasta que se cierra el último identificador, incluso cuando la operación no se ha realizado con transacciones, como parte del subsistema de e/s de archivos de Windows.</span><span class="sxs-lookup"><span data-stu-id="72e34-136">This is because the system does not actually delete a file until the last handle to it is closed, even when the operation is not transacted, as part of the Windows file I/O subsystem.</span></span>
-   <span data-ttu-id="72e34-137">No se tienen en cuenta las reversiones de transacciones iniciadas por el sistema, que pueden producirse en cualquier momento; por ejemplo, una transacción se revierte si se agotan los recursos del sistema.</span><span class="sxs-lookup"><span data-stu-id="72e34-137">Failing to account for system-initiated transaction rollbacks, which may happen at any time; for example, a transaction is rolled back if the system resources are exhausted.</span></span>

 

 
