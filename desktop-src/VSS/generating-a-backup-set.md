---
description: Un conjunto de copia de seguridad es una lista de todos los archivos de los que se va a realizar una copia de seguridad, sus ubicaciones y cómo realizar copias de seguridad de los mismos.
ms.assetid: 34a66a9c-c1bc-437d-b034-59dc0c88228c
title: Generar un conjunto de copia de seguridad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 827d9ecb90ac376aa9818b61e8dab65550ff8c50
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105697018"
---
# <a name="generating-a-backup-set"></a><span data-ttu-id="00aeb-103">Generar un conjunto de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="00aeb-103">Generating A Backup Set</span></span>

<span data-ttu-id="00aeb-104">Un conjunto de copia de seguridad es una lista de todos los archivos de los que se va a realizar una copia de seguridad, sus ubicaciones y cómo realizar copias de seguridad de los mismos.</span><span class="sxs-lookup"><span data-stu-id="00aeb-104">A backup set is a list of all files to be backed up, their locations, and how to back them up.</span></span>

<span data-ttu-id="00aeb-105">Un solicitante debe hacer uso de los archivos contenidos en los volúmenes de copia sombra después de que el [**osnapshotset de IVssBackupComponents::D**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) se devuelva correctamente para generar la lista completa de archivos de los que se va a hacer una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="00aeb-105">A requester must make use of the files contained on the shadow-copied volumes after the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) returns successfully to generate the full list of files to be backed up.</span></span>

<span data-ttu-id="00aeb-106">Además, un solicitante debe afrontar la posibilidad de que algunos archivos tengan rutas de acceso [*alternativas*](vssgloss-a.md) y que se hayan excluido algunos archivos.</span><span class="sxs-lookup"><span data-stu-id="00aeb-106">In addition, a requester must deal with the possibility that some files have [*alternate paths*](vssgloss-a.md) and that some files have been excluded.</span></span>

<span data-ttu-id="00aeb-107">Un algoritmo para seleccionar archivos de los que se va a realizar una copia de seguridad debe estar en una [*instancia de escritor*](vssgloss-w.md) por instancia de escritor, componente por componente (como será el caso durante la restauración; vea [generar un conjunto de restauración](generating-a-restore-set.md)) y puede continuar haciendo lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="00aeb-107">An algorithm for selecting files to back up should go on a [*writer instance*](vssgloss-w.md) by writer instance, component-by-component basis (as will be the case during restore; see [Generating a Restore Set](generating-a-restore-set.md)) and might proceed by doing the following:</span></span>

1.  <span data-ttu-id="00aeb-108">Determinar los volúmenes que contienen los archivos del escritor y los objetos de dispositivo correspondientes</span><span class="sxs-lookup"><span data-stu-id="00aeb-108">Determining the volumes that contain the writer's files and the corresponding device objects</span></span>
2.  <span data-ttu-id="00aeb-109">Usar la información del [*conjunto de archivos*](vssgloss-f.md) (contenida en los objetos [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) devueltos por [**IVssExamineWriterMetadata:: GetExcludeFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) para crear una lista de los archivos excluidos explícitamente, si es necesario, mediante **FindFileFirst**, **FindFileFirstEx** y **FindNextFile**.</span><span class="sxs-lookup"><span data-stu-id="00aeb-109">Using the [*file set*](vssgloss-f.md) information (contained in [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) objects returned by [**IVssExamineWriterMetadata::GetExcludeFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) to create a list of the explicitly excluded files, if necessary using **FindFileFirst**, **FindFileFirstEx**, and **FindNextFile**.</span></span>
3.  <span data-ttu-id="00aeb-110">Recorrer en iteración todos los componentes de un escritor mediante [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span><span class="sxs-lookup"><span data-stu-id="00aeb-110">Iterating over all of a writer's components, using [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent).</span></span> <span data-ttu-id="00aeb-111">Si se selecciona un componente seleccionable, utilice la [*ruta de acceso lógica*](vssgloss-l.md) para obtener los componentes no seleccionables asociados a él en un conjunto de componentes.</span><span class="sxs-lookup"><span data-stu-id="00aeb-111">If a selectable component is selected, use [*logical path*](vssgloss-l.md) to obtain those nonselectable components associated with it in a component set.</span></span> <span data-ttu-id="00aeb-112">(Vea [trabajar con la selección y las rutas de acceso lógicas](working-with-selectability-and-logical-paths.md)).</span><span class="sxs-lookup"><span data-stu-id="00aeb-112">(See [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md).)</span></span>
4.  <span data-ttu-id="00aeb-113">Obtener los [*conjuntos de archivos*](vssgloss-f.md) contenidos en cada componente seleccionado mediante la interfaz [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) correspondiente a cada componente que contiene.</span><span class="sxs-lookup"><span data-stu-id="00aeb-113">Obtaining the [*file sets*](vssgloss-f.md) contained in each selected component by using the [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface corresponding to each component it contains.</span></span>
5.  <span data-ttu-id="00aeb-114">Generar una lista de archivos a partir de las especificaciones, si es necesario, mediante **FindFileFirst**, **FindFileFirstEx** y **FindNextFile**.</span><span class="sxs-lookup"><span data-stu-id="00aeb-114">Generating a list of files from the specifications—if necessary using **FindFileFirst**, **FindFileFirstEx**, and **FindNextFile**.</span></span>
6.  <span data-ttu-id="00aeb-115">Comprobando cada archivo de la lista que se genera a partir de la información del componente en la lista de archivos excluidos generados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="00aeb-115">Checking each file in the list generated from component information against the list of excluded files generated above.</span></span> <span data-ttu-id="00aeb-116">Esto se debe hacer mediante la ruta de acceso predeterminada del archivo (devuelta por [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), no por la ruta de acceso alternativa devuelta por [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)).</span><span class="sxs-lookup"><span data-stu-id="00aeb-116">This should be done using the default path for the file (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), not by the alternate path returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)).</span></span> <span data-ttu-id="00aeb-117">Si el archivo coincide con la lista de exclusión, no se incluirá en la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="00aeb-117">If the file matches the excluded list, it will not be backed up.</span></span>
7.  <span data-ttu-id="00aeb-118">Elección de la ubicación real desde la que se realizará la copia de seguridad (mediante la ruta alternativa si se estableció)</span><span class="sxs-lookup"><span data-stu-id="00aeb-118">Choosing the actual location from which to back up (using the alternate path if it was set)</span></span>
8.  <span data-ttu-id="00aeb-119">En este momento, hay disponible una lista completa de archivos y sus ubicaciones y se puede iniciar una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="00aeb-119">At this point, a full list of files and their locations is available and a backup can begin.</span></span>

<span data-ttu-id="00aeb-120">Una vez que se ha generado un conjunto de copia de seguridad inicial para todos los escritores que están presentes en el sistema, el solicitante comprueba la siguiente clave del registro:</span><span class="sxs-lookup"><span data-stu-id="00aeb-120">After an initial backup set has been generated for all writers that are present on the system, the requester then checks the following registry key:</span></span>

<span data-ttu-id="00aeb-121">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ control \\ BackupRestore \\ FilesNotToBackup**</span><span class="sxs-lookup"><span data-stu-id="00aeb-121">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\FilesNotToBackup**</span></span>

<span data-ttu-id="00aeb-122">El solicitante utiliza las subclaves de esta clave de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="00aeb-122">The requester uses the subkeys under this key as follows:</span></span>

-   <span data-ttu-id="00aeb-123">Si hay un escritor presente en el sistema y hay una subclave cuyo nombre coincide con el nombre del sistema de escritura, esa subclave debe omitirse.</span><span class="sxs-lookup"><span data-stu-id="00aeb-123">If a writer is present on the system, and there is a subkey whose name matches the writer's name, that subkey must be ignored.</span></span>
-   <span data-ttu-id="00aeb-124">Si un escritor estaba presente en el sistema pero no está presente en el conjunto de copia de seguridad y hay una subclave coincidente, se excluyen los archivos especificados en los datos de la subclave y se deben quitar del conjunto de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="00aeb-124">If a writer was present on the system but is currently absent from the backup set, and there is a matching subkey, any files specified in the subkey data are excluded and must be removed from the backup set.</span></span>
-   <span data-ttu-id="00aeb-125">La aplicación de copia de seguridad agrega archivos a los datos de la subclave creando un \_ valor multisz que contiene una lista de especificaciones de archivo para los archivos de los que no se debe hacer una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="00aeb-125">The backup application adds files to the subkey data by creating a MULTI\_SZ value containing a list of file specifications for the files that must not be backed up.</span></span> <span data-ttu-id="00aeb-126">Cada cadena del \_ valor multisz debe contener una especificación de archivo.</span><span class="sxs-lookup"><span data-stu-id="00aeb-126">Each string in the MULTI\_SZ value should contain one file specification.</span></span>
-   <span data-ttu-id="00aeb-127">Las especificaciones de archivo pueden contener el</span><span class="sxs-lookup"><span data-stu-id="00aeb-127">File specifications can contain the ?</span></span> <span data-ttu-id="00aeb-128">y \* caracteres comodín.</span><span class="sxs-lookup"><span data-stu-id="00aeb-128">and \* wildcard characters.</span></span> <span data-ttu-id="00aeb-129">Una especificación se puede hacer recursiva anexando/s al final.</span><span class="sxs-lookup"><span data-stu-id="00aeb-129">A specification can be made recursive by appending /s to the end.</span></span> <span data-ttu-id="00aeb-130">Por ejemplo, si se especifica "% TEMP% \\ \* /s", no se realizará la copia de seguridad de todos los archivos del directorio% Temp% y de todos sus subdirectorios.</span><span class="sxs-lookup"><span data-stu-id="00aeb-130">For example, specifying "%TEMP%\\\* /s" causes all files in the %TEMP% directory and all of its subdirectories not to be backed up.</span></span>

 

 



