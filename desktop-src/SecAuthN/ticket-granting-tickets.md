---
description: Como el protocolo Kerberos se diseñó originalmente, una clave maestra para un usuario se derivó de una contraseña proporcionada por el usuario.
ms.assetid: b8fcb68d-751e-4495-ab92-8b70c96aaa7a
title: Ticket-Granting vales
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 39dff161ba2d905f676fe6b6b5e7e7d5289ee550
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104154344"
---
# <a name="ticket-granting-tickets"></a><span data-ttu-id="5aa35-103">Ticket-Granting vales</span><span class="sxs-lookup"><span data-stu-id="5aa35-103">Ticket-Granting Tickets</span></span>

<span data-ttu-id="5aa35-104">Como el [*protocolo Kerberos*](../secgloss/k-gly.md) se diseñó originalmente, una clave maestra para un usuario se derivó de una contraseña proporcionada por el usuario.</span><span class="sxs-lookup"><span data-stu-id="5aa35-104">As the [*Kerberos protocol*](../secgloss/k-gly.md) was originally designed, a master key for a user was derived from a password provided by the user.</span></span> <span data-ttu-id="5aa35-105">Cuando un usuario ha iniciado sesión, el cliente Kerberos de la estación de trabajo del usuario aceptó la contraseña del usuario y la ha convertido en una clave de cifrado pasando el texto a través de una función [*hash*](../secgloss/h-gly.md) unidireccional.</span><span class="sxs-lookup"><span data-stu-id="5aa35-105">When a user logged on, the Kerberos client on the user's workstation accepted the password from the user and converted it into an encryption key by passing the text through a one-way [*hash*](../secgloss/h-gly.md) function.</span></span> <span data-ttu-id="5aa35-106">El hash resultante era la [*clave maestra*](../secgloss/m-gly.md)del usuario.</span><span class="sxs-lookup"><span data-stu-id="5aa35-106">The resulting hash was the user's [*master key*](../secgloss/m-gly.md).</span></span> <span data-ttu-id="5aa35-107">El cliente usó esta *clave maestra* para descifrar [*las claves de sesión*](../secgloss/s-gly.md) recibidas de KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-107">The client used this *master key* to decrypt [*session keys*](../secgloss/s-gly.md) received from KDC.</span></span>

<span data-ttu-id="5aa35-108">El problema con el diseño de Kerberos original es que el cliente necesita la clave maestra del usuario cada vez que descifra una clave de sesión del KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-108">The problem with the original Kerberos design is the client needs the user's master key each time it decrypts a session key from the KDC.</span></span> <span data-ttu-id="5aa35-109">Esto significa que el cliente debe pedir al usuario la contraseña al principio de cada intercambio cliente/servidor, o bien el cliente debe almacenar la clave del usuario en la estación de trabajo.</span><span class="sxs-lookup"><span data-stu-id="5aa35-109">That means either the client must ask the user for the password at the beginning of every client/server exchange, or the client must store the user's key on the workstation.</span></span> <span data-ttu-id="5aa35-110">Las interrupciones frecuentes del usuario son demasiado intrusivas.</span><span class="sxs-lookup"><span data-stu-id="5aa35-110">Frequent interruptions of the user are too intrusive.</span></span> <span data-ttu-id="5aa35-111">El almacenamiento de la clave en la estación de trabajo pone en peligro una clave derivada de la contraseña del usuario, que es una clave a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="5aa35-111">Storing the key on the workstation risks compromising a key derived from the user password which is a long term key.</span></span>

<span data-ttu-id="5aa35-112">La solución del protocolo Kerberos a este problema es que el cliente obtenga una clave temporal del KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-112">The Kerberos protocol's solution to this problem is for the client to get a temporary key from the KDC.</span></span> <span data-ttu-id="5aa35-113">Esta clave temporal solo es adecuada para esta [*sesión de inicio*](../secgloss/l-gly.md)de sesión.</span><span class="sxs-lookup"><span data-stu-id="5aa35-113">This temporary key is good only for this [*logon session*](../secgloss/l-gly.md).</span></span> <span data-ttu-id="5aa35-114">Cuando un usuario inicia sesión, el cliente solicita un vale para el KDC de la misma forma que solicitaría un vale para cualquier otro servicio.</span><span class="sxs-lookup"><span data-stu-id="5aa35-114">When a user logs on, the client requests a ticket for the KDC just as it would request a ticket for any other service.</span></span> <span data-ttu-id="5aa35-115">El KDC responde mediante la creación de una clave de sesión de inicio de sesión y un vale para un servidor especial, el servicio de concesión de vales completo del KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-115">The KDC responds by creating a logon session key and a ticket for a special server, the KDC's full ticket-granting service.</span></span> <span data-ttu-id="5aa35-116">En el vale se inserta una copia de la clave de sesión de inicio de sesión y el vale se cifra con la clave maestra del KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-116">One copy of the logon session key is embedded in the ticket, and the ticket is encrypted with the KDC's master key.</span></span> <span data-ttu-id="5aa35-117">Otra copia de la clave de sesión de inicio de sesión se cifra con la clave maestra del usuario derivada de la contraseña de inicio de sesión del usuario.</span><span class="sxs-lookup"><span data-stu-id="5aa35-117">Another copy of the logon session key is encrypted with the user's master key derived from the user's logon password.</span></span> <span data-ttu-id="5aa35-118">Tanto el vale como la clave de sesión cifrada se envían al cliente.</span><span class="sxs-lookup"><span data-stu-id="5aa35-118">Both the ticket and the encrypted session key are sent to the client.</span></span>

<span data-ttu-id="5aa35-119">Cuando el cliente obtiene la respuesta del KDC, descifra la clave de sesión de inicio de sesión con la clave maestra del usuario derivada de la contraseña del usuario.</span><span class="sxs-lookup"><span data-stu-id="5aa35-119">When the client gets the KDC's reply, it decrypts the logon session key with the user's master key derived from the user's password.</span></span> <span data-ttu-id="5aa35-120">El cliente ya no necesita la clave derivada de la contraseña del usuario, ya que ahora el cliente usará la clave de sesión de inicio de sesión para descifrar su copia de cualquier clave de sesión de servidor que obtenga del KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-120">The client no longer needs the key derived from the user's password because the client will now use the logon session key to decrypt its copy of any server session key it gets from the KDC.</span></span> <span data-ttu-id="5aa35-121">El cliente almacena la clave de sesión de inicio de sesión en su caché de vales junto con su vale para el servicio de concesión de vales completo del KDC.</span><span class="sxs-lookup"><span data-stu-id="5aa35-121">The client stores the logon session key in its ticket cache along with its ticket for the KDC's full ticket-granting service.</span></span>

<span data-ttu-id="5aa35-122">El vale del servicio de concesión de vales completo se denomina vale de concesión de vales (TGT).</span><span class="sxs-lookup"><span data-stu-id="5aa35-122">The ticket for the full ticket-granting service is called a ticket-granting ticket (TGT).</span></span> <span data-ttu-id="5aa35-123">Cuando el cliente solicita al KDC un vale para un servidor, presenta [*credenciales*](../secgloss/c-gly.md) en forma de mensaje de autenticador y un vale, en este caso un TGT, de la misma forma que presenta las credenciales a cualquier otro servicio.</span><span class="sxs-lookup"><span data-stu-id="5aa35-123">When the client asks the KDC for a ticket to a server, it presents [*credentials*](../secgloss/c-gly.md) in the form of an authenticator message and a ticket — in this case a TGT — just as it would present credentials to any other service.</span></span> <span data-ttu-id="5aa35-124">El servicio de concesión de vales abre el TGT con su clave maestra, extrae la clave de sesión de inicio de sesión para este cliente y usa la clave de sesión de inicio de sesión para cifrar la copia del cliente de una clave de sesión del servidor.</span><span class="sxs-lookup"><span data-stu-id="5aa35-124">The ticket-granting service opens the TGT with its master key, extracts the logon session key for this client, and uses the logon session key to encrypt the client's copy of a session key for the server.</span></span>

 

 
