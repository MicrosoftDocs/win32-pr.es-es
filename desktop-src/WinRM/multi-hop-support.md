---
title: Compatibilidad con múltiples saltos en WinRM
description: Administración remota de Windows (WinRM) admite la delegación de las credenciales de usuario en varios equipos remotos.
ms.assetid: 0e6c8966-bb05-4dfb-b154-300fa76e8d9c
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f22c3d66e8605e932fe15b812f92d51350da2d69
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104495857"
---
# <a name="multi-hop-support-in-winrm"></a><span data-ttu-id="6d965-103">Compatibilidad con múltiples saltos en WinRM</span><span class="sxs-lookup"><span data-stu-id="6d965-103">Multi-Hop Support in WinRM</span></span>

<span data-ttu-id="6d965-104">Administración remota de Windows (WinRM) admite la delegación de las credenciales de usuario en varios equipos remotos.</span><span class="sxs-lookup"><span data-stu-id="6d965-104">Windows Remote Management (WinRM) supports the delegation of user credentials across multiple remote computers.</span></span> <span data-ttu-id="6d965-105">La funcionalidad de compatibilidad con varios saltos ahora puede utilizar el proveedor de servicios de seguridad de credenciales (CredSSP) para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="6d965-105">The multi-hop support functionality can now use Credential Security Service Provider (CredSSP) for authentication.</span></span> <span data-ttu-id="6d965-106">CredSSP permite a una aplicación delegar las credenciales del usuario desde el equipo cliente al servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="6d965-106">CredSSP enables an application to delegate the user's credentials from the client computer to the target server.</span></span>

<span data-ttu-id="6d965-107">La autenticación CredSSP está pensada para entornos en los que no se puede usar la delegación Kerberos.</span><span class="sxs-lookup"><span data-stu-id="6d965-107">CredSSP authentication is intended for environments where Kerberos delegation cannot be used.</span></span> <span data-ttu-id="6d965-108">Se ha agregado compatibilidad con CredSSP para permitir que un usuario se conecte a un servidor remoto y tenga la capacidad de obtener acceso a un equipo de segundo salto, como un recurso compartido de archivos.</span><span class="sxs-lookup"><span data-stu-id="6d965-108">Support for CredSSP was added to allow a user to connect to a remote server and have the ability to access a second-hop machine, such as a file share.</span></span>

<span data-ttu-id="6d965-109">Para obtener más información acerca de CredSSP, consulte [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="6d965-109">For more information about CredSSP, see [KB 951608](https://support.microsoft.com/kb/951608).</span></span>

> [!Note]  
> <span data-ttu-id="6d965-110">Los clientes y servidores de WinRM solo admiten la autenticación CredSSP con credenciales explícitas.</span><span class="sxs-lookup"><span data-stu-id="6d965-110">WinRM clients and servers will support CredSSP authentication only with explicit credentials.</span></span>

 

## <a name="multi-hop-support-configuration-setup-and-details"></a><span data-ttu-id="6d965-111">Configuración y detalles de la configuración de compatibilidad con múltiples saltos</span><span class="sxs-lookup"><span data-stu-id="6d965-111">Multi-Hop Support Configuration Setup and Details</span></span>

<span data-ttu-id="6d965-112">Existen varios mecanismos para configurar las opciones de WinRM.</span><span class="sxs-lookup"><span data-stu-id="6d965-112">There are multiple mechanisms for configuring WinRM settings.</span></span> <span data-ttu-id="6d965-113">En el procedimiento siguiente, se usan la utilidad **WinRM** y el editor de directiva de grupo (**gpedit. msc**).</span><span class="sxs-lookup"><span data-stu-id="6d965-113">In the following procedure, the **winrm** utility and Group Policy editor (**GPEdit.msc**) are used.</span></span> <span data-ttu-id="6d965-114">CredSSP también puede habilitarse para WinRM mediante Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="6d965-114">CredSSP can also be enabled for WinRM by using Windows PowerShell.</span></span> <span data-ttu-id="6d965-115">Consulte los cmdlets [enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true)y [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) de Windows PowerShell para obtener información detallada sobre la configuración y ejemplos de uso.</span><span class="sxs-lookup"><span data-stu-id="6d965-115">See the [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true), and [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) Windows PowerShell cmdlets for detailed configuration information and usage examples.</span></span>

<span data-ttu-id="6d965-116">La delegación CredSSP debe estar habilitada en la configuración de cliente y en la configuración del servicio en el equipo remoto.</span><span class="sxs-lookup"><span data-stu-id="6d965-116">CredSSP delegation must be enabled in the client settings and in the service settings on the remote computer.</span></span> <span data-ttu-id="6d965-117">Además, el uso de CredSSP requiere la configuración de un [*agente de escucha*](windows-remote-management-glossary.md) http o https en el servidor.</span><span class="sxs-lookup"><span data-stu-id="6d965-117">In addition, using CredSSP requires setting up an HTTP or HTTPS [*listener*](windows-remote-management-glossary.md) on the server.</span></span>

<span data-ttu-id="6d965-118">**Para configurar la compatibilidad con múltiples saltos mediante la autenticación CredSSP para WinRM**</span><span class="sxs-lookup"><span data-stu-id="6d965-118">**To configure multi-hop support using CredSSP authentication for WinRM**</span></span>

1.  <span data-ttu-id="6d965-119">CredSSP debe estar habilitado en las opciones de configuración del cliente.</span><span class="sxs-lookup"><span data-stu-id="6d965-119">CredSSP must be enabled in the client configuration settings.</span></span> <span data-ttu-id="6d965-120">Esta marca se puede habilitar manualmente o a través de un valor de directiva de grupo.</span><span class="sxs-lookup"><span data-stu-id="6d965-120">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="6d965-121">El valor predeterminado es **False**.</span><span class="sxs-lookup"><span data-stu-id="6d965-121">The default setting is **False**.</span></span> <span data-ttu-id="6d965-122">La Directiva de **autenticación CredSSP** se encuentra en la siguiente ruta de acceso: configuración del equipo \\ plantilla administrativa \\ componentes de Windows \\ administración remota de Windows (WinRM) \\ cliente WinRM.</span><span class="sxs-lookup"><span data-stu-id="6d965-122">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Client.</span></span>

    <span data-ttu-id="6d965-123">El siguiente comando muestra cómo usar la utilidad WinRM para habilitar CredSSP en el cliente WinRM:</span><span class="sxs-lookup"><span data-stu-id="6d965-123">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM client:</span></span>

    <span data-ttu-id="6d965-124">**WinRM Set WinRM/config/Client/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="6d965-124">**winrm set winrm/config/client/auth @{CredSSP="true"}**</span></span>

2.  <span data-ttu-id="6d965-125">CredSSP debe estar habilitado en la configuración del servicio WinRM.</span><span class="sxs-lookup"><span data-stu-id="6d965-125">CredSSP must be enabled in the WinRM service configuration settings.</span></span> <span data-ttu-id="6d965-126">Esta marca se puede habilitar manualmente o a través de un valor de directiva de grupo.</span><span class="sxs-lookup"><span data-stu-id="6d965-126">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="6d965-127">El valor predeterminado es **False**.</span><span class="sxs-lookup"><span data-stu-id="6d965-127">The default setting is **False**.</span></span> <span data-ttu-id="6d965-128">La Directiva de **autenticación CredSSP** se encuentra en la siguiente ruta de acceso: configuración del equipo \\ plantillas administrativas \\ componentes de Windows \\ administración remota de Windows (WinRM) \\ WinRM.</span><span class="sxs-lookup"><span data-stu-id="6d965-128">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Service.</span></span>

    <span data-ttu-id="6d965-129">El siguiente comando muestra cómo usar la utilidad WinRM para habilitar CredSSP en el servicio WinRM:</span><span class="sxs-lookup"><span data-stu-id="6d965-129">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM service:</span></span>

    <span data-ttu-id="6d965-130">**WinRM Set WinRM/config/Service/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="6d965-130">**winrm set winrm/config/service/auth @{CredSSP="true"}**</span></span>

3.  <span data-ttu-id="6d965-131">La configuración de directiva permitir delegación de credenciales nuevas (**AllowFreshCredentials**) debe estar habilitada en el cliente WinRM y debe agregarse a la Directiva un nombre principal de servicio (SPN) con el prefijo WSMAN.</span><span class="sxs-lookup"><span data-stu-id="6d965-131">The Allow Delegating Fresh Credentials (**AllowFreshCredentials**) policy setting must be enabled on the WinRM client, and a Service Principal Name (SPN) with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="6d965-132">El SPN representa el equipo de destino al que se pueden delegar las credenciales de usuario.</span><span class="sxs-lookup"><span data-stu-id="6d965-132">The SPN represents the target computer to which the user credentials can be delegated.</span></span> <span data-ttu-id="6d965-133">El SPN se puede establecer en uno o varios equipos.</span><span class="sxs-lookup"><span data-stu-id="6d965-133">The SPN can be set to one or more computers.</span></span> <span data-ttu-id="6d965-134">En la tabla siguiente se incluyen ejemplos de formatos válidos para SPN.</span><span class="sxs-lookup"><span data-stu-id="6d965-134">The following table contains examples of valid formats for SPNs.</span></span>

    

    | <span data-ttu-id="6d965-135">SPN</span><span class="sxs-lookup"><span data-stu-id="6d965-135">SPN</span></span>                                       | <span data-ttu-id="6d965-136">Descripción</span><span class="sxs-lookup"><span data-stu-id="6d965-136">Description</span></span>                                                                         |
    |-------------------------------------------|-------------------------------------------------------------------------------------|
    | <span data-ttu-id="6d965-137">WSMAN/mi. midominio. com</span><span class="sxs-lookup"><span data-stu-id="6d965-137">WSMAN/myComputer.myDomain.com</span></span><br/>  | <span data-ttu-id="6d965-138">Servidor WinRM que se ejecuta en myComputer.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="6d965-138">WinRM server running on myComputer.myDomain.com.</span></span><br/>                         |
    | <span data-ttu-id="6d965-139">WSMAN/ \* . mydomain.com</span><span class="sxs-lookup"><span data-stu-id="6d965-139">WSMAN/\*.myDomain.com</span></span><br/>          | <span data-ttu-id="6d965-140">Todos los servidores WinRM que se ejecutan en myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="6d965-140">All WinRM servers running in myDomain.com.</span></span><br/>                               |
    | <span data-ttu-id="6d965-141">WSMAN/ \* . fabrikam.mydomain.com</span><span class="sxs-lookup"><span data-stu-id="6d965-141">WSMAN/\*.fabrikam.myDomain.com</span></span><br/> | <span data-ttu-id="6d965-142">Todos los servidores WinRM que se ejecutan en en todos los equipos de. fabrikam.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="6d965-142">All WinRM servers running in on all computers in .fabrikam.myDomain.com.</span></span><br/> |

    

     

    <span data-ttu-id="6d965-143">Para obtener más información sobre la configuración de directivas de grupo, consulte [instalación y configuración de administración remota de Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="6d965-143">For more information about setting Group Policies, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

    <span data-ttu-id="6d965-144">Para obtener más información sobre la directiva **AllowFreshCredentials** , vea la descripción de la Directiva proporcionada por el editor de directiva de grupo y [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="6d965-144">For more information about the **AllowFreshCredentials** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="6d965-145">La directiva **AllowFreshCredentials** se encuentra en la siguiente ruta de acceso: configuración \\ del equipo Plantillas administrativas delegación de \\ \\ credenciales del sistema.</span><span class="sxs-lookup"><span data-stu-id="6d965-145">The **AllowFreshCredentials** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

4.  <span data-ttu-id="6d965-146">Se debe configurar un [*agente de escucha*](windows-remote-management-glossary.md) https o http en el servidor.</span><span class="sxs-lookup"><span data-stu-id="6d965-146">An HTTPS or HTTP [*listener*](windows-remote-management-glossary.md) must be configured on the server.</span></span> <span data-ttu-id="6d965-147">La huella digital del certificado que se usa para configurar el *agente de escucha* https también se usa para configurar el valor CertificateThumbprint en la configuración del servicio WinRM.</span><span class="sxs-lookup"><span data-stu-id="6d965-147">The certificate thumbprint used for configuring the HTTPS *listener* is also used to configure the CertificateThumbprint setting under the WinRM service settings.</span></span>

    <span data-ttu-id="6d965-148">El siguiente comando muestra cómo usar la utilidad WinRM para configurar un agente de [*escucha*](windows-remote-management-glossary.md)https:</span><span class="sxs-lookup"><span data-stu-id="6d965-148">The following command demonstrates how to use the winrm utility to configure an HTTPS [*listener*](windows-remote-management-glossary.md):</span></span>

    <span data-ttu-id="6d965-149">**WinRM quickconfig-Transport: https**</span><span class="sxs-lookup"><span data-stu-id="6d965-149">**winrm quickconfig -transport:https**</span></span>

<span data-ttu-id="6d965-150">Si no es posible la autenticación Kerberos entre el cliente y el servidor, el usuario debe configurar una de las siguientes opciones para la compatibilidad con múltiples saltos:</span><span class="sxs-lookup"><span data-stu-id="6d965-150">If Kerberos authentication between the client and server is not possible, the user must configure one of the following settings for multi-hop support:</span></span>

-   <span data-ttu-id="6d965-151">Para mejorar la seguridad, el usuario debe agregar el atributo **CertificateThumbprint** a la configuración del servicio WinRM.</span><span class="sxs-lookup"><span data-stu-id="6d965-151">For better security, the user should add the **CertificateThumbprint** attribute to the WinRM service setting.</span></span> <span data-ttu-id="6d965-152">Si el servicio WinRM está configurado con un atributo **CertificateThumbprint** , el servicio intenta buscar el certificado correspondiente en el almacén del equipo local y usa este certificado para la autenticación CredSSP.</span><span class="sxs-lookup"><span data-stu-id="6d965-152">If the WinRM service is configured with a **CertificateThumbprint** attribute, the service attempts to locate the corresponding certificate in the Local Machine store and uses this certificate for the CredSSP authentication.</span></span> <span data-ttu-id="6d965-153">Si el servicio WinRM usa un certificado del almacén del equipo local para autenticar el servidor, se debe permitir el acceso a la cuenta de servicio de red a la clave privada del certificado.</span><span class="sxs-lookup"><span data-stu-id="6d965-153">If the WinRM service uses a certificate from the Local Machine store to authenticate the server, the Network Service account must be allowed access to the private key of the certificate.</span></span>

    > [!Note]  
    > <span data-ttu-id="6d965-154">Si la configuración del servicio no está configurada, el servidor WinRM usa un certificado autofirmado que se crea en la memoria para cifrar los mensajes que se envían al cliente.</span><span class="sxs-lookup"><span data-stu-id="6d965-154">If the service setting is not configured, the WinRM server uses a self-signed certificate that is created in memory to encrypt messages sent to the client.</span></span> <span data-ttu-id="6d965-155">Sin embargo, este certificado no se utiliza para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="6d965-155">However, this certificate is not used for authentication.</span></span>

     

-   <span data-ttu-id="6d965-156">Si no hay disponible ninguna autenticación Kerberos ni huellas digitales de certificado, el usuario puede habilitar la autenticación NTLM.</span><span class="sxs-lookup"><span data-stu-id="6d965-156">If neither Kerberos authentication nor certificate thumbprints are available, the user can enable NTLM authentication.</span></span> <span data-ttu-id="6d965-157">Si se usa la autenticación NTLM, la Directiva permitir credenciales nuevas con autenticación de servidor solo NTLM (**AllowFreshCredentialsWhenNTLMOnly**) debe estar habilitada y se debe agregar un SPN con el prefijo WSMAN a la Directiva.</span><span class="sxs-lookup"><span data-stu-id="6d965-157">If NTLM authentication is used, the Allow Fresh Credentials with NTLM-only Server Authentication (**AllowFreshCredentialsWhenNTLMOnly**) policy must be enabled, and an SPN with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="6d965-158">Esta opción es menos segura que la autenticación Kerberos y las huellas digitales de certificado, ya que las credenciales se envían a un servidor no autenticado.</span><span class="sxs-lookup"><span data-stu-id="6d965-158">This setting is less secure than both Kerberos authentication and certificate thumbprints, because credentials are sent to an unauthenticated server.</span></span>

    <span data-ttu-id="6d965-159">Para obtener más información sobre la directiva **AllowFreshCredentialsWhenNTLMOnly** , vea la descripción de la Directiva proporcionada por el editor de directiva de grupo y [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="6d965-159">For more information about the **AllowFreshCredentialsWhenNTLMOnly** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="6d965-160">La directiva **AllowFreshCredentialsWhenNTLMOnly** se encuentra en la siguiente ruta de acceso: configuración \\ del equipo Plantillas administrativas delegación de \\ \\ credenciales del sistema.</span><span class="sxs-lookup"><span data-stu-id="6d965-160">The **AllowFreshCredentialsWhenNTLMOnly** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

## <a name="using-credssp-authentication-with-explicit-credentials"></a><span data-ttu-id="6d965-161">Usar la autenticación CredSSP con credenciales explícitas</span><span class="sxs-lookup"><span data-stu-id="6d965-161">Using CredSSP Authentication with Explicit Credentials</span></span>

<span data-ttu-id="6d965-162">Un usuario puede especificar credenciales explícitas a través de HTTP y HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6d965-162">A user can specify explicit credentials over both HTTP and HTTPS.</span></span> <span data-ttu-id="6d965-163">El siguiente comando muestra cómo usar la utilidad WinRM para realizar una operación remota mediante la autenticación CredSSP con credenciales explícitas a través de HTTPS:</span><span class="sxs-lookup"><span data-stu-id="6d965-163">The following command demonstrates how to use the winrm utility to perform a remote operation using CredSSP authentication with explicit credentials over HTTPS:</span></span>

<span data-ttu-id="6d965-164">**OPERACIÓN de WinRM-remoto: https://myMachine -autenticación: CredSSP-nombredeusuario: nombre de usuario-contraseña: contraseña**</span><span class="sxs-lookup"><span data-stu-id="6d965-164">**winrm OPERATION -remote:https://myMachine -authentication:CredSSP -username:myUsername -password:myPassword**</span></span>

 

