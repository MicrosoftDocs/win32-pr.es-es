---
description: Solicita el modo en que la pila de red debe controlar ciertos comportamientos para los que la manera predeterminada de controlar el comportamiento puede diferir en las versiones de Windows.
ms.assetid: 9574e21f-5ac4-4210-8031-2f3b07416813
title: Código de control de SIO_SET_COMPATIBILITY_MODE
ms.topic: reference
ms.date: 05/20/2019
req.target-min-winverclnt: Windows Vista [desktop apps only]
req.target-min-winversvr: Windows Server 2008 [desktop apps only]
api_location:
- mstcpip.h
ms.openlocfilehash: 58972595adb71a30728cb4817a80814cd987a6de
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105720362"
---
# <a name="sio_set_compatibility_mode-control-code"></a><span data-ttu-id="e2a1b-103">Código de control de SIO_SET_COMPATIBILITY_MODE</span><span class="sxs-lookup"><span data-stu-id="e2a1b-103">SIO_SET_COMPATIBILITY_MODE Control Code</span></span>

## <a name="description"></a><span data-ttu-id="e2a1b-104">Descripción</span><span class="sxs-lookup"><span data-stu-id="e2a1b-104">Description</span></span>

<span data-ttu-id="e2a1b-105">El código de control de **\_ modo de \_ compatibilidad \_ SiO Set** solicita el modo en que la pila de red debe controlar ciertos comportamientos para los que la manera predeterminada de controlar el comportamiento puede diferir en las versiones de Windows.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-105">The **SIO\_SET\_COMPATIBILITY\_MODE** control code requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>

<span data-ttu-id="e2a1b-106">Para realizar esta operación, llame a la función [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** con los parámetros siguientes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-106">To perform this operation, call the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function with the following parameters.</span></span>

```cpp
int WSAIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
);
```

```cpp
int WSPIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
  (LPWSATHREADID) lpThreadId,   // a WSATHREADID structure
  (LPINT) lpErrno   // a pointer to the error code.
);
```

## <a name="parameters"></a><span data-ttu-id="e2a1b-107">Parámetros</span><span class="sxs-lookup"><span data-stu-id="e2a1b-107">Parameters</span></span>

### <a name="s"></a><span data-ttu-id="e2a1b-108">s</span><span class="sxs-lookup"><span data-stu-id="e2a1b-108">s</span></span>

<span data-ttu-id="e2a1b-109">Un descriptor que identifica un socket.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-109">A descriptor identifying a socket.</span></span>

### <a name="dwiocontrolcode"></a><span data-ttu-id="e2a1b-110">dwIoControlCode</span><span class="sxs-lookup"><span data-stu-id="e2a1b-110">dwIoControlCode</span></span>

<span data-ttu-id="e2a1b-111">Código de control de la operación.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-111">The control code for the operation.</span></span>
<span data-ttu-id="e2a1b-112">Use **SiO \_ set \_ Compatibility \_ mode** para esta operación.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-112">Use **SIO\_SET\_COMPATIBILITY\_MODE** for this operation.</span></span>

### <a name="lpvinbuffer"></a><span data-ttu-id="e2a1b-113">lpvInBuffer</span><span class="sxs-lookup"><span data-stu-id="e2a1b-113">lpvInBuffer</span></span>

<span data-ttu-id="e2a1b-114">Puntero al búfer de entrada.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-114">A pointer to the input buffer.</span></span>
<span data-ttu-id="e2a1b-115">Este parámetro debe apuntar a una estructura de **\_ \_ modo de compatibilidad WSA** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-115">This parameter should point to a **WSA\_COMPATIBILITY\_MODE** structure.</span></span>

### <a name="cbinbuffer"></a><span data-ttu-id="e2a1b-116">cbInBuffer</span><span class="sxs-lookup"><span data-stu-id="e2a1b-116">cbInBuffer</span></span>

<span data-ttu-id="e2a1b-117">Tamaño, en bytes, del búfer de entrada.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-117">The size, in bytes, of the input buffer.</span></span>
<span data-ttu-id="e2a1b-118">Este parámetro debe ser igual o mayor que el tamaño de la estructura del **\_ \_ modo de compatibilidad WSA** señalada por el parámetro *lpvInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-118">This parameter should equal to or greater than the size of the **WSA\_COMPATIBILITY\_MODE** structure pointed to by the *lpvInBuffer* parameter.</span></span>

### <a name="lpvoutbuffer"></a><span data-ttu-id="e2a1b-119">lpvOutBuffer</span><span class="sxs-lookup"><span data-stu-id="e2a1b-119">lpvOutBuffer</span></span>

<span data-ttu-id="e2a1b-120">Puntero al búfer de salida.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-120">A pointer to the output buffer.</span></span>
<span data-ttu-id="e2a1b-121">Este parámetro no se usa para esta operación.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-121">This parameter is unused for this operation.</span></span>

### <a name="cboutbuffer"></a><span data-ttu-id="e2a1b-122">cbOutBuffer</span><span class="sxs-lookup"><span data-stu-id="e2a1b-122">cbOutBuffer</span></span>

<span data-ttu-id="e2a1b-123">Tamaño, en bytes, del búfer de salida.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-123">The size, in bytes, of the output buffer.</span></span>
<span data-ttu-id="e2a1b-124">Este parámetro debe establecerse en cero.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-124">This parameter must be set to zero.</span></span>

### <a name="lpcbbytesreturned"></a><span data-ttu-id="e2a1b-125">lpcbBytesReturned</span><span class="sxs-lookup"><span data-stu-id="e2a1b-125">lpcbBytesReturned</span></span>

<span data-ttu-id="e2a1b-126">Puntero a una variable que recibe el tamaño, en bytes, de los datos almacenados en el búfer de salida.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-126">A pointer to a variable that receives the size, in bytes, of the data stored in the output buffer.</span></span>
<span data-ttu-id="e2a1b-127">Este parámetro devuelve un valor **DWORD** de cero para esta operación, ya que no hay ninguna salida.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-127">This returned parameter points to a **DWORD** value of zero for this operation, since there is no output.</span></span>

### <a name="lpvoverlapped"></a><span data-ttu-id="e2a1b-128">lpvOverlapped</span><span class="sxs-lookup"><span data-stu-id="e2a1b-128">lpvOverlapped</span></span>

<span data-ttu-id="e2a1b-129">Puntero a una estructura [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-129">A pointer to a [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="e2a1b-130">Si el socket *s* se creó sin el atributo superpuesto, se omite el parámetro *lpOverlapped* .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-130">If socket *s* was created without the overlapped attribute, the *lpOverlapped* parameter is ignored.</span></span>

<span data-ttu-id="e2a1b-131">Si se abrió *s* con el atributo superpuesto y el parámetro *LpOverlapped* no es **null**, la operación se realiza como una operación superpuesta (asincrónica).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-131">If *s* was opened with the overlapped attribute and the *lpOverlapped* parameter is not **NULL**, the operation is performed as an overlapped (asynchronous) operation.</span></span>
<span data-ttu-id="e2a1b-132">En este caso, el parámetro *lpOverlapped* debe apuntar a una estructura [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) válida.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-132">In this case, *lpOverlapped* parameter must point to a valid [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="e2a1b-133">En el caso de las operaciones superpuestas, las funciones [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** se devuelven inmediatamente y el método de finalización adecuado se señala cuando se ha completado la operación.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-133">For overlapped operations, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns immediately, and the appropriate completion method is signaled when the operation has been completed.</span></span>
<span data-ttu-id="e2a1b-134">De lo contrario, la función no devuelve ningún resultado hasta que se haya completado la operación o se produzca un error.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-134">Otherwise, the function does not return until the operation has been completed or an error occurs.</span></span>

### <a name="lpcompletionroutine"></a><span data-ttu-id="e2a1b-135">lpCompletionRoutine</span><span class="sxs-lookup"><span data-stu-id="e2a1b-135">lpCompletionRoutine</span></span>

<span data-ttu-id="e2a1b-136">Tipo: \_ In_opt \_ [ **LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span><span class="sxs-lookup"><span data-stu-id="e2a1b-136">Type: \_In_opt\_ [**LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span></span>

<span data-ttu-id="e2a1b-137">Puntero a la rutina de finalización a la que se llama cuando la operación se ha completado (se omite para los sockets no superpuestos).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-137">A pointer to the completion routine called when the operation has been completed (ignored for non-overlapped sockets).</span></span>

### <a name="lpthreadid"></a><span data-ttu-id="e2a1b-138">lpThreadId</span><span class="sxs-lookup"><span data-stu-id="e2a1b-138">lpThreadId</span></span>

<span data-ttu-id="e2a1b-139">Puntero a una estructura [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) que va a usar el proveedor en una llamada subsiguiente a [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-139">A pointer to a [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure to be used by the provider in a subsequent call to [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span>
<span data-ttu-id="e2a1b-140">El proveedor debe almacenar la estructura [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) a la que se hace referencia (no el puntero a la misma) hasta que se devuelva la función [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-140">The provider should store the referenced [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure (not the pointer to same) until after the [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) function returns.</span></span>

<span data-ttu-id="e2a1b-141">**Nota:**  Este parámetro solo se aplica a la función **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-141">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

### <a name="lperrno"></a><span data-ttu-id="e2a1b-142">lpErrno</span><span class="sxs-lookup"><span data-stu-id="e2a1b-142">lpErrno</span></span>

<span data-ttu-id="e2a1b-143">Puntero al código de error.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-143">A pointer to the error code.</span></span>

<span data-ttu-id="e2a1b-144">**Nota:**  Este parámetro solo se aplica a la función **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-144">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

## <a name="return-value"></a><span data-ttu-id="e2a1b-145">Valor devuelto</span><span class="sxs-lookup"><span data-stu-id="e2a1b-145">Return value</span></span>

<span data-ttu-id="e2a1b-146">Si la operación se completa correctamente, la función [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** devuelve cero.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-146">If the operation completes successfully, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns zero.</span></span>

<span data-ttu-id="e2a1b-147">Si se produce un error en la operación o está pendiente, la función [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** devuelve un **\_ error de socket**.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-147">If the operation fails or is pending, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns **SOCKET\_ERROR**.</span></span>
<span data-ttu-id="e2a1b-148">Para obtener información de error extendida, llame a [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-148">To get extended error information, call [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span></span>

| <span data-ttu-id="e2a1b-149">Código de error</span><span class="sxs-lookup"><span data-stu-id="e2a1b-149">Error code</span></span> | <span data-ttu-id="e2a1b-150">Significado</span><span class="sxs-lookup"><span data-stu-id="e2a1b-150">Meaning</span></span> |
|------------|---------|
| <span data-ttu-id="e2a1b-151">**\_e/s de WSA \_ pendientes**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-151">**WSA\_IO\_PENDING**</span></span> | <span data-ttu-id="e2a1b-152">Se inició correctamente una operación superpuesta y la finalización se indicará en un momento posterior.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-152">An overlapped operation was successfully initiated and completion will be indicated at a later time.</span></span> |
| <span data-ttu-id="e2a1b-153">**\_operación WSA \_ anulada**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-153">**WSA\_OPERATION\_ABORTED**</span></span> | <span data-ttu-id="e2a1b-154">Se canceló una operación superpuesta debido al cierre del socket o a la ejecución del comando **SiO \_ Flush** ioctl.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-154">An overlapped operation was canceled due to the closure of the socket or the execution of the **SIO\_FLUSH** IOCTL command.</span></span> |
| <span data-ttu-id="e2a1b-155">**WSAEFAULT**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-155">**WSAEFAULT**</span></span> | <span data-ttu-id="e2a1b-156">El parámetro *lpOverlapped* o *lpCompletionRoutine* no está totalmente incluido en una parte válida del espacio de direcciones del usuario.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-156">The *lpOverlapped* or *lpCompletionRoutine* parameter is not totally contained in a valid part of the user address space.</span></span> |
| <span data-ttu-id="e2a1b-157">**WSAEINPROGRESS**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-157">**WSAEINPROGRESS**</span></span> | <span data-ttu-id="e2a1b-158">La función se invoca cuando una devolución de llamada está en curso.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-158">The function is invoked when a callback is in progress.</span></span> |
| <span data-ttu-id="e2a1b-159">**WSAEINTR**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-159">**WSAEINTR**</span></span> | <span data-ttu-id="e2a1b-160">Se interrumpió una operación de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-160">A blocking operation was interrupted.</span></span> |
| <span data-ttu-id="e2a1b-161">**WSAEINVAL**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-161">**WSAEINVAL**</span></span> | <span data-ttu-id="e2a1b-162">El parámetro *dwIoControlCode* no es un comando válido o un parámetro de entrada especificado no es aceptable, o bien el comando no es aplicable al tipo de socket especificado.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-162">The *dwIoControlCode* parameter is not a valid command, or a specified input parameter is not acceptable, or the command is not applicable to the type of socket specified.</span></span> <span data-ttu-id="e2a1b-163">Se devuelve este error si el parámetro *cbInBuffer* es menor que el tamaño de la estructura del **\_ \_ modo de compatibilidad WSA** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-163">This error is returned if the *cbInBuffer* parameter is less than the sizeof the **WSA\_COMPATIBILITY\_MODE** structure.</span></span>
| <span data-ttu-id="e2a1b-164">**WSAENETDOWN**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-164">**WSAENETDOWN**</span></span> | <span data-ttu-id="e2a1b-165">Error en el subsistema de red.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-165">The network subsystem has failed.</span></span> |
| <span data-ttu-id="e2a1b-166">**WSAENOPROTOOPT**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-166">**WSAENOPROTOOPT**</span></span> | <span data-ttu-id="e2a1b-167">No se admite la opción socket en el protocolo especificado.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-167">The socket option is not supported on the specified protocol.</span></span> |
| <span data-ttu-id="e2a1b-168">**WSAENOTCONN**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-168">**WSAENOTCONN**</span></span> | <span data-ttu-id="e2a1b-169">El socket s no está conectado.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-169">The socket s is not connected.</span></span> |
| <span data-ttu-id="e2a1b-170">**WSAENOTSOCK**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-170">**WSAENOTSOCK**</span></span> | <span data-ttu-id="e2a1b-171">El descriptor *s* no es un socket.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-171">The descriptor *s* is not a socket.</span></span> |
| <span data-ttu-id="e2a1b-172">**WSAEOPNOTSUPP**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-172">**WSAEOPNOTSUPP**</span></span> | <span data-ttu-id="e2a1b-173">No se admite el comando IOCTL especificado.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-173">The specified IOCTL command is not supported.</span></span> <span data-ttu-id="e2a1b-174">Este error se devuelve si el proveedor de transporte no admite el **\_ modo de \_ compatibilidad \_ de SiO Set** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-174">This error is returned if the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is not supported by the transport provider.</span></span> <span data-ttu-id="e2a1b-175">También se devuelve este error cuando se intenta usar el **modo de \_ \_ compatibilidad \_ de SiO Set** ioctl en un socket de datagrama.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-175">This error is also returned when an attempt to use the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is made on a datagram socket.</span></span> |

## <a name="remarks"></a><span data-ttu-id="e2a1b-176">Observaciones</span><span class="sxs-lookup"><span data-stu-id="e2a1b-176">Remarks</span></span>

<span data-ttu-id="e2a1b-177">el método **SiO \_ set \_ Compatibility \_ mode** solicita cómo la pila de red debe controlar ciertos comportamientos para los que la manera predeterminada de controlar el comportamiento puede diferir en las versiones de Windows.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-177">the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>
<span data-ttu-id="e2a1b-178">La estructura de argumentos de entrada para el **\_ modo de \_ compatibilidad \_ de SiO Set** se especifica en la estructura del **\_ \_ modo de compatibilidad WSA** definida en el archivo de encabezado *Mswsockdef. h* .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-178">The input argument structure for **SIO\_SET\_COMPATIBILITY\_MODE** is specified in the **WSA\_COMPATIBILITY\_MODE** structure defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="e2a1b-179">Un puntero a la estructura del **\_ \_ modo de compatibilidad WSA** se pasa en el parámetro *cbInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-179">A pointer to the **WSA\_COMPATIBILITY\_MODE** structure is passed in the *cbInBuffer* parameter.</span></span>
<span data-ttu-id="e2a1b-180">Esta estructura se define de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="e2a1b-180">This structure is defined as follows:</span></span>

```cpp
// Need to #include <mswsock.h>

/* Argument structure for SIO_SET_COMPATIBILITY_MODE */
typedef struct _WSA_COMPATIBILITY_MODE {
    WSA_COMPATIBILITY_BEHAVIOR_ID BehaviorId;
    ULONG TargetOsVersion;
} WSA_COMPATIBILITY_MODE, *PWSA_COMPATIBILITY_MODE;
```

<span data-ttu-id="e2a1b-181">El valor especificado en el miembro **BehaviorId** indica el comportamiento solicitado.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-181">The value specified in the **BehaviorId** member indicates the behavior requested.</span></span>
<span data-ttu-id="e2a1b-182">El valor especificado en el miembro **TargetOsVersion** indica la versión de Windows que se solicita para el comportamiento.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-182">The value specified in the **TargetOsVersion** member indicates the Windows version that is being requested for the behavior.</span></span>

<span data-ttu-id="e2a1b-183">El miembro **BehaviorId** puede ser uno de los valores del tipo de enumeración de identificador de **\_ \_ comportamiento \_ de compatibilidad WSA** definido en el archivo de encabezado *Mswsockdef. h* .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-183">The **BehaviorId** member can be one of the values from the **WSA\_COMPATIBILITY\_BEHAVIOR\_ID** enumeration type defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="e2a1b-184">Los valores posibles para el miembro **BehaviorId** son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="e2a1b-184">The possible values for the **BehaviorId** member are as follows:</span></span>

| <span data-ttu-id="e2a1b-185">Término</span><span class="sxs-lookup"><span data-stu-id="e2a1b-185">Term</span></span> | <span data-ttu-id="e2a1b-186">Descripción</span><span class="sxs-lookup"><span data-stu-id="e2a1b-186">Description</span></span> |
|------|-------------|
| <span data-ttu-id="e2a1b-187">WsaBehaviorAll</span><span class="sxs-lookup"><span data-stu-id="e2a1b-187">WsaBehaviorAll</span></span> | <span data-ttu-id="e2a1b-188">Esto es equivalente a solicitar todos los posibles comportamientos compatibles definidos para el **identificador de \_ \_ comportamiento de \_ compatibilidad WSA**.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-188">This is equivalent to requesting all of the possible compatible behaviors defined for **WSA\_COMPATIBILITY\_BEHAVIOR\_ID**.</span></span> |
| <span data-ttu-id="e2a1b-189">WsaBehaviorReceiveBuffering</span><span class="sxs-lookup"><span data-stu-id="e2a1b-189">WsaBehaviorReceiveBuffering</span></span> | <span data-ttu-id="e2a1b-190">Cuando el miembro **TargetOsVersion** se establece en un valor de Windows Vista o posterior, se permite reducir el tamaño del búfer de recepción TCP en este socket mediante la opción de socket **so \_ RCVBUF** , incluso después de establecer una conexión TCP.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-190">When the **TargetOsVersion** member is set to a value for Windows Vista or later, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are allowed even after a TCP connection has been establishment.</span></span> <span data-ttu-id="e2a1b-191">Cuando el miembro **TargetOsVersion** se establece en un valor anterior a Windows Vista, no se permiten las reducciones del tamaño del búfer de recepción TCP en este socket mediante la opción de socket **so \_ RCVBUF** después del establecimiento de la conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-191">When the **TargetOsVersion** member is set to a value earlier than Windows Vista, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are not allowed after connection establishment.</span></span> |
| <span data-ttu-id="e2a1b-192">WsaBehaviorAutoTuning</span><span class="sxs-lookup"><span data-stu-id="e2a1b-192">WsaBehaviorAutoTuning</span></span> | <span data-ttu-id="e2a1b-193">Cuando el miembro **TargetOsVersion** se establece en un valor de Windows Vista o posterior, el ajuste automático de la ventana de recepción está habilitado y el factor de escala de la ventana TCP se reduce a 2 desde el valor predeterminado de 8.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-193">When the **TargetOsVersion** member is set to a value for Windows Vista or later, receive window auto-tuning is enabled and the TCP window scale factor is reduced to 2 from the default value of 8.</span></span> <span data-ttu-id="e2a1b-194">Cuando **TargetOsVersion** se establece en un valor anterior a Windows Vista, se deshabilita el ajuste automático de la ventana de recepción.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-194">When the **TargetOsVersion** is set to a value earlier than Windows Vista, receive window auto-tuning is disabled.</span></span> <span data-ttu-id="e2a1b-195">La opción de escalado de la ventana TCP también está deshabilitada y el tamaño máximo de la ventana de recepción true está limitado a 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-195">The TCP window scaling option is also disabled and the maximum true receive window size is limited to 65,535 bytes.</span></span> <span data-ttu-id="e2a1b-196">No se puede negociar la opción de escalado de la ventana TCP en la conexión aunque se haya llamado a la opción de socket for **\_ RCVBUF** en este socket, especificando un valor superior a 65.535 bytes antes de que se establezca la conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-196">The TCP window scaling option can't be negotiated on the connection even if the **SO\_RCVBUF** socket option was called on this socket specifying a value greater than 65,535 bytes before the connection was established.</span></span> |

<span data-ttu-id="e2a1b-197">El miembro **TargetOsVersion** puede ser una de las constantes de la versión NTDDI definidas en el archivo de encabezado *Sdkddkver. h* .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-197">The **TargetOsVersion** member can be one of the NTDDI version constants defined in the *Sdkddkver.h* header file.</span></span>
<span data-ttu-id="e2a1b-198">Algunos de los valores posibles para el miembro **TargetOsVersion** son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="e2a1b-198">Some of the possible values for the **TargetOsVersion** member are as follows:</span></span>

| <span data-ttu-id="e2a1b-199">Término</span><span class="sxs-lookup"><span data-stu-id="e2a1b-199">Term</span></span> | <span data-ttu-id="e2a1b-200">Descripción</span><span class="sxs-lookup"><span data-stu-id="e2a1b-200">Description</span></span> |
|------|-------------|
| <span data-ttu-id="e2a1b-201">NTDDI \_ Longhorn</span><span class="sxs-lookup"><span data-stu-id="e2a1b-201">NTDDI\_LONGHORN</span></span> | <span data-ttu-id="e2a1b-202">El comportamiento de destino es el valor predeterminado para Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-202">The target behavior is the default for Windows Vista.</span></span> |
| <span data-ttu-id="e2a1b-203">NTDDI \_ WS03</span><span class="sxs-lookup"><span data-stu-id="e2a1b-203">NTDDI\_WS03</span></span> | <span data-ttu-id="e2a1b-204">El comportamiento de destino es el valor predeterminado para Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-204">The target behavior is the default for Windows Server 2003.</span></span> |
| <span data-ttu-id="e2a1b-205">NTDDI \_ WinXP</span><span class="sxs-lookup"><span data-stu-id="e2a1b-205">NTDDI\_WINXP</span></span> | <span data-ttu-id="e2a1b-206">El comportamiento de destino es el valor predeterminado para Windows XP.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-206">The target behavior is the default for Windows XP.</span></span> |
| <span data-ttu-id="e2a1b-207">NTDDI \_ WIN2K</span><span class="sxs-lookup"><span data-stu-id="e2a1b-207">NTDDI\_WIN2K</span></span> | <span data-ttu-id="e2a1b-208">El comportamiento de destino es el valor predeterminado para Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-208">The target behavior is the default for Windows 2000.</span></span> |

<span data-ttu-id="e2a1b-209">El impacto principal del miembro **TargetOsVersion** es si este miembro está establecido en un valor igual o mayor que **NTDDI \_ Longhorn**.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-209">The primary impact of the **TargetOsVersion** member is whether this member is set to a value equal or greater than **NTDDI\_LONGHORN**.</span></span>

<span data-ttu-id="e2a1b-210">El rendimiento de TCP no depende solo de la velocidad de transferencia en sí, sino en el producto de la velocidad de transferencia y el tiempo de retraso de ida y vuelta.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-210">TCP performance depends not only on the transfer rate itself, but rather on the product of the transfer rate and the round-trip delay time.</span></span>
<span data-ttu-id="e2a1b-211">Este producto de retraso de ancho de banda mide la cantidad de datos que "rellenarán la canalización".</span><span class="sxs-lookup"><span data-stu-id="e2a1b-211">This bandwidth-delay product measures the amount of data that would "fill the pipe".</span></span>
<span data-ttu-id="e2a1b-212">Este producto de retraso de ancho de banda es el espacio de búfer necesario en el remitente y el receptor para obtener el máximo rendimiento de la conexión TCP a través de la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-212">This bandwidth-delay product is the buffer space required at sender and receiver to obtain maximum throughput on the TCP connection over the path.</span></span>
<span data-ttu-id="e2a1b-213">Este espacio de búfer representa la cantidad de datos no confirmados que TCP debe administrar para mantener la canalización completa.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-213">This buffer space represents the amount of unacknowledged data that TCP must handle in order to keep the pipeline full.</span></span>
<span data-ttu-id="e2a1b-214">Los problemas de rendimiento de TCP surgen cuando el producto de retraso de ancho de banda es grande.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-214">TCP performance problems arise when the bandwidth-delay product is large.</span></span>
<span data-ttu-id="e2a1b-215">Una ruta de acceso de red que opere bajo estas condiciones se denomina a menudo "canalización de larga y FAT".</span><span class="sxs-lookup"><span data-stu-id="e2a1b-215">A network path operating under these conditions is often called a "long, fat pipe".</span></span>
<span data-ttu-id="e2a1b-216">Entre los ejemplos se incluyen vínculos satélite de paquetes de alta capacidad, vínculos inalámbricos de alta velocidad y vínculos ópticos de fibra terrestre a larga distancia.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-216">Examples include high-capacity packet satellite links, high-speed wireless links, and terrestrial fiber-optical links over long distances.</span></span>

<span data-ttu-id="e2a1b-217">El encabezado TCP usa un campo de datos de 16 bits (el campo de ventana del encabezado del paquete TCP) para notificar el tamaño de la ventana de recepción al remitente.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-217">The TCP header uses a 16-bit data field (the Window field in the TCP packet header) to report the receive window size to the sender.</span></span>
<span data-ttu-id="e2a1b-218">Por lo tanto, la ventana más grande que se puede utilizar es 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-218">Therefore, the largest window that can be used is 65,535 bytes.</span></span>
<span data-ttu-id="e2a1b-219">Para eludir esta limitación, se ha agregado una opción de extensión TCP, escala de ventana de TCP, para TCP de alto rendimiento con el fin de admitir Windows de más de 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-219">To circumvent this limitation a TCP extension option, TCP Window Scale, was added for high-performance TCP to allow windows larger than 65,535 bytes.</span></span>
<span data-ttu-id="e2a1b-220">La opción de escala de ventana de TCP (WSopt) se define en RFC 1323, disponible en el [sitio web de IETF](https://www.ietf.org/rfc/rfc1122.txt).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-220">The TCP Window Scale option (WSopt) is defined in RFC 1323 available at the [IETF website](https://www.ietf.org/rfc/rfc1122.txt).</span></span>
<span data-ttu-id="e2a1b-221">La extensión WSopt expande la definición de la ventana TCP a 32 bits mediante un factor de escala logarítmica de un byte para extender el campo de la ventana de 16 bits en el encabezado TCP.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-221">The WSopt extension expands the definition of the TCP window to 32 bits using a one-byte logarithmic scale factor to extend the 16-bit Window field in the TCP header.</span></span>
<span data-ttu-id="e2a1b-222">La extensión WSopt define un factor de escala implícito (2 a cierta potencia), que se usa para multiplicar el valor de tamaño de la ventana que se encuentra en un encabezado TCP para obtener el tamaño de ventana verdadero.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-222">The WSopt extension defines an implicit scale factor (2 to some power), which is used to multiply the window size value found in a TCP header to obtain the true window size.</span></span>
<span data-ttu-id="e2a1b-223">Por lo tanto, un factor de escala de una ventana de 8 daría como resultado un tamaño de ventana verdadero igual al valor en el campo de la ventana en el encabezado TCP multiplicado por 2 ^ 8 o 256.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-223">So a window scale factor of 8 would result in a true window size equal to the value in the Window field in the TCP header multiplied by 2^8 or 256.</span></span>
<span data-ttu-id="e2a1b-224">Por tanto, si el campo de la ventana del encabezado TCP se estableció en el valor máximo de 65.535 bytes y el factor de escala WSopt se negoció con un valor de 8, el tamaño de ventana verdadero sería de 16.776.960 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-224">So if the Window field in the TCP header was set to the maximum value of 65,535 bytes and the WSopt scale factor was negotiated to a value of 8, the true window size would be 16,776,960 bytes.</span></span>

<span data-ttu-id="e2a1b-225">El tamaño de la ventana de recepción real y, por tanto, el factor de escala viene determinado por el espacio máximo del búfer de recepción.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-225">The true receive window size and therefore the scale factor is determined by the maximum receive buffer space.</span></span>
<span data-ttu-id="e2a1b-226">Este espacio de búfer máximo es la cantidad de datos que un receptor TCP permite enviar a un remitente de TCP antes de tener que esperar una confirmación.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-226">This maximum buffer space is the amount of data that a TCP receiver allows a TCP sender to send before having to wait for an acknowledgement.</span></span>
<span data-ttu-id="e2a1b-227">Una vez establecida la conexión, el tamaño de la ventana de recepción se anuncia en cada segmento TCP (el campo de ventana del encabezado TCP).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-227">After the connection is established, the receive window size is advertised in each TCP segment (the Window field in the TCP header).</span></span>
<span data-ttu-id="e2a1b-228">La publicidad de la cantidad máxima de datos que el remitente puede enviar es un mecanismo de control de flujo del receptor que impide que el remitente envíe datos que el receptor no puede almacenar.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-228">Advertising the maximum amount of data that the sender can send is a receiver-side flow control mechanism that prevents the sender from sending data that the receiver cannot store.</span></span>
<span data-ttu-id="e2a1b-229">Un host de envío solo puede enviar la cantidad máxima de datos anunciada por el receptor antes de esperar una confirmación y una actualización del tamaño de la ventana de recepción.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-229">A sending host can only send the maximum amount of data advertised by the receiver before waiting for an acknowledgment and a receive window size update.</span></span>

<span data-ttu-id="e2a1b-230">En Windows Server 2003 y Windows XP, el espacio de búfer de recepción máximo que representa el tamaño de la ventana de recepción para la pila TCP/IP tiene un valor predeterminado basado en la velocidad de vínculo de la interfaz de envío.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-230">On Windows Server 2003 and Windows XP, the maximum receive buffer space which represents the receive window size for the TCP/IP stack has a default value based on the link speed of the sending interface.</span></span>
<span data-ttu-id="e2a1b-231">El valor real se ajusta automáticamente a los incrementos pares del tamaño máximo de segmento (MSS) negociado durante el establecimiento de la conexión TCP.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-231">The actual value automatically adjusts to even increments of the maximum segment size (MSS) negotiated during TCP connection establishment.</span></span>
<span data-ttu-id="e2a1b-232">Por lo tanto, para un vínculo de 10 Mbits/s, el tamaño de la ventana de recepción predeterminada se establecería normalmente en 16 k bytes, mientras que en un vínculo de 100 MBit/s el tamaño de la ventana de recepción predeterminada se establecería en 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-232">So for a 10 Mbit/sec link, the default receive window size would normally be set to 16K bytes, while on a 100 MBit/sec link the default receive window size would be set to 65,535 bytes.</span></span>

<span data-ttu-id="e2a1b-233">En Windows Server 2003 y Windows XP, el tamaño máximo de la ventana de recepción máxima para la pila TCP/IP puede configurarse manualmente con los siguientes valores del registro en una interfaz específica o en todo el sistema:</span><span class="sxs-lookup"><span data-stu-id="e2a1b-233">On Windows Server 2003 and Windows XP, the true maximum receive window size for the TCP/IP stack can be manually configured using the following registry values on a specific interface or for the entire system:</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\TCPWindowSize`

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Interface\TCPWindowSize`

<span data-ttu-id="e2a1b-234">El valor del registro para **TcpWindowSize** se puede establecer en un máximo de 65.535 bytes si no se usa la extensión WSopt o un máximo de 1.073.741.823 bytes cuando se usa la extensión WSopt (se admite un factor de escala máximo de 4).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-234">The registry value for **TCPWindowSize** can be set to a maximum of 65,535 bytes when not using the WSopt extension or a maximum of 1,073,741,823 bytes when the WSopt extension is used (a maximum scale factor of 4 is supported).</span></span>
<span data-ttu-id="e2a1b-235">Sin el escalado de ventanas, una aplicación solo puede lograr un rendimiento de aproximadamente 5 megabits por segundo (Mbps) en una ruta de acceso con un tiempo de ida y vuelta (RTT) de 100 milisegundos, independientemente del ancho de banda de la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-235">Without window scaling, an application can only achieve a throughput of approximately 5 megabits per second (Mbps) on a path with a 100 millisecond round-trip time (RTT), regardless of the path bandwidth.</span></span>
<span data-ttu-id="e2a1b-236">Este rendimiento se puede escalar a más de un gigabit por segundo (Gbps) con el escalado de ventanas, lo que permite que TCP negocie el factor de escala para el tamaño de la ventana durante el establecimiento de la conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-236">This throughput can be scaled to over a gigabit per second (Gbps) with window scaling, which allows TCP to negotiate the scaling factor for the window size during connection establishment.</span></span>

<span data-ttu-id="e2a1b-237">En Windows Server 2003 y Windows XP, la extensión WSopt se puede habilitar estableciendo el siguiente valor del registro.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-237">On Windows Server 2003 and Windows XP, the WSopt extension can be enabled by setting the following registry value.</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Tcp1323Opts`

<span data-ttu-id="e2a1b-238">El valor del registro **Tcp1323Opts** es una codificación **DWORD** que, cuando se establece el bit 0, está habilitada la extensión TCP WSopt.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-238">The **Tcp1323Opts** registry value is a **DWORD** encoded such that when bit 0 is set, TCP WSopt extension is enabled.</span></span>
<span data-ttu-id="e2a1b-239">Cuando se establece el bit 1, se habilita la opción de marca de tiempo de TCP (TSopt) definida en RFC 1323.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-239">When bit 1 is set, the TCP Timestamp option (TSopt) defined in RFC 1323 is enabled.</span></span>
<span data-ttu-id="e2a1b-240">Por lo tanto, un valor de 1 o 3 habilitará la extensión WSopt.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-240">So a value of either 1 or 3 will enable the WSopt extension.</span></span>

<span data-ttu-id="e2a1b-241">En Windows Server 2003 y Windows XP, el valor predeterminado es que no se crean los valores del registro TCPWindowSize y Tcp1323Opts.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-241">On Windows Server 2003 and Windows XP, the default is that the TCPWindowSize and the Tcp1323Opts registry values are not created.</span></span>
<span data-ttu-id="e2a1b-242">De modo que el valor predeterminado es que la extensión WSopt está deshabilitada y el tamaño de la ventana de recepción TCP se establece en el valor máximo de hasta 65.535 bytes según la velocidad del vínculo.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-242">So the default is that the WSopt extension is disabled and the TCP receive window size is set by the system to maximum value of up to 65,535 bytes based on the link speed.</span></span>
<span data-ttu-id="e2a1b-243">Cuando el escalado de ventanas está habilitado en Windows Server 2003 y Windows XP mediante el establecimiento del valor del registro Tcp1323Opts, el escalado de ventanas en una conexión TCP se sigue usando solo cuando el remitente y el receptor incluyen una opción de escala de ventana TCP en el segmento sincronizado (SYN) que se envía entre sí para negociar un factor de escala de ventana.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-243">When window scaling is enabled on Windows Server 2003 and Windows XP by setting the Tcp1323Opts registry value, window scaling on a TCP connection is still only used when both the sender and receiver include a TCP window scale option in the synchronize (SYN) segment sent to each other to negotiate a window scale factor.</span></span>
<span data-ttu-id="e2a1b-244">Cuando se usa el escalado de ventanas en una conexión, el campo de ventana del encabezado TCP se establece en 65.535 bytes y el factor de escala de la ventana se usa para ajustar el tamaño de la ventana de recepción real de forma ascendente por el factor de escala de la ventana negociado cuando se establece la conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-244">When window scaling is used on a connection, the Window field in the TCP header is set to 65,535 bytes and the window scale factor is used to adjust the true receive window size upward by the window scale factor negotiated when the connection is established.</span></span>

<span data-ttu-id="e2a1b-245">Una aplicación puede especificar el tamaño de la ventana de recepción de TCP para una conexión mediante la opción de socket **so de \_ RCVBUF** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-245">An application can specify the TCP receive window size for a connection by using the **SO\_RCVBUF** socket option.</span></span>
<span data-ttu-id="e2a1b-246">El tamaño de la ventana de recepción TCP para un socket puede aumentarse en cualquier momento mediante **\_ RCVBUF**, pero solo se puede reducir antes de establecer una conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-246">The TCP receive window size for a socket can be increased at any time using **SO\_RCVBUF**, but it can only be decreased prior to establishing a connection.</span></span>
<span data-ttu-id="e2a1b-247">Para usar el escalado de ventanas, una aplicación debe especificar un tamaño de ventana superior a 65.535 bytes al usar la opción de socket for **\_ RCVBUF** antes de establecer la conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-247">In order to use window scaling, an application must specify a window size larger than 65,535 bytes when using the **SO\_RCVBUF** socket option before the connection is established.</span></span>

<span data-ttu-id="e2a1b-248">El valor ideal para el tamaño de la ventana de recepción TCP suele ser difícil de determinar.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-248">The ideal value for the TCP receive window size is often difficult to determine.</span></span>
<span data-ttu-id="e2a1b-249">Con el fin de rellenar la capacidad de la red entre el remitente y el receptor, el tamaño de la ventana de recepción debe establecerse en el producto de retraso de ancho de banda para la conexión, que es el ancho de banda multiplicado por el tiempo de ida y vuelta.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-249">In order to fill the capacity of the network between the sender and receiver, the receive window size should be set to the bandwidth-delay product for the connection, which is the bandwidth multiplied by the round-trip time.</span></span>
<span data-ttu-id="e2a1b-250">Incluso si una aplicación puede determinar correctamente el producto de retraso de ancho de banda, todavía no se sabe la rapidez con la que la aplicación receptora recuperará datos del búfer de datos de entrada (velocidad de recuperación de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-250">Even if an application can correctly determine the bandwidth-delay product, it is still not known how quickly the receiving application will retrieve data from the incoming data buffer (the application retrieve rate).</span></span>
<span data-ttu-id="e2a1b-251">A pesar de la compatibilidad con el escalado de ventanas de TCP, el tamaño máximo de la ventana de recepción en Windows Server 2003 y Windows XP puede seguir limitando el rendimiento, ya que es un tamaño máximo fijo para todas las conexiones TCP (a menos que se especifique por aplicación mediante **\_ RCVBUF**), lo que puede mejorar el rendimiento de algunas conexiones y reducir el rendimiento de otras.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-251">Despite the support for TCP window scaling, the maximum receive window size in Windows Server 2003 and Windows XP can still limit throughput because it is a fixed maximum size for all TCP connections (unless specified per application using **SO\_RCVBUF**), which can enhance throughput for some connections and decrease throughput for others.</span></span>
<span data-ttu-id="e2a1b-252">Además, el tamaño de la ventana de recepción máximo fijo para una conexión TCP no varía según las condiciones de red variables.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-252">Additionally, the fixed maximum receive window size for a TCP connection does not vary with changing network conditions.</span></span>

<span data-ttu-id="e2a1b-253">Para solucionar el problema de determinar correctamente el valor del tamaño máximo de la ventana de recepción de una conexión TCP en función de las condiciones actuales de la red, la pila TCP/IP de Windows Vista admite una característica de ajuste automático de la ventana de recepción.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-253">To solve the problem of correctly determining the value of the maximum receive window size for a TCP connection based on the current conditions of the network, the TCP/IP stack in Windows Vista supports a receive window auto-tuning feature.</span></span>
<span data-ttu-id="e2a1b-254">Cuando esta característica está habilitada, el ajuste automático de la ventana de recepción determina continuamente el tamaño óptimo de la ventana de recepción real midiendo el producto de retraso de ancho de banda y la tasa de recuperación de la aplicación, y ajusta el tamaño de la ventana de recepción real máximo en función de las condiciones de red variables.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-254">When this feature is enabled, receive window auto-tuning continually determines the optimal true receive window size by measuring the bandwidth-delay product and the application retrieve rate, and adjusts the true maximum receive window size based on changing network conditions.</span></span>
<span data-ttu-id="e2a1b-255">El ajuste automático de la ventana de recepción habilita la extensión WSopt de TCP de forma predeterminada, lo que permite un máximo de 16.776.960 bytes para el tamaño de ventana verdadero.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-255">Receive window auto-tuning enables the TCP WSopt extension by default, allowing up to 16,776,960 bytes for the true window size.</span></span>
<span data-ttu-id="e2a1b-256">A medida que los datos fluyen a través de la conexión, la pila TCP/IP supervisa la conexión, mide el producto de retraso de ancho de banda actual para la conexión y la velocidad de recepción de la aplicación, y ajusta el tamaño de la ventana de recepción real para optimizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-256">As the data flows over the connection, the TCP/IP stack monitors the connection, measures the current bandwidth-delay product for the connection and the application receive rate, and adjusts the actual receive window size to optimize throughput.</span></span>
<span data-ttu-id="e2a1b-257">La pila TCP/IP cambia el valor del campo de ventana en el encabezado TCP en función de las condiciones de la red, ya que el factor de escala WSopt se fija cuando se establece la conexión por primera vez.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-257">The TCP/IP stack changes the value of the Window field in the TCP header based on network conditions, since the WSopt scale factor is fixed when the connection is first established.</span></span>

<span data-ttu-id="e2a1b-258">La pila TCP/IP en Windows Vista ya no usa los valores del registro **TcpWindowSize** .</span><span class="sxs-lookup"><span data-stu-id="e2a1b-258">The TCP/IP stack in Windows Vista no longer uses the **TCPWindowSize** registry values.</span></span>
<span data-ttu-id="e2a1b-259">Con un mejor rendimiento entre los pares TCP, el uso del ancho de banda de red aumenta durante la transferencia de datos.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-259">With better throughput between TCP peers, the utilization of network bandwidth increases during data transfer.</span></span>
<span data-ttu-id="e2a1b-260">Si todas las aplicaciones están optimizadas para recibir datos de TCP, el uso general de la red puede aumentar considerablemente, lo que permite que el uso de calidad de servicio (QoS) sea más importante en redes que funcionan a la vez o cerca de su capacidad.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-260">If all the applications are optimized to receive TCP data, then the overall utilization of the network can increase substantially, making the use of Quality of Service (QoS) more important on networks that are operating at or near capacity.</span></span>

<span data-ttu-id="e2a1b-261">El comportamiento predeterminado en Windows Vista para el almacenamiento en búfer de recepción cuando no se especifica el **modo de compatibilidad de SiO \_ set \_ \_** con **WsaBehaviorReceiveBuffering** es que no se permite ninguna reducción del tamaño de la ventana de recepción con la opción de socket de **\_ RCVBUF** después de establecer una conexión.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-261">The default behavior on Windows Vista for receive buffering when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorReceiveBuffering** is that no receive window size reductions using **SO\_RCVBUF** socket option are allowed after a connection is established.</span></span>

<span data-ttu-id="e2a1b-262">El comportamiento predeterminado en Windows Vista para el ajuste automático cuando no se especifica el **modo de compatibilidad de SiO \_ \_ \_ set** con **WsaBehaviorAutoTuning** es que la pila realizará el ajuste automático de la ventana con un factor de escala de ventana de 8.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-262">The default behavior on Windows Vista for auto-tuning when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorAutoTuning** is that the stack will do receive window auto-tuning using a window scale factor of 8.</span></span>
<span data-ttu-id="e2a1b-263">Tenga en cuenta que si una aplicación establece un tamaño de ventana de recepción válido con la opción de socket **so de \_ RCVBUF** , la pila usará el tamaño especificado y se deshabilitará el ajuste automático de la recepción de ventanas.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-263">Note that if an application sets a valid receive window size with the **SO\_RCVBUF** socket option, the stack will use the size specified and window receive auto-tuning will disabled.</span></span>
<span data-ttu-id="e2a1b-264">El ajuste automático de Windows también se puede deshabilitar por completo con el siguiente comando, `netsh interface tcp set global autotuninglevel=disabled` , en cuyo caso la especificación de **WsaBehaviorAutoTuning** no tendrá ningún efecto.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-264">Windows autotuning may also be disabled completely using the following command, `netsh interface tcp set global autotuninglevel=disabled`, in which case specifying **WsaBehaviorAutoTuning** will have no affect.</span></span>
<span data-ttu-id="e2a1b-265">La optimización de la recepción de ventanas también puede deshabilitarse en función de la Directiva de grupo establecida en Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-265">Window receive autotuning can also be disabled based on group policy set on Windows Server 2008.</span></span>

<span data-ttu-id="e2a1b-266">La opción **WsaBehaviorAutoTuning** es necesaria en Windows Vista para algunos dispositivos de puerta de enlace de Internet y firewalls que no admiten correctamente flujos de datos para las conexiones TCP que usan la extensión WSopt y un factor de escala de Windows.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-266">The **WsaBehaviorAutoTuning** option is needed on Windows Vista for some Internet gateway devices and firewalls that do not correctly support data flows for TCP connections that use the WSopt extension and a windows scale factor.</span></span>
<span data-ttu-id="e2a1b-267">En Windows Vista, un receptor negocia de forma predeterminada un factor de escala de ventana de 8 para un tamaño de ventana máximo real de 16.776.960 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-267">On Windows Vista, a receiver by default negotiates a window scale factor of 8 for a maximum true window size of 16,776,960 bytes.</span></span>
<span data-ttu-id="e2a1b-268">Cuando los datos empiezan a fluir en un vínculo rápido, Windows comienza inicialmente con un tamaño de ventana de 64 kilobytes true estableciendo el campo de ventana del encabezado TCP en 256 y estableciendo el factor de escala de la ventana en 8 en las opciones de TCP (256 \* 2 ^ 8 = 64 KB).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-268">When data begins to flow on a fast link, Windows initially starts with a 64 Kilobyte true window size by setting the Window field of the TCP header to 256 and setting the window scale factor to 8 in the TCP options (256\*2^8=64KB).</span></span>
<span data-ttu-id="e2a1b-269">Algunos firewalls y dispositivos de puerta de enlace a Internet omiten el factor de escala de ventana y solo examinan el campo de la ventana anunciada en el encabezado TCP especificado como 256 y colocan los paquetes entrantes para la conexión que contienen más de 256 bytes de datos TCP.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-269">Some Internet gateway devices and firewalls ignore the window scale factor and only look at the advertised Window field in the TCP header specified as 256, and drop incoming packets for the connection that contain more than 256 bytes of TCP data.</span></span>
<span data-ttu-id="e2a1b-270">Para admitir el escalado de la ventana de recepción TCP, un dispositivo de puerta de enlace o firewall debe supervisar el protocolo de enlace TCP y realizar el seguimiento del factor de escala de ventana negociada como parte de los datos de conexión TCP.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-270">To support TCP receive window scaling, a gateway device or firewall must monitor the TCP handshake and track the negotiated window scale factor as part of the TCP connection data.</span></span>
<span data-ttu-id="e2a1b-271">Además, algunas aplicaciones y implementaciones de pila de TCP en otras plataformas omiten la extensión TCP WSopt y el factor de escala de ventana.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-271">Also some applications and TCP stack implementations on other platforms ignore the TCP WSopt extension and the window scaling factor.</span></span>
<span data-ttu-id="e2a1b-272">Por lo tanto, el host remoto que envía los datos puede enviar datos a la tarifa anunciada en el campo de ventana del encabezado TCP (256 bytes).</span><span class="sxs-lookup"><span data-stu-id="e2a1b-272">So the remote host sending the data may send data at the rate advertised in the Window field of the TCP header (256 bytes).</span></span>
<span data-ttu-id="e2a1b-273">Esto puede dar lugar a que el receptor reciba datos muy lentamente.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-273">This can result in data being received very slowly by the receiver.</span></span>

<span data-ttu-id="e2a1b-274">Al establecer el miembro **BehaviorId** en **WsaBehaviorAutoTuning** y **TargetOsVersion** en Windows Vista, se reduce el factor de escala de la ventana a 2, por lo que el campo de ventana del encabezado TCP se establece inicialmente en 16.384 bytes y el factor de escala de la ventana se establece en 2 para un tamaño de recepción de ventana verdadero inicial de 64 KB.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-274">Setting the **BehaviorId** member to **WsaBehaviorAutoTuning** and the **TargetOsVersion** to Windows Vista reduces the window scale factor to 2, so the Window field in the TCP header is initially set to 16,384 bytes and the window scale factor is set to 2 for an initial true window receive size of 64K bytes.</span></span>
<span data-ttu-id="e2a1b-275">La característica de ajuste automático de ventana puede aumentar el tamaño de recepción de la ventana real hasta 262.140 bytes si se establece el campo de ventana del encabezado TCP en 65.535 bytes.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-275">The window auto-tuning feature can then increase the true window receive size up to 262,140 bytes by setting the Window field in the TCP header to 65,535 bytes.</span></span>
<span data-ttu-id="e2a1b-276">Una aplicación debe establecer el **\_ modo de \_ compatibilidad \_ de SiO Set** en cuanto se crea un socket, ya que esta opción no tiene sentido o se aplica después de que se envíe un SYN.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-276">An application should set the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL as soon as a socket is created, since this option doesn't make sense or apply after a SYN is sent.</span></span>
<span data-ttu-id="e2a1b-277">La configuración de esta opción tiene el mismo impacto que el comando siguiente: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span><span class="sxs-lookup"><span data-stu-id="e2a1b-277">Setting this option has the same impact as the following command: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span></span>

<span data-ttu-id="e2a1b-278">Tenga en cuenta que el archivo de encabezado *Mswsockdef. h* se incluye automáticamente en *mswsock. h* o *Netiodef. h*, y no debe usarse directamente.</span><span class="sxs-lookup"><span data-stu-id="e2a1b-278">Note that the *Mswsockdef.h* header file is automatically included in *Mswsock.h* or *Netiodef.h*, and should not be used directly.</span></span>

## <a name="see-also"></a><span data-ttu-id="e2a1b-279">Vea también</span><span class="sxs-lookup"><span data-stu-id="e2a1b-279">See also</span></span>

[<span data-ttu-id="e2a1b-280">**tomacorriente**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-280">**socket**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-socket)

[<span data-ttu-id="e2a1b-281">**WSAGetLastError**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-281">**WSAGetLastError**</span></span>](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror)

[<span data-ttu-id="e2a1b-282">**WSAGetOverlappedResult**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-282">**WSAGetOverlappedResult**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsagetoverlappedresult)

[<span data-ttu-id="e2a1b-283">**WSAIoctl**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-283">**WSAIoctl**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl)

[<span data-ttu-id="e2a1b-284">**WSAOVERLAPPED**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-284">**WSAOVERLAPPED**</span></span>](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped)

[<span data-ttu-id="e2a1b-285">**WSASocketA**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-285">**WSASocketA**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketa)

[<span data-ttu-id="e2a1b-286">**WSASocketW**</span><span class="sxs-lookup"><span data-stu-id="e2a1b-286">**WSASocketW**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketw)
