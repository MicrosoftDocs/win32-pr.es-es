---
title: Protección de archivos con DRM versión 7 o posterior
description: Protección de archivos con DRM versión 7 o posterior
ms.assetid: 906f16c1-6573-47e9-8228-58dc126f6357
keywords:
- SDK de Windows Media Format, crear archivos protegidos
- SDK de Windows Media Format, archivos protegidos
- Advanced Systems Format (ASF), crear archivos protegidos
- ASF (formato de sistemas avanzados), crear archivos protegidos
- Advanced Systems Format (ASF), archivos protegidos
- ASF (formato de sistemas avanzados), archivos protegidos
- Advanced Systems Format (ASF), WMStubDRM. lib
- ASF (formato de sistemas avanzados), WMStubDRM. lib
- WMStubDRM. lib, crear archivos protegidos
- WMStubDRM. lib, archivos protegidos
- Administración de derechos digitales (DRM), WMStubDRM. lib
- DRM (administración de derechos digitales), WMStubDRM. lib
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7ee809ea73401f22e4554e74c2ecb8855a0384e0
ms.sourcegitcommit: ad672d3a10192c5ccac619ad2524407109266e93
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/25/2020
ms.locfileid: "105704915"
---
# <a name="protecting-files-with-drm-version-7-or-later"></a><span data-ttu-id="ba584-115">Protección de archivos con DRM versión 7 o posterior</span><span class="sxs-lookup"><span data-stu-id="ba584-115">Protecting Files with DRM Version 7 or Later</span></span>

<span data-ttu-id="ba584-116">Para proteger archivos con Windows Media DRM versión 7 o posterior, use el método [**IWMDRMWriter:: SetDRMAttribute**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute) del objeto Writer para establecer los atributos DRM.</span><span class="sxs-lookup"><span data-stu-id="ba584-116">To protect files with Windows Media DRM version 7 or later, use the writer object's [**IWMDRMWriter::SetDRMAttribute**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute) method to set DRM attributes.</span></span> <span data-ttu-id="ba584-117">Dado que la versión 7 de DRM y las versiones posteriores habilitan licencias únicas para cada archivo o conjunto de archivos protegido, la interfaz **IWMDRMWriter** también tiene métodos para crear claves.</span><span class="sxs-lookup"><span data-stu-id="ba584-117">Because DRM version 7 and later versions enable unique licenses for each protected file or set of files, the **IWMDRMWriter** interface also has methods for creating keys.</span></span> <span data-ttu-id="ba584-118">Estos métodos se proporcionan solo para su comodidad.</span><span class="sxs-lookup"><span data-stu-id="ba584-118">These methods are provided for convenience only.</span></span>

<span data-ttu-id="ba584-119">Para proteger los archivos ASF con DRM versión 7 o posterior, realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="ba584-119">To protect ASF files using DRM version 7 or later, perform the following steps:</span></span>

1.  <span data-ttu-id="ba584-120">Vincule a WMStubDRM. lib y, si es necesario, desvincule wmvcore. lib.</span><span class="sxs-lookup"><span data-stu-id="ba584-120">Link to WMStubDRM.lib and, if necessary, unlink wmvcore.lib.</span></span>
2.  <span data-ttu-id="ba584-121">Llame a la función [**WMCreateWriter**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatewriter) para crear el escritor DRM.</span><span class="sxs-lookup"><span data-stu-id="ba584-121">Call the [**WMCreateWriter**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatewriter) function to create the DRM writer.</span></span> <span data-ttu-id="ba584-122">El primer argumento está reservado y debe establecerse en **null**.</span><span class="sxs-lookup"><span data-stu-id="ba584-122">The first argument is reserved and must be set to **NULL**.</span></span>
3.  <span data-ttu-id="ba584-123">Establezca un perfil para que lo use el escritor llamando a [**IWMWriter:: SetProfile**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-setprofile) o [**IWMWriter:: SetProfileByID**](/previous-versions/windows/desktop/api/wmsdkidl/nf-wmsdkidl-iwmwriter-setprofilebyid).</span><span class="sxs-lookup"><span data-stu-id="ba584-123">Set a profile for the writer to use by calling [**IWMWriter::SetProfile**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-setprofile) or [**IWMWriter::SetProfileByID**](/previous-versions/windows/desktop/api/wmsdkidl/nf-wmsdkidl-iwmwriter-setprofilebyid).</span></span> <span data-ttu-id="ba584-124">Debe establecer un perfil en el escritor antes de establecer cualquier atributo DRM.</span><span class="sxs-lookup"><span data-stu-id="ba584-124">You must set a profile in the writer before setting any DRM attributes.</span></span> <span data-ttu-id="ba584-125">DRM solo es compatible con los perfiles que usan los códecs Windows Media Audio o Windows Media Video</span><span class="sxs-lookup"><span data-stu-id="ba584-125">DRM is supported only for profiles that use the Windows Media Audio or Windows Media Video codecs</span></span>
4.  <span data-ttu-id="ba584-126">Obtenga la interfaz [**IWMDRMWriter**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmwriter) del objeto del escritor.</span><span class="sxs-lookup"><span data-stu-id="ba584-126">Obtain the writer object's [**IWMDRMWriter**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmwriter) interface.</span></span>
5.  <span data-ttu-id="ba584-127">Llame a [**IWMDRMWriter:: SetDRMAttribute**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute) y [**establezca \_ usar \_ DRM avanzada**](use-advanced-drm.md) en **true**.</span><span class="sxs-lookup"><span data-stu-id="ba584-127">Call [**IWMDRMWriter::SetDRMAttribute**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute) and set [**Use\_Advanced\_DRM**](use-advanced-drm.md) to **TRUE**.</span></span>
6.  <span data-ttu-id="ba584-128">Si necesita generar un nuevo inicialización de clave, llame a [**IWMDRMWriter:: GenerateKeySeed**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-generatekeyseed).</span><span class="sxs-lookup"><span data-stu-id="ba584-128">If you need to generate a new key seed, call [**IWMDRMWriter::GenerateKeySeed**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-generatekeyseed).</span></span> <span data-ttu-id="ba584-129">En la mayoría de los casos, volverá a usar una inicialización de clave que se generó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="ba584-129">In most cases, you will be reusing a key seed that was generated previously.</span></span> <span data-ttu-id="ba584-130">Este valor debe ser secreto; no se escribe en el archivo.</span><span class="sxs-lookup"><span data-stu-id="ba584-130">This value must remain secret; it is not written into the file.</span></span>
7.  <span data-ttu-id="ba584-131">Llame a [**IWMDRMWriter:: GenerateKeyID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-generatekeyid) para crear un identificador de clave, que es el segundo valor que se usa para crear la clave real.</span><span class="sxs-lookup"><span data-stu-id="ba584-131">Call [**IWMDRMWriter::GenerateKeyID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-generatekeyid) to create a key ID, which is the second value used to create the actual key.</span></span> <span data-ttu-id="ba584-132">A diferencia de la inicialización de clave, el identificador de clave es público y se escribe en el archivo del encabezado DRM en el borrado.</span><span class="sxs-lookup"><span data-stu-id="ba584-132">Unlike the key seed, the key ID is public and is written to the file in the DRM header in the clear.</span></span> <span data-ttu-id="ba584-133">Cree un nuevo ID. de clave para cada nuevo archivo que cree.</span><span class="sxs-lookup"><span data-stu-id="ba584-133">Create a new key ID for each new file you create.</span></span>
8.  <span data-ttu-id="ba584-134">Llame a **IWMDRMWriter:: GenerateSigningKeyPair** si es necesario para generar una clave pública y privada que se utilizará para firmar el objeto de encabezado ASF de DRM avanzado.</span><span class="sxs-lookup"><span data-stu-id="ba584-134">Call **IWMDRMWriter::GenerateSigningKeyPair** if necessary to generate a public and private key that will be used to sign the advanced DRM ASF Header object.</span></span> <span data-ttu-id="ba584-135">Para obtener más información sobre estas claves, vea [**IWMDRMWriter:: GenerateSigningKeyPair**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-generatesigningkeypair).</span><span class="sxs-lookup"><span data-stu-id="ba584-135">For more information about these keys, see [**IWMDRMWriter::GenerateSigningKeyPair**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-generatesigningkeypair).</span></span>
9.  <span data-ttu-id="ba584-136">Si es necesario, obtenga los valores para rellenar el objeto de firma digital del encabezado DRM.</span><span class="sxs-lookup"><span data-stu-id="ba584-136">If necessary, obtain the values to populate the DRM header's digital signature object.</span></span> <span data-ttu-id="ba584-137">Si no tiene una versión de trabajo de Windows Media Rights Manager instalada en el sistema, debe configurar el objeto de firma digital del encabezado de archivo ASF especificando los cuatro atributos siguientes, que se deben obtener de Microsoft:</span><span class="sxs-lookup"><span data-stu-id="ba584-137">If you do not have a working version of Windows Media Rights Manager installed on your system, you must configure the ASF file header's digital signature object by specifying the following four attributes, which all must be obtained from Microsoft:</span></span>

    -   [<span data-ttu-id="ba584-138">**\_LASIGNATUREROOTCERT DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-138">**DRM\_LASignatureRootCert**</span></span>](drm-lasignaturerootcert.md)
    -   [<span data-ttu-id="ba584-139">**\_LASIGNATURECERT DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-139">**DRM\_LASignatureCert**</span></span>](drm-lasignaturecert.md)
    -   [<span data-ttu-id="ba584-140">**\_LASIGNATURELICSRVCERT DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-140">**DRM\_LASignatureLicSrvCert**</span></span>](drm-lasignaturelicsrvcert.md)
    -   [<span data-ttu-id="ba584-141">**\_LASIGNATUREPRIVKEY DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-141">**DRM\_LASignaturePrivKey**</span></span>](drm-lasignatureprivkey.md)

    <span data-ttu-id="ba584-142">Si tiene instalado Windows Media Rights Manager, no es necesario establecer estos atributos en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ba584-142">If you do have Windows Media Rights Manager installed, there is no need to set these attributes in your application.</span></span> <span data-ttu-id="ba584-143">El componente DRM recuperará estos atributos y los usará para firmar el encabezado automáticamente.</span><span class="sxs-lookup"><span data-stu-id="ba584-143">The DRM component will retrieve these attributes and use them to sign the header automatically.</span></span> <span data-ttu-id="ba584-144">Si tiene una versión activada de Windows Media Rights Manager en otro equipo y desea volver a usar esos valores de objeto de firma digital, puede encontrarlos en el registro.</span><span class="sxs-lookup"><span data-stu-id="ba584-144">If you have an activated version of Windows Media Rights Manager on another machine, and wish to reuse those digital signature object values, you can find them in the registry.</span></span> <span data-ttu-id="ba584-145">El certificado del servidor de licencias se almacena en HKEY \_ local \_ Machine \\ software \\ Microsoft \\ WM Rights Manager \\ License Server \\ certs: cert1 y el certificado raíz se almacena en \_ HKEY \_ local \\ Machine software \\ Microsoft \\ WM Rights Manager \\ License Server \\ certs: cert2.</span><span class="sxs-lookup"><span data-stu-id="ba584-145">The license server certificate is stored under HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\WM Rights Manager\\License Server\\Certs:cert1, and the root certificate is stored under HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\WM Rights Manager\\License Server\\Certs:cert2.</span></span> <span data-ttu-id="ba584-146">Al proteger archivos con DRM versión 7, debe usar los valores de estas claves del registro.</span><span class="sxs-lookup"><span data-stu-id="ba584-146">When protecting files with DRM version 7, you must use the values from these registry keys.</span></span> <span data-ttu-id="ba584-147">Para la **\_ propiedad LASignaturePrivKey de DRM**, use **GenerateSigningKeysEx** (a través del SDK de Windows Media Rights Manager) o bien vuelva a usar el valor instalado por Windows Media Rights Manager en HKEY \_ local \_ Machine \\ software \\ Microsoft \\ WM Rights Manager \\ License Server: info \_ Cert0.</span><span class="sxs-lookup"><span data-stu-id="ba584-147">For the **DRM\_LASignaturePrivKey property**, use either **GenerateSigningKeysEx** (through the Windows Media Rights Manager SDK) or else reuse the value installed by Windows Media Rights Manager under HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\WM Rights Manager\\License Server:Info\_Cert0.</span></span> <span data-ttu-id="ba584-148">Para la **propiedad \_ LASignatureCert de DRM** , use **GenerateSigningKeysEx** (a través del SDK de Windows Media Rights Manager) o bien el valor instalado por el administrador de derechos de Windows Media en HKEY \_ local \_ Machine \\ software \\ Microsoft \\ WM Rights Manager \\ License Server \\ certs: cert0.</span><span class="sxs-lookup"><span data-stu-id="ba584-148">For the **DRM\_LASignatureCert** property, use either **GenerateSigningKeysEx** (through the Windows Media Rights Manager SDK) or else the value installed by Windows Media Rights Manager under HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\WM Rights Manager\\License Server\\Certs:cert0.</span></span>

10. <span data-ttu-id="ba584-149">Llame a [**IWMDRMWriter:: SetDRMAttribute**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute) tantas veces como sea necesario para configurar el objeto de escritor, que establecerá los atributos de encabezado DRM necesarios según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="ba584-149">Call [**IWMDRMWriter::SetDRMAttribute**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute) as many times as necessary to configure the writer object, which will set the required DRM header attributes as necessary.</span></span> <span data-ttu-id="ba584-150">Estas propiedades se conservan durante la vigencia del objeto escritor o hasta que se restablecen con un nuevo valor.</span><span class="sxs-lookup"><span data-stu-id="ba584-150">These properties persist for the lifetime of the writer object or until they are reset with a new value.</span></span> <span data-ttu-id="ba584-151">No es necesario que se restablezcan para cada nuevo archivo que cree.</span><span class="sxs-lookup"><span data-stu-id="ba584-151">They do not need to be reset for each new file you create.</span></span>

    <span data-ttu-id="ba584-152">El objeto escritor requiere las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="ba584-152">The following properties are required by the writer object:</span></span>

    -   [<span data-ttu-id="ba584-153">**\_HEADERSIGNPRIVKEY DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-153">**DRM\_HeaderSignPrivKey**</span></span>](drm-headersignprivkey.md)
    -   [<span data-ttu-id="ba584-154">**\_KEYSEED DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-154">**DRM\_KeySeed**</span></span>](drm-keyseed.md)
    -   [<span data-ttu-id="ba584-155">**\_V1LICENSEACQURL DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-155">**DRM\_V1LicenseAcqURL**</span></span>](drm-v1licenseacqurl.md)
    -   [<span data-ttu-id="ba584-156">**ID. de ID \_ de DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-156">**DRM\_KeyID**</span></span>](drm-keyid.md)
    -   [<span data-ttu-id="ba584-157">**\_LICENSEACQURL DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-157">**DRM\_LicenseAcqURL**</span></span>](drm-licenseacqurl.md)

    <span data-ttu-id="ba584-158">Las siguientes propiedades son opcionales:</span><span class="sxs-lookup"><span data-stu-id="ba584-158">The following properties are optional:</span></span>

    -   [<span data-ttu-id="ba584-159">**ContentID de DRM \_**</span><span class="sxs-lookup"><span data-stu-id="ba584-159">**DRM\_ContentID**</span></span>](drm-contentid.md)
    -   [<span data-ttu-id="ba584-160">**\_INDIVIDUALIZEDVERSION DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-160">**DRM\_IndividualizedVersion**</span></span>](drm-individualizedversion.md)

    <span data-ttu-id="ba584-161">Además, puede especificar atributos de archivo DRM definidos por el usuario directamente mediante el atributo base [**\_ DRMHeader de DRM**](drm-drmheader.md) .</span><span class="sxs-lookup"><span data-stu-id="ba584-161">In addition, you may specify user-defined DRM file attributes directly using the [**DRM\_DRMHeader**](drm-drmheader.md) base attribute.</span></span> <span data-ttu-id="ba584-162">Puede agregar cualquier atributo adicional que desee, como "DRMHeader. RequireSAP", por ejemplo, como una forma de comunicar información adicional que usará el servidor de licencias para crear la licencia.</span><span class="sxs-lookup"><span data-stu-id="ba584-162">You can add any additional attribute you wish, such as "DRMHeader.RequireSAP" for example, as a way of communicating additional information that will be used by the license server in creating the license.</span></span> <span data-ttu-id="ba584-163">El servidor de licencias debe ser consciente de las propiedades adicionales que agregue.</span><span class="sxs-lookup"><span data-stu-id="ba584-163">The license server must be aware in advance of any additional properties you add.</span></span> <span data-ttu-id="ba584-164">No hay ninguna manera de detectar propiedades desconocidas mediante programación.</span><span class="sxs-lookup"><span data-stu-id="ba584-164">There is no way to discover unknown properties programmatically.</span></span>

11. <span data-ttu-id="ba584-165">Escriba el archivo mediante los métodos de la interfaz [**IWMWriter**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriter) tal y como se describe en esta documentación.</span><span class="sxs-lookup"><span data-stu-id="ba584-165">Write the file using the [**IWMWriter**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriter) interface methods as described elsewhere in this documentation.</span></span> <span data-ttu-id="ba584-166">Para crear una secuencia de DRM dinámica, simplemente escriba en un receptor de red.</span><span class="sxs-lookup"><span data-stu-id="ba584-166">To create a live-DRM stream, simply write to a network sink.</span></span> <span data-ttu-id="ba584-167">También puede escribir en un receptor de inserciones.</span><span class="sxs-lookup"><span data-stu-id="ba584-167">You can also write to a push sink.</span></span>
12. <span data-ttu-id="ba584-168">Si es necesario, cree una licencia para el archivo mediante el administrador de derechos de Windows Media.</span><span class="sxs-lookup"><span data-stu-id="ba584-168">If necessary, create a license for the file using Windows Media Rights Manager.</span></span> <span data-ttu-id="ba584-169">Esta tarea también puede realizarla un servidor de licencias de terceros.</span><span class="sxs-lookup"><span data-stu-id="ba584-169">This task can also be performed by a third-party license server.</span></span> <span data-ttu-id="ba584-170">En el caso de escenarios de DRM activo, los usuarios finales deberán obtener una licencia antes de que se inicie la secuencia o, en el momento en el que intenten conectarse a ella por primera vez.</span><span class="sxs-lookup"><span data-stu-id="ba584-170">For live-DRM scenarios, end users will need to obtain a license either before the stream begins, or else at the time they first attempt to connect to it.</span></span>

<span data-ttu-id="ba584-171">**Nota:** DRM no es compatible con la versión basada en x64 de este SDK.</span><span class="sxs-lookup"><span data-stu-id="ba584-171">**Note** DRM is not supported by the x64-based version of this SDK.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ba584-172">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="ba584-172">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ba584-173">**Atributos**</span><span class="sxs-lookup"><span data-stu-id="ba584-173">**Attributes**</span></span>](attributes.md)
</dt> <dt>

[<span data-ttu-id="ba584-174">**Lista de atributos de DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-174">**DRM Attribute List**</span></span>](drm-attribute-list.md)
</dt> <dt>

[<span data-ttu-id="ba584-175">**Propiedades de DRM**</span><span class="sxs-lookup"><span data-stu-id="ba584-175">**DRM Properties**</span></span>](drm-properties.md)
</dt> <dt>

[<span data-ttu-id="ba584-176">**Interfaz IWMDRMWriter**</span><span class="sxs-lookup"><span data-stu-id="ba584-176">**IWMDRMWriter Interface**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmwriter)
</dt> <dt>

[<span data-ttu-id="ba584-177">**IWMHeaderInfo:: SetAttribute**</span><span class="sxs-lookup"><span data-stu-id="ba584-177">**IWMHeaderInfo::SetAttribute**</span></span>](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmheaderinfo-setattribute)
</dt> <dt>

[<span data-ttu-id="ba584-178">**Interfaz IWMWriter**</span><span class="sxs-lookup"><span data-stu-id="ba584-178">**IWMWriter Interface**</span></span>](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriter)
</dt> <dt>

[<span data-ttu-id="ba584-179">**Leer archivos protegidos**</span><span class="sxs-lookup"><span data-stu-id="ba584-179">**Reading Protected Files**</span></span>](reading-protected-files.md)
</dt> <dt>

[<span data-ttu-id="ba584-180">**WMCreateWriter**</span><span class="sxs-lookup"><span data-stu-id="ba584-180">**WMCreateWriter**</span></span>](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatewriter)
</dt> </dl>

 

 




