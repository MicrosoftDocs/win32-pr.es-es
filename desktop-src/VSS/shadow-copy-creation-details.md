---
description: En general, el modo en que se crea una instantánea depende del tipo de instantánea que se va a crear, su contexto y el rol que se concede a los escritores en la operación de instantánea.
ms.assetid: eab3b39b-dfa7-43ea-adba-cd0b495c373f
title: Detalles de la creación de instantáneas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b9281b899593ca0751f1d549aed60305041b18c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696966"
---
# <a name="shadow-copy-creation-details"></a><span data-ttu-id="71be3-103">Detalles de la creación de instantáneas</span><span class="sxs-lookup"><span data-stu-id="71be3-103">Shadow Copy Creation Details</span></span>

<span data-ttu-id="71be3-104">En general, el modo en que se crea una instantánea depende del tipo de instantánea que se va a crear, su contexto y el rol que se concede a los escritores en la operación de instantánea.</span><span class="sxs-lookup"><span data-stu-id="71be3-104">In general, how a shadow copy is created depends on the type of shadow copy to be created, its context, and the role accorded to writers in the shadow copy operation.</span></span> <span data-ttu-id="71be3-105">(Vea [configuraciones de contexto](shadow-copy-context-configurations.md) de instantáneas para obtener más información).</span><span class="sxs-lookup"><span data-stu-id="71be3-105">(See [Shadow Copy Context Configurations](shadow-copy-context-configurations.md) for more information.)</span></span>

<span data-ttu-id="71be3-106">El contexto de instantánea se establece mediante una llamada al método [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) .</span><span class="sxs-lookup"><span data-stu-id="71be3-106">The shadow copy context is set by calling the [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) method.</span></span> <span data-ttu-id="71be3-107">Antes de llamar al método [**ivssbackupcomponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) para crear una instantánea, los solicitantes deben llamar a los métodos [**ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) en el orden especificado en las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="71be3-107">Before calling the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method to create a shadow copy, requesters must call the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) methods in the order specified in the following sections.</span></span>

## <a name="prerequisites-for-all-shadow-copies"></a><span data-ttu-id="71be3-108">Requisitos previos para todas las instantáneas</span><span class="sxs-lookup"><span data-stu-id="71be3-108">Prerequisites for All Shadow Copies</span></span>

<span data-ttu-id="71be3-109">Independientemente del nivel de participación del escritor, la creación de cualquier instantánea siempre requerirá que el solicitante se inicialice con llamadas a [**ivssbackupcomponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) y [**IVssBackupComponents:: StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span><span class="sxs-lookup"><span data-stu-id="71be3-109">Regardless of the level of writer participation, the creation of any shadow copy will always require the requestor be initialized with calls to [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) and [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span></span>

<span data-ttu-id="71be3-110">Si no se realiza esta llamada, el método [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) devolverá un error.</span><span class="sxs-lookup"><span data-stu-id="71be3-110">If this call is not made, the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method will return an error.</span></span>

## <a name="shadow-copies-with-writer-participation"></a><span data-ttu-id="71be3-111">Instantáneas con participación del redactor</span><span class="sxs-lookup"><span data-stu-id="71be3-111">Shadow Copies with Writer Participation</span></span>

<span data-ttu-id="71be3-112">Si el contexto de instantáneas especifica la participación del escritor (es decir, se llama a [**IVssBackupComponents:: SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) con la **copia de \_ \_ seguridad de VSS CTX** o la **\_ \_ \_ reversión de la aplicación VSS CTX**):</span><span class="sxs-lookup"><span data-stu-id="71be3-112">If the shadow copy context specifies writer participation (that is, [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) is called with **VSS\_CTX\_BACKUP**, or **VSS\_CTX\_APP\_ROLLBACK**):</span></span>

-   <span data-ttu-id="71be3-113">Los solicitantes siempre deben llamar a [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) cuando el contexto de instantáneas admita la participación del escritor.</span><span class="sxs-lookup"><span data-stu-id="71be3-113">Requesters must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) when the shadow copy context supports writer participation.</span></span> <span data-ttu-id="71be3-114">Si el contexto de instantáneas admite la participación del escritor y **ivssbackupcomponents:: GatherWriterMetadata** no se llama antes que [**Ivssbackupcomponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), se devolverá un error.</span><span class="sxs-lookup"><span data-stu-id="71be3-114">If the shadow copy context supports writer participation and **IVssBackupComponents::GatherWriterMetadata** is not called prior to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), an error will be returned.</span></span>
-   <span data-ttu-id="71be3-115">Si un solicitante desea seleccionar componentes de escritor específicos, debe llamar a [**IVssBackupComponents:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) antes de llamar a [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) para crear el conjunto de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="71be3-115">If a requester wants to select specific writer components, it must call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) before calling [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) to create the shadow copy set.</span></span>
-   <span data-ttu-id="71be3-116">Se debe llamar a [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) para crear el conjunto de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="71be3-116">[**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) must be called to create the shadow copy set.</span></span>
-   <span data-ttu-id="71be3-117">Los solicitantes pueden agregar uno o más volúmenes al conjunto de instantáneas llamando a [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="71be3-117">Requesters may add one or more volumes to the shadow copy set by calling [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span> <span data-ttu-id="71be3-118">Es posible que algunos componentes del escritor no especifiquen los volúmenes afectados.</span><span class="sxs-lookup"><span data-stu-id="71be3-118">Some writer components may not specify any affected volumes.</span></span> <span data-ttu-id="71be3-119">En este caso, es aceptable que un conjunto de instantáneas esté vacío (es decir, que no contenga volúmenes).</span><span class="sxs-lookup"><span data-stu-id="71be3-119">In this case, it is acceptable for a snapshot set to be empty (that is, to contain no volumes).</span></span>
-   <span data-ttu-id="71be3-120">Para garantizar la coherencia de los metadatos del escritor, un solicitante siempre debe llamar a [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) aunque no se seleccione ningún componente.</span><span class="sxs-lookup"><span data-stu-id="71be3-120">To guarantee the consistency of writer metadata, a requester should always call [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) even if no components are selected.</span></span> <span data-ttu-id="71be3-121">Esto hace que VSS genere un evento **PrepareForBackup** , en el que VSS llama al método [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) para cada redactor participante.</span><span class="sxs-lookup"><span data-stu-id="71be3-121">This causes VSS to generate a **PrepareForBackup** event, in which VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method for each participating writer.</span></span>
-   <span data-ttu-id="71be3-122">VSS generará [*PrepareForSnapshot*](vssgloss-p.md) y [*congelará*](vssgloss-f.md) eventos antes de crear la instantánea en respuesta a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="71be3-122">VSS will generate [*PrepareForSnapshot*](vssgloss-p.md) and [*Freeze*](vssgloss-f.md) events before creating the shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="71be3-123">Los escritores controlarán los eventos con [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) y [**CVssWriter:: alfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span><span class="sxs-lookup"><span data-stu-id="71be3-123">Writers will handle the events with [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) and [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span></span>
-   <span data-ttu-id="71be3-124">VSS generará eventos de [*reanudación*](vssgloss-t.md) y de [*instantáneas*](vssgloss-p.md) después de crear una instantánea en respuesta a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="71be3-124">VSS will generate [*Thaw*](vssgloss-t.md) events and [*PostSnapshot*](vssgloss-p.md) events after creating a shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="71be3-125">Los escritores controlarán los eventos con [**CVssWriter:: Alreanudar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) y [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span><span class="sxs-lookup"><span data-stu-id="71be3-125">Writers will handle the events with [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) and [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span></span>

## <a name="shadow-copies-without-writer-participation"></a><span data-ttu-id="71be3-126">Instantáneas sin participación del escritor</span><span class="sxs-lookup"><span data-stu-id="71be3-126">Shadow Copies without Writer Participation</span></span>

<span data-ttu-id="71be3-127">No se recomienda crear instantáneas sin la participación del escritor para las aplicaciones de copia de seguridad estándar (consulte [copias de seguridad sin participación del escritor](backups-without-writer-participation.md)).</span><span class="sxs-lookup"><span data-stu-id="71be3-127">Creating shadow copies without writer participation is discouraged for standard backup applications (see [Backups without Writer Participation](backups-without-writer-participation.md)).</span></span>

<span data-ttu-id="71be3-128">Hay usos, como las copias de seguridad rápidas de un disco para proporcionar una red de seguridad contra daños accidentales de archivos, que se pueden realizar sin la participación explícita del escritor.</span><span class="sxs-lookup"><span data-stu-id="71be3-128">There are uses, such as fast backups of a disk to provide a safety net against accidental file corruption, which can be conducted without explicit writer participation.</span></span> <span data-ttu-id="71be3-129">Este tipo de instantánea tendría un contexto de la **copia de \_ \_ seguridad del \_ recurso \_ compartido de archivos de VSS CTX** o de la **\_ \_ \_ reversión de NAS de VSS CTX**.</span><span class="sxs-lookup"><span data-stu-id="71be3-129">Such a shadow copy would have a context of either **VSS\_CTX\_FILE\_SHARE\_BACKUP** or **VSS\_CTX\_NAS\_ROLLBACK**.</span></span>

<span data-ttu-id="71be3-130">Para este tipo de instantánea, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="71be3-130">For this type of shadow copy, note the following:</span></span>

-   <span data-ttu-id="71be3-131">Los solicitantes deben seguir llamando a los métodos necesarios que se enumeran en [requisitos previos para todas las instantáneas](#prerequisites-for-all-shadow-copies).</span><span class="sxs-lookup"><span data-stu-id="71be3-131">Requesters must still call the required methods listed in [Prerequisites for All Shadow Copies](#prerequisites-for-all-shadow-copies).</span></span>
-   <span data-ttu-id="71be3-132">Los solicitantes pueden llamar a [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), pero esto no es necesario.</span><span class="sxs-lookup"><span data-stu-id="71be3-132">Requesters may call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), but this is not required.</span></span>
-   <span data-ttu-id="71be3-133">Si los solicitantes llaman a [**ivssbackupcomponents:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)o [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), se devolverá un error.</span><span class="sxs-lookup"><span data-stu-id="71be3-133">If requesters call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), an error will be returned.</span></span>
-   <span data-ttu-id="71be3-134">Los proveedores no generarán eventos [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*reanudar*](vssgloss-t.md)o [*postsnapshot*](vssgloss-p.md) para este tipo de instantánea.</span><span class="sxs-lookup"><span data-stu-id="71be3-134">Providers will not generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), or [*PostSnapshot*](vssgloss-p.md) events for this type of shadow copy.</span></span>

 

 



