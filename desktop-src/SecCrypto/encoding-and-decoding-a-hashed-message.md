---
description: Describe las tareas necesarias para codificar un mensaje con hash.
ms.assetid: c1a65452-c634-4cc6-9afe-d6bf11d999d1
title: Codificar y descodificar un mensaje con hash
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d91d165634c1ae00a59f2c77b1fc5a36b53dbd96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105668233"
---
# <a name="encoding-and-decoding-a-hashed-message"></a><span data-ttu-id="0d76a-103">Codificar y descodificar un mensaje con hash</span><span class="sxs-lookup"><span data-stu-id="0d76a-103">Encoding and Decoding a Hashed Message</span></span>

<span data-ttu-id="0d76a-104">Los datos con hash se componen de contenido de cualquier tipo y un [*hash*](../secgloss/h-gly.md) del contenido.</span><span class="sxs-lookup"><span data-stu-id="0d76a-104">Hashed data consists of content of any type and a [*hash*](../secgloss/h-gly.md) of the content.</span></span> <span data-ttu-id="0d76a-105">Se puede usar cuando solo es necesario confirmar que el contenido del mensaje no se ha modificado desde que se creó el hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-105">It can be used when it is only necessary to confirm that the message content has not been modified since the hash was created.</span></span>

<span data-ttu-id="0d76a-106">Al crear un mensaje con hash, puede haber varios algoritmos hash y varios valores hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-106">When creating a hashed message, there can be multiple hash algorithms and multiple hashes.</span></span> <span data-ttu-id="0d76a-107">En la ilustración siguiente se muestran las tareas necesarias para codificar un mensaje con hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-107">The following illustration depicts the tasks required to encode a hashed message.</span></span> <span data-ttu-id="0d76a-108">El procedimiento se describe en el texto que sigue a la ilustración.</span><span class="sxs-lookup"><span data-stu-id="0d76a-108">The procedure is described in the text that follows the illustration.</span></span>

![crear un mensaje con hash](images/hashmsg.png)

<span data-ttu-id="0d76a-110">**Para crear un mensaje con hash**</span><span class="sxs-lookup"><span data-stu-id="0d76a-110">**To create a hashed message**</span></span>

1.  <span data-ttu-id="0d76a-111">Obtiene un puntero a los datos a los que se va a aplicar un algoritmo hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-111">Get a pointer to the data to be hashed.</span></span>
2.  <span data-ttu-id="0d76a-112">Seleccione el algoritmo hash que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="0d76a-112">Select the hash algorithm to be used.</span></span>
3.  <span data-ttu-id="0d76a-113">Coloque los datos a través de una función hash mediante el algoritmo hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-113">Put the data through a hashing function using the hash algorithm.</span></span>
4.  <span data-ttu-id="0d76a-114">Incluya los datos originales a los que se va a aplicar un algoritmo hash, los algoritmos hash y los valores hash del mensaje codificado.</span><span class="sxs-lookup"><span data-stu-id="0d76a-114">Include the original data to be hashed, the hashing algorithms, and the hashes in the encoded message.</span></span>

<span data-ttu-id="0d76a-115">Para usar las funciones de mensaje de bajo nivel para realizar las tareas que se describen a continuación, utilice el procedimiento siguiente.</span><span class="sxs-lookup"><span data-stu-id="0d76a-115">To use low-level message functions to accomplish the tasks just outlined, use the following procedure.</span></span>

<span data-ttu-id="0d76a-116">**Para aplicar un algoritmo hash y codificar un mensaje mediante funciones de mensaje de bajo nivel**</span><span class="sxs-lookup"><span data-stu-id="0d76a-116">**To hash and encode a message using low-level message functions**</span></span>

1.  <span data-ttu-id="0d76a-117">Cree o recupere el contenido al que se va a aplicar un algoritmo hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-117">Create or retrieve the content to be hashed.</span></span>
2.  <span data-ttu-id="0d76a-118">Obtener un proveedor de servicios criptográficos.</span><span class="sxs-lookup"><span data-stu-id="0d76a-118">Get a cryptographic provider.</span></span>
3.  <span data-ttu-id="0d76a-119">Inicializa la estructura de [**\_ \_ \_ información de codificación hash de CMSG**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) .</span><span class="sxs-lookup"><span data-stu-id="0d76a-119">Initialize the [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) structure.</span></span>
4.  <span data-ttu-id="0d76a-120">Llame a [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) para obtener el tamaño del BLOB del mensaje codificado.</span><span class="sxs-lookup"><span data-stu-id="0d76a-120">Call [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) to get the size of the encoded message BLOB.</span></span> <span data-ttu-id="0d76a-121">Asigne memoria.</span><span class="sxs-lookup"><span data-stu-id="0d76a-121">Allocate memory for it.</span></span>
5.  <span data-ttu-id="0d76a-122">Llame a [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), pasando CMSG \_ hash para el parámetro *dwMsgType* y un puntero a la [**\_ \_ \_ información de codificación hash CMSG**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) para el parámetro *pvMsgEncodeInfo* .</span><span class="sxs-lookup"><span data-stu-id="0d76a-122">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing in CMSG\_HASHED for the *dwMsgType* parameter and a pointer to [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) for the *pvMsgEncodeInfo* parameter.</span></span> <span data-ttu-id="0d76a-123">Como resultado de esta llamada, obtendrá un identificador para el mensaje abierto.</span><span class="sxs-lookup"><span data-stu-id="0d76a-123">As a result of this call, you get a handle to the opened message.</span></span>
6.  <span data-ttu-id="0d76a-124">Llame a [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), pasando el identificador recuperado en el paso 5 y un puntero a los datos a los que se va a aplicar un algoritmo hash y codificado.</span><span class="sxs-lookup"><span data-stu-id="0d76a-124">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passing in the handle retrieved in step 5 and a pointer to the data that is to be hashed and encoded.</span></span> <span data-ttu-id="0d76a-125">Se puede llamar a esta función tantas veces como sea necesario para completar el proceso de codificación.</span><span class="sxs-lookup"><span data-stu-id="0d76a-125">This function can be called as many times as necessary to complete the encoding process.</span></span>
7.  <span data-ttu-id="0d76a-126">Llame a [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), pasando el identificador recuperado en el paso 5 y los tipos de parámetro adecuados para tener acceso a los datos codificados deseados.</span><span class="sxs-lookup"><span data-stu-id="0d76a-126">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 5 and the appropriate parameter types to access the desired, encoded data.</span></span> <span data-ttu-id="0d76a-127">Por ejemplo, pase \_ el parámetro de contenido CMSG \_ para obtener un puntero al mensaje [*PKCS \# 7*](../secgloss/p-gly.md) completo.</span><span class="sxs-lookup"><span data-stu-id="0d76a-127">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the entire [*PKCS \#7*](../secgloss/p-gly.md) message.</span></span>

    <span data-ttu-id="0d76a-128">Si el resultado de esta codificación se va a usar como [*datos internos*](../secgloss/i-gly.md) de otro mensaje codificado, como un mensaje con doble cifrado, \_ \_ \_ se debe pasar el parámetro CMSG de contenido sin sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="0d76a-128">If the result of this encoding is to be used as the [*inner data*](../secgloss/i-gly.md) for another encoded message, such as an enveloped message, CMSG\_BARE\_CONTENT\_PARAM must be passed.</span></span> <span data-ttu-id="0d76a-129">Para ver un ejemplo que muestra esto, consulte el [código alternativo para codificar un mensaje con doble cifrado](alternate-code-for-encoding-an-enveloped-message.md).</span><span class="sxs-lookup"><span data-stu-id="0d76a-129">For an example showing this, see [Alternate Code for Encoding an Enveloped Message](alternate-code-for-encoding-an-enveloped-message.md).</span></span>

8.  <span data-ttu-id="0d76a-130">Cierre el mensaje mediante una llamada a [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="0d76a-130">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="0d76a-131">El resultado de este procedimiento es un mensaje codificado que contiene los datos originales, los algoritmos hash y el [*hash*](../secgloss/h-gly.md) de esos datos.</span><span class="sxs-lookup"><span data-stu-id="0d76a-131">The result of this procedure is an encoded message that contains the original data, the hashing algorithms, and the [*hash*](../secgloss/h-gly.md) of that data.</span></span> <span data-ttu-id="0d76a-132">En el paso 7 se obtiene un puntero al [*BLOB*](../secgloss/b-gly.md) del mensaje codificado.</span><span class="sxs-lookup"><span data-stu-id="0d76a-132">A pointer to the encoded message [*BLOB*](../secgloss/b-gly.md) is obtained in step 7.</span></span>

<span data-ttu-id="0d76a-133">Los dos procedimientos siguientes descodifican y comprueban los datos con hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-133">The following two procedures decode and then verify hashed data.</span></span>

<span data-ttu-id="0d76a-134">**Para descodificar los datos con hash**</span><span class="sxs-lookup"><span data-stu-id="0d76a-134">**To decode hashed data**</span></span>

1.  <span data-ttu-id="0d76a-135">Obtiene un puntero al objeto binario codificado.</span><span class="sxs-lookup"><span data-stu-id="0d76a-135">Get a pointer to the encoded BLOB.</span></span>
2.  <span data-ttu-id="0d76a-136">Llame a [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), pasando los argumentos necesarios.</span><span class="sxs-lookup"><span data-stu-id="0d76a-136">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span>
3.  <span data-ttu-id="0d76a-137">Llame a [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) una vez, pasando el identificador recuperado en el paso 2 y un puntero a los datos que se van a descodificar.</span><span class="sxs-lookup"><span data-stu-id="0d76a-137">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once, passing in the handle retrieved in step 2 and a pointer to the data that is to be decoded.</span></span> <span data-ttu-id="0d76a-138">Esto hace que se realicen las acciones adecuadas en el mensaje, en función del tipo de mensaje.</span><span class="sxs-lookup"><span data-stu-id="0d76a-138">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="0d76a-139">Llame a [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), pasando el identificador recuperado en el paso 2 y los tipos de parámetro adecuados para tener acceso a los datos descodificados deseados.</span><span class="sxs-lookup"><span data-stu-id="0d76a-139">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 2, and the appropriate parameter types to access the desired, decoded data.</span></span> <span data-ttu-id="0d76a-140">Por ejemplo, pase \_ el parámetro de contenido CMSG \_ para obtener un puntero al contenido descodificado.</span><span class="sxs-lookup"><span data-stu-id="0d76a-140">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the decoded content.</span></span>

<span data-ttu-id="0d76a-141">**Para comprobar el hash**</span><span class="sxs-lookup"><span data-stu-id="0d76a-141">**To verify the hash**</span></span>

1.  <span data-ttu-id="0d76a-142">Llame a [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), pasando CMSG \_ Ctrl \_ Verify \_ hash para comprobar los valores hash.</span><span class="sxs-lookup"><span data-stu-id="0d76a-142">Call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing in CMSG\_CTRL\_VERIFY\_HASH to verify the hashes.</span></span>
2.  <span data-ttu-id="0d76a-143">Llame a [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) para cerrar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="0d76a-143">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="0d76a-144">Para obtener un programa de ejemplo, vea [ejemplo de programa C: codificar y descodificar un mensaje con hash](example-c-program-encoding-and-decoding-a-hashed-message.md).</span><span class="sxs-lookup"><span data-stu-id="0d76a-144">For an example program, see [Example C Program: Encoding and Decoding a Hashed Message](example-c-program-encoding-and-decoding-a-hashed-message.md).</span></span>

 

 
