---
title: Uso del administrador de reinicio con un instalador principal
description: En el procedimiento siguiente se describe cómo usar el administrador de reinicio para cerrar y reiniciar aplicaciones y servicios. Al usar el administrador de reinicio con un solo instalador, este instalador es también el instalador principal que controla la interfaz de usuario.
ms.assetid: 8d2b4129-c595-4b11-9771-6dc953f4db40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 38956ee8d04bc377809e93579080d9b767c3da3a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "103994054"
---
# <a name="using-restart-manager-with-a-primary-installer"></a><span data-ttu-id="a3ef2-104">Uso del administrador de reinicio con un instalador principal</span><span class="sxs-lookup"><span data-stu-id="a3ef2-104">Using Restart Manager with a Primary Installer</span></span>

<span data-ttu-id="a3ef2-105">En el procedimiento siguiente se describe cómo usar el administrador de reinicio para cerrar y reiniciar aplicaciones y servicios.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-105">The following procedure describes how to use the Restart Manager to shutdown and restart applications and services.</span></span> <span data-ttu-id="a3ef2-106">Al usar el administrador de reinicio con un solo instalador, este instalador es también el instalador principal que controla la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-106">When using the Restart Manager with a single installer, this installer is also the primary installer that controls the user interface.</span></span>

<span data-ttu-id="a3ef2-107">**Para usar el administrador de reinicio con un instalador principal**</span><span class="sxs-lookup"><span data-stu-id="a3ef2-107">**To use the Restart Manager with a primary installer**</span></span>

1.  <span data-ttu-id="a3ef2-108">El instalador llama a la función [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) para iniciar la sesión del administrador de reinicio y obtener un identificador de sesión y una clave.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-108">The installer calls the [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) function to start the Restart Manager session and obtain a session handle and key.</span></span>
2.  <span data-ttu-id="a3ef2-109">El instalador llama a la función [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) para registrar los recursos.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-109">The installer calls the [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) function to register resources.</span></span> <span data-ttu-id="a3ef2-110">El administrador de reinicio solo puede usar recursos registrados para determinar qué aplicaciones y servicios deben cerrarse y reiniciarse.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-110">The Restart Manager can only use registered resources to determine which applications and services must be shut down and restarted.</span></span> <span data-ttu-id="a3ef2-111">Todos los recursos que pueden verse afectados por la instalación deben registrarse con la sesión.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-111">All resources that can be affected by the installation should be registered with the session.</span></span> <span data-ttu-id="a3ef2-112">Los recursos se pueden identificar mediante el nombre de archivo, el nombre corto de servicio o una estructura de [**\_ \_ proceso único de RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) .</span><span class="sxs-lookup"><span data-stu-id="a3ef2-112">Resources can be identified by filename, service short name, or an [**RM\_UNIQUE\_PROCESS**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) structure.</span></span>
3.  <span data-ttu-id="a3ef2-113">El instalador llama a la función [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) para obtener una matriz de estructuras de [**información del \_ proceso \_ de RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) que enumera todas las aplicaciones y servicios que deben cerrarse y reiniciarse.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-113">The installer calls the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function to obtain an array of [**RM\_PROCESS\_INFO**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) structures that lists all applications and services that must be shut down and restarted.</span></span>

    <span data-ttu-id="a3ef2-114">Si el valor del parámetro *lpdwRebootReason* devuelto por la función [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) es distinto de cero, el administrador de reinicio no puede liberar un recurso registrado por el cierre de una aplicación o servicio.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-114">If the value of the *lpdwRebootReason* parameter that is returned by the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function is nonzero, the Restart Manager is unable to free a registered resource by the shutdown of an application or service.</span></span> <span data-ttu-id="a3ef2-115">En este caso, es necesario apagar y reiniciar el sistema para continuar con la instalación.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-115">In this case, a system shutdown and restart is required to continue the installation.</span></span> <span data-ttu-id="a3ef2-116">El instalador debe solicitar al usuario una acción, detener programas o servicios, o programar un cierre del sistema y reiniciarlo.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-116">The installer should prompt the user for an action, stop programs or services, or schedule a system shutdown and restart.</span></span>

    <span data-ttu-id="a3ef2-117">Si el valor del parámetro *lpdwRebootReason* devuelto por la función [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) es cero, el instalador debe llamar a la función [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) .</span><span class="sxs-lookup"><span data-stu-id="a3ef2-117">If the value of the *lpdwRebootReason* parameter that is returned by the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function is zero, the installer should call the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function.</span></span> <span data-ttu-id="a3ef2-118">Esto cierra los servicios y aplicaciones que usan recursos registrados.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-118">This shuts down the services and applications that are using registered resources.</span></span> <span data-ttu-id="a3ef2-119">Después, el instalador debe realizar las modificaciones del sistema necesarias para completar la instalación.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-119">The installer should then perform system modifications that are required to complete the installation.</span></span> <span data-ttu-id="a3ef2-120">Por último, el instalador debe llamar a la función [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) para que el administrador de reinicio pueda reiniciar las aplicaciones que se han cerrado y que se han registrado para un reinicio.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-120">Finally, the installer should call the [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function so that the Restart Manager can restart the applications it has shut down and that have been registered for a restart.</span></span>

4.  <span data-ttu-id="a3ef2-121">El instalador puede usar la función [**RmAddFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) para evitar que las aplicaciones y los servicios especificados se cierren o reinicien con las operaciones del administrador de reinicio.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-121">The installer can use the [**RmAddFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) function to prevent specified applications and services from being shutdown or restarted by Restart Manager operations.</span></span> <span data-ttu-id="a3ef2-122">La función [**RmGetFilterList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) devuelve una lista de las aplicaciones y los servicios que se van a filtrar del apagado y el reinicio.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-122">The [**RmGetFilterList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) function returns a list of the applications and services to be filtered from shutdown and restart.</span></span> <span data-ttu-id="a3ef2-123">La función [**RmRemoveFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) quita un filtro.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-123">The [**RmRemoveFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) function removes a filter.</span></span>
5.  <span data-ttu-id="a3ef2-124">El instalador llama a la función [**RmEndSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) para cerrar la sesión del administrador de reinicio.</span><span class="sxs-lookup"><span data-stu-id="a3ef2-124">The installer calls the [**RmEndSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) function to close the Restart Manager session.</span></span>

<span data-ttu-id="a3ef2-125">Para obtener un fragmento de código de ejemplo que muestra el inicio y el uso de una sesión del administrador de reinicio mediante un instalador principal y la Unión a un instalador secundario a la sesión existente, consulte [uso del administrador de reinicio con un instalador secundario](using-restart-manager-with-a-secondary-installer.md).</span><span class="sxs-lookup"><span data-stu-id="a3ef2-125">For an example code snippet that shows starting and using a Restart Manager session by using a primary installer and then joining a secondary installer to the existing session, see [Using Restart Manager with a Secondary Installer](using-restart-manager-with-a-secondary-installer.md).</span></span>

 

 




