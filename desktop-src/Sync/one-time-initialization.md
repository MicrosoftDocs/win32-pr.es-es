---
description: Los componentes suelen diseñarse para realizar tareas de inicialización cuando se les llama por primera vez, en lugar de cuando se cargan.
ms.assetid: 404c083c-7bee-44c2-b8e7-da1901b6ab2f
title: Inicialización de One-Time
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 16f451e3c51716b4ff6f33b55d8d8602b5d5c28f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105669779"
---
# <a name="one-time-initialization"></a><span data-ttu-id="047f9-103">Inicialización de One-Time</span><span class="sxs-lookup"><span data-stu-id="047f9-103">One-Time Initialization</span></span>

<span data-ttu-id="047f9-104">Los componentes suelen diseñarse para realizar tareas de inicialización cuando se les llama por primera vez, en lugar de cuando se cargan.</span><span class="sxs-lookup"><span data-stu-id="047f9-104">Components are often designed to perform initialization tasks when they are first called, rather than when they are loaded.</span></span> <span data-ttu-id="047f9-105">Las funciones de inicialización únicas garantizan que esta inicialización se produce una sola vez, incluso cuando varios subprocesos pueden intentar la inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-105">The one-time initialization functions ensure that this initialization occurs only once, even when multiple threads may attempt the initialization.</span></span>

<span data-ttu-id="047f9-106">**Windows Server 2003 y Windows XP:** Las aplicaciones deben proporcionar su propia sincronización para la inicialización única mediante el uso de las [funciones de interbloqueo](interlocked-variable-access.md) u otro mecanismo de sincronización.</span><span class="sxs-lookup"><span data-stu-id="047f9-106">**Windows Server 2003 and Windows XP:** Applications must provide their own synchronization for one-time initialization by using the [interlocked functions](interlocked-variable-access.md) or other synchronization mechanism.</span></span> <span data-ttu-id="047f9-107">Las funciones de inicialización de un solo paso están disponibles a partir de Windows Vista y Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="047f9-107">The one-time initialization functions are available starting with Windows Vista and Windows Server 2008.</span></span>

<span data-ttu-id="047f9-108">Las funciones de inicialización únicas proporcionan ventajas significativas para asegurarse de que solo un subproceso realiza la inicialización:</span><span class="sxs-lookup"><span data-stu-id="047f9-108">The one-time initialization functions provide significant advantages to ensure that only one thread performs the initialization:</span></span>

-   <span data-ttu-id="047f9-109">Están optimizados para la velocidad.</span><span class="sxs-lookup"><span data-stu-id="047f9-109">They are optimized for speed.</span></span>
-   <span data-ttu-id="047f9-110">Crean las barreras adecuadas en las arquitecturas de procesador que las necesitan.</span><span class="sxs-lookup"><span data-stu-id="047f9-110">They create the appropriate barriers on processor architectures that require them.</span></span>
-   <span data-ttu-id="047f9-111">Admiten la inicialización en paralelo y bloqueada.</span><span class="sxs-lookup"><span data-stu-id="047f9-111">They support both locked and parallel initialization.</span></span>
-   <span data-ttu-id="047f9-112">Evitan el bloqueo interno para que el código pueda funcionar de forma asincrónica o sincrónica.</span><span class="sxs-lookup"><span data-stu-id="047f9-112">They avoid internal locking so the code can operate asynchronously or synchronously.</span></span>

<span data-ttu-id="047f9-113">El sistema administra el proceso de inicialización a través de una estructura de inicialización opaca **\_ una vez** que contiene datos e información de estado.</span><span class="sxs-lookup"><span data-stu-id="047f9-113">The system manages the initialization process through an opaque **INIT\_ONCE** structure that contains data and state information.</span></span> <span data-ttu-id="047f9-114">El autor de la llamada asigna esta estructura y la inicializa mediante una llamada a [**InitOnceInitialize**](/windows/win32/api/synchapi/nf-synchapi-initonceinitialize) (para inicializar la estructura dinámicamente) o asigna la constante **init \_ una vez \_ a \_** la variable de estructura (para inicializar la estructura estáticamente).</span><span class="sxs-lookup"><span data-stu-id="047f9-114">The caller allocates this structure and initializes it by either calling [**InitOnceInitialize**](/windows/win32/api/synchapi/nf-synchapi-initonceinitialize) (to initialize the structure dynamically) or assigning the constant **INIT\_ONCE\_STATIC\_INIT** to the structure variable (to initialize the structure statically).</span></span> <span data-ttu-id="047f9-115">Inicialmente, los datos almacenados en la estructura de inicialización única son NULL y su estado es no inicializado.</span><span class="sxs-lookup"><span data-stu-id="047f9-115">Initially, the data stored in the one-time initialization structure is NULL and its state is uninitialized.</span></span>

<span data-ttu-id="047f9-116">Las estructuras de inicialización de un solo uso no se pueden compartir entre los procesos.</span><span class="sxs-lookup"><span data-stu-id="047f9-116">One-time initialization structures cannot be shared across processes.</span></span>

<span data-ttu-id="047f9-117">El subproceso que realiza la inicialización puede establecer opcionalmente un contexto que esté disponible para el autor de la llamada después de que se complete la inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-117">The thread that performs the initialization can optionally set a context that is available to the caller after initialization is complete.</span></span> <span data-ttu-id="047f9-118">El contexto puede ser un objeto de sincronización o puede ser un valor o una estructura de datos.</span><span class="sxs-lookup"><span data-stu-id="047f9-118">The context can be a synchronization object or it can be a value or data structure.</span></span> <span data-ttu-id="047f9-119">Si el contexto es un valor, su inicialización de orden inferior **\_ una vez que los \_ \_ \_ bits reservados de CTX** deben ser cero.</span><span class="sxs-lookup"><span data-stu-id="047f9-119">If the context is a value, its low-order **INIT\_ONCE\_CTX\_RESERVED\_BITS** must be zero.</span></span> <span data-ttu-id="047f9-120">Si el contexto es una estructura de datos, la estructura de datos debe alinearse con **DWORD**.</span><span class="sxs-lookup"><span data-stu-id="047f9-120">If the context is a data structure, the data structure must be **DWORD**-aligned.</span></span> <span data-ttu-id="047f9-121">El contexto se devuelve al autor de la llamada en el parámetro de salida *lpContext* de la función [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) o [**InitOnceExecuteOnce**](/windows/win32/api/synchapi/nf-synchapi-initonceexecuteonce) .</span><span class="sxs-lookup"><span data-stu-id="047f9-121">The context is returned to the caller in the *lpContext* output parameter of the [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) or [**InitOnceExecuteOnce**](/windows/win32/api/synchapi/nf-synchapi-initonceexecuteonce) function.</span></span>

<span data-ttu-id="047f9-122">La inicialización única puede realizarse de forma sincrónica o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="047f9-122">One-time initialization can be performed synchronously or asynchronously.</span></span> <span data-ttu-id="047f9-123">Se puede usar una función de devolución de llamada opcional para la inicialización única sincrónica.</span><span class="sxs-lookup"><span data-stu-id="047f9-123">An optional callback function can be used for synchronous one-time initialization.</span></span>

## <a name="synchronous-one-time-initialization"></a><span data-ttu-id="047f9-124">Inicialización única sincrónica</span><span class="sxs-lookup"><span data-stu-id="047f9-124">Synchronous One-time Initialization</span></span>

<span data-ttu-id="047f9-125">En los pasos siguientes se describe la inicialización única sincrónica que no utiliza una función de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="047f9-125">The following steps describe synchronous one-time initialization that does not use a callback function.</span></span>

1.  <span data-ttu-id="047f9-126">El primer subproceso que llama a la función [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) produce correctamente la inicialización de una sola vez.</span><span class="sxs-lookup"><span data-stu-id="047f9-126">The first thread to call the [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) function successfully causes one-time initialization to begin.</span></span> <span data-ttu-id="047f9-127">Para la inicialización única sincrónica, se debe llamar a **InitOnceBeginInitialize** sin el marcador de inicialización una **\_ vez \_** .</span><span class="sxs-lookup"><span data-stu-id="047f9-127">For synchronous one-time initialization, **InitOnceBeginInitialize** must be called without the **INIT\_ONCE\_ASYNC** flag.</span></span>
2.  <span data-ttu-id="047f9-128">Los subprocesos posteriores que intentan inicializarse se bloquean hasta que el primer subproceso complete la inicialización o se produzca un error.</span><span class="sxs-lookup"><span data-stu-id="047f9-128">Subsequent threads that attempt initialization are blocked until the first thread either completes initialization or fails.</span></span> <span data-ttu-id="047f9-129">Si se produce un error en el primer subproceso, se permite que el siguiente subproceso intente la inicialización, etc.</span><span class="sxs-lookup"><span data-stu-id="047f9-129">If the first thread fails, the next thread is allowed to attempt the initialization, and so on.</span></span>
3.  <span data-ttu-id="047f9-130">Una vez finalizada la inicialización, el subproceso llama a la función [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) .</span><span class="sxs-lookup"><span data-stu-id="047f9-130">When initialization is finished, the thread calls the [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) function.</span></span> <span data-ttu-id="047f9-131">El subproceso puede crear opcionalmente un objeto de sincronización (u otros datos de contexto) y especificarlo en el parámetro *lpContext* de la función **InitOnceComplete** .</span><span class="sxs-lookup"><span data-stu-id="047f9-131">The thread can optionally create a synchronization object (or other context data) and specify it in the *lpContext* parameter of the **InitOnceComplete** function.</span></span>
4.  <span data-ttu-id="047f9-132">Si la inicialización se realiza correctamente, el estado de la estructura de inicialización única se cambia a inicializado y el identificador de *lpContext* (si existe) se almacena en la estructura de inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-132">If the initialization succeeds, the state of the one-time initialization structure is changed to initialized and the *lpContext* handle (if any) is stored in the initialization structure.</span></span> <span data-ttu-id="047f9-133">Los intentos de inicialización subsiguientes devuelven estos datos de contexto.</span><span class="sxs-lookup"><span data-stu-id="047f9-133">Subsequent initialization attempts return this context data.</span></span> <span data-ttu-id="047f9-134">Si se produce un error en la inicialización, los datos son **null**.</span><span class="sxs-lookup"><span data-stu-id="047f9-134">If the initialization fails, the data is **NULL**.</span></span>

<span data-ttu-id="047f9-135">En los pasos siguientes se describe la inicialización única sincrónica que usa una función de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="047f9-135">The following steps describe synchronous one-time initialization that uses a callback function.</span></span>

1.  <span data-ttu-id="047f9-136">El primer subproceso para llamar correctamente a la función [**InitOnceExecuteOnce**](/windows/win32/api/synchapi/nf-synchapi-initonceexecuteonce) pasa un puntero a una función de devolución de llamada [*InitOnceCallback*](/windows/win32/api/synchapi/nc-synchapi-pinit_once_fn) definida por la aplicación y a los datos requeridos por la función de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="047f9-136">The first thread to successfully call the [**InitOnceExecuteOnce**](/windows/win32/api/synchapi/nf-synchapi-initonceexecuteonce) function passes a pointer to an application-defined [*InitOnceCallback*](/windows/win32/api/synchapi/nc-synchapi-pinit_once_fn) callback function and any data required by the callback function.</span></span> <span data-ttu-id="047f9-137">Si la llamada se realiza correctamente, se ejecuta la función de devolución de llamada *InitOnceCallback* .</span><span class="sxs-lookup"><span data-stu-id="047f9-137">If the call succeeds, the *InitOnceCallback* callback function executes.</span></span>
2.  <span data-ttu-id="047f9-138">Los subprocesos posteriores que intentan inicializarse se bloquean hasta que el primer subproceso complete la inicialización o se produzca un error.</span><span class="sxs-lookup"><span data-stu-id="047f9-138">Subsequent threads that attempt initialization are blocked until the first thread either completes initialization or fails.</span></span> <span data-ttu-id="047f9-139">Si se produce un error en el primer subproceso, se permite que el siguiente subproceso intente la inicialización, etc.</span><span class="sxs-lookup"><span data-stu-id="047f9-139">If the first thread fails, the next thread is allowed to attempt the initialization, and so on.</span></span>
3.  <span data-ttu-id="047f9-140">Una vez finalizada la inicialización, la función de devolución de llamada devuelve.</span><span class="sxs-lookup"><span data-stu-id="047f9-140">When initialization is finished, the callback function returns.</span></span> <span data-ttu-id="047f9-141">Opcionalmente, la función de devolución de llamada puede crear un objeto de sincronización (u otros datos de contexto) y especificarlo en su parámetro de salida de *contexto* .</span><span class="sxs-lookup"><span data-stu-id="047f9-141">The callback function can optionally create a synchronization object (or other context data) and specify it in its *Context* output parameter.</span></span>
4.  <span data-ttu-id="047f9-142">Si la inicialización se realiza correctamente, el estado de la estructura de inicialización única se cambia a inicializado y el identificador de *contexto* (si existe) se almacena en la estructura de inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-142">If the initialization succeeds, the state of the one-time initialization structure is changed to initialized and the *Context* handle (if any) is stored in the initialization structure.</span></span> <span data-ttu-id="047f9-143">Los intentos de inicialización subsiguientes devuelven estos datos de contexto.</span><span class="sxs-lookup"><span data-stu-id="047f9-143">Subsequent initialization attempts return this context data.</span></span> <span data-ttu-id="047f9-144">Si se produce un error en la inicialización, los datos son **null**.</span><span class="sxs-lookup"><span data-stu-id="047f9-144">If the initialization fails, the data is **NULL**.</span></span>

## <a name="asynchronous-one-time-initialization"></a><span data-ttu-id="047f9-145">Inicialización única asincrónica</span><span class="sxs-lookup"><span data-stu-id="047f9-145">Asynchronous One-time Initialization</span></span>

<span data-ttu-id="047f9-146">Los pasos siguientes describen la inicialización única asincrónica.</span><span class="sxs-lookup"><span data-stu-id="047f9-146">The following steps describe asynchronous one-time initialization.</span></span>

1.  <span data-ttu-id="047f9-147">Si varios subprocesos intentan iniciar la inicialización simultáneamente mediante una llamada a [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) con **init \_ una vez \_ Async**, la función se ejecuta correctamente para todos los subprocesos con el parámetro *fPending* establecido en **true**.</span><span class="sxs-lookup"><span data-stu-id="047f9-147">If multiple threads simultaneously attempt to begin initialization by calling [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) with **INIT\_ONCE\_ASYNC**, the function succeeds for all of the threads with the *fPending* parameter set to **TRUE**.</span></span> <span data-ttu-id="047f9-148">En realidad, solo se realizará correctamente un subproceso durante la inicialización; otros intentos simultáneos no cambian el estado de inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-148">Only one thread will actually succeed at initialization; other concurrent attempts do not change the initialization state.</span></span>
2.  <span data-ttu-id="047f9-149">Cuando [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) devuelve, el parámetro *fPending* indica el estado de inicialización:</span><span class="sxs-lookup"><span data-stu-id="047f9-149">When [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) returns, the *fPending* parameter indicates the initialization status:</span></span>
    -   <span data-ttu-id="047f9-150">Si *fPending* es **false**, un subproceso se ha realizado correctamente al inicializarse.</span><span class="sxs-lookup"><span data-stu-id="047f9-150">If *fPending* is **FALSE**, one thread has succeeded at initialization.</span></span> <span data-ttu-id="047f9-151">Otros subprocesos deben limpiar todos los datos de contexto que hayan creado y usar los datos de contexto en el parámetro de salida *lpContext* de [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize).</span><span class="sxs-lookup"><span data-stu-id="047f9-151">Other threads should clean up any context data they have created and use the context data in the *lpContext* output parameter of [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize).</span></span>
    -   <span data-ttu-id="047f9-152">Si *fPending* es **true**, la inicialización aún no se ha completado y otros subprocesos deben continuar.</span><span class="sxs-lookup"><span data-stu-id="047f9-152">If *fPending* is **TRUE**, initialization has not yet completed and other threads should continue.</span></span>
3.  <span data-ttu-id="047f9-153">Cada subproceso llama a la función [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) .</span><span class="sxs-lookup"><span data-stu-id="047f9-153">Each thread calls the [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) function.</span></span> <span data-ttu-id="047f9-154">El subproceso puede crear opcionalmente un objeto de sincronización (u otros datos de contexto) y especificarlo en el parámetro *lpContext* de **InitOnceComplete**.</span><span class="sxs-lookup"><span data-stu-id="047f9-154">The thread can optionally create a synchronization object (or other context data) and specify it in the *lpContext* parameter of **InitOnceComplete**.</span></span>
4.  <span data-ttu-id="047f9-155">Cuando [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) devuelve, su valor devuelto indica si el subproceso que realiza la llamada se realizó correctamente en la inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-155">When [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) returns, its return value indicates whether the calling thread succeeded at initialization.</span></span>
    -   <span data-ttu-id="047f9-156">Si [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) se ejecuta correctamente, el subproceso que realiza la llamada se ha realizado correctamente en la inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-156">If [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) succeeds, the calling thread has succeeded at initialization.</span></span> <span data-ttu-id="047f9-157">El estado de la estructura de inicialización única se cambia a inicializado y el identificador de *lpContext* (si existe) se almacena en la estructura de inicialización.</span><span class="sxs-lookup"><span data-stu-id="047f9-157">The state of the one-time initialization structure is changed to initialized and the *lpContext* handle (if any) is stored in the initialization structure.</span></span>
    -   <span data-ttu-id="047f9-158">Si [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) produce un error, otro subproceso se ha realizado correctamente al inicializarse.</span><span class="sxs-lookup"><span data-stu-id="047f9-158">If [**InitOnceComplete**](/windows/win32/api/synchapi/nf-synchapi-initoncecomplete) fails, another thread has succeeded at initialization.</span></span> <span data-ttu-id="047f9-159">El subproceso que realiza la llamada debe limpiar todos los datos de contexto que haya creado y llamar a [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) con **init \_ una vez \_ \_ solo** para recuperar los datos de contexto almacenados en la estructura de inicialización única.</span><span class="sxs-lookup"><span data-stu-id="047f9-159">The calling thread should clean up any context data it has created and call [**InitOnceBeginInitialize**](/windows/win32/api/synchapi/nf-synchapi-initoncebegininitialize) with **INIT\_ONCE\_CHECK\_ONLY** to retrieve any context data stored in the one-time initialization structure.</span></span>

## <a name="calling-one-time-initialization-from-multiple-sites"></a><span data-ttu-id="047f9-160">Llamar a One-Time inicialización desde varios sitios</span><span class="sxs-lookup"><span data-stu-id="047f9-160">Calling One-Time Initialization from multiple sites</span></span>

<span data-ttu-id="047f9-161">Inicialización única que protege una sola **init \_ una vez** que la estructura puede realizarse desde sitios varias; se puede pasar una devolución de llamada diferente de cada sitio y se puede mezclar la sincronización con y sin devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="047f9-161">One-time initialization guarded by a single **INIT\_ONCE** structure may be performed from mutiple sites; different callback may be passed from each site, and synchronization with and without callback may be mixed.</span></span> <span data-ttu-id="047f9-162">La inicialización todavía está configurada para realizar sucesfully una sola vez.</span><span class="sxs-lookup"><span data-stu-id="047f9-162">Initialization is still guaranted to perform sucesfully just once.</span></span>

<span data-ttu-id="047f9-163">Sin embargo, no se puede mezclar la inicialización asincrónica y sincrónica: una vez que se intenta la inicialización asincrónica, se producirá un error al intentar iniciar la inicialización sincrónica.</span><span class="sxs-lookup"><span data-stu-id="047f9-163">However, asynchronous and synchronous initialization cannot be mixed: once asynchronous initialization is attempted, attempts to start synchronous initialization would fail.</span></span>

## <a name="related-topics"></a><span data-ttu-id="047f9-164">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="047f9-164">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="047f9-165">Usar la inicialización de One-Time</span><span class="sxs-lookup"><span data-stu-id="047f9-165">Using One-Time Initialization</span></span>](using-one-time-initialization.md)
</dt> </dl>

 

 
