---
description: Un objeto de sección crítica proporciona una sincronización similar a la que proporciona un objeto de exclusión mutua, salvo que solo los subprocesos de un único proceso pueden usar una sección crítica.
ms.assetid: 2ec11a42-3d12-4d60-9dd7-dc38926d56e1
title: Objetos de sección crítica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbcada1f2ddbc6d370445f36a3dbd51c5c9f54bf
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105667980"
---
# <a name="critical-section-objects"></a><span data-ttu-id="d3368-103">Objetos de sección crítica</span><span class="sxs-lookup"><span data-stu-id="d3368-103">Critical Section Objects</span></span>

<span data-ttu-id="d3368-104">Un *objeto de sección crítica* proporciona una sincronización similar a la que proporciona un objeto de exclusión mutua, salvo que solo los subprocesos de un único proceso pueden usar una sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-104">A *critical section object* provides synchronization similar to that provided by a mutex object, except that a critical section can be used only by the threads of a single process.</span></span> <span data-ttu-id="d3368-105">Los objetos de sección crítica no se pueden compartir entre los procesos.</span><span class="sxs-lookup"><span data-stu-id="d3368-105">Critical section objects cannot be shared across processes.</span></span>

<span data-ttu-id="d3368-106">Los objetos Event, mutex y Semaphore también se pueden usar en una aplicación de un solo proceso, pero los objetos de sección críticos proporcionan un mecanismo ligeramente más rápido y eficaz para la sincronización de exclusión mutua (una prueba específica del procesador y una instrucción set).</span><span class="sxs-lookup"><span data-stu-id="d3368-106">Event, mutex, and semaphore objects can also be used in a single-process application, but critical section objects provide a slightly faster, more efficient mechanism for mutual-exclusion synchronization (a processor-specific test and set instruction).</span></span> <span data-ttu-id="d3368-107">Al igual que un objeto mutex, un objeto de sección crítica solo puede ser propiedad de un subproceso cada vez, lo que resulta útil para proteger un recurso compartido de acceso simultáneo.</span><span class="sxs-lookup"><span data-stu-id="d3368-107">Like a mutex object, a critical section object can be owned by only one thread at a time, which makes it useful for protecting a shared resource from simultaneous access.</span></span> <span data-ttu-id="d3368-108">A diferencia de un objeto mutex, no hay ninguna manera de saber si se ha abandonado una sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-108">Unlike a mutex object, there is no way to tell whether a critical section has been abandoned.</span></span>

<span data-ttu-id="d3368-109">A partir de Windows Server 2003 con Service Pack 1 (SP1), los subprocesos que esperan en una sección crítica no adquieren la sección crítica en primer lugar, primero en dar de alta.</span><span class="sxs-lookup"><span data-stu-id="d3368-109">Starting with Windows Server 2003 with Service Pack 1 (SP1), threads waiting on a critical section do not acquire the critical section on a first-come, first-serve basis.</span></span> <span data-ttu-id="d3368-110">Este cambio aumenta significativamente el rendimiento de la mayoría de los códigos.</span><span class="sxs-lookup"><span data-stu-id="d3368-110">This change increases performance significantly for most code.</span></span> <span data-ttu-id="d3368-111">Sin embargo, algunas aplicaciones dependen del orden FIFO (el primero en aparecer es el primero en salir) y pueden tener un rendimiento deficiente o no en las versiones actuales de Windows (por ejemplo, las aplicaciones que han estado usando secciones críticas como límite de velocidad).</span><span class="sxs-lookup"><span data-stu-id="d3368-111">However, some applications depend on first-in, first-out (FIFO) ordering and may perform poorly or not at all on current versions of Windows (for example, applications that have been using critical sections as a rate-limiter).</span></span> <span data-ttu-id="d3368-112">Para asegurarse de que el código sigue funcionando correctamente, puede que tenga que agregar un nivel de sincronización adicional.</span><span class="sxs-lookup"><span data-stu-id="d3368-112">To ensure that your code continues to work correctly, you may need to add an additional level of synchronization.</span></span> <span data-ttu-id="d3368-113">Por ejemplo, supongamos que tiene un subproceso de productor y un subproceso de consumidor que usan un objeto de sección crítica para sincronizar su trabajo.</span><span class="sxs-lookup"><span data-stu-id="d3368-113">For example, suppose you have a producer thread and a consumer thread that are using a critical section object to synchronize their work.</span></span> <span data-ttu-id="d3368-114">Cree dos objetos de evento, uno para cada subproceso que se usará para indicar que está listo para que el otro subproceso continúe.</span><span class="sxs-lookup"><span data-stu-id="d3368-114">Create two event objects, one for each thread to use to signal that it is ready for the other thread to proceed.</span></span> <span data-ttu-id="d3368-115">El subproceso de consumidor esperará a que el productor señale su evento antes de entrar en la sección crítica, y el subproceso de productor esperará a que el subproceso de consumidor señale su evento antes de entrar en la sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-115">The consumer thread will wait for the producer to signal its event before entering the critical section, and the producer thread will wait for the consumer thread to signal its event before entering the critical section.</span></span> <span data-ttu-id="d3368-116">Una vez que cada subproceso abandona la sección crítica, indica a su evento que libere el otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="d3368-116">After each thread leaves the critical section, it signals its event to release the other thread.</span></span>

<span data-ttu-id="d3368-117">**Windows Server 2003 y Windows XP:** Los subprocesos que esperan en una sección crítica se agregan a una cola de espera; son reactivarán y generalmente adquieren la sección crítica en el orden en que se agregaron a la cola.</span><span class="sxs-lookup"><span data-stu-id="d3368-117">**Windows Server 2003 and Windows XP:** Threads that are waiting on a critical section are added to a wait queue; they are woken and generally acquire the critical section in the order in which they were added to the queue.</span></span> <span data-ttu-id="d3368-118">Sin embargo, si los subprocesos se agregan a esta cola a una velocidad lo suficientemente rápida, el rendimiento puede degradarse debido al tiempo que se tarda en reactivar cada subproceso en espera.</span><span class="sxs-lookup"><span data-stu-id="d3368-118">However, if threads are added to this queue at a fast enough rate, performance can be degraded because of the time it takes to awaken each waiting thread.</span></span>

<span data-ttu-id="d3368-119">El proceso es responsable de la asignación de la memoria usada por una sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-119">The process is responsible for allocating the memory used by a critical section.</span></span> <span data-ttu-id="d3368-120">Normalmente, esto se realiza simplemente declarando una variable de tipo **crítico \_**.</span><span class="sxs-lookup"><span data-stu-id="d3368-120">Typically, this is done by simply declaring a variable of type **CRITICAL\_SECTION**.</span></span> <span data-ttu-id="d3368-121">Antes de que los subprocesos del proceso puedan usarlo, inicialice la sección crítica mediante el uso de la función [**InitializeCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) o [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) .</span><span class="sxs-lookup"><span data-stu-id="d3368-121">Before the threads of the process can use it, initialize the critical section by using the [**InitializeCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) or [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) function.</span></span>

<span data-ttu-id="d3368-122">Un subproceso utiliza la función [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) o [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) para solicitar la propiedad de una sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-122">A thread uses the [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) or [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) function to request ownership of a critical section.</span></span> <span data-ttu-id="d3368-123">Usa la función [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) para liberar la propiedad de una sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-123">It uses the [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) function to release ownership of a critical section.</span></span> <span data-ttu-id="d3368-124">Si el objeto de sección crítica está siendo propiedad de otro subproceso, **EnterCriticalSection** espera indefinidamente a la propiedad.</span><span class="sxs-lookup"><span data-stu-id="d3368-124">If the critical section object is currently owned by another thread, **EnterCriticalSection** waits indefinitely for ownership.</span></span> <span data-ttu-id="d3368-125">En cambio, cuando se usa un objeto mutex para la exclusión mutua, las [funciones de espera](wait-functions.md) aceptan un intervalo de tiempo de espera especificado.</span><span class="sxs-lookup"><span data-stu-id="d3368-125">In contrast, when a mutex object is used for mutual exclusion, the [wait functions](wait-functions.md) accept a specified time-out interval.</span></span> <span data-ttu-id="d3368-126">La función **TryEnterCriticalSection** intenta entrar en una sección crítica sin bloquear el subproceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="d3368-126">The **TryEnterCriticalSection** function attempts to enter a critical section without blocking the calling thread.</span></span>

<span data-ttu-id="d3368-127">Cuando un subproceso posee una sección crítica, puede realizar llamadas adicionales a [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) o [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) sin bloquear su ejecución.</span><span class="sxs-lookup"><span data-stu-id="d3368-127">When a thread owns a critical section, it can make additional calls to [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) or [**TryEnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) without blocking its execution.</span></span> <span data-ttu-id="d3368-128">Esto evita que un subproceso se interbloquee a sí mismo mientras espera una sección crítica que ya posee.</span><span class="sxs-lookup"><span data-stu-id="d3368-128">This prevents a thread from deadlocking itself while waiting for a critical section that it already owns.</span></span> <span data-ttu-id="d3368-129">Para liberar su propiedad, el subproceso debe llamar a [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) una vez para cada vez que entró en la sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-129">To release its ownership, the thread must call [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) one time for each time that it entered the critical section.</span></span> <span data-ttu-id="d3368-130">No hay ninguna garantía sobre el orden en que los subprocesos en espera adquirirán la propiedad de la sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-130">There is no guarantee about the order in which waiting threads will acquire ownership of the critical section.</span></span>

<span data-ttu-id="d3368-131">Un subproceso utiliza la función [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) o [**SetCriticalSectionSpinCount**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) para especificar un recuento de giros para el objeto de sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-131">A thread uses the [**InitializeCriticalSectionAndSpinCount**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) or [**SetCriticalSectionSpinCount**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) function to specify a spin count for the critical section object.</span></span> <span data-ttu-id="d3368-132">Girar significa que cuando un subproceso intenta adquirir una sección crítica bloqueada, el subproceso entra en un bucle, comprueba si se libera el bloqueo y, si no se libera el bloqueo, el subproceso entra en suspensión.</span><span class="sxs-lookup"><span data-stu-id="d3368-132">Spinning means that when a thread tries to acquire a critical section that is locked, the thread enters a loop, checks to see if the lock is released, and if the lock is not released, the thread goes to sleep.</span></span> <span data-ttu-id="d3368-133">En los sistemas de un solo procesador, se omite el número de giros y el número de intentos de la sección crítica se establece en 0 (cero).</span><span class="sxs-lookup"><span data-stu-id="d3368-133">On single-processor systems, the spin count is ignored and the critical section spin count is set to 0 (zero).</span></span> <span data-ttu-id="d3368-134">En los sistemas multiprocesador, si la sección crítica no está disponible, el subproceso que realiza la llamada gira *dwSpinCount* veces antes de realizar una operación de espera en un semáforo que está asociado a la sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-134">On multiprocessor systems, if the critical section is unavailable, the calling thread spins *dwSpinCount* times before performing a wait operation on a semaphore that is associated with the critical section.</span></span> <span data-ttu-id="d3368-135">Si la sección crítica se vuelve gratuita durante la operación de giro, el subproceso que realiza la llamada evita la operación de espera.</span><span class="sxs-lookup"><span data-stu-id="d3368-135">If the critical section becomes free during the spin operation, the calling thread avoids the wait operation.</span></span>

<span data-ttu-id="d3368-136">Cualquier subproceso del proceso puede utilizar la función [**DeleteCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) para liberar los recursos del sistema que se asignan cuando se inicializa el objeto de sección crítica.</span><span class="sxs-lookup"><span data-stu-id="d3368-136">Any thread of the process can use the [**DeleteCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) function to release the system resources that are allocated when the critical section object is initialized.</span></span> <span data-ttu-id="d3368-137">Después de llamar a esta función, no se puede usar el objeto de sección crítica para la sincronización.</span><span class="sxs-lookup"><span data-stu-id="d3368-137">After this function is called, the critical section object cannot be used for synchronization.</span></span>

<span data-ttu-id="d3368-138">Cuando un objeto de sección crítica es propiedad, solo los demás subprocesos afectados son los subprocesos que están a la espera de ser propiedad en una llamada a [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection).</span><span class="sxs-lookup"><span data-stu-id="d3368-138">When a critical section object is owned, the only other threads affected are the threads that are waiting for ownership in a call to [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection).</span></span> <span data-ttu-id="d3368-139">Los subprocesos que no están en espera pueden continuar ejecutándose.</span><span class="sxs-lookup"><span data-stu-id="d3368-139">Threads that are not waiting are free to continue running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d3368-140">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d3368-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d3368-141">Objetos mutex</span><span class="sxs-lookup"><span data-stu-id="d3368-141">Mutex Objects</span></span>](mutex-objects.md)
</dt> <dt>

[<span data-ttu-id="d3368-142">Usar objetos de sección crítica</span><span class="sxs-lookup"><span data-stu-id="d3368-142">Using Critical Section Objects</span></span>](using-critical-section-objects.md)
</dt> </dl>

 

 
