---
title: Sondeo de cambios mediante USNChanged
description: Los cambios de Active Directory también se pueden obtener consultando el atributo uSNChanged, lo que evita las limitaciones del control DirSync.
ms.assetid: 83bda359-09e5-4abf-8f60-9c63bccfcdd1
ms.tgt_platform: multiple
keywords:
- Sondeo de cambios con USNChanged AD
- De USNChanged AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8e062c84fae575f837f45d78be7c92e5e284c1e
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "103904482"
---
# <a name="polling-for-changes-using-usnchanged"></a><span data-ttu-id="32bfe-105">Sondeo de cambios mediante USNChanged</span><span class="sxs-lookup"><span data-stu-id="32bfe-105">Polling for Changes Using USNChanged</span></span>

<span data-ttu-id="32bfe-106">El control DirSync es eficaz y eficaz, pero tiene dos limitaciones importantes:</span><span class="sxs-lookup"><span data-stu-id="32bfe-106">The DirSync control is powerful and efficient, but has two significant limitations:</span></span>

-   <span data-ttu-id="32bfe-107">Solo para aplicaciones con privilegios elevados: para usar el control DirSync, una aplicación se debe ejecutar en una cuenta que tenga el privilegio de **\_ nombre del \_ agente \_ de sincronización se** en el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-107">Only for highly privileged applications: To use the DirSync control, an application must run under an account that has the **SE\_SYNC\_AGENT\_NAME** privilege on the domain controller.</span></span> <span data-ttu-id="32bfe-108">Hay pocas cuentas con privilegios elevados, por lo que los usuarios normales no pueden ejecutar una aplicación que use el control DirSync.</span><span class="sxs-lookup"><span data-stu-id="32bfe-108">Few accounts are so highly privileged, so an application that uses the DirSync control cannot be run by ordinary users.</span></span>
-   <span data-ttu-id="32bfe-109">Sin ámbito de subárbol: el control DirSync devuelve todos los cambios que se producen en un contexto de nomenclatura.</span><span class="sxs-lookup"><span data-stu-id="32bfe-109">No subtree scoping: The DirSync control returns all changes that occur within a naming context.</span></span> <span data-ttu-id="32bfe-110">Una aplicación interesada solo en los cambios que se producen en un pequeño subárbol de un contexto de nomenclatura debe examinar muchos cambios irrelevantes, lo que es ineficaz tanto para la aplicación como para el controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-110">An application interested only in changes that occur in a small subtree of a naming context must wade through many irrelevant changes, which is inefficient both for the application and for the domain controller.</span></span>

<span data-ttu-id="32bfe-111">Los cambios de Active Directory también se pueden obtener consultando el atributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) , lo que evita las limitaciones del control DirSync.</span><span class="sxs-lookup"><span data-stu-id="32bfe-111">Changes from Active Directory can also be obtained by querying the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute, which avoids the limitations of the DirSync control.</span></span> <span data-ttu-id="32bfe-112">Esta alternativa no es mejor que el control DirSync en todos los aspectos porque implica la transmisión de todos los atributos cuando cambia cualquier atributo y requiere más trabajo del desarrollador de la aplicación para administrar correctamente determinados escenarios de error.</span><span class="sxs-lookup"><span data-stu-id="32bfe-112">This alternative is not better than the DirSync control in all respects because it involves transmitting all attributes when any attribute changes and it requires more work from the application developer to handle certain failure scenarios correctly.</span></span> <span data-ttu-id="32bfe-113">Actualmente, es la mejor manera de escribir ciertas aplicaciones de seguimiento de cambios.</span><span class="sxs-lookup"><span data-stu-id="32bfe-113">It is, currently, the best way to write certain change-tracking applications.</span></span>

<span data-ttu-id="32bfe-114">Cuando un controlador de dominio modifica un objeto, establece el atributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) del objeto en un valor mayor que el valor anterior del atributo **uSNChanged** para ese objeto, y mayor que el valor actual del atributo **uSNChanged** para todos los demás objetos contenidos en ese controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-114">When a domain controller modifies an object it sets that object's [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute to a value that is larger than the previous value of the **uSNChanged** attribute for that object, and larger than the current value of the **uSNChanged** attribute for all other objects held on that domain controller.</span></span> <span data-ttu-id="32bfe-115">Como consecuencia, una aplicación puede encontrar el objeto modificado más recientemente en un controlador de dominio buscando el objeto con el valor de **uSNChanged** más grande.</span><span class="sxs-lookup"><span data-stu-id="32bfe-115">As a consequence, an application can find the most recently changed object on a domain controller by finding the object with the largest **uSNChanged** value.</span></span> <span data-ttu-id="32bfe-116">El segundo objeto modificado más recientemente en un controlador de dominio tendrá el segundo valor de **uSNChanged** más grande, y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="32bfe-116">The second most recently changed object on a domain controller will have the second largest **uSNChanged** value, and so on.</span></span>

<span data-ttu-id="32bfe-117">El atributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) no se replica, por lo que al leer el atributo **uSNChanged** de un objeto en dos controladores de dominio diferentes, normalmente se proporcionan valores distintos.</span><span class="sxs-lookup"><span data-stu-id="32bfe-117">The [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute is not replicated, therefore reading an object's **uSNChanged** attribute at two different domain controllers will typically give different values.</span></span>

<span data-ttu-id="32bfe-118">Por ejemplo, el atributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) se puede usar para realizar el seguimiento de los cambios en un subárbol S. En primer lugar, realice una sincronización completa de los subárboles S. Supongamos que el valor de **uSNChanged** más grande para cualquier objeto en S es U. consulte periódicamente todos los objetos de subárbol s cuyo valor de **uSNChanged** sea mayor que U. La consulta devolverá todos los objetos que han cambiado desde la sincronización completa. Establézcalo en el valor de **uSNChanged** más grande entre estos objetos modificados y esté listo para volver a sondear.</span><span class="sxs-lookup"><span data-stu-id="32bfe-118">For example, the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute can be used to track changes in a subtree S. First, perform a "full sync" of the subtree S. Suppose the largest **uSNChanged** value for any object in S is U. Periodically query for all objects in subtree S whose **uSNChanged** value is greater than U. The query will return all objects that have changed since the full sync. Set U to the largest **uSNChanged** among these changed objects, and you are ready to poll again.</span></span>

<span data-ttu-id="32bfe-119">Los matices de la implementación de una aplicación de sincronización de [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) incluyen:</span><span class="sxs-lookup"><span data-stu-id="32bfe-119">The subtleties of implementing a [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) synchronization application include:</span></span>

-   <span data-ttu-id="32bfe-120">Use el atributo **highestCommittedUSN,** de RootDSE para enlazar los filtros de [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) .</span><span class="sxs-lookup"><span data-stu-id="32bfe-120">Use the **highestCommittedUSN** attribute of rootDSE to bound your [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) filters.</span></span> <span data-ttu-id="32bfe-121">Es decir, antes de iniciar una sincronización completa, lea el **highestCommittedUSN,** del controlador de dominio asociado.</span><span class="sxs-lookup"><span data-stu-id="32bfe-121">That is, before starting a full sync, read the **highestCommittedUSN** of your affiliated domain controller.</span></span> <span data-ttu-id="32bfe-122">A continuación, realice una consulta de sincronización completa (con los resultados paginados) para inicializar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="32bfe-122">Then, perform a full synchronization query (using paged results) to initialize the database.</span></span> <span data-ttu-id="32bfe-123">Cuando haya finalizado, almacene el valor **highestCommittedUSN,** leído antes de la consulta de sincronización completa. para utilizar como límite inferior del atributo **uSNChanged** para la siguiente sincronización.</span><span class="sxs-lookup"><span data-stu-id="32bfe-123">When this is complete, store the **highestCommittedUSN** value read before the full sync query; to use as the lower bounds of the **uSNChanged** attribute for the next synchronization.</span></span> <span data-ttu-id="32bfe-124">Más adelante, para realizar una sincronización incremental, relea el atributo RootDSE de **highestCommittedUSN,** .</span><span class="sxs-lookup"><span data-stu-id="32bfe-124">Later, to perform an incremental synchronization, reread the **highestCommittedUSN** rootDSE attribute.</span></span> <span data-ttu-id="32bfe-125">A continuación, consulte los objetos pertinentes, con los resultados paginados, cuyo **uSNChanged** es mayor que los límites inferiores del valor del atributo **uSNChanged** guardado de la sincronización anterior.</span><span class="sxs-lookup"><span data-stu-id="32bfe-125">Then query for relevant objects, using paged results, whose **uSNChanged** is greater than the lower bounds of the **uSNChanged** attribute value saved from the previous synchronization.</span></span> <span data-ttu-id="32bfe-126">Actualice la base de datos con esta información.</span><span class="sxs-lookup"><span data-stu-id="32bfe-126">Update the database using this information.</span></span> <span data-ttu-id="32bfe-127">Cuando termine, actualice los límites inferiores del atributo **uSNChanged** desde el valor **highestCommittedUSN,** leído antes de la consulta de sincronización incremental.</span><span class="sxs-lookup"><span data-stu-id="32bfe-127">When complete, update the lower bounds of the **uSNChanged** attribute from the **highestCommittedUSN** value read before the incremental synchronization query.</span></span> <span data-ttu-id="32bfe-128">Almacene siempre los límites inferiores del valor del atributo **uSNChanged** en el mismo almacenamiento que la aplicación está sincronizando con el contenido del controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-128">Always store the lower bounds of the **uSNChanged** attribute value in the same storage that the application is synchronizing with the domain controller content.</span></span>

    <span data-ttu-id="32bfe-129">Al seguir este procedimiento, en lugar de basarse en valores de [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) en objetos recuperados, se evita que el servidor Revise los objetos actualizados que se encuentran fuera del conjunto que es aplicable a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="32bfe-129">Following this procedure, rather than that based on [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) values on retrieved objects, avoids making the server reexamine updated objects that fall outside the set that is applicable to the application.</span></span>

-   <span data-ttu-id="32bfe-130">Dado que [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) es un atributo no replicado, la aplicación debe enlazarse al mismo controlador de dominio cada vez que se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="32bfe-130">Because [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) is a non-replicated attribute, the application must bind to the same domain controller every time it runs.</span></span> <span data-ttu-id="32bfe-131">Si no se puede enlazar a ese controlador de dominio, debe esperar hasta que pueda hacerlo, o afiliar con algún nuevo controlador de dominio y realizar una sincronización completa con ese controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-131">If it cannot bind to that domain controller it must either wait until it can do so, or affiliate with some new domain controller and perform a full synchronization with that domain controller.</span></span> <span data-ttu-id="32bfe-132">Cuando la aplicación se afilia con un controlador de dominio, registra el nombre DNS de ese controlador de dominio en un almacenamiento estable, que es el mismo almacenamiento que mantiene coherente con el contenido del controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-132">When the application affiliates with a domain controller it records the DNS name of that domain controller in stable storage, which is the same storage it is keeping consistent with the domain controller content.</span></span> <span data-ttu-id="32bfe-133">A continuación, usa el nombre DNS almacenado para enlazar al mismo controlador de dominio para las sincronizaciones posteriores.</span><span class="sxs-lookup"><span data-stu-id="32bfe-133">Then it uses the stored DNS name to bind to the same domain controller for subsequent synchronizations.</span></span>
-   <span data-ttu-id="32bfe-134">La aplicación debe detectar cuándo se ha restaurado la copia de seguridad del controlador de dominio al que está afiliada actualmente, ya que esto puede provocar incoherencias.</span><span class="sxs-lookup"><span data-stu-id="32bfe-134">The application must detect when the domain controller it is currently affiliated with has been restored from backup, because this can cause inconsistency.</span></span> <span data-ttu-id="32bfe-135">Cuando la aplicación se asocia con un controlador de dominio, almacena en caché el "ID. de invocación" de ese controlador de dominio en almacenamiento estable, es decir, el mismo almacenamiento que mantiene coherente con el contenido del controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-135">When the application affiliates with a domain controller it caches the "invocation id" of that domain controller in stable storage, that is, the same storage it is keeping consistent with the domain controller content.</span></span> <span data-ttu-id="32bfe-136">El "identificador de invocación" de un controlador de dominio es un GUID almacenado en **el atributo de invocación del** objeto de servicio del controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-136">The "invocation id" of a domain controller is a GUID stored in the **invocationID** attribute of the domain controller's service object.</span></span> <span data-ttu-id="32bfe-137">Para obtener el nombre distintivo del objeto de servicio de un controlador de dominio, lea el atributo **dsServiceName** de RootDSE.</span><span class="sxs-lookup"><span data-stu-id="32bfe-137">To get the distinguished name of a domain controller's service object, read the **dsServiceName** attribute of the rootDSE.</span></span>

    <span data-ttu-id="32bfe-138">Tenga en cuenta que cuando el almacenamiento estable de la aplicación se restaura desde una copia de seguridad, no hay ningún problema de coherencia porque el nombre del controlador de dominio, el ID. de invocación y los límites inferiores del valor del atributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) se almacenan con los datos sincronizados con el contenido del controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-138">Be aware that when the application's stable storage is restored from backup there are no consistency problems because the domain controller name, invocation id, and lower bounds of the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute value are stored with the data synchronized with the domain controller content.</span></span>

-   <span data-ttu-id="32bfe-139">Use la paginación al consultar el servidor, tanto las sincronizaciones completas como incrementales, para evitar la posibilidad de recuperar grandes conjuntos de resultados simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="32bfe-139">Use paging when querying the server, both full and incremental synchronizations, to avoid the possibility of retrieving large result sets simultaneously.</span></span> <span data-ttu-id="32bfe-140">Para obtener más información, vea [especificar otras opciones de búsqueda](specifying-other-search-options.md).</span><span class="sxs-lookup"><span data-stu-id="32bfe-140">For more information, see [Specifying Other Search Options](specifying-other-search-options.md).</span></span>
-   <span data-ttu-id="32bfe-141">Realice consultas basadas en índices para evitar obligar al servidor a almacenar resultados intermedios grandes al usar resultados paginados.</span><span class="sxs-lookup"><span data-stu-id="32bfe-141">Perform index-based queries to avoid forcing the server to store large intermediate results when using paged results.</span></span> <span data-ttu-id="32bfe-142">Para obtener más información, vea [atributos indexados](indexed-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="32bfe-142">For more information, see [Indexed Attributes](indexed-attributes.md).</span></span>
-   <span data-ttu-id="32bfe-143">En general, no use la ordenación del lado servidor de los resultados de la búsqueda, lo que puede obligar al servidor a almacenar y ordenar resultados intermedios grandes.</span><span class="sxs-lookup"><span data-stu-id="32bfe-143">In general, do not use server-side sorting of search results, which can force the server to store and sort large intermediate results.</span></span> <span data-ttu-id="32bfe-144">Esto se aplica a las sincronizaciones completas e incrementales.</span><span class="sxs-lookup"><span data-stu-id="32bfe-144">This applies to both full and incremental synchronizations.</span></span> <span data-ttu-id="32bfe-145">Para obtener más información, vea [especificar otras opciones de búsqueda](specifying-other-search-options.md).</span><span class="sxs-lookup"><span data-stu-id="32bfe-145">For more information, see [Specifying Other Search Options](specifying-other-search-options.md).</span></span>
-   <span data-ttu-id="32bfe-146">No controlar correctamente las condiciones de los elementos primarios.</span><span class="sxs-lookup"><span data-stu-id="32bfe-146">Handle no parent conditions gracefully.</span></span> <span data-ttu-id="32bfe-147">La aplicación puede reconocer un objeto antes de que haya reconocido su elemento primario.</span><span class="sxs-lookup"><span data-stu-id="32bfe-147">The application may recognize an object before it has recognized its parent.</span></span> <span data-ttu-id="32bfe-148">En función de la aplicación, esto puede ser o no un problema.</span><span class="sxs-lookup"><span data-stu-id="32bfe-148">Depending upon the application, this may or may not be a problem.</span></span> <span data-ttu-id="32bfe-149">La aplicación siempre puede leer el estado actual del elemento primario desde el directorio.</span><span class="sxs-lookup"><span data-stu-id="32bfe-149">The application can always read the current state of the parent from the directory.</span></span>
-   <span data-ttu-id="32bfe-150">Para controlar los objetos que se han descargado o eliminado, almacene el atributo [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) de cada objeto sometido a seguimiento.</span><span class="sxs-lookup"><span data-stu-id="32bfe-150">To handle moved or deleted objects, store the [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) attribute of each tracked object.</span></span> <span data-ttu-id="32bfe-151">El atributo **objectGUID** de un objeto permanece sin modificar, independientemente de dónde se mueva en todo el bosque.</span><span class="sxs-lookup"><span data-stu-id="32bfe-151">An object's **objectGUID** attribute remains unchanged regardless of where it is moved throughout the forest.</span></span>
-   <span data-ttu-id="32bfe-152">Para controlar los objetos que se han descargado, realice sincronizaciones completas periódicas o aumente el ámbito de búsqueda y filtre los cambios que no interesen en el cliente.</span><span class="sxs-lookup"><span data-stu-id="32bfe-152">To handle moved objects, either perform periodic full synchronizations or increase the search scope and filter out uninteresting changes at the client end.</span></span>
-   <span data-ttu-id="32bfe-153">Para controlar los objetos eliminados, realice sincronizaciones completas periódicas o realice una búsqueda independiente de los objetos eliminados cuando realice una sincronización incremental.</span><span class="sxs-lookup"><span data-stu-id="32bfe-153">To handle deleted objects, either perform periodic full synchronizations or perform a separate search for deleted objects when you perform an incremental synchronization.</span></span> <span data-ttu-id="32bfe-154">Al consultar los objetos eliminados, recupere el [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) de los objetos eliminados para determinar los objetos que se van a eliminar de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="32bfe-154">When you query for deleted objects, retrieve the [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) of the deleted objects to determine the objects to delete from your database.</span></span> <span data-ttu-id="32bfe-155">Para obtener más información, vea [recuperar objetos eliminados](retrieving-deleted-objects.md).</span><span class="sxs-lookup"><span data-stu-id="32bfe-155">For more information, see [Retrieving Deleted Objects](retrieving-deleted-objects.md).</span></span>
-   <span data-ttu-id="32bfe-156">Tenga en cuenta que los resultados de la búsqueda incluyen solo los objetos y atributos que el autor de la llamada tiene permiso para leer (en función de los descriptores de seguridad y las DACL en los distintos objetos).</span><span class="sxs-lookup"><span data-stu-id="32bfe-156">Be aware that the search results include only the objects and attributes that the caller has permission to read (based on the security descriptors and DACLs on the various objects).</span></span> <span data-ttu-id="32bfe-157">Para obtener más información, vea [efectos de la seguridad en las consultas](effects-of-security-on-queries.md).</span><span class="sxs-lookup"><span data-stu-id="32bfe-157">For more information, see [Effects of Security on Queries](effects-of-security-on-queries.md).</span></span>

<span data-ttu-id="32bfe-158">Para obtener más información y un ejemplo de código que muestra los conceptos básicos de una aplicación de sincronización de USNChanged, vea el [código de ejemplo para recuperar los cambios mediante USNChanged](example-code-to-retrieve-changes-using-usnchanged.md).</span><span class="sxs-lookup"><span data-stu-id="32bfe-158">For more information, and a code example that shows the basics of a USNChanged synchronization application, see [Example Code to Retrieve Changes Using USNChanged](example-code-to-retrieve-changes-using-usnchanged.md).</span></span>

 

 