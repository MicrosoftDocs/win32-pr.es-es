---
title: Licencias y IClassFactory2
description: Licencias y IClassFactory2
ms.assetid: 2bead555-8c62-4f48-a4c6-6f0942ec75f8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9376d5187588ba14da434161309409bf1d189a8f
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/21/2020
ms.locfileid: "104421467"
---
# <a name="licensing-and-iclassfactory2"></a><span data-ttu-id="a87a1-103">Licencias y IClassFactory2</span><span class="sxs-lookup"><span data-stu-id="a87a1-103">Licensing and IClassFactory2</span></span>

<span data-ttu-id="a87a1-104">La interfaz [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) en un objeto de clase proporciona el mecanismo básico de creación de objetos de com.</span><span class="sxs-lookup"><span data-stu-id="a87a1-104">The [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) interface on a class object provides the basic object creation mechanism of COM.</span></span> <span data-ttu-id="a87a1-105">Con **IClassFactory**, un servidor puede controlar la creación de objetos en un equipo.</span><span class="sxs-lookup"><span data-stu-id="a87a1-105">Using **IClassFactory**, a server can control object creation on a machine basis.</span></span> <span data-ttu-id="a87a1-106">La implementación del método [**IClassFactory:: CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) puede permitir o impedir la creación de objetos en función de la existencia de una licencia de equipo.</span><span class="sxs-lookup"><span data-stu-id="a87a1-106">The implementation of the [**IClassFactory::CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) method can allow or disallow object creation based on the existence of a machine license.</span></span> <span data-ttu-id="a87a1-107">Una licencia de equipo es un fragmento de información independiente de la aplicación que existe en un equipo para indicar que el software se instaló desde un origen válido, como los discos de instalación del proveedor.</span><span class="sxs-lookup"><span data-stu-id="a87a1-107">A machine license is a piece of information separate from the application that exists on a machine to indicate that the software was installed from a valid source, such as the vendor's installation disks.</span></span> <span data-ttu-id="a87a1-108">Si la licencia de la máquina no existe, el servidor puede impedir la creación de objetos.</span><span class="sxs-lookup"><span data-stu-id="a87a1-108">If the machine license does not exist, the server can disallow object creation.</span></span> <span data-ttu-id="a87a1-109">Las licencias de equipo evitan la piratería en los casos en los que un usuario intenta copiar el software de un equipo a otro, ya que la información de licencia no se copia con el software y el equipo que recibe la copia no tiene licencia.</span><span class="sxs-lookup"><span data-stu-id="a87a1-109">Machine licensing prevents piracy in cases where a user attempts to copy the software from one machine to another, because the license information is not copied with the software and the machine that receives the copy is not licensed.</span></span>

<span data-ttu-id="a87a1-110">Sin embargo, en un sector del software de componentes, los proveedores necesitan un nivel de control más preciso sobre las licencias.</span><span class="sxs-lookup"><span data-stu-id="a87a1-110">However, in a component software industry, vendors need a finer level of control over licensing.</span></span> <span data-ttu-id="a87a1-111">Además del control de licencias por equipo, un proveedor debe permitir que algunos clientes creen un objeto de componente mientras se deniega a otros clientes la misma funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="a87a1-111">In addition to machine license control, a vendor needs to allow some clients to create a component object while denying other clients the same capability.</span></span> <span data-ttu-id="a87a1-112">Esto requiere que la aplicación cliente obtenga una clave de licencia del componente mientras la aplicación cliente todavía está en desarrollo.</span><span class="sxs-lookup"><span data-stu-id="a87a1-112">This requires that the client application obtain a license key from the component while the client application is still under development.</span></span> <span data-ttu-id="a87a1-113">La aplicación cliente utiliza la clave de licencia en tiempo de ejecución para crear objetos en una máquina sin licencia.</span><span class="sxs-lookup"><span data-stu-id="a87a1-113">The client application uses the license key at run time to create objects on an unlicensed machine.</span></span>

<span data-ttu-id="a87a1-114">Por ejemplo, si un proveedor proporciona una biblioteca de controles a los desarrolladores, el desarrollador que compra la biblioteca tendrá una licencia completa de equipo, lo que permite crear los objetos en el equipo de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="a87a1-114">For example, if a vendor provides a library of controls to developers, the developer who purchases the library will have a full machine license, allowing the objects to be created on the development machine.</span></span> <span data-ttu-id="a87a1-115">A continuación, el desarrollador puede compilar una aplicación cliente en el equipo con licencia que incorpore uno o varios de los controles.</span><span class="sxs-lookup"><span data-stu-id="a87a1-115">The developer can then build a client application on the licensed machine incorporating one or more of the controls.</span></span> <span data-ttu-id="a87a1-116">Cuando la aplicación cliente resultante se ejecuta en otro equipo, los controles usados en la aplicación cliente deben crearse en el otro equipo, incluso si ese equipo no posee una licencia de equipo para los controles del proveedor original.</span><span class="sxs-lookup"><span data-stu-id="a87a1-116">When the resulting client application is run on another machine, the controls used in the client application must be created on the other machine even if that machine does not possess a machine license for the controls from the original vendor.</span></span>

<span data-ttu-id="a87a1-117">La interfaz [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) proporciona este nivel de control.</span><span class="sxs-lookup"><span data-stu-id="a87a1-117">The [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) interface provides this level of control.</span></span> <span data-ttu-id="a87a1-118">Para permitir las licencias basadas en claves para cualquier componente determinado, implemente **IClassFactory2** en el objeto de generador de clases para ese componente.</span><span class="sxs-lookup"><span data-stu-id="a87a1-118">To allow key-based licensing for any given component, you implement **IClassFactory2** on the class factory object for that component.</span></span> <span data-ttu-id="a87a1-119">**IClassFactory2** se deriva de [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory), por lo que al implementar **IClassFactory2**, el objeto de generador de clases cumple los requisitos básicos de com.</span><span class="sxs-lookup"><span data-stu-id="a87a1-119">**IClassFactory2** is derived from [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory), so by implementing **IClassFactory2**, the class factory object fulfills the basic COM requirements.</span></span>

<span data-ttu-id="a87a1-120">Para incorporar un componente con licencia en la aplicación cliente, use los métodos siguientes en [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2):</span><span class="sxs-lookup"><span data-stu-id="a87a1-120">To incorporate a licensed component into your client application, use the following methods in [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2):</span></span>

-   <span data-ttu-id="a87a1-121">El método [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) rellena una estructura [**LICINFO**](/windows/win32/api/ocidl/ns-ocidl-licinfo) con información que describe el comportamiento de las licencias del generador de clases.</span><span class="sxs-lookup"><span data-stu-id="a87a1-121">The [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) method fills a [**LICINFO**](/windows/win32/api/ocidl/ns-ocidl-licinfo) structure with information describing the licensing behavior of the class factory.</span></span> <span data-ttu-id="a87a1-122">Por ejemplo, el generador de clases puede proporcionar claves de licencia para las licencias en tiempo de ejecución si el miembro **fRunTimeKeyAvail** es **true**.</span><span class="sxs-lookup"><span data-stu-id="a87a1-122">For example, the class factory can provide license keys for run-time licensing if the **fRunTimeKeyAvail** member is **TRUE**.</span></span>
-   <span data-ttu-id="a87a1-123">El método [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) proporciona una clave de licencia para el componente.</span><span class="sxs-lookup"><span data-stu-id="a87a1-123">The [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) method provides a license key for the component.</span></span> <span data-ttu-id="a87a1-124">Una licencia de equipo debe estar disponible cuando el cliente llama a este método.</span><span class="sxs-lookup"><span data-stu-id="a87a1-124">A machine license must be available when the client calls this method.</span></span>
-   <span data-ttu-id="a87a1-125">El método [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) crea una instancia del componente con licencia si el parámetro de clave de licencia (BSTRÂ bstrKey) es válido.</span><span class="sxs-lookup"><span data-stu-id="a87a1-125">The [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) method creates an instance of the licensed component if the license key parameter (BSTRÂ bstrKey) is valid.</span></span>

> [!Note]  
> <span data-ttu-id="a87a1-126">En su información de tipo, un componente utiliza el atributo con licencia para marcar la coclase que admite las licencias a través de [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2).</span><span class="sxs-lookup"><span data-stu-id="a87a1-126">In its type information, a component uses the attribute licensed to mark the coclass that supports licensing through [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2).</span></span>

 

<span data-ttu-id="a87a1-127">En primer lugar, necesita una herramienta de desarrollo independiente que sea también un cliente del componente con licencia.</span><span class="sxs-lookup"><span data-stu-id="a87a1-127">First, you need a separate development tool that is also a client of the licensed component.</span></span> <span data-ttu-id="a87a1-128">El propósito de esta herramienta es obtener la clave de licencia en tiempo de ejecución y guardarla en la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="a87a1-128">The purpose of this tool is to obtain the run-time license key and save it in your client application.</span></span> <span data-ttu-id="a87a1-129">Esta herramienta solo se ejecuta en un equipo que posee una licencia de equipo para el componente.</span><span class="sxs-lookup"><span data-stu-id="a87a1-129">This tool runs only on a machine that possesses a machine license for the component.</span></span> <span data-ttu-id="a87a1-130">La herramienta llama a los métodos [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) y [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) para obtener la clave de licencia en tiempo de ejecución y, a continuación, guarda la clave de licencia en la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="a87a1-130">The tool calls the [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) and [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) methods to obtain the run-time license key and then saves the license key in your client application.</span></span> <span data-ttu-id="a87a1-131">Por ejemplo, la herramienta de desarrollo puede crear un archivo de encabezado (. h) que contenga la clave de licencia BSTR y, a continuación, incluiría ese archivo. h en la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="a87a1-131">For example, the development tool could create a header (.h) file containing the BSTR license key, and then you would include that .h file in your client application.</span></span>

<span data-ttu-id="a87a1-132">Para crear una instancia del componente en la aplicación cliente, primero intente crear una instancia del objeto directamente con [**IClassFactory:: CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance).</span><span class="sxs-lookup"><span data-stu-id="a87a1-132">To instantiate the component within your client application, first try to instantiate the object directly with [**IClassFactory::CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance).</span></span> <span data-ttu-id="a87a1-133">Si **CreateInstance** se realiza correctamente, la segunda máquina tiene licencia para el componente y los objetos se pueden crear en.</span><span class="sxs-lookup"><span data-stu-id="a87a1-133">If **CreateInstance** succeeds, the second machine is licensed for the component and objects can be created at will.</span></span> <span data-ttu-id="a87a1-134">Si se produce un error en **CreateInstance** con la clase de código de retorno \_ E \_ NOTLICENSED, la única manera de crear el objeto es pasar la clave de tiempo de ejecución al método [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) .</span><span class="sxs-lookup"><span data-stu-id="a87a1-134">If **CreateInstance** fails with the return code CLASS\_E\_NOTLICENSED, the only way to create the object is to pass the run-time key to the [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) method.</span></span> <span data-ttu-id="a87a1-135">**CreateInstanceLic** comprueba la clave y crea el objeto si la clave es válida.</span><span class="sxs-lookup"><span data-stu-id="a87a1-135">**CreateInstanceLic** verifies the key and creates the object if the key is valid.</span></span>

<span data-ttu-id="a87a1-136">De esta manera, una aplicación compilada con componentes (como controles) se puede ejecutar en un equipo que no tiene ninguna otra licencia; solo la aplicación cliente que contiene la licencia en tiempo de ejecución puede crear los objetos de componente en cuestión.</span><span class="sxs-lookup"><span data-stu-id="a87a1-136">In this way, an application built with components (such as controls) can run on a machine that has no other license—only the client application containing the run-time license is allowed to create the component objects in question.</span></span>

<span data-ttu-id="a87a1-137">La interfaz [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) admite la flexibilidad en los esquemas de licencias.</span><span class="sxs-lookup"><span data-stu-id="a87a1-137">The [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) interface supports flexibility in licensing schemes.</span></span> <span data-ttu-id="a87a1-138">Por ejemplo, el implementador del servidor puede cifrar las claves de licencia en el componente para mayor seguridad.</span><span class="sxs-lookup"><span data-stu-id="a87a1-138">For example, the server implementor can encrypt license keys in the component for added security.</span></span> <span data-ttu-id="a87a1-139">Los implementadores de servidor también pueden habilitar o deshabilitar niveles de funcionalidad en sus objetos proporcionando diferentes claves de licencia para distintas funciones.</span><span class="sxs-lookup"><span data-stu-id="a87a1-139">Server implementers can also enable or disable levels of functionality in their objects by providing different license keys for different functions.</span></span> <span data-ttu-id="a87a1-140">Por ejemplo, una clave podría permitir un nivel básico de funcionalidad mientras que otra permite la funcionalidad básica y avanzada, etc.</span><span class="sxs-lookup"><span data-stu-id="a87a1-140">For example, one key might allow a base level of functionality while another allows basic and advanced functionality, and so on.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a87a1-141">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="a87a1-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a87a1-142">Responsabilidades del servidor COM</span><span class="sxs-lookup"><span data-stu-id="a87a1-142">COM Server Responsibilities</span></span>](com-server-responsibilities.md)
</dt> </dl>

 

 