---
description: El usuario comienza a iniciar sesión en la red escribiendo un nombre de inicio de sesión y una contraseña. El cliente Kerberos de la estación de trabajo del usuario convierte la contraseña en una clave de cifrado y guarda el resultado en una variable de programa.
ms.assetid: fcb3b601-9953-474c-9a08-1fa25706f3d7
title: Intercambio del servicio de autenticación
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c14121ed33ae0ac169c590b03dfb0b395306d11f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105648467"
---
# <a name="authentication-service-exchange"></a><span data-ttu-id="efa10-104">Intercambio del servicio de autenticación</span><span class="sxs-lookup"><span data-stu-id="efa10-104">Authentication Service Exchange</span></span>

<span data-ttu-id="efa10-105">El usuario comienza a iniciar sesión en la red escribiendo un nombre de inicio de sesión y una contraseña.</span><span class="sxs-lookup"><span data-stu-id="efa10-105">The user begins logging on to the network by typing a logon name and password.</span></span> <span data-ttu-id="efa10-106">El cliente [*Kerberos*](/windows/desktop/SecGloss/k-gly) de la estación de trabajo del usuario convierte la contraseña en una clave de cifrado y guarda el resultado en una variable de programa.</span><span class="sxs-lookup"><span data-stu-id="efa10-106">The [*Kerberos*](/windows/desktop/SecGloss/k-gly) client on the user's workstation converts the password to an encryption key and saves the result in a program variable.</span></span>

<span data-ttu-id="efa10-107">A continuación, el cliente solicita [*las credenciales*](/windows/desktop/SecGloss/c-gly) para el servicio de concesión de vales (TGS) del [*centro de distribución de claves*](/windows/desktop/SecGloss/k-gly) (KDC) mediante el envío del servicio de autenticación del KDC a un mensaje de tipo KRB \_ como \_ req (solicitud del servicio de autenticación de Kerberos).</span><span class="sxs-lookup"><span data-stu-id="efa10-107">The client then requests [*credentials*](/windows/desktop/SecGloss/c-gly) for the ticket-granting service (TGS) of the [*Key Distribution Center*](/windows/desktop/SecGloss/k-gly) (KDC) by sending the KDC's authentication service a message of type KRB\_AS\_REQ (Kerberos Authentication Service Request).</span></span> <span data-ttu-id="efa10-108">La primera parte de este mensaje identifica al usuario y al servicio TGS que se solicita.</span><span class="sxs-lookup"><span data-stu-id="efa10-108">The first part of this message identifies the user and the TGS service being requested.</span></span> <span data-ttu-id="efa10-109">La segunda parte de este mensaje contiene datos de autenticación previa para demostrar que el usuario conoce la contraseña.</span><span class="sxs-lookup"><span data-stu-id="efa10-109">The second part of this message contains preauthentication data intended to prove that the user knows the password.</span></span> <span data-ttu-id="efa10-110">Esto es simplemente un mensaje de autenticador que se cifra con la [*clave maestra*](/windows/desktop/SecGloss/m-gly) derivada de la contraseña de inicio de sesión del usuario.</span><span class="sxs-lookup"><span data-stu-id="efa10-110">This is simply an authenticator message that is encrypted with the [*master key*](/windows/desktop/SecGloss/m-gly) derived from the user's logon password.</span></span>

<span data-ttu-id="efa10-111">Cuando el KDC recibe KRB \_ como \_ req, busca el usuario en su base de datos, obtiene la clave maestra del usuario asociada, descifra los datos de autenticación previa y evalúa la marca de tiempo dentro de.</span><span class="sxs-lookup"><span data-stu-id="efa10-111">When the KDC receives KRB\_AS\_REQ, it looks up the user in its database, gets the associated user's master key, decrypts the preauthentication data, and evaluates the time stamp inside.</span></span> <span data-ttu-id="efa10-112">Si la marca de tiempo es válida, el KDC puede estar seguro de que los datos de autenticación previa se cifraron con la clave maestra del usuario y, por tanto, de que el cliente es auténtico.</span><span class="sxs-lookup"><span data-stu-id="efa10-112">If the time stamp is valid, the KDC can be assured that the preauthentication data was encrypted with the user's master key and thus that the client is genuine.</span></span>

<span data-ttu-id="efa10-113">Una vez que el KDC ha comprobado la identidad del usuario, crea las credenciales que el cliente puede presentar al TGS, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="efa10-113">After the KDC has verified the user's identity, it creates credentials that the client can present to the TGS, as follows:</span></span>

1.  <span data-ttu-id="efa10-114">El KDC invent una clave de [*sesión*](/windows/desktop/SecGloss/s-gly) de inicio de sesión y cifra una copia con la clave maestra del usuario.</span><span class="sxs-lookup"><span data-stu-id="efa10-114">The KDC invents a logon [*session key*](/windows/desktop/SecGloss/s-gly) and encrypts a copy with the user's master key.</span></span>
2.  <span data-ttu-id="efa10-115">El KDC inserta otra copia de la clave de sesión de inicio de sesión y los datos de autorización del usuario en un vale de concesión de vales (TGT) y cifra el TGT con la clave maestra propia del KDC.</span><span class="sxs-lookup"><span data-stu-id="efa10-115">The KDC embeds another copy of the logon session key and the user's authorization data in a ticket-granting ticket (TGT), and encrypts the TGT with the KDC's own master key.</span></span>
3.  <span data-ttu-id="efa10-116">El KDC envía estas credenciales de vuelta al cliente respondiendo con un mensaje de tipo KRB \_ como \_ REP (respuesta del servicio de autenticación Kerberos).</span><span class="sxs-lookup"><span data-stu-id="efa10-116">The KDC sends these credentials back to the client by replying with a message of type KRB\_AS\_REP (Kerberos Authentication Service Reply).</span></span>
4.  <span data-ttu-id="efa10-117">Cuando el cliente recibe la respuesta, utiliza la clave derivada de la contraseña del usuario para descifrar la nueva clave de la sesión de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="efa10-117">When the client receives the reply, it uses the key derived from the user's password to decrypt the new logon session key.</span></span>
5.  <span data-ttu-id="efa10-118">El cliente almacena la nueva clave en su caché de vales.</span><span class="sxs-lookup"><span data-stu-id="efa10-118">The client stores the new key in its ticket cache.</span></span>
6.  <span data-ttu-id="efa10-119">El cliente extrae el TGT del mensaje y lo almacena también en su caché de vales.</span><span class="sxs-lookup"><span data-stu-id="efa10-119">The client extracts the TGT from the message and stores that in its ticket cache as well.</span></span>

 

 
