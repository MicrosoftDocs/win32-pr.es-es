---
title: Seguimiento de red en la arquitectura de Windows 7
description: En la ilustración siguiente se muestra la arquitectura básica de seguimiento de red en Windows 7.
ms.assetid: b3023469-0f98-451c-b39f-c3eae771eacc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 41221ebf434c05a8c9b7c8489e861128029b5320
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105676495"
---
# <a name="network-tracing-in-windows-7-architecture"></a><span data-ttu-id="82834-103">Seguimiento de red en Windows 7: arquitectura</span><span class="sxs-lookup"><span data-stu-id="82834-103">Network Tracing in Windows 7: Architecture</span></span>

<span data-ttu-id="82834-104">En la ilustración siguiente se muestra la arquitectura básica de seguimiento de red en Windows 7.</span><span class="sxs-lookup"><span data-stu-id="82834-104">The illustration below shows the basic network tracing architecture in Windows 7.</span></span>

![diagrama de la arquitectura de seguimiento de red](images/ut1.png)

<span data-ttu-id="82834-106">El seguimiento de red emplea el marco de seguimiento de eventos para Windows (ETW) disponible en Windows.</span><span class="sxs-lookup"><span data-stu-id="82834-106">Network tracing utilizes the Event Tracing for Windows (ETW) framework available in Windows.</span></span> <span data-ttu-id="82834-107">Los componentes de red (como Winsock, TCP/IP, NDIS, captura de paquetes, etc.) se registran como proveedores de seguimiento de ETW y emiten eventos relacionados con la actividad de red.</span><span class="sxs-lookup"><span data-stu-id="82834-107">Network components (such as Winsock, TCP/IP, NDIS, packet-capture, and so on) register as ETW trace providers and emit events related to network activity.</span></span> <span data-ttu-id="82834-108">Cualquier actividad grabable de importancia puede ser un evento registrado en ETW.</span><span class="sxs-lookup"><span data-stu-id="82834-108">Any recordable activity of significance can be an event logged to ETW.</span></span> <span data-ttu-id="82834-109">El seguimiento de estos componentes de red y capturas de paquetes se puede habilitar mediante el contexto de **seguimiento de Netsh** que actúa como controlador ETW.</span><span class="sxs-lookup"><span data-stu-id="82834-109">Tracing for these network components and packet captures can be enabled using the **netsh trace** context which acts as an ETW controller.</span></span>

<span data-ttu-id="82834-110">Los seguimientos generados se recopilan en un archivo de registro de seguimiento de eventos (ETL).</span><span class="sxs-lookup"><span data-stu-id="82834-110">The generated traces are collected in an Event Trace Log (ETL) file.</span></span> <span data-ttu-id="82834-111">A continuación, estos archivos ETL se pueden analizar mediante una serie de herramientas, como Monitor de red 3,2 y versiones posteriores, Visor de eventos, la **conversión de seguimiento de Netsh** o Tracerpt.exe.</span><span class="sxs-lookup"><span data-stu-id="82834-111">These ETL files can then be analyzed using a number of tools, such as Network Monitor 3.2 and later, Event Viewer, **netsh trace convert**, or Tracerpt.exe.</span></span>

<span data-ttu-id="82834-112">Cada evento ETW tiene un encabezado común donde ETW almacena información como las propiedades del evento, las marcas de tiempo y el ID. de actividad.</span><span class="sxs-lookup"><span data-stu-id="82834-112">Each ETW event has a common header where ETW stores information such as the event properties, time stamps, and activity ID.</span></span> <span data-ttu-id="82834-113">(Para obtener más información acerca de los identificadores de actividad, consulte [escribir eventos relacionados en un escenario de un extremo a otro](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span><span class="sxs-lookup"><span data-stu-id="82834-113">(For more information about activity IDs, see [Writing Related Events in an End-to-End Scenario](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span></span> <span data-ttu-id="82834-114">El ID. de actividad se usa para correlacionar eventos.</span><span class="sxs-lookup"><span data-stu-id="82834-114">The activity ID is used to correlate events.</span></span> <span data-ttu-id="82834-115">En el modo de usuario, los identificadores de actividad se almacenan en subprocesos y todos los eventos registrados en un subproceso se etiquetarán automáticamente con el mismo ID. de actividad.</span><span class="sxs-lookup"><span data-stu-id="82834-115">In user mode, activity IDs are stored in threads, and all events logged in one thread will automatically be tagged with the same activity ID.</span></span> <span data-ttu-id="82834-116">En el modo kernel, el ID. de actividad se debe pasar explícitamente cuando se registra un evento.</span><span class="sxs-lookup"><span data-stu-id="82834-116">In kernel mode, the activity ID must be explicitly passed when an event is logged.</span></span> <span data-ttu-id="82834-117">De forma predeterminada, los archivos ETL se correlacionan con los eventos de grupo juntos en los identificadores de actividad específicos.</span><span class="sxs-lookup"><span data-stu-id="82834-117">By default, ETL files are correlated to group events together under specific activity IDs.</span></span>

<span data-ttu-id="82834-118">Para obtener más información sobre los eventos de Windows y ETW, vea [eventos de Windows](../events/windows-events.md).</span><span class="sxs-lookup"><span data-stu-id="82834-118">For more information about Windows Events and ETW, see [Windows Events](../events/windows-events.md).</span></span>

## <a name="etw-components-in-network-tracing"></a><span data-ttu-id="82834-119">Componentes de ETW en el seguimiento de red</span><span class="sxs-lookup"><span data-stu-id="82834-119">ETW Components in Network Tracing</span></span>

<span data-ttu-id="82834-120">El seguimiento de red usa ETW como mecanismo de seguimiento principal para proporcionar información acerca de lo que hacen los subsistemas de red.</span><span class="sxs-lookup"><span data-stu-id="82834-120">Network tracing uses ETW as its primary tracing mechanism to provide information about what the networking subsystems are doing.</span></span> <span data-ttu-id="82834-121">Hay cuatro componentes principales en ETW: sesiones de seguimiento de eventos, proveedores de eventos, controladores de eventos y consumidores de eventos.</span><span class="sxs-lookup"><span data-stu-id="82834-121">There are four main components in ETW: event trace sessions, event providers, event controllers and event consumers.</span></span>

<span data-ttu-id="82834-122">El almacenamiento en búfer y el registro tienen lugar en *sesiones de seguimiento de eventos*, que aceptan eventos de proveedores y crean archivos de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="82834-122">Buffering and logging take place in *event trace sessions*, which accept events from providers and creates trace files.</span></span>

<span data-ttu-id="82834-123">Un *proveedor de eventos* es una entidad lógica que escribe los eventos en las sesiones de ETW.</span><span class="sxs-lookup"><span data-stu-id="82834-123">An *event provider* is a logical entity that writes events to ETW sessions.</span></span> <span data-ttu-id="82834-124">Un proveedor de eventos puede ser una aplicación de modo de usuario, una aplicación administrada, un controlador o cualquier otra entidad de software.</span><span class="sxs-lookup"><span data-stu-id="82834-124">An event provider can be a user-mode application, a managed application, a driver, or any other software entity.</span></span> <span data-ttu-id="82834-125">Los proveedores de eventos se registran con ETW y escriben eventos de varios puntos en el código mediante la invocación de la API de registro de ETW.</span><span class="sxs-lookup"><span data-stu-id="82834-125">Event providers register with ETW and write events from various points in the code by invoking the ETW logging API.</span></span> <span data-ttu-id="82834-126">Debido a la instrumentación de eventos en aumento en muchos componentes del sistema operativo, incluso una aplicación o un escenario sencillos de Windows contendrán varios componentes que son proveedores de eventos.</span><span class="sxs-lookup"><span data-stu-id="82834-126">Due to the growing event instrumentation in many operating system components, even a simple application or scenario in Windows will contain several components that are event providers.</span></span>

<span data-ttu-id="82834-127">Un *controlador de eventos* inicia y detiene las sesiones de seguimiento de eventos y habilita los proveedores.</span><span class="sxs-lookup"><span data-stu-id="82834-127">An *event controller* starts and stops event trace sessions and enables providers.</span></span> <span data-ttu-id="82834-128">Cuando la aplicación del controlador de eventos habilita un proveedor de eventos de forma dinámica, el proveedor envía eventos a una sesión de seguimiento de eventos específica designada por el controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="82834-128">When an event provider is enabled dynamically by the event controller application, the provider sends events to a specific event trace session designated by the event controller.</span></span> <span data-ttu-id="82834-129">Cada evento enviado por el proveedor de eventos a la sesión de seguimiento de eventos está compuesto de un encabezado fijo, que incluye metadatos de evento y cualquier dato personalizado adicional registrado por el proveedor.</span><span class="sxs-lookup"><span data-stu-id="82834-129">Each event sent by the event provider to the event trace session consists of a fixed header, which includes event metadata and any additional custom data logged by the provider.</span></span>

<span data-ttu-id="82834-130">Un *consumidor de eventos* es una aplicación que lee los archivos de registro o que escucha una sesión de seguimiento de eventos para los eventos en tiempo real y los procesa.</span><span class="sxs-lookup"><span data-stu-id="82834-130">An *event consumer* is an application that reads log files or that listens to an event trace session for real-time events and processes them.</span></span> <span data-ttu-id="82834-131">Un ejemplo de consumidor de eventos es Monitor de red de Microsoft 3,2, que incluye la capacidad de leer y mostrar los archivos de registro generados por el seguimiento de red en Windows 7.</span><span class="sxs-lookup"><span data-stu-id="82834-131">One example of an event consumer is Microsoft Network Monitor 3.2, which includes the capability to read and display log files produced by network tracing in Windows 7.</span></span>

<span data-ttu-id="82834-132">Los eventos se entregan a los consumidores de eventos en orden cronológico, y hay varias aplicaciones de consumidor de eventos que muestran los eventos en formatos concretos.</span><span class="sxs-lookup"><span data-stu-id="82834-132">Events are delivered to event consumers in chronological order, and there are various event consumer applications that display the events in specific formats.</span></span> <span data-ttu-id="82834-133">Cuando se registra un evento en una sesión, ETW agrega información adicional al encabezado del evento, incluidos los datos de la marca de tiempo, el proceso y el identificador del subproceso, el número de procesador y los datos de uso de CPU del subproceso de registro.</span><span class="sxs-lookup"><span data-stu-id="82834-133">When an event is logged to a session, ETW adds additional information to the event header, including the timestamp, process and thread ID, processor number, and CPU usage data of the logging thread.</span></span> <span data-ttu-id="82834-134">Después, estos datos se pasan a los consumidores de eventos, junto con los datos personalizados que incluye el proveedor.</span><span class="sxs-lookup"><span data-stu-id="82834-134">This data is then passed on to event consumers, along with any custom data included by the provider.</span></span>

<span data-ttu-id="82834-135">Se espera que los proveedores que usan las nuevas [API de registro de eventos](/windows/win32/api/evntprov/nf-evntprov-eventwrite) suministren un archivo XML denominado manifiesto de [evento](../wes/eventschema-schema.md).</span><span class="sxs-lookup"><span data-stu-id="82834-135">Providers using the new [Event Logging APIs](/windows/win32/api/evntprov/nf-evntprov-eventwrite) are expected to supply an XML file called the [event manifest](../wes/eventschema-schema.md).</span></span> <span data-ttu-id="82834-136">Este archivo proporciona metadatos para definir todos los datos personalizados e información de diseño para los eventos escritos por el proveedor.</span><span class="sxs-lookup"><span data-stu-id="82834-136">This file provides metadata to define all of the custom data and layout information for the events written by the provider.</span></span> <span data-ttu-id="82834-137">Después, una aplicación de consumidor de uso general utiliza las API del [ayudante de datos de seguimiento (TDH)](/windows/win32/api/tdh/) para recuperar los metadatos del evento, descodificar los eventos y mostrarlos.</span><span class="sxs-lookup"><span data-stu-id="82834-137">A general purpose consumer application then uses [Trace Data Helper (TDH)](/windows/win32/api/tdh/) APIs to retrieve the event metadata, decode the events, and display them.</span></span>

<span data-ttu-id="82834-138">Con el seguimiento de red en Windows 7, el lado del controlador de eventos o del consumidor incluye compatibilidad con el seguimiento basado en escenarios de un extremo a otro integrado con las experiencias generales de diagnóstico y soporte técnico de Windows.</span><span class="sxs-lookup"><span data-stu-id="82834-138">With network tracing in Windows 7, the event controller/consumer side includes end-to-end scenario-based tracing support integrated with overall Windows diagnostic and support experiences.</span></span> <span data-ttu-id="82834-139">Un escenario define una colección de proveedores de eventos implicados en el escenario.</span><span class="sxs-lookup"><span data-stu-id="82834-139">A scenario defines a collection of event providers involved in the scenario.</span></span> <span data-ttu-id="82834-140">El lado del controlador de eventos/consumidor define los escenarios (contextos) en los que se puede usar el seguimiento, incluidos los proveedores pertinentes para los escenarios determinados en los componentes de red.</span><span class="sxs-lookup"><span data-stu-id="82834-140">The event controller/consumer side defines the scenarios (contexts) where tracing can be used, including the relevant providers for given scenarios across network components.</span></span> <span data-ttu-id="82834-141">El lado del proveedor de eventos incluye eventos de seguimiento de red normalizados de distintos componentes de la pila de red, que se pueden correlacionar a través de identificadores de actividad de ETW.</span><span class="sxs-lookup"><span data-stu-id="82834-141">The event provider side includes standardized network tracing events from different components in the network stack, which can be correlated via ETW activity IDs.</span></span> <span data-ttu-id="82834-142">Los proveedores usan un esquema de red común que normaliza el uso de conceptos de ETW como palabras clave, niveles, tareas y códigos de procedimientos.</span><span class="sxs-lookup"><span data-stu-id="82834-142">The providers use a common network schema that standardizes the use of ETW concepts such as keywords, levels, tasks, and opcodes.</span></span> <span data-ttu-id="82834-143">El esquema también define eventos que son comunes para muchos componentes de red como eventos de error, eventos de eliminación de paquetes, eventos de esquema y eventos de transición de estado.</span><span class="sxs-lookup"><span data-stu-id="82834-143">The schema also defines events that are common for many network components such as error events, packet drop events, schema events, and state transition events.</span></span>

 

 