---
description: En este tema se describe cómo admitir Microsoft Direct3D 11 en un descodificador de Microsoft Media Foundation.
ms.assetid: 656556AA-0266-4318-9D3C-AED75BD728F6
title: Compatibilidad con la descodificación de vídeo Direct3D 11 en Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 542f7244922dc7947f22e4d33027fdcac1962fe5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "105670083"
---
# <a name="supporting-direct3d-11-video-decoding-in-media-foundation"></a><span data-ttu-id="daff5-103">Compatibilidad con la descodificación de vídeo Direct3D 11 en Media Foundation</span><span class="sxs-lookup"><span data-stu-id="daff5-103">Supporting Direct3D 11 Video Decoding in Media Foundation</span></span>

<span data-ttu-id="daff5-104">En este tema se describe cómo admitir Microsoft Direct3D 11 en un descodificador de Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="daff5-104">This topic describes how to support Microsoft Direct3D 11 in a Microsoft Media Foundation decoder.</span></span> <span data-ttu-id="daff5-105">En concreto, describe la comunicación entre el descodificador y el representador de vídeo.</span><span class="sxs-lookup"><span data-stu-id="daff5-105">Specifically, it describes the communication between the decoder and the video renderer.</span></span> <span data-ttu-id="daff5-106">En este tema no se describe cómo implementar las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="daff5-106">This topic does not describe how to implement the decoding operations.</span></span>

-   [<span data-ttu-id="daff5-107">Información general</span><span class="sxs-lookup"><span data-stu-id="daff5-107">Overview</span></span>](#overview)
-   [<span data-ttu-id="daff5-108">Abrir un identificador de dispositivo</span><span class="sxs-lookup"><span data-stu-id="daff5-108">Open a Device Handle</span></span>](#open-a-device-handle)
-   [<span data-ttu-id="daff5-109">Buscar una configuración de descodificador</span><span class="sxs-lookup"><span data-stu-id="daff5-109">Find a Decoder Configuration</span></span>](#find-a-decoder-configuration)
-   [<span data-ttu-id="daff5-110">Retroceso a descodificación de software</span><span class="sxs-lookup"><span data-stu-id="daff5-110">Fallback to Software Decoding</span></span>](#fallback-to-software-decoding)
-   [<span data-ttu-id="daff5-111">Asignación de búferes sin comprimir</span><span class="sxs-lookup"><span data-stu-id="daff5-111">Allocating Uncompressed Buffers</span></span>](#allocating-uncompressed-buffers)
-   [<span data-ttu-id="daff5-112">Descodificación</span><span class="sxs-lookup"><span data-stu-id="daff5-112">Decoding</span></span>](#supporting-direct3d-11-video-decoding-in-media-foundation)
-   [<span data-ttu-id="daff5-113">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="daff5-113">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="daff5-114">Información general</span><span class="sxs-lookup"><span data-stu-id="daff5-114">Overview</span></span>

<span data-ttu-id="daff5-115">En el resto de este tema, se usan los términos siguientes:</span><span class="sxs-lookup"><span data-stu-id="daff5-115">In the remainder of this topic, the following terms are used:</span></span>

-   <span data-ttu-id="daff5-116">**Descodificador de software**.</span><span class="sxs-lookup"><span data-stu-id="daff5-116">**Software decoder**.</span></span> <span data-ttu-id="daff5-117">El descodificador de software es la transformación de Media Foundation (MFT) que recibe ejemplos de vídeo comprimidos y genera tramas de vídeo sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="daff5-117">The software decoder is the Media Foundation transform (MFT) that receives compressed video samples and outputs uncompressed video frames.</span></span>
-   <span data-ttu-id="daff5-118">**Dispositivo descodificador**.</span><span class="sxs-lookup"><span data-stu-id="daff5-118">**Decoder device**.</span></span> <span data-ttu-id="daff5-119">El dispositivo descodificador es el acelerador de vídeo y lo implementa el controlador de gráficos.</span><span class="sxs-lookup"><span data-stu-id="daff5-119">The decoder device is the video accelerator, and is implemented by the graphics driver.</span></span> <span data-ttu-id="daff5-120">El dispositivo descodificador realiza operaciones de descodificación aceleradas.</span><span class="sxs-lookup"><span data-stu-id="daff5-120">The decoder device performs accelerated decoding operations.</span></span>
-   <span data-ttu-id="daff5-121">**Canalización**.</span><span class="sxs-lookup"><span data-stu-id="daff5-121">**Pipeline**.</span></span> <span data-ttu-id="daff5-122">La canalización hospeda el descodificador de software y proporciona búferes hacia y desde el descodificador de software.</span><span class="sxs-lookup"><span data-stu-id="daff5-122">The pipeline hosts the software decoder and delivers buffers to and from the software decoder.</span></span> <span data-ttu-id="daff5-123">Dependiendo de la aplicación, la canalización podría ser la [sesión multimedia](media-session.md), el [lector de origen](source-reader.md)o el código de aplicación que llama directamente a la MFT.</span><span class="sxs-lookup"><span data-stu-id="daff5-123">Depending on the application, the pipeline might be the [Media Session](media-session.md), the [Source Reader](source-reader.md), or application code that directly calls into the MFT.</span></span>

<span data-ttu-id="daff5-124">Para realizar la descodificación con Direct3D 11, el descodificador de software debe tener un puntero a un dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-124">To perform decoding using Direct3D 11, the software decoder must have a pointer to a Direct3D 11 device.</span></span> <span data-ttu-id="daff5-125">El dispositivo Direct3D 11 se crea externamente en el descodificador de software.</span><span class="sxs-lookup"><span data-stu-id="daff5-125">The Direct3D 11 device is created externally to the software decoder.</span></span> <span data-ttu-id="daff5-126">En un escenario de [sesión multimedia](media-session.md) , el representador de vídeo crea el dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-126">In a [Media Session](media-session.md) scenario, the video renderer creates the Direct3D 11 device.</span></span> <span data-ttu-id="daff5-127">En un escenario de [lector de código fuente](source-reader.md) , normalmente la aplicación crea el dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-127">In a [Source Reader](source-reader.md) scenario, typically the application creates the Direct3D 11 device.</span></span>

<span data-ttu-id="daff5-128">El Administrador de dispositivos de DXGI se usa para compartir Direct3D 11 entre los componentes.</span><span class="sxs-lookup"><span data-stu-id="daff5-128">The DXGI Device Manager is used to share the Direct3D 11 between components.</span></span> <span data-ttu-id="daff5-129">El Administrador de dispositivos de DXGI expone la interfaz [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="daff5-129">The DXGI Device Manager exposes the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span> <span data-ttu-id="daff5-130">La canalización establece el puntero **IMFDXGIDeviceManager** en el descodificador de software mediante el envío del mensaje de [**\_ \_ \_ \_ Administrador D3D del conjunto de mensajes MFT**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="daff5-130">The pipeline sets the **IMFDXGIDeviceManager** pointer on the software decoder by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span>

<span data-ttu-id="daff5-131">En el diagrama siguiente se muestra la relación entre el descodificador de software, Direct3D 11 y la canalización.</span><span class="sxs-lookup"><span data-stu-id="daff5-131">The following diagram shows the relation between the software decoder, the Direct3D 11, and the pipeline.</span></span>

![diagrama que muestra el descodificador de software y el administrador de dispositivos de dxgi.](images/d3d11video01.png)

<span data-ttu-id="daff5-133">Estos son los pasos básicos que debe realizar un descodificador de software para admitir Direct3D 11 en Media Foundation:</span><span class="sxs-lookup"><span data-stu-id="daff5-133">Here are the basic steps that a software decoder must perform to support Direct3D 11 in Media Foundation:</span></span>

1.  <span data-ttu-id="daff5-134">Abra un identificador para el dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-134">Open a handle to the Direct3D 11 device.</span></span>
2.  <span data-ttu-id="daff5-135">Busque una configuración de descodificador.</span><span class="sxs-lookup"><span data-stu-id="daff5-135">Find a decoder configuration.</span></span>
3.  <span data-ttu-id="daff5-136">Asignar búferes sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="daff5-136">Allocate uncompressed buffers.</span></span>
4.  <span data-ttu-id="daff5-137">Descodificar fotogramas.</span><span class="sxs-lookup"><span data-stu-id="daff5-137">Decode frames.</span></span>

<span data-ttu-id="daff5-138">Estos pasos se describen con más detalle en el resto de este tema.</span><span class="sxs-lookup"><span data-stu-id="daff5-138">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="open-a-device-handle"></a><span data-ttu-id="daff5-139">Abrir un identificador de dispositivo</span><span class="sxs-lookup"><span data-stu-id="daff5-139">Open a Device Handle</span></span>

<span data-ttu-id="daff5-140">La MFT del descodificador usa el administrador de dispositivos de DXGI para obtener un identificador para el dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-140">The decoder MFT uses the DXGI device manager to get a handle to the Direct3D 11 device.</span></span> <span data-ttu-id="daff5-141">Para abrir el identificador del dispositivo, realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="daff5-141">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="daff5-142">La MFT del descodificador debe exponer el atributo de [ \_ \_ \_ reconocimiento de SA D3D11 de MF](mf-sa-d3d11-aware.md) con el valor **true**.</span><span class="sxs-lookup"><span data-stu-id="daff5-142">The decoder MFT must expose the [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md) attribute with the value **TRUE**.</span></span>
2.  <span data-ttu-id="daff5-143">El cargador de topología consulta este atributo mediante una llamada a [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span><span class="sxs-lookup"><span data-stu-id="daff5-143">The Topology Loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="daff5-144">El valor **true** indica que MFT es compatible con Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-144">The value **TRUE** indicates that the MFT supports Direct3D 11.</span></span>
3.  <span data-ttu-id="daff5-145">El cargador de topología llama a [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con el mensaje de administrador de D3D del conjunto de mensajes de [**MFT \_ \_ \_ \_**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="daff5-145">The Topology Loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="daff5-146">El parámetro *ulParam* es un puntero [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) al administrador de dispositivos de DXGI.</span><span class="sxs-lookup"><span data-stu-id="daff5-146">The *ulParam* parameter is an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to the DXGI device manager.</span></span> <span data-ttu-id="daff5-147">Consulte este puntero para la interfaz [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="daff5-147">Query this pointer for the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="daff5-148">Llame a [**IMFDXGIDeviceManager:: OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) para obtener un identificador para el dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="daff5-148">Call [**IMFDXGIDeviceManager::OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) to get a handle to the Direct3D 11 device.</span></span>
5.  <span data-ttu-id="daff5-149">Para obtener un puntero al dispositivo Direct3D 11, llame a [**IMFDXGIDeviceManager:: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span><span class="sxs-lookup"><span data-stu-id="daff5-149">To get a pointer to the Direct3D 11 device, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span></span> <span data-ttu-id="daff5-150">Pase el identificador de dispositivo y el IID de valor **\_ ID3D11Device**.</span><span class="sxs-lookup"><span data-stu-id="daff5-150">Pass in the device handle and the value **IID\_ID3D11Device**.</span></span> <span data-ttu-id="daff5-151">El método devuelve un puntero a la interfaz [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="daff5-151">The method returns a pointer to the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>
6.  <span data-ttu-id="daff5-152">Para obtener un puntero al Acelerador de vídeo, llame a [**IMFDXGIDeviceManager:: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) de nuevo.</span><span class="sxs-lookup"><span data-stu-id="daff5-152">To get a pointer to the video accelerator, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) again.</span></span> <span data-ttu-id="daff5-153">Esta vez, pase el identificador de dispositivo y el IID de valor **\_ ID3D11VideoDevice**.</span><span class="sxs-lookup"><span data-stu-id="daff5-153">This time, pass in the device handle and the value **IID\_ID3D11VideoDevice**.</span></span> <span data-ttu-id="daff5-154">El método devuelve un puntero a la interfaz [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="daff5-154">The method returns a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
7.  <span data-ttu-id="daff5-155">Llame a [**ID3D11Device:: GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) para obtener un puntero [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) .</span><span class="sxs-lookup"><span data-stu-id="daff5-155">Call [**ID3D11Device::GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) to get an [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) pointer.</span></span>
8.  <span data-ttu-id="daff5-156">Llame a [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) en [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) para obtener un puntero [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) .</span><span class="sxs-lookup"><span data-stu-id="daff5-156">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) to get an [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) pointer.</span></span>
9.  <span data-ttu-id="daff5-157">Se recomienda usar la protección multiproceso en el contexto de dispositivo para evitar problemas de interbloqueo que a veces pueden producirse cuando se llama a [**ID3D11VideoContext:: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) o [**ID3D11VideoContext:: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="daff5-157">It is recommended that you use multi-thread protection on the device context to prevent deadlock issues that can sometimes happen when you call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) or [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span> <span data-ttu-id="daff5-158">Para establecer la protección de varios subprocesos, llame primero a [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) en [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) para obtener un puntero [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) .</span><span class="sxs-lookup"><span data-stu-id="daff5-158">To set multi-thread protection, first call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) to get an [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) pointer.</span></span> <span data-ttu-id="daff5-159">Después, llame a [**ID3D10Multithread:: SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), pasando **true** para *bMTProtect*.</span><span class="sxs-lookup"><span data-stu-id="daff5-159">Then call [**ID3D10Multithread::SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passing in **true** for *bMTProtect*.</span></span>

## <a name="find-a-decoder-configuration"></a><span data-ttu-id="daff5-160">Buscar una configuración de descodificador</span><span class="sxs-lookup"><span data-stu-id="daff5-160">Find a Decoder Configuration</span></span>

<span data-ttu-id="daff5-161">Para realizar la descodificación, el descodificador de software debe buscar una configuración compatible compatible con el dispositivo descodificador, incluido un formato de destino de representación.</span><span class="sxs-lookup"><span data-stu-id="daff5-161">To perform decoding, the software decoder must find a compatible configuration that is supported by the decoder device, including a render-target format.</span></span> <span data-ttu-id="daff5-162">Este paso se produce dentro del método [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) , como se indica a continuación.</span><span class="sxs-lookup"><span data-stu-id="daff5-162">This step occurs inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, as follows.</span></span>

1.  <span data-ttu-id="daff5-163">Valide el tipo de medio de entrada.</span><span class="sxs-lookup"><span data-stu-id="daff5-163">Validate the input media type.</span></span> <span data-ttu-id="daff5-164">Si el tipo es rechazado, omita los pasos restantes y devuelva un código de error.</span><span class="sxs-lookup"><span data-stu-id="daff5-164">If the type is rejected, skip the remaining steps and return an error code.</span></span>
2.  <span data-ttu-id="daff5-165">Llame a [**ID3D11VideoDevice:: GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) para obtener el número de perfiles admitidos.</span><span class="sxs-lookup"><span data-stu-id="daff5-165">Call [**ID3D11VideoDevice::GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) to get the number of supported profiles.</span></span>
3.  <span data-ttu-id="daff5-166">Llame a [**ID3D11VideoDevice:: GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) para enumerar los perfiles y obtener los GUID de perfil.</span><span class="sxs-lookup"><span data-stu-id="daff5-166">Call [**ID3D11VideoDevice::GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) to enumerate the profiles and get the profile GUIDs.</span></span>
4.  <span data-ttu-id="daff5-167">Busque un GUID de perfil que coincida con el formato de vídeo y las capacidades del descodificador de software.</span><span class="sxs-lookup"><span data-stu-id="daff5-167">Look for a profile GUID that matches the video format and the capabilities of the software decoder.</span></span> <span data-ttu-id="daff5-168">Por ejemplo, un descodificador de MPEG-2 encontraría el perfil de descodificador de **D3D11 \_ \_ \_ MPEG2 \_ MOCOMP**, el **Perfil de \_ descodificador D3D11 \_ \_ MPEG2 \_ IDCT** y el **Perfil de \_ descodificador de D3D11 \_ \_ MPEG2 \_ VLD**.</span><span class="sxs-lookup"><span data-stu-id="daff5-168">For example, an MPEG-2 decoder would look for **D3D11\_DECODER\_PROFILE\_MPEG2\_MOCOMP**,**D3D11\_DECODER\_PROFILE\_MPEG2\_IDCT**, and **D3D11\_DECODER\_PROFILE\_MPEG2\_VLD**.</span></span>
5.  <span data-ttu-id="daff5-169">Si se encuentra un GUID de descodificador adecuado, compruebe el formato de salida llamando al método [**ID3D11VideoDevice:: CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) .</span><span class="sxs-lookup"><span data-stu-id="daff5-169">If a suitable decoder GUID is found, check the output format by calling the [**ID3D11VideoDevice::CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) method.</span></span> <span data-ttu-id="daff5-170">Pase el GUID del descodificador y un valor de **\_ formato de DXGI** que especifique el formato de destino de representación.</span><span class="sxs-lookup"><span data-stu-id="daff5-170">Pass in the decoder GUID and a **DXGI\_FORMAT** value that specifies the render-target format.</span></span>
6.  <span data-ttu-id="daff5-171">A continuación, busque una configuración adecuada para el descodificador.</span><span class="sxs-lookup"><span data-stu-id="daff5-171">Next, find a suitable configuration for the decoder.</span></span>
    1.  <span data-ttu-id="daff5-172">Llame a [**ID3D11VideoDevice:: GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) para obtener el número de configuraciones del descodificador.</span><span class="sxs-lookup"><span data-stu-id="daff5-172">Call [**ID3D11VideoDevice::GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) to get the number of decoder configurations.</span></span> <span data-ttu-id="daff5-173">Pase el mismo GUID del dispositivo descodificador, junto con una [**estructura \_ \_ \_ DESC del descodificador de vídeo D3D11**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) que describe el formato de destino de representación propuesto.</span><span class="sxs-lookup"><span data-stu-id="daff5-173">Pass in the same decoder device GUID, along with a [**D3D11\_VIDEO\_DECODER\_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) structure that describes the proposed render-target format.</span></span>
    2.  <span data-ttu-id="daff5-174">Llame a [**ID3D11VideoDevice:: GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) para enumerar las configuraciones del descodificador.</span><span class="sxs-lookup"><span data-stu-id="daff5-174">Call [**ID3D11VideoDevice::GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) to enumerate the decoder configurations.</span></span>

<span data-ttu-id="daff5-175">En el método [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) , devuelve un formato de vídeo sin comprimir basado en el formato de destino de representación propuesto.</span><span class="sxs-lookup"><span data-stu-id="daff5-175">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format based on the proposed render-target format.</span></span>

<span data-ttu-id="daff5-176">En el método [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) , compruebe el tipo de medio con el formato de destino de representación.</span><span class="sxs-lookup"><span data-stu-id="daff5-176">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

## <a name="fallback-to-software-decoding"></a><span data-ttu-id="daff5-177">Retroceso a descodificación de software</span><span class="sxs-lookup"><span data-stu-id="daff5-177">Fallback to Software Decoding</span></span>

<span data-ttu-id="daff5-178">Es posible que la MFT no pueda encontrar una configuración.</span><span class="sxs-lookup"><span data-stu-id="daff5-178">The MFT might be unable to find a configuration.</span></span> <span data-ttu-id="daff5-179">Por ejemplo, es posible que el controlador de gráficos no admita las capacidades adecuadas.</span><span class="sxs-lookup"><span data-stu-id="daff5-179">For example, the graphics driver might not support the right capabilities.</span></span> <span data-ttu-id="daff5-180">En ese caso, la MFT debe revertir a la descodificación de software, como se indica a continuación.</span><span class="sxs-lookup"><span data-stu-id="daff5-180">In that case, the MFT must fall back to software decoding, as follows.</span></span>

1.  <span data-ttu-id="daff5-181">Los métodos [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) y [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) deben devolver el **\_ \_ \_ \_ tipo D3D no compatible con MF E**.</span><span class="sxs-lookup"><span data-stu-id="daff5-181">The [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods should both return **MF\_E\_UNSUPPORTED\_D3D\_TYPE**.</span></span>
2.  <span data-ttu-id="daff5-182">En respuesta, el cargador de topología enviará el mensaje de [**\_ \_ \_ \_ Administrador D3D de conjunto de mensajes MFT**](mft-message-set-d3d-manager.md) con el valor **null** para el parámetro *ulParam* .</span><span class="sxs-lookup"><span data-stu-id="daff5-182">In response, the Topology Loader will send the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span>
3.  <span data-ttu-id="daff5-183">MFT libera su puntero a la interfaz [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="daff5-183">The MFT releases its pointer to the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="daff5-184">El cargador de topología vuelve a negociar el tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="daff5-184">The Topology Loader renegotiates the media type.</span></span>

<span data-ttu-id="daff5-185">En este momento, la MFT puede usar la descodificación de software.</span><span class="sxs-lookup"><span data-stu-id="daff5-185">At this point, the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="daff5-186">Asignación de búferes sin comprimir</span><span class="sxs-lookup"><span data-stu-id="daff5-186">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="daff5-187">El descodificador es responsable de asignar las texturas de Direct3D 11 para usarlas como búferes de vídeo sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="daff5-187">The decoder is responsible for allocating Direct3D 11 textures to use as uncompressed video buffers.</span></span> <span data-ttu-id="daff5-188">El atributo de [ \_ \_ \_ \_ \_ recuento de ejemplo de salida mínima de MF SA](mf-sa-minimum-output-sample-count.md) en los atributos del flujo de salida (vea [**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) se usa para determinar cuántas superficies debe asignar el descodificador para que el representador de vídeo las use para el desentrelazado.</span><span class="sxs-lookup"><span data-stu-id="daff5-188">The [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT](mf-sa-minimum-output-sample-count.md) attribute in the output stream attributes (see [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) is used to determine how many surfaces the decoder should allocate for the video renderer to use for deinterlacing .</span></span> <span data-ttu-id="daff5-189">Un descodificador debe usar este valor para delimitarlo para algunos límites superiores y inferiores razonables, por ejemplo 3-32.</span><span class="sxs-lookup"><span data-stu-id="daff5-189">A decoder should use this value bounding it for some reasonable upper and lower limits, for example 3-32.</span></span> <span data-ttu-id="daff5-190">Para obtener contenido progresivo, vea [ \_ ejemplo de salida mínima de MF SA \_ \_ \_ \_ recuento \_ progresiva](mf-sa-minimum-output-sample-count-progressive.md).</span><span class="sxs-lookup"><span data-stu-id="daff5-190">For progressive content see [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT\_PROGRESSIVE](mf-sa-minimum-output-sample-count-progressive.md).</span></span>

<span data-ttu-id="daff5-191">En el método [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) , establezca el **flujo de salida de MFT proporciona la marca \_ \_ \_ \_ Samples** en la estructura de información del flujo de salida de [**MFT \_ \_ \_**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) .</span><span class="sxs-lookup"><span data-stu-id="daff5-191">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) structure.</span></span> <span data-ttu-id="daff5-192">Esta marca notifica a la sesión de medios que la MFT asigna sus propios ejemplos de salida.</span><span class="sxs-lookup"><span data-stu-id="daff5-192">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span> <span data-ttu-id="daff5-193">Para asignar los ejemplos de salida, la MFT realiza los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="daff5-193">To allocate the output samples, the MFT performs the following steps:</span></span>

1.  <span data-ttu-id="daff5-194">Cree una matriz de textura 2D llamando a [**ID3D11Device:: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span><span class="sxs-lookup"><span data-stu-id="daff5-194">Create a 2D texture array by calling [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span></span> <span data-ttu-id="daff5-195">En la estructura [**D3D11 \_ TEXTURE2D \_ DESC**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) , establezca **tamaño** igual al número de superficies que necesita el descodificador.</span><span class="sxs-lookup"><span data-stu-id="daff5-195">In the [**D3D11\_TEXTURE2D\_DESC**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) structure, set **ArraySize** equal to the number of surfaces that the decoder needs.</span></span> <span data-ttu-id="daff5-196">Esto incluye:</span><span class="sxs-lookup"><span data-stu-id="daff5-196">This includes:</span></span>
    -   <span data-ttu-id="daff5-197">Superficies para fotogramas de referencia.</span><span class="sxs-lookup"><span data-stu-id="daff5-197">Surfaces for reference frames.</span></span>
    -   <span data-ttu-id="daff5-198">Superficies para el desentrelazado (tres superficies).</span><span class="sxs-lookup"><span data-stu-id="daff5-198">Surfaces for deinterlacing (three surfaces).</span></span>
    -   <span data-ttu-id="daff5-199">Superficies que el descodificador necesita para el almacenamiento en búfer.</span><span class="sxs-lookup"><span data-stu-id="daff5-199">Surfaces that the decoder needs for buffering.</span></span>

    <span data-ttu-id="daff5-200">Las marcas de enlace (**BindFlags**) deben incluir la marca de **\_ \_ descodificador de enlace D3D11** y cualquier marca de enlace establecida mediante el atributo [MF \_ SA \_ D3D11 \_ BindFlags](mf-sa-d3d11-bindflags.md) en los atributos del flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="daff5-200">The binding flags (**BindFlags**) should include the **D3D11\_BIND\_DECODER** flag and any bind flags set through the [MF\_SA\_D3D11\_BINDFLAGS](mf-sa-d3d11-bindflags.md) attribute in the output stream attributes.</span></span>
2.  <span data-ttu-id="daff5-201">Para cada superficie de la matriz de textura, llame a [**ID3D11VideoDevice:: CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) para crear una vista de salida del descodificador de vídeo.</span><span class="sxs-lookup"><span data-stu-id="daff5-201">For each surface in the texture array, call [**ID3D11VideoDevice::CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) to create a video decoder output view.</span></span> <span data-ttu-id="daff5-202">Durante la descodificación, estas vistas de salida se pasarán al método [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) .</span><span class="sxs-lookup"><span data-stu-id="daff5-202">During decoding, these output views will be passed to the [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) method.</span></span>
3.  <span data-ttu-id="daff5-203">Para cada superficie de la matriz de textura, cree un ejemplo multimedia como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="daff5-203">For each surface in the texture array, create a media sample as follows:</span></span>
    1.  <span data-ttu-id="daff5-204">Cree un búfer de medios de DXGI mediante una llamada a la función [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) .</span><span class="sxs-lookup"><span data-stu-id="daff5-204">Create a DXGI media buffer by calling the [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) function.</span></span> <span data-ttu-id="daff5-205">Pase el puntero [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) y el desplazamiento de cada elemento de la matriz de textura.</span><span class="sxs-lookup"><span data-stu-id="daff5-205">Pass in the [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) pointer and the offset for each element in the texture array.</span></span> <span data-ttu-id="daff5-206">La función devuelve un puntero [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="daff5-206">The function returns an [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) pointer.</span></span>
    2.  <span data-ttu-id="daff5-207">Cree un ejemplo vacío mediante una llamada a la función [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) .</span><span class="sxs-lookup"><span data-stu-id="daff5-207">Create an empty media sample by calling the [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) function.</span></span> <span data-ttu-id="daff5-208">Establezca el parámetro *pUnkSurface* en **null**.</span><span class="sxs-lookup"><span data-stu-id="daff5-208">Set the *pUnkSurface* parameter equal to **NULL**.</span></span> <span data-ttu-id="daff5-209">La función devuelve un puntero [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) .</span><span class="sxs-lookup"><span data-stu-id="daff5-209">The function returns an [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) pointer.</span></span>
    3.  <span data-ttu-id="daff5-210">Llame a [**IMFSample:: AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) para agregar el búfer multimedia al ejemplo.</span><span class="sxs-lookup"><span data-stu-id="daff5-210">Call [**IMFSample::AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) to add the media buffer to the sample.</span></span>

<span data-ttu-id="daff5-211">Debe destruir todas las texturas que cree al mismo tiempo, en lugar de destruir solo algunas y continuar usando el recordatorio.</span><span class="sxs-lookup"><span data-stu-id="daff5-211">You should destroy all the textures you create at the same time, rather then destroying only some and continuing to use the reminder.</span></span>

## <a name="decoding"></a><span data-ttu-id="daff5-212">Descodificación</span><span class="sxs-lookup"><span data-stu-id="daff5-212">Decoding</span></span>

<span data-ttu-id="daff5-213">Para crear el dispositivo descodificador, llame a [**ID3D11VideoDevice:: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span><span class="sxs-lookup"><span data-stu-id="daff5-213">To create the decoder device, call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span></span> <span data-ttu-id="daff5-214">El método devuelve un puntero a la interfaz [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) .</span><span class="sxs-lookup"><span data-stu-id="daff5-214">The method returns a pointer to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface.</span></span> <span data-ttu-id="daff5-215">La descodificación debe realizarse dentro del método [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="daff5-215">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="daff5-216">En cada fotograma, llame a [**IMFDXGIDeviceManager:: TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) para probar la disponibilidad de DXGI.</span><span class="sxs-lookup"><span data-stu-id="daff5-216">On each frame, call [**IMFDXGIDeviceManager::TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) to test the availability of the DXGI.</span></span> <span data-ttu-id="daff5-217">Si el dispositivo ha cambiado, el descodificador de software debe volver a crear el dispositivo descodificador, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="daff5-217">If the device has changed, the software decoder must recreate the decoder device, as follows:</span></span>

1.  <span data-ttu-id="daff5-218">Cierre el identificador del dispositivo mediante una llamada a [**IMFDXGIDeviceManager:: CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span><span class="sxs-lookup"><span data-stu-id="daff5-218">Close the device handle by calling [**IMFDXGIDeviceManager::CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span></span>
2.  <span data-ttu-id="daff5-219">Libera todos los recursos asociados con el dispositivo Direct3D 11 anterior, incluidas las interfaces [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d)y [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) .</span><span class="sxs-lookup"><span data-stu-id="daff5-219">Release all resources associated with the previous Direct3D 11 device, including the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d), and [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interfaces.</span></span>
3.  <span data-ttu-id="daff5-220">Abra un nuevo identificador de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="daff5-220">Open a new device handle.</span></span>
4.  <span data-ttu-id="daff5-221">Negocie una nueva configuración del descodificador, tal y como se describió anteriormente en [buscar una configuración de descodificador](#find-a-decoder-configuration).</span><span class="sxs-lookup"><span data-stu-id="daff5-221">Negotiate a new decoder configuration, as described previously in [Find a Decoder Configuration](#find-a-decoder-configuration).</span></span> <span data-ttu-id="daff5-222">Este paso es necesario porque es posible que las funcionalidades del dispositivo hayan cambiado.</span><span class="sxs-lookup"><span data-stu-id="daff5-222">This step is necessary because the device capabilities might have changed.</span></span>
5.  <span data-ttu-id="daff5-223">Cree un nuevo dispositivo descodificador.</span><span class="sxs-lookup"><span data-stu-id="daff5-223">Create a new decoder device.</span></span>

<span data-ttu-id="daff5-224">Suponiendo que el identificador del dispositivo es válido, el proceso de descodificación funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="daff5-224">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="daff5-225">Obtiene una superficie disponible que no está actualmente en uso.</span><span class="sxs-lookup"><span data-stu-id="daff5-225">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="daff5-226">Inicialmente, todas las superficies están disponibles.</span><span class="sxs-lookup"><span data-stu-id="daff5-226">Initially, all of the surfaces are available.</span></span>
2.  <span data-ttu-id="daff5-227">Consulte el ejemplo multimedia para la interfaz [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) .</span><span class="sxs-lookup"><span data-stu-id="daff5-227">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="daff5-228">Llame a [**IMFTrackedSample:: SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) y proporcione un puntero a la interfaz [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="daff5-228">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="daff5-229">(El descodificador de software debe implementar esta interfaz). Cuando el representador de vídeo libera el ejemplo, se invocará la devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="daff5-229">(The software decoder must implement this interface.) When the video renderer releases the sample, the callback will be invoked.</span></span> <span data-ttu-id="daff5-230">Utilice esta devolución de llamada para realizar un seguimiento de los ejemplos que están disponibles actualmente y que están en uso.</span><span class="sxs-lookup"><span data-stu-id="daff5-230">Use this callback to keep track of which samples are currently available and which are in use.</span></span>
4.  <span data-ttu-id="daff5-231">Llame a [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span><span class="sxs-lookup"><span data-stu-id="daff5-231">Call [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span></span> <span data-ttu-id="daff5-232">Pase los punteros a la interfaz [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) para el dispositivo descodificador y la interfaz [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) para la vista de salida.</span><span class="sxs-lookup"><span data-stu-id="daff5-232">Pass in the pointers to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface for the decoder device and the [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interface for the output view.</span></span>
5.  <span data-ttu-id="daff5-233">Haga lo siguiente una o varias veces:</span><span class="sxs-lookup"><span data-stu-id="daff5-233">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="daff5-234">Llame a [**ID3D11VideoContext:: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) para obtener un búfer.</span><span class="sxs-lookup"><span data-stu-id="daff5-234">Call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) to get a buffer.</span></span>
    2.  <span data-ttu-id="daff5-235">Rellene el búfer.</span><span class="sxs-lookup"><span data-stu-id="daff5-235">Fill the buffer.</span></span>
    3.  <span data-ttu-id="daff5-236">Llame a [**ID3D11VideoContext:: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="daff5-236">Call [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span>
    4.  <span data-ttu-id="daff5-237">Llame a [**ID3D11VideoContext:: SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span><span class="sxs-lookup"><span data-stu-id="daff5-237">Call [**ID3D11VideoContext::SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span></span> <span data-ttu-id="daff5-238">Este método indica al dispositivo descodificador que realice las operaciones de descodificación en el marco.</span><span class="sxs-lookup"><span data-stu-id="daff5-238">This method instructs the decoder device to perform the decoding operations on the frame.</span></span>
6.  <span data-ttu-id="daff5-239">Llame a [**ID3D11VideoContext::D ecoderendframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) para indicar el final de la descodificación del marco actual.</span><span class="sxs-lookup"><span data-stu-id="daff5-239">Call [**ID3D11VideoContext::DecoderEndFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) to signal the end of decoding for the current frame.</span></span>

<span data-ttu-id="daff5-240">Direct3D 11 usa las mismas estructuras de datos que DXVA 2,0 para las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="daff5-240">Direct3D 11 uses the same data structures as DXVA 2.0 for decoding operations.</span></span> <span data-ttu-id="daff5-241">En el conjunto original de perfiles de DXVA (para H. 261, H. 263 y MPEG-2), estas estructuras de datos se describen en la [especificación de DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration).</span><span class="sxs-lookup"><span data-stu-id="daff5-241">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="daff5-242">Dentro de cada par de llamadas a [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) y [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) , puede llamar a [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) varias veces, pero solo una vez para cada tipo de búfer.</span><span class="sxs-lookup"><span data-stu-id="daff5-242">Within each pair of [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) and [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) calls, you may call [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) multiple times, but only once for each type of buffer.</span></span> <span data-ttu-id="daff5-243">Si usa el mismo tipo de búfer dos veces sin llamar a **SubmitDecoderBuffer**, sobrescribirá los datos en el búfer.</span><span class="sxs-lookup"><span data-stu-id="daff5-243">If you use the same buffer type twice without calling **SubmitDecoderBuffer**, you will overwrite the data in the buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="daff5-244">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="daff5-244">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="daff5-245">API de vídeo de Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="daff5-245">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> <dt>

[<span data-ttu-id="daff5-246">Aceleración de vídeo de DirectX 2,0</span><span class="sxs-lookup"><span data-stu-id="daff5-246">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> </dl>

 

 
