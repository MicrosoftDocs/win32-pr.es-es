---
description: En este tema se describe cómo implementar un origen multimedia personalizado en Microsoft Media Foundation.
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: Escritura de un origen de medios personalizado
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "105707563"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="093b5-103">Escritura de un origen de medios personalizado</span><span class="sxs-lookup"><span data-stu-id="093b5-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="093b5-104">En este tema se describe cómo implementar un origen multimedia personalizado en Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="093b5-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="093b5-105">Contiene las secciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="093b5-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="093b5-106">Crear el descriptor de presentación</span><span class="sxs-lookup"><span data-stu-id="093b5-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="093b5-107">Inicio del origen del medio</span><span class="sxs-lookup"><span data-stu-id="093b5-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="093b5-108">Invoca</span><span class="sxs-lookup"><span data-stu-id="093b5-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="093b5-109">Pausar el origen de medios</span><span class="sxs-lookup"><span data-stu-id="093b5-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="093b5-110">Generar datos de origen</span><span class="sxs-lookup"><span data-stu-id="093b5-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="093b5-111">Solicitudes de ejemplo</span><span class="sxs-lookup"><span data-stu-id="093b5-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="093b5-112">Asignar ejemplos</span><span class="sxs-lookup"><span data-stu-id="093b5-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="093b5-113">Espacios en la secuencia</span><span class="sxs-lookup"><span data-stu-id="093b5-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="093b5-114">Apagar el origen del medio</span><span class="sxs-lookup"><span data-stu-id="093b5-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="093b5-115">Orígenes en directo</span><span class="sxs-lookup"><span data-stu-id="093b5-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="093b5-116">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="093b5-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="093b5-117">Crear el descriptor de presentación</span><span class="sxs-lookup"><span data-stu-id="093b5-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="093b5-118">El método [**IMFMediaSource:: CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) devuelve una copia del descriptor de presentación del origen.</span><span class="sxs-lookup"><span data-stu-id="093b5-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="093b5-119">Para crear el descriptor de presentación, debe conocer el número de flujos en el contenido de origen y los posibles formatos de cada flujo.</span><span class="sxs-lookup"><span data-stu-id="093b5-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="093b5-120">Para cada flujo, cree un descriptor de secuencia como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="093b5-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="093b5-121">Cree una matriz de tipos de medios.</span><span class="sxs-lookup"><span data-stu-id="093b5-121">Create an array of media types.</span></span> <span data-ttu-id="093b5-122">Cada tipo de medio de la matriz representa un posible formato para la secuencia.</span><span class="sxs-lookup"><span data-stu-id="093b5-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="093b5-123">Para obtener más información sobre la creación de tipos de medios, consulte [tipos de medios](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="093b5-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="093b5-124">Llame a [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) para crear el descriptor de flujo.</span><span class="sxs-lookup"><span data-stu-id="093b5-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="093b5-125">Pase la matriz de tipos de medios.</span><span class="sxs-lookup"><span data-stu-id="093b5-125">Pass in the array of media types.</span></span> <span data-ttu-id="093b5-126">La función devuelve un puntero [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="093b5-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="093b5-127">Llame a [**IMFStreamDescriptor:: GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) para obtener el controlador de tipo de medio del descriptor de flujo.</span><span class="sxs-lookup"><span data-stu-id="093b5-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="093b5-128">Llame a [**IMFMediaTypeHandler:: SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) para establecer el formato de flujo predeterminado.</span><span class="sxs-lookup"><span data-stu-id="093b5-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="093b5-129">Use uno de los tipos de medios que creó en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="093b5-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="093b5-130">Por lo general, debe usar el formato con la máxima calidad.</span><span class="sxs-lookup"><span data-stu-id="093b5-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="093b5-131">Opcionalmente, establezca atributos en el descriptor de flujo.</span><span class="sxs-lookup"><span data-stu-id="093b5-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="093b5-132">Para obtener una lista de los atributos que se aplican a los descriptores de flujo, vea [los atributos del descriptor de flujo](stream-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="093b5-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="093b5-133">Ahora cree el descriptor de presentación:</span><span class="sxs-lookup"><span data-stu-id="093b5-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="093b5-134">Llame a [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) y pase la matriz de descriptores de flujo.</span><span class="sxs-lookup"><span data-stu-id="093b5-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="093b5-135">La función devuelve un puntero [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="093b5-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="093b5-136">Elija la selección de flujo predeterminada llamando a [**IMFPresentationDescriptor:: SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) para seleccionar una o más secuencias.</span><span class="sxs-lookup"><span data-stu-id="093b5-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="093b5-137">Se debe seleccionar al menos un flujo en la configuración predeterminada.</span><span class="sxs-lookup"><span data-stu-id="093b5-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="093b5-138">Opcionalmente, establezca los atributos del descriptor de presentación.</span><span class="sxs-lookup"><span data-stu-id="093b5-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="093b5-139">Para obtener una lista de los atributos que se aplican a los descriptores de flujo, vea [atributos de descriptor de presentación](presentation-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="093b5-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="093b5-140">Debe crear el descriptor de presentación una vez, ya sea en el inicio o después de que el origen haya analizado lo suficiente de los datos de origen para determinar el contenido.</span><span class="sxs-lookup"><span data-stu-id="093b5-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="093b5-141">El método [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) debe devolver una copia del descriptor de presentación.</span><span class="sxs-lookup"><span data-stu-id="093b5-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="093b5-142">Para crear la copia, llame a [**IMFPresentationDescriptor:: Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span><span class="sxs-lookup"><span data-stu-id="093b5-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="093b5-143">Al devolver una copia, se evita que el cliente modifique el estado del descriptor de la presentación original, como los atributos o la selección de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="093b5-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="093b5-144">Sin embargo, tenga en cuenta que **Clone** crea una copia superficial, por lo que el cliente puede modificar potencialmente los descriptores de flujo subyacentes.</span><span class="sxs-lookup"><span data-stu-id="093b5-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="093b5-145">Inicio del origen del medio</span><span class="sxs-lookup"><span data-stu-id="093b5-145">Starting the Media Source</span></span>

<span data-ttu-id="093b5-146">El método [**IMFMediaSource:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) inicia el origen del medio o busca en una nueva posición.</span><span class="sxs-lookup"><span data-stu-id="093b5-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="093b5-147">Una llamada a **Start** produce una *búsqueda* cuando el estado anterior estaba en pausa o en ejecución y se especifica una nueva hora de inicio.</span><span class="sxs-lookup"><span data-stu-id="093b5-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="093b5-148">De lo contrario, el método **Start** produce un *Inicio*.</span><span class="sxs-lookup"><span data-stu-id="093b5-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="093b5-149">Cuando se complete la operación de **Inicio** , envíe los siguientes eventos.</span><span class="sxs-lookup"><span data-stu-id="093b5-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="093b5-150">Envíe un evento [MENewStream](menewstream.md) para cada nuevo flujo, es decir, cada secuencia que se canceló previamente y que ahora está seleccionada.</span><span class="sxs-lookup"><span data-stu-id="093b5-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="093b5-151">Los datos de evento son un puntero a la secuencia.</span><span class="sxs-lookup"><span data-stu-id="093b5-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="093b5-152">Envíe un evento [MEUpdatedStream](meupdatedstream.md) para cada flujo que se seleccionó previamente y que todavía está seleccionado.</span><span class="sxs-lookup"><span data-stu-id="093b5-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="093b5-153">Los datos de evento son un puntero a la secuencia.</span><span class="sxs-lookup"><span data-stu-id="093b5-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="093b5-154">(No envía un evento para secuencias no seleccionadas).</span><span class="sxs-lookup"><span data-stu-id="093b5-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="093b5-155">Si el origen está buscando, envíe un evento [MESourceSeeked](mesourceseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="093b5-156">De lo contrario, envíe un evento [MESourceStarted](mesourcestarted.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="093b5-157">Los datos de evento son la hora de inicio que se especificó en el método de [**Inicio**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) .</span><span class="sxs-lookup"><span data-stu-id="093b5-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="093b5-158">En el caso del evento MESourceStarted, si la hora de inicio es VT \_ vacío, establezca el atributo de [**\_ \_ \_ \_ Inicio real del origen de eventos MF**](mf-event-source-actual-start-attribute.md) en el evento.</span><span class="sxs-lookup"><span data-stu-id="093b5-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="093b5-159">El valor del atributo es la hora de inicio real.</span><span class="sxs-lookup"><span data-stu-id="093b5-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="093b5-160">En cada flujo, si el origen está buscando, envíe un evento [MEStreamSeeked](mestreamseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="093b5-161">De lo contrario, envíe un evento [MEStreamStarted](mestreamstarted.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="093b5-162">Los datos del evento son la hora de inicio.</span><span class="sxs-lookup"><span data-stu-id="093b5-162">The event data is the start time.</span></span> <span data-ttu-id="093b5-163">(El origen multimedia puede poner en cola un evento en la secuencia llamando al método [**IMFMediaEventGenerator:: QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) del flujo).</span><span class="sxs-lookup"><span data-stu-id="093b5-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="093b5-164">Cuando se anule la selección de una secuencia, ciérrela.</span><span class="sxs-lookup"><span data-stu-id="093b5-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="093b5-165">La secuencia no debe poner en cola más eventos en ese momento.</span><span class="sxs-lookup"><span data-stu-id="093b5-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="093b5-166">El formato de hora para el método [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) se proporciona en el parámetro *pguidTimeFormat* .</span><span class="sxs-lookup"><span data-stu-id="093b5-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="093b5-167">El formato de hora estándar, indicado por el **GUID \_ null**, es de 100 a nanosegundos.</span><span class="sxs-lookup"><span data-stu-id="093b5-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="093b5-168">Un origen multimedia debe admitir este formato de hora.</span><span class="sxs-lookup"><span data-stu-id="093b5-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="093b5-169">Invoca</span><span class="sxs-lookup"><span data-stu-id="093b5-169">Seeking</span></span>

<span data-ttu-id="093b5-170">Al buscar, la posición de inicio solicitada podría no estar en un límite de ejemplo exacto.</span><span class="sxs-lookup"><span data-stu-id="093b5-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="093b5-171">Además, para el contenido comprimido, la posición inicial puede estar entre fotogramas clave.</span><span class="sxs-lookup"><span data-stu-id="093b5-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="093b5-172">Un flujo debe proporcionar ejemplos del primer punto necesario para generar un ejemplo sin comprimir en la posición de inicio solicitada.</span><span class="sxs-lookup"><span data-stu-id="093b5-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="093b5-173">En el caso de vídeo, eso significa que se inicia desde el fotograma clave anterior.</span><span class="sxs-lookup"><span data-stu-id="093b5-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="093b5-174">La canalización es responsable de quitar los fotogramas adicionales del descodificador, de modo que la reproducción se inicia a la hora solicitada.</span><span class="sxs-lookup"><span data-stu-id="093b5-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="093b5-175">La hora de inicio dada en los eventos de origen ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md)y [MEStreamSeeked](mestreamseeked.md)) es la hora de inicio solicitada (el valor proporcionado en el método de [**Inicio**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) ), independientemente de la posición inicial real.</span><span class="sxs-lookup"><span data-stu-id="093b5-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="093b5-176">Por ejemplo, supongamos que los primeros fotogramas de un flujo de vídeo tienen las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="093b5-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="093b5-177">Muestra</span><span class="sxs-lookup"><span data-stu-id="093b5-177">Sample</span></span>     | <span data-ttu-id="093b5-178">1</span><span class="sxs-lookup"><span data-stu-id="093b5-178">1</span></span>       | <span data-ttu-id="093b5-179">2</span><span class="sxs-lookup"><span data-stu-id="093b5-179">2</span></span>       | <span data-ttu-id="093b5-180">3</span><span class="sxs-lookup"><span data-stu-id="093b5-180">3</span></span>        | <span data-ttu-id="093b5-181">4</span><span class="sxs-lookup"><span data-stu-id="093b5-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="093b5-182">Time</span><span class="sxs-lookup"><span data-stu-id="093b5-182">Time</span></span>       | <span data-ttu-id="093b5-183">33 MS</span><span class="sxs-lookup"><span data-stu-id="093b5-183">33 msec</span></span> | <span data-ttu-id="093b5-184">66 MS</span><span class="sxs-lookup"><span data-stu-id="093b5-184">66 msec</span></span> | <span data-ttu-id="093b5-185">100 ms</span><span class="sxs-lookup"><span data-stu-id="093b5-185">100 msec</span></span> | <span data-ttu-id="093b5-186">133 MS</span><span class="sxs-lookup"><span data-stu-id="093b5-186">133 msec</span></span> |
| <span data-ttu-id="093b5-187">¿Fotograma clave?</span><span class="sxs-lookup"><span data-stu-id="093b5-187">Key frame?</span></span> | <span data-ttu-id="093b5-188">Sí</span><span class="sxs-lookup"><span data-stu-id="093b5-188">Yes</span></span>     | <span data-ttu-id="093b5-189">No</span><span class="sxs-lookup"><span data-stu-id="093b5-189">No</span></span>      | <span data-ttu-id="093b5-190">No</span><span class="sxs-lookup"><span data-stu-id="093b5-190">No</span></span>       | <span data-ttu-id="093b5-191">Sí</span><span class="sxs-lookup"><span data-stu-id="093b5-191">Yes</span></span>      |



 

<span data-ttu-id="093b5-192">Si se llama al método [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) con un valor de 100 milisegundos, el origen debe generar el vídeo a partir del fotograma 1, el primer fotograma clave antes de este tiempo.</span><span class="sxs-lookup"><span data-stu-id="093b5-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="093b5-193">El evento de inicio seguirá indicando 100 milisegundos en los datos de evento.</span><span class="sxs-lookup"><span data-stu-id="093b5-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="093b5-194">Pausar el origen de medios</span><span class="sxs-lookup"><span data-stu-id="093b5-194">Pausing the Media Source</span></span>

<span data-ttu-id="093b5-195">El método [**IMFMediaSource::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) pone en pausa el origen del medio.</span><span class="sxs-lookup"><span data-stu-id="093b5-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="093b5-196">Mientras el origen está en pausa, una secuencia puede crear muestras nuevas y almacenarlas en una cola, pero la secuencia no entrega los ejemplos.</span><span class="sxs-lookup"><span data-stu-id="093b5-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="093b5-197">Estas son algunas excepciones a esta regla:</span><span class="sxs-lookup"><span data-stu-id="093b5-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="093b5-198">Los orígenes en directo deben quitar los datos mientras están en pausa.</span><span class="sxs-lookup"><span data-stu-id="093b5-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="093b5-199">Si el origen obtiene datos de una red, es posible que PAUSE el servidor.</span><span class="sxs-lookup"><span data-stu-id="093b5-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="093b5-200">Si el cliente llama a [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) mientras el origen está en pausa, la solicitud también se pone en cola hasta que se inicia de nuevo el origen.</span><span class="sxs-lookup"><span data-stu-id="093b5-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="093b5-201">No se deben quitar las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="093b5-201">Requests should not be dropped.</span></span>

<span data-ttu-id="093b5-202">Solo se permite pausar desde el estado Iniciado.</span><span class="sxs-lookup"><span data-stu-id="093b5-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="093b5-203">De lo contrario, [**PAUSE**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) debe devolver la **\_ \_ \_ \_ transición de estado no válida MF E**.</span><span class="sxs-lookup"><span data-stu-id="093b5-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="093b5-204">Generar datos de origen</span><span class="sxs-lookup"><span data-stu-id="093b5-204">Generating Source Data</span></span>

<span data-ttu-id="093b5-205">Media Foundation usa un *modelo de extracción*, lo que significa que las secuencias generan y proporcionan ejemplos en respuesta a las solicitudes de la canalización.</span><span class="sxs-lookup"><span data-stu-id="093b5-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="093b5-206">Un flujo puede proporcionar ejemplos cuando se está ejecutando el origen multimedia y se selecciona la secuencia.</span><span class="sxs-lookup"><span data-stu-id="093b5-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="093b5-207">Un flujo solo entrega datos cuando el cliente solicita un nuevo ejemplo.</span><span class="sxs-lookup"><span data-stu-id="093b5-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="093b5-208">Solicitudes de ejemplo</span><span class="sxs-lookup"><span data-stu-id="093b5-208">Sample Requests</span></span>

<span data-ttu-id="093b5-209">El cliente solicita un nuevo ejemplo llamando a [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="093b5-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="093b5-210">Esta es la secuencia de operaciones:</span><span class="sxs-lookup"><span data-stu-id="093b5-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="093b5-211">El cliente llama a [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="093b5-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="093b5-212">El argumento es un puntero a un objeto de *token* opcional que el cliente utiliza para realizar el seguimiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="093b5-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="093b5-213">El cliente implementa el token.</span><span class="sxs-lookup"><span data-stu-id="093b5-213">The client implements the token.</span></span> <span data-ttu-id="093b5-214">Los tokens deben exponer la interfaz **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="093b5-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="093b5-215">El cliente también puede pasar un puntero NULL en lugar de un token.</span><span class="sxs-lookup"><span data-stu-id="093b5-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="093b5-216">Si el cliente proporcionó un token, el flujo multimedia llama a **AddRef** en el token y coloca el token en una cola de primero en salir, primero en salir.</span><span class="sxs-lookup"><span data-stu-id="093b5-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="093b5-217">El método devuelve y el resto de los pasos se producen de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="093b5-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="093b5-218">Cuando hay más datos disponibles, el flujo multimedia crea un nuevo ejemplo.</span><span class="sxs-lookup"><span data-stu-id="093b5-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="093b5-219">(Este paso se describe con más detalle en la sección siguiente).</span><span class="sxs-lookup"><span data-stu-id="093b5-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="093b5-220">El flujo multimedia extrae el primer token de la cola.</span><span class="sxs-lookup"><span data-stu-id="093b5-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="093b5-221">Si el token no es **null**, el flujo de medios establece el atributo de [**\_ token MFSampleExtension**](mfsampleextension-token-attribute.md) en el ejemplo multimedia.</span><span class="sxs-lookup"><span data-stu-id="093b5-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="093b5-222">El valor del atributo es un puntero al token.</span><span class="sxs-lookup"><span data-stu-id="093b5-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="093b5-223">El flujo multimedia envía un evento [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="093b5-224">Los datos de evento son un puntero a la interfaz [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) del ejemplo.</span><span class="sxs-lookup"><span data-stu-id="093b5-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="093b5-225">Si el cliente proporcionó un token, el flujo multimedia llama a **Release** en el objeto de token.</span><span class="sxs-lookup"><span data-stu-id="093b5-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="093b5-226">Si el flujo multimedia no puede satisfacer la solicitud de [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) del cliente, extrae el token de la cola y llama a **Release** en el token, pero no envía un evento [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="093b5-227">El cliente puede usar el token para hacer un seguimiento del estado de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="093b5-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="093b5-228">Cuando el cliente recibe el evento [MEMediaSample](memediasample.md) , puede obtener el token del ejemplo y hacer coincidir con la solicitud original.</span><span class="sxs-lookup"><span data-stu-id="093b5-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="093b5-229">El cliente también puede usar el token para detectar si el origen de medios ha quitado la solicitud.</span><span class="sxs-lookup"><span data-stu-id="093b5-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="093b5-230">Si el recuento de referencias del token es cero y el flujo multimedia no envía un evento MEMediaSample, significa que la solicitud se ha quitado.</span><span class="sxs-lookup"><span data-stu-id="093b5-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="093b5-231">En los pasos que se enumeran aquí se supone que el método [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) se implementa como una operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="093b5-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="093b5-232">Si el método es sincrónico, no es necesario colocar el token de solicitud en una cola.</span><span class="sxs-lookup"><span data-stu-id="093b5-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="093b5-233">Sin embargo, si la generación de datos tarda bastante tiempo, se recomienda un enfoque asincrónico, por ejemplo, si el origen lee datos de un flujo de bytes.</span><span class="sxs-lookup"><span data-stu-id="093b5-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="093b5-234">La secuencia es responsable del almacenamiento en búfer de los datos que se acumulan entre las llamadas a [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="093b5-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="093b5-235">Cuando el flujo multimedia alcanza el final de la secuencia, envía un evento [MEEndOfStream](meendofstream.md) después del último ejemplo.</span><span class="sxs-lookup"><span data-stu-id="093b5-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="093b5-236">Una vez finalizada cada secuencia, el origen del medio envía un evento [MEEndOfPresentation](meendofpresentation.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="093b5-237">Después de que una secuencia de medios envíe el evento MEEndOfStream, el método [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) devuelve el **\_ \_ fin \_ de la \_ secuencia MF E** hasta que se reinicia el origen.</span><span class="sxs-lookup"><span data-stu-id="093b5-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="093b5-238">Asignar ejemplos</span><span class="sxs-lookup"><span data-stu-id="093b5-238">Allocating Samples</span></span>

<span data-ttu-id="093b5-239">Cuando el flujo está listo para rellenar una solicitud de ejemplo pendiente, crea un nuevo ejemplo y agrega uno o más búferes multimedia al ejemplo.</span><span class="sxs-lookup"><span data-stu-id="093b5-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="093b5-240">Para obtener más información sobre la creación de búferes multimedia, consulte [búferes multimedia](media-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="093b5-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="093b5-241">La secuencia debe establecer la marca de tiempo y la duración, si se conoce.</span><span class="sxs-lookup"><span data-stu-id="093b5-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="093b5-242">La marca de tiempo es relativa al origen.</span><span class="sxs-lookup"><span data-stu-id="093b5-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="093b5-243">En la mayoría de los casos, el inicio del contenido corresponde a una marca de tiempo de cero.</span><span class="sxs-lookup"><span data-stu-id="093b5-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="093b5-244">Por ejemplo, si el origen lee desde un archivo multimedia, el inicio del archivo tendría una marca de tiempo de cero.</span><span class="sxs-lookup"><span data-stu-id="093b5-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="093b5-245">La marca de tiempo en el ejemplo no es necesariamente igual al tiempo de presentación.</span><span class="sxs-lookup"><span data-stu-id="093b5-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="093b5-246">La sesión multimedia se traduce del tiempo de origen al tiempo de presentación.</span><span class="sxs-lookup"><span data-stu-id="093b5-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="093b5-247">En el caso de los datos comprimidos, el flujo debe generar datos a partir del fotograma clave más cercano antes de la hora de inicio.</span><span class="sxs-lookup"><span data-stu-id="093b5-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="093b5-248">Esto permite que el descodificador entregue el marco que aparece en la hora de inicio solicitada.</span><span class="sxs-lookup"><span data-stu-id="093b5-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="093b5-249">(De lo contrario, el descodificador debe esperar hasta el siguiente fotograma clave).</span><span class="sxs-lookup"><span data-stu-id="093b5-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="093b5-250">Si la velocidad de reproducción es mayor o menor que 1,0, la canalización ajusta la velocidad del reloj de la presentación.</span><span class="sxs-lookup"><span data-stu-id="093b5-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="093b5-251">El origen no ajusta las marcas de tiempo en las muestras.</span><span class="sxs-lookup"><span data-stu-id="093b5-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="093b5-252">El origen puede establecer información adicional sobre el ejemplo mediante el establecimiento de atributos.</span><span class="sxs-lookup"><span data-stu-id="093b5-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="093b5-253">Para obtener una lista de los atributos de ejemplo, vea [atributos de ejemplo](sample-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="093b5-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="093b5-254">Espacios en la secuencia</span><span class="sxs-lookup"><span data-stu-id="093b5-254">Gaps in the Stream</span></span>

<span data-ttu-id="093b5-255">Si una secuencia contiene un intervalo de longitud significativa, se recomienda que el flujo envíe un evento [MEStreamTick](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="093b5-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="093b5-256">Este evento notifica al cliente que falta un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="093b5-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="093b5-257">Los datos de evento son la marca de tiempo de la muestra que falta, en unidades de 100-nanosegundos (**VT \_ i8**).</span><span class="sxs-lookup"><span data-stu-id="093b5-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="093b5-258">Este evento puede guardar los componentes de nivel inferior desde la espera de las muestras que no llegarán.</span><span class="sxs-lookup"><span data-stu-id="093b5-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="093b5-259">El flujo puede enviar tantos eventos MEStreamTick como sea necesario para abarcar la brecha en la secuencia.</span><span class="sxs-lookup"><span data-stu-id="093b5-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="093b5-260">Apagar el origen del medio</span><span class="sxs-lookup"><span data-stu-id="093b5-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="093b5-261">Cuando el cliente se realiza mediante el origen de medios, llama a [**IMFMediaSource:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span><span class="sxs-lookup"><span data-stu-id="093b5-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="093b5-262">Dentro de este método, el origen de medios debe romper cualquier recuento de referencias circulares.</span><span class="sxs-lookup"><span data-stu-id="093b5-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="093b5-263">Normalmente, habrá referencias circulares entre el origen multimedia y los flujos multimedia.</span><span class="sxs-lookup"><span data-stu-id="093b5-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="093b5-264">Si usa la cola de eventos para implementar [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), llame a [**IMFMediaEventQueue:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) en la cola de eventos.</span><span class="sxs-lookup"><span data-stu-id="093b5-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="093b5-265">Este método cierra la cola de eventos y señala cualquier llamador que esté esperando actualmente un evento.</span><span class="sxs-lookup"><span data-stu-id="093b5-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="093b5-266">Después del apagado, todos los métodos del origen devuelven el **\_ \_ cierre de MF E**, con la excepción de los métodos **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="093b5-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="093b5-267">Orígenes en directo</span><span class="sxs-lookup"><span data-stu-id="093b5-267">Live Sources</span></span>

<span data-ttu-id="093b5-268">A partir de Windows 7, Media Foundation admite automáticamente dispositivos de captura de audio y vídeo.</span><span class="sxs-lookup"><span data-stu-id="093b5-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="093b5-269">En el caso de vídeo, el dispositivo debe proporcionar un minicontrolador de streaming de kernel (KS) en la categoría captura de vídeo.</span><span class="sxs-lookup"><span data-stu-id="093b5-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="093b5-270">Media Foundation usa la ruta de acceso de PnP para enumerar el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="093b5-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="093b5-271">En el caso de audio, Media Foundation usa la API de dispositivo multimedia de Windows (MMDevice) para enumerar los dispositivos de punto de conexión de audio.</span><span class="sxs-lookup"><span data-stu-id="093b5-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="093b5-272">Si el dispositivo cumple estos criterios, no es necesario implementar un origen de medios personalizado.</span><span class="sxs-lookup"><span data-stu-id="093b5-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="093b5-273">Sin embargo, es posible que desee implementar un origen de medios personalizado para algún otro tipo de dispositivo u otro origen de datos en directo.</span><span class="sxs-lookup"><span data-stu-id="093b5-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="093b5-274">Solo hay algunas diferencias entre un origen en directo y otros orígenes multimedia:</span><span class="sxs-lookup"><span data-stu-id="093b5-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="093b5-275">En el método [**IMFMediaSource:: GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) , devuelve **MFMEDIASOURCE \_ es \_ Live** Flag.</span><span class="sxs-lookup"><span data-stu-id="093b5-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="093b5-276">El primer ejemplo debe tener una marca de tiempo de cero.</span><span class="sxs-lookup"><span data-stu-id="093b5-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="093b5-277">Los eventos y los Estados de streaming se administran igual que los orígenes de medios, con la excepción del estado de pausa.</span><span class="sxs-lookup"><span data-stu-id="093b5-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="093b5-278">Mientras está en pausa, no poner en cola ejemplos.</span><span class="sxs-lookup"><span data-stu-id="093b5-278">While paused, do not queue samples.</span></span> <span data-ttu-id="093b5-279">Quitar los datos que se generan mientras están en pausa.</span><span class="sxs-lookup"><span data-stu-id="093b5-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="093b5-280">Los orígenes en directo normalmente no admiten la búsqueda, la reproducción inversa o el control de velocidad.</span><span class="sxs-lookup"><span data-stu-id="093b5-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="093b5-281">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="093b5-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="093b5-282">Orígenes multimedia</span><span class="sxs-lookup"><span data-stu-id="093b5-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="093b5-283">Tutorial: escribir un origen de medios personalizado</span><span class="sxs-lookup"><span data-stu-id="093b5-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



