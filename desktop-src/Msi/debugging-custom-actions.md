---
description: Puede depurar acciones personalizadas basadas en bibliotecas de vínculos dinámicos mediante herramientas de depuración para Windows. No es posible usar la depuración dinámica con acciones personalizadas basadas en archivos ejecutables o scripts.
ms.assetid: 4241a27a-c127-4c65-96a2-1d655b343eba
title: Depuración de acciones personalizadas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ddfbc9952f0dd7fc1b85b5c64fa6a23381ceafe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105667810"
---
# <a name="debugging-custom-actions"></a><span data-ttu-id="a59ad-104">Depuración de acciones personalizadas</span><span class="sxs-lookup"><span data-stu-id="a59ad-104">Debugging Custom Actions</span></span>

<span data-ttu-id="a59ad-105">Puede depurar acciones personalizadas basadas en [bibliotecas de vínculos dinámicos](dynamic-link-libraries.md) mediante [herramientas de depuración para Windows](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="a59ad-105">You can debug custom actions that are based on [dynamic-link libraries](dynamic-link-libraries.md) by using [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span> <span data-ttu-id="a59ad-106">No es posible usar la depuración dinámica con acciones personalizadas basadas en [archivos ejecutables](executable-files.md) o [scripts](scripts.md).</span><span class="sxs-lookup"><span data-stu-id="a59ad-106">It is not possible to use dynamic debugging with custom actions based on [executable files](executable-files.md) or [scripts](scripts.md).</span></span>

<span data-ttu-id="a59ad-107">Las técnicas descritas en esta sección pueden ayudarle a depurar Windows Installer acciones personalizadas.</span><span class="sxs-lookup"><span data-stu-id="a59ad-107">The techniques described in this section can help you debug Windows Installer custom actions.</span></span> <span data-ttu-id="a59ad-108">Consulte la sección herramientas de desarrollo de controladores de Windows Driver Kit (WDK) para obtener información sobre [las herramientas de depuración para Windows](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="a59ad-108">See the Driver Development Tools section of the Windows Driver Kit (WDK) for information about [Debugging Tools for Windows](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="a59ad-109">Windows Installer usa la variable de entorno MsiBreak para determinar la acción personalizada que se va a depurar.</span><span class="sxs-lookup"><span data-stu-id="a59ad-109">Windows Installer uses the MsiBreak environment variable to determine which custom action is to be debugged.</span></span> <span data-ttu-id="a59ad-110">Si tiene acceso al código fuente de la acción personalizada, es posible que pueda usar la depuración sin MsiBreak.</span><span class="sxs-lookup"><span data-stu-id="a59ad-110">If you have access to the custom action's source code, you may be able to use debugging without MsiBreak.</span></span> <span data-ttu-id="a59ad-111">Para iniciar la depuración sin MsiBreak, coloque un cuadro de mensaje temporal al principio del código de la acción.</span><span class="sxs-lookup"><span data-stu-id="a59ad-111">To start debugging without MsiBreak, put a temporary message box at the beginning of the action's code.</span></span> <span data-ttu-id="a59ad-112">Cuando aparezca el cuadro de mensaje durante la instalación, adjunte el depurador al proceso que posee el cuadro de mensaje.</span><span class="sxs-lookup"><span data-stu-id="a59ad-112">When the message box appears during the installation, attach the debugger to the process owning the message box.</span></span> <span data-ttu-id="a59ad-113">Después, puede establecer los puntos de interrupción necesarios y descartar el cuadro de mensaje para reanudar la ejecución.</span><span class="sxs-lookup"><span data-stu-id="a59ad-113">You can then set any necessary breakpoints and dismiss the message box to resume execution.</span></span> <span data-ttu-id="a59ad-114">Este método no puede depurar las partes anteriores de la acción personalizada.</span><span class="sxs-lookup"><span data-stu-id="a59ad-114">It is not possible to debug the earlier portions of the custom action by this method.</span></span>

<span data-ttu-id="a59ad-115">Para usar la variable de entorno MsiBreak para depurar la acción personalizada, establezca MsiBreak en el nombre de la acción personalizada en la [tabla CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="a59ad-115">To use the MsiBreak environment variable to debug the custom action, set MsiBreak to the custom action's name in the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="a59ad-116">MsiBreak puede ser una variable de entorno de sistema o de usuario.</span><span class="sxs-lookup"><span data-stu-id="a59ad-116">MsiBreak can be either a system or a user environment variable.</span></span> <span data-ttu-id="a59ad-117">Si la variable se establece como una variable del sistema, es posible que sea necesario reiniciar el sistema cuando se cambie el valor para detectar el nuevo valor.</span><span class="sxs-lookup"><span data-stu-id="a59ad-117">If the variable is set as a system variable, a restart of the system may be needed when the value is changed to detect the new value.</span></span>

<span data-ttu-id="a59ad-118">Para usar la variable de entorno MsiBreak para depurar una interfaz de usuario incrustada, establezca el valor de MsiBreak en MsiEmbeddedUI.</span><span class="sxs-lookup"><span data-stu-id="a59ad-118">To use the MsiBreak environment variable to debug an embedded user interface, set the value of MsiBreak to MsiEmbeddedUI.</span></span>

<span data-ttu-id="a59ad-119">Windows Installer solo comprueba la variable de entorno MsiBreak si el usuario es un administrador.</span><span class="sxs-lookup"><span data-stu-id="a59ad-119">Windows Installer only checks the MsiBreak environment variable if the user is an Administrator.</span></span> <span data-ttu-id="a59ad-120">El instalador omite el valor de MsiBreak si el usuario no es un administrador, aunque se trata de una [*aplicación administrada*](m-gly.md).</span><span class="sxs-lookup"><span data-stu-id="a59ad-120">The installer ignores the value of MsiBreak if the user is not an Administrator, even if this is a [*managed application*](m-gly.md).</span></span>

<span data-ttu-id="a59ad-121">Si está depurando una acción personalizada que se ejecuta con privilegios elevados (del sistema) en la secuencia de ejecución, asocie el depurador al servicio Windows Installer.</span><span class="sxs-lookup"><span data-stu-id="a59ad-121">If you are debugging a custom action that runs with elevated (system) privileges in the execution sequence, attach the debugger to the Windows Installer service.</span></span> <span data-ttu-id="a59ad-122">Al depurar una acción personalizada que se ejecuta con privilegios suplantados en la secuencia de ejecución, el sistema solicita un cuadro de diálogo que indica qué proceso se debe depurar.</span><span class="sxs-lookup"><span data-stu-id="a59ad-122">When debugging a custom action that runs with impersonated privileges in the execution sequence, the system prompts with a dialog box that indicates which process should be debugged.</span></span> <span data-ttu-id="a59ad-123">Se muestra al usuario un cuadro de diálogo que indica el proceso que se va a depurar.</span><span class="sxs-lookup"><span data-stu-id="a59ad-123">The user is prompted with a dialog box indicating which process to debug.</span></span> <span data-ttu-id="a59ad-124">Para obtener más información sobre las acciones personalizadas elevadas, vea seguridad de la [acción personalizada](custom-action-security.md).</span><span class="sxs-lookup"><span data-stu-id="a59ad-124">For more information about elevated custom actions, see [Custom Action Security](custom-action-security.md).</span></span>

<span data-ttu-id="a59ad-125">Una vez que el depurador se ha adjuntado al proceso correcto, el instalador desencadena un punto de interrupción del depurador inmediatamente antes de llamar al punto de entrada del archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="a59ad-125">Once the debugger has been attached to the correct process, the installer triggers a debugger breakpoint immediately before calling the entry point of the DLL.</span></span> <span data-ttu-id="a59ad-126">En el punto de interrupción, el archivo DLL ya está cargado en el proceso y se ha determinado la dirección del punto de entrada.</span><span class="sxs-lookup"><span data-stu-id="a59ad-126">At the breakpoint, your DLL is already loaded into the process and the entry point address determined.</span></span> <span data-ttu-id="a59ad-127">Si no se pudo cargar el archivo DLL de acción personalizada o no existe el punto de entrada de la acción personalizada, no se desencadena ningún punto de interrupción.</span><span class="sxs-lookup"><span data-stu-id="a59ad-127">If your custom action DLL could not be loaded or the custom action entry point did not exist, no breakpoint is triggered.</span></span> <span data-ttu-id="a59ad-128">Dado que el punto de interrupción se desencadena antes de llamar a la función DLL, una vez que se ha desencadenado el punto de interrupción, se debe usar el depurador para avanzar hasta que se llame al punto de entrada de la acción personalizada.</span><span class="sxs-lookup"><span data-stu-id="a59ad-128">Because the breakpoint is triggered before calling the DLL function, once the breakpoint has been triggered you should use your debugger to step forward until your custom action entry point is called.</span></span> <span data-ttu-id="a59ad-129">Como alternativa, puede establecer un punto de interrupción en cualquier parte de la acción personalizada y reanudar la ejecución normal.</span><span class="sxs-lookup"><span data-stu-id="a59ad-129">Alternately, you can set a breakpoint anywhere in your custom action and resume normal execution.</span></span>

<span data-ttu-id="a59ad-130">El Windows Installer ejecuta archivos dll no almacenados en la [tabla binaria](binary-table.md) directamente desde la ubicación del archivo dll.</span><span class="sxs-lookup"><span data-stu-id="a59ad-130">The Windows Installer executes DLLs not stored in the [Binary table](binary-table.md) directly from the DLL location.</span></span> <span data-ttu-id="a59ad-131">El instalador no conoce el nombre original de un archivo DLL almacenado en la tabla binaria y ejecuta la acción personalizada DLL bajo un nombre de archivo temporal.</span><span class="sxs-lookup"><span data-stu-id="a59ad-131">The installer does not know the original name of a DLL stored in the Binary table and runs the DLL custom action under a temporary file name.</span></span> <span data-ttu-id="a59ad-132">El formato del nombre de archivo temporal es MSI?????. Gestión.</span><span class="sxs-lookup"><span data-stu-id="a59ad-132">The form of the temporary file name is MSI?????.TMP.</span></span> <span data-ttu-id="a59ad-133">En Windows XP, este archivo temporal se almacena en una ubicación segura, normalmente en el <WindowFolder> \\ instalador.</span><span class="sxs-lookup"><span data-stu-id="a59ad-133">On Windows XP, this temporary file is stored in a secure location, commonly <WindowFolder>\\Installer.</span></span>

<span data-ttu-id="a59ad-134">Tenga en cuenta que muchos archivos dll creados para depuración contienen el nombre y la ruta de acceso del archivo PDB correspondiente como parte del propio archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="a59ad-134">Note that many DLLs created for debugging contain the name and path of the corresponding PDB file as part of the DLL itself.</span></span> <span data-ttu-id="a59ad-135">Al depurar este tipo de archivo DLL en un sistema en el que se puede encontrar la PDB en la ubicación almacenada en el archivo DLL, la herramienta de depurador puede cargar símbolos automáticamente.</span><span class="sxs-lookup"><span data-stu-id="a59ad-135">When debugging this type of DLL on a system where the PDB can be found at the location stored in the DLL, symbols may be loaded automatically by the debugger tool.</span></span> <span data-ttu-id="a59ad-136">En situaciones en las que el archivo PDB no puede encontrarse en la ubicación almacenada, donde el depurador no admite la carga de símbolos desde la ubicación almacenada o donde la DLL no se compiló con información de depuración, puede que tenga que colocar los archivos de símbolos en la carpeta con el archivo DLL temporal.</span><span class="sxs-lookup"><span data-stu-id="a59ad-136">In situations where the PDB cannot be found at the stored location, where the debugger does not support loading symbols from the stored location, or where the DLL was not built with debugging information, you may need to place your symbol files in the folder with the temporary DLL file.</span></span>

<span data-ttu-id="a59ad-137">El instalador agrega información de depuración para los scripts de acción personalizada al archivo de registro de instalación.</span><span class="sxs-lookup"><span data-stu-id="a59ad-137">The installer adds debugging information for custom action scripts to the installation log file.</span></span>

``` syntax
There is a problem with this Windows Installer package. A script 
required for this install to complete could not be run. Contact your 
support personnel or package vendor.  {Custom action [2] script error 
[3], [4]: [5] Line [6], Column [7], [8] }
```

 

 



