---
description: Procesamiento de datos
ms.assetid: 823615df-ce50-4e20-957a-f83d3be66658
title: Procesamiento de datos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bbece449df36c2de88414f313d477b8a16ba896
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "105677147"
---
# <a name="processing-data"></a><span data-ttu-id="a98c6-103">Procesamiento de datos</span><span class="sxs-lookup"><span data-stu-id="a98c6-103">Processing Data</span></span>

<span data-ttu-id="a98c6-104">**Analizar datos multimedia**</span><span class="sxs-lookup"><span data-stu-id="a98c6-104">**Parsing Media Data**</span></span>

<span data-ttu-id="a98c6-105">Si el filtro analiza datos multimedia, no confíe en encabezados u otros datos autodescriptivos en el contenido.</span><span class="sxs-lookup"><span data-stu-id="a98c6-105">If your filter parses media data, do not trust headers or other self-describing data in the content.</span></span> <span data-ttu-id="a98c6-106">Por ejemplo, no confíe en los valores de tamaño que aparecen en fragmentos o paquetes MPEG RIFF de AVI.</span><span class="sxs-lookup"><span data-stu-id="a98c6-106">For example, do not trust size values that appear in AVI RIFF chunks or MPEG packets.</span></span> <span data-ttu-id="a98c6-107">Algunos ejemplos comunes de este tipo de error son:</span><span class="sxs-lookup"><span data-stu-id="a98c6-107">Common examples of this kind of error include:</span></span>

-   <span data-ttu-id="a98c6-108">Lectura de *n* bytes de datos, donde el valor de *n* procedía del contenido, sin comprobar si el tamaño real del búfer *es n.*</span><span class="sxs-lookup"><span data-stu-id="a98c6-108">Reading *N* bytes of data, where the value of *N* came from the content, without checking *N* against the actual size of your buffer.</span></span>
-   <span data-ttu-id="a98c6-109">Saltar a un desplazamiento de bytes dentro de un búfer, sin comprobar que el desplazamiento está dentro del búfer.</span><span class="sxs-lookup"><span data-stu-id="a98c6-109">Jumping to a byte offset within a buffer, without verifying that the offset falls within the buffer.</span></span>

<span data-ttu-id="a98c6-110">Otra clase común de errores implica no validar las descripciones de formato que se encuentran en el contenido.</span><span class="sxs-lookup"><span data-stu-id="a98c6-110">Another common class of errors involves not validating format descriptions that are found in the content.</span></span> <span data-ttu-id="a98c6-111">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="a98c6-111">For example:</span></span>

-   <span data-ttu-id="a98c6-112">Una estructura [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) puede ir seguida de una tabla de colores.</span><span class="sxs-lookup"><span data-stu-id="a98c6-112">A [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) structure can be followed by a color table.</span></span> <span data-ttu-id="a98c6-113">La estructura **bitmapinfo (** se define como una estructura **BITMAPINFOHEADER** seguida de una matriz de valores **RGBQUAD** que forman la tabla de colores.</span><span class="sxs-lookup"><span data-stu-id="a98c6-113">The **BITMAPINFO** structure is defined as a **BITMAPINFOHEADER** structure followed by an array of **RGBQUAD** values that make up the color table.</span></span> <span data-ttu-id="a98c6-114">El tamaño de la matriz viene determinado por el valor de **biClrUsed**.</span><span class="sxs-lookup"><span data-stu-id="a98c6-114">The size of the array is determined by the value of **biClrUsed**.</span></span> <span data-ttu-id="a98c6-115">Nunca copie una tabla de colores en un **bitmapinfo (** sin comprobar primero el tamaño del búfer que se asignó para la estructura **bitmapinfo (** .</span><span class="sxs-lookup"><span data-stu-id="a98c6-115">Never copy a color table into a **BITMAPINFO** without first checking the size of the buffer that was allocated for the **BITMAPINFO** structure.</span></span>
-   <span data-ttu-id="a98c6-116">Una estructura [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) podría tener información de formato adicional anexada a la estructura.</span><span class="sxs-lookup"><span data-stu-id="a98c6-116">A [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure might have extra format information appended to the structure.</span></span> <span data-ttu-id="a98c6-117">El miembro **cbSize** especifica el tamaño de la información adicional.</span><span class="sxs-lookup"><span data-stu-id="a98c6-117">The **cbSize** member specifies the size of the extra information.</span></span>

<span data-ttu-id="a98c6-118">Durante la conexión de PIN, un filtro debe comprobar que todas las estructuras de formato tienen el formato correcto y contienen valores razonables.</span><span class="sxs-lookup"><span data-stu-id="a98c6-118">During pin connection, a filter should verify that all format structures are well-formed and contain reasonable values.</span></span> <span data-ttu-id="a98c6-119">Si no es así, rechace la conexión.</span><span class="sxs-lookup"><span data-stu-id="a98c6-119">If not, reject the connection.</span></span> <span data-ttu-id="a98c6-120">En el código que valida la estructura de formato, preste especial atención al desbordamiento aritmético.</span><span class="sxs-lookup"><span data-stu-id="a98c6-120">In the code that validates the format structure, be especially careful about arithmetic overflow.</span></span> <span data-ttu-id="a98c6-121">Por ejemplo, en un **BITMAPINFOHEADER**, el ancho y el alto son valores **largos** de 32 bits, pero el tamaño de la imagen (que es una función del producto de los dos) solo es un valor **DWORD** .</span><span class="sxs-lookup"><span data-stu-id="a98c6-121">For example, in a **BITMAPINFOHEADER**, the width and height are 32-bit **long** values but the image size (which is a function of the product of the two) is only a **DWORD** value.</span></span>

<span data-ttu-id="a98c6-122">Si el formato de los datos de origen es mayor que el búfer asignado, no trunque los datos de origen para copiarlos en el búfer.</span><span class="sxs-lookup"><span data-stu-id="a98c6-122">If format data from the source is larger than your allocated buffer, do not truncate the source data in order to copy it into your buffer.</span></span> <span data-ttu-id="a98c6-123">Si lo hace, puede crear una estructura cuyo tamaño implícito sea mayor que su tamaño real.</span><span class="sxs-lookup"><span data-stu-id="a98c6-123">Doing so can create a structure whose implicit size is larger than its actual size.</span></span> <span data-ttu-id="a98c6-124">Por ejemplo, un encabezado de mapa de bits podría especificar una tabla de paleta que ya no existe.</span><span class="sxs-lookup"><span data-stu-id="a98c6-124">For example, a bitmap header might specify a palette table which no longer exists.</span></span> <span data-ttu-id="a98c6-125">En su lugar, reasigne el búfer o simplemente genere un error en la conexión.</span><span class="sxs-lookup"><span data-stu-id="a98c6-125">Instead, reallocate the buffer or simply fail the connection.</span></span>

<span data-ttu-id="a98c6-126">**Errores durante el streaming**</span><span class="sxs-lookup"><span data-stu-id="a98c6-126">**Errors During Streaming**</span></span>

<span data-ttu-id="a98c6-127">Cuando el gráfico se está ejecutando, si el filtro recibe contenido incorrecto, debe terminar la transmisión por secuencias.</span><span class="sxs-lookup"><span data-stu-id="a98c6-127">When the graph is running, if your filter receives malformed content, it should terminate streaming.</span></span> <span data-ttu-id="a98c6-128">Haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="a98c6-128">Do the following:</span></span>

-   <span data-ttu-id="a98c6-129">Devuelve un código de error de **Receive**.</span><span class="sxs-lookup"><span data-stu-id="a98c6-129">Return an error code from **Receive**.</span></span>
-   <span data-ttu-id="a98c6-130">Llame a [**IPin:: EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) en el filtro de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="a98c6-130">Call [**IPin::EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) on the downstream filter.</span></span>
-   <span data-ttu-id="a98c6-131">Llame a [**CBaseFilter:: NotifyEvent**](cbasefilter-notifyevent.md) para publicar un evento [**\_ ERRORABORT de EC**](ec-errorabort.md) .</span><span class="sxs-lookup"><span data-stu-id="a98c6-131">Call [**CBaseFilter::NotifyEvent**](cbasefilter-notifyevent.md) to post an [**EC\_ERRORABORT**](ec-errorabort.md) event.</span></span>

<span data-ttu-id="a98c6-132">**Cambiar formato**</span><span class="sxs-lookup"><span data-stu-id="a98c6-132">**Format Changes**</span></span>

<span data-ttu-id="a98c6-133">Existen varios mecanismos para que los filtros cambien los formatos a la secuencia intermedia.</span><span class="sxs-lookup"><span data-stu-id="a98c6-133">Several mechanisms exist for filters to change formats mid-stream.</span></span> <span data-ttu-id="a98c6-134">Cada una de ellas implica más de un paso, lo que crea el potencial para aceptaciones falsas.</span><span class="sxs-lookup"><span data-stu-id="a98c6-134">Each of them involves more than one step, which creates the potential for false acceptances.</span></span> <span data-ttu-id="a98c6-135">Si el filtro recibe una solicitud de cambio de formato dinámico, debe rechazar la solicitud, o bien respetar el nuevo formato cuando llegue.</span><span class="sxs-lookup"><span data-stu-id="a98c6-135">If your filter gets a request for a dynamic format change, then it must either reject the request, or else honor the new format when it arrives.</span></span> <span data-ttu-id="a98c6-136">De igual forma, nunca cambie los formatos a menos que el otro filtro acepte.</span><span class="sxs-lookup"><span data-stu-id="a98c6-136">Similarly, never switch formats unless the other filter agrees.</span></span> <span data-ttu-id="a98c6-137">Para obtener más información, consulte [Dynamic Format Changes](dynamic-format-changes.md).</span><span class="sxs-lookup"><span data-stu-id="a98c6-137">For more information, see [Dynamic Format Changes](dynamic-format-changes.md).</span></span>

 

 
