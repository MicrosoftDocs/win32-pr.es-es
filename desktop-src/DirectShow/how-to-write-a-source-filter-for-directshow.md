---
description: En este tema se describe cómo escribir un filtro de origen personalizado para DirectShow.
ms.assetid: 032f7624-2237-41cd-844a-18ed4a2e420d
title: Cómo escribir un filtro de origen para DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87af99595a43c86be0e2f4ecaa51768a211e9674
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "104538043"
---
# <a name="how-to-write-a-source-filter-for-directshow"></a><span data-ttu-id="26d8f-103">Cómo escribir un filtro de origen para DirectShow</span><span class="sxs-lookup"><span data-stu-id="26d8f-103">How to Write a Source Filter for DirectShow</span></span>

<span data-ttu-id="26d8f-104">En este tema se describe cómo escribir un filtro de origen personalizado para DirectShow.</span><span class="sxs-lookup"><span data-stu-id="26d8f-104">This topic describes how to write a custom source filter for DirectShow.</span></span>

> [!Note]  
> <span data-ttu-id="26d8f-105">En este tema solo se describen los orígenes de inserciones; no describe los orígenes de extracción, como el filtro de lectura asincrónico o los filtros divisores que se conectan a los orígenes de extracción.</span><span class="sxs-lookup"><span data-stu-id="26d8f-105">This topic describes push sources only; it does not describe pull sources, such as the Async Reader Filter, or splitter filters that connect to pull sources.</span></span> <span data-ttu-id="26d8f-106">Para ver la diferencia entre los orígenes de *inserción* y de *extracción* , vea [flujo de datos para los desarrolladores de filtros](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-106">For the distinction between *push* and *pull* sources, see [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

 

## <a name="the-directshow-streaming-model"></a><span data-ttu-id="26d8f-107">El modelo de streaming de DirectShow</span><span class="sxs-lookup"><span data-stu-id="26d8f-107">The DirectShow Streaming Model</span></span>

<span data-ttu-id="26d8f-108">Al escribir un filtro de origen, es importante comprender que un origen de la extracción no es lo mismo que un origen en directo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-108">When you write a source filter, it is important to understand that a push source is not the same thing as a live source.</span></span> <span data-ttu-id="26d8f-109">Un origen en directo obtiene los datos de un origen externo, como una cámara o un flujo de red.</span><span class="sxs-lookup"><span data-stu-id="26d8f-109">A live source gets data from some external source, such as a camera or a network stream.</span></span> <span data-ttu-id="26d8f-110">Normalmente, un origen en directo no puede controlar la velocidad de entrada de los datos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-110">Generally, a live source cannot control the incoming rate of data.</span></span> <span data-ttu-id="26d8f-111">Si los filtros de nivel inferior no consumen los datos lo suficientemente rápido, el origen deberá quitar ejemplos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-111">If the downstream filters do not consume the data fast enough, the source will need to drop samples.</span></span>

<span data-ttu-id="26d8f-112">Pero un origen de la extracción no tiene que ser un origen en directo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-112">But a push source does not have to be a live source.</span></span> <span data-ttu-id="26d8f-113">Por ejemplo, un origen de la extracción puede leer datos de un archivo local.</span><span class="sxs-lookup"><span data-stu-id="26d8f-113">For example, a push source can read data from a local file.</span></span> <span data-ttu-id="26d8f-114">En ese caso, los filtros de representador de nivel inferior determinan la rapidez con la que usan los datos del origen, en función del reloj de referencia y las marcas de tiempo de muestra.</span><span class="sxs-lookup"><span data-stu-id="26d8f-114">In that case, the downstream renderer filters determine how fast they consume the data from the source, based on the reference clock and the sample time stamps.</span></span> <span data-ttu-id="26d8f-115">El filtro de origen proporciona ejemplos lo más rápido posible, pero los representadores limitan el flujo de datos real.</span><span class="sxs-lookup"><span data-stu-id="26d8f-115">The source filter delivers samples as quickly as possible, but the actual data flow is gated limited by the renderers.</span></span> <span data-ttu-id="26d8f-116">Los mecanismos para canalizar el flujo de datos se describen en [flujo de datos para los desarrolladores de filtros](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-116">The mechanisms for gating the data flow are described in [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

<span data-ttu-id="26d8f-117">Cada pin de salida en el filtro de origen crea un subproceso denominado *subproceso de streaming*.</span><span class="sxs-lookup"><span data-stu-id="26d8f-117">Each output pin on the source filter creates a thread called a *streaming thread*.</span></span> <span data-ttu-id="26d8f-118">El PIN ofrece ejemplos en el subproceso de streaming.</span><span class="sxs-lookup"><span data-stu-id="26d8f-118">The pin delivers samples on the streaming thread.</span></span> <span data-ttu-id="26d8f-119">Normalmente, la descodificación, el procesamiento y la representación se producen en este subproceso, aunque algunos filtros de nivel inferior pueden crear subprocesos adicionales para poner en cola sus ejemplos de salida.</span><span class="sxs-lookup"><span data-stu-id="26d8f-119">Typically, all of the decoding, processing, and rendering happens on this thread, although some downstream filters might create additional threads to queue their output samples.</span></span>

<span data-ttu-id="26d8f-120">El subproceso de streaming ejecuta un bucle con la siguiente estructura:</span><span class="sxs-lookup"><span data-stu-id="26d8f-120">The streaming thread runs a loop with the following structure:</span></span>

``` syntax
until (stopped)
  1. Get a media sample from the allocator.
  2. Fill the sample with data.
  3. Time stamp the sample. 
  4. Deliver the sample downstream.
```

<span data-ttu-id="26d8f-121">Si no hay ningún ejemplo disponible, el paso 1 se bloquea hasta que una muestra esté disponible.</span><span class="sxs-lookup"><span data-stu-id="26d8f-121">If no samples are available, step 1 blocks until a sample becomes available.</span></span> <span data-ttu-id="26d8f-122">El paso 4 también puede bloquearse; por ejemplo, puede bloquear mientras el gráfico está en pausa.</span><span class="sxs-lookup"><span data-stu-id="26d8f-122">Step 4 can also block; for example, it can block while the graph is paused.</span></span>

<span data-ttu-id="26d8f-123">El bucle se ejecuta lo más rápido posible, pero está limitado por la rapidez con la que el filtro de representador representa cada ejemplo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-123">The loop runs as quickly as possible, but is limited by how quickly the renderer filter renders each sample.</span></span> <span data-ttu-id="26d8f-124">Suponiendo que el gráfico de filtros tiene un reloj de referencia, la frecuencia viene determinada por los tiempos de presentación de los ejemplos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-124">Assuming the filter graph has a reference clock, the rate is determined by the presentation times on the samples.</span></span> <span data-ttu-id="26d8f-125">Si no hay ningún reloj de referencia, el representador consume ejemplos lo más rápido posible.</span><span class="sxs-lookup"><span data-stu-id="26d8f-125">If there is no reference clock, the renderer consumes samples as quickly as possible.</span></span>

## <a name="using-csource-and-csourcestream"></a><span data-ttu-id="26d8f-126">Usar CSource y CSourceStream</span><span class="sxs-lookup"><span data-stu-id="26d8f-126">Using CSource and CSourceStream</span></span>

<span data-ttu-id="26d8f-127">Las clases base de DirectShow incluyen dos clases que admiten orígenes de inserciones: [**CSource**](csource.md) y [**CSourceStream**](csourcestream.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-127">The DirectShow base classes include two classes that support push sources: [**CSource**](csource.md) and [**CSourceStream**](csourcestream.md).</span></span>

-   <span data-ttu-id="26d8f-128">[**CSource**](csource.md) es la clase base para el filtro e implementa la interfaz [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) .</span><span class="sxs-lookup"><span data-stu-id="26d8f-128">[**CSource**](csource.md) is the base class for the filter and implements the [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) interface.</span></span>
-   <span data-ttu-id="26d8f-129">[**CSourceStream**](csourcestream.md) es la clase base para los terminales de salida e implementa la interfaz [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) .</span><span class="sxs-lookup"><span data-stu-id="26d8f-129">[**CSourceStream**](csourcestream.md) is the base class for the output pins, and implements the [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) interface.</span></span>

### <a name="output-pins"></a><span data-ttu-id="26d8f-130">Clavijas de salida</span><span class="sxs-lookup"><span data-stu-id="26d8f-130">Output Pins</span></span>

<span data-ttu-id="26d8f-131">Un filtro de origen puede tener más de un PIN de salida.</span><span class="sxs-lookup"><span data-stu-id="26d8f-131">A source filter can have more than one output pin.</span></span> <span data-ttu-id="26d8f-132">En el método de constructor del filtro, cree uno o varios PIN derivados de [**CSourceStream**](csourcestream.md) (un PIN por cada flujo de salida).</span><span class="sxs-lookup"><span data-stu-id="26d8f-132">In your filter's constructor method, create one or more pins derived from [**CSourceStream**](csourcestream.md) (one pin per output stream).</span></span> <span data-ttu-id="26d8f-133">No es necesario almacenar punteros a los pin; los PIN se agregan automáticamente al filtro cuando se crean.</span><span class="sxs-lookup"><span data-stu-id="26d8f-133">You don't need to store pointers to the pins; the pins automatically add themselves to the filter when they are created.</span></span>

### <a name="output-formats"></a><span data-ttu-id="26d8f-134">Formatos de salida</span><span class="sxs-lookup"><span data-stu-id="26d8f-134">Output Formats</span></span>

<span data-ttu-id="26d8f-135">El PIN de salida controla la negociación de formato con los siguientes métodos [**CSourceStream**](csourcestream.md) :</span><span class="sxs-lookup"><span data-stu-id="26d8f-135">The output pin handles format negotiation with the following [**CSourceStream**](csourcestream.md) methods:</span></span>



| <span data-ttu-id="26d8f-136">Método</span><span class="sxs-lookup"><span data-stu-id="26d8f-136">Method</span></span>                                                 | <span data-ttu-id="26d8f-137">Descripción</span><span class="sxs-lookup"><span data-stu-id="26d8f-137">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="26d8f-138">**GetMediaType**</span><span class="sxs-lookup"><span data-stu-id="26d8f-138">**GetMediaType**</span></span>](csourcestream-getmediatype.md)     | <span data-ttu-id="26d8f-139">Obtiene un tipo de medio de la clavija de salida.</span><span class="sxs-lookup"><span data-stu-id="26d8f-139">Gets a media type from the output pin.</span></span> <br/> <span data-ttu-id="26d8f-140">El PIN debe proponer al menos un tipo de medio, ya que el filtro de nivel inferior podría no proponer ningún tipo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-140">The pin must propose at least one media type, because the downstream filter might not propose any types.</span></span> <span data-ttu-id="26d8f-141">En la mayoría de los casos, el filtro de nivel inferior será un descodificador o un representador, en función de si el filtro de origen proporciona datos comprimidos o sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="26d8f-141">In most cases, the downstream filter will be a decoder or a renderer, depending on whether the source filter delivers compressed or uncompressed data.</span></span> <span data-ttu-id="26d8f-142">Un filtro de representador normalmente requiere un tipo de medio completo, que contiene toda la información de formato necesaria para representar la secuencia.</span><span class="sxs-lookup"><span data-stu-id="26d8f-142">A renderer filter usually requires a complete media type, containing all of the format information needed to render the stream.</span></span> <span data-ttu-id="26d8f-143">En el caso de un descodificador, la cantidad de información que se requiere en el tipo de medio depende mucho en el formato de codificación.</span><span class="sxs-lookup"><span data-stu-id="26d8f-143">For a decoder, the amount of information that is required in the media type depends very much on the encoding format.</span></span><br/> |
| [<span data-ttu-id="26d8f-144">**CheckMediaType**</span><span class="sxs-lookup"><span data-stu-id="26d8f-144">**CheckMediaType**</span></span>](csourcestream-checkmediatype.md) | <span data-ttu-id="26d8f-145">Comprueba si el PIN de salida acepta un tipo de medio determinado.</span><span class="sxs-lookup"><span data-stu-id="26d8f-145">Checks if the output pin accepts a given media type.</span></span> <span data-ttu-id="26d8f-146">Reemplazar este método es opcional, en función de cómo se implemente [**GetMediaType**](csourcestream-getmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-146">Overriding this method is optional, depending on how you implement [**GetMediaType**](csourcestream-getmediatype.md).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                         |



 

<span data-ttu-id="26d8f-147">El método [**GetMediaType**](csourcestream-getmediatype.md) está sobrecargado:</span><span class="sxs-lookup"><span data-stu-id="26d8f-147">The [**GetMediaType**](csourcestream-getmediatype.md) method is overloaded:</span></span>

-   <span data-ttu-id="26d8f-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) toma un parámetro único, un puntero a un objeto [**CMediaType**](cmediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="26d8f-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) takes a single parameter, a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>
-   <span data-ttu-id="26d8f-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) toma una variable de índice y un puntero a un objeto [**CMediaType**](cmediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="26d8f-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) takes an index variable and a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>

<span data-ttu-id="26d8f-150">Si el PIN de salida del filtro de origen admite exactamente un formato multimedia, debe reemplazar (1) para inicializar el objeto [**CMediaType**](cmediatype.md) con ese formato.</span><span class="sxs-lookup"><span data-stu-id="26d8f-150">If the source filter's output pin supports exactly one media format, you should override (1) to initialize the [**CMediaType**](cmediatype.md) object with that format.</span></span> <span data-ttu-id="26d8f-151">Deje la implementación predeterminada de (2) y deje también la implementación predeterminada de [**CheckMediaType**](csourcestream-checkmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-151">Leave the default implementation of (2) and also leave the default implementation of [**CheckMediaType**](csourcestream-checkmediatype.md).</span></span>

<span data-ttu-id="26d8f-152">Si el PIN admite más de un formato, invalide (2).</span><span class="sxs-lookup"><span data-stu-id="26d8f-152">If the pin supports more than one format, override (2).</span></span> <span data-ttu-id="26d8f-153">Inicialice el objeto [**CMediaType**](cmediatype.md) según el valor de la variable de índice.</span><span class="sxs-lookup"><span data-stu-id="26d8f-153">Initialize the [**CMediaType**](cmediatype.md) object according to the value of the index variable.</span></span> <span data-ttu-id="26d8f-154">El PIN debe devolver los formatos como una lista ordenada.</span><span class="sxs-lookup"><span data-stu-id="26d8f-154">The pin should return the formats as an ordered list.</span></span> <span data-ttu-id="26d8f-155">En este caso, también debe invalidar el [**CheckMediaType**](csourcestream-checkmediatype.md) para comprobar el tipo de medio en la lista de formatos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-155">In this case, you must also override the [**CheckMediaType**](csourcestream-checkmediatype.md) to check the media type against your list of formats.</span></span>

<span data-ttu-id="26d8f-156">En el caso de los formatos de vídeo sin comprimir, recuerde que el filtro de nivel inferior puede proponer formatos con varios valores de intervalo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-156">For uncompressed video formats, remember that the downstream filter can propose formats with various stride values.</span></span> <span data-ttu-id="26d8f-157">El filtro debe aceptar cualquier valor de STRIDE válido.</span><span class="sxs-lookup"><span data-stu-id="26d8f-157">Your filter should accept any valid stride value.</span></span> <span data-ttu-id="26d8f-158">Para obtener más información, vea [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span><span class="sxs-lookup"><span data-stu-id="26d8f-158">For more information, see [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span></span>

<span data-ttu-id="26d8f-159">También debe invalidar el método CBaseOutputPin virtual puro [**::D ecidebuffersize**](cbaseoutputpin-decidebuffersize.md) .</span><span class="sxs-lookup"><span data-stu-id="26d8f-159">You must also override the pure-virtual [**CBaseOutputPin::DecideBufferSize**](cbaseoutputpin-decidebuffersize.md) method.</span></span> <span data-ttu-id="26d8f-160">Use este método para establecer el tamaño de los búferes de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-160">Use this method to set the size of the sample buffers.</span></span>

### <a name="streaming"></a><span data-ttu-id="26d8f-161">Streaming</span><span class="sxs-lookup"><span data-stu-id="26d8f-161">Streaming</span></span>

<span data-ttu-id="26d8f-162">La clase [**CSourceStream**](csourcestream.md) crea el subproceso de streaming para el PIN.</span><span class="sxs-lookup"><span data-stu-id="26d8f-162">The [**CSourceStream**](csourcestream.md) class creates the streaming thread for the pin.</span></span> <span data-ttu-id="26d8f-163">El procedimiento de subproceso se implementa en el método [**CSourceStream::D obufferprocessingloop**](csourcestream-dobufferprocessingloop.md) .</span><span class="sxs-lookup"><span data-stu-id="26d8f-163">The thread procedure is implemented in the [**CSourceStream::DoBufferProcessingLoop**](csourcestream-dobufferprocessingloop.md) method.</span></span> <span data-ttu-id="26d8f-164">Este método llama al método [**CSourceStream:: FillBuffer**](csourcestream-fillbuffer.md) puro-virtual, que la clase derivada debe reemplazar.</span><span class="sxs-lookup"><span data-stu-id="26d8f-164">This method calls the pure-virtual [**CSourceStream::FillBuffer**](csourcestream-fillbuffer.md) method, which the derived class must override.</span></span> <span data-ttu-id="26d8f-165">Este método es donde el PIN rellena el búfer con los datos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-165">This method is where the pin fills the buffer with data.</span></span> <span data-ttu-id="26d8f-166">Por ejemplo, si el filtro proporciona vídeo sin comprimir, aquí es donde dibujaría los fotogramas de vídeo.</span><span class="sxs-lookup"><span data-stu-id="26d8f-166">For example, if your filter delivers uncompressed video, this is where you would draw the video frames.</span></span>

<span data-ttu-id="26d8f-167">La clase base se inicia automáticamente y detiene el bucle de subprocesos en el momento adecuado, cuando el filtro se pausa o se detiene.</span><span class="sxs-lookup"><span data-stu-id="26d8f-167">The base class automatically starts and stops the thread loop at the right times, when the filter pauses or stops.</span></span> <span data-ttu-id="26d8f-168">Cuando esto sucede, la clase [**CSourceStream**](csourcestream.md) llama a algunos métodos para notificar a la clase derivada:</span><span class="sxs-lookup"><span data-stu-id="26d8f-168">When this happens, the [**CSourceStream**](csourcestream.md) class calls some methods to notify your derived class:</span></span>

-   [<span data-ttu-id="26d8f-169">**CSourceStream::OnThreadCreate**</span><span class="sxs-lookup"><span data-stu-id="26d8f-169">**CSourceStream::OnThreadCreate**</span></span>](csourcestream-onthreadcreate.md)
-   [<span data-ttu-id="26d8f-170">**CSourceStream::OnThreadDestroy**</span><span class="sxs-lookup"><span data-stu-id="26d8f-170">**CSourceStream::OnThreadDestroy**</span></span>](csourcestream-onthreaddestroy.md)
-   [<span data-ttu-id="26d8f-171">**CSourceStream::OnThreadStartPlay**</span><span class="sxs-lookup"><span data-stu-id="26d8f-171">**CSourceStream::OnThreadStartPlay**</span></span>](csourcestream-onthreadstartplay.md)

<span data-ttu-id="26d8f-172">Puede invalidar estos métodos si necesita agregar un control especial.</span><span class="sxs-lookup"><span data-stu-id="26d8f-172">You can override these methods if you need to add any special handling.</span></span> <span data-ttu-id="26d8f-173">De lo contrario, las implementaciones predeterminadas simplemente devuelven los valores **\_ correctos**.</span><span class="sxs-lookup"><span data-stu-id="26d8f-173">Otherwise, the default implementations simply return **S\_OK**.</span></span>

## <a name="seeking"></a><span data-ttu-id="26d8f-174">Invoca</span><span class="sxs-lookup"><span data-stu-id="26d8f-174">Seeking</span></span>

<span data-ttu-id="26d8f-175">Si tiene un filtro de origen con un PIN de salida, puede usar la clase [**CSourceSeeking**](csourceseeking.md) como punto de partida para implementar búsquedas.</span><span class="sxs-lookup"><span data-stu-id="26d8f-175">If you have a source filter with one output pin, you can use the [**CSourceSeeking**](csourceseeking.md) class as a starting point for implementing seeking.</span></span> <span data-ttu-id="26d8f-176">Herede la clase de PIN de [**CSourceStream**](csourcestream.md) y **CSourceSeeking**.</span><span class="sxs-lookup"><span data-stu-id="26d8f-176">Inherit your pin class from both [**CSourceStream**](csourcestream.md) and **CSourceSeeking**.</span></span>

> [!Note]  
> <span data-ttu-id="26d8f-177">No se recomienda [**CSourceSeeking**](csourceseeking.md) para un filtro con más de un PIN de salida.</span><span class="sxs-lookup"><span data-stu-id="26d8f-177">[**CSourceSeeking**](csourceseeking.md) is not recommended for a filter with more than one output pin.</span></span> <span data-ttu-id="26d8f-178">El problema principal es que solo un PIN debe responder a las solicitudes de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="26d8f-178">The main issue is that only one pin should respond to seeking requests.</span></span> <span data-ttu-id="26d8f-179">Normalmente, esto requiere la comunicación entre los pin y el filtro.</span><span class="sxs-lookup"><span data-stu-id="26d8f-179">Typically this requires communication among the pins and the filter.</span></span>

 

<span data-ttu-id="26d8f-180">La clase [**CSourceSeeking**](csourceseeking.md) administra la velocidad de reproducción, la hora de inicio, la hora de finalización y la duración.</span><span class="sxs-lookup"><span data-stu-id="26d8f-180">The [**CSourceSeeking**](csourceseeking.md) class manages the playback rate, start time, stop time, and duration.</span></span> <span data-ttu-id="26d8f-181">La clase derivada debe establecer la hora de detención y la duración iniciales.</span><span class="sxs-lookup"><span data-stu-id="26d8f-181">Your derived class should set the initial stop time and duration.</span></span> <span data-ttu-id="26d8f-182">Cada vez que uno de estos valores cambia, se llama al método [**CSourceSeeking:: ChangeRate**](csourceseeking-changerate.md), [**CSourceSeeking:: cambie las**](csourceseeking-changestart.md)o [**CSourceSeeking:: ChangeStop**](csourceseeking-changestop.md) , según corresponda.</span><span class="sxs-lookup"><span data-stu-id="26d8f-182">Whenever one of these values changes, the [**CSourceSeeking::ChangeRate**](csourceseeking-changerate.md), [**CSourceSeeking::ChangeStart**](csourceseeking-changestart.md), or [**CSourceSeeking::ChangeStop**](csourceseeking-changestop.md) method is called, as appropriate.</span></span> <span data-ttu-id="26d8f-183">Los métodos son métodos virtuales puros.</span><span class="sxs-lookup"><span data-stu-id="26d8f-183">The methods are all pure virtual methods.</span></span> <span data-ttu-id="26d8f-184">La clase de PIN derivada invalida estos métodos para hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="26d8f-184">The derived pin class overrides these methods to do the following:</span></span>

1.  <span data-ttu-id="26d8f-185">Llame a [**IPin:: BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) en el PIN de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="26d8f-185">Call [**IPin::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) on the downstream pin.</span></span> <span data-ttu-id="26d8f-186">Esto hace que los filtros de nivel inferior puedan publicar ejemplos que contienen y rechazan los nuevos ejemplos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-186">This causes downstream filters to release samples they are holding and reject new samples.</span></span>
2.  <span data-ttu-id="26d8f-187">Llame a [**CSourceStream:: Stop**](csourcestream-stop.md) para detener el subproceso de streaming.</span><span class="sxs-lookup"><span data-stu-id="26d8f-187">Call [**CSourceStream::Stop**](csourcestream-stop.md) to stop the streaming thread.</span></span> <span data-ttu-id="26d8f-188">El filtro de origen suspende la generación de nuevos datos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-188">The source filter suspends producing new data.</span></span>
3.  <span data-ttu-id="26d8f-189">Llame a [**IPin:: EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) en el PIN de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="26d8f-189">Call [**IPin::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) on the downstream pin.</span></span> <span data-ttu-id="26d8f-190">Esto indica a los filtros de nivel inferior que acepten datos nuevos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-190">This signals the downstream filters to accept new data.</span></span>
4.  <span data-ttu-id="26d8f-191">Llame a [**IPin:: NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) con las nuevas horas de inicio y detención.</span><span class="sxs-lookup"><span data-stu-id="26d8f-191">Call [**IPin::NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) with the new start and stop times and rate.</span></span>
5.  <span data-ttu-id="26d8f-192">Establezca la propiedad discontinuidad en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="26d8f-192">Set the discontinuity property on the next sample.</span></span>

<span data-ttu-id="26d8f-193">Para obtener más información, vea [admitir búsquedas en un filtro de origen](supporting-seeking-in-a-source-filter.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-193">For more information, see [Supporting Seeking in a Source Filter](supporting-seeking-in-a-source-filter.md).</span></span>

<span data-ttu-id="26d8f-194">Si el filtro admite búsquedas, la posición del flujo es ahora independiente del tiempo de presentación.</span><span class="sxs-lookup"><span data-stu-id="26d8f-194">If your filter supports seeking, the stream position is now independent of the presentation time.</span></span> <span data-ttu-id="26d8f-195">Después de una búsqueda, las marcas de tiempo se restablecen a cero.</span><span class="sxs-lookup"><span data-stu-id="26d8f-195">After a seek, time stamps reset to zero.</span></span> <span data-ttu-id="26d8f-196">La fórmula general para las marcas de tiempo es:</span><span class="sxs-lookup"><span data-stu-id="26d8f-196">The general formula for time stamps is:</span></span>

-   <span data-ttu-id="26d8f-197">hora de inicio de ejemplo = tiempo transcurrido/velocidad de reproducción</span><span class="sxs-lookup"><span data-stu-id="26d8f-197">sample start time = time elapsed / playback rate</span></span>
-   <span data-ttu-id="26d8f-198">hora de finalización de ejemplo = hora de inicio de ejemplo + (hora por fotograma/velocidad de reproducción)</span><span class="sxs-lookup"><span data-stu-id="26d8f-198">sample end time = sample start time + (time per frame / playback rate)</span></span>

<span data-ttu-id="26d8f-199">el tiempo *transcurrido* es el tiempo transcurrido desde que se empezó a ejecutar el filtro o desde el último comando de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="26d8f-199">where *time elapsed* is the time that has elapsed since the filter started running or since the last seek command.</span></span>

### <a name="time-formats-for-seeking"></a><span data-ttu-id="26d8f-200">Formatos de hora para buscar</span><span class="sxs-lookup"><span data-stu-id="26d8f-200">Time Formats for Seeking</span></span>

<span data-ttu-id="26d8f-201">De forma predeterminada, los comandos de búsqueda están en unidades de 100 a nanosegundos.</span><span class="sxs-lookup"><span data-stu-id="26d8f-201">By default, seek commands are in units of 100-nanoseconds.</span></span> <span data-ttu-id="26d8f-202">El filtro de origen puede admitir formatos de hora adicionales, como la búsqueda por número de marco.</span><span class="sxs-lookup"><span data-stu-id="26d8f-202">Your source filter can support additional time formats, such as seeking by frame number.</span></span> <span data-ttu-id="26d8f-203">Cada formato de hora se identifica mediante un GUID; consulte [**GUID de formato de hora**](time-format-guids.md).</span><span class="sxs-lookup"><span data-stu-id="26d8f-203">Each time format is identified by a GUID; see [**Time Format GUIDs**](time-format-guids.md).</span></span>

<span data-ttu-id="26d8f-204">Para admitir formatos de hora adicionales, debe implementar los métodos siguientes en el PIN de salida:</span><span class="sxs-lookup"><span data-stu-id="26d8f-204">To support additional time formats, you must implement the following methods on your output pin:</span></span>

-   [<span data-ttu-id="26d8f-205">**IMediaSeeking::ConvertTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="26d8f-205">**IMediaSeeking::ConvertTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-converttimeformat)
-   [<span data-ttu-id="26d8f-206">**IMediaSeeking::GetTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="26d8f-206">**IMediaSeeking::GetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-gettimeformat)
-   [<span data-ttu-id="26d8f-207">**IMediaSeeking::IsFormatSupported**</span><span class="sxs-lookup"><span data-stu-id="26d8f-207">**IMediaSeeking::IsFormatSupported**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isformatsupported)
-   [<span data-ttu-id="26d8f-208">**IMediaSeeking::IsUsingTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="26d8f-208">**IMediaSeeking::IsUsingTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isusingtimeformat)
-   [<span data-ttu-id="26d8f-209">**IMediaSeeking::QueryPreferredFormat**</span><span class="sxs-lookup"><span data-stu-id="26d8f-209">**IMediaSeeking::QueryPreferredFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-querypreferredformat)
-   [<span data-ttu-id="26d8f-210">**IMediaSeeking::SetTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="26d8f-210">**IMediaSeeking::SetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-settimeformat)

<span data-ttu-id="26d8f-211">Si la aplicación establece un nuevo formato de hora, todos los parámetros de posición de los métodos [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) se interpretan en términos del nuevo formato de hora.</span><span class="sxs-lookup"><span data-stu-id="26d8f-211">If the application sets a new time format, all of the position parameters in the [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) methods are interpreted in terms of the new time format.</span></span> <span data-ttu-id="26d8f-212">Por ejemplo, si el formato de hora es frames, el método [**IMediaSeeking:: GetDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) debe devolver la duración en fotogramas.</span><span class="sxs-lookup"><span data-stu-id="26d8f-212">For example, if the time format is frames, the [**IMediaSeeking::GetDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) method must return the duration in frames.</span></span>

<span data-ttu-id="26d8f-213">En la práctica, pocos filtros de DirectShow admiten formatos de hora adicionales y, como resultado, pocas aplicaciones de DirectShow hacen uso de esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="26d8f-213">In practice, few DirectShow filters support additional time formats, and as a result, few DirectShow applications make use of this capability.</span></span>

## <a name="related-topics"></a><span data-ttu-id="26d8f-214">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="26d8f-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="26d8f-215">Escribir filtros de origen</span><span class="sxs-lookup"><span data-stu-id="26d8f-215">Writing Source Filters</span></span>](writing-source-filters.md)
</dt> </dl>

 

 




