---
title: Seguridad de RPC a través de HTTP
description: RPC a través de HTTP proporciona tres tipos de seguridad además de la seguridad RPC estándar, lo que hace que el tráfico de RPC a través de HTTP se proteja una vez por RPC y, a continuación, se protege doble mediante el mecanismo de tunelización proporcionado por RPC a través de HTTP.
ms.assetid: 3a44c72b-b74c-433a-8826-1f76ca019f40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 527cf5ff74120c41606d83a248e355a6ea46d9d5
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/12/2021
ms.locfileid: "104279755"
---
# <a name="rpc-over-http-security"></a><span data-ttu-id="98d37-103">Seguridad de RPC a través de HTTP</span><span class="sxs-lookup"><span data-stu-id="98d37-103">RPC over HTTP Security</span></span>

<span data-ttu-id="98d37-104">RPC a través de HTTP proporciona tres tipos de seguridad además de la seguridad RPC estándar, lo que hace que el tráfico de RPC a través de HTTP se proteja una vez por RPC y, a continuación, se protege doble mediante el mecanismo de tunelización proporcionado por RPC a través de HTTP.</span><span class="sxs-lookup"><span data-stu-id="98d37-104">RPC over HTTP provides three types of security in addition to standard RPC security, which results in RPC over HTTP traffic being protected once by RPC, and then doubly protected by the tunneling mechanism provided by RPC over HTTP.</span></span> <span data-ttu-id="98d37-105">Para obtener una descripción de los mecanismos de seguridad RPC estándar, consulte [seguridad](security.md).</span><span class="sxs-lookup"><span data-stu-id="98d37-105">For a description of standard RPC security mechanisms, see [Security](security.md).</span></span> <span data-ttu-id="98d37-106">El mecanismo de túnel RPC a través de HTTP se agrega a la seguridad RPC normal de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="98d37-106">The RPC over HTTP tunneling mechanism adds to normal RPC security in the following manner:</span></span>

-   <span data-ttu-id="98d37-107">Proporciona seguridad a través de IIS (solo disponible para RPC a través de HTTP V2).</span><span class="sxs-lookup"><span data-stu-id="98d37-107">Provides security through the IIS (available for RPC over HTTP v2 only).</span></span>
-   <span data-ttu-id="98d37-108">Proporciona el cifrado SSL y la comprobación del proxy RPC (autenticación mutua).</span><span class="sxs-lookup"><span data-stu-id="98d37-108">Provides SSL encryption and RPC Proxy verification (mutual authentication).</span></span> <span data-ttu-id="98d37-109">También está disponible únicamente en RPC a través de HTTP V2.</span><span class="sxs-lookup"><span data-stu-id="98d37-109">Also available in RPC over HTTP v2 only.</span></span>
-   <span data-ttu-id="98d37-110">Proporciona restricciones en el nivel de proxy RPC que indican qué máquinas de la red del servidor pueden recibir llamadas RPC a través de HTTP.</span><span class="sxs-lookup"><span data-stu-id="98d37-110">Provides restrictions on the RPC Proxy level dictating which machines on the server network are allowed to receive RPC over HTTP calls.</span></span>

<span data-ttu-id="98d37-111">Cada una de estas tres características de seguridad se describe con más detalle en las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="98d37-111">Each of these three security features is described in more detail in following sections.</span></span>

## <a name="iis-authentication"></a><span data-ttu-id="98d37-112">Autenticación IIS</span><span class="sxs-lookup"><span data-stu-id="98d37-112">IIS Authentication</span></span>

<span data-ttu-id="98d37-113">RPC a través de HTTP puede aprovechar el mecanismo de autenticación normal de IIS.</span><span class="sxs-lookup"><span data-stu-id="98d37-113">RPC over HTTP can leverage the normal authentication mechanism of IIS.</span></span> <span data-ttu-id="98d37-114">El directorio virtual del proxy RPC se puede configurar mediante el nodo RPC en el sitio web predeterminado del complemento MMC de IIS:</span><span class="sxs-lookup"><span data-stu-id="98d37-114">The virtual directory for RPC Proxy can be configured using the Rpc node under the Default Web Site in the IIS MMC snap-in:</span></span>

![Captura de pantalla que muestra el nodo RPC en el sitio web predeterminado en el complemento MMC de IIS.](images/rpc-http-1.png)

<span data-ttu-id="98d37-116">IIS puede configurarse para deshabilitar el acceso anónimo y requerir autenticación en el directorio virtual para el proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-116">IIS can be configured to disable anonymous access and require authentication to the virtual directory for the RPC Proxy.</span></span> <span data-ttu-id="98d37-117">Para ello, haga clic con el botón secundario en el nodo RPC y seleccione **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="98d37-117">To do this, right click the Rpc node and select **Properties**.</span></span> <span data-ttu-id="98d37-118">Seleccione la pestaña **seguridad de directorios** y haga clic en el botón **Editar** del grupo **autenticación y Access Control** , como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="98d37-118">Select the **Directory Security** tab and click the **Edit** button in the **Authentication and Access Control** group, as illustrated here:</span></span>

![Captura de pantalla que muestra el cuadro de diálogo Propiedades de RPC.](images/rpc-http-2.png)

<span data-ttu-id="98d37-120">Aunque puede usar RPC a través de HTTP aunque el directorio virtual del proxy RPC permita el acceso anónimo, Microsoft recomienda encarecidamente deshabilitar el acceso anónimo a ese directorio virtual por motivos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="98d37-120">Although you can use RPC over HTTP even when the RPC Proxy virtual directory allows anonymous access, Microsoft strongly recommends disabling anonymous access to that virtual directory for security reasons.</span></span> <span data-ttu-id="98d37-121">En su lugar, para RPC a través de HTTP, habilite la autenticación básica, la autenticación integrada de Windows o ambas.</span><span class="sxs-lookup"><span data-stu-id="98d37-121">Rather, for RPC over HTTP enable Basic Authentication, Windows Integrated Authentication or both.</span></span> <span data-ttu-id="98d37-122">Recuerde que solo RPC a través de HTTP V2 puede autenticarse en el proxy RPC que requiere autenticación básica o integrada de Windows. RPC a través de HTTP v1 no podrá conectarse si no se **permite el acceso anónimo** está deshabilitado.</span><span class="sxs-lookup"><span data-stu-id="98d37-122">Remember that only RPC over HTTP v2 is able to authenticate against RPC Proxy requiring Basic or Windows-integrated authentication; RPC over HTTP v1 will not be able to connect if **Disallow Anonymous Access** is disabled.</span></span> <span data-ttu-id="98d37-123">Como RPC a través de HTTP V2 es la implementación más segura y robusta, el uso de una versión de Windows que sea compatible mejorará la seguridad de las instalaciones.</span><span class="sxs-lookup"><span data-stu-id="98d37-123">Since RPC over HTTP v2 is the more secure and robust implementation, using a version of Windows that supports it will improve the security of your installations.</span></span>

> [!Note]  
> <span data-ttu-id="98d37-124">De forma predeterminada, el directorio virtual del proxy RPC está marcado para permitir el acceso anónimo.</span><span class="sxs-lookup"><span data-stu-id="98d37-124">By default, the RPC proxy virtual directory is marked to allow anonymous access.</span></span> <span data-ttu-id="98d37-125">Sin embargo, el proxy RPC para RPC a través de HTTP V2 rechaza las solicitudes que no se autentican de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="98d37-125">However, the RPC proxy for RPC over HTTP v2 rejects requests that are not authenticated by default.</span></span>

 

## <a name="traffic-encryption"></a><span data-ttu-id="98d37-126">Cifrado de tráfico</span><span class="sxs-lookup"><span data-stu-id="98d37-126">Traffic Encryption</span></span>

<span data-ttu-id="98d37-127">RPC a través de HTTP puede cifrar el tráfico entre el cliente RPC a través de HTTP y el proxy RPC con SSL.</span><span class="sxs-lookup"><span data-stu-id="98d37-127">RPC over HTTP can encrypt traffic between the RPC over HTTP client and the RPC proxy with SSL.</span></span> <span data-ttu-id="98d37-128">El tráfico entre el proxy RPC y el servidor RPC a través de HTTP se cifra mediante mecanismos de seguridad RPC normales y no usa SSL (aunque se elija SSL entre el cliente y el proxy RPC).</span><span class="sxs-lookup"><span data-stu-id="98d37-128">The traffic between the RPC proxy and RPC over HTTP server is encrypted using normal RPC security mechanisms and does not use SSL (even if SSL between the client and the RPC proxy is chosen).</span></span> <span data-ttu-id="98d37-129">Esto se debe a que esa parte del tráfico viaja dentro de la red de una organización y detrás de un firewall.</span><span class="sxs-lookup"><span data-stu-id="98d37-129">This is because that portion of the traffic travels within an organization's network and behind a firewall.</span></span>

<span data-ttu-id="98d37-130">El tráfico entre el cliente RPC a través de HTTP y el proxy RPC, que generalmente viaja a través de Internet, se puede cifrar con SSL además del mecanismo de cifrado que se ha elegido para RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-130">Traffic between the RPC over HTTP client and the RPC proxy, which generally travels over the Internet, can be encrypted with SSL in addition to which encryption mechanism was chosen for RPC.</span></span> <span data-ttu-id="98d37-131">En este caso, se vuelve a cifrar el tráfico en la parte de Internet de la ruta.</span><span class="sxs-lookup"><span data-stu-id="98d37-131">In this case, traffic on the Internet portion of the route becomes doubly encrypted.</span></span> <span data-ttu-id="98d37-132">El cifrado del tráfico a través del proxy RPC proporciona una defensa secundaria, en el caso de que se pongan en peligro el proxy RPC u otras máquinas de la red perimetral.</span><span class="sxs-lookup"><span data-stu-id="98d37-132">Encrypting traffic through the RPC proxy provides a secondary defense, in case the RPC proxy or other machines in the perimeter network are compromised.</span></span> <span data-ttu-id="98d37-133">Puesto que el proxy RPC no puede descifrar el nivel de cifrado secundario, el proxy RPC no tiene acceso a los datos que se envían.</span><span class="sxs-lookup"><span data-stu-id="98d37-133">Since the RPC proxy cannot decrypt the secondary encryption layer, the RPC proxy does not have access to the data being sent.</span></span> <span data-ttu-id="98d37-134">Consulte [recomendaciones de implementación de RPC sobre http](rpc-over-http-deployment-recommendations.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="98d37-134">See [RPC over HTTP Deployment Recommendations](rpc-over-http-deployment-recommendations.md) for more information.</span></span> <span data-ttu-id="98d37-135">El cifrado SSL solo está disponible con RPC sobre HTTP V2.</span><span class="sxs-lookup"><span data-stu-id="98d37-135">SSL encryption is available only with RPC over HTTP v2.</span></span>

## <a name="restricting-rpc-over-http-calls-to-certain-computers"></a><span data-ttu-id="98d37-136">Restricción de llamadas de RPC a través de HTTP a determinados equipos</span><span class="sxs-lookup"><span data-stu-id="98d37-136">Restricting RPC over HTTP Calls to Certain Computers</span></span>

<span data-ttu-id="98d37-137">La configuración de seguridad de IIS se basa en intervalos permitidos de equipos y puertos.</span><span class="sxs-lookup"><span data-stu-id="98d37-137">The IIS security configuration is based on allowed computer and port ranges.</span></span> <span data-ttu-id="98d37-138">La capacidad de usar RPC a través de HTTP se controla mediante dos entradas del registro en el equipo que ejecuta IIS y el proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-138">The capability to use RPC over HTTP is controlled by two registry entries on the computer running IIS and the RPC proxy.</span></span> <span data-ttu-id="98d37-139">La primera entrada es una marca que alterna la funcionalidad del proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-139">The first entry is a flag that toggles RPC proxy functionality.</span></span> <span data-ttu-id="98d37-140">La segunda es una lista opcional de equipos a los que el proxy puede reenviar las llamadas RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-140">The second is an optional list of computers to which the proxy can forward RPC calls.</span></span>

<span data-ttu-id="98d37-141">De forma predeterminada, un cliente que se pone en contacto con el proxy RPC para Tunelizar llamadas de RPC a través de HTTP no puede tener acceso a los procesos de servidor RPC, excepto el servidor RPC a través de HTTP, que se ejecuta en el mismo equipo que el proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-141">By default, a client that contacts the RPC proxy to tunnel RPC over HTTP calls cannot access any RPC server processes except the RPC over HTTP server processes running on the same machine as the RPC proxy.</span></span> <span data-ttu-id="98d37-142">Si la marca HABILITAda no está definida o está establecida en un valor cero, IIS deshabilita el proxy RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-142">If the ENABLED flag is not defined or set to a zero value, IIS disables the RPC proxy.</span></span> <span data-ttu-id="98d37-143">Si se define la marca HABILITAda y se establece en un valor distinto de cero, un cliente puede conectarse a los servidores RPC a través de HTTP en el equipo en el que se ejecuta IIS.</span><span class="sxs-lookup"><span data-stu-id="98d37-143">If the ENABLED flag is defined and set to a nonzero value, a client can connect to RPC over HTTP servers on the computer running IIS.</span></span> <span data-ttu-id="98d37-144">Para que el cliente pueda Tunelizar a un proceso de servidor RPC a través de HTTP en otro equipo, debe agregar una entrada del registro a la lista de servidores RPC a través de HTTP del equipo de IIS.</span><span class="sxs-lookup"><span data-stu-id="98d37-144">To enable the client to tunnel to an RPC over HTTP server process on another computer, you must add a registry entry to the IIS computer's list of RPC over HTTP servers.</span></span>

<span data-ttu-id="98d37-145">Los servidores RPC no pueden aceptar llamadas RPC a través de HTTP a menos que soliciten específicamente RPC para escuchar en RPC a través de HTTP.</span><span class="sxs-lookup"><span data-stu-id="98d37-145">RPC servers cannot accept RPC over HTTP calls unless they specifically requested RPC to listen on RPC over HTTP.</span></span>

<span data-ttu-id="98d37-146">En el ejemplo siguiente se muestra cómo configurar el registro para permitir que los clientes se conecten a los servidores a través de Internet:</span><span class="sxs-lookup"><span data-stu-id="98d37-146">The following example demonstrates how to configure the registry to allow clients to connect to servers across the Internet:</span></span>

```
HKEY_LOCAL_MACHINE\
   Software\Microsoft\Rpc\RpcProxy\Enabled:REG_DWORD
   Software\Microsoft\Rpc\RpcProxy\ValidPorts:REG_SZ
```

<span data-ttu-id="98d37-147">La entrada **ValidPorts** es una \_ entrada de reg SZ que contiene una lista de equipos a los que el proxy RPC de IIS puede reenviar las llamadas RPC y los puertos que debe utilizar para conectarse a los servidores RPC.</span><span class="sxs-lookup"><span data-stu-id="98d37-147">The **ValidPorts** entry is a REG\_SZ entry containing a list of computers to which the IIS RPC proxy is allowed to forward RPC calls, and the ports it should use to connect to the RPC servers.</span></span> <span data-ttu-id="98d37-148">La \_ entrada reg SZ tiene el siguiente formato: Rosco: 593; Rosco: 2000-8000; datos \* : 4000-8000.</span><span class="sxs-lookup"><span data-stu-id="98d37-148">The REG\_SZ entry takes the following form: Rosco:593;Rosco:2000-8000;Data\*:4000-8000.</span></span>

<span data-ttu-id="98d37-149">En este ejemplo, IIS puede reenviar llamadas RPC a través de HTTP al servidor "Rosco" en los puertos 593 y 2000 a 8000.</span><span class="sxs-lookup"><span data-stu-id="98d37-149">In this example, IIS can forward RPC over HTTP calls to the server "Rosco" on ports 593 and 2000 through 8000.</span></span> <span data-ttu-id="98d37-150">También puede enviar llamadas a cualquier servidor cuyo nombre empiece por "Data".</span><span class="sxs-lookup"><span data-stu-id="98d37-150">It can also send calls to any server whose name begins with "Data".</span></span> <span data-ttu-id="98d37-151">Se conectará en los puertos de 4000 a 8000.</span><span class="sxs-lookup"><span data-stu-id="98d37-151">It will connect on ports 4000 through 8000.</span></span> <span data-ttu-id="98d37-152">Además, antes de reenviar el tráfico a un puerto determinado en el servidor RPC a través de HTTP, el proxy RPC realiza un intercambio de paquetes especial con el servicio RPC escuchando en ese puerto para comprobar que está dispuesto a aceptar solicitudes a través de HTTP.</span><span class="sxs-lookup"><span data-stu-id="98d37-152">In addition, before forwarding traffic to a given port on the RPC over HTTP server, the RPC proxy performs a special packet exchange with the RPC service listening on that port to verify it is willing to accept requests over HTTP.</span></span>

<span data-ttu-id="98d37-153">Para obtener un ejemplo basado en esta configuración de ejemplo, si un servicio RPC escucha en el puerto 4500 en el servidor "data1" pero no ha llamado a una de las funciones [ \* *RpcServerUseProtseq \** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) con _ \* ncacn \_ http \* \*, rechazará la solicitud.</span><span class="sxs-lookup"><span data-stu-id="98d37-153">For an example based on these example settings, if an RPC service listens on port 4500 on server "Data1" but has not called one of the [\**RpcServerUseProtseq\** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) functions with _\*ncacn\_http\*\*, it will reject the request.</span></span> <span data-ttu-id="98d37-154">Este comportamiento proporciona protección adicional para los servidores que escuchan en un puerto abierto debido a un error de configuración. a menos que el servidor solicite específicamente escuchar en RPC a través de HTTP, no recibirá las llamadas que se originan fuera del firewall.</span><span class="sxs-lookup"><span data-stu-id="98d37-154">This behavior provides additional protection for servers that listen on an opened port due to configuration error; unless the server specifically requested to listen on RPC over HTTP, it will not receive calls originating from outside the firewall.</span></span>

<span data-ttu-id="98d37-155">Las entradas de la clave **ValidPorts** deben coincidir exactamente con el servidor RPC a través de http solicitado por el cliente (no distingue entre mayúsculas y minúsculas).</span><span class="sxs-lookup"><span data-stu-id="98d37-155">Entries in the **ValidPorts** key must be an exact match of the RPC over HTTP server asked for by the client (it is not case-sensitive).</span></span> <span data-ttu-id="98d37-156">Para simplificar el procesamiento, el proxy RPC no realiza la canonización del nombre proporcionado por el cliente RPC a través de HTTP.</span><span class="sxs-lookup"><span data-stu-id="98d37-156">To streamline processing, the RPC proxy does not perform canonicalization of the name provided by the RPC over HTTP client.</span></span> <span data-ttu-id="98d37-157">Por lo tanto, si el cliente solicita rosco.microsoft.com y en **ValidPorts** solo contiene Rosco, el proxy RPC no coincidirá con los nombres, aunque ambos nombres puedan hacer referencia al mismo equipo.</span><span class="sxs-lookup"><span data-stu-id="98d37-157">Therefore, if the client asks for rosco.microsoft.com, and in **ValidPorts** contain Rosco only, the RPC proxy will not match the names, even though both names may refer to the same machine.</span></span> <span data-ttu-id="98d37-158">Además, si la dirección IP de Rosco es 66.77.88.99 y el cliente solicita 66.77.88.99 pero la clave **ValidPorts** solo contiene Rosco, el proxy RPC rechazará la conexión.</span><span class="sxs-lookup"><span data-stu-id="98d37-158">Additionally, if the IP address of Rosco is 66.77.88.99, and the client asks for 66.77.88.99 but the **ValidPorts** key contains Rosco only, the RPC proxy will refuse the connection.</span></span> <span data-ttu-id="98d37-159">Si un cliente puede solicitar el servidor RPC a través de HTTP por nombre, o por dirección IP, inserte ambos en la clave **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="98d37-159">If a client may ask for the RPC over HTTP server by name, or by IP address, insert both in the **ValidPorts** key.</span></span>

> [!Note]  
> <span data-ttu-id="98d37-160">Aunque RPC está habilitado para IPv6, el proxy RPC no admite direcciones IPv6 en la clave **ValidPorts** .</span><span class="sxs-lookup"><span data-stu-id="98d37-160">Although RPC is IPv6 enabled, the RPC proxy does not support IPv6 addresses in the **ValidPorts** key.</span></span> <span data-ttu-id="98d37-161">Si IPv6 se usa para conectar el proxy RPC y el servidor RPC a través de HTTP, solo se pueden usar nombres DNS.</span><span class="sxs-lookup"><span data-stu-id="98d37-161">If IPv6 is used to connect the RPC proxy and the RPC over HTTP server, only DNS names can be used.</span></span>

 

<span data-ttu-id="98d37-162">IIS Lee las entradas de registro **habilitadas** y **ValidPorts** en el inicio.</span><span class="sxs-lookup"><span data-stu-id="98d37-162">IIS reads the **Enabled** and **ValidPorts** registry entries on startup.</span></span> <span data-ttu-id="98d37-163">Además, RPC a través de HTTP relee el contenido de la clave **ValidPorts** aproximadamente cada 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="98d37-163">In addition, RPC over HTTP rereads the contents of the **ValidPorts** key approximately every 5 minutes.</span></span> <span data-ttu-id="98d37-164">Si se cambia la entrada **ValidPorts** , los cambios se implementan en un plazo de 5 minutos.</span><span class="sxs-lookup"><span data-stu-id="98d37-164">If the **ValidPorts** entry is changed, the changes are implemented within 5 minutes.</span></span>

<span data-ttu-id="98d37-165">**RPC a través de http v1:** El servicio WEB debe detenerse y reiniciarse mediante el Service Manager de Internet para los nuevos valores de las entradas del registro que se van a implementar.</span><span class="sxs-lookup"><span data-stu-id="98d37-165">**RPC over HTTP v1:** The WEB service must be stopped and restarted using the Internet Service Manager for new values in the registry entries to be implemented.</span></span>

 

 




