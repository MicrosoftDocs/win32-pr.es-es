---
description: En la ilustración siguiente se muestra la arquitectura general de los proveedores de servicios de telefonía y sus bibliotecas de vínculos dinámicos (dll de interfaz de usuario) asociadas.
ms.assetid: b5efe57a-19b8-49c5-810f-180633ed50d2
title: Arquitectura (API de telefonía)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14423dba77af1ded38af4a6f2b896e76d28ca2cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105687519"
---
# <a name="architecture-telephony-api"></a><span data-ttu-id="69207-103">Arquitectura (API de telefonía)</span><span class="sxs-lookup"><span data-stu-id="69207-103">Architecture (Telephony API)</span></span>

<span data-ttu-id="69207-104">En la ilustración siguiente se muestra la arquitectura general de los proveedores de servicios de telefonía y sus bibliotecas de vínculos dinámicos (dll de interfaz de usuario) asociadas.</span><span class="sxs-lookup"><span data-stu-id="69207-104">The following illustration shows the general architecture of telephony service providers and their associated user interface dynamic-link libraries (UI DLLs).</span></span>

![profesionales y archivos dll de interfaz de usuario asociados](images/spuidl01.png)

<span data-ttu-id="69207-106">El proveedor de servicios se compone de un mínimo de dos componentes.</span><span class="sxs-lookup"><span data-stu-id="69207-106">The service provider consists of a minimum of two components.</span></span> <span data-ttu-id="69207-107">La DLL del proveedor de servicios (designada en la ilustración como MAIN). TSP) se ejecuta en el contexto del proceso TAPISRV y realiza todas las tareas del proveedor de servicios que no están relacionadas con los elementos de la interfaz de usuario asociados con el uso que hace una aplicación determinada del dispositivo (lo más probable es que, junto con los componentes de nivel inferior que no se muestran en la ilustración).</span><span class="sxs-lookup"><span data-stu-id="69207-107">The service provider DLL (designated in the illustration as MAIN.TSP) executes in the context of the TAPISRV process, and performs all of the tasks of the service provider that are not related to user interface elements associated with a particular application's use of the device (most likely, in conjunction with lower-level components not shown in the illustration).</span></span> <span data-ttu-id="69207-108">Pero a diferencia de las versiones anteriores de TAPI en las que el código de la interfaz de usuario se integraba en el proveedor de servicios (y se ejecutaba, debido a la arquitectura anterior, en el contexto de la aplicación), el proveedor de servicios debe incluir ahora un componente independiente que implementa los elementos de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="69207-108">But unlike previous versions of TAPI in which the user interface code was integrated into the service provider (and executed, because of the previous architecture, within the context of the application), the service provider must now include a separate component that implements the user interface elements.</span></span>

<span data-ttu-id="69207-109">El archivo DLL de la interfaz de usuario del proveedor de servicios debe exportar las funciones a las que llama TAPI cuando la aplicación llama a funciones TAPI que generan la interfaz de usuario: [**TUISPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall)y [**TUISPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span><span class="sxs-lookup"><span data-stu-id="69207-109">The service provider UI DLL must export functions that are called by TAPI when the application calls TAPI functions that generate UI: [**TUISPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall), and [**TUISPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span></span> <span data-ttu-id="69207-110">Cada una de estas funciones incluye como parámetro un puntero a una función de devolución de llamada en TAPI, de tipo [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), que el archivo dll de la interfaz de usuario puede usar para comunicarse bidireccionalmente (tanto datos de envío como de recepción) con la dll del proveedor de servicios que se ejecuta en el proceso de TAPISRV.</span><span class="sxs-lookup"><span data-stu-id="69207-110">Each of these functions includes as a parameter a pointer to a callback function in TAPI, of type [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), which the UI DLL can use to communicate bidirectionally (both send and receive data) with the service provider DLL executing in the TAPISRV process.</span></span> <span data-ttu-id="69207-111">Si el proveedor de servicios genera una interfaz de usuario espontánea, como el cuadro de diálogo **Talk/colgar** de Unimodem, junto con cualquier función de TSPI para la que no se espera la interfaz de usuario (por ejemplo, cualquier función que no tenga un parámetro *hWnd* ), la dll de la interfaz de usuario debe exportar [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) y [**TUISPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span><span class="sxs-lookup"><span data-stu-id="69207-111">If the service provider ever generates spontaneous UI, such as the Unimodem **Talk/Hangup** dialog box, in conjunction with any TSPI function for which UI is not expected (for example, any function that does not have an *hwnd* parameter), then the UI DLL must export [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) and [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span></span>

> [!Note]  
> <span data-ttu-id="69207-112">Las funciones de generación de interfaz de usuario de TSPI originales ( [**TSPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall)y [**TSPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) están obsoletas y TAPI nunca lo llama.</span><span class="sxs-lookup"><span data-stu-id="69207-112">The original TSPI UI-generating functions ( [**TSPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall), and [**TSPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) are obsolete and never called by TAPI.</span></span> <span data-ttu-id="69207-113">Por lo tanto, no es necesario que la DLL del proveedor de servicios exporte estos archivos.</span><span class="sxs-lookup"><span data-stu-id="69207-113">Therefore, these are not required to be exported by the service provider DLL.</span></span> <span data-ttu-id="69207-114">Sin embargo, si el proveedor de servicios desea aparecer como uno que se puede agregar mediante el panel de control de telefonía, una utilidad suministrada con telefonía de Windows en las versiones 1,4 y anteriores, debe exportar **TSPI \_ providerInstall**; si desea tener el botón [**quitar**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) habilitado en el panel de control de telefonía cuando está seleccionado, debe exportar **TSPI \_ providerRemove** y, si desea que el botón de **instalación** esté habilitado en el panel de control de telefonía, debe exportar **TSPI \_ providerConfig**.</span><span class="sxs-lookup"><span data-stu-id="69207-114">However, if the service provider wants to be listed as one that can be added by the Telephony Control Panel, a utility supplied with Windows Telephony in versions 1.4 and earlier, it must export **TSPI\_providerInstall**; if it wants to have the [**Remove**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) button enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerRemove**; and if it wants the **Setup** button to be enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerConfig**.</span></span> <span data-ttu-id="69207-115">El panel de control de telefonía comprueba la presencia de estas funciones en el archivo de proveedor de servicios TSP para ajustar su interfaz de usuario y reflejar las operaciones que se pueden realizar.</span><span class="sxs-lookup"><span data-stu-id="69207-115">The Telephony Control Panel checks for the presence of these functions in the service provider TSP file to adjust its user interface to reflect which operations can be performed.</span></span>

 

<span data-ttu-id="69207-116">La DLL del proveedor de servicios debe exportar la función [**TSPI \_ providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) que el proceso de TAPISRV utiliza para obtener el nombre del archivo dll de la interfaz de usuario que se va a cargar en el proceso de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="69207-116">The service provider DLL must export the [**TSPI\_providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) function that TAPISRV process uses to obtain the name of the UI DLL to load in the application process.</span></span> <span data-ttu-id="69207-117">Debe exportar la función [**TSPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) para recibir y responder a las solicitudes del archivo dll de la interfaz de usuario para que se muestren los datos, y debe exportar [**TSPI \_ providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV para indicar al proveedor de servicios Cuándo debe liberar una asociación establecida con el fin de generar la interfaz de usuario espontánea junto con una función que no está definida como presentación de la interfaz de usuario para el usuario.</span><span class="sxs-lookup"><span data-stu-id="69207-117">It must export the [**TSPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) function to receive and respond to requests from the UI DLL for data to display, and it must export [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV process to tell the service provider when to release an association established for the purpose of generating spontaneous UI in conjunction with a function that is not defined as presenting UI to the user.</span></span> <span data-ttu-id="69207-118">La DLL del proveedor de servicios puede enviar datos de forma unidireccional al archivo DLL de la interfaz de usuario mediante la nueva línea de mensaje TSPI [**\_ SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span><span class="sxs-lookup"><span data-stu-id="69207-118">The service provider DLL can unidirectionally send data to the UI DLL by using the new TSPI message [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span></span>

<span data-ttu-id="69207-119">Dado que los nombres de las funciones TSPI y TUISPI se definen intencionadamente para ser diferentes, la DLL del proveedor de servicios y la DLL de la interfaz de usuario pueden ser el mismo archivo DLL, si se desea.</span><span class="sxs-lookup"><span data-stu-id="69207-119">Because the names of the TSPI and TUISPI functions are intentionally defined to be different, the service provider DLL and the UI DLL can be the same DLL file, if desired.</span></span> <span data-ttu-id="69207-120">Con la segmentación adecuada, esto no implica necesariamente el uso innecesario de memoria en el contexto de la aplicación y puede simplificar el proceso de instalación de los proveedores de servicios que se pueden implementar actualmente en un solo archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="69207-120">With proper segmentation, this does not necessarily result in any unnecessary usage of memory in the application context, and can simplify the installation process for service providers that can currently be implemented in a single DLL.</span></span> <span data-ttu-id="69207-121">TAPI solo llama a las funciones apropiadas para el contexto en el que se utiliza el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="69207-121">TAPI calls only the functions that are appropriate for the context in which the DLL is being used.</span></span>

<span data-ttu-id="69207-122">El proveedor de servicios de telefonía y la DLL de la interfaz de usuario deben diseñarse con el requisito de que las funciones de la interfaz de usuario se pueden invocar desde varios procesos de la aplicación simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="69207-122">The telephony service provider and the UI DLL must both be designed with the requirement in mind that the UI functions can be invoked from multiple application processes simultaneously.</span></span> <span data-ttu-id="69207-123">También deben tener en cuenta que la aplicación y el servicio TAPI en el que se ejecuta el proveedor de servicios de telefonía pueden estar en equipos independientes de una LAN.</span><span class="sxs-lookup"><span data-stu-id="69207-123">They must also consider that the application and the TAPI service under which the telephony service provider is executing can be on separate computers on a LAN.</span></span>

 

 
