---
description: Describe cómo Windows 10 usa conjuntos de API en las operaciones del cargador.
title: Operación de cargador del conjunto de API
ms.topic: article
ms.date: 10/14/2020
ms.openlocfilehash: 701409c0d8dac2c275add06d2502c8764d502aba
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/05/2021
ms.locfileid: "105721181"
---
# <a name="api-set-loader-operation"></a><span data-ttu-id="94997-103">Operación de cargador del conjunto de API</span><span class="sxs-lookup"><span data-stu-id="94997-103">API set loader operation</span></span>

<span data-ttu-id="94997-104">Los [conjuntos de API](windows-apisets.md) dependen de la compatibilidad del sistema operativo en el cargador de biblioteca para introducir de forma eficaz una redirección de espacio de nombres de módulo en el proceso de enlace de la biblioteca.</span><span class="sxs-lookup"><span data-stu-id="94997-104">[API sets](windows-apisets.md) rely on OS support in the library loader to effectively introduce a module namespace redirection into the library binding process.</span></span> <span data-ttu-id="94997-105">El cargador de bibliotecas usa el [nombre del contrato de conjunto de API](windows-apisets.md#api-set-contract-names) para realizar una redirección en tiempo de ejecución de la referencia a un archivo binario de host de destino que hospeda la implementación adecuada del conjunto de API.</span><span class="sxs-lookup"><span data-stu-id="94997-105">The [API set contract name](windows-apisets.md#api-set-contract-names) is used by library loader to perform a runtime redirection of the reference to a target host binary that houses the appropriate implementation of the API set.</span></span>

<span data-ttu-id="94997-106">Cuando el cargador encuentra una dependencia en un conjunto de API en tiempo de ejecución, el cargador consulta los datos de configuración de la imagen para identificar el binario del host para un conjunto de API.</span><span class="sxs-lookup"><span data-stu-id="94997-106">When the loader encounters a dependency on an API set at run time, the loader consults configuration data in the image to identify the host binary for an API set.</span></span> <span data-ttu-id="94997-107">Estos datos de configuración se denominan el **esquema de conjunto de API**.</span><span class="sxs-lookup"><span data-stu-id="94997-107">This configuration data is called the **API set schema**.</span></span> <span data-ttu-id="94997-108">El esquema se ensambla como una propiedad del sistema operativo y la asignación entre los conjuntos de API y los archivos binarios puede diferir en función de los archivos binarios que se incluyen en un dispositivo determinado.</span><span class="sxs-lookup"><span data-stu-id="94997-108">The schema is assembled as a property of the OS, and the mapping between API sets and binaries may differ depending on which binaries are included in a given device.</span></span> <span data-ttu-id="94997-109">El esquema permite que una función importada en un solo binario se enrute correctamente en distintos dispositivos, incluso si se ha cambiado el nombre de los módulos del host binario o se han refactorizado por completo en dispositivos Windows diferentes.</span><span class="sxs-lookup"><span data-stu-id="94997-109">The schema enables an imported function in a single binary to be routed correctly on different devices, even if the module names of the binary host have been renamed or completely refactored on different Windows devices.</span></span>

<span data-ttu-id="94997-110">Windows 10 admite dos técnicas estándar para consumir e interactuar con conjuntos de API: **reenvío directo** y **reenvío inverso**.</span><span class="sxs-lookup"><span data-stu-id="94997-110">Windows 10 supports two standard techniques to consume and interface with API sets: **direct forwarding** and **reverse forwarding**.</span></span>

### <a name="direct-forwarding"></a><span data-ttu-id="94997-111">Reenvío directo</span><span class="sxs-lookup"><span data-stu-id="94997-111">Direct forwarding</span></span>

<span data-ttu-id="94997-112">En esta configuración, el código de consumo importa directamente un nombre de módulo de conjunto de API.</span><span class="sxs-lookup"><span data-stu-id="94997-112">In this configuration, the consuming code imports an API set module name directly.</span></span> <span data-ttu-id="94997-113">Esta importación se resuelve en una sola operación y es el método más eficaz con la sobrecarga mínima.</span><span class="sxs-lookup"><span data-stu-id="94997-113">This import is resolved in a single operation, and is the most efficient method with the least overhead.</span></span> <span data-ttu-id="94997-114">Conceptualmente, esta resolución puede apuntar a archivos binarios diferentes en dispositivos de Windows 10 diferentes, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="94997-114">Conceptually, this resolution may point to different binaries on different Windows 10 devices, as is shown in the following example:</span></span>

<span data-ttu-id="94997-115">Conjunto de API importado: **api-feature1-l1-1-0.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-115">Imported API set: **api-feature1-l1-1-0.dll**</span></span>
-  <span data-ttu-id="94997-116">Windows PC: > **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-116">Windows PC -> **feature1.dll**</span></span>
-  <span data-ttu-id="94997-117">HoloLens: > **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-117">HoloLens -> **feature1_holo.dll**</span></span>
-  <span data-ttu-id="94997-118">**feature1_iot.dll** de IoT-></span><span class="sxs-lookup"><span data-stu-id="94997-118">IoT -> **feature1_iot.dll**</span></span>

<span data-ttu-id="94997-119">Dado que las asignaciones se mantienen en un repositorio de datos de esquema personalizado, significa que un nombre de conjunto de API que termina con **. dll** no hace referencia directamente a un archivo en disco.</span><span class="sxs-lookup"><span data-stu-id="94997-119">Because the mappings are kept in a custom schema data repository, it means that an API set name that ends with **.dll** does not directly refer to a file on disk.</span></span> <span data-ttu-id="94997-120">La parte **. dll** del nombre del conjunto de API solo es una Convención requerida por el cargador.</span><span class="sxs-lookup"><span data-stu-id="94997-120">The **.dll** part of the API set name is only a convention required by the loader.</span></span> <span data-ttu-id="94997-121">El nombre del conjunto de API es más parecido a un alias o un nombre virtual para un archivo DLL físico.</span><span class="sxs-lookup"><span data-stu-id="94997-121">The API set name is more like an alias or a virtual name for a physical DLL file.</span></span> <span data-ttu-id="94997-122">Esto hace que el nombre sea portátil en todo el intervalo de dispositivos Windows 10.</span><span class="sxs-lookup"><span data-stu-id="94997-122">This makes the name portable across the entire range of Windows 10 devices.</span></span>

### <a name="reverse-forwarding"></a><span data-ttu-id="94997-123">Reenvío inverso</span><span class="sxs-lookup"><span data-stu-id="94997-123">Reverse forwarding</span></span>

<span data-ttu-id="94997-124">Aunque los nombres de los conjuntos de API proporcionan un espacio de nombres estable para los módulos en todos los dispositivos, no siempre es práctico convertir cada binario en este nuevo sistema.</span><span class="sxs-lookup"><span data-stu-id="94997-124">While API set names provide a stable namespace for modules across devices, it is not always practical to convert every binary to this new system.</span></span> <span data-ttu-id="94997-125">Por ejemplo, una aplicación puede haber estado en uso común durante muchos años y es posible que no sea factible volver a compilar los archivos binarios de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="94997-125">For example, an application may have been in common use for many years, and recompiling the application's binaries may not be feasible.</span></span> <span data-ttu-id="94997-126">Además, es posible que algunas aplicaciones deban seguir ejecutándose en sistemas compilados antes de que se introdujeran determinados conjuntos de API.</span><span class="sxs-lookup"><span data-stu-id="94997-126">Additionally, some applications may need to continue to run on systems built before specific API sets were introduced.</span></span>

<span data-ttu-id="94997-127">Para dar cabida a este nivel de compatibilidad, se proporciona un sistema de *reenviadores* en todos los dispositivos de Windows 10 que cubren un subconjunto de la superficie de la API de Win32.</span><span class="sxs-lookup"><span data-stu-id="94997-127">To accommodate this level of compatibility, a system of *forwarders* are provided on all Windows 10 devices that cover a subset of the Win32 API surface.</span></span> <span data-ttu-id="94997-128">Estos reenviadores usan los nombres de módulo que se introdujeron en los equipos Windows y aprovechan el sistema de conjunto de API para proporcionar compatibilidad en todos los dispositivos Windows 10.</span><span class="sxs-lookup"><span data-stu-id="94997-128">These forwarders use the module names that were introduced on Windows PCs, and leverage the API Set system to provide compatibility across all Windows 10 devices.</span></span>

<span data-ttu-id="94997-129">La operación del cargador se comporta de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="94997-129">The loader operation behaves like this:</span></span>

1.  <span data-ttu-id="94997-130">En un dispositivo que no sea un equipo con Windows, al cargador se le presenta una dependencia de nombre de módulo de PC de Windows heredada que no está presente en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="94997-130">On a device other than a Windows PC, the loader is presented a legacy Windows PC module name dependency that is not present on the device.</span></span>
2.  <span data-ttu-id="94997-131">El cargador localiza un reenviador de conjunto de API para este módulo y lo carga en la memoria.</span><span class="sxs-lookup"><span data-stu-id="94997-131">The loader locates an API set forwarder for this module and loads it into memory.</span></span>
3.  <span data-ttu-id="94997-132">El reenviador tiene una asignación para el conjunto de API para la función especificada a la que se llama.</span><span class="sxs-lookup"><span data-stu-id="94997-132">The forwarder has a mapping for the API set for the given function being called.</span></span>
4.  <span data-ttu-id="94997-133">El cargador busca el archivo binario de host adecuado para el dispositivo especificado.</span><span class="sxs-lookup"><span data-stu-id="94997-133">The loader finds the proper host binary for the given device.</span></span>

<span data-ttu-id="94997-134">Conceptualmente, la asignación tiene el siguiente aspecto:</span><span class="sxs-lookup"><span data-stu-id="94997-134">Conceptually, the mapping looks like:</span></span>

<span data-ttu-id="94997-135">DLL importada: **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-135">Imported DLL: **feature1.dll**</span></span>
- <span data-ttu-id="94997-136">Windows PC: > **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-136">Windows PC -> **feature1.dll**</span></span>
- <span data-ttu-id="94997-137">HoloLens-> **feature1.dll** reenviador-> **api-feature1-l1-1-0.dll**  ->  **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-137">HoloLens -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_holo.dll**</span></span>
- <span data-ttu-id="94997-138">IOT-> **feature1.dll** reenviador-> **api-feature1-l1-1-0.dll**  ->  **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="94997-138">IoT -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_iot.dll**</span></span>

<span data-ttu-id="94997-139">El resultado final es funcionalmente igual que el [reenvío directo](#direct-forwarding), pero lo consigue de forma que se maximice la compatibilidad de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="94997-139">The end result is functionally the same as [direct forwarding](#direct-forwarding), but it accomplishes it in a way that maximizes application compatibility.</span></span>

> [!NOTE]
> <span data-ttu-id="94997-140">El reenvío inverso proporciona cobertura solo para un subconjunto de la superficie de la API de Win32.</span><span class="sxs-lookup"><span data-stu-id="94997-140">Reverse forwarding provides coverage only for a subset of the Win32 API surface.</span></span> <span data-ttu-id="94997-141">No permite que las aplicaciones destinadas a versiones de escritorio de Windows 10 se ejecuten en todos los dispositivos Windows 10.</span><span class="sxs-lookup"><span data-stu-id="94997-141">It does not allow applications that target desktop versions of Windows 10 to run on all Windows 10 devices.</span></span>
