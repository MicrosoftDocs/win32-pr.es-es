---
description: A veces es conveniente crear una instantánea en un sistema, pero usar la instantánea en un segundo sistema.
ms.assetid: 4ec63917-03c0-434e-892e-3d9d4c47740e
title: Importar volúmenes de instantáneas transportables
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d259fbc047d088ee1f7064804a3ee98fe48da1b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104156125"
---
# <a name="importing-transportable-shadow-copied-volumes"></a><span data-ttu-id="25cdd-103">Importar volúmenes de instantáneas transportables</span><span class="sxs-lookup"><span data-stu-id="25cdd-103">Importing Transportable Shadow Copied Volumes</span></span>

<span data-ttu-id="25cdd-104">A veces es conveniente crear una instantánea en un sistema, pero usar la instantánea en un segundo sistema.</span><span class="sxs-lookup"><span data-stu-id="25cdd-104">It is sometimes desirable to create a shadow copy on one system, but use the shadow copy on a second system.</span></span>

<span data-ttu-id="25cdd-105">Considere el caso en el que los datos de los que se va a realizar la copia de seguridad se administran normalmente mediante un sistema determinado (*systemOne*) durante las operaciones normales y que estos datos se almacenan físicamente en una matriz de almacenamiento o un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="25cdd-105">Consider the case where data to be backed up is normally managed by a given system (*systemOne*) during normal operations, and that this data is physically stored on a storage array or an appliance.</span></span>

<span data-ttu-id="25cdd-106">Para minimizar cualquier interrupción en *systemOne* (debido a que las operaciones de copia de seguridad pueden consumir muchos recursos), es conveniente realizar la copia de seguridad con *systemTwo*, un servidor de copia de seguridad, que tiene acceso a la misma matriz de almacenamiento que *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="25cdd-106">To minimize any disruption to *systemOne* (because backup operations can be resource intensive), it is desirable to perform the backup using *systemTwo*, a backup server, which has access to the same storage array as *systemOne*.</span></span>

<span data-ttu-id="25cdd-107">Para garantizar una instantánea adecuada, cooperando con los escritores en *systemOne* y conservando el estado adecuado para las tareas en curso: *systemOne* debe realizar la instantánea.</span><span class="sxs-lookup"><span data-stu-id="25cdd-107">To ensure a proper shadow copy—cooperating with the writers on *systemOne* and preserving the state appropriately for ongoing tasks—the shadow copy should be performed by *systemOne*.</span></span>

<span data-ttu-id="25cdd-108">Por lo tanto, *systemOne* debe crear una [*instantánea transportable*](vssgloss-t.md), que a continuación se importará *systemTwo* .</span><span class="sxs-lookup"><span data-stu-id="25cdd-108">Therefore, *systemOne* must create a [*transportable shadow copy*](vssgloss-t.md), which *systemTwo* will then import.</span></span>

<span data-ttu-id="25cdd-109">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition y Windows XP:** No se admiten los conjuntos de instantáneas transportables.</span><span class="sxs-lookup"><span data-stu-id="25cdd-109">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="25cdd-110">Todas las ediciones de Windows Server 2003 con Service Pack 1 (SP1) admiten conjuntos de instantáneas transportables.</span><span class="sxs-lookup"><span data-stu-id="25cdd-110">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="25cdd-111">Un ejemplo típico de la importación de una instantánea transportable puede continuar de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="25cdd-111">A typical example of importing a transportable shadow copy can proceed in the following way:</span></span>

1.  <span data-ttu-id="25cdd-112">Inicialmente, la unidad lógica (LUN) proporcionada por la matriz de almacenamiento se monta como un volumen en *systemOne* (por ejemplo, F:).</span><span class="sxs-lookup"><span data-stu-id="25cdd-112">Initially, the logical unit (LUN) that is provided by the storage array is mounted as a volume on *systemOne* (say, F:).</span></span>
2.  <span data-ttu-id="25cdd-113">Un solicitante que se ejecuta en *systemOne* crea una instancia de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) y continúa como si se estuviera preparando para una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="25cdd-113">A requester that is running on *systemOne* instantiates an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) and proceeds as if it were preparing for a backup.</span></span> <span data-ttu-id="25cdd-114">(Consulte información general sobre la [inicialización de copias de seguridad](overview-of-backup-initialization.md), [información general de la fase de detección de copias](overview-of-the-backup-discovery-phase.md)de seguridad e información general sobre [las tareas de copia](overview-of-pre-backup-tasks.md) de seguridad para más información).</span><span class="sxs-lookup"><span data-stu-id="25cdd-114">(See [Overview of Backup Initialization](overview-of-backup-initialization.md), [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), and [Overview of Pre-Backup Tasks](overview-of-pre-backup-tasks.md) for more information.)</span></span>
3.  <span data-ttu-id="25cdd-115">El solicitante de *systemOne* modifica el contexto de instantáneas que se usa normalmente para la operación de copia de seguridad local (**VSS \_ CTX \_ App \_ backup**) para indicar que se creará una instantánea transportable (**VSS \_ VOLSNAP \_ ATTR \_ transportable**).</span><span class="sxs-lookup"><span data-stu-id="25cdd-115">The requester on *systemOne* modifies the shadow copy context that is typically used for local backup operation (**VSS\_CTX\_APP\_BACKUP**) to indicate that a transportable shadow copy will be created (**VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**).</span></span> <span data-ttu-id="25cdd-116">También se puede Agregar el atributo transportable a otros contextos de instantánea.</span><span class="sxs-lookup"><span data-stu-id="25cdd-116">The transportable attribute can be added to other shadow copy contexts as well.</span></span>
4.  <span data-ttu-id="25cdd-117">Con un contexto de instantáneas de VSS de solicitud de **\_ copia de \_ \_ seguridad de aplicaciones** de VSS \| , el solicitante que se encuentra en *systemOne* crea una instantánea mediante una llamada a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset). **\_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="25cdd-117">With a shadow copy context of **VSS\_CTX\_APP\_BACKUP** \| **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, the requester that is on *systemOne* creates a shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>
5.  <span data-ttu-id="25cdd-118">*SystemOne* usa [**IVssBackupComponents:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) para guardar el estado actual del documento de componentes de copia de seguridad y [**IVssExamineWriterMetadata:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) para guardar los documentos de metadatos del escritor de cada escritor.</span><span class="sxs-lookup"><span data-stu-id="25cdd-118">*SystemOne* uses [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) to save the current state of the Backup Components Document and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) to save each writer's Writer Metadata Documents.</span></span> <span data-ttu-id="25cdd-119">Las cadenas XML que contienen estos documentos se ponen a disposición de un solicitante que se ejecuta en *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="25cdd-119">The XML strings that contain these documents are then made available to a requester that is running on *systemTwo*.</span></span>

    <span data-ttu-id="25cdd-120">El solicitante transfiere el documento de componentes de copia de seguridad a *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="25cdd-120">The requester transfers the Backup Components Document to *systemTwo*.</span></span>

    <span data-ttu-id="25cdd-121">Tenga en cuenta que el solicitante de *systemOne* no libera su instancia de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) en este momento si el propósito de la instantánea es para la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="25cdd-121">Note that the requester on *systemOne* does not release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) at this point if the purpose of the shadow copy is for backup.</span></span> <span data-ttu-id="25cdd-122">La interfaz debe permanecer abierta hasta que *systemTwo* finalice correctamente las operaciones de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="25cdd-122">The interface should remain open until *systemTwo* successfully finishes its backup operations.</span></span> <span data-ttu-id="25cdd-123">Solo entonces el solicitante emitirá un evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , ya que algunos escritores truncarán los registros y realizarán otro trabajo después de una copia de seguridad correcta.</span><span class="sxs-lookup"><span data-stu-id="25cdd-123">Only then should the requester issue a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event since some writers will truncate logs and do other work after a successful backup.</span></span> <span data-ttu-id="25cdd-124">Si el objetivo de la instantánea es la minería de datos o cualquier otro propósito, la interfaz se puede cerrar en este paso.</span><span class="sxs-lookup"><span data-stu-id="25cdd-124">If the goal of the shadow copy is data mining or other purposes, then the interface can be closed at this step.</span></span>

6.  <span data-ttu-id="25cdd-125">A continuación, el solicitante de *systemTwo* llama a [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) para obtener acceso a la instantánea creada por el solicitante en *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="25cdd-125">The requester on *systemTwo* then calls [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) to get access to the shadow copy that was created by the requester on *systemOne*.</span></span>
    > [!Note]  
    > <span data-ttu-id="25cdd-126">El solicitante es responsable de serializar la operación de instantánea de importación.</span><span class="sxs-lookup"><span data-stu-id="25cdd-126">The requester is responsible for serializing the import shadow copy operation.</span></span> <span data-ttu-id="25cdd-127">Además, si se produce un error en la llamada a [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) , VSS no limpiará los LUN de su propiedad.</span><span class="sxs-lookup"><span data-stu-id="25cdd-127">Also, if the call to [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) fails, the VSS won't clean up LUNs on it's own.</span></span> <span data-ttu-id="25cdd-128">El solicitante tiene que iniciar la limpieza de LUN.</span><span class="sxs-lookup"><span data-stu-id="25cdd-128">The requester has to initiate the cleanup of LUNs.</span></span>

     

7.  <span data-ttu-id="25cdd-129">El solicitante de *systemTwo* continúa con la copia de seguridad del material de copia sombra exactamente como si se tratara de una copia de seguridad de una instantánea creada por sí misma (consulte [información general sobre la copia de seguridad real de archivos](overview-of-actual-backup-of-files.md)).</span><span class="sxs-lookup"><span data-stu-id="25cdd-129">The requester on *systemTwo* proceeds with the backup of the shadow copied material exactly as if it were backing up a shadow copy that it created by itself (see [Overview of Actual Backup Of Files](overview-of-actual-backup-of-files.md)).</span></span>

    <span data-ttu-id="25cdd-130">El solicitante de *systemTwo* obtiene el [*objeto de dispositivo*](vssgloss-d.md) de la instantánea mediante [**IVssBackupComponents:: GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) en la instantánea importada y lo anexa al principio de las rutas de acceso de archivo originales obtenidas de los metadatos para acceder a los archivos de los que se va a hacer una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="25cdd-130">The requester on *systemTwo* obtains the shadow copy's [*device object*](vssgloss-d.md) using [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) on the imported shadow copy and appends that to the beginning of the original file paths that were obtained from the metadata to access files to be backed up.</span></span>

8.  <span data-ttu-id="25cdd-131">Después de usar la instantánea, el solicitante de *systemTwo* debe eliminar la instantánea.</span><span class="sxs-lookup"><span data-stu-id="25cdd-131">After using the shadow copy, the requester on *systemTwo* must delete the shadow copy.</span></span> <span data-ttu-id="25cdd-132">Al igual que con las instantáneas no transportables, si el contexto de instantáneas indica instantáneas de versión automática (por ejemplo, la **\_ copia de \_ seguridad de VSS CTX**), la liberación de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) en *systemTwo* hará que el servicio VSS elimine la instantánea.</span><span class="sxs-lookup"><span data-stu-id="25cdd-132">As with non-transportable shadow copies, if the shadow copy context indicates auto-release shadow copies (for example, **VSS\_CTX\_BACKUP**), then releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) on *systemTwo* will cause the VSS service to delete the shadow copy.</span></span> <span data-ttu-id="25cdd-133">De lo contrario, si el contexto indica una instantánea persistente (por ejemplo, la **\_ \_ \_ reversión de la aplicación VSS CTX**), el solicitante de *systemTwo* debe eliminar explícitamente la instantánea.</span><span class="sxs-lookup"><span data-stu-id="25cdd-133">Otherwise, if the context indicates a persistent shadow copy (for example, **VSS\_CTX\_APP\_ROLLBACK**), then the requester on *systemTwo* must explicitly delete the shadow copy.</span></span>

    <span data-ttu-id="25cdd-134">A continuación, el solicitante de *systemTwo* señalará al solicitante en *systemOne* que ha finalizado con la copia de seguridad de la instantánea transportable.</span><span class="sxs-lookup"><span data-stu-id="25cdd-134">Then the requester on *systemTwo* signals the requester on *systemOne* that it has finished with the backup of the transportable shadow copy.</span></span>

9.  <span data-ttu-id="25cdd-135">Una vez que el solicitante de *systemOne* ha recibido la notificación de que el solicitante en *systemTwo* ha finalizado la copia de seguridad de la instantánea transportable, notifica a los escritores de su sistema mediante la generación de un evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) con una llamada a **IVssBackupComponents:: BackupComplete**.</span><span class="sxs-lookup"><span data-stu-id="25cdd-135">After the requester on *systemOne* has received notification that the requester on *systemTwo* has finished the backup of the transportable shadow copy, it notifies the writers on its system by generating a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event with a call to **IVssBackupComponents::BackupComplete**.</span></span> <span data-ttu-id="25cdd-136">En este momento, el solicitante de *systemOne* es gratuito para liberar su instancia de [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="25cdd-136">At this point, the requester on *systemOne* is free to release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

<span data-ttu-id="25cdd-137">**Instantáneas transportables en un clúster:** Las instantáneas transportables se deben importar desde fuera del clúster, siempre y cuando el volumen original esté montado en el clúster.</span><span class="sxs-lookup"><span data-stu-id="25cdd-137">**Transportable shadow copies in a cluster:** Transportable shadow copies must be imported from outside the cluster as long as the original volume is mounted within the cluster.</span></span> <span data-ttu-id="25cdd-138">Para obtener información sobre cómo implementar una recuperación rápida en un clúster, consulte [recuperación rápida mediante el uso de volúmenes de instantáneas transportables](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="25cdd-138">For information about implementing a fast recovery in a cluster, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

 

 



