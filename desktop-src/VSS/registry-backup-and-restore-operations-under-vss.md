---
description: El servicio de registro de Windows admite un VSS Writer, denominado escritor del registro, que permite a los solicitantes realizar copias de seguridad de un registro del sistema mediante los datos almacenados en un volumen de copia sombra.
ms.assetid: 94a45b04-0bdc-4211-bed0-caeabba774af
title: Operaciones de copia de seguridad y restauración del registro en VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db1a3022ec2fb08b07bcff8b28455ae7154e4c40
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696979"
---
# <a name="registry-backup-and-restore-operations-under-vss"></a><span data-ttu-id="b213c-103">Operaciones de copia de seguridad y restauración del registro en VSS</span><span class="sxs-lookup"><span data-stu-id="b213c-103">Registry Backup and Restore Operations Under VSS</span></span>

<span data-ttu-id="b213c-104">El servicio de registro de Windows admite un VSS Writer, denominado escritor del registro, que permite a los solicitantes realizar copias de seguridad de un registro del sistema mediante los datos almacenados en un volumen de copia sombra.</span><span class="sxs-lookup"><span data-stu-id="b213c-104">The Windows Registry Service supports a VSS writer, called the registry writer, which allows requesters to back up a system registry using data stored on a shadow copied volume.</span></span> <span data-ttu-id="b213c-105">Para obtener más información sobre el sistema de escritura del registro, consulte [escritores de VSS en la caja](in-box-vss-writers.md).</span><span class="sxs-lookup"><span data-stu-id="b213c-105">For more information about the registry writer, see [In-Box VSS Writers](in-box-vss-writers.md).</span></span>

<span data-ttu-id="b213c-106">El sistema de escritura del registro realiza copias de seguridad en contexto y restauraciones del registro.</span><span class="sxs-lookup"><span data-stu-id="b213c-106">The registry writer performs in-place backups and restores of the registry.</span></span> <span data-ttu-id="b213c-107">Además, el escritor del registro solo informa de los subárboles del sistema; no notifica subárboles de usuario.</span><span class="sxs-lookup"><span data-stu-id="b213c-107">In addition, the registry writer reports only system hives; it does not report user hives.</span></span>

<span data-ttu-id="b213c-108">**Windows Server 2003:** El sistema de escritura del registro usa un archivo de repositorio intermedio (también conocido como archivo de la media) para almacenar los datos del registro.</span><span class="sxs-lookup"><span data-stu-id="b213c-108">**Windows Server 2003:** The registry writer uses an intermediate repository file (also known as a spit file) to store registry data.</span></span> <span data-ttu-id="b213c-109">Además, el escritor del registro informa de los subárboles del sistema y de los subárboles del usuario.</span><span class="sxs-lookup"><span data-stu-id="b213c-109">In addition, the registry writer reports system hives and user hives.</span></span>

<span data-ttu-id="b213c-110">El ID. de escritor del sistema de escritura del registro es AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span><span class="sxs-lookup"><span data-stu-id="b213c-110">The writer ID for the registry writer is AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span></span>

<span data-ttu-id="b213c-111">**Windows XP:** No hay ningún sistema de escritura del registro.</span><span class="sxs-lookup"><span data-stu-id="b213c-111">**Windows XP:** There is no registry writer.</span></span> <span data-ttu-id="b213c-112">El escritor de estado de arranque indica los datos del registro, cuyo identificador de escritor es F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span><span class="sxs-lookup"><span data-stu-id="b213c-112">The registry data is reported by the Bootable State writer, whose writer ID is F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span></span>

> [!Note]  
> <span data-ttu-id="b213c-113">Microsoft no proporciona soporte técnico para desarrolladores o profesionales de TI para implementar restauraciones de estado del sistema en línea en Windows (todas las versiones).</span><span class="sxs-lookup"><span data-stu-id="b213c-113">Microsoft does not provide developer or IT professional technical support for implementing online system state restores on Windows (all releases).</span></span> <span data-ttu-id="b213c-114">Para obtener información sobre el uso de las API y los procedimientos proporcionados por Microsoft para implementar restauraciones de estado del sistema en línea, consulte los recursos de la comunidad disponibles en [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span><span class="sxs-lookup"><span data-stu-id="b213c-114">For information about using Microsoft-provided APIs and procedures to implement online system state restores, see the community resources available at the [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span></span>

 

> [!Note]  
> <span data-ttu-id="b213c-115">La siguiente información solo se aplica a Windows Server 2003 y Windows XP.</span><span class="sxs-lookup"><span data-stu-id="b213c-115">The following information only applies to Windows Server 2003 and Windows XP.</span></span>

 

## <a name="registry-backup-using-vss"></a><span data-ttu-id="b213c-116">Copia de seguridad del registro mediante VSS</span><span class="sxs-lookup"><span data-stu-id="b213c-116">Registry Backup Using VSS</span></span>

<span data-ttu-id="b213c-117">El sistema de escritura del registro exportará y guardará los archivos de registro activos en las ubicaciones definidas por la clave **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **control** \\ **hivelist**.</span><span class="sxs-lookup"><span data-stu-id="b213c-117">The registry writer will export and save active registry files in the locations defined by the key **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**.</span></span>

<span data-ttu-id="b213c-118">Los nombres de los valores de esta entrada del registro identifican el subárbol del registro que se va a guardar y los datos del valor proporcionan el archivo que contiene el archivo (el archivo de Hive).</span><span class="sxs-lookup"><span data-stu-id="b213c-118">The names of the values under this registry entry identify the registry hive to be saved, and the value's data provides the file containing the file (the hive file).</span></span> <span data-ttu-id="b213c-119">Los archivos de Hive se especifican con el siguiente formato: \\ Device \\ *HarddiskVolumeX* \\ *path* \\ *filename*.</span><span class="sxs-lookup"><span data-stu-id="b213c-119">The hive files are specified with the following format: \\Device\\*HarddiskVolumeX*\\*path*\\*filename*.</span></span>

<span data-ttu-id="b213c-120">Por ejemplo, en **HKEY \_ local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **control** \\ **hivelist**, puede ver **\\ Registry \\ Machine \\ software**  =  \\ Device \\ HarddiskVolume1 \\ Windows \\ system32 \\ config \\ software.</span><span class="sxs-lookup"><span data-stu-id="b213c-120">For example, under **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**, you might see **\\REGISTRY\\MACHINE\\SOFTWARE** = \\Device\\HarddiskVolume1\\Windows\\System32\\config\\SOFTWARE.</span></span>

<span data-ttu-id="b213c-121">El sistema de escritura del registro garantiza que los archivos de Hive se guardan en el disco antes de su instantánea.</span><span class="sxs-lookup"><span data-stu-id="b213c-121">The registry writer ensures that hive files are saved to disk prior to its shadow copy.</span></span>

<span data-ttu-id="b213c-122">Al realizar una copia de seguridad de los subárboles del registro, un solicitante reemplazaría el \\ dispositivo \\ *HarddiskVolumeX* por la cadena de [*objeto del dispositivo*](vssgloss-d.md) de la instantánea del volumen.</span><span class="sxs-lookup"><span data-stu-id="b213c-122">When backing up the registry hives, a requester would replace \\Device\\*HarddiskVolumeX* with the [*device object*](vssgloss-d.md) string of the volume's shadow copy.</span></span>

> [!Note]  
> <span data-ttu-id="b213c-123">Puede convertir la \\ ruta de acceso del dispositivo \\ *HarddiskVolumeX* en una ruta de acceso de Win32 equivalente mediante la función [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) .</span><span class="sxs-lookup"><span data-stu-id="b213c-123">You can convert the \\Device\\*HarddiskVolumeX* path to an equivalent Win32 path by using the [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) function.</span></span> <span data-ttu-id="b213c-124">Para obtener más información, vea [obtener un nombre de archivo de un identificador de archivo](../memory/obtaining-a-file-name-from-a-file-handle.md) o [Mostrar los nombres de ruta de acceso del volumen](../fileio/displaying-volume-paths.md).</span><span class="sxs-lookup"><span data-stu-id="b213c-124">For more information, see [Obtaining a File Name From a File Handle](../memory/obtaining-a-file-name-from-a-file-handle.md) or [Displaying Volume Path Names](../fileio/displaying-volume-paths.md).</span></span>

 

## <a name="registry-restore-using-non-vss-win32-apis"></a><span data-ttu-id="b213c-125">Restauración del registro mediante las API de Win32 que no son VSS</span><span class="sxs-lookup"><span data-stu-id="b213c-125">Registry Restore Using Non-VSS Win32 APIs</span></span>

<span data-ttu-id="b213c-126">En el caso de una restauración en línea (modo seguro o sistema operativo completo), deben conservarse las subclaves **de la \_ \_** \\  \\  \\  \\  \\  clave del registro.</span><span class="sxs-lookup"><span data-stu-id="b213c-126">For an online (safe mode or full operating system) restore, the subkeys in the **HKEY\_LOCAL\_MACHINE**\\**SYSTEM**\\**CurrentControlSet**\\**Control**\\**Session Manager**\\**PendingFileRenameOperations** registry key must be preserved.</span></span>

<span data-ttu-id="b213c-127">Las funciones [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) y [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) usan esta clave del registro para almacenar información sobre los archivos a los que se ha cambiado el nombre mediante el retardo de MOVEFILE \_ \_ hasta \_ el valor de reinicio en el parámetro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="b213c-127">The [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) and [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) functions use this registry key to store information about files that were renamed by using the MOVEFILE\_DELAY\_UNTIL\_REBOOT value in the *dwFlags* parameter.</span></span>

<span data-ttu-id="b213c-128">Para conservar el contenido de la clave del registro **PendingFileRenameOperations** , la aplicación de copia de seguridad debe llamar a la función [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) para conectar el archivo del registro que se va a restaurar en el registro activo.</span><span class="sxs-lookup"><span data-stu-id="b213c-128">To preserve the contents of the **PendingFileRenameOperations** registry key, your backup application should call the [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) function to connect the registry file to be restored to the active registry.</span></span> <span data-ttu-id="b213c-129">La aplicación de copia de seguridad puede usar las distintas funciones del registro para copiar las claves y los valores deseados en el subárbol cargado.</span><span class="sxs-lookup"><span data-stu-id="b213c-129">Your backup application can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="b213c-130">Una vez completada la copia, se debe llamar a las funciones [**RegFlushKey**](/windows/win32/api/winreg/nf-winreg-regflushkey) y [**RegUnloadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) .</span><span class="sxs-lookup"><span data-stu-id="b213c-130">After the copy is complete, the [**RegFlushKey**](/windows/win32/api/winreg/nf-winreg-regflushkey) and [**RegUnloadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) functions should be called.</span></span>

<span data-ttu-id="b213c-131">En el caso de una restauración sin conexión (entorno de recuperación de Windows o Windows PE), no es necesario respetar la clave del registro **PendingFileRenameOperations** .</span><span class="sxs-lookup"><span data-stu-id="b213c-131">For an offline (Windows Recovery Environment or Windows PE) restore, it is not necessary to honor the **PendingFileRenameOperations** registry key.</span></span>

## <a name="registry-restore-using-non-vss-win32-apis-in-windows-server-2003"></a><span data-ttu-id="b213c-132">Restauración del registro mediante las API de Win32 que no son de VSS en Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="b213c-132">Registry Restore Using Non-VSS Win32 APIs in Windows Server 2003</span></span>

> [!Note]  
> <span data-ttu-id="b213c-133">La siguiente información solo se aplica a las operaciones de restauración relacionadas con la recuperación ante desastres (también denominada reconstrucción completa) que se realizan en Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="b213c-133">The following information applies only to restore operations related to disaster recovery (also known as bare-metal recovery) that are performed in Windows Server 2003.</span></span>

 

<span data-ttu-id="b213c-134">Al restaurar el registro, una aplicación de copia de seguridad debe trasladar algunas de las subclaves del registro actual al registro que se va a restaurar.</span><span class="sxs-lookup"><span data-stu-id="b213c-134">When restoring the registry, a backup application needs to move some of the subkeys from the current registry into the registry that is to be restored.</span></span>

<span data-ttu-id="b213c-135">Para ello, una aplicación de copia de seguridad puede llamar a **RegLoadKey** para conectar el archivo de registro que se va a restaurar en el registro activo actualmente.</span><span class="sxs-lookup"><span data-stu-id="b213c-135">To do this, a backup application can call **RegLoadKey** to connect the registry file to be restored to the currently active registry.</span></span> <span data-ttu-id="b213c-136">Después, puede usar las distintas funciones del registro para copiar las claves y los valores deseados en el subárbol cargado.</span><span class="sxs-lookup"><span data-stu-id="b213c-136">It can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="b213c-137">Una vez completada la copia, se llama a **RegFlushKey** y **RegUnloadKey** .</span><span class="sxs-lookup"><span data-stu-id="b213c-137">After the copy is complete, **RegFlushKey** and **RegUnloadKey** are called.</span></span>

<span data-ttu-id="b213c-138">Hay una clave del registro que indica a una aplicación de restauración (solicitante) las claves del registro en **HKEY \_ local \_ Machine \\ System** que no se deben sobrescribir en el momento de la restauración:</span><span class="sxs-lookup"><span data-stu-id="b213c-138">There is a registry key that indicates to a restore application (requester) the registry keys under **HKEY\_LOCAL\_MACHINE\\SYSTEM** that should not be overwritten at restore time:</span></span>

<span data-ttu-id="b213c-139">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ control \\ BackupRestore \\ KeysNotToRestore**</span><span class="sxs-lookup"><span data-stu-id="b213c-139">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="b213c-140">Parte del proceso de restauración del estado del sistema implica la restauración de un registro del que se ha realizado previamente una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b213c-140">Part of the system state restore process involves restoring a previously backed-up registry.</span></span>

<span data-ttu-id="b213c-141">Las aplicaciones de copia de seguridad deben tener especial cuidado al restaurar el subárbol del **\_ \_ \\ sistema del equipo local HKEY** porque el proceso de instalación de una versión temporal del sistema operativo Windows habrá establecido claves en el subárbol del sistema recién instalado cuyos valores deben sobrevivir a la operación de restauración.</span><span class="sxs-lookup"><span data-stu-id="b213c-141">Backup applications need to take special care when restoring the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive because the process of installing a temporary version of the Windows operating system will have established keys in the newly installed system hive whose values must survive the restore operation.</span></span>

<span data-ttu-id="b213c-142">Por ejemplo, cuando el sistema de sustitución tiene una tarjeta de interfaz de red diferente del sistema original, la restauración de las claves originales de la tarjeta anterior dará lugar a resultados imprevisibles.</span><span class="sxs-lookup"><span data-stu-id="b213c-142">For example, when the replacement system has a network interface card different from the original system, restoration of the original keys for the previous card will lead to unpredictable results.</span></span> <span data-ttu-id="b213c-143">Esto se debe a que el servicio Plug and Play ha detectado y colocado entradas adecuadas del registro del servicio y del controlador en el registro.</span><span class="sxs-lookup"><span data-stu-id="b213c-143">This is because the Plug and Play service has detected and placed proper service and driver registry entries into the registry.</span></span> <span data-ttu-id="b213c-144">Estos valores se deben conservar para arrancar correctamente después de restaurar el sistema.</span><span class="sxs-lookup"><span data-stu-id="b213c-144">These values must be preserved to properly boot after system restore.</span></span>

<span data-ttu-id="b213c-145">En esta sección se describe cómo las aplicaciones de copia de seguridad pueden detectar qué claves y archivos se conservarán al ejecutar una restauración del subárbol **\_ \_ \\ del sistema del equipo local HKEY** .</span><span class="sxs-lookup"><span data-stu-id="b213c-145">This section describes how backup applications can discover which keys and files are to be preserved when executing a restore of the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive.</span></span> <span data-ttu-id="b213c-146">En algunos casos, esto implica copiar mediante programación las claves del subárbol de instalación recién instalado en el subárbol que se va a restaurar.</span><span class="sxs-lookup"><span data-stu-id="b213c-146">In some cases, this will involve programmatically copying the keys from the newly installed installation hive into the hive to be restored.</span></span> <span data-ttu-id="b213c-147">En otros casos, garantizar que las claves del registro de un producto no se reemplacen es tan sencilla como especificar dichas claves en el archivo de configuración INF del producto.</span><span class="sxs-lookup"><span data-stu-id="b213c-147">In other cases, ensuring that a product's registry keys are not replaced is as simple as specifying such keys in the product's INF configuration file.</span></span>

<span data-ttu-id="b213c-148">Las claves (y los datos clave) que se van a conservar se enumeran en el subárbol **\_ \_ \\ del sistema del equipo local HKEY** en el</span><span class="sxs-lookup"><span data-stu-id="b213c-148">Keys (and key data) that are to be preserved are enumerated in the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive under the</span></span>

<span data-ttu-id="b213c-149">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ control \\ BackupRestore \\ KeysNotToRestore**</span><span class="sxs-lookup"><span data-stu-id="b213c-149">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="b213c-150">Key como conjuntos de \_ cadenas reg multi \_ SZ (llamadas *cadenas de clave* en este documento).</span><span class="sxs-lookup"><span data-stu-id="b213c-150">key as sets of REG\_MULTI\_SZ strings (called *key strings* in this document).</span></span>

<span data-ttu-id="b213c-151">Una aplicación de copia de seguridad (solicitante) debe examinar los valores de estas claves en el registro activo y el registro recién restaurado porque cualquier aplicación o servicio puede agregar valores en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="b213c-151">A backup application (requester) must examine the values of these keys in the active registry and the newly restored registry because any application or service can add values at any time.</span></span>

<span data-ttu-id="b213c-152">La forma en que las aplicaciones de copia de seguridad van a interpretar las cadenas de clave se determinan mediante el carácter de terminal:</span><span class="sxs-lookup"><span data-stu-id="b213c-152">How key strings are to be interpreted by backup applications is determined by their terminal character:</span></span>

1.  <span data-ttu-id="b213c-153">Las cadenas de clave terminadas con una barra diagonal inversa (' \\ ') se interpretan como subclaves.</span><span class="sxs-lookup"><span data-stu-id="b213c-153">Key strings terminated with a backslash ('\\') are interpreted as subkeys.</span></span> <span data-ttu-id="b213c-154">Cuando se encuentra una subcadena de este tipo, la aplicación de copia de seguridad debe conservar todos los datos y todas las claves subordinadas.</span><span class="sxs-lookup"><span data-stu-id="b213c-154">When such a substring is encountered, the backup application must preserve all data and all subordinate keys.</span></span>

    <span data-ttu-id="b213c-155">Por ejemplo, lo siguiente especifica que todas las claves y los datos subordinados se conservarán en una operación de restauración:</span><span class="sxs-lookup"><span data-stu-id="b213c-155">For example, the following specifies that all subordinate keys and data are to be preserved across a restore operation:</span></span>

    <span data-ttu-id="b213c-156">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ Services \\ dmio \\ información de arranque\\**</span><span class="sxs-lookup"><span data-stu-id="b213c-156">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\dmio\\boot info\\**</span></span>

    <span data-ttu-id="b213c-157">Para ello, esta clave y todas las claves y los datos subordinados se deben copiar del registro existente (es decir, el creado por la instalación de Windows) en el registro recién restaurado.</span><span class="sxs-lookup"><span data-stu-id="b213c-157">To this end, this key and all subordinate keys and data must be copied from the existing registry (that is, the one created by the installation of Windows) into the newly restored registry.</span></span> <span data-ttu-id="b213c-158">Esto se denomina operación de *reemplazo de clave* .</span><span class="sxs-lookup"><span data-stu-id="b213c-158">This is called a *key replace* operation.</span></span> <span data-ttu-id="b213c-159">Esta operación reemplaza la clave correspondiente en el registro restaurado.</span><span class="sxs-lookup"><span data-stu-id="b213c-159">This operation replaces the corresponding key in the restored registry.</span></span>

2.  <span data-ttu-id="b213c-160">Las cadenas de clave cuyo carácter de terminación es un asterisco (' \* ') especifica que todas las subclaves deben combinarse.</span><span class="sxs-lookup"><span data-stu-id="b213c-160">Key strings whose termination character is an asterisk ('\*') specifies that all subkeys should be merged.</span></span> <span data-ttu-id="b213c-161">Por ejemplo, la cadena de clave:</span><span class="sxs-lookup"><span data-stu-id="b213c-161">For example, the key string:</span></span>

    <span data-ttu-id="b213c-162">\**HKEY \_ \_Sistema de equipo local \\ \\ CurrentControlSet \\ \\ \* Services* _</span><span class="sxs-lookup"><span data-stu-id="b213c-162">\**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\\** _</span></span>

    <span data-ttu-id="b213c-163">Especifica que la clave de servicios del registro existente (por ejemplo, los creados por la instalación de Windows) debe combinarse en el registro restaurado.</span><span class="sxs-lookup"><span data-stu-id="b213c-163">specifies that the services key in the existing registry (for example those created by the installation of Windows) must be merged into the restored registry.</span></span> <span data-ttu-id="b213c-164">Esto se denomina operación _key Merge \* y, si existe una subclave en el subárbol existente y en el subárbol restaurado, la clave del directorio restaurado se conserva con las siguientes excepciones:</span><span class="sxs-lookup"><span data-stu-id="b213c-164">This is called a _key merge\* operation, and if a subkey exists in both the existing hive and the restored hive, the key in the restored directory is preserved with the following exceptions:</span></span>

    -   <span data-ttu-id="b213c-165">Si la subclave del subárbol existente contiene un valor denominado "Start" y la subclave de la restaurada no lo hace.</span><span class="sxs-lookup"><span data-stu-id="b213c-165">If the subkey in the existing hive contains a value named "start", and the subkey in the restored does not.</span></span>
    -   <span data-ttu-id="b213c-166">Si la subclave del subárbol existente y restaurado contiene un valor denominado "Start" y su valor numérico en el subárbol existente es menor.</span><span class="sxs-lookup"><span data-stu-id="b213c-166">If the subkey in both the existing and restored hive contain a value named "start", and its numeric value in the existing hive is less.</span></span>

    <span data-ttu-id="b213c-167">El valor "Start" del registro especifica cuándo se iniciará un servicio o un controlador y puede tener un valor numérico de 0-4.</span><span class="sxs-lookup"><span data-stu-id="b213c-167">The "start" value in the registry specifies when a service or driver will start and can have a numeric value from 0-4.</span></span> <span data-ttu-id="b213c-168">Cuanto menor sea el valor, más pronto se iniciará el servicio en el proceso de arranque.</span><span class="sxs-lookup"><span data-stu-id="b213c-168">The lower the value, the sooner in the boot process the service will start.</span></span>

    <span data-ttu-id="b213c-169">Si esta clave existe en el directorio existente y en el restaurado, debe examinar el valor de la clave de inicio en cada subárbol.</span><span class="sxs-lookup"><span data-stu-id="b213c-169">If this key exists in both the existing and the restored directory, you must examine the value of the start key in each hive.</span></span> <span data-ttu-id="b213c-170">Si el valor del subárbol existente es inferior al valor del directorio restaurado, se debe conservar el valor inferior.</span><span class="sxs-lookup"><span data-stu-id="b213c-170">If the value in the existing hive is lower than the value in the restored directory, the lower value must be preserved.</span></span>

    <span data-ttu-id="b213c-171">Una vez más, esta clave se usa para determinar si un servicio o un controlador se va a iniciar en el momento del arranque, en la hora del sistema, de forma manual, automática o deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="b213c-171">Once again, this key is used to determine whether a service or driver is to be started at boot time, at system time, manually, automatically, or be disabled.</span></span> <span data-ttu-id="b213c-172">El valor inferior representa una hora de inicio anterior.</span><span class="sxs-lookup"><span data-stu-id="b213c-172">The lower value represents an earlier start time.</span></span> <span data-ttu-id="b213c-173">La hora de inicio anterior debe aplicarse al nuevo registro para asegurarse de que el servicio o los controladores se inician correctamente en el siguiente arranque.</span><span class="sxs-lookup"><span data-stu-id="b213c-173">The earlier start time must be applied to the new registry to ensure that the service or drivers are started properly at the next boot.</span></span>

3.  <span data-ttu-id="b213c-174">Las cadenas de clave cuyo carácter de terminación no es una barra diagonal inversa ni un asterisco se interpretan como valores del registro que se van a conservar.</span><span class="sxs-lookup"><span data-stu-id="b213c-174">Key strings whose termination character is neither a backslash nor an asterisk are interpreted as registry values to be preserved.</span></span>

    <span data-ttu-id="b213c-175">Por ejemplo, la cadena de clave:</span><span class="sxs-lookup"><span data-stu-id="b213c-175">For example, the key string:</span></span>

    <span data-ttu-id="b213c-176">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ control \\ Session Manager \\ PendingFileRenameOperations**</span><span class="sxs-lookup"><span data-stu-id="b213c-176">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\PendingFileRenameOperations**</span></span>

    <span data-ttu-id="b213c-177">El mecanismo por el que se pueden conservar las claves mediante programación implica la API del registro de Win32.</span><span class="sxs-lookup"><span data-stu-id="b213c-177">The mechanism by which keys can be preserved programmatically involves the Win32 registry API.</span></span> <span data-ttu-id="b213c-178">Por ejemplo, un algoritmo se enumera a continuación:</span><span class="sxs-lookup"><span data-stu-id="b213c-178">For example, one algorithm is enumerated below:</span></span>

    1.  <span data-ttu-id="b213c-179">Restaure el archivo de subárbol del sistema con copia de seguridad en un archivo.</span><span class="sxs-lookup"><span data-stu-id="b213c-179">Restore the backed-up system hive file to a file.</span></span> <span data-ttu-id="b213c-180">En este ejemplo, deje que el nombre sea System. reg.</span><span class="sxs-lookup"><span data-stu-id="b213c-180">For this example, let the name be System.reg.</span></span>
    2.  <span data-ttu-id="b213c-181">Use **RegLoadKey** para cargar System. reg en **el \_ \_ equipo local HKEY** bajo un nombre temporal.</span><span class="sxs-lookup"><span data-stu-id="b213c-181">Use **RegLoadKey** to load System.reg into **HKEY\_LOCAL\_MACHINE** under a temporary name.</span></span> <span data-ttu-id="b213c-182">Por ejemplo, un nombre de este tipo podría ser</span><span class="sxs-lookup"><span data-stu-id="b213c-182">For example, one such name might be</span></span>

        <span data-ttu-id="b213c-183">**HKEY \_ local \_ Machine \\ TMP \_ System**</span><span class="sxs-lookup"><span data-stu-id="b213c-183">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

    3.  <span data-ttu-id="b213c-184">Enumere los valores de la subclave **KeysNotToRestore** de ambas copias del registro y cree un superconjunto de las listas.</span><span class="sxs-lookup"><span data-stu-id="b213c-184">Enumerate the values in the **KeysNotToRestore** subkey from both of the registry copies and create a superset of the lists.</span></span> <span data-ttu-id="b213c-185">Copie cada una de estas claves de la existente.</span><span class="sxs-lookup"><span data-stu-id="b213c-185">Copy each such key from the existing</span></span>

        <span data-ttu-id="b213c-186">**HKEY \_ \_ \\ sistema del equipo local**</span><span class="sxs-lookup"><span data-stu-id="b213c-186">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="b213c-187">clave en el</span><span class="sxs-lookup"><span data-stu-id="b213c-187">key into the</span></span>

        <span data-ttu-id="b213c-188">**HKEY \_ local \_ Machine \\ TMP \_ System**</span><span class="sxs-lookup"><span data-stu-id="b213c-188">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="b213c-189">clave según la semántica descrita anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b213c-189">key according to the semantics described above.</span></span>

    4.  <span data-ttu-id="b213c-190">Cuando haya terminado, use los puntos de entrada de **RegFlushKey**  &  **RegUnloadKey** para guardar el</span><span class="sxs-lookup"><span data-stu-id="b213c-190">When complete use the **RegFlushKey** & **RegUnloadKey** entry points to save the</span></span>

        <span data-ttu-id="b213c-191">**HKEY \_ local \_ Machine \\ TMP \_ System**</span><span class="sxs-lookup"><span data-stu-id="b213c-191">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="b213c-192">Vuelva a System. reg.</span><span class="sxs-lookup"><span data-stu-id="b213c-192">key back to System.reg.</span></span>

    5.  <span data-ttu-id="b213c-193">Por último, use **RegReplaceKey** para especificar que System. reg va a reemplazar el</span><span class="sxs-lookup"><span data-stu-id="b213c-193">Finally, use **RegReplaceKey** to specify that System.reg is to replace the</span></span>

        <span data-ttu-id="b213c-194">**HKEY \_ \_ \\ sistema del equipo local**</span><span class="sxs-lookup"><span data-stu-id="b213c-194">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="b213c-195">archivo de Hive, sistema.</span><span class="sxs-lookup"><span data-stu-id="b213c-195">hive file, SYSTEM.</span></span>

 

 
