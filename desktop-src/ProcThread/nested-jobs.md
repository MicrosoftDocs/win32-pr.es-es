---
description: Una aplicación puede usar trabajos anidados para administrar subconjuntos de procesos. Los trabajos anidados también habilitan una aplicación que usa trabajos para hospedar otras aplicaciones que también usan trabajos.
ms.assetid: FA22493B-CD29-49A7-BDAC-349FA96B8C9E
title: Trabajos anidados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: abf105c70ec8e83b395fcce56c6274d4838358bc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104552009"
---
# <a name="nested-jobs"></a><span data-ttu-id="97449-104">Trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-104">Nested Jobs</span></span>

<span data-ttu-id="97449-105">Una aplicación puede usar trabajos anidados para administrar subconjuntos de procesos.</span><span class="sxs-lookup"><span data-stu-id="97449-105">An application can use nested jobs to manage subsets of processes.</span></span> <span data-ttu-id="97449-106">Los trabajos anidados también habilitan una aplicación que usa trabajos para hospedar otras aplicaciones que también usan trabajos.</span><span class="sxs-lookup"><span data-stu-id="97449-106">Nested jobs also enable an application that uses jobs to host other applications that also use jobs.</span></span>

<span data-ttu-id="97449-107">**Windows 7, Windows server 2008 R2, Windows XP con SP3, Windows server 2008, Windows Vista y Windows server 2003:** Un proceso solo se puede asociar a un único trabajo.</span><span class="sxs-lookup"><span data-stu-id="97449-107">**Windows 7, Windows Server 2008 R2, Windows XP with SP3, Windows Server 2008, Windows Vista and Windows Server 2003:** A process can be associated with only a single job.</span></span> <span data-ttu-id="97449-108">Los trabajos anidados se introdujeron en Windows 8 y Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="97449-108">Nested jobs were introduced in Windows 8 and Windows Server 2012.</span></span>

<span data-ttu-id="97449-109">En este tema se proporciona información general sobre el anidamiento de trabajos y el comportamiento de los trabajos anidados:</span><span class="sxs-lookup"><span data-stu-id="97449-109">This topic provides an overview of job nesting and behavior of nested jobs:</span></span>

-   [<span data-ttu-id="97449-110">Jerarquías de trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-110">Nested Job Hierarchies</span></span>](#nested-job-hierarchies)
-   [<span data-ttu-id="97449-111">Crear una jerarquía de trabajos anidada</span><span class="sxs-lookup"><span data-stu-id="97449-111">Creating a Nested Job Hierarchy</span></span>](#creating-a-nested-job-hierarchy)
-   [<span data-ttu-id="97449-112">Límites de trabajo y notificaciones para trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-112">Job Limits and Notifications for Nested Jobs</span></span>](#job-limits-and-notifications-for-nested-jobs)
-   [<span data-ttu-id="97449-113">Contabilidad de recursos para trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-113">Resource Accounting for Nested Jobs</span></span>](#resource-accounting-for-nested-jobs)
-   [<span data-ttu-id="97449-114">Finalización de trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-114">Termination of Nested Jobs</span></span>](#termination-of-nested-jobs)

<span data-ttu-id="97449-115">Para obtener información general sobre los trabajos y los objetos de trabajo, vea [objetos de trabajo](job-objects.md).</span><span class="sxs-lookup"><span data-stu-id="97449-115">For general information about jobs and job objects, see [Job Objects](job-objects.md).</span></span>

## <a name="nested-job-hierarchies"></a><span data-ttu-id="97449-116">Jerarquías de trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-116">Nested Job Hierarchies</span></span>

<span data-ttu-id="97449-117">Los trabajos anidados tienen una relación de elementos primarios y secundarios en la que cada trabajo secundario contiene un subconjunto de los procesos en su trabajo primario.</span><span class="sxs-lookup"><span data-stu-id="97449-117">Nested jobs have a parent-child relationship in which each child job contains a subset of the processes in its parent job.</span></span> <span data-ttu-id="97449-118">Si un proceso que ya se encuentra en un trabajo se agrega a otro trabajo, los trabajos se anidan de forma predeterminada si el sistema puede formar una jerarquía de trabajos válida y ninguno de los conjuntos de trabajos limita la interfaz de usuario ([**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) con **JobObjectBasicUIRestrictions**).</span><span class="sxs-lookup"><span data-stu-id="97449-118">If a process that is already in a job is added to another job, the jobs are nested by default if the system can form a valid job hierarchy and neither job sets UI limits ([**SetInformationJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) with **JobObjectBasicUIRestrictions**).</span></span>

<span data-ttu-id="97449-119">En la figura 1 se muestra una jerarquía de trabajos que contiene un árbol de procesos con la etiqueta P0 a través de P7.</span><span class="sxs-lookup"><span data-stu-id="97449-119">Figure 1 shows a job hierarchy that contains a tree of processes labeled P0 through P7.</span></span> <span data-ttu-id="97449-120">El trabajo 1 es el trabajo *primario* del trabajo 2 y el trabajo 4, y es un *antecesor* del trabajo 3.</span><span class="sxs-lookup"><span data-stu-id="97449-120">Job 1 is the *parent job* of Job 2 and Job 4, and it is an *ancestor* of Job 3.</span></span> <span data-ttu-id="97449-121">El trabajo 2 es el *elemento primario inmediato* del trabajo 3; El trabajo 3 es el *elemento secundario inmediato* del trabajo 2.</span><span class="sxs-lookup"><span data-stu-id="97449-121">Job 2 is the *immediate parent* of Job 3; Job 3 is the *immediate child* of Job 2.</span></span> <span data-ttu-id="97449-122">Los trabajos 1, 2 y 3 forman una *cadena de trabajos* en la que los trabajos 1 y 2 son la *cadena de trabajos primaria* del trabajo 3.</span><span class="sxs-lookup"><span data-stu-id="97449-122">Jobs 1, 2, and 3 form a *job chain* in which Jobs 1 and 2 are the *parent job chain* of Job 3.</span></span> <span data-ttu-id="97449-123">El trabajo final de una cadena de trabajos es el *trabajo inmediato* de los procesos de ese trabajo.</span><span class="sxs-lookup"><span data-stu-id="97449-123">The end job in a job chain is the *immediate job* of the processes in that job.</span></span> <span data-ttu-id="97449-124">En la figura 1, el trabajo 3 es el trabajo inmediato de los procesos P2, P3 y P4.</span><span class="sxs-lookup"><span data-stu-id="97449-124">In Figure 1, Job 3 is the immediate job of processes P2, P3, and P4.</span></span>

![Figura 1.](images/nested-jobs-a.png)

<span data-ttu-id="97449-127">Los trabajos anidados también se pueden usar para administrar grupos de procesos del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="97449-127">Nested jobs can also be used to manage groups of peer processes.</span></span> <span data-ttu-id="97449-128">En la jerarquía de trabajos que se muestra en la figura 2, el trabajo 1 es el trabajo primario del trabajo 2.</span><span class="sxs-lookup"><span data-stu-id="97449-128">In the job hierarchy shown in Figure 2, Job 1 is the parent job of Job 2.</span></span> <span data-ttu-id="97449-129">Tenga en cuenta que una jerarquía de trabajos podría contener solo parte de un árbol de procesos.</span><span class="sxs-lookup"><span data-stu-id="97449-129">Note that a job hierarchy might contain only part of a process tree.</span></span> <span data-ttu-id="97449-130">En la figura 2, P0 no se encuentra en la jerarquía de, pero sus procesos secundarios son.</span><span class="sxs-lookup"><span data-stu-id="97449-130">In Figure 2, P0 is not in the hierarchy, but its child processes P1 through P5 are.</span></span>

![Figura 2.](images/nested-jobs-b.png)

## <a name="creating-a-nested-job-hierarchy"></a><span data-ttu-id="97449-133">Crear una jerarquía de trabajos anidada</span><span class="sxs-lookup"><span data-stu-id="97449-133">Creating a Nested Job Hierarchy</span></span>

<span data-ttu-id="97449-134">Los procesos de una jerarquía de trabajos se asocian explícitamente a un objeto de trabajo mediante la función [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) o se asocian implícitamente durante la creación del proceso, igual que para los trabajos independientes.</span><span class="sxs-lookup"><span data-stu-id="97449-134">Processes in a job hierarchy are either explicitly associated with a job object using the [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) function or implicitly associated during process creation, same as for standalone jobs.</span></span> <span data-ttu-id="97449-135">El orden en que se crean los trabajos y los procesos se asignan determina si se puede crear una jerarquía.</span><span class="sxs-lookup"><span data-stu-id="97449-135">The order in which jobs are created and processes are assigned determines whether a hierarchy can be created.</span></span>

<span data-ttu-id="97449-136">Para compilar una jerarquía de trabajos mediante la asociación explícita, todos los objetos de trabajo se deben crear con [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta)y, a continuación, se debe llamar a [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) varias veces para que cada proceso asocie el proceso a cada trabajo al que debe pertenecer.</span><span class="sxs-lookup"><span data-stu-id="97449-136">To build a job hierarchy using explicit association, all job objects must be created using [**CreateJobObject**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta), then [**AssignProcessToJobObject**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) must be called multiple times for each process to associate the process with each job it should belong to.</span></span> <span data-ttu-id="97449-137">Para asegurarse de que la jerarquía de trabajos es válida, primero asigne todos los procesos al trabajo en la raíz de la jerarquía y, a continuación, asigne un subconjunto de procesos al objeto de trabajo secundario inmediato, y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="97449-137">To ensure that the job hierarchy is valid, first assign all processes to the job at the root of the hierarchy, then assign a subset of processes to the immediate child job object, and so on.</span></span> <span data-ttu-id="97449-138">Si los procesos se asignan a los trabajos en este orden, un trabajo secundario siempre tendrá un subconjunto de procesos en su trabajo primario mientras se crea la jerarquía, lo que es necesario para el anidamiento.</span><span class="sxs-lookup"><span data-stu-id="97449-138">If processes are assigned to jobs in this order, a child job will always have a subset of processes in its parent job while the hierarchy is being created, which is required for nesting.</span></span> <span data-ttu-id="97449-139">Si los procesos se asignan a los trabajos en orden aleatorio, en algún momento un trabajo secundario tendrá procesos que no están en su trabajo primario.</span><span class="sxs-lookup"><span data-stu-id="97449-139">If processes are assigned to jobs in random order, at some point a child job will have processes that are not in its parent job.</span></span> <span data-ttu-id="97449-140">Esto no se permite mediante el anidamiento y se producirá un error en **AssignProcessToJobObject** .</span><span class="sxs-lookup"><span data-stu-id="97449-140">This is not allowed by nesting and it will cause **AssignProcessToJobObject** to fail.</span></span>

<span data-ttu-id="97449-141">Cuando los procesos están asociados implícitamente a un trabajo durante la creación del proceso, un proceso secundario se asocia a cada trabajo de la cadena de trabajos de su proceso primario.</span><span class="sxs-lookup"><span data-stu-id="97449-141">When processes are implicitly associated with a job during process creation, a child process is associated with every job in the job chain of its parent process.</span></span> <span data-ttu-id="97449-142">Si el objeto de trabajo inmediato permite la separación, el proceso secundario se rompe del objeto de trabajo inmediato y de cada trabajo de la cadena de trabajo primaria, moviendo la jerarquía hasta que llega a un trabajo que no permite la separación.</span><span class="sxs-lookup"><span data-stu-id="97449-142">If the immediate job object allows breakaway, the child process breaks away from the immediate job object and from each job in the parent job chain, moving up the hierarchy until it reaches a job that does not permit breakaway.</span></span> <span data-ttu-id="97449-143">Si el objeto de trabajo inmediato no permite la separación, el proceso secundario no se interrumpe aunque los trabajos de su cadena de trabajo principal lo permitan.</span><span class="sxs-lookup"><span data-stu-id="97449-143">If the immediate job object does not allow breakaway, the child process does not break away even if jobs in its parent job chain allow it.</span></span>

## <a name="job-limits-and-notifications-for-nested-jobs"></a><span data-ttu-id="97449-144">Límites de trabajo y notificaciones para trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-144">Job Limits and Notifications for Nested Jobs</span></span>

<span data-ttu-id="97449-145">En el caso de ciertos límites de recursos, el límite establecido para los trabajos de una cadena de trabajo primaria determina el *límite efectivo* que se aplica a un trabajo secundario.</span><span class="sxs-lookup"><span data-stu-id="97449-145">For certain resource limits, the limit set for jobs in a parent job chain determine the *effective limit* that is enforced for a child job.</span></span> <span data-ttu-id="97449-146">El límite efectivo del trabajo secundario puede ser más restrictivo que el límite de su elemento primario, pero no puede ser menos restrictivo.</span><span class="sxs-lookup"><span data-stu-id="97449-146">The effective limit for child job can be more restrictive than the limit of its parent, but it cannot be less restrictive.</span></span> <span data-ttu-id="97449-147">Por ejemplo, si la clase de prioridad de un trabajo secundario está por encima de \_ la clase de prioridad normal \_ \_ y su clase de prioridad del trabajo principal es la clase de prioridad normal \_ \_ , el límite efectivo para los procesos en el trabajo secundario es \_ clase de prioridad normal \_ .</span><span class="sxs-lookup"><span data-stu-id="97449-147">For example, if a child job's priority class is ABOVE\_NORMAL\_PRIORITY\_CLASS and its parent job's priority class is NORMAL\_PRIORITY\_CLASS, the effective limit for processes in the child job is NORMAL\_PRIORITY\_CLASS.</span></span> <span data-ttu-id="97449-148">Sin embargo, si la clase de prioridad del trabajo secundario está por debajo de la \_ \_ clase de prioridad normal \_ , el límite efectivo para los procesos en el trabajo secundario está por debajo de la \_ clase de prioridad normal \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="97449-148">However, if the child job's priority class is BELOW\_NORMAL\_PRIORITY\_CLASS, the effective limit for processes in the child job is BELOW\_NORMAL\_PRIORITY\_CLASS.</span></span> <span data-ttu-id="97449-149">Los límites efectivos se aplican para la clase de prioridad, la afinidad, el cargo de confirmación, el límite de tiempo de ejecución por proceso, el límite de clase de programación y el espacio de trabajo mínimo y máximo.</span><span class="sxs-lookup"><span data-stu-id="97449-149">Effective limits are enforced for priority class, affinity, commit charge, per-process execution time limit, scheduling class limit, and working set minimum and maximum.</span></span> <span data-ttu-id="97449-150">Para obtener más información sobre los límites de recursos específicos, vea [ **SetInformationJobObject.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)</span><span class="sxs-lookup"><span data-stu-id="97449-150">For more information about specific resource limits, see [**SetInformationJobObject.**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject)</span></span>

<span data-ttu-id="97449-151">Cuando se producen determinados eventos, como la creación de un nuevo proceso o la infracción del límite de recursos, se envía un mensaje al puerto de finalización de e/s asociado a un trabajo.</span><span class="sxs-lookup"><span data-stu-id="97449-151">When certain events occur, such as new process creation or resource limit violation, a message is sent to the I/O completion port associated with a job.</span></span> <span data-ttu-id="97449-152">Un trabajo también puede registrarse para recibir notificaciones cuando se superan determinados límites.</span><span class="sxs-lookup"><span data-stu-id="97449-152">A job can also register to receive notifications when certain limits are exceeded.</span></span> <span data-ttu-id="97449-153">Para un trabajo no anidado, el mensaje se envía al puerto de finalización de e/s asociado al trabajo.</span><span class="sxs-lookup"><span data-stu-id="97449-153">For a non-nested job, the message is sent to the I/O completion port associated with the job.</span></span> <span data-ttu-id="97449-154">Para un trabajo anidado, el mensaje se envía a todos los puertos de finalización de e/s asociados a cualquier trabajo en la cadena de trabajos primaria del trabajo que desencadenó el mensaje.</span><span class="sxs-lookup"><span data-stu-id="97449-154">For a nested job, the message is sent to every I/O completion port associated with any job in the parent job chain of the job that triggered the message.</span></span> <span data-ttu-id="97449-155">No es necesario que un trabajo secundario tenga un puerto de finalización de e/s asociado para los mensajes que desencadena que se envíen a los puertos de finalización de e/s de los trabajos primarios situados más arriba en la cadena de trabajos.</span><span class="sxs-lookup"><span data-stu-id="97449-155">A child job does not need to have an associated I/O completion port for messages it triggers to be sent to the I/O completion ports of parent jobs higher in the job chain.</span></span> <span data-ttu-id="97449-156">Para obtener más información sobre mensajes específicos, vea [**JOBOBJECT \_ Associate \_ Complete \_ Port**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span><span class="sxs-lookup"><span data-stu-id="97449-156">For more information about specific messages, see [**JOBOBJECT\_ASSOCIATE\_COMPLETION\_PORT**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).</span></span>

## <a name="resource-accounting-for-nested-jobs"></a><span data-ttu-id="97449-157">Contabilidad de recursos para trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-157">Resource Accounting for Nested Jobs</span></span>

<span data-ttu-id="97449-158">La información de cuentas de recursos para un trabajo anidado describe el uso de cada proceso asociado a ese trabajo, incluidos los procesos de los trabajos secundarios.</span><span class="sxs-lookup"><span data-stu-id="97449-158">Resource accounting information for a nested job describes the usage of every process associated with that job, including processes in child jobs.</span></span> <span data-ttu-id="97449-159">Por lo tanto, cada trabajo de una cadena de trabajo representa los recursos agregados usados por sus propios procesos y los procesos de cada trabajo secundario por debajo de él en la cadena de trabajos.</span><span class="sxs-lookup"><span data-stu-id="97449-159">Each job in a job chain therefore represents the aggregated resources used by its own processes and the processes of every child job below it in the job chain.</span></span>

## <a name="termination-of-nested-jobs"></a><span data-ttu-id="97449-160">Finalización de trabajos anidados</span><span class="sxs-lookup"><span data-stu-id="97449-160">Termination of Nested Jobs</span></span>

<span data-ttu-id="97449-161">Cuando finaliza un trabajo en una jerarquía de trabajos, el sistema termina los procesos en ese trabajo y todos sus trabajos secundarios, empezando por el trabajo secundario en la parte inferior de la jerarquía.</span><span class="sxs-lookup"><span data-stu-id="97449-161">When a job in a job hierarchy is terminated, the system terminates processes in that job and all of its child jobs, starting with the child job at the bottom of the hierarchy.</span></span> <span data-ttu-id="97449-162">Los recursos pendientes utilizados por cada proceso terminado se cobran al trabajo primario.</span><span class="sxs-lookup"><span data-stu-id="97449-162">Outstanding resources used by each terminated process are charged to the parent job.</span></span>

<span data-ttu-id="97449-163">El identificador de trabajo debe tener el \_ objeto de trabajo \_ terminar el acceso a la derecha, igual que para los trabajos independientes.</span><span class="sxs-lookup"><span data-stu-id="97449-163">The job handle must have the JOB\_OBJECT\_TERMINATE access right, same as for standalone jobs.</span></span>

 

 
