---
description: La memoria que pertenece a un proceso está protegida implícitamente por su espacio de direcciones virtuales privado.
ms.assetid: 70ded07a-7be6-4189-a1ae-281917f42a1e
title: Protección de la memoria
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd30df8084c91a62c28414f4a8142397ee777e52
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104156881"
---
# <a name="memory-protection"></a><span data-ttu-id="5a6a1-103">Protección de la memoria</span><span class="sxs-lookup"><span data-stu-id="5a6a1-103">Memory Protection</span></span>

<span data-ttu-id="5a6a1-104">La memoria que pertenece a un proceso está protegida implícitamente por su espacio de direcciones virtuales privado.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-104">Memory that belongs to a process is implicitly protected by its private virtual address space.</span></span> <span data-ttu-id="5a6a1-105">Además, Windows proporciona protección de memoria mediante el uso del hardware de memoria virtual.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-105">In addition, Windows provides memory protection by using the virtual memory hardware.</span></span> <span data-ttu-id="5a6a1-106">La implementación de esta protección varía en función del procesador; por ejemplo, las páginas de códigos del espacio de direcciones de un proceso pueden marcarse como de solo lectura y protegerse contra modificaciones realizadas por subprocesos en modo usuario.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-106">The implementation of this protection varies with the processor, for example, code pages in the address space of a process can be marked read-only and protected from modification by user-mode threads.</span></span>

<span data-ttu-id="5a6a1-107">Para obtener una lista completa de los atributos, vea [constantes de protección de memoria](memory-protection-constants.md).</span><span class="sxs-lookup"><span data-stu-id="5a6a1-107">For the complete list of attributes, see [Memory Protection Constants](memory-protection-constants.md).</span></span>

## <a name="copy-on-write-protection"></a><span data-ttu-id="5a6a1-108">Protección de copia en escritura</span><span class="sxs-lookup"><span data-stu-id="5a6a1-108">Copy-on-Write Protection</span></span>

<span data-ttu-id="5a6a1-109">La protección de copia en escritura es una optimización que permite que varios procesos asignen sus espacios de direcciones virtuales para que compartan una página física hasta que uno de los procesos modifique la página.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-109">Copy-on-write protection is an optimization that allows multiple processes to map their virtual address spaces such that they share a physical page until one of the processes modifies the page.</span></span> <span data-ttu-id="5a6a1-110">Esto forma parte de una técnica denominada *evaluación diferida*, que permite que el sistema Ahorre memoria física y tiempo al no realizar una operación hasta que sea absolutamente necesario.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-110">This is part of a technique called *lazy evaluation*, which allows the system to conserve physical memory and time by not performing an operation until absolutely necessary.</span></span>

<span data-ttu-id="5a6a1-111">Por ejemplo, suponga que dos procesos cargan páginas del mismo archivo DLL en sus espacios de memoria virtual.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-111">For example, suppose two processes load pages from the same DLL into their virtual memory spaces.</span></span> <span data-ttu-id="5a6a1-112">Estas páginas de memoria virtual se asignan a las mismas páginas de memoria física para ambos procesos.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-112">These virtual memory pages are mapped to the same physical memory pages for both processes.</span></span> <span data-ttu-id="5a6a1-113">Siempre y cuando ninguno de los procesos escriba en estas páginas, se pueden asignar y compartir, las mismas páginas físicas, como se muestra en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-113">As long as neither process writes to these pages, they can map to and share, the same physical pages, as shown in the following diagram.</span></span>

![cuadros y flechas del proceso 1 y 2 páginas asignadas a la misma memoria física](images/mem1.png)

<span data-ttu-id="5a6a1-115">Si el proceso 1 escribe en una de estas páginas, el contenido de la página física se copia en otra página física y el mapa de memoria virtual se actualiza para el proceso 1.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-115">If Process 1 writes to one of these pages, the contents of the physical page are copied to another physical page and the virtual memory map is updated for Process 1.</span></span> <span data-ttu-id="5a6a1-116">Ambos procesos tienen ahora su propia instancia de la página en la memoria física.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-116">Both processes now have their own instance of the page in physical memory.</span></span> <span data-ttu-id="5a6a1-117">Por lo tanto, no es posible que un proceso escriba en una página física compartida y que el otro proceso vea los cambios.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-117">Therefore, it is not possible for one process to write to a shared physical page and for the other process to see the changes.</span></span>

![cuadros y flechas de procesos y reasignación de memoria física](images/mem2.png)

## <a name="loading-applications-and-dlls"></a><span data-ttu-id="5a6a1-119">Cargar aplicaciones y archivos dll</span><span class="sxs-lookup"><span data-stu-id="5a6a1-119">Loading Applications and DLLs</span></span>

<span data-ttu-id="5a6a1-120">Cuando se cargan varias instancias de la misma aplicación basada en Windows, cada instancia se ejecuta en su propio espacio de direcciones virtuales protegido.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-120">When multiple instances of the same Windows-based application are loaded, each instance is run in its own protected virtual address space.</span></span> <span data-ttu-id="5a6a1-121">Sin embargo, sus identificadores de instancia (*hInstance*) suelen tener el mismo valor.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-121">However, their instance handles (*hInstance*) typically have the same value.</span></span> <span data-ttu-id="5a6a1-122">Este valor representa la dirección base de la aplicación en su espacio de direcciones virtuales.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-122">This value represents the base address of the application in its virtual address space.</span></span> <span data-ttu-id="5a6a1-123">Si cada instancia se puede cargar en su dirección base predeterminada, puede asignar y compartir las mismas páginas físicas con las demás instancias, mediante la protección de copia en escritura.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-123">If each instance can be loaded into its default base address, it can map to and share the same physical pages with the other instances, using copy-on-write protection.</span></span> <span data-ttu-id="5a6a1-124">El sistema permite que estas instancias compartan las mismas páginas físicas hasta que una de ellas modifica una página.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-124">The system allows these instances to share the same physical pages until one of them modifies a page.</span></span> <span data-ttu-id="5a6a1-125">Si por alguna razón no se puede cargar una de estas instancias en la dirección base deseada, recibirá sus propias páginas físicas.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-125">If for some reason one of these instances cannot be loaded in the desired base address, it receives its own physical pages.</span></span>

<span data-ttu-id="5a6a1-126">Los archivos DLL se crean con una dirección base predeterminada.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-126">DLLs are created with a default base address.</span></span> <span data-ttu-id="5a6a1-127">Cada proceso que usa un archivo DLL intentará cargar el archivo DLL en su propio espacio de direcciones en la dirección virtual predeterminada del archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-127">Every process that uses a DLL will try to load the DLL within its own address space at the default virtual address for the DLL.</span></span> <span data-ttu-id="5a6a1-128">Si varias aplicaciones pueden cargar un archivo DLL en su dirección virtual predeterminada, pueden compartir las mismas páginas físicas para el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-128">If multiple applications can load a DLL at its default virtual address, they can share the same physical pages for the DLL.</span></span> <span data-ttu-id="5a6a1-129">Si por algún motivo un proceso no puede cargar el archivo DLL en la dirección predeterminada, carga el archivo DLL en otro lugar.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-129">If for some reason a process cannot load the DLL at the default address, it loads the DLL elsewhere.</span></span> <span data-ttu-id="5a6a1-130">La protección de copia en escritura obliga a que algunas de las páginas del archivo DLL se copien en páginas físicas diferentes para este proceso, ya que las correcciones para instrucciones de salto se escriben en las páginas del archivo DLL y serán diferentes para este proceso.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-130">Copy-on-write protection forces some of the DLL's pages to be copied into different physical pages for this process, because the fixes for jump instructions are written within the DLL's pages, and they will be different for this process.</span></span> <span data-ttu-id="5a6a1-131">Si la sección de código contiene muchas referencias a la sección de datos, esto puede hacer que se copie toda la sección de código en nuevas páginas físicas.</span><span class="sxs-lookup"><span data-stu-id="5a6a1-131">If the code section contains many references to the data section, this can cause the entire code section to be copied to new physical pages.</span></span>

 

 



