---
title: Realización de una llamada asincrónica
description: El procedimiento para realizar una llamada sincrónica es sencillo el cliente obtiene un puntero de interfaz en el objeto de servidor y llama a los métodos a través de ese puntero. La llamada asincrónica implica un objeto de llamada, por lo que incluye algunos pasos más.
ms.assetid: ab65d38d-836a-48d4-87c1-8812cbc8ff92
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22dcd7a6509cd07e12357a96222baa04f9e4c942
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/21/2020
ms.locfileid: "104421480"
---
# <a name="making-an-asynchronous-call"></a><span data-ttu-id="7cba7-104">Realización de una llamada asincrónica</span><span class="sxs-lookup"><span data-stu-id="7cba7-104">Making an Asynchronous Call</span></span>

<span data-ttu-id="7cba7-105">El procedimiento para realizar una llamada sincrónica es sencillo: el cliente obtiene un puntero de interfaz en el objeto de servidor y llama a los métodos a través de ese puntero.</span><span class="sxs-lookup"><span data-stu-id="7cba7-105">The procedure for making a synchronous call is straightforward: The client obtains an interface pointer on the server object and calls methods through that pointer.</span></span> <span data-ttu-id="7cba7-106">La llamada asincrónica implica un objeto de llamada, por lo que incluye algunos pasos más.</span><span class="sxs-lookup"><span data-stu-id="7cba7-106">Asynchronous calling involves a call object, so it involves a few more steps.</span></span>

<span data-ttu-id="7cba7-107">Para cada método en una interfaz sincrónica, la interfaz asincrónica correspondiente implementa dos métodos.</span><span class="sxs-lookup"><span data-stu-id="7cba7-107">For each method on a synchronous interface, the corresponding asynchronous interface implements two methods.</span></span> <span data-ttu-id="7cba7-108">Estos métodos adjuntan los prefijos Begin \_ y Finish \_ al nombre del método sincrónico.</span><span class="sxs-lookup"><span data-stu-id="7cba7-108">These methods attach the prefixes Begin\_ and Finish\_ to the name of the synchronous method.</span></span> <span data-ttu-id="7cba7-109">Por ejemplo, si una interfaz denominada ISimpleStream tiene un método de lectura, la interfaz AsyncISimpleStream tendrá un método de lectura Begin \_ y de finalización \_ .</span><span class="sxs-lookup"><span data-stu-id="7cba7-109">For example, if an interface named ISimpleStream has a Read method, the AsyncISimpleStream interface will have a Begin\_Read and a Finish\_Read method.</span></span> <span data-ttu-id="7cba7-110">Para comenzar una llamada asincrónica, el cliente llama al método Begin \_ .</span><span class="sxs-lookup"><span data-stu-id="7cba7-110">To begin an asynchronous call, the client calls the Begin\_ method.</span></span>

<span data-ttu-id="7cba7-111">**Para comenzar una llamada asincrónica**</span><span class="sxs-lookup"><span data-stu-id="7cba7-111">**To begin an asynchronous call**</span></span>

1.  <span data-ttu-id="7cba7-112">Consulte el objeto de servidor para la interfaz [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) .</span><span class="sxs-lookup"><span data-stu-id="7cba7-112">Query the server object for the [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) interface.</span></span> <span data-ttu-id="7cba7-113">Si [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) devuelve E \_ nointerface, el objeto de servidor no admite la llamada asincrónica.</span><span class="sxs-lookup"><span data-stu-id="7cba7-113">If [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) returns E\_NOINTERFACE, the server object does not support asynchronous calling.</span></span>

2.  <span data-ttu-id="7cba7-114">Llame a [**ICallFactory:: CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) para crear un objeto de llamada correspondiente a la interfaz que desee y, a continuación, libere el puntero a [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span><span class="sxs-lookup"><span data-stu-id="7cba7-114">Call [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) to create a call object corresponding to the interface you want, and then release the pointer to [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span></span>

3.  <span data-ttu-id="7cba7-115">Si no solicitó un puntero a la interfaz asincrónica desde la llamada a [**CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), consulte el objeto de llamada de la interfaz asincrónica.</span><span class="sxs-lookup"><span data-stu-id="7cba7-115">If you did not request a pointer to the asynchronous interface from the call to [**CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), query the call object for the asynchronous interface.</span></span>

4.  <span data-ttu-id="7cba7-116">Llame al método Begin adecuado \_ .</span><span class="sxs-lookup"><span data-stu-id="7cba7-116">Call the appropriate Begin\_ method.</span></span>

<span data-ttu-id="7cba7-117">El objeto de servidor está procesando la llamada asincrónica y el cliente es libre de realizar otro trabajo hasta que necesita los resultados de la llamada.</span><span class="sxs-lookup"><span data-stu-id="7cba7-117">The server object is now processing the asynchronous call, and the client is free to do other work until it needs the results of the call.</span></span>

<span data-ttu-id="7cba7-118">Un objeto Call solo puede procesar una llamada asincrónica a la vez.</span><span class="sxs-lookup"><span data-stu-id="7cba7-118">A call object can process only one asynchronous call at a time.</span></span> <span data-ttu-id="7cba7-119">Si el mismo cliente de o un segundo llama a un \_ método Begin antes de que finalice una llamada asincrónica pendiente, el \_ método Begin devolverá una \_ llamada RPC E \_ \_ pendiente.</span><span class="sxs-lookup"><span data-stu-id="7cba7-119">If the same or a second client calls a Begin\_ method before a pending asynchronous call is finished, the Begin\_ method will return RPC\_E\_CALL\_PENDING.</span></span>

<span data-ttu-id="7cba7-120">Si el cliente no necesita los resultados del \_ método Begin, puede liberar el objeto de llamada al final de este procedimiento.</span><span class="sxs-lookup"><span data-stu-id="7cba7-120">If the client does not need the results of the Begin\_ method, it can release the call object at the end of this procedure.</span></span> <span data-ttu-id="7cba7-121">COM detecta esta condición y limpia la llamada.</span><span class="sxs-lookup"><span data-stu-id="7cba7-121">COM detects this condition and cleans up the call.</span></span> <span data-ttu-id="7cba7-122">\_No se llama al método de finalización y el cliente no obtiene ningún parámetro de salida o valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="7cba7-122">The Finish\_ method is not called, and the client does not get any out parameters or a return value.</span></span>

<span data-ttu-id="7cba7-123">Cuando el objeto de servidor está listo para devolver el \_ método Begin, indica al objeto de llamada que se ha hecho.</span><span class="sxs-lookup"><span data-stu-id="7cba7-123">When the server object is ready to return from the Begin\_ method, it signals the call object that it is done.</span></span> <span data-ttu-id="7cba7-124">Cuando el cliente está listo, comprueba si se ha señalado el objeto de llamada.</span><span class="sxs-lookup"><span data-stu-id="7cba7-124">When the client is ready, it checks to see whether the call object has been signaled.</span></span> <span data-ttu-id="7cba7-125">Si es así, el cliente puede completar la llamada asincrónica.</span><span class="sxs-lookup"><span data-stu-id="7cba7-125">If so, the client can complete the asynchronous call.</span></span>

<span data-ttu-id="7cba7-126">El mecanismo para esta señalización y comprobación entre el cliente y el servidor es la interfaz [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) en el objeto de llamada.</span><span class="sxs-lookup"><span data-stu-id="7cba7-126">The mechanism for this signaling and checking between client and server is the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface on the call object.</span></span> <span data-ttu-id="7cba7-127">Normalmente, el objeto de llamada implementa esta interfaz mediante la agregación de un objeto de sincronización proporcionado por el sistema.</span><span class="sxs-lookup"><span data-stu-id="7cba7-127">The call object normally implements this interface by aggregating a system-supplied synchronization object.</span></span> <span data-ttu-id="7cba7-128">El objeto de sincronización ajusta un identificador de evento, que el servidor señala justo antes de volver del \_ método Begin llamando a [**ISynchronize:: Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span><span class="sxs-lookup"><span data-stu-id="7cba7-128">The synchronization object wraps an event handle, which the server signals just before returning from the Begin\_ method by calling [**ISynchronize::Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span></span>

<span data-ttu-id="7cba7-129">**Para completar una llamada asincrónica**</span><span class="sxs-lookup"><span data-stu-id="7cba7-129">**To complete an asynchronous call**</span></span>

1.  <span data-ttu-id="7cba7-130">Consulte el objeto de llamada para la interfaz [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) .</span><span class="sxs-lookup"><span data-stu-id="7cba7-130">Query the call object for the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface.</span></span>

2.  <span data-ttu-id="7cba7-131">Llame a [**ISynchronize:: wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span><span class="sxs-lookup"><span data-stu-id="7cba7-131">Call [**ISynchronize::Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span></span>

3.  <span data-ttu-id="7cba7-132">Si [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) devuelve \_ el tiempo de espera de RPC E \_ , el \_ método Begin no finaliza el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="7cba7-132">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns RPC\_E\_TIMEOUT, the Begin\_ method is not finished processing.</span></span> <span data-ttu-id="7cba7-133">El cliente puede continuar con otro trabajo y llamar a **Wait** de nuevo más tarde.</span><span class="sxs-lookup"><span data-stu-id="7cba7-133">The client can continue with other work and call **Wait** again later.</span></span> <span data-ttu-id="7cba7-134">No se puede llamar al método de finalización \_ hasta que **Wait** devuelve S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="7cba7-134">It cannot call the Finish\_ method until **Wait** returns S\_OK.</span></span>

    <span data-ttu-id="7cba7-135">Si [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) devuelve S \_ OK, el \_ método Begin ha devuelto.</span><span class="sxs-lookup"><span data-stu-id="7cba7-135">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns S\_OK, the Begin\_ method has returned.</span></span> <span data-ttu-id="7cba7-136">Llame al método Finish adecuado \_ .</span><span class="sxs-lookup"><span data-stu-id="7cba7-136">Call the appropriate Finish\_ method.</span></span>

<span data-ttu-id="7cba7-137">El \_ método Finish pasa al cliente los parámetros out.</span><span class="sxs-lookup"><span data-stu-id="7cba7-137">The Finish\_ method passes the client any out parameters.</span></span> <span data-ttu-id="7cba7-138">El comportamiento de los métodos asincrónicos, incluido el valor devuelto del \_ método Finish, debe coincidir exactamente con el del método sincrónico correspondiente.</span><span class="sxs-lookup"><span data-stu-id="7cba7-138">The behavior of the asynchronous methods, including the return value of the Finish\_ method, should match exactly that of the corresponding synchronous method.</span></span>

<span data-ttu-id="7cba7-139">El cliente puede liberar el objeto de llamada en cuanto se devuelve el método de finalización \_ , o puede contener un puntero al objeto de llamada para realizar llamadas adicionales.</span><span class="sxs-lookup"><span data-stu-id="7cba7-139">The client can release the call object as soon as the Finish\_ method returns, or it can hold a pointer to the call object to make additional calls.</span></span> <span data-ttu-id="7cba7-140">En cualquier caso, el cliente es responsable de liberar el objeto de llamada cuando el objeto ya no se necesita.</span><span class="sxs-lookup"><span data-stu-id="7cba7-140">In either case, the client is responsible for releasing the call object when the object is no longer needed.</span></span>

<span data-ttu-id="7cba7-141">Si llama a un método de finalización \_ cuando no hay ninguna llamada en curso, el método devolverá una \_ llamada RPC E \_ \_ completada.</span><span class="sxs-lookup"><span data-stu-id="7cba7-141">If you call a Finish\_ method when no call is in progress, the method will return RPC\_E\_CALL\_COMPLETE.</span></span>

> [!Note]  
> <span data-ttu-id="7cba7-142">Si los objetos de cliente y de servidor están en el mismo apartamento, no se garantiza que las llamadas a [**ICallFactory:: CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) se realicen correctamente.</span><span class="sxs-lookup"><span data-stu-id="7cba7-142">If the client and server objects are in the same apartment, calls to [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) are not guaranteed to succeed.</span></span> <span data-ttu-id="7cba7-143">Si el objeto de servidor no admite la llamada asincrónica en una interfaz determinada, se producirá un error al intentar crear un objeto de llamada y el cliente debe utilizar la interfaz sincrónica.</span><span class="sxs-lookup"><span data-stu-id="7cba7-143">If the server object does not support asynchronous calling on a particular interface, the attempt to create a call object will fail and the client must use the synchronous interface.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="7cba7-144">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="7cba7-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7cba7-145">Cancelar una llamada asincrónica</span><span class="sxs-lookup"><span data-stu-id="7cba7-145">Canceling an Asynchronous Call</span></span>](canceling-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="7cba7-146">Seguridad del cliente durante una llamada asincrónica</span><span class="sxs-lookup"><span data-stu-id="7cba7-146">Client Security During an Asynchronous Call</span></span>](client-security-during-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="7cba7-147">Suplantación y llamadas asincrónicas</span><span class="sxs-lookup"><span data-stu-id="7cba7-147">Impersonation and Asynchronous Calls</span></span>](impersonation-and-asynchronous-calls.md)
</dt> </dl>

 

 