---
description: Windows almacena en caché los datos de archivos que se leen de los discos y se escriben en los discos.
ms.assetid: 0865c741-63e3-4246-ba69-801b02153e4a
title: Almacenamiento en caché de archivos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a14fb668af16cfb8a4e42b59b25b73ecefbb7cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "103912866"
---
# <a name="file-caching"></a><span data-ttu-id="cd0a6-103">Almacenamiento en caché de archivos</span><span class="sxs-lookup"><span data-stu-id="cd0a6-103">File Caching</span></span>

<span data-ttu-id="cd0a6-104">De forma predeterminada, Windows almacena en caché los datos de archivo que se leen de discos y se escriben en discos.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-104">By default, Windows caches file data that is read from disks and written to disks.</span></span> <span data-ttu-id="cd0a6-105">Esto implica que las operaciones de lectura leen los datos de archivo de un área de la memoria del sistema conocida como caché de archivos del sistema, en lugar de desde el disco físico.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-105">This implies that read operations read file data from an area in system memory known as the system file cache, rather than from the physical disk.</span></span> <span data-ttu-id="cd0a6-106">En consecuencia, las operaciones de escritura escriben datos de archivo en la memoria caché de archivos, en lugar de en el disco. Este tipo de caché se conoce como caché de reescritura.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-106">Correspondingly, write operations write file data to the system file cache rather than to the disk, and this type of cache is referred to as a write-back cache.</span></span> <span data-ttu-id="cd0a6-107">El almacenamiento en caché se administra por objeto de archivo.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-107">Caching is managed per file object.</span></span>

<span data-ttu-id="cd0a6-108">El almacenamiento en caché se produce bajo la dirección del *Administrador de caché*, que funciona continuamente mientras se ejecuta Windows.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-108">Caching occurs under the direction of the *cache manager*, which operates continuously while Windows is running.</span></span> <span data-ttu-id="cd0a6-109">Los datos de archivo de la memoria caché de archivos del sistema se escriben en el disco a intervalos determinados por el sistema operativo y se libera la memoria usada previamente por los datos de archivo, lo que se conoce como *vaciar* la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-109">File data in the system file cache is written to the disk at intervals determined by the operating system, and the memory previously used by that file data is freed—this is referred to as *flushing* the cache.</span></span> <span data-ttu-id="cd0a6-110">La Directiva de retrasar la escritura de los datos en el archivo y mantenerlo en la memoria caché hasta que se vacíe la memoria caché se denomina escritura diferida y se desencadena mediante el administrador de caché en un intervalo de tiempo de desterminación.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-110">The policy of delaying the writing of the data to the file and holding it in the cache until the cache is flushed is called lazy writing, and it is triggered by the cache manager at a determinate time interval.</span></span> <span data-ttu-id="cd0a6-111">La hora a la que se vacía un bloque de datos de archivo se basa, parcialmente, en la cantidad de tiempo que ha estado almacenado en la memoria caché y la cantidad de tiempo desde la última vez que se accedió a los datos en una operación de lectura.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-111">The time at which a block of file data is flushed is partially based on the amount of time it has been stored in the cache and the amount of time since the data was last accessed in a read operation.</span></span> <span data-ttu-id="cd0a6-112">Esto garantiza que los datos de archivo que se suelen leer con frecuencia seguirán accesibles en la caché de archivos del sistema durante la cantidad máxima de tiempo.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-112">This ensures that file data that is frequently read will stay accessible in the system file cache for the maximum amount of time.</span></span>

<span data-ttu-id="cd0a6-113">Este proceso de almacenamiento en caché de datos de archivo se muestra en la ilustración siguiente.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-113">This file data caching process is illustrated in the following figure.</span></span>

![proceso de almacenamiento en caché de datos de archivos](images/fig3.png)

<span data-ttu-id="cd0a6-115">Como se muestra en las flechas sólidas de la ilustración anterior, una región de datos de 256 KB se lee en una memoria caché de 256 KB en el espacio de direcciones del sistema cuando lo solicita primero el administrador de caché durante una operación de lectura de archivo.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-115">As depicted by the solid arrows in the previous figure, a 256 KB region of data is read into a 256 KB cache "slot" in system address space when it is first requested by the cache manager during a file read operation.</span></span> <span data-ttu-id="cd0a6-116">A continuación, un proceso en modo de usuario copia los datos de esta ranura en su propio espacio de direcciones.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-116">A user-mode process then copies the data in this slot to its own address space.</span></span> <span data-ttu-id="cd0a6-117">Cuando el proceso ha finalizado su acceso a los datos, escribe los datos modificados en la misma ranura de la memoria caché del sistema, como se muestra mediante la flecha de puntos entre el espacio de direcciones del proceso y la memoria caché del sistema.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-117">When the process has completed its data access, it writes the altered data back to the same slot in the system cache, as shown by the dotted arrow between the process address space and the system cache.</span></span> <span data-ttu-id="cd0a6-118">Cuando el administrador de caché ha determinado que los datos ya no serán necesarios durante un período de tiempo determinado, vuelve a escribir los datos modificados en el archivo en el disco, tal como se muestra en la flecha de puntos entre la caché del sistema y el disco.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-118">When the cache manager has determined that the data will no longer be needed for a certain amount of time, it writes the altered data back to the file on the disk, as shown by the dotted arrow between the system cache and the disk.</span></span>

<span data-ttu-id="cd0a6-119">La cantidad de mejoras de rendimiento de e/s que ofrece el almacenamiento en caché de datos de archivos depende del tamaño del bloque de datos de archivo que se lee o se escribe.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-119">The amount of I/O performance improvement that file data caching offers depends on the size of the file data block being read or written.</span></span> <span data-ttu-id="cd0a6-120">Cuando se leen y escriben bloques grandes de datos de archivos, es más probable que se necesiten lecturas y escrituras en el disco para finalizar la operación de e/s.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-120">When large blocks of file data are read and written, it is more likely that disk reads and writes will be necessary to finish the I/O operation.</span></span> <span data-ttu-id="cd0a6-121">El rendimiento de e/s se verá cada vez mayor, ya que se produce más de este tipo de operación de e/s.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-121">I/O performance will be increasingly impaired as more of this kind of I/O operation occurs.</span></span>

<span data-ttu-id="cd0a6-122">En estas situaciones, se puede desactivar el almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-122">In these situations, caching can be turned off.</span></span> <span data-ttu-id="cd0a6-123">Esto se hace en el momento en que se abre el archivo pasando el **indicador de archivo \_ \_ sin \_ almacenamiento en búfer** como un valor para el parámetro *dwFlagsAndAttributes* de [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="cd0a6-123">This is done at the time the file is opened by passing **FILE\_FLAG\_NO\_BUFFERING** as a value for the *dwFlagsAndAttributes* parameter of [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="cd0a6-124">Cuando el almacenamiento en caché está deshabilitado, todas las operaciones de lectura y escritura acceden directamente al disco físico.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-124">When caching is disabled, all read and write operations directly access the physical disk.</span></span> <span data-ttu-id="cd0a6-125">Sin embargo, los metadatos del archivo se pueden almacenar en caché.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-125">However, the file metadata may still be cached.</span></span> <span data-ttu-id="cd0a6-126">Para vaciar los metadatos en el disco, use la función [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="cd0a6-126">To flush the metadata to disk, use the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="cd0a6-127">La frecuencia con la que se produce el vaciado es una consideración importante que equilibra el rendimiento del sistema con la confiabilidad del sistema.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-127">The frequency at which flushing occurs is an important consideration that balances system performance with system reliability.</span></span> <span data-ttu-id="cd0a6-128">Si el sistema vacía la caché con demasiada frecuencia, el número de operaciones de escritura de gran tamaño que se incurren en el vaciado reducirá significativamente el rendimiento del sistema.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-128">If the system flushes the cache too often, the number of large write operations flushing incurs will degrade system performance significantly.</span></span> <span data-ttu-id="cd0a6-129">Si el sistema no se vacía con la frecuencia suficiente, la probabilidad es mayor que la memoria del sistema se agotará en la caché, o bien se producirá un error repentino del sistema (por ejemplo, una pérdida de energía en el equipo) antes del vaciado.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-129">If the system is not flushed often enough, then the likelihood is greater that either system memory will be depleted by the cache, or a sudden system failure (such as a loss of power to the computer) will happen before the flush.</span></span> <span data-ttu-id="cd0a6-130">En la última instancia, se perderán los datos almacenados en caché.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-130">In the latter instance, the cached data will be lost.</span></span>

<span data-ttu-id="cd0a6-131">Para asegurarse de que se produce la cantidad correcta de vaciado, el administrador de caché genera un proceso cada segundo llamado escritor diferido.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-131">To ensure that the right amount of flushing occurs, the cache manager spawns a process every second called a lazy writer.</span></span> <span data-ttu-id="cd0a6-132">El proceso de escritura diferida pone en cola una octava parte de las páginas que no se han vaciado recientemente para que se escriban en el disco.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-132">The lazy writer process queues one-eighth of the pages that have not been flushed recently to be written to disk.</span></span> <span data-ttu-id="cd0a6-133">Vuelve a evaluar constantemente la cantidad de datos que se vacían para obtener un rendimiento óptimo del sistema y, si es necesario escribir más datos, pone en cola más datos.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-133">It constantly reevaluates the amount of data being flushed for optimal system performance, and if more data needs to be written it queues more data.</span></span> <span data-ttu-id="cd0a6-134">Los escritores diferidos no vacían los archivos temporales, ya que se supone que se eliminarán por la aplicación o el sistema.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-134">Lazy writers do not flush temporary files, because the assumption is that they will be deleted by the application or system.</span></span>

<span data-ttu-id="cd0a6-135">Algunas aplicaciones, como software de comprobación de virus, requieren que las operaciones de escritura se vacíen en el disco inmediatamente; Windows proporciona esta capacidad a través del almacenamiento en caché de escritura a través.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-135">Some applications, such as virus-checking software, require that their write operations be flushed to disk immediately; Windows provides this ability through write-through caching.</span></span> <span data-ttu-id="cd0a6-136">Un proceso permite el almacenamiento en caché de escritura a través de una operación de e/s específica pasando el indicador de escritura de la **marca de archivo \_ \_ \_ a través** de la marca en la llamada a [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="cd0a6-136">A process enables write-through caching for a specific I/O operation by passing the **FILE\_FLAG\_WRITE\_THROUGH** flag into its call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="cd0a6-137">Con el almacenamiento en caché de escritura a través habilitado, los datos se siguen escribiendo en la memoria caché, pero el administrador de caché escribe los datos inmediatamente en el disco en lugar de incurrir en un retraso mediante el uso de la escritura diferida.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-137">With write-through caching enabled, data is still written into the cache, but the cache manager writes the data immediately to disk rather than incurring a delay by using the lazy writer.</span></span> <span data-ttu-id="cd0a6-138">Un proceso también puede forzar un vaciado de un archivo que se ha abierto mediante una llamada a la función [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="cd0a6-138">A process can also force a flush of a file it has opened by calling the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="cd0a6-139">Los metadatos del sistema de archivos siempre se almacenan en caché.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-139">File system metadata is always cached.</span></span> <span data-ttu-id="cd0a6-140">Por lo tanto, para almacenar los cambios de metadatos en el disco, el archivo se debe vaciar o abrir con **escritura de marcador de archivo \_ \_ \_ a través** de.</span><span class="sxs-lookup"><span data-stu-id="cd0a6-140">Therefore, to store any metadata changes to disk, the file must either be flushed or be opened with **FILE\_FLAG\_WRITE\_THROUGH**.</span></span>

 

 



