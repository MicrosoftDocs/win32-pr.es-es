---
description: Uso de la plantilla de clase DMO
ms.assetid: 5193ad08-aaee-47e3-93eb-a126a66d8f23
title: Uso de la plantilla de clase DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db80017372f11f6c928e0e6a83b591967a84ee7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104082951"
---
# <a name="using-the-dmo-class-template"></a><span data-ttu-id="0b23e-103">Uso de la plantilla de clase DMO</span><span class="sxs-lookup"><span data-stu-id="0b23e-103">Using the DMO Class Template</span></span>

<span data-ttu-id="0b23e-104">DirectShow incluye una plantilla de clase, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), para implementar DMOs.</span><span class="sxs-lookup"><span data-stu-id="0b23e-104">DirectShow includes a class template, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), for implementing DMOs.</span></span> <span data-ttu-id="0b23e-105">La plantilla controla muchas de las tareas de "contabilidad", como la validación de parámetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-105">The template handles many of the "bookkeeping" tasks, such as validating input parameters.</span></span> <span data-ttu-id="0b23e-106">Mediante el uso de la plantilla, puede centrarse en la funcionalidad específica de DMO.</span><span class="sxs-lookup"><span data-stu-id="0b23e-106">By using the template, you can focus on the functionality that is specific to your DMO.</span></span> <span data-ttu-id="0b23e-107">Además, la plantilla ayuda a asegurarse de que se crea una implementación sólida.</span><span class="sxs-lookup"><span data-stu-id="0b23e-107">In addition, the template helps to ensure that you create a robust implementation.</span></span> <span data-ttu-id="0b23e-108">La plantilla se define en el archivo de encabezado Dmoimpl. h, que se encuentra en el directorio de inclusión del SDK.</span><span class="sxs-lookup"><span data-stu-id="0b23e-108">The template is defined in the header file Dmoimpl.h, located in the Include directory of the SDK.</span></span>

<span data-ttu-id="0b23e-109">La plantilla **IMediaObjectImpl** hereda la interfaz [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) .</span><span class="sxs-lookup"><span data-stu-id="0b23e-109">The **IMediaObjectImpl** template inherits the [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) interface.</span></span> <span data-ttu-id="0b23e-110">Para crear un DMO mediante la plantilla, defina una nueva clase que derive de **IMediaObjectImpl**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-110">To create a DMO using the template, define a new class that derives from **IMediaObjectImpl**.</span></span> <span data-ttu-id="0b23e-111">La plantilla implementa todos los métodos **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="0b23e-111">The template implements all of the **IMediaObject** methods.</span></span> <span data-ttu-id="0b23e-112">En la mayoría de los casos, la plantilla llama a un método privado correspondiente en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-112">In most cases, the template calls a corresponding private method on the derived class.</span></span> <span data-ttu-id="0b23e-113">La plantilla proporciona las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="0b23e-113">The template provides the following features:</span></span>

-   <span data-ttu-id="0b23e-114">Comprobación básica de parámetros.</span><span class="sxs-lookup"><span data-stu-id="0b23e-114">Basic parameter checking.</span></span> <span data-ttu-id="0b23e-115">Los métodos de plantilla comprueban que los parámetros necesarios no son **null**, que los índices de secuencia están dentro del intervalo y que las marcas son válidas.</span><span class="sxs-lookup"><span data-stu-id="0b23e-115">The template methods verify that required parameters are not **NULL**, that stream indexes are within range, and that flags are valid.</span></span>
-   <span data-ttu-id="0b23e-116">Tienda.</span><span class="sxs-lookup"><span data-stu-id="0b23e-116">Locking.</span></span> <span data-ttu-id="0b23e-117">Los métodos de plantilla llaman a dos métodos internos, **Lock** y **Unlock**, para serializar las operaciones en DMO.</span><span class="sxs-lookup"><span data-stu-id="0b23e-117">The template methods call two internal methods, **Lock** and **Unlock**, to serialize operations on the DMO.</span></span> <span data-ttu-id="0b23e-118">Esta característica garantiza que DMO es segura para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="0b23e-118">This feature ensures that the DMO is thread-safe.</span></span>
-   <span data-ttu-id="0b23e-119">Tipos de medios.</span><span class="sxs-lookup"><span data-stu-id="0b23e-119">Media types.</span></span> <span data-ttu-id="0b23e-120">La plantilla almacena los tipos de medios establecidos por el cliente y proporciona métodos de descriptor de acceso para los tipos de medios.</span><span class="sxs-lookup"><span data-stu-id="0b23e-120">The template stores the media types set by the client, and provides accessor methods for the media types.</span></span>
-   <span data-ttu-id="0b23e-121">Difusión.</span><span class="sxs-lookup"><span data-stu-id="0b23e-121">Streaming.</span></span> <span data-ttu-id="0b23e-122">La plantilla impide el streaming hasta que el cliente tenga establecidos tipos de medios para todas las secuencias no opcionales.</span><span class="sxs-lookup"><span data-stu-id="0b23e-122">The template prevents streaming until the client has set media types for all non-optional streams.</span></span> <span data-ttu-id="0b23e-123">También garantiza que se llama al método [**IMediaObject:: AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) antes de que se inicie el streaming, lo que garantiza que los recursos se asignan.</span><span class="sxs-lookup"><span data-stu-id="0b23e-123">It also ensures that the [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) method is called before streaming begins, which guarantees that resources are allocated.</span></span>

<span data-ttu-id="0b23e-124">La clase derivada debe implementar la interfaz **IUnknown** ; la plantilla no proporciona esta interfaz.</span><span class="sxs-lookup"><span data-stu-id="0b23e-124">The derived class must implement the **IUnknown** interface; the template does not provide this interface.</span></span> <span data-ttu-id="0b23e-125">Puede usar el Active Template Library (ATL) para implementar **IUnknown** o puede proporcionar otra implementación.</span><span class="sxs-lookup"><span data-stu-id="0b23e-125">You can use the Active Template Library (ATL) to implement **IUnknown**, or you can provide some other implementation.</span></span> <span data-ttu-id="0b23e-126">La plantilla tampoco implementa el mecanismo de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="0b23e-126">The template also does not implement the locking mechanism.</span></span> <span data-ttu-id="0b23e-127">La clase derivada debe implementar los métodos **Lock** y **Unlock** .</span><span class="sxs-lookup"><span data-stu-id="0b23e-127">The derived class must implement the **Lock** and **Unlock** methods.</span></span> <span data-ttu-id="0b23e-128">Si crea la clase mediante ATL, puede usar las implementaciones predeterminadas de ATL.</span><span class="sxs-lookup"><span data-stu-id="0b23e-128">If you create your class using ATL, you can use the default ATL implementations.</span></span>

<span data-ttu-id="0b23e-129">**Declarar la clase derivada**</span><span class="sxs-lookup"><span data-stu-id="0b23e-129">**Declaring the Derived Class**</span></span>

<span data-ttu-id="0b23e-130">La plantilla de clase **IMediaObjectImpl** se declara de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0b23e-130">The **IMediaObjectImpl** class template is declared as follows:</span></span>


```C++
template <class _DERIVED_, int NUMBEROFINPUTS, int NUMBEROFOUTPUTS>
class IMediaObjectImpl : public ImediaObject
```



<span data-ttu-id="0b23e-131">Los tres parámetros de plantilla son \_ derived \_ , NUMBEROFINPUTS y NUMBEROFOUTPUTS.</span><span class="sxs-lookup"><span data-stu-id="0b23e-131">The three template parameters are \_DERIVED\_, NUMBEROFINPUTS, and NUMBEROFOUTPUTS.</span></span> <span data-ttu-id="0b23e-132">Establezca \_ derived \_ igual al nombre de la clase.</span><span class="sxs-lookup"><span data-stu-id="0b23e-132">Set \_DERIVED\_ equal to the name of your class.</span></span> <span data-ttu-id="0b23e-133">Los otros dos parámetros definen el número de flujos de entrada y de salida en DMO.</span><span class="sxs-lookup"><span data-stu-id="0b23e-133">The other two parameters define the number of input streams and output streams on the DMO.</span></span> <span data-ttu-id="0b23e-134">Por ejemplo, para crear una clase DMO denominada CMyDmo que admita un flujo de entrada y dos flujos de salida, use la siguiente declaración:</span><span class="sxs-lookup"><span data-stu-id="0b23e-134">For example, to create a DMO class named CMyDmo that supports one input stream and two output streams, use the following declaration:</span></span>


```C++
class CMyDmo : public IMediaObjectImpl<CMyDmo, 1, 2>
```



<span data-ttu-id="0b23e-135">En el resto de esta sección se describe cómo la plantilla implementa los distintos métodos en **IMediaObject**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-135">The remainder of this section describes how the template implements the various methods in **IMediaObject**.</span></span>

<span data-ttu-id="0b23e-136">**Métodos para establecer tipos de medios**</span><span class="sxs-lookup"><span data-stu-id="0b23e-136">**Methods for Setting Media Types**</span></span>

<span data-ttu-id="0b23e-137">Los métodos siguientes establecen o recuperan los tipos de medios en DMO:</span><span class="sxs-lookup"><span data-stu-id="0b23e-137">The following methods set or retrieve media types on the DMO:</span></span>

-   <span data-ttu-id="0b23e-138">**GetInputType**, **GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-138">**GetInputType**, **GetOutputType**.</span></span> <span data-ttu-id="0b23e-139">Estos métodos devuelven los tipos de medios preferidos, por número de secuencia y tipo de índice.</span><span class="sxs-lookup"><span data-stu-id="0b23e-139">These methods return preferred media types, by stream number and type index.</span></span> <span data-ttu-id="0b23e-140">La plantilla llama a **InternalGetInputType** o **InternalGetOutputType** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-140">The template calls **InternalGetInputType** or **InternalGetOutputType** on the derived class.</span></span>
-   <span data-ttu-id="0b23e-141">**SetInputType**, **SetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-141">**SetInputType**, **SetOutputType**.</span></span> <span data-ttu-id="0b23e-142">Estos métodos establecen el tipo de medio en una secuencia, prueban un tipo de medio o borran un tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="0b23e-142">These methods set the media type on a stream, test a media type, or clear a media type.</span></span> <span data-ttu-id="0b23e-143">Para validar el tipo de medio, la plantilla llama a **InternalCheckInputType** o **InternalCheckOutputType** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-143">To validate the media type, the template calls **InternalCheckInputType** or **InternalCheckOutputType** on the derived class.</span></span> <span data-ttu-id="0b23e-144">La clase derivada devuelve S \_ OK para aceptar el tipo o DMO \_ E \_ INVALIDTYPE para rechazar el tipo.</span><span class="sxs-lookup"><span data-stu-id="0b23e-144">The derived class returns S\_OK to accept the type or DMO\_E\_INVALIDTYPE to reject the type.</span></span> <span data-ttu-id="0b23e-145">La plantilla controla el establecimiento o la eliminación del tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="0b23e-145">The template handles setting or clearing the media type.</span></span>
-   <span data-ttu-id="0b23e-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span></span> <span data-ttu-id="0b23e-147">Estos métodos devuelven el tipo de archivo multimedia actual para un flujo, o el tipo de DMO \_ E \_ \_ no \_ se establece si no se establece ningún tipo.</span><span class="sxs-lookup"><span data-stu-id="0b23e-147">These methods return the current media type for a stream, or DMO\_E\_TYPE\_NOT\_SET if no type is set.</span></span> <span data-ttu-id="0b23e-148">La plantilla implementa completamente estos métodos.</span><span class="sxs-lookup"><span data-stu-id="0b23e-148">The template completely implements these methods.</span></span>

<span data-ttu-id="0b23e-149">**Métodos informativos**</span><span class="sxs-lookup"><span data-stu-id="0b23e-149">**Informational Methods**</span></span>

<span data-ttu-id="0b23e-150">Los métodos siguientes proporcionan información acerca de DMO.</span><span class="sxs-lookup"><span data-stu-id="0b23e-150">The following methods provide information about the DMO.</span></span>

-   <span data-ttu-id="0b23e-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span></span> <span data-ttu-id="0b23e-152">Estos métodos recuperan o establecen la latencia máxima.</span><span class="sxs-lookup"><span data-stu-id="0b23e-152">These methods retrieve or set the maximum latency.</span></span> <span data-ttu-id="0b23e-153">La plantilla llama a **InternalGetInputMaxLatency** o **InternalSetInputMaxLatency** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-153">The template calls **InternalGetInputMaxLatency** or **InternalSetInputMaxLatency** on the derived class.</span></span>
-   <span data-ttu-id="0b23e-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span></span> <span data-ttu-id="0b23e-155">Estos métodos devuelven los requisitos de búfer de DMO para una secuencia especificada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-155">These methods return the DMO's buffer requirements for a specified stream.</span></span> <span data-ttu-id="0b23e-156">Si no se ha establecido ningún tipo de medio en la secuencia, la plantilla devuelve el tipo de DMO \_ E \_ \_ no \_ establecido.</span><span class="sxs-lookup"><span data-stu-id="0b23e-156">If no media type has been set on that stream, the template returns DMO\_E\_TYPE\_NOT\_SET.</span></span> <span data-ttu-id="0b23e-157">De lo contrario, llama a **InternalGetInputSizeInfo** o **InternalGetOutputSizeInfo** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-157">Otherwise, it calls **InternalGetInputSizeInfo** or **InternalGetOutputSizeInfo** on the derived class.</span></span>
-   <span data-ttu-id="0b23e-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span></span> <span data-ttu-id="0b23e-159">Estos métodos devuelven varias marcas que indican cómo el cliente debe dar formato a los datos.</span><span class="sxs-lookup"><span data-stu-id="0b23e-159">These methods return various flags that indicate how the client should format the data.</span></span> <span data-ttu-id="0b23e-160">La plantilla llama a **InternalGetInputStreamInfo** o **InternalGetOutputStreamInfo** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-160">The template calls **InternalGetInputStreamInfo** or **InternalGetOutputStreamInfo** on the derived class.</span></span>
-   <span data-ttu-id="0b23e-161">**GetStreamCount**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-161">**GetStreamCount**.</span></span> <span data-ttu-id="0b23e-162">Este método devuelve el número de flujos de entrada y salida.</span><span class="sxs-lookup"><span data-stu-id="0b23e-162">This method returns the number of input and output streams.</span></span> <span data-ttu-id="0b23e-163">La plantilla implementa este método con los parámetros de la plantilla.</span><span class="sxs-lookup"><span data-stu-id="0b23e-163">The template implements this method, using the template parameters.</span></span>

<span data-ttu-id="0b23e-164">**Métodos para la asignación de recursos**</span><span class="sxs-lookup"><span data-stu-id="0b23e-164">**Methods for Resource Allocation**</span></span>

-   <span data-ttu-id="0b23e-165">El método **AllocateStreamingResources** asigna los recursos que necesita DMO antes de que se inicie la transmisión por secuencias.</span><span class="sxs-lookup"><span data-stu-id="0b23e-165">The **AllocateStreamingResources** method allocates any resources the DMO needs before streaming begins.</span></span> <span data-ttu-id="0b23e-166">El método **FreeStreamingResources** libera los mismos recursos.</span><span class="sxs-lookup"><span data-stu-id="0b23e-166">The **FreeStreamingResources** method releases the same resources.</span></span> <span data-ttu-id="0b23e-167">La plantilla llama a **InternalAllocateStreamingResources** y **InternalFreeStreamingResources**, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="0b23e-167">The template calls **InternalAllocateStreamingResources** and **InternalFreeStreamingResources**, respectively.</span></span>

<span data-ttu-id="0b23e-168">No es necesario que el cliente de DMO llame a estos métodos, pero la plantilla llama automáticamente a **AllocateStreamingResources** antes de que se inicie el streaming.</span><span class="sxs-lookup"><span data-stu-id="0b23e-168">The client of the DMO is not required to call these methods, but the template automatically calls **AllocateStreamingResources** before streaming starts.</span></span> <span data-ttu-id="0b23e-169">Por lo tanto, DMO puede suponer que los recursos se han asignado correctamente en el momento en que se llama a **ProcessInput** .</span><span class="sxs-lookup"><span data-stu-id="0b23e-169">Therefore, the DMO can assume that resources are have been allocated correctly by the time **ProcessInput** is called.</span></span> <span data-ttu-id="0b23e-170">DMO debe llamar a **FreeStreamingResources** en su destructor.</span><span class="sxs-lookup"><span data-stu-id="0b23e-170">The DMO should call **FreeStreamingResources** in its destructor.</span></span>

<span data-ttu-id="0b23e-171">Además, cuando la plantilla llama a **InternalAllocateStreamingResources**, establece una marca interna, de modo que no llama a ese método de nuevo hasta que se llama a **InternalFreeStreamingResources**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-171">Also, when the template calls **InternalAllocateStreamingResources**, it sets an internal flag, so that it does not call that method again until calling **InternalFreeStreamingResources**.</span></span> <span data-ttu-id="0b23e-172">Esto garantiza que los recursos no se vuelvan a asignar accidentalmente, lo que podría provocar pérdidas de memoria.</span><span class="sxs-lookup"><span data-stu-id="0b23e-172">This ensures that resources are not re-allocated accidentally, which could cause memory leaks.</span></span>

<span data-ttu-id="0b23e-173">**Métodos para el streaming**</span><span class="sxs-lookup"><span data-stu-id="0b23e-173">**Methods for Streaming**</span></span>

<span data-ttu-id="0b23e-174">Los métodos siguientes se utilizan para transmitir datos por secuencias:</span><span class="sxs-lookup"><span data-stu-id="0b23e-174">The following methods are used to stream data:</span></span>

-   <span data-ttu-id="0b23e-175">**GetInputStatus**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-175">**GetInputStatus**.</span></span> <span data-ttu-id="0b23e-176">Este método indica si DMO puede aceptar la entrada en este momento.</span><span class="sxs-lookup"><span data-stu-id="0b23e-176">This method indicates whether the DMO can accept input at this time.</span></span> <span data-ttu-id="0b23e-177">La plantilla llama a **InternalAcceptingInput** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-177">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="0b23e-178">Si DMO puede aceptar la entrada, la clase derivada devuelve S \_ correcto y la plantilla establece el \_ \_ \_ \_ bit de datos de aceptación de STATUSF de entrada de DMO en el parámetro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="0b23e-178">If the DMO can accept input, the derived class returns S\_OK and the template sets the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA bit in the *dwFlags* parameter.</span></span> <span data-ttu-id="0b23e-179">De lo contrario, la clase derivada devuelve S \_ false y la plantilla establece *dwFlags* en cero.</span><span class="sxs-lookup"><span data-stu-id="0b23e-179">Otherwise, the derived class returns S\_FALSE and the template sets *dwFlags* to zero.</span></span>
-   <span data-ttu-id="0b23e-180">**ProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-180">**ProcessInput**.</span></span> <span data-ttu-id="0b23e-181">Este método procesa un búfer de entrada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-181">This method processes an input buffer.</span></span> <span data-ttu-id="0b23e-182">La plantilla llama a **AllocateStreamingResources**, que se ha descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="0b23e-182">The template calls **AllocateStreamingResources**, described previously.</span></span> <span data-ttu-id="0b23e-183">A continuación, llama a **InternalAcceptingInput** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-183">Then it calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="0b23e-184">Si DMO puede aceptar una entrada nueva, la plantilla llama a **InternalProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-184">If the DMO can accept new input, the template calls **InternalProcessInput**.</span></span>
-   <span data-ttu-id="0b23e-185">**ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-185">**ProcessOutput**.</span></span> <span data-ttu-id="0b23e-186">Este método procesa un conjunto de búferes de salida, un búfer para cada flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="0b23e-186">This method processes a set of output buffers, one buffer for each output stream.</span></span> <span data-ttu-id="0b23e-187">La plantilla llama a **AllocateStreamingResources** y, a continuación, a **InternalProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-187">The template calls **AllocateStreamingResources** and then **InternalProcessOutput**.</span></span>
-   <span data-ttu-id="0b23e-188">**Discontinuidad**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-188">**Discontinuity**.</span></span> <span data-ttu-id="0b23e-189">Este método señala una discontinuidad en un flujo de entrada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-189">This method signals a discontinuity in an input stream.</span></span> <span data-ttu-id="0b23e-190">La plantilla llama a **InternalAcceptingInput** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-190">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="0b23e-191">Si ese método devuelve S \_ correcto, la plantilla llama a **InternalDiscontinuity** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-191">If that method returns S\_OK, the template calls **InternalDiscontinuity** on the derived class.</span></span>
-   <span data-ttu-id="0b23e-192">**Vaciar**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-192">**Flush**.</span></span> <span data-ttu-id="0b23e-193">Este método vacía DMO.</span><span class="sxs-lookup"><span data-stu-id="0b23e-193">This method flushes the DMO.</span></span> <span data-ttu-id="0b23e-194">La plantilla llama a **InternalFlush** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-194">The template calls **InternalFlush** on the derived class.</span></span> <span data-ttu-id="0b23e-195">DMO debe descartar todos los búferes de entrada que todavía tenga para ser procesados.</span><span class="sxs-lookup"><span data-stu-id="0b23e-195">The DMO should discard any input buffers that it still holds to be processed.</span></span>

<span data-ttu-id="0b23e-196">La plantilla no proporciona ninguna compatibilidad directa para la interfaz [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) .</span><span class="sxs-lookup"><span data-stu-id="0b23e-196">The template does not provide any direct support for the [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) interface.</span></span>

<span data-ttu-id="0b23e-197">**Métodos para bloquear**</span><span class="sxs-lookup"><span data-stu-id="0b23e-197">**Methods for Locking**</span></span>

<span data-ttu-id="0b23e-198">El bloqueo se utiliza para proteger el estado de DMO en un entorno multiproceso.</span><span class="sxs-lookup"><span data-stu-id="0b23e-198">Locking is used to protect the DMO's state in a multithreaded environment.</span></span> <span data-ttu-id="0b23e-199">En un proyecto ATL, el método [**IMediaObject:: Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) produce un conflicto de nombres con el método de **bloqueo** de ATL.</span><span class="sxs-lookup"><span data-stu-id="0b23e-199">In an ATL project, the [**IMediaObject::Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) method causes a name conflict with the ATL **Lock** method.</span></span> <span data-ttu-id="0b23e-200">Para resolver el conflicto, la plantilla cambia el nombre del método **IMediaObject** a **DMOLock**.</span><span class="sxs-lookup"><span data-stu-id="0b23e-200">To resolve the conflict, the template renames the **IMediaObject** method to **DMOLock**.</span></span> <span data-ttu-id="0b23e-201">Al compilar la clase derivada, defina \_ el \_ nombre del bloqueo de corrección antes de incluir el archivo de encabezado DMO. h:</span><span class="sxs-lookup"><span data-stu-id="0b23e-201">When you compile the derived class, define FIX\_LOCK\_NAME before including the header file Dmo.h:</span></span>


```C++
#define FIX_LOCK_NAME
#include <dmo.h>
```



<span data-ttu-id="0b23e-202">Esta directiva hace que el preprocesador sustituya **DMOLock** por **Lock** en la declaración de la interfaz **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="0b23e-202">This directive causes the preprocessor to substitute **DMOLock** for **Lock** in the declaration of the **IMediaObject** interface.</span></span> <span data-ttu-id="0b23e-203">Las aplicaciones pueden seguir invocando el método mediante el **bloqueo** de nombre, porque el orden vtable no cambia.</span><span class="sxs-lookup"><span data-stu-id="0b23e-203">Applications can still invoke the method using the name **Lock**, because the vtable order does not change.</span></span> <span data-ttu-id="0b23e-204">El método **DMOLock** llama a **Lock** o **Unlock** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-204">The **DMOLock** method calls **Lock** or **Unlock** on the derived class.</span></span> <span data-ttu-id="0b23e-205">Si usa ATL para implementar la clase derivada, ATL ya define estos métodos, por lo que no es necesario ningún código adicional.</span><span class="sxs-lookup"><span data-stu-id="0b23e-205">If you are using ATL to implement the derived class, these methods are already defined by ATL, so no additional code is necessary.</span></span> <span data-ttu-id="0b23e-206">Si no usa ATL, debe proporcionar los métodos **Lock** y **Unlock** en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-206">If you are not using ATL, you must provide **Lock** and **Unlock** methods in your derived class.</span></span>

<span data-ttu-id="0b23e-207">La plantilla bloquea automáticamente DMO en cada uno de los métodos **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="0b23e-207">The template automatically locks the DMO in each of the **IMediaObject** methods.</span></span> <span data-ttu-id="0b23e-208">La clase derivada podría necesitar bloquear DMO dentro de otros métodos públicos que implementa (por ejemplo, si es compatible con **IMediaObjectInPlace**).</span><span class="sxs-lookup"><span data-stu-id="0b23e-208">The derived class might need to lock the DMO inside other public methods that it implements (for example, if it supports **IMediaObjectInPlace**).</span></span> <span data-ttu-id="0b23e-209">La plantilla de clase también proporciona una clase auxiliar interna, [**IMediaObjectImpl:: LockIt**](imediaobjectimpl-lockit.md), que es útil para bloquear y desbloquear DMO.</span><span class="sxs-lookup"><span data-stu-id="0b23e-209">The class template also provides an internal helper class, [**IMediaObjectImpl::LockIt**](imediaobjectimpl-lockit.md), which is useful for locking and unlocking the DMO.</span></span>

<span data-ttu-id="0b23e-210">**Resumen**</span><span class="sxs-lookup"><span data-stu-id="0b23e-210">**Summary**</span></span>

<span data-ttu-id="0b23e-211">En el caso de los siguientes métodos **IMediaObject** , la plantilla llama a un método correspondiente con la misma firma en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-211">For the following **IMediaObject** methods, the template calls a corresponding method with the same signature on the derived class.</span></span> <span data-ttu-id="0b23e-212">La clase derivada debe implementar cada uno de los métodos que se muestran en la segunda columna.</span><span class="sxs-lookup"><span data-stu-id="0b23e-212">The derived class must implement each of the methods shown in the second column.</span></span>



| <span data-ttu-id="0b23e-213">Método IMediaObject</span><span class="sxs-lookup"><span data-stu-id="0b23e-213">IMediaObject Method</span></span>            | <span data-ttu-id="0b23e-214">Método de clase derivada</span><span class="sxs-lookup"><span data-stu-id="0b23e-214">Derived Class Method</span></span>                   |
|--------------------------------|----------------------------------------|
| <span data-ttu-id="0b23e-215">**AllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="0b23e-215">**AllocateStreamingResources**</span></span> | <span data-ttu-id="0b23e-216">**InternalAllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="0b23e-216">**InternalAllocateStreamingResources**</span></span> |
| <span data-ttu-id="0b23e-217">**Discontinuidad**</span><span class="sxs-lookup"><span data-stu-id="0b23e-217">**Discontinuity**</span></span>              | <span data-ttu-id="0b23e-218">**InternalDiscontinuity**</span><span class="sxs-lookup"><span data-stu-id="0b23e-218">**InternalDiscontinuity**</span></span>              |
| <span data-ttu-id="0b23e-219">**Vaciar**</span><span class="sxs-lookup"><span data-stu-id="0b23e-219">**Flush**</span></span>                      | <span data-ttu-id="0b23e-220">**InternalFlush**</span><span class="sxs-lookup"><span data-stu-id="0b23e-220">**InternalFlush**</span></span>                      |
| <span data-ttu-id="0b23e-221">**FreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="0b23e-221">**FreeStreamingResources**</span></span>     | <span data-ttu-id="0b23e-222">**InternalFreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="0b23e-222">**InternalFreeStreamingResources**</span></span>     |
| <span data-ttu-id="0b23e-223">**GetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="0b23e-223">**GetInputMaxLatency**</span></span>         | <span data-ttu-id="0b23e-224">**InternalGetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="0b23e-224">**InternalGetInputMaxLatency**</span></span>         |
| <span data-ttu-id="0b23e-225">**GetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-225">**GetInputSizeInfo**</span></span>           | <span data-ttu-id="0b23e-226">**InternalGetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-226">**InternalGetInputSizeInfo**</span></span>           |
| <span data-ttu-id="0b23e-227">**GetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-227">**GetInputStreamInfo**</span></span>         | <span data-ttu-id="0b23e-228">**InternalGetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-228">**InternalGetInputStreamInfo**</span></span>         |
| <span data-ttu-id="0b23e-229">**GetInputType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-229">**GetInputType**</span></span>               | <span data-ttu-id="0b23e-230">**InternalGetInputType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-230">**InternalGetInputType**</span></span>               |
| <span data-ttu-id="0b23e-231">**GetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-231">**GetOutputSizeInfo**</span></span>          | <span data-ttu-id="0b23e-232">**InternalGetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-232">**InternalGetOutputSizeInfo**</span></span>          |
| <span data-ttu-id="0b23e-233">**GetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-233">**GetOutputStreamInfo**</span></span>        | <span data-ttu-id="0b23e-234">**InternalGetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="0b23e-234">**InternalGetOutputStreamInfo**</span></span>        |
| <span data-ttu-id="0b23e-235">**GetOutputType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-235">**GetOutputType**</span></span>              | <span data-ttu-id="0b23e-236">**InternalGetOutputType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-236">**InternalGetOutputType**</span></span>              |
| <span data-ttu-id="0b23e-237">**ProcessInput**</span><span class="sxs-lookup"><span data-stu-id="0b23e-237">**ProcessInput**</span></span>               | <span data-ttu-id="0b23e-238">**InternalProcessInput**</span><span class="sxs-lookup"><span data-stu-id="0b23e-238">**InternalProcessInput**</span></span>               |
| <span data-ttu-id="0b23e-239">**ProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="0b23e-239">**ProcessOutput**</span></span>              | <span data-ttu-id="0b23e-240">**InternalProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="0b23e-240">**InternalProcessOutput**</span></span>              |
| <span data-ttu-id="0b23e-241">**SetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="0b23e-241">**SetInputMaxLatency**</span></span>         | <span data-ttu-id="0b23e-242">**InternalSetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="0b23e-242">**InternalSetInputMaxLatency**</span></span>         |



 

<span data-ttu-id="0b23e-243">En el resto de métodos **IMediaObject** , no hay una correspondencia uno a uno entre los métodos de plantilla y los métodos de clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-243">For the remaining **IMediaObject** methods, there is not a one-to-one correspondence between template methods and derived-class methods.</span></span> <span data-ttu-id="0b23e-244">En la tabla siguiente se resumen los métodos que se implementan por completo en la plantilla y los métodos que llaman a otros métodos en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="0b23e-244">The following table summarizes which methods are fully implemented by the template, and which methods call other methods on the derived class.</span></span>



| <span data-ttu-id="0b23e-245">Método IMediaObject</span><span class="sxs-lookup"><span data-stu-id="0b23e-245">IMediaObject Method</span></span>                   | <span data-ttu-id="0b23e-246">Método de clase derivada</span><span class="sxs-lookup"><span data-stu-id="0b23e-246">Derived Class Method</span></span>                                                             |
|---------------------------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="0b23e-247">**GetInputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-247">**GetInputCurrentType**</span></span>               | <span data-ttu-id="0b23e-248">Totalmente implementado</span><span class="sxs-lookup"><span data-stu-id="0b23e-248">Fully implemented</span></span>                                                                |
| <span data-ttu-id="0b23e-249">**GetOutputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-249">**GetOutputCurrentType**</span></span>              | <span data-ttu-id="0b23e-250">Totalmente implementado</span><span class="sxs-lookup"><span data-stu-id="0b23e-250">Fully implemented</span></span>                                                                |
| <span data-ttu-id="0b23e-251">**GetStreamCount**</span><span class="sxs-lookup"><span data-stu-id="0b23e-251">**GetStreamCount**</span></span>                    | <span data-ttu-id="0b23e-252">Totalmente implementado</span><span class="sxs-lookup"><span data-stu-id="0b23e-252">Fully implemented</span></span>                                                                |
| <span data-ttu-id="0b23e-253">**GetInputStatus**</span><span class="sxs-lookup"><span data-stu-id="0b23e-253">**GetInputStatus**</span></span>                    | <span data-ttu-id="0b23e-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="0b23e-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span></span>        |
| <span data-ttu-id="0b23e-255">**Bloqueo** (implementado como **DMOLock**)</span><span class="sxs-lookup"><span data-stu-id="0b23e-255">**Lock** (implemented as **DMOLock**)</span></span> | <span data-ttu-id="0b23e-256">[**Bloquear**](/previous-versions/ms809100(v=msdn.10)), [ **desbloquear**](/previous-versions/ms809101(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="0b23e-256">[**Lock**](/previous-versions/ms809100(v=msdn.10)), [**Unlock**](/previous-versions/ms809101(v=msdn.10))</span></span> |
| <span data-ttu-id="0b23e-257">**SetInputType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-257">**SetInputType**</span></span>                      | <span data-ttu-id="0b23e-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="0b23e-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span></span>        |
| <span data-ttu-id="0b23e-259">**SetOutputType**</span><span class="sxs-lookup"><span data-stu-id="0b23e-259">**SetOutputType**</span></span>                     | <span data-ttu-id="0b23e-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="0b23e-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span></span>      |



 

## <a name="related-topics"></a><span data-ttu-id="0b23e-261">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="0b23e-261">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0b23e-262">**Plantilla de clase IMediaObjectImpl**</span><span class="sxs-lookup"><span data-stu-id="0b23e-262">**IMediaObjectImpl Class Template**</span></span>](imediaobjectimpl-class-template.md)
</dt> <dt>

[<span data-ttu-id="0b23e-263">Escritura de DMO</span><span class="sxs-lookup"><span data-stu-id="0b23e-263">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 
