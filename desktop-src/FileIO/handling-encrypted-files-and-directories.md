---
description: Un archivo marcado como cifrado está cifrado mediante el sistema de archivos NTFS mediante el controlador de cifrado actual.
ms.assetid: 166bfb8c-b97d-4cc7-bf6b-399837cb8ad0
title: Administrar archivos y directorios cifrados
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2718656a28eb678c10076e228e08a2a95cabd1fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104002862"
---
# <a name="handling-encrypted-files-and-directories"></a><span data-ttu-id="2d175-103">Administrar archivos y directorios cifrados</span><span class="sxs-lookup"><span data-stu-id="2d175-103">Handling Encrypted Files and Directories</span></span>

<span data-ttu-id="2d175-104">Un programador o un usuario puede marcar un directorio o un archivo como cifrado.</span><span class="sxs-lookup"><span data-stu-id="2d175-104">A programmer or user may mark a directory or file as encrypted.</span></span> <span data-ttu-id="2d175-105">Un archivo marcado como cifrado está cifrado mediante el sistema de archivos NTFS mediante el controlador de cifrado actual.</span><span class="sxs-lookup"><span data-stu-id="2d175-105">A file marked encrypted is encrypted by the NTFS file system by using the current encryption driver.</span></span> <span data-ttu-id="2d175-106">Si en una fecha posterior el archivo se marca como no cifrado, se descifrará y quedará en un estado de texto sin formato (no seguro).</span><span class="sxs-lookup"><span data-stu-id="2d175-106">If at a later date the file is marked as not encrypted, it is decrypted and left in a plain text (unsecured) state.</span></span>

<span data-ttu-id="2d175-107">Los directorios no se cifran a sí mismos.</span><span class="sxs-lookup"><span data-stu-id="2d175-107">Directories are not themselves encrypted.</span></span> <span data-ttu-id="2d175-108">En su lugar, de forma predeterminada, en un directorio "cifrado", todos los archivos nuevos del directorio se cifran durante la creación.</span><span class="sxs-lookup"><span data-stu-id="2d175-108">Rather, by default, in an "encrypted" directory all new files in the directory are encrypted at creation.</span></span> <span data-ttu-id="2d175-109">Un usuario debe cambiar específicamente el estado de un nuevo archivo a descifrado si el usuario no desea cifrar el archivo.</span><span class="sxs-lookup"><span data-stu-id="2d175-109">A user must specifically change the status of a new file to decrypted if the user does not want the file to be encrypted.</span></span> <span data-ttu-id="2d175-110">Un directorio cifrado está visible.</span><span class="sxs-lookup"><span data-stu-id="2d175-110">An encrypted directory is visible.</span></span> <span data-ttu-id="2d175-111">Para hacer que un directorio sea inaccesible para otros usuarios, use los métodos estándar de control de acceso.</span><span class="sxs-lookup"><span data-stu-id="2d175-111">To make a directory inaccessible to other users, use the standard methods of access control.</span></span>

<span data-ttu-id="2d175-112">Las funciones de cifrado no se pueden usar con la [API de copia de seguridad](/windows/desktop/Backup/backup).</span><span class="sxs-lookup"><span data-stu-id="2d175-112">The encryption functions cannot be used with the [Backup API](/windows/desktop/Backup/backup).</span></span>

<span data-ttu-id="2d175-113">Para cifrar un archivo nuevo, utilice la función [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) con la marca de **atributo de archivo \_ \_ cifrada** .</span><span class="sxs-lookup"><span data-stu-id="2d175-113">To encrypt a new file, use the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_ATTRIBUTE\_ENCRYPTED** flag.</span></span> <span data-ttu-id="2d175-114">Para cifrar un archivo existente, utilice la función [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="2d175-114">To encrypt an existing file, use the [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) function.</span></span> <span data-ttu-id="2d175-115">Se cifran todas las secuencias de datos del archivo.</span><span class="sxs-lookup"><span data-stu-id="2d175-115">All data streams in the file are encrypted.</span></span> <span data-ttu-id="2d175-116">Si el archivo ya está cifrado, **EncryptFile** no realiza ninguna acción, pero devuelve un valor distinto de cero, que indica que la operación se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="2d175-116">If the file is already encrypted, **EncryptFile** does nothing but returns a nonzero value, which indicates success.</span></span> <span data-ttu-id="2d175-117">Si el archivo está comprimido, **EncryptFile** descomprime el archivo antes de cifrarlo.</span><span class="sxs-lookup"><span data-stu-id="2d175-117">If the file is compressed, **EncryptFile** decompresses the file before encrypting it.</span></span>

<span data-ttu-id="2d175-118">Para descifrar un archivo cifrado, use la función [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="2d175-118">To decrypt an encrypted file, use the [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) function.</span></span> <span data-ttu-id="2d175-119">Si el archivo no está cifrado, **DecryptFile** no realiza ninguna acción, pero devuelve un valor distinto de cero que indica que se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="2d175-119">If the file is not encrypted, **DecryptFile** does nothing but returns a nonzero value indicating success.</span></span>

<span data-ttu-id="2d175-120">La función [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) deshabilita o habilita el cifrado del directorio indicado y los archivos que hay en él.</span><span class="sxs-lookup"><span data-stu-id="2d175-120">The [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) function disables or enables the encryption of the indicated directory and the files in it.</span></span> <span data-ttu-id="2d175-121">No afecta al cifrado de subdirectorios por debajo del directorio indicado.</span><span class="sxs-lookup"><span data-stu-id="2d175-121">It does not affect the encryption of subdirectories below the indicated directory.</span></span>

<span data-ttu-id="2d175-122">Para recuperar el estado de cifrado de un archivo, use la función [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) .</span><span class="sxs-lookup"><span data-stu-id="2d175-122">To retrieve the encryption status of a file, use the [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) function.</span></span> <span data-ttu-id="2d175-123">Como alternativa, llame a la función [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) y examine el atributo de archivo de la marca **\_ \_ cifrada** en el valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="2d175-123">Alternatively, call the [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) function and examine the **FILE\_ATTRIBUTE\_ENCRYPTED** flag in the return value.</span></span>

<span data-ttu-id="2d175-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) y [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) intentan cifrar el archivo de destino con las claves utilizadas en el cifrado del archivo de origen.</span><span class="sxs-lookup"><span data-stu-id="2d175-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) and [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) attempt to encrypt the destination file with the keys used in the encryption of the source file.</span></span> <span data-ttu-id="2d175-125">Si esto no se puede hacer, ambas funciones intentan cifrar el archivo de destino con las claves predeterminadas.</span><span class="sxs-lookup"><span data-stu-id="2d175-125">If this cannot be done, both functions attempt to encrypt the destination file with default keys.</span></span> <span data-ttu-id="2d175-126">Si no se puede hacer ninguno de estos métodos, **CopyFile** y **CopyFileEx** generan un error de **\_ cifrado \_** erróneo.</span><span class="sxs-lookup"><span data-stu-id="2d175-126">If both of these methods cannot be done, **CopyFile** and **CopyFileEx** fail with an **ERROR\_ENCRYPTION\_FAILED** error.</span></span> <span data-ttu-id="2d175-127">Si desea que **CopyFileEx** complete la operación de copia incluso cuando no se pueda cifrar el archivo de destino, incluya la marca de **destino de archivo de copia \_ \_ permitir \_ descifrado \_** en el valor del parámetro *dwCopyFlags* en la llamada a **CopyFileEx**.</span><span class="sxs-lookup"><span data-stu-id="2d175-127">If you want **CopyFileEx** to complete the copy operation even when the destination file cannot be encrypted, include the **COPY\_FILE\_ALLOW\_DECRYPTED\_DESTINATION** flag in the value of the *dwCopyFlags* parameter in your call to **CopyFileEx**.</span></span>

 

 
