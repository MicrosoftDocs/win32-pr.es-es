---
description: Para abrir un archivo de registro para leerlo, llame a PdhOpenQuery y especifique una ruta de acceso al archivo de registro.
ms.assetid: 1d8f8662-df1f-4f84-8b65-c152f79cc5c6
title: Trabajar con archivos de registro
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba2032b90036f8f58c07d8c7e80e7e7ac2b2701c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105667236"
---
# <a name="working-with-log-files"></a><span data-ttu-id="2a229-103">Trabajar con archivos de registro</span><span class="sxs-lookup"><span data-stu-id="2a229-103">Working with Log Files</span></span>

<span data-ttu-id="2a229-104">Para abrir un archivo de registro para leerlo, llame a [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) y especifique una ruta de acceso al archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-104">To open a log file for reading, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) and specify a path to the log file.</span></span> <span data-ttu-id="2a229-105">Para abrir un archivo de registro para escribirlo, debe llamar a [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="2a229-105">To open a log file for writing, you must call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="2a229-106">Para cerrar un archivo de registro, llame a [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) o [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) , en función de la función que haya usado para abrir el archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-106">To close a log file, call either [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) or [**PdhCloseLog**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) depending on which function you used to open the log file.</span></span>

## <a name="reading-from-a-log-file"></a><span data-ttu-id="2a229-107">Leer de un archivo de registro</span><span class="sxs-lookup"><span data-stu-id="2a229-107">Reading from a log file</span></span>

<span data-ttu-id="2a229-108">Leer datos de rendimiento de un archivo de registro es igual que leer datos de un origen de tiempo real: se abre una consulta, se agregan contadores a la consulta y se llama a [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) para recopilar un ejemplo del archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-108">Reading performance data from a log file is the same as reading data from a real time source—you open a query, add counters to the query and call [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) to collect a sample from the log file.</span></span> <span data-ttu-id="2a229-109">**PdhCollectQueryData** devuelve PDH \_ no hay \_ más \_ datos cuando se llega al final del archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-109">**PdhCollectQueryData** returns PDH\_NO\_MORE\_DATA when you reach the end of the log file.</span></span>

<span data-ttu-id="2a229-110">Cada ejemplo del archivo de registro contiene una marca de tiempo para el momento en que se recopiló originalmente y se escribió en el archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-110">Each sample in the log file contains a time stamp for when it was originally collected and written to the log file.</span></span> <span data-ttu-id="2a229-111">Para recuperar la marca de tiempo de la primera y la última muestra del archivo de registro, llame a la función [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) .</span><span class="sxs-lookup"><span data-stu-id="2a229-111">To retrieve the time stamp for the first and last sample in the log file, call the [**PdhGetDataSourceTimeRange**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) function.</span></span> <span data-ttu-id="2a229-112">Si desea limitar los ejemplos que lee del registro en un intervalo de tiempo específico, consulte [configuración de un intervalo de tiempo para una consulta](setting-a-time-range-for-a-query.md).</span><span class="sxs-lookup"><span data-stu-id="2a229-112">If you want to limit the samples that you read from the log to a specific time range, see [Setting a Time Range for a Query](setting-a-time-range-for-a-query.md).</span></span>

<span data-ttu-id="2a229-113">Si no sabe qué objetos y contadores de rendimiento existen en el archivo de registro, puede llamar a [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) para determinar la lista de objetos.</span><span class="sxs-lookup"><span data-stu-id="2a229-113">If you do not know which performance objects and counters exist in the log file, you can call [**PdhEnumObjects**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) to determine the list of objects.</span></span> <span data-ttu-id="2a229-114">Dado un objeto, puede llamar a [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) o [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) para recuperar una lista de las instancias y los contadores del objeto contenidos en el archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-114">Given an object, you can call either [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) or [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to retrieve a list of the object's instances and counters contained in the log file.</span></span>

<span data-ttu-id="2a229-115">Si llama a [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), use las listas de instancias y contadores para crear una ruta de acceso para cada combinación posible de instancia y contador.</span><span class="sxs-lookup"><span data-stu-id="2a229-115">If you call [**PdhEnumObjectItems**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa), use the instance and counter lists to create a path for each possible combination of instance and counter.</span></span> <span data-ttu-id="2a229-116">Cuando se llama a [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) para agregar el contador a la consulta, se producirá un error en la función si el archivo de registro no contiene la combinación indicada.</span><span class="sxs-lookup"><span data-stu-id="2a229-116">When you call [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) to add the counter to the query, the function will fail if the log file does not contain the given combination.</span></span>

<span data-ttu-id="2a229-117">Si usa [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), puede crear una ruta de acceso que contenga un carácter comodín para el nombre de instancia y el contador, por ejemplo, \\ Object ( \* ) \\ \* .</span><span class="sxs-lookup"><span data-stu-id="2a229-117">If you use [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha), you can create a path that contains a wildcard for the instance name and counter, for example, \\object(\*)\\\*.</span></span> <span data-ttu-id="2a229-118">La función devuelve la \_ \_ ruta de acceso no válida de PDH si el objeto no contiene una instancia.</span><span class="sxs-lookup"><span data-stu-id="2a229-118">The function returns PDH\_INVALID\_PATH if the object does not contain an instance.</span></span> <span data-ttu-id="2a229-119">En este caso, llame a **PdhExpandWildCardPath** con un carácter comodín solo para Counter, por ejemplo, \\ Object \\ \* .</span><span class="sxs-lookup"><span data-stu-id="2a229-119">In this case, call **PdhExpandWildCardPath** using a wildcard for counter only, for example, \\object\\\*.</span></span>

<span data-ttu-id="2a229-120">Los sistemas operativos más recientes pueden leer archivos de registro generados en sistemas operativos anteriores. sin embargo, los archivos de registro que se crearon en Windows Vista y sistemas operativos posteriores no se pueden leer en los sistemas operativos anteriores.</span><span class="sxs-lookup"><span data-stu-id="2a229-120">Newer operating systems can read log files that were generated on older operating systems; however, log files that were created on Windows Vista and later operating systems cannot be read on earlier operating systems.</span></span>

<span data-ttu-id="2a229-121">Para obtener un ejemplo en el que se leen los datos de un archivo de registro, vea [leer datos de rendimiento de un archivo de registro](reading-performance-data-from-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="2a229-121">For an example that reads data from a log file, see [Reading Performance Data from a Log File](reading-performance-data-from-a-log-file.md).</span></span>

## <a name="reading-from-multiple-log-files"></a><span data-ttu-id="2a229-122">Leer de varios archivos de registro</span><span class="sxs-lookup"><span data-stu-id="2a229-122">Reading from multiple log files</span></span>

<span data-ttu-id="2a229-123">Si necesita crear una consulta que lea desde varios archivos de registro, llame a [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) para enlazar los archivos de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-123">If you need to create a query that reads from several log files, call the [**PdhBindInputDataSource**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) to bind the log files together.</span></span> <span data-ttu-id="2a229-124">Después, debe usar las funciones de PDH que terminen en "H", por ejemplo, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span><span class="sxs-lookup"><span data-stu-id="2a229-124">You then need to use PDH functions that end in 'H', for example, [**PdhOpenQueryH**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).</span></span>

## <a name="writing-to-a-log-file"></a><span data-ttu-id="2a229-125">Escribir en un archivo de registro</span><span class="sxs-lookup"><span data-stu-id="2a229-125">Writing to a log file</span></span>

<span data-ttu-id="2a229-126">Antes de escribir en un archivo de registro, llame a [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) para crear una consulta y especificar el origen de los datos de rendimiento, ya sea en tiempo real o en un archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-126">Before writing to a log file, call [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) to create a query and specify the source of the performance data, either real time data or a log file.</span></span> <span data-ttu-id="2a229-127">A continuación, agregue los contadores que desea consultar.</span><span class="sxs-lookup"><span data-stu-id="2a229-127">Then, add the counters that you want to query.</span></span>

<span data-ttu-id="2a229-128">Para abrir el archivo de destino, llame a [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span><span class="sxs-lookup"><span data-stu-id="2a229-128">To open the destination file, call [**PdhOpenLog**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga).</span></span> <span data-ttu-id="2a229-129">Especifique la consulta al abrir el archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-129">Specify the query when you open the log file.</span></span> <span data-ttu-id="2a229-130">Para recopilar los datos de rendimiento y escribirlos en el archivo de registro, llame a [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span><span class="sxs-lookup"><span data-stu-id="2a229-130">To collect the performance data and write it to the log file, call [**PdhUpdateLog**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).</span></span>

<span data-ttu-id="2a229-131">Si los datos del contador se escriben en un archivo de registro delimitado por comas (. csv) o delimitado por tabuladores (. TSV) y la ruta de acceso contiene una instancia de carácter comodín, la ruta de acceso se expande y solo se incluyen en el archivo de registro las instancias que existen en el momento en que se expande la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="2a229-131">If the counter data is being written to comma-delimited (.csv) or tab-delimited (.tsv) log file and the path contains a wildcard instance, the path is expanded and only those instances that exist at the time the path is expanded are included in the log file.</span></span> <span data-ttu-id="2a229-132">Sin embargo, para los archivos de registro de tipo binario (. BLG) o SQL, el carácter comodín no se expande para que el archivo de registro contenga instancias que se crean durante el registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-132">However, for binary (.blg) or SQL log files, the wildcard is not expanded so that the log file contains instances that are created during logging.</span></span>

<span data-ttu-id="2a229-133">Para obtener un ejemplo en el que se escriben datos en un archivo de registro, vea [escribir datos de rendimiento en un archivo de registro](writing-performance-data-to-a-log-file.md).</span><span class="sxs-lookup"><span data-stu-id="2a229-133">For an example that writes data to a log file, see [Writing Performance Data to a Log File](writing-performance-data-to-a-log-file.md).</span></span>

## <a name="compressing-a-log-file"></a><span data-ttu-id="2a229-134">Comprimir un archivo de registro</span><span class="sxs-lookup"><span data-stu-id="2a229-134">Compressing a log file</span></span>

<span data-ttu-id="2a229-135">Puede usar la función [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) para comprimir un archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-135">You can use the [**PdhComputeCounterStatistics**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) function to compress a log file.</span></span> <span data-ttu-id="2a229-136">Por ejemplo, lea diez registros de un archivo de registro, llame a **PdhComputeCounterStatistics** para calcular el valor medio y, a continuación, escriba el valor medio en un archivo de registro de salida.</span><span class="sxs-lookup"><span data-stu-id="2a229-136">For example, read ten records from a log file, call **PdhComputeCounterStatistics** to compute the mean value and then write the mean value to an output log file.</span></span>

<span data-ttu-id="2a229-137">En el tema siguiente se proporciona información adicional sobre el uso de un archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="2a229-137">The following topic provides additional information on using a log file.</span></span>

-   [<span data-ttu-id="2a229-138">Obtención del tamaño de un archivo de registro</span><span class="sxs-lookup"><span data-stu-id="2a229-138">Getting the Size of a Log File</span></span>](getting-the-size-of-a-log-file.md)

 

 



