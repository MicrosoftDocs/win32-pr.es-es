---
description: La API CNG implementa un modelo de proveedor extensible que le permite cargar un proveedor especificando el algoritmo criptográfico necesario en lugar de un proveedor determinado.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Programación de CNG típica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1119da63ca1ea0613444b150914c06664f36c121
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103809895"
---
# <a name="typical-cng-programming"></a><span data-ttu-id="e00a6-103">Programación de CNG típica</span><span class="sxs-lookup"><span data-stu-id="e00a6-103">Typical CNG Programming</span></span>

<span data-ttu-id="e00a6-104">La API CNG implementa un modelo de proveedor extensible que le permite cargar un proveedor especificando el algoritmo criptográfico necesario en lugar de un proveedor determinado.</span><span class="sxs-lookup"><span data-stu-id="e00a6-104">The CNG API implements an extensible provider model that lets you load a provider by specifying the required cryptographic algorithm rather than a particular provider.</span></span> <span data-ttu-id="e00a6-105">La ventaja es que un proveedor de algoritmos se puede reemplazar o actualizar y no tendrá que cambiar el código de ninguna manera para usar el nuevo proveedor.</span><span class="sxs-lookup"><span data-stu-id="e00a6-105">The advantage is that an algorithm provider can be replaced or upgraded and you will not have to change your code in any way to use the new provider.</span></span> <span data-ttu-id="e00a6-106">Además, si se determina que algún algoritmo no es seguro en el futuro, se puede instalar una versión más segura de ese algoritmo sin que ello afecte al código.</span><span class="sxs-lookup"><span data-stu-id="e00a6-106">Also, if some algorithm is determined to be unsafe in the future, a more secure version of that algorithm can be installed without affecting your code.</span></span> <span data-ttu-id="e00a6-107">La mayoría de las API de CNG requieren un proveedor o un objeto creado por un proveedor.</span><span class="sxs-lookup"><span data-stu-id="e00a6-107">Most of the CNG APIs require a provider or an object created by a provider.</span></span>

<span data-ttu-id="e00a6-108">Los pasos típicos implicados en el uso de la API de CNG para las operaciones primitivas criptográficas son los siguientes:</span><span class="sxs-lookup"><span data-stu-id="e00a6-108">The typical steps involved in using the CNG API for cryptographic primitive operations are as follows:</span></span>

1.  <span data-ttu-id="e00a6-109">Abrir el proveedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="e00a6-109">Opening the Algorithm Provider</span></span>
2.  <span data-ttu-id="e00a6-110">Obtener o establecer las propiedades del algoritmo</span><span class="sxs-lookup"><span data-stu-id="e00a6-110">Getting or Setting Algorithm Properties</span></span>
3.  <span data-ttu-id="e00a6-111">Crear o importar una clave</span><span class="sxs-lookup"><span data-stu-id="e00a6-111">Creating or Importing a Key</span></span>
4.  <span data-ttu-id="e00a6-112">Realización de operaciones criptográficas</span><span class="sxs-lookup"><span data-stu-id="e00a6-112">Performing Cryptographic Operations</span></span>
5.  <span data-ttu-id="e00a6-113">Cerrar el proveedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="e00a6-113">Closing the Algorithm Provider</span></span>

<span data-ttu-id="e00a6-114">Para obtener más información, vea ejemplos de programación.</span><span class="sxs-lookup"><span data-stu-id="e00a6-114">For more information, see Programming Examples.</span></span>

## <a name="opening-the-algorithm-provider"></a><span data-ttu-id="e00a6-115">Abrir el proveedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="e00a6-115">Opening the Algorithm Provider</span></span>

<span data-ttu-id="e00a6-116">La función [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) proporciona un identificador de proveedor de algoritmos que se usa en las API CNG posteriores, como [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) o [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span><span class="sxs-lookup"><span data-stu-id="e00a6-116">The [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) function provides you with an algorithm provider handle that is used in subsequent CNG APIs, such as [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) or [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span></span>

## <a name="getting-or-setting-algorithm-properties"></a><span data-ttu-id="e00a6-117">Obtener o establecer las propiedades del algoritmo</span><span class="sxs-lookup"><span data-stu-id="e00a6-117">Getting or Setting Algorithm Properties</span></span>

<span data-ttu-id="e00a6-118">Puede usar el identificador del proveedor de algoritmos para obtener los detalles de implementación del algoritmo, como el tamaño de la clave o el modo de funcionamiento actual.</span><span class="sxs-lookup"><span data-stu-id="e00a6-118">You can use the algorithm provider handle to get implementation details for the algorithm, such as the key size or the current mode of operation.</span></span> <span data-ttu-id="e00a6-119">La función [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) se usa para obtener propiedades específicas.</span><span class="sxs-lookup"><span data-stu-id="e00a6-119">You use the [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) function to obtain specific properties.</span></span>

<span data-ttu-id="e00a6-120">También puede modificar las propiedades del algoritmo.</span><span class="sxs-lookup"><span data-stu-id="e00a6-120">You can also modify the properties of the algorithm.</span></span> <span data-ttu-id="e00a6-121">Por ejemplo, si desea usar el encadenamiento de cifrado de bloques ECB con AES, establezca la propiedad del **\_ \_ modo de encadenamiento BCRYPT** de un algoritmo AES en el **\_ modo de cadena \_ \_ bcrypt**. la propiedad se asigna a todas las claves AES creadas con este identificador de algoritmo, sin necesidad de configurar cada una de las claves AES.</span><span class="sxs-lookup"><span data-stu-id="e00a6-121">For example, If you want to use ECB block cipher chaining with AES, you set the **BCRYPT\_CHAINING\_MODE** property of an AES algorithm to **BCRYPT\_CHAIN\_MODE\_ECB**; the property is assigned to all AES keys created using this algorithm handle, without the need to configure each and every AES key.</span></span> <span data-ttu-id="e00a6-122">Utilice la función [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) para modificar estas propiedades.</span><span class="sxs-lookup"><span data-stu-id="e00a6-122">You use the [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) function to modify these properties.</span></span>

## <a name="creating-or-importing-a-key"></a><span data-ttu-id="e00a6-123">Crear o importar una clave</span><span class="sxs-lookup"><span data-stu-id="e00a6-123">Creating or Importing a Key</span></span>

<span data-ttu-id="e00a6-124">Dependiendo del tipo de algoritmo que use, puede que tenga que crear o cargar una clave.</span><span class="sxs-lookup"><span data-stu-id="e00a6-124">Depending on the type of algorithm you use, you may need to create or load a key.</span></span> <span data-ttu-id="e00a6-125">Por ejemplo, la función [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) toma un identificador de clave para el primer parámetro.</span><span class="sxs-lookup"><span data-stu-id="e00a6-125">For example, the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) function takes a key handle for the first parameter.</span></span> <span data-ttu-id="e00a6-126">Si desea que esa función Cifre los datos con un algoritmo de cifrado simétrico como AES, primero debe obtener una clave.</span><span class="sxs-lookup"><span data-stu-id="e00a6-126">If you want that function to encrypt data with a symmetric encryption algorithm such as AES, you must first obtain a key.</span></span> <span data-ttu-id="e00a6-127">La forma de obtener la clave depende del tipo de algoritmo que se use y el origen de la clave.</span><span class="sxs-lookup"><span data-stu-id="e00a6-127">How you obtain the key depends on the type of algorithm being used and the source of the key.</span></span>

<span data-ttu-id="e00a6-128">Puede crear claves efímeras con las funciones [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) y [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) .</span><span class="sxs-lookup"><span data-stu-id="e00a6-128">You can create ephemeral keys with the [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) and [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) functions.</span></span> <span data-ttu-id="e00a6-129">También puede importar claves efímeras de un BLOB en memoria con las funciones [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) y [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) .</span><span class="sxs-lookup"><span data-stu-id="e00a6-129">You can also import ephemeral keys from a memory BLOB with the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) functions.</span></span>

<span data-ttu-id="e00a6-130">En el caso de las claves persistentes, utilice las funciones de almacenamiento de claves para cargar un proveedor de almacenamiento de claves y, a continuación, cree o cargue las claves.</span><span class="sxs-lookup"><span data-stu-id="e00a6-130">For persisted keys, you use the key storage functions to load a key storage provider, and then create or load the keys.</span></span> <span data-ttu-id="e00a6-131">También puede usar estas funciones para crear o cargar claves efímeras pasando **null** para cualquier nombre de contenedor.</span><span class="sxs-lookup"><span data-stu-id="e00a6-131">You can also use these functions to create or load ephemeral keys by passing **NULL** for any container names.</span></span> <span data-ttu-id="e00a6-132">Para obtener más información sobre las funciones de almacenamiento de claves, consulte [funciones de almacenamiento de claves CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="e00a6-132">For more information about the key storage functions, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="performing-cryptographic-operations"></a><span data-ttu-id="e00a6-133">Realización de operaciones criptográficas</span><span class="sxs-lookup"><span data-stu-id="e00a6-133">Performing Cryptographic Operations</span></span>

<span data-ttu-id="e00a6-134">Ahora está listo para realizar la operación criptográfica, como cifrar o descifrar los datos mediante las funciones [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) o [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e00a6-134">You are now ready to perform the cryptographic operation, such as encrypting or decrypting data by using the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) or [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) functions, respectively.</span></span>

## <a name="closing-the-algorithm-provider"></a><span data-ttu-id="e00a6-135">Cerrar el proveedor de algoritmos</span><span class="sxs-lookup"><span data-stu-id="e00a6-135">Closing the Algorithm Provider</span></span>

<span data-ttu-id="e00a6-136">Cuando el proveedor ya no sea necesario, debe pasar el identificador a la función [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) para cerrar el proveedor.</span><span class="sxs-lookup"><span data-stu-id="e00a6-136">When the provider is no longer needed, you must pass the handle to the [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) function to close the provider.</span></span> <span data-ttu-id="e00a6-137">Esto hace que el proveedor libere los recursos asignados para esa instancia del proveedor de algoritmos.</span><span class="sxs-lookup"><span data-stu-id="e00a6-137">This causes the provider to release any resources that have been allocated for that algorithm provider instance.</span></span> <span data-ttu-id="e00a6-138">Una vez cerrado un identificador de proveedor, no se puede volver a usar.</span><span class="sxs-lookup"><span data-stu-id="e00a6-138">After a provider handle is closed, it cannot be reused.</span></span>

<span data-ttu-id="e00a6-139">Cargar un proveedor puede ser un proceso que consume mucho tiempo.</span><span class="sxs-lookup"><span data-stu-id="e00a6-139">Loading a provider can be a relatively time-intensive process.</span></span> <span data-ttu-id="e00a6-140">Por lo tanto, debe almacenar en caché todos los identificadores de proveedor a los que hará referencia varias veces durante la vigencia de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e00a6-140">You should therefore cache any provider handles that you will reference multiple times during the lifetime of your application.</span></span>

## <a name="programming-examples"></a><span data-ttu-id="e00a6-141">Ejemplos de programación</span><span class="sxs-lookup"><span data-stu-id="e00a6-141">Programming Examples</span></span>

<span data-ttu-id="e00a6-142">En los ejemplos siguientes se describe cómo realizar operaciones criptográficas específicas mediante CNG.</span><span class="sxs-lookup"><span data-stu-id="e00a6-142">The following examples describe how to perform specific cryptographic operations using CNG.</span></span>

-   [<span data-ttu-id="e00a6-143">Crear un hash con CNG</span><span class="sxs-lookup"><span data-stu-id="e00a6-143">Creating a Hash with CNG</span></span>](creating-a-hash-with-cng.md)
-   [<span data-ttu-id="e00a6-144">Firmar datos con CNG</span><span class="sxs-lookup"><span data-stu-id="e00a6-144">Signing Data with CNG</span></span>](signing-data-with-cng.md)
-   [<span data-ttu-id="e00a6-145">Cifrar datos con CNG</span><span class="sxs-lookup"><span data-stu-id="e00a6-145">Encrypting Data with CNG</span></span>](encrypting-data-with-cng.md)

 

 



