---
description: Las aplicaciones deben asignar memoria para estos datos; TAPI y el proveedor de servicios proporcionan los datos. Si la operación es asincrónica, los datos no estarán disponibles hasta que el mensaje de respuesta asincrónica indique que el resultado es correcto.
ms.assetid: 61313fe3-74a1-4195-b5af-37463dad02c1
title: Asignación de memoria
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f192e34fdc652293c480277631c3839ecd2435fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105686479"
---
# <a name="memory-allocation"></a><span data-ttu-id="b6a92-104">Asignación de memoria</span><span class="sxs-lookup"><span data-stu-id="b6a92-104">Memory Allocation</span></span>

<span data-ttu-id="b6a92-105">Las aplicaciones deben asignar memoria para estos datos; TAPI y el proveedor de servicios proporcionan los datos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-105">Applications must allocate memory for this data; TAPI and the service provider provide the data.</span></span> <span data-ttu-id="b6a92-106">Si la operación es asincrónica, los datos no estarán disponibles hasta que el mensaje de respuesta asincrónica indique que el resultado es correcto.</span><span class="sxs-lookup"><span data-stu-id="b6a92-106">If the operation is asynchronous, the data is not available until the asynchronous reply message indicates success.</span></span>

<span data-ttu-id="b6a92-107">Todas las estructuras de datos utilizadas para pasar datos entre la aplicación y el TAPI están *acopladas*.</span><span class="sxs-lookup"><span data-stu-id="b6a92-107">All data structures used to pass data between the application and the TAPI are *flattened*.</span></span> <span data-ttu-id="b6a92-108">Es decir, las estructuras de datos no contienen punteros a subestructuras que contienen componentes de datos de tamaño variable.</span><span class="sxs-lookup"><span data-stu-id="b6a92-108">That is, data structures do not contain pointers to substructures that contain variably sized data components.</span></span> <span data-ttu-id="b6a92-109">En su lugar, las estructuras de datos utilizadas para pasar cantidades variables de datos de vuelta a la aplicación deben tener la Metaestructura siguiente:</span><span class="sxs-lookup"><span data-stu-id="b6a92-109">Instead, data structures used to pass variable amounts of data back to the application must have the following metastructure:</span></span>

``` syntax
  DWORD  dwTotalSize;
  DWORD  dwNeededSize;
  DWORD  dwUsedSize; 
    <fixed size fields> 
  DWORD  dw<VarSizeField1>Size;
  DWORD  dw<VarSizeField1>Offset; 
    <fixed size fields> 
  DWORD  dw<VarSizeField2>Size;
  DWORD  dw<VarSizeField2>Offset; 
    <common extensions> 
    <var sized field1> 
    <var sized field2>
```

<span data-ttu-id="b6a92-110">El miembro **dwTotalSize** es el tamaño, en bytes, que se asigna a esta estructura de datos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-110">The **dwTotalSize** member is the size, in bytes, allocated to this data structure.</span></span> <span data-ttu-id="b6a92-111">Marca el final de la estructura de datos y lo establece la aplicación antes de invocar la función que usa esta estructura de datos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-111">It marks the end of the data structure and is set by the application before it invokes the function that uses this data structure.</span></span> <span data-ttu-id="b6a92-112">La función no lee ni escribe más allá de este tamaño.</span><span class="sxs-lookup"><span data-stu-id="b6a92-112">The function does not read or write beyond this size.</span></span> <span data-ttu-id="b6a92-113">Una aplicación debe establecer el miembro **dwTotalSize** para indicar el número total de bytes asignados para que TAPI devuelva el contenido de la estructura.</span><span class="sxs-lookup"><span data-stu-id="b6a92-113">An application must set the **dwTotalSize** member to indicate the total number of bytes allocated for TAPI to return the contents of the structure.</span></span>

<span data-ttu-id="b6a92-114">TAPI rellena el miembro **dwNeededSize** .</span><span class="sxs-lookup"><span data-stu-id="b6a92-114">TAPI fills in the **dwNeededSize** member.</span></span> <span data-ttu-id="b6a92-115">Indica el número de bytes necesarios para devolver todos los datos solicitados.</span><span class="sxs-lookup"><span data-stu-id="b6a92-115">It indicates how many bytes are required to return all the requested data.</span></span> <span data-ttu-id="b6a92-116">La existencia de campos de tamaño de variable a menudo hace que la aplicación pueda calcular el tamaño de la estructura de datos necesario para asignar.</span><span class="sxs-lookup"><span data-stu-id="b6a92-116">The existence of variably sized fields often makes it impossible for the application to estimate the data structure size required to allocate.</span></span> <span data-ttu-id="b6a92-117">Este campo devuelve el número de bytes realmente necesarios para los datos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-117">This field returns the number of bytes actually required for the data.</span></span> <span data-ttu-id="b6a92-118">Este número puede ser menor que, igual o mayor que **dwTotalSize**, e incluye espacio para el propio miembro de **dwTotalSize** .</span><span class="sxs-lookup"><span data-stu-id="b6a92-118">This number could be smaller than, equal to, or larger than **dwTotalSize**, and it includes space for the **dwTotalSize** member itself.</span></span> <span data-ttu-id="b6a92-119">Si es mayor, la estructura devuelta solo se rellena parcialmente.</span><span class="sxs-lookup"><span data-stu-id="b6a92-119">If larger, the returned structure is only partially filled.</span></span> <span data-ttu-id="b6a92-120">Si los campos que requiere la aplicación están disponibles en la estructura parcial, no se debe hacer nada más.</span><span class="sxs-lookup"><span data-stu-id="b6a92-120">If the fields the application requires are available in the partial structure, nothing else must be done.</span></span> <span data-ttu-id="b6a92-121">De lo contrario, la aplicación debe asignar al menos el tamaño de **dwNeededSize** y volver a invocar la función.</span><span class="sxs-lookup"><span data-stu-id="b6a92-121">Otherwise, the application should allocate a structure at least the size of **dwNeededSize** and invoke the function again.</span></span> <span data-ttu-id="b6a92-122">Normalmente, hay suficiente espacio disponible esta vez para devolver toda la información, aunque es posible que el tamaño pueda haber aumentado de nuevo.</span><span class="sxs-lookup"><span data-stu-id="b6a92-122">Usually, enough space is available this time to return all the information, although it is possible the size could have increased again.</span></span>

<span data-ttu-id="b6a92-123">TAPI rellena el miembro **dwUsedSize** si devuelve datos a la aplicación para indicar el tamaño real, en bytes, de la parte de la estructura de datos que contiene datos útiles.</span><span class="sxs-lookup"><span data-stu-id="b6a92-123">TAPI fills the **dwUsedSize** member if it returns data to the application to indicate the actual size, in bytes, of the portion of the data structure that contains useful data.</span></span> <span data-ttu-id="b6a92-124">Si, por ejemplo, una estructura que se asignó era demasiado pequeña y el campo truncado es un campo de tamaño de variable, **dwNeededSize** es mayor que **dwTotalSize** y el campo truncado se deja vacío.</span><span class="sxs-lookup"><span data-stu-id="b6a92-124">If, for example, a structure that was allocated was too small and the truncated field is a variably sized field, **dwNeededSize** is larger than **dwTotalSize**, and the truncated field is left empty.</span></span> <span data-ttu-id="b6a92-125">Por lo tanto, el miembro **dwUsedSize** podría ser menor que **dwTotalSize**.</span><span class="sxs-lookup"><span data-stu-id="b6a92-125">The **dwUsedSize** member could therefore be smaller than **dwTotalSize**.</span></span> <span data-ttu-id="b6a92-126">No se devuelven los valores de campo parciales.</span><span class="sxs-lookup"><span data-stu-id="b6a92-126">Partial field values are not returned.</span></span>

<span data-ttu-id="b6a92-127">El siguiente encabezado es la parte fija de la estructura de datos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-127">Following this header is the fixed part of the data structure.</span></span> <span data-ttu-id="b6a92-128">Contiene los campos normales y los pares de tamaño y desplazamiento que describen los campos de tamaño de variable reales.</span><span class="sxs-lookup"><span data-stu-id="b6a92-128">It contains regular fields and size/offset pairs that describe the actual variably sized fields.</span></span> <span data-ttu-id="b6a92-129">El campo desplazamiento contiene el desplazamiento en bytes del campo tamaño de variable desde el principio del registro.</span><span class="sxs-lookup"><span data-stu-id="b6a92-129">The offset field contains the offset in bytes of the variably sized field from the beginning of the record.</span></span> <span data-ttu-id="b6a92-130">El campo tamaño contiene el tamaño en bytes del campo tamaño de variable.</span><span class="sxs-lookup"><span data-stu-id="b6a92-130">The size field contains the size in bytes of the variably sized field.</span></span> <span data-ttu-id="b6a92-131">Si un campo de tamaño de variable está vacío, el campo de tamaño es cero y el desplazamiento se establece en cero.</span><span class="sxs-lookup"><span data-stu-id="b6a92-131">If a variably sized field is empty, then the size field is zero and the offset is set to zero.</span></span> <span data-ttu-id="b6a92-132">Los campos de tamaño de variable que se truncarían si el tamaño total de la estructura no es suficiente se dejan vacíos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-132">Variably sized fields that would be truncated if the total structure size is insufficient are left empty.</span></span> <span data-ttu-id="b6a92-133">Es decir, su campo size se establece en cero y el desplazamiento se establece en cero.</span><span class="sxs-lookup"><span data-stu-id="b6a92-133">That is, their size field is set to zero and the offset is set to zero.</span></span> <span data-ttu-id="b6a92-134">Los campos de tamaño de variable siguen los campos fijos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-134">The variably sized fields follow the fixed fields.</span></span>

<span data-ttu-id="b6a92-135">Si el proveedor de servicios debe rellenar un miembro de variable, TAPI inicializa el tamaño y los miembros de desplazamiento correspondientes en cero.</span><span class="sxs-lookup"><span data-stu-id="b6a92-135">If the service provider must fill a variable member, TAPI initializes the corresponding size and offset members to zero.</span></span> <span data-ttu-id="b6a92-136">Si el proveedor de servicios rellena el miembro de variable, debe establecer el tamaño y los miembros de desplazamiento correspondientes en los valores adecuados, incluidos **dwUsedSize** y **dwNeededSize** si establece miembros de variable.</span><span class="sxs-lookup"><span data-stu-id="b6a92-136">If the service provider fills in the variable member, it must set the corresponding size and offset members to appropriate values, including **dwUsedSize** and **dwNeededSize** if it sets variable members.</span></span> <span data-ttu-id="b6a92-137">El proveedor de servicios no debe truncar un miembro de variable para que quepa en el espacio disponible.</span><span class="sxs-lookup"><span data-stu-id="b6a92-137">The service provider must not truncate a variable member to make it fit into the available space.</span></span>

<span data-ttu-id="b6a92-138">El proveedor de servicios debe iniciar los miembros de variable inmediatamente después de los miembros fijos de la estructura y dejar cualquier espacio adicional al final de la memoria asignada para que TAPI pueda usarlo para los miembros de longitud variable.</span><span class="sxs-lookup"><span data-stu-id="b6a92-138">The service provider must start variable members immediately after the fixed members of the structure, and leave any extra space at the end of the allocated memory so that TAPI can use it for the variable-length members.</span></span> <span data-ttu-id="b6a92-139">Puede colocar los miembros de variable en cualquier orden, pero los miembros deben ser contiguos.</span><span class="sxs-lookup"><span data-stu-id="b6a92-139">It can place the variable members in any order, but the members must be contiguous.</span></span>

 

 



