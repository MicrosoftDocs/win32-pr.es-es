---
description: La API de distribución del mismo nivel, que admite la característica de la caché de rama en Windows 7, Windows Server 2008 R2, Windows 8 y Windows Server 2012 ofrecen un conjunto de API de plataforma que pueden aumentar la capacidad de respuesta de la red de las aplicaciones centralizadas cuando se tiene acceso desde las oficinas remotas y como ayuda para reducir la utilización general de la red de área extensa
ms.assetid: feb9666e-563a-49f4-ad1c-f166a0faff31
title: Acerca de la distribución del mismo nivel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b5b9a99a65ea2cfda6dc8ad9accd4d881529e87
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909798"
---
# <a name="about-peer-distribution"></a><span data-ttu-id="3b56e-103">Acerca de la distribución del mismo nivel</span><span class="sxs-lookup"><span data-stu-id="3b56e-103">About Peer Distribution</span></span>

<span data-ttu-id="3b56e-104">La API de distribución del mismo nivel, que admite la característica de la caché de rama en Windows 7, Windows Server 2008 R2, Windows 8 y Windows Server 2012 ofrecen un conjunto de API de plataforma que pueden aumentar la capacidad de respuesta de la red de las aplicaciones centralizadas cuando se tiene acceso desde las oficinas remotas y como ayuda para reducir la utilización general de la red de área extensa</span><span class="sxs-lookup"><span data-stu-id="3b56e-104">The Peer Distribution API, which supports the Branch Cache feature in Windows 7, Windows Server 2008 R2, Windows 8, and Windows Server 2012 offers a set of platform APIs that can increase network responsiveness of centralized applications when accessed from remote offices and aid in reducing overall wide area network (WAN) utilization without interfering with the network security technologies.</span></span>

<span data-ttu-id="3b56e-105">El sistema de distribución del mismo nivel ofrece un conjunto de API de plataforma que usan tanto los publicadores que proporcionan contenido digital como los consumidores que lo solicitan.</span><span class="sxs-lookup"><span data-stu-id="3b56e-105">The Peer Distribution system offers a set of platform APIs utilized by both the publishers that provide digital content and consumers that request it.</span></span> <span data-ttu-id="3b56e-106">Para diferenciar fácilmente estos roles, puede ser más fácil pensar en el publicador en un rol de servidor y en el consumidor en un rol de cliente.</span><span class="sxs-lookup"><span data-stu-id="3b56e-106">To easily differentiate these roles, it may be easier to think of the publisher in a server role and the consumer in a client role.</span></span> <span data-ttu-id="3b56e-107">Además, es importante recordar que, aparte de estos roles conceptuales, el servicio de distribución del mismo nivel es un sistema del mismo nivel, como se indica en la capacidad de cualquier nodo de distribución del mismo nivel para publicar y consumir contenido digital.</span><span class="sxs-lookup"><span data-stu-id="3b56e-107">That aside, it is important to remember that aside from these conceptual roles, the Peer Distribution service is a true peer system, as indicated by the ability for any Peer Distribution node to both publish and consume digital content.</span></span> <span data-ttu-id="3b56e-108">Las API de la plataforma de distribución del mismo nivel se exponen a los publicadores y consumidores mediante una biblioteca de importación de Win32 (**PeerDist. lib**).</span><span class="sxs-lookup"><span data-stu-id="3b56e-108">The Peer Distribution platform APIs are exposed to publishers and consumers by a Win32 import library (**PeerDist.Lib**).</span></span>

<span data-ttu-id="3b56e-109">El ciclo de vida del contenido proporcionado por un publicador y recuperado por un consumidor con el servicio de distribución del mismo nivel se compone de las siguientes operaciones:</span><span class="sxs-lookup"><span data-stu-id="3b56e-109">The lifecycle of content supplied by a publisher and retrieved by a consumer with the Peer Distribution service is composed of the following operations:</span></span>



|                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3b56e-110">**Publicación de contenido**</span><span class="sxs-lookup"><span data-stu-id="3b56e-110">**Content Publication**</span></span> | <span data-ttu-id="3b56e-111">La publicación se realiza para generar una descripción de la **información** de contenido con términos de contenido, o información de **contenido** para abreviar.</span><span class="sxs-lookup"><span data-stu-id="3b56e-111">Publishing is done to produce a description of content termed **Content Information**, or **Content Info** for short.</span></span> <span data-ttu-id="3b56e-112">Esta información de contenido puede ser utilizada por una instancia del servicio de distribución del mismo nivel para autenticar y volver a generar el contenido.</span><span class="sxs-lookup"><span data-stu-id="3b56e-112">This Content Info can then be used by an instance of the Peer Distribution service to authenticate and rebuild the content.</span></span> <span data-ttu-id="3b56e-113">Cuando una aplicación publica el contenido en el servicio de distribución del mismo nivel, que es conceptualmente una operación del lado servidor, el contenido se asocia con la identidad del publicador, que se basa en el SID del usuario asociado al token de acceso del subproceso.</span><span class="sxs-lookup"><span data-stu-id="3b56e-113">When content is published by an application into the Peer Distribution service, which is conceptually a server-side operation, that content becomes associated with the Publisher Identity, which is based on the SID of the user associated with the thread access token.</span></span> <span data-ttu-id="3b56e-114">Este enlace se realiza para limitar el acceso al contenido por parte de entidades no autorizadas.</span><span class="sxs-lookup"><span data-stu-id="3b56e-114">This binding is done to limit access to content by unauthorized entities.</span></span> <span data-ttu-id="3b56e-115">Sin embargo, es importante tener en cuenta que el acceso a la información de contenido es equivalente a acceder al contenido en sí, ya que la información de contenido puede usarse para obtener el contenido de los elementos del mismo nivel o de una caché hospedada.</span><span class="sxs-lookup"><span data-stu-id="3b56e-115">However, it is important to note that access to the content information is equivalent to access to the content itself, as the content information can be used to obtain the content from peers or a hosted cache.</span></span><br/> <span data-ttu-id="3b56e-116">Hay una nueva versión de la estructura de datos de información de contenido en Windows 8. sin embargo, todavía se admite la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="3b56e-116">There is a new version of the content information data structure in Windows 8; however, the previous version is still supported.</span></span> <span data-ttu-id="3b56e-117">Para interoperar con los clientes de Windows 7, un administrador puede configurar el servicio de distribución del mismo nivel para usar la versión anterior de la estructura de datos de información de contenido.</span><span class="sxs-lookup"><span data-stu-id="3b56e-117">To interoperate with Windows 7 clients, an administrator may configure the Peer Distribution service to use the previous version of the content information data structure.</span></span><br/> |
| <span data-ttu-id="3b56e-118">**Recuperación de contenido**</span><span class="sxs-lookup"><span data-stu-id="3b56e-118">**Content Retrieval**</span></span>   | <span data-ttu-id="3b56e-119">Para que un consumidor recupere contenido del servicio de distribución del mismo nivel, se debe proporcionar acceso a la información de contenido publicada asociada a ese contenido.</span><span class="sxs-lookup"><span data-stu-id="3b56e-119">For a consumer to retrieve content from the Peer Distribution service, access must be provided to the published Content Info associated with that content.</span></span> <span data-ttu-id="3b56e-120">El servicio de distribución del mismo nivel que se usa para publicar el contenido puede proporcionar la información de contenido asociada.</span><span class="sxs-lookup"><span data-stu-id="3b56e-120">The Peer Distribution service used to publish the content can provide the associated Content Info.</span></span> <span data-ttu-id="3b56e-121">Una vez que el consumidor tiene la información de contenido, se pueden usar otras API de distribución del mismo nivel para solicitar contenido del servicio de distribución del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="3b56e-121">Once the consumer has the Content Info, other Peer Distribution APIs can be used to request content from the Peer Distribution service.</span></span> <span data-ttu-id="3b56e-122">El servicio de distribución del mismo nivel intentará recuperar el contenido de la red local.</span><span class="sxs-lookup"><span data-stu-id="3b56e-122">The Peer Distribution service will attempt to retrieve the content from the local network.</span></span> <span data-ttu-id="3b56e-123">Si el contenido no está disponible, la aplicación cliente es responsable de recuperar el contenido del servidor de origen.</span><span class="sxs-lookup"><span data-stu-id="3b56e-123">If the content is not available, the client application is responsible for retrieving the content from the source server.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="3b56e-124">**Eliminación de publicaciones**</span><span class="sxs-lookup"><span data-stu-id="3b56e-124">**Publication Removal**</span></span> | <span data-ttu-id="3b56e-125">En el caso de las aplicaciones que han publicado contenido en el servicio de distribución del mismo nivel, se ha proporcionado la función [**PeerDistServerUnpublish**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) para permitir que el contenido no se publique.</span><span class="sxs-lookup"><span data-stu-id="3b56e-125">For applications that have published content into the Peer Distribution service, the [**PeerDistServerUnpublish**](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverunpublish) function has been provided to allow content to be unpublished.</span></span> <span data-ttu-id="3b56e-126">Una vez que se ha anulado la publicación del contenido, el servicio de distribución del mismo nivel local ya no proporcionará la información de contenido asociada a ese contenido.</span><span class="sxs-lookup"><span data-stu-id="3b56e-126">Once content has been unpublished, the local Peer Distribution service will no longer provide the content info associated with that content.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |



 

## <a name="asynchronous-completions"></a><span data-ttu-id="3b56e-127">Finalizaciones asincrónicas</span><span class="sxs-lookup"><span data-stu-id="3b56e-127">Asynchronous Completions</span></span>

<span data-ttu-id="3b56e-128">La API de distribución del mismo nivel admite un modelo de API asincrónica y, como resultado, las API de distribución del mismo nivel permiten el uso de eventos o puertos de finalización de e/s como mecanismos de señalización para procesar las finalizaciones asincrónicas de la operación de distribución del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="3b56e-128">The Peer Distribution API supports an asynchronous API model, and as a result Peer Distribution APIs allow for the use of either I/O Completion Ports or Events as the signaling mechanisms for processing asynchronous Peer Distribution operation completions.</span></span> <span data-ttu-id="3b56e-129">En ambos mecanismos, la distribución del mismo nivel utiliza una estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="3b56e-129">For either mechanism, Peer Distribution uses an [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="3b56e-130">En general, la distribución del mismo nivel toma la propiedad de una estructura **superpuesta** y los parámetros out que el cliente pasa a las funciones de API asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="3b56e-130">In general, Peer Distribution takes the ownership of an **OVERLAPPED** structure and any out parameters that the Client passes to asynchronous API functions.</span></span> <span data-ttu-id="3b56e-131">El cliente no debe tener acceso a estos recursos hasta que se complete la función asincrónica concreta.</span><span class="sxs-lookup"><span data-stu-id="3b56e-131">The Client must not access these resources until the particular asynchronous function completes.</span></span> <span data-ttu-id="3b56e-132">En cuanto se completen las funciones asincrónicas, el servicio de distribución del mismo nivel ya no necesitará acceso a estos recursos y se pueden volver a usar cuando la aplicación que realiza la llamada sea apta.</span><span class="sxs-lookup"><span data-stu-id="3b56e-132">As soon as the asynchronous functions completes, the Peer Distribution service will no longer require access to these resources and they may be reused as the calling application sees fit.</span></span>

<span data-ttu-id="3b56e-133">No habrá ninguna finalización asincrónica si la función devuelve un código de error distinto del **error de \_ e/s \_ pendiente**.</span><span class="sxs-lookup"><span data-stu-id="3b56e-133">There will not be any asynchronous completion if the function returns any error code other than **ERROR\_IO\_PENDING**.</span></span> <span data-ttu-id="3b56e-134">La devolución de un valor distinto del **error de \_ e/s \_ pendiente** significa que la llamada no se ha realizado de forma sincrónica.</span><span class="sxs-lookup"><span data-stu-id="3b56e-134">The return of a value other than **ERROR\_IO\_PENDING** means that the call has failed synchronously.</span></span> <span data-ttu-id="3b56e-135">Si la API de distribución del mismo nivel devuelve un **error de \_ e/s \_ pendiente**, el autor de la llamada debe esperar la finalización asincrónica.</span><span class="sxs-lookup"><span data-stu-id="3b56e-135">If the Peer Distribution API returns **ERROR\_IO\_PENDING**, the caller must wait for asynchronous completion.</span></span>

<span data-ttu-id="3b56e-136">El código de error de la finalización asincrónica se puede recuperar de una de estas dos maneras:</span><span class="sxs-lookup"><span data-stu-id="3b56e-136">The error code of the asynchronous completion can be retrieved in one of two ways:</span></span>

<span data-ttu-id="3b56e-137">**Finalización basada en Puerto de finalización de e/s**</span><span class="sxs-lookup"><span data-stu-id="3b56e-137">**I/O Completion Port Based Completion**</span></span>

<span data-ttu-id="3b56e-138">El usuario invoca el mecanismo de puertos de finalización de e/s proporcionando un identificador de puerto de finalización y una clave de finalización a las siguientes funciones de API:</span><span class="sxs-lookup"><span data-stu-id="3b56e-138">User invokes the I/O completion port mechanism by providing a completion port handle and completion key to the following API functions:</span></span>

<dl>

[<span data-ttu-id="3b56e-139">**PeerDistRegisterForStatusChangeNotification**</span><span class="sxs-lookup"><span data-stu-id="3b56e-139">**PeerDistRegisterForStatusChangeNotification**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistregisterforstatuschangenotification)  
[<span data-ttu-id="3b56e-140">**PeerDistServerPublishStream**</span><span class="sxs-lookup"><span data-stu-id="3b56e-140">**PeerDistServerPublishStream**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserverpublishstream)  
[<span data-ttu-id="3b56e-141">**PeerDistServerOpenContentInformation**</span><span class="sxs-lookup"><span data-stu-id="3b56e-141">**PeerDistServerOpenContentInformation**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistserveropencontentinformation)  
[<span data-ttu-id="3b56e-142">**PeerDistClientOpenContent**</span><span class="sxs-lookup"><span data-stu-id="3b56e-142">**PeerDistClientOpenContent**</span></span>](/windows/desktop/api/PeerDist/nf-peerdist-peerdistclientopencontent)  
</dl>

<span data-ttu-id="3b56e-143">El usuario crea un puerto de finalización mediante una llamada a [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport).</span><span class="sxs-lookup"><span data-stu-id="3b56e-143">The User creates a completion port by calling [**CreateIoCompletionPort**](/windows/desktop/FileIO/createiocompletionport).</span></span> <span data-ttu-id="3b56e-144">Este identificador de puerto de finalización se puede usar simultáneamente para otras operaciones de e/s asincrónicas, así como operaciones específicas de distribución del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="3b56e-144">This completion port handle can be simultaneously used for other asynchronous I/O operations as well as Peer Distribution specific operations.</span></span>

<span data-ttu-id="3b56e-145">El autor de la llamada debe usar la función [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) para administrar la finalización asincrónica.</span><span class="sxs-lookup"><span data-stu-id="3b56e-145">The caller should use [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to manage asynchronous completion.</span></span> <span data-ttu-id="3b56e-146">Si se produce un error en la operación asincrónica, la función **GetQueuedCompletionStatus** devolverá **false** y [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) devolverá el código de error correspondiente.</span><span class="sxs-lookup"><span data-stu-id="3b56e-146">If the asynchronous operation fails the **GetQueuedCompletionStatus** function will return **FALSE** and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) will return the appropriate error code.</span></span> <span data-ttu-id="3b56e-147">El autor de la llamada debe omitir todos los campos de la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) si el código de error no es **\_ correcto**.</span><span class="sxs-lookup"><span data-stu-id="3b56e-147">The caller should ignore all the fields of the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure if the error code is anything other than **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="3b56e-148">La operación asincrónica se realiza correctamente si la función **GetQueuedCompletionStatus** devuelve **true**.</span><span class="sxs-lookup"><span data-stu-id="3b56e-148">The asynchronous operation succeeds if the **GetQueuedCompletionStatus** function returns **TRUE**.</span></span>

<span data-ttu-id="3b56e-149">Para obtener más información [, vea puertos de finalización de e/s](/windows/desktop/FileIO/i-o-completion-ports).</span><span class="sxs-lookup"><span data-stu-id="3b56e-149">For more information see [I/O Completion Ports](/windows/desktop/FileIO/i-o-completion-ports).</span></span>

<span data-ttu-id="3b56e-150">**Finalización basada en eventos**</span><span class="sxs-lookup"><span data-stu-id="3b56e-150">**Event Based Completion**</span></span>

<span data-ttu-id="3b56e-151">Si el autor de la llamada establece un identificador de evento válido para el campo *hEvent* de la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) , la distribución del mismo nivel lo usa para indicar que se ha completado la operación de e/s asincrónica asociada.</span><span class="sxs-lookup"><span data-stu-id="3b56e-151">If the caller sets a valid Event handle to the *hEvent* field of [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure, Peer Distribution uses it to signal that the associated asynchronous I/O operation has completed.</span></span>

<span data-ttu-id="3b56e-152">Un llamador de subproceso puede administrar las operaciones superpuestas especificando un identificador para el objeto de evento de restablecimiento manual de la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) en una de las funciones de espera.</span><span class="sxs-lookup"><span data-stu-id="3b56e-152">A thread caller can manage overlapped operations by specifying a handle to the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure's manual-reset event object in one of the wait functions.</span></span> <span data-ttu-id="3b56e-153">Una vez señalado el evento, el llamador debe llamar a [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) pasando la estructura **superpuesta** adecuada.</span><span class="sxs-lookup"><span data-stu-id="3b56e-153">After the Event is signaled the caller must call [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**) passing in the appropriate **OVERLAPPED** structure.</span></span> <span data-ttu-id="3b56e-154">**PeerGetOverlappedResult** devolverá **false** y el llamador debe llamar a [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) para recuperar el código de error.</span><span class="sxs-lookup"><span data-stu-id="3b56e-154">**PeerGetOverlappedResult** will return **FALSE** and the caller must call [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) in order to retrieve the error code.</span></span> <span data-ttu-id="3b56e-155">El autor de la llamada debe omitir todos los campos de la estructura **superpuesta** si el código de error no es **\_ correcto**.</span><span class="sxs-lookup"><span data-stu-id="3b56e-155">The caller should ignore all the fields of the **OVERLAPPED** structure if the error code is anything other than **ERROR\_SUCCESS**.</span></span> <span data-ttu-id="3b56e-156">La operación asincrónica se realiza correctamente si la función **PeerGetOverlappedResult** devuelve **true**.</span><span class="sxs-lookup"><span data-stu-id="3b56e-156">The asynchronous operation succeeds if the **PeerGetOverlappedResult** function returns **TRUE**.</span></span>

<span data-ttu-id="3b56e-157">Si el autor de la llamada proporciona un puerto de finalización junto con un evento, el evento se usará como mecanismo de finalización.</span><span class="sxs-lookup"><span data-stu-id="3b56e-157">If the caller provides a completion port along with an event, the event will be used as the completion mechanism.</span></span>

<span data-ttu-id="3b56e-158">**Windows 7:** Use la función [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) en lugar de [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**).</span><span class="sxs-lookup"><span data-stu-id="3b56e-158">**Windows 7:** Use the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function instead of [**PeerGetOverlappedResult**](https://www.bing.com/search?q=**PeerGetOverlappedResult**).</span></span>

## <a name="related-topics"></a><span data-ttu-id="3b56e-159">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="3b56e-159">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3b56e-160">Referencia de la API de distribución del mismo nivel</span><span class="sxs-lookup"><span data-stu-id="3b56e-160">Peer Distribution API Reference</span></span>](peer-distribution-api-reference.md)
</dt> </dl>

 

