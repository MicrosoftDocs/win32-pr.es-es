---
description: El primer paso para asignar un archivo es abrir el archivo llamando a la función CreateFile.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Crear un objeto de asignación de archivos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 65badc2af8aed5211c2f5c590fc0998019dae264
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104360672"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="fb9f6-103">Crear un objeto de asignación de archivos</span><span class="sxs-lookup"><span data-stu-id="fb9f6-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="fb9f6-104">El primer paso para asignar un archivo es abrir el archivo llamando a la función [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="fb9f6-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="fb9f6-105">Para asegurarse de que otros procesos no pueden escribir en la parte del archivo que está asignada, debe abrir el archivo con acceso exclusivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="fb9f6-106">Además, el identificador de archivo debe permanecer abierto hasta que el proceso ya no necesite el objeto de asignación de archivos.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="fb9f6-107">Una manera sencilla de obtener acceso exclusivo es especificar cero en el parámetro *fdwShareMode* de **CreateFile**.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="fb9f6-108">La función [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) usa el identificador devuelto por **CreateFile** para crear un objeto de asignación de archivos.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="fb9f6-109">La función [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) devuelve un identificador al objeto de asignación de archivos.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="fb9f6-110">Este identificador se usará al [crear una vista de archivo](creating-a-file-view.md) para que pueda tener acceso a la memoria compartida.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="fb9f6-111">Cuando se llama a **CreateFileMapping**, se especifica un nombre de objeto, el número de bytes que se van a asignar desde el archivo y el permiso de lectura y escritura para la memoria asignada.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="fb9f6-112">El primer proceso que llama a **CreateFileMapping** crea el objeto de asignación de archivos.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="fb9f6-113">Los procesos que llaman a **CreateFileMapping** para un objeto existente reciben un identificador del objeto existente.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="fb9f6-114">Puede saber si una llamada correcta a **CreateFileMapping** ha creado o abierto el objeto de asignación de archivos mediante una llamada a la función [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="fb9f6-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="fb9f6-115">**GetLastError** **no devuelve ningún \_ error** en el proceso de creación y el **error \_ ya \_ existe** en los procesos posteriores.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="fb9f6-116">Se produce un error en la función [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) si las marcas de acceso entran en conflicto con las especificadas cuando la función [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) abrió el archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="fb9f6-117">Por ejemplo, para leer y escribir en el archivo:</span><span class="sxs-lookup"><span data-stu-id="fb9f6-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="fb9f6-118">Especifique los valores **genéricos de \_ lectura** y **\_ escritura** genéricos en el parámetro *fdwAccess* de [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="fb9f6-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="fb9f6-119">Especifique el **valor \_ ReadWrite** de la página en el parámetro *fdwProtect* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span><span class="sxs-lookup"><span data-stu-id="fb9f6-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="fb9f6-120">La creación de un objeto de asignación de archivos no confirma la memoria física, solo lo reserva.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="fb9f6-121">Tamaño de asignación de archivos</span><span class="sxs-lookup"><span data-stu-id="fb9f6-121">File Mapping Size</span></span>

<span data-ttu-id="fb9f6-122">El tamaño del objeto de asignación de archivos es independiente del tamaño del archivo que se está asignando.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="fb9f6-123">Sin embargo, si el objeto de asignación de archivos es mayor que el archivo, el sistema expande el archivo antes de que se devuelva [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .</span><span class="sxs-lookup"><span data-stu-id="fb9f6-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="fb9f6-124">Si el objeto de asignación de archivos es menor que el archivo, el sistema asigna solo el número especificado de bytes del archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="fb9f6-125">Los parámetros *dwMaximumSizeHigh* y *dwMaximumSizeLow* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) permiten especificar el número de bytes que se van a asignar desde el archivo:</span><span class="sxs-lookup"><span data-stu-id="fb9f6-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="fb9f6-126">Si no desea que cambie el tamaño del archivo (por ejemplo, al asignar archivos de solo lectura), llame a [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) y especifique cero para *dwMaximumSizeHigh* y *dwMaximumSizeLow*.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="fb9f6-127">Al hacerlo, se crea un objeto de asignación de archivos que tiene exactamente el mismo tamaño que el archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="fb9f6-128">De lo contrario, debe calcular o calcular el tamaño del archivo terminado, ya que los objetos de asignación de archivos tienen un tamaño estático. una vez creado, su tamaño no se puede aumentar ni disminuir.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="fb9f6-129">Un intento de asignar un archivo con una longitud de cero de esta manera produce un error con un código de error de **\_ archivo \_ no válido**.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="fb9f6-130">Los programas deben probar los archivos con una longitud de cero y rechazarlos.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="fb9f6-131">El tamaño de un objeto de asignación de archivos respaldado por un archivo con nombre está limitado por el espacio en disco.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="fb9f6-132">El tamaño de una vista de archivo se limita al bloque contiguo más grande disponible de la memoria virtual sin reservar.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="fb9f6-133">Esto es como máximo 2 GB menos la memoria virtual ya reservada por el proceso.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="fb9f6-134">El tamaño del objeto de asignación de archivos que seleccione controla la distancia que se puede ver con la asignación de memoria en el archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="fb9f6-135">Si crea un objeto de asignación de archivos de 500 KB de tamaño, solo tendrá acceso a los primeros 500 KB del archivo, independientemente del tamaño del archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="fb9f6-136">Dado que no le cuesta ningún recurso del sistema para crear un objeto de asignación de archivos más grande, cree un objeto de asignación de archivos que sea el tamaño del archivo (establezca los parámetros *dwMaximumSizeHigh* y *dwMaximumSizeLow* de [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) ambos en cero) incluso si no espera ver todo el archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="fb9f6-137">El costo de los recursos del sistema se obtiene al crear las vistas y acceder a ellas.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="fb9f6-138">Si desea ver una parte del archivo que no comienza al principio del archivo, debe crear un objeto de asignación de archivos.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-138">If you want to view a portion of the file that does not start at the beginning of the file, you must create a file mapping object.</span></span> <span data-ttu-id="fb9f6-139">Este objeto es el tamaño de la parte del archivo que desea ver y el desplazamiento en el archivo.</span><span class="sxs-lookup"><span data-stu-id="fb9f6-139">This object is the size of the portion of the file that you want to view plus the offset into the file.</span></span>

## <a name="related-topics"></a><span data-ttu-id="fb9f6-140">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="fb9f6-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fb9f6-141">Crear una vista dentro de un archivo</span><span class="sxs-lookup"><span data-stu-id="fb9f6-141">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
