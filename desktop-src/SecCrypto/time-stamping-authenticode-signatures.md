---
description: La marca de tiempo de Authenticode se basa en \# Contrafirmas estándar PKCS 9. Las herramientas de firma de Microsoft permiten a los desarrolladores adjuntar marcas de tiempo al mismo tiempo que colocan firmas Authenticode.
ms.assetid: d0bd3e2f-1eee-4f71-9467-974994f720d5
title: Marcas de tiempo de las firmas de Authenticode
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3631d402da56d4078cecce65075c92dff0ec7e1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104277004"
---
# <a name="time-stamping-authenticode-signatures"></a><span data-ttu-id="af770-104">Marcas de tiempo de las firmas de Authenticode</span><span class="sxs-lookup"><span data-stu-id="af770-104">Time Stamping Authenticode Signatures</span></span>

<span data-ttu-id="af770-105">Las firmas de Microsoft Authenticode proporcionan garantías de integridad y de creación de datos binarios.</span><span class="sxs-lookup"><span data-stu-id="af770-105">Microsoft Authenticode signatures provide authorship and integrity guarantees for binary data.</span></span> <span data-ttu-id="af770-106">La marca de tiempo de Authenticode se basa en \# Contrafirmas estándar PKCS 9.</span><span class="sxs-lookup"><span data-stu-id="af770-106">Authenticode time stamping is based on standard PKCS \#9 countersignatures.</span></span> <span data-ttu-id="af770-107">Las herramientas de firma de Microsoft permiten a los desarrolladores adjuntar marcas de tiempo al mismo tiempo que colocan firmas Authenticode.</span><span class="sxs-lookup"><span data-stu-id="af770-107">Signing tools from Microsoft allow developers to affix time stamps at the same time as they affix Authenticode signatures.</span></span> <span data-ttu-id="af770-108">La marca de tiempo permite que se puedan comprobar las firmas de Authenticode incluso después de que los certificados usados para la firma hayan expirado.</span><span class="sxs-lookup"><span data-stu-id="af770-108">Time stamping allows Authenticode signatures to be verifiable even after the certificates used for signature have expired.</span></span>

## <a name="a-brief-introduction-to-authenticode"></a><span data-ttu-id="af770-109">Breve introducción a Authenticode</span><span class="sxs-lookup"><span data-stu-id="af770-109">A Brief Introduction to Authenticode</span></span>

<span data-ttu-id="af770-110">[*Authenticode*](../secgloss/a-gly.md) aplica la tecnología de firma digital para garantizar la creación e integridad de datos binarios, como software instalable.</span><span class="sxs-lookup"><span data-stu-id="af770-110">[*Authenticode*](../secgloss/a-gly.md) applies digital signature technology to guarantee the authorship and integrity of binary data such as installable software.</span></span> <span data-ttu-id="af770-111">Un explorador Web del cliente u otros componentes del sistema pueden usar las firmas de Authenticode para comprobar la integridad de los datos cuando se descarga o se instala el software.</span><span class="sxs-lookup"><span data-stu-id="af770-111">A client web browser, or other system components, can use the Authenticode signatures to verify the integrity of the data when the software is downloaded or installed.</span></span> <span data-ttu-id="af770-112">Las firmas de Authenticode se pueden usar con muchos formatos de software, como. cab,. exe,. ocx y. dll.</span><span class="sxs-lookup"><span data-stu-id="af770-112">Authenticode signatures can be used with many software formats, including .cab, .exe, .ocx, and .dll.</span></span>

<span data-ttu-id="af770-113">Microsoft mantiene una lista de [*entidades de certificación*](/security/trusted-root/participants-list) (CA) públicas.</span><span class="sxs-lookup"><span data-stu-id="af770-113">Microsoft maintains a list of public [*certification authorities*](/security/trusted-root/participants-list) (CAs).</span></span> <span data-ttu-id="af770-114">Los emisores de certificados Authenticode incluyen actualmente [SSL.com](https://www.ssl.com/), [DigiCert](https://www.digicert.com/), [Sectigo (comodo)](https://www.sectigo.com/)y [GlobalSign](https://www.globalsign.com/).</span><span class="sxs-lookup"><span data-stu-id="af770-114">Issuers of Authenticode certificates currently include [SSL.com](https://www.ssl.com/), [Digicert](https://www.digicert.com/), [Sectigo(Comodo)](https://www.sectigo.com/), and [GlobalSign](https://www.globalsign.com/).</span></span>

## <a name="about-cryptographic-time-stamping"></a><span data-ttu-id="af770-115">Acerca de la marca de tiempo criptográfica</span><span class="sxs-lookup"><span data-stu-id="af770-115">About Cryptographic Time Stamping</span></span>

<span data-ttu-id="af770-116">En el pasado, se propone una variedad de métodos de marca de tiempo criptográficos.</span><span class="sxs-lookup"><span data-stu-id="af770-116">In the past, a variety of cryptographic time stamping methods have been proposed.</span></span> <span data-ttu-id="af770-117">Consulte, por ejemplo, ha y Stornetta "cómo Time-Stamp un documento digital" en el *diario de Cryptology* (1991) y Benaloh y de Mare "acumuladores unidireccionales: una alternativa descentralizada a las firmas digitales" en las *notas de la Conferencia Springer-Verlag en Computer Science* Vol. 765 (EUROCRYPT ' 93).</span><span class="sxs-lookup"><span data-stu-id="af770-117">See, for example, Haber and Stornetta "How to Time-Stamp a Digital Document" in the *Journal of Cryptology* (1991) and Benaloh and de Mare "One-Way Accumulators: A Decentralized Alternative to Digital Signatures" in *Springer-Verlag Lecture Notes in Computer Science* vol. 765 (EUROCRYPT '93).</span></span> <span data-ttu-id="af770-118">Un resumen extendido de este artículo está disponible en [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span><span class="sxs-lookup"><span data-stu-id="af770-118">An extended abstract of this article is available from [Microsoft Research](https://research.microsoft.com/research/pubs/view.aspx?id=233&type=Publication&0sr=a).</span></span> <span data-ttu-id="af770-119">(Es posible que estos recursos no estén disponibles en algunos idiomas y países o regiones). Dado que la hora es una cantidad física, en lugar de una cantidad matemática, estos métodos suelen preocuparse de cómo vincular objetos para que se pueda determinar su orden de creación o cómo agrupar eficazmente los objetos que se pueden describir tal como se han creado simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="af770-119">(These resources may not be available in some languages and countries or regions.) Because time is a physical, rather than a mathematical, quantity, these methods generally concern how to link objects so that their order of creation can be determined or how to efficiently group objects that can all be described as having been created concurrently.</span></span>

<span data-ttu-id="af770-120">Los sistemas que pretenden autenticar el tiempo como una cantidad siempre requieren algún tipo de confianza.</span><span class="sxs-lookup"><span data-stu-id="af770-120">Systems that purport to authenticate time as a quantity always require some form of trust.</span></span> <span data-ttu-id="af770-121">En una configuración fuertemente adversarial, se pueden usar protocolos complejos para garantizar cierto grado de sincronía.</span><span class="sxs-lookup"><span data-stu-id="af770-121">In a strongly adversarial setting, complex protocols can be used to ensure some degree of synchrony.</span></span> <span data-ttu-id="af770-122">Sin embargo, estos protocolos requieren una interacción extensa entre las partes afectadas.</span><span class="sxs-lookup"><span data-stu-id="af770-122">However, these protocols require extensive interaction between affected parties.</span></span> <span data-ttu-id="af770-123">En la práctica, si solo necesita la certificación del tiempo de una fuente de confianza, el origen puede actuar simplemente como notario si proporciona una instrucción firmada (certificación) en la que se presentó el objeto para la firma en el momento indicado.</span><span class="sxs-lookup"><span data-stu-id="af770-123">In practice, if one only needs certification of time from a trusted source, the source can simply act as a notary by providing a signed statement (certification) that the object was presented for signature at the indicated time.</span></span>

<span data-ttu-id="af770-124">El método de contrafirma de la marca de tiempo que se implementa a continuación permite comprobar las firmas incluso después de que el certificado de firma haya expirado o se haya revocado.</span><span class="sxs-lookup"><span data-stu-id="af770-124">The countersignature method of time stamping implemented below allows for signatures to be verified even after the signing certificate has expired or been revoked.</span></span> <span data-ttu-id="af770-125">La marca de tiempo permite que el comprobador sepa de forma confiable el tiempo que se ha colocado la firma y, por tanto, confía en la firma si era válida en ese momento.</span><span class="sxs-lookup"><span data-stu-id="af770-125">The time stamp allows the verifier to reliably know the time that the signature was affixed and thereby trust the signature if it was valid at that time.</span></span> <span data-ttu-id="af770-126">La hora autor debe tener un origen de hora confiable y protegido.</span><span class="sxs-lookup"><span data-stu-id="af770-126">The time stamper should have a reliable and protected time source.</span></span>

## <a name="pkcs-7-signed-documents-and-countersignatures"></a><span data-ttu-id="af770-127">\#Documentos firmados PKCS 7 y Contrafirmas</span><span class="sxs-lookup"><span data-stu-id="af770-127">PKCS \#7 Signed Documents and Countersignatures</span></span>

<span data-ttu-id="af770-128">PKCS \# 7 es un formato estándar para los datos criptográficos, incluidos los datos firmados, los certificados y [*las listas de revocación de certificados*](../secgloss/c-gly.md) (CRL).</span><span class="sxs-lookup"><span data-stu-id="af770-128">PKCS \#7 is a standard format for cryptographic data, including signed data, certificates, and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs).</span></span> <span data-ttu-id="af770-129">El tipo PKCS \# 7 determinado de interés en el contexto de la marca de tiempo es los datos firmados, correspondientes al \# tipo de contenido [**SignedData**](signeddata.md) definido PKCS 7.</span><span class="sxs-lookup"><span data-stu-id="af770-129">The particular PKCS \#7 type of interest in the context of time stamping is signed data, corresponding to the PKCS \#7 defined [**SignedData**](signeddata.md) content type.</span></span>

<span data-ttu-id="af770-130">El \# paquete PKCS 7 se compone de [**SignedData**](signeddata.md) que identifica el contenido real y determinada información sobre los bloques de firma y SignerInfo.</span><span class="sxs-lookup"><span data-stu-id="af770-130">The PKCS \#7 package consists of [**SignedData**](signeddata.md) that identifies the actual content and certain information about it and SignerInfo signature blocks.</span></span> <span data-ttu-id="af770-131">Un SignerInfo puede contener una contrafirma, que de forma recursiva es otro SignerInfo.</span><span class="sxs-lookup"><span data-stu-id="af770-131">A SignerInfo may itself contain a countersignature, which recursively is another SignerInfo.</span></span> <span data-ttu-id="af770-132">En principio, una secuencia de esas contrafirmaciones puede estar presente.</span><span class="sxs-lookup"><span data-stu-id="af770-132">In principle, a sequence of such countersignatures may be present.</span></span> <span data-ttu-id="af770-133">La contrafirma es un atributo no autenticado con respecto a la firma en el SignerInfo; es decir, se puede colocar después de la firma original.</span><span class="sxs-lookup"><span data-stu-id="af770-133">The countersignature is an unauthenticated attribute with respect to the signature in the SignerInfo; that is, it may be affixed subsequent to the original signature.</span></span> <span data-ttu-id="af770-134">En el formulario de esquema:</span><span class="sxs-lookup"><span data-stu-id="af770-134">In outline form:</span></span>

<span data-ttu-id="af770-135">[**SignedData**](signeddata.md) (PKCS \# 7)</span><span class="sxs-lookup"><span data-stu-id="af770-135">[**SignedData**](signeddata.md) (PKCS \#7)</span></span>

-   <span data-ttu-id="af770-136">Versión (de PKCS \# 7, versión en general 1)</span><span class="sxs-lookup"><span data-stu-id="af770-136">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="af770-137">DigestAlgorithms (colección de todos los algoritmos usados por los bloques de firma de SignerInfo para el procesamiento optimizado)</span><span class="sxs-lookup"><span data-stu-id="af770-137">DigestAlgorithms (collection of all algorithms used by SignerInfo signature blocks, for optimized processing)</span></span>
-   <span data-ttu-id="af770-138">ContentInfo (contentType es igual a [**SignedData**](signeddata.md), más contenido o referencia al contenido)</span><span class="sxs-lookup"><span data-stu-id="af770-138">ContentInfo (contentType equals [**SignedData**](signeddata.md), plus content or reference to content)</span></span>
-   <span data-ttu-id="af770-139">Certificados opcionales (colección de todos los certificados utilizados)</span><span class="sxs-lookup"><span data-stu-id="af770-139">OPTIONAL Certificates (collection of all certificates used)</span></span>
-   <span data-ttu-id="af770-140">CRL opcionales (colección de todas las CRL)</span><span class="sxs-lookup"><span data-stu-id="af770-140">OPTIONAL CRLs (collection of all CRLs)</span></span>
-   <span data-ttu-id="af770-141">SignerInfo bloques de firma (la firma real, formada por uno o varios bloques de firma SignerInfo)</span><span class="sxs-lookup"><span data-stu-id="af770-141">SignerInfo signature blocks (the actual signature, composed of one or more SignerInfo signature blocks)</span></span>

<span data-ttu-id="af770-142">SignerInfo (bloque de firma)</span><span class="sxs-lookup"><span data-stu-id="af770-142">SignerInfo (the signature block)</span></span>

-   <span data-ttu-id="af770-143">Versión (de PKCS \# 7, versión en general 1)</span><span class="sxs-lookup"><span data-stu-id="af770-143">Version (of PKCS \#7, generally version 1)</span></span>
-   <span data-ttu-id="af770-144">Certificado (emisor y número de serie para identificar de forma única el certificado del firmante en [**SignedData**](signeddata.md))</span><span class="sxs-lookup"><span data-stu-id="af770-144">Certificate (issuer and serial number to uniquely identify of signer's certificate in [**SignedData**](signeddata.md))</span></span>
-   <span data-ttu-id="af770-145">DigestAlgorithm más el DigestEncryptionAlgorithm más el resumen (hash), además de EncryptedDigest (firma real)</span><span class="sxs-lookup"><span data-stu-id="af770-145">DigestAlgorithm plus the DigestEncryptionAlgorithm plus the Digest (hash), plus the EncryptedDigest (actual signature)</span></span>
-   <span data-ttu-id="af770-146">AuthenticatedAttributes opcional (por ejemplo, firmado por este firmante)</span><span class="sxs-lookup"><span data-stu-id="af770-146">OPTIONAL AuthenticatedAttributes (for example, signed by this signer)</span></span>
-   <span data-ttu-id="af770-147">UnauthenticatedAttributes opcional (por ejemplo, no firmado por este firmante)</span><span class="sxs-lookup"><span data-stu-id="af770-147">OPTIONAL UnauthenticatedAttributes (for example, not signed by this signer)</span></span>

<span data-ttu-id="af770-148">Un ejemplo de atributo autenticado es la hora de firma (OID 1.2.840.113549.1.9.5) porque forma parte de lo que el servicio de marca de tiempo firma.</span><span class="sxs-lookup"><span data-stu-id="af770-148">An example of an authenticated attribute is the signing time (OID 1.2.840.113549.1.9.5) because it is part of what the time stamp service signs.</span></span> <span data-ttu-id="af770-149">Un ejemplo de atributo no autenticado es la contrafirma (OID 1.2.840.113549.1.9.6) porque se puede colocar después de la firma.</span><span class="sxs-lookup"><span data-stu-id="af770-149">An example of an unauthenticated attribute is the countersignature (OID 1.2.840.113549.1.9.6) because it can be affixed after signing.</span></span> <span data-ttu-id="af770-150">En este caso, el propio SignerInfo contiene un SignerInfo (la contrafirma).</span><span class="sxs-lookup"><span data-stu-id="af770-150">In this case, the SignerInfo itself contains a SignerInfo (the Countersignature).</span></span>

> [!Note]  
> <span data-ttu-id="af770-151">El objeto que está firmado en la contrafirma es la firma original (es decir, el EncryptedDigest de SignerInfo original).</span><span class="sxs-lookup"><span data-stu-id="af770-151">The object that is signed in the countersignature is the original signature (that is, the EncryptedDigest of the original SignerInfo).</span></span>

 

## <a name="signtool-and-the-authenticode-process"></a><span data-ttu-id="af770-152">SignTool y el proceso de Authenticode</span><span class="sxs-lookup"><span data-stu-id="af770-152">SignTool and the Authenticode Process</span></span>

<span data-ttu-id="af770-153">[SignTool](signtool.md) está disponible para la firma y la marca de tiempo de los datos binarios.</span><span class="sxs-lookup"><span data-stu-id="af770-153">[SignTool](signtool.md) is available for Authenticode signing and time stamping binary data.</span></span> <span data-ttu-id="af770-154">La herramienta se instala en la \\ carpeta bin de la ruta de instalación del kit de desarrollo de software (SDK) de Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="af770-154">The tool is installed in the \\Bin folder of the Microsoft Windows Software Development Kit (SDK) installation path.</span></span>

<span data-ttu-id="af770-155">La firma y la marca de tiempo de los datos binarios son relativamente sencillas mediante [SignTool](signtool.md).</span><span class="sxs-lookup"><span data-stu-id="af770-155">Signing and time stamping binary data is relatively straightforward using [SignTool](signtool.md).</span></span> <span data-ttu-id="af770-156">El publicador debe obtener un certificado de firma de código de una entidad de certificación de firma de código comercial.</span><span class="sxs-lookup"><span data-stu-id="af770-156">The publisher must get a code signing certificate from a commercial code signing CA.</span></span> <span data-ttu-id="af770-157">Para mayor comodidad, Microsoft publica y actualiza una lista de entidades de certificación públicas, incluidas las que emiten certificados Authenticode.</span><span class="sxs-lookup"><span data-stu-id="af770-157">For convenience, Microsoft publishes and updates a list of public CAs, including those that issue Authenticode certificates.</span></span> <span data-ttu-id="af770-158">Cuando está listo para publicar, los archivos objeto se firman y se marcan por hora con los parámetros de línea de comandos adecuados con la herramienta SignTool.</span><span class="sxs-lookup"><span data-stu-id="af770-158">When ready to publish, the object files are signed and time stamped using appropriate command line parameters with the SignTool tool.</span></span> <span data-ttu-id="af770-159">El resultado de cualquier operación de SignTool siempre es un \# formato PKCS 7 [**SignedData**](signeddata.md).</span><span class="sxs-lookup"><span data-stu-id="af770-159">The result of any SignTool operation is always a PKCS \#7 format [**SignedData**](signeddata.md).</span></span>

<span data-ttu-id="af770-160">SignTool acepta como entrada datos binarios sin formato que se van a firmar con una marca de tiempo o datos binarios firmados previamente para la marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-160">SignTool accepts as input either raw binary data to be signed and time stamped, or previously signed binary data to be time stamped.</span></span> <span data-ttu-id="af770-161">Los datos que se han firmado anteriormente se pueden marcar con el comando de la marca de tiempo de **SignTool** .</span><span class="sxs-lookup"><span data-stu-id="af770-161">Data that has previously been signed can be time stamped by using the **signtool timestamp** command.</span></span>



| <span data-ttu-id="af770-162">Argumento</span><span class="sxs-lookup"><span data-stu-id="af770-162">Argument</span></span>             | <span data-ttu-id="af770-163">Descripción</span><span class="sxs-lookup"><span data-stu-id="af770-163">Description</span></span>                                                                                                                                                                                                    |
|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="af770-164">**/T** *HTTPAddress*</span><span class="sxs-lookup"><span data-stu-id="af770-164">**/t** *HTTPAddress*</span></span> | <span data-ttu-id="af770-165">Indica que el archivo debe marcarse con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-165">Indicates that the file is to be time stamped.</span></span> <span data-ttu-id="af770-166">Se debe proporcionar una dirección URL que especifique una dirección de un servidor de marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-166">A URL that specifies an address of a time stamping server must be provided.</span></span> <span data-ttu-id="af770-167">**/t** se puede usar con los comandos de **firma de SignTool** y de marca de tiempo de **SignTool** .</span><span class="sxs-lookup"><span data-stu-id="af770-167">**/t** can be used with both **signtool sign** and **signtool timestamp** commands.</span></span> |



 

<span data-ttu-id="af770-168">Para obtener más información sobre las herramientas que pueden ser útiles en este contexto, vea [herramientas de criptografía](cryptography-tools.md) y [SignTool](signtool.md).</span><span class="sxs-lookup"><span data-stu-id="af770-168">For more information about tools that may be useful in this context, see [Cryptography Tools](cryptography-tools.md) and [SignTool](signtool.md).</span></span>

## <a name="implementation-details-and-wire-format"></a><span data-ttu-id="af770-169">Detalles de implementación y formato de conexión</span><span class="sxs-lookup"><span data-stu-id="af770-169">Implementation Details and Wire Format</span></span>

<span data-ttu-id="af770-170">[SignTool](signtool.md) se basa en la implementación de Authenticode de Windows para crear y obtener firmas de marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-170">[SignTool](signtool.md) relies on the Windows Authenticode implementation to create and time stamp signatures.</span></span> <span data-ttu-id="af770-171">[*Authenticode*](../secgloss/a-gly.md) funciona en archivos binarios, por ejemplo,. cab,. exe,. dll o. ocx.</span><span class="sxs-lookup"><span data-stu-id="af770-171">[*Authenticode*](../secgloss/a-gly.md) operates on binary files, for example .cab, .exe, .dll, or .ocx.</span></span> <span data-ttu-id="af770-172">Authenticode crea primero la firma, lo que genera un archivo PKCS \# 7 [**SignedData**](signeddata.md).</span><span class="sxs-lookup"><span data-stu-id="af770-172">Authenticode first creates the signature, producing a PKCS \#7 [**SignedData**](signeddata.md).</span></span> <span data-ttu-id="af770-173">Este **SignedData** se debe contrafirmar, tal y como se describe en PKCS \# 9.</span><span class="sxs-lookup"><span data-stu-id="af770-173">It is this **SignedData** that must be countersigned, as described in PKCS \#9.</span></span>

<span data-ttu-id="af770-174">El proceso de contrafirma se realiza en cuatro pasos:</span><span class="sxs-lookup"><span data-stu-id="af770-174">The countersignature process takes place in four steps:</span></span>

1.  <span data-ttu-id="af770-175">Copie la firma (es decir, encryptedDigest) del SignerInfo de PKCS \# 7 [**SignedData**](signeddata.md).</span><span class="sxs-lookup"><span data-stu-id="af770-175">Copy the signature (that is, the encryptedDigest) from the SignerInfo of the PKCS \#7 [**SignedData**](signeddata.md).</span></span>
2.  <span data-ttu-id="af770-176">Construya una solicitud de marca de tiempo cuyo contenido sea la firma original.</span><span class="sxs-lookup"><span data-stu-id="af770-176">Construct a time stamp request whose content is the original signature.</span></span> <span data-ttu-id="af770-177">Envíelo al servidor de marca de tiempo de la [*notación de sintaxis abstracta uno*](../secgloss/a-gly.md) (ASN. 1) codificado como TimeStampRequest.</span><span class="sxs-lookup"><span data-stu-id="af770-177">Send this to the time stamp server [*Abstract Syntax Notation One*](../secgloss/a-gly.md) (ASN.1) encoded as a TimeStampRequest.</span></span>
3.  <span data-ttu-id="af770-178">Recibir una marca de tiempo, con el formato de un segundo \# [**SignedData**](signeddata.md)PKCS 7, que se devuelve desde el servidor de marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-178">Receive a time stamp, formatted as a second PKCS \#7 [**SignedData**](signeddata.md), returned from the time stamp server.</span></span>
4.  <span data-ttu-id="af770-179">Copie el SignerInfo de la marca de tiempo directamente en el \# [**SignedData**](signeddata.md)PKCS 7 original, como una \# contrafirma PKCS 9 (es decir, un atributo no autenticado en el SignerInfo del original).</span><span class="sxs-lookup"><span data-stu-id="af770-179">Copy the SignerInfo from the time stamp directly into the original PKCS \#7 [**SignedData**](signeddata.md), as a PKCS \#9 countersignature (that is, an unauthenticated attribute in the SignerInfo of the original).</span></span>

## <a name="time-stamp-request"></a><span data-ttu-id="af770-180">Solicitud de marca de tiempo</span><span class="sxs-lookup"><span data-stu-id="af770-180">Time Stamp Request</span></span>

<span data-ttu-id="af770-181">La solicitud de marca de tiempo se envía dentro de un mensaje HTTP 1,1 POST.</span><span class="sxs-lookup"><span data-stu-id="af770-181">The time stamp request is sent within an HTTP 1.1 POST message.</span></span> <span data-ttu-id="af770-182">En el encabezado HTTP, la Directiva CacheControl está establecida en no-cache y la Directiva Content-Type se establece en application/octet-stream.</span><span class="sxs-lookup"><span data-stu-id="af770-182">In the HTTP header, the CacheControl directive is set to no-cache, and the Content-Type directive is set to application/octet-stream.</span></span> <span data-ttu-id="af770-183">El cuerpo del mensaje HTTP es una codificación Base64 de la codificación de [*reglas de codificación distinguida*](../secgloss/d-gly.md) (der) de la solicitud de marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-183">The body of the HTTP message is a base64 encoding of [*Distinguished Encoding Rules*](../secgloss/d-gly.md) (DER) encoding of the time stamp request.</span></span>

<span data-ttu-id="af770-184">Aunque no se usa actualmente, la Directiva de longitud de contenido también debe usarse para construir el mensaje HTTP, ya que ayuda al servidor de marca de tiempo a ubicar el lugar en el que se encuentra la solicitud en HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="af770-184">Although not currently used, the Content-Length directive should also be used in constructing the HTTP message because it helps the time stamp server locate where the request is within the HTTP POST.</span></span>

<span data-ttu-id="af770-185">También pueden estar presentes otros encabezados HTTP y deben omitirse si no los entiende el solicitante o el servidor de marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-185">Other HTTP headers may also be present and should be ignored if they are not understood by the requestor or time stamp server.</span></span>

<span data-ttu-id="af770-186">La solicitud de marca de tiempo es un mensaje codificado ASN. 1.</span><span class="sxs-lookup"><span data-stu-id="af770-186">The time stamp request is an ASN.1 encoded message.</span></span> <span data-ttu-id="af770-187">El formato de la solicitud es el siguiente.</span><span class="sxs-lookup"><span data-stu-id="af770-187">The format of the request is as follows.</span></span>

``` syntax
TimeStampRequest ::= SEQUENCE {
   countersignatureType OBJECT IDENTIFIER,
   attributes Attributes OPTIONAL, 
   content  ContentInfo
}
```

<span data-ttu-id="af770-188">CountersignatureType es el [*identificador de objeto*](../secgloss/o-gly.md) (OID) que lo identifica como una contrafirma de marca de tiempo y debe ser el OID exacto 1.3.6.1.4.1.311.3.2.1.</span><span class="sxs-lookup"><span data-stu-id="af770-188">The countersignatureType is the [*object identifier*](../secgloss/o-gly.md) (OID) that identifies this as a time stamp countersignature and should be the exact OID 1.3.6.1.4.1.311.3.2.1.</span></span>

<span data-ttu-id="af770-189">No hay ningún atributo incluido actualmente en la solicitud de marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-189">No attributes are currently included in the time stamp request.</span></span>

<span data-ttu-id="af770-190">El contenido es un ContentInfo, tal y como se define en PKCS \# 7.</span><span class="sxs-lookup"><span data-stu-id="af770-190">The content is a ContentInfo as defined by PKCS \#7.</span></span> <span data-ttu-id="af770-191">El contenido son los datos que se van a firmar.</span><span class="sxs-lookup"><span data-stu-id="af770-191">The content is the data to be signed.</span></span> <span data-ttu-id="af770-192">En cuanto a la marca de tiempo de la firma, el ContentType debe ser datos y el contenido debe ser el encryptedDigest (firma) del SignerInfo del \# contenido PKCS 7 para que sea una marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-192">For signature time stamping, the ContentType should be Data, and the content should be the encryptedDigest (signature) from the SignerInfo of the PKCS \#7 content to be time stamped.</span></span>

## <a name="time-stamp-response"></a><span data-ttu-id="af770-193">Respuesta de marca de tiempo</span><span class="sxs-lookup"><span data-stu-id="af770-193">Time Stamp Response</span></span>

<span data-ttu-id="af770-194">La respuesta de marca de tiempo también se envía dentro de un mensaje HTTP 1,1.</span><span class="sxs-lookup"><span data-stu-id="af770-194">The time stamp response is also sent within an HTTP 1.1 message.</span></span> <span data-ttu-id="af770-195">En el encabezado HTTP, la Directiva Content-Type también se establece en application/octet-stream.</span><span class="sxs-lookup"><span data-stu-id="af770-195">In the HTTP header, the Content-Type directive is also set to application/octet-stream.</span></span> <span data-ttu-id="af770-196">El cuerpo del mensaje HTTP es una codificación Base64 de la codificación DER de la respuesta de la marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-196">The body of the HTTP message is a base64 encoding of DER encoding of the time stamp response.</span></span>

<span data-ttu-id="af770-197">La respuesta de marca de tiempo es un \# mensaje firmado PKCS 7 firmado por la hora autor.</span><span class="sxs-lookup"><span data-stu-id="af770-197">The time stamp response is a PKCS \#7 signed message signed by the time stamper.</span></span> <span data-ttu-id="af770-198">El ContentInfo del mensaje PKCS \# 7 es idéntico al ContentInfo recibido en la marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="af770-198">The ContentInfo of the PKCS \#7 message is identical to the ContentInfo received in the time stamp.</span></span> <span data-ttu-id="af770-199">El \# contenido PKCS 7 contiene el atributo de hora de firma autenticado (definido en PKCS \# 99, OID 1.2.840.113549.9.5).</span><span class="sxs-lookup"><span data-stu-id="af770-199">The PKCS \#7 content contains the signing time authenticated attribute (defined in PKCS \#99, OID 1.2.840.113549.9.5).</span></span>

<span data-ttu-id="af770-200">Después de que Authenticode reciba la marca de tiempo del servidor, Authenticode incorporará la marca de tiempo \# al [**SignedData**](signeddata.md) PKCS 7 original como una contrafirma.</span><span class="sxs-lookup"><span data-stu-id="af770-200">After Authenticode receives the time stamp from the server, Authenticode incorporates the time stamp into the original PKCS \#7 [**SignedData**](signeddata.md) as a countersignature.</span></span> <span data-ttu-id="af770-201">Para ello, \# se descartan los ContentInfo de los **SignedData** PKCS 7 devueltos y el SignerInfo de la marca de tiempo devuelta se copia como una contrafirma en el SignerInfo del archivo PKCS \# 7 **SignedData** original.</span><span class="sxs-lookup"><span data-stu-id="af770-201">To accomplish this, the ContentInfo of the returned PKCS \#7 **SignedData** is discarded, and the SignerInfo of the returned time stamp is copied as a countersignature into the SignerInfo of the original PKCS \#7 **SignedData**.</span></span> <span data-ttu-id="af770-202">La cadena de certificados de la hora autor también se copia en los certificados de la \# **SignedData** PKCS 7 original como atributo no autenticado del firmante original.</span><span class="sxs-lookup"><span data-stu-id="af770-202">The certificate chain of the time stamper is also copied into Certificates in the original PKCS \#7 **SignedData** as an unauthenticated attribute of the original signer.</span></span>

<span data-ttu-id="af770-203">Para obtener más información sobre PKCS y otros asuntos de seguridad, consulte la [biblioteca de contenido del sitio web de RSA](https://www.rsa.com/content_library.aspx).</span><span class="sxs-lookup"><span data-stu-id="af770-203">For more information about PKCS and other security subjects, see the [content library of the RSA website](https://www.rsa.com/content_library.aspx).</span></span>

 

 
