---
title: Tokens de aplicación auxiliar para trabajos de transferencia de BITS
description: Tokens de aplicación auxiliar para trabajos de transferencia de BITS
ms.assetid: f29f9870-e406-472b-9342-203def7453ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52925a6e0d5a9601e21848d514214bfb843f6246
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104488259"
---
# <a name="helper-tokens-for-bits-transfer-jobs"></a><span data-ttu-id="53455-103">Tokens de aplicación auxiliar para trabajos de transferencia de BITS</span><span class="sxs-lookup"><span data-stu-id="53455-103">Helper Tokens for BITS Transfer Jobs</span></span>

<span data-ttu-id="53455-104">En Windows Vista, el servicio Servicio de transferencia inteligente en segundo plano (BITS) permite a una aplicación asociar un solo token de seguridad a un trabajo de transferencia de BITS.</span><span class="sxs-lookup"><span data-stu-id="53455-104">In Windows Vista, the Background Intelligent Transfer Service (BITS) service allows an application to associate a single security token to a BITS transfer job.</span></span> <span data-ttu-id="53455-105">A continuación, el trabajo de transferencia de BITS usa este token para la autenticación y para el acceso a los recursos locales y remotos.</span><span class="sxs-lookup"><span data-stu-id="53455-105">The BITS transfer job then uses this token for authentication and for access to local and remote resources.</span></span>

<span data-ttu-id="53455-106">En Windows 7, el servicio BITS asocia un token adicional a un trabajo de transferencia de BITS.</span><span class="sxs-lookup"><span data-stu-id="53455-106">In Windows 7, the BITS service associates an additional token to a BITS transfer job.</span></span> <span data-ttu-id="53455-107">El trabajo de transferencia de BITS se puede configurar con un token de seguridad adicional, que es un token de suplantación creado por una aplicación que llama a la API de COM de BITS.</span><span class="sxs-lookup"><span data-stu-id="53455-107">The BITS transfer job can be configured with an additional security token, which is an impersonation token created by an application calling the BITS COM API.</span></span> <span data-ttu-id="53455-108">Este modelo de token auxiliar permite a las aplicaciones usar simultáneamente dos tokens de seguridad diferentes para tener acceso a archivos locales, certificados del lado cliente, archivos remotos y servidores proxy.</span><span class="sxs-lookup"><span data-stu-id="53455-108">This helper token model allows applications to simultaneously use two different security tokens to access local files, client-side certificates, remote files, and proxies.</span></span> <span data-ttu-id="53455-109">Por ejemplo, se crea un trabajo de transferencia de BITS que escribe los datos descargados en un directorio local con privilegios y, a continuación, presenta una identidad de dominio con derechos reducidos para el servidor proxy y el servidor HTTP.</span><span class="sxs-lookup"><span data-stu-id="53455-109">For example, a BITS transfer job is created that writes the downloaded data to a privileged local directory, and then it presents a low-rights domain identity to the HTTP server and proxy server.</span></span>

<span data-ttu-id="53455-110">Una aplicación, normalmente un servicio de Windows, especifica un token auxiliar mediante el uso de la nueva interfaz [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span><span class="sxs-lookup"><span data-stu-id="53455-110">An application, typically a Windows service, specifies a helper token by using the new interface [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span></span> <span data-ttu-id="53455-111">Esta interfaz se implementa mediante el objeto de trabajo de BITS.</span><span class="sxs-lookup"><span data-stu-id="53455-111">This interface is implemented by the BITS job object.</span></span> <span data-ttu-id="53455-112">La aplicación llama a [**IBackgroundCopyJob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) para obtener el puntero de interfaz.</span><span class="sxs-lookup"><span data-stu-id="53455-112">The application calls [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) to get the interface pointer.</span></span> <span data-ttu-id="53455-113">La aplicación suplanta la identidad del ayudante y llama a [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) para pasar el token al servicio bits.</span><span class="sxs-lookup"><span data-stu-id="53455-113">The application impersonates the helper identity and calls [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) to pass the token to the BITS service.</span></span> <span data-ttu-id="53455-114">A continuación, la aplicación especifica los recursos a los que se aplica el token pasando un conjunto de marcadores de bits mediante [**IBitsTokenOptions:: SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags).</span><span class="sxs-lookup"><span data-stu-id="53455-114">Then the application specifies the resources to which the token applies by passing a set of bit flags using [**IBitsTokenOptions::SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags).</span></span> <span data-ttu-id="53455-115">La aplicación borra todas las marcas (usando de nuevo **SetHelperTokenFlags** ) para revertir el comportamiento.</span><span class="sxs-lookup"><span data-stu-id="53455-115">The application clears all the flags (using **SetHelperTokenFlags** again) to revert the behavior.</span></span> <span data-ttu-id="53455-116">El servicio BITS almacena las marcas de bits y el token en el trabajo de transferencia de BITS.</span><span class="sxs-lookup"><span data-stu-id="53455-116">The BITS service stores the bit flags and the token in the BITS transfer job.</span></span>

<span data-ttu-id="53455-117">Cuando el propietario de los trabajos de transferencia de BITS cierra la sesión, el servicio BITS descarta cualquier token auxiliar que esté asociado con el trabajo de transferencia.</span><span class="sxs-lookup"><span data-stu-id="53455-117">When the owner of the BITS transfer jobs logs off, the BITS service discards any helper tokens that are associated with the transfer job.</span></span> <span data-ttu-id="53455-118">Si no se completa la transferencia, el servicio BITS coloca el trabajo en un estado de error con el código de error requerido por el **\_ \_ token \_ de BG e** y descarta el token de la aplicación auxiliar.</span><span class="sxs-lookup"><span data-stu-id="53455-118">If the transfer is not complete, the BITS service places the job in an error state with the **BG\_E\_TOKEN\_REQUIRED** error code and discards the helper token.</span></span> <span data-ttu-id="53455-119">La aplicación cliente puede actualizar el token llamando a [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) y, a continuación, puede reanudar el trabajo de transferencia de bits.</span><span class="sxs-lookup"><span data-stu-id="53455-119">The client application can refresh the token by calling [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) and can then resume the BITS transfer job.</span></span> <span data-ttu-id="53455-120">Como alternativa, la aplicación cliente puede borrar las marcas de tokens auxiliares mediante [**IBitsTokenOptions:: SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) y, a continuación, reanudar el trabajo de transferencia sin un token auxiliar.</span><span class="sxs-lookup"><span data-stu-id="53455-120">Alternatively, the client application can clear the helper token flags using [**IBitsTokenOptions::SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) and then resume the transfer job without a helper token.</span></span>

<span data-ttu-id="53455-121">Del mismo modo, cuando el propietario de una sesión de Terminal Services cierra la sesión, el servicio BITS debe descartar los tokens auxiliares de esa sesión y colocar los trabajos de transferencia afectados en un estado de error con el código de error **\_ requerido del \_ token \_ de BG E** .</span><span class="sxs-lookup"><span data-stu-id="53455-121">Similarly, when the owner of a terminal services session logs off, the BITS service must discard any helper tokens from that session and place the affected transfer jobs in an error state with the **BG\_E\_TOKEN\_REQUIRED** error code.</span></span>

<span data-ttu-id="53455-122">El modelo de token auxiliar requiere un cambio en la Directiva de control de acceso de BITS.</span><span class="sxs-lookup"><span data-stu-id="53455-122">The helper token model requires a change to BITS access control policy.</span></span> <span data-ttu-id="53455-123">Las versiones anteriores de BITS implementaban comprobaciones de acceso en cada llamada al método.</span><span class="sxs-lookup"><span data-stu-id="53455-123">Previous versions of BITS implemented access checks on every method call.</span></span> <span data-ttu-id="53455-124">A partir de Windows 7, la comprobación de acceso se debe realizar dentro de la llamada a [**IBackgroundCopyJob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) ; de lo contrario, el token auxiliar podría no tener acceso al trabajo de transferencia.</span><span class="sxs-lookup"><span data-stu-id="53455-124">Starting with Windows 7, the access check must be performed inside the [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) call; otherwise, the helper token might not have access to the transfer job.</span></span>

> [!Note]  
> <span data-ttu-id="53455-125">Las implementaciones más antiguas requerían eficazmente que los usuarios de BITS dispongan de privilegios de administrador para establecer tokens auxiliares.</span><span class="sxs-lookup"><span data-stu-id="53455-125">Older implementations effectively required that BITS users have administrator privileges in order to set helper tokens.</span></span> <span data-ttu-id="53455-126">A partir de Windows 10, versión 1607, los usuarios de BITS que no son administradores pueden usar [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) para establecer tokens auxiliares que no son de administrador en trabajos de bits que poseen.</span><span class="sxs-lookup"><span data-stu-id="53455-126">Starting with Windows 10, version 1607, non-administrator BITS users can use [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) to set non-administrator helper tokens on BITS jobs they own.</span></span> <span data-ttu-id="53455-127">Este cambio permite a los usuarios de BITS que no son administradores (como los servicios de descarga en segundo plano que se ejecutan con la [cuenta NetworkService](/windows/desktop/Services/networkservice-account)) establecer tokens auxiliares.</span><span class="sxs-lookup"><span data-stu-id="53455-127">This change enables non-administrator BITS users (such as background downloader services running under the [NetworkService account](/windows/desktop/Services/networkservice-account)) to set helper tokens.</span></span>
>
> <span data-ttu-id="53455-128">En concreto, la implementación se ha cambiado para permitir que los usuarios sin privilegios de administrador establezcan tokens auxiliares, siempre y cuando se cumplan las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="53455-128">Specifically, the implementation has been changed to allow users without administrator privileges to set helper tokens, as long as the following conditions are met:</span></span>
>
> -   <span data-ttu-id="53455-129">durante la llamada a [**IBackgroundCopyJob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) , el SID del token thread's del llamador es el mismo que el SID de la cuenta de usuario del propietario del trabajo.</span><span class="sxs-lookup"><span data-stu-id="53455-129">during the [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) call, the SID of the caller's thread's token is the same as the SID of the job owner's user account, and</span></span>
> -   <span data-ttu-id="53455-130">Cuando se llama a [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) , el token auxiliar no tiene habilitado el SID de administrador (**administradores de RID de alias de dominio \_ \_ \_**).</span><span class="sxs-lookup"><span data-stu-id="53455-130">when [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) is called, the helper token does not have the administrator SID (**DOMAIN\_ALIAS\_RID\_ADMINS**) enabled.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="53455-131">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="53455-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="53455-132">**IBitsTokenOptions**</span><span class="sxs-lookup"><span data-stu-id="53455-132">**IBitsTokenOptions**</span></span>](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions)
</dt> </dl>

 

 