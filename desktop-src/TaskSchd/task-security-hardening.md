---
title: Protección de la seguridad de tareas
description: El uso de la característica de protección de seguridad de tareas permitirá a los propietarios de tareas ejecutar sus tareas con los privilegios mínimos necesarios.
ms.assetid: ba03add5-aa05-4bef-baec-684ca17363bd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ab70679d605a9ad56c6d26116245ae17d41a7a1
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "104268794"
---
# <a name="task-security-hardening"></a><span data-ttu-id="f76e0-103">Protección de la seguridad de tareas</span><span class="sxs-lookup"><span data-stu-id="f76e0-103">Task Security Hardening</span></span>

<span data-ttu-id="f76e0-104">El uso de la característica de protección de seguridad de tareas permitirá a los propietarios de tareas ejecutar sus tareas con los privilegios mínimos necesarios.</span><span class="sxs-lookup"><span data-stu-id="f76e0-104">Using the tasks security hardening feature will allow task owners to run their tasks with minimum required privileges.</span></span> <span data-ttu-id="f76e0-105">Tenga en cuenta que esta característica está habilitada de forma predeterminada y los propietarios de tareas pueden realizar ajustes adicionales mediante el tipo de identificador de seguridad del token de proceso de tarea y la matriz de privilegios necesarios para la tarea.</span><span class="sxs-lookup"><span data-stu-id="f76e0-105">Note that this feature is enabled by default and task owners can make further adjustments by using the task process token security identifier type and task required privileges array.</span></span>

## <a name="task-process-token-sid-type-and-task-required-privileges-array"></a><span data-ttu-id="f76e0-106">Tipo de SID de token de proceso de tarea y matriz de privilegios de tarea requerida</span><span class="sxs-lookup"><span data-stu-id="f76e0-106">Task Process Token SID Type and Task Required Privileges Array</span></span>

<span data-ttu-id="f76e0-107">La especificación de **ProcessTokenSidType** en el nivel de definición de tarea permite a los propietarios de tareas solicitar un proceso de tarea para que se ejecute con el tipo de Sid "none" o el tipo de Sid "Unrestricted".</span><span class="sxs-lookup"><span data-stu-id="f76e0-107">Specifying **ProcessTokenSidType** at the task definition level allows task owners to request a task process to run with the "none" SID type or the "unrestricted" SID type.</span></span> <span data-ttu-id="f76e0-108">Si el campo está presente en la definición de la tarea, la validación garantiza que UserId de la tarea contiene el nombre o la cadena SID correspondiente para una de esas cuentas de servicio integradas del sistema operativo: "servicio de red" o "servicio LOCAL".</span><span class="sxs-lookup"><span data-stu-id="f76e0-108">If the field is present in task definition, validation ensures that task UserId contains the name or the corresponding SID string for one of those operating system built-in service accounts: "NETWORK SERVICE" or "LOCAL SERVICE".</span></span>

<span data-ttu-id="f76e0-109">El tipo de SID "none" significa que la tarea se ejecuta en un proceso que no contiene un SID de token de proceso (no se realizarán cambios en la lista de grupos de tokens de proceso).</span><span class="sxs-lookup"><span data-stu-id="f76e0-109">The SID type "none" means that the task runs in a process that does not contain a process token SID (no changes will be made to the process token groups list).</span></span> <span data-ttu-id="f76e0-110">En ese caso, el SID de la cuenta principal de tarea (LocalService/NetworkService) tiene acceso completo al token del proceso.</span><span class="sxs-lookup"><span data-stu-id="f76e0-110">The task principal account SID (LocalService/NetworkService) in that case has full access to the process token.</span></span>

<span data-ttu-id="f76e0-111">El tipo de SID "Unrestricted" significa que un SID de tarea se derivará de la ruta de acceso completa de la tarea y se agregará a la lista de grupos de tokens de proceso.</span><span class="sxs-lookup"><span data-stu-id="f76e0-111">The "unrestricted" SID type means that a task SID will be derived from the full task path and will be added to the process token groups list.</span></span> <span data-ttu-id="f76e0-112">Por ejemplo, la \\ RACTask de Microsoft \\ Windows \\ RAC \\ que se ejecuta en la cuenta de servicio local, el SID de la tarea se deriva del nombre Microsoft-Windows-RAC-RACTask, donde un "-" se sustituye por " \\ ", ya que " \\ " es un carácter de nombre de usuario no válido.</span><span class="sxs-lookup"><span data-stu-id="f76e0-112">For example, the \\Microsoft\\Windows\\RAC\\RACTask which runs in the Local Service account, the task SID is derived from the name Microsoft-Windows-RAC-RACTask where a "-" is substituted for a "\\" since "\\" is an invalid user name character.</span></span> <span data-ttu-id="f76e0-113">El nombre de grupo conocido para el SID de la tarea sería "tarea NT \\ <modified full task path> " (nombredominio \\ nombreDeUsuario Format).</span><span class="sxs-lookup"><span data-stu-id="f76e0-113">The well known group name for the task SID would be "NT TASK\\<modified full task path>" (domainname\\username format).</span></span> <span data-ttu-id="f76e0-114">La lista de control de acceso discrecional (DACL) predeterminada del token de proceso también se modificará para permitir el control total del SID de la tarea y del SID del sistema local y de leer el control del SID de la cuenta de la entidad de seguridad de la tarea.</span><span class="sxs-lookup"><span data-stu-id="f76e0-114">The process token default discretionary access control list (DACL) will also be modified to allow full control for the task SID and local system SID only and read control to the task principal account SID.</span></span> <span data-ttu-id="f76e0-115">"schtasks.exe/showsid/TN <full task path> " mostrará el SID de la tarea que corresponde a la tarea.</span><span class="sxs-lookup"><span data-stu-id="f76e0-115">"schtasks.exe /showsid /tn <full task path>" will show the task SID that is corresponding to the task.</span></span>

<span data-ttu-id="f76e0-116">Cuando se inicia una acción de tarea no COM, el motor de programación registra en la cuenta de la entidad de seguridad de la tarea, obtiene el token del proceso y consulta la lista de privilegios que tiene el token y, a continuación, lo compara con la lista de privilegios especificada en RequiredPrivileges.</span><span class="sxs-lookup"><span data-stu-id="f76e0-116">When a non-COM task action starts up, the scheduling engine logs on the task principal account, gets the process token and queries the list of privileges that the token has and then compares that with the privileges list specified in RequiredPrivileges.</span></span> <span data-ttu-id="f76e0-117">Si no se especifica un privilegio en el último, se ha marcado como privilegio SE \_ \_ quitado.</span><span class="sxs-lookup"><span data-stu-id="f76e0-117">If a privilege is not specified in the latter, then that is marked as SE\_PRIVILEGE\_REMOVED.</span></span> <span data-ttu-id="f76e0-118">La acción ejecutable se iniciará con el identificador de token resultante mediante la API de CreateProcessAsUser.</span><span class="sxs-lookup"><span data-stu-id="f76e0-118">The executable action will then be started with the resulting token handle by using the CreateProcessAsUser API.</span></span>

<span data-ttu-id="f76e0-119">Cuando se inicia una acción de tarea COM, debe activarse mediante el proceso de taskhost.exe.</span><span class="sxs-lookup"><span data-stu-id="f76e0-119">When a COM task action starts up, it must be activated by the taskhost.exe process.</span></span> <span data-ttu-id="f76e0-120">El motor de programación consulta el bloque de contexto de cada taskhost.exe en ejecución con la misma cuenta que la tarea de inicio.</span><span class="sxs-lookup"><span data-stu-id="f76e0-120">The scheduling engine queries the context block of each running taskhost.exe with the same account as the starting task.</span></span> <span data-ttu-id="f76e0-121">Si encuentra que un proceso de host se inició con un superconjunto de privilegios que la tarea de inicio necesita, esa tarea se hospeda en ese proceso.</span><span class="sxs-lookup"><span data-stu-id="f76e0-121">If it finds that a host process was started with a superset of privileges that the starting task needs, then that task gets hosted in that process.</span></span> <span data-ttu-id="f76e0-122">Si no encuentra este tipo de proceso, combina la información de protección de todas las tareas que se están ejecutando en el taskhosts en la cuenta de la entidad de seguridad de la tarea con la máscara RequiredPrivileges especificada y, a continuación, inicia una nueva instancia de taskhost.exe.</span><span class="sxs-lookup"><span data-stu-id="f76e0-122">If it does not find such a process, it combines the hardening info of all the tasks that are running in the taskhosts under the task principal account with the specified RequiredPrivileges mask and then starts up a new instance of taskhost.exe.</span></span>

<span data-ttu-id="f76e0-123">Si RequiredPrivileges no está presente en la definición de la tarea, los privilegios predeterminados de la cuenta de la entidad de seguridad de tareas sin SeImpersonatePrivilege se usarán para el proceso de la tarea.</span><span class="sxs-lookup"><span data-stu-id="f76e0-123">If RequiredPrivileges is not present in the task definition, the default privileges of task principal account without the SeImpersonatePrivilege will be used for task process.</span></span> <span data-ttu-id="f76e0-124">Si **ProcessTokenSidType** no está presente en la definición de la tarea, se utiliza "Unrestricted" como valor predeterminado.</span><span class="sxs-lookup"><span data-stu-id="f76e0-124">If **ProcessTokenSidType** is not present in the task definition, "unrestricted" is used as the default.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f76e0-125">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="f76e0-125">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f76e0-126">Información de registro de tareas</span><span class="sxs-lookup"><span data-stu-id="f76e0-126">Task Registration Information</span></span>](task-registration-information.md)
</dt> <dt>

[<span data-ttu-id="f76e0-127">Acerca del Programador de tareas</span><span class="sxs-lookup"><span data-stu-id="f76e0-127">About The Task Scheduler</span></span>](about-the-task-scheduler.md)
</dt> <dt>

[<span data-ttu-id="f76e0-128">Contextos de seguridad para tareas</span><span class="sxs-lookup"><span data-stu-id="f76e0-128">Security Contexts for Tasks</span></span>](security-contexts-for-running-tasks.md)
</dt> </dl>

 

 




