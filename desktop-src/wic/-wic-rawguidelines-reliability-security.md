---
description: Confiabilidad y seguridad
ms.assetid: 1cbfabce-3d56-4e23-b9a7-02369c67e392
title: Confiabilidad y seguridad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a0f0e4a244de2c1463cdadb76162c18b041812b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105688128"
---
# <a name="reliability-and-security"></a><span data-ttu-id="7c77b-103">Confiabilidad y seguridad</span><span class="sxs-lookup"><span data-stu-id="7c77b-103">Reliability and Security</span></span>

<span data-ttu-id="7c77b-104">Dado que los códecs de componentes de imágenes de Windows (WIC) se invocarán desde el shell de Windows y la Galería fotográfica de, los creadores de códec deben hacer todo lo posible para garantizar un alto nivel de confiabilidad y seguridad en sus códecs WIC.</span><span class="sxs-lookup"><span data-stu-id="7c77b-104">Because Windows Imaging Component (WIC) codecs will be invoked from within the Windows shell and Photo Gallery, codec authors should make every effort to ensure a high level of reliability and security in their WIC codecs.</span></span>

<span data-ttu-id="7c77b-105">La escritura de código confiable depende en gran medida de buenas prácticas de codificación, revisiones de código eficaces y pruebas unitarias y pruebas de escenarios exhaustivas.</span><span class="sxs-lookup"><span data-stu-id="7c77b-105">Writing reliable code largely depends on good coding practices, effective code reviews, and thorough unit testing and scenario testing.</span></span> <span data-ttu-id="7c77b-106">Además, las siguientes instrucciones le ayudarán a asegurarse de que el códec cumple con las directivas de Windows Vista con respecto a la confiabilidad.</span><span class="sxs-lookup"><span data-stu-id="7c77b-106">In addition, the following guidelines will help ensure that the codec complies with Windows Vista policies regarding reliability.</span></span>

-   <span data-ttu-id="7c77b-107">Habilitar la cancelación de e/s.</span><span class="sxs-lookup"><span data-stu-id="7c77b-107">Enable I/O cancellation.</span></span>

    <span data-ttu-id="7c77b-108">Los creadores de códec deben proporcionar una manera para que el usuario final cancele cualquier operación de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="7c77b-108">Codec authors should provide a way for the end user to cancel any long-running operation.</span></span> <span data-ttu-id="7c77b-109">Los códecs WIC lo admiten mediante la implementación de IWICBitmapProgressNotification.</span><span class="sxs-lookup"><span data-stu-id="7c77b-109">WIC codecs support this by implementing IWICBitmapProgressNotification.</span></span> <span data-ttu-id="7c77b-110">Esto permite a una aplicación que llama especificar una función de devolución de llamada para que el códec llame a intervalos especificados para notificar al autor de la llamada sobre el progreso de la operación actual.</span><span class="sxs-lookup"><span data-stu-id="7c77b-110">This allows a calling application to specify a callback function for the codec to call at specified intervals to notify the caller of the progress of the current operation.</span></span> <span data-ttu-id="7c77b-111">Cuando una aplicación devuelve un ERROR \_ cancelado de la función de devolución de llamada, el códec debe cancelar la operación en curso y propagar el valor HRESULT de nuevo al autor de la llamada.</span><span class="sxs-lookup"><span data-stu-id="7c77b-111">When an application returns ERROR\_CANCELLED from the callback function, the codec must cancel whatever operation is in progress and propagate the HRESULT back to the caller.</span></span> <span data-ttu-id="7c77b-112">Esto es especialmente importante en el caso de los códecs sin formato, ya que puede tardar varios segundos en descodificar una imagen sin formato de tamaño completo y las aplicaciones necesitan una forma de anular este procesamiento.</span><span class="sxs-lookup"><span data-stu-id="7c77b-112">This is especially important for RAW codecs, because it might take several seconds to decode a full-size RAW image and applications need a way to abort this processing.</span></span>

-   <span data-ttu-id="7c77b-113">Asegúrese de que el código se ejecuta en el ámbito más pequeño necesario para realizar su función.</span><span class="sxs-lookup"><span data-stu-id="7c77b-113">Make sure that code runs in the smallest scope that is required to perform its function.</span></span>

    <span data-ttu-id="7c77b-114">Los creadores de códecs deben asegurarse de que el códec no consuma más recursos de los necesarios o que tengan un ámbito mayor del necesario.</span><span class="sxs-lookup"><span data-stu-id="7c77b-114">Codec authors must ensure that the codec does not consume more resources than necessary or have a greater scope than is required.</span></span> <span data-ttu-id="7c77b-115">El ámbito de un códec en WIC es un archivo de imagen único; el códec se crea cuando se carga un archivo de imagen y el códec se libera cuando se cierra la imagen.</span><span class="sxs-lookup"><span data-stu-id="7c77b-115">The scope of a codec in WIC is a single image file; the codec is created when an image file is loaded, and the codec is released when the image is closed.</span></span> <span data-ttu-id="7c77b-116">Dado que WIC es una plataforma basada en componentes extensible, los códecs WIC tendrán cargas y descargaciones que se superponen, y se inicia y se detiene, todo dentro del mismo proceso.</span><span class="sxs-lookup"><span data-stu-id="7c77b-116">Because WIC is an extensible component-based platform, WIC codecs will have overlapping loads and unloads, and starts and stops, all within the same process.</span></span> <span data-ttu-id="7c77b-117">Si la infraestructura subyacente de un códec requiere operaciones de inicio y detención en un ámbito mayor que una sola imagen, la confiabilidad se verá afectada.</span><span class="sxs-lookup"><span data-stu-id="7c77b-117">If the underlying infrastructure of a codec requires start and stop operations at a scope larger than a single image, reliability will be impacted.</span></span> <span data-ttu-id="7c77b-118">Los códecs habilitados para WIC se utilizarán en el explorador de Windows, así como en otras aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="7c77b-118">WIC-enabled codecs will be used by the Windows Explorer, as well as other applications.</span></span> <span data-ttu-id="7c77b-119">Por lo tanto, si un códec permanece cargado mientras dure el proceso, la memoria no se liberará de forma eficaz y un error del códec podría bloquear el explorador de Windows y requerir un reinicio del equipo.</span><span class="sxs-lookup"><span data-stu-id="7c77b-119">Therefore, if a codec remains loaded for the lifetime of the process, memory will not be released efficiently and a failure of the codec could hang Windows Explorer and potentially require the machine to be rebooted.</span></span> <span data-ttu-id="7c77b-120">(Tenga en cuenta que el códec se invocará cada vez que una imagen se ponga en miniatura por primera vez en el explorador de Windows: es fundamental que se trata de una operación ligera).</span><span class="sxs-lookup"><span data-stu-id="7c77b-120">(Consider that the codec will be invoked every time an image is thumbnailed for the first time in Windows Explorer: it is essential that this be a lightweight operation.)</span></span>

-   <span data-ttu-id="7c77b-121">Usar herramientas de análisis de código estático y dinámico.</span><span class="sxs-lookup"><span data-stu-id="7c77b-121">Use static and dynamic code analysis tools.</span></span>

    -   <span data-ttu-id="7c77b-122">Herramientas de análisis estático:</span><span class="sxs-lookup"><span data-stu-id="7c77b-122">Static analysis tools:</span></span>

        <span data-ttu-id="7c77b-123">Prefijo: para detectar errores en tiempo de compilación.</span><span class="sxs-lookup"><span data-stu-id="7c77b-123">PREfix - for detecting errors at compile time.</span></span>

        <span data-ttu-id="7c77b-124">Rápido: para analizar código en busca de errores.</span><span class="sxs-lookup"><span data-stu-id="7c77b-124">PREfast - for analyzing code for bugs.</span></span>

    -   <span data-ttu-id="7c77b-125">Herramientas de análisis dinámico:</span><span class="sxs-lookup"><span data-stu-id="7c77b-125">Dynamic analysis tools:</span></span>

        <span data-ttu-id="7c77b-126">AppVerifier, que ayuda a mejorar la resistencia de las aplicaciones mediante la simulación de problemas comunes del software real.</span><span class="sxs-lookup"><span data-stu-id="7c77b-126">AppVerifier - which helps make applications more resilient by simulating common real-world software issues.</span></span>

-   <span data-ttu-id="7c77b-127">Compruebe todas las entradas en las revisiones de código.</span><span class="sxs-lookup"><span data-stu-id="7c77b-127">Verify all inputs in code reviews.</span></span>

    <span data-ttu-id="7c77b-128">Todos los parámetros de los métodos exportados y todos los datos de archivo deben comprobarse cuidadosamente para comprobar su validez y rechazarse de forma sólida si se produce un error, con el fin de protegerse frente a saturaciones del búfer y subprocesos, desbordamientos aritméticos y subdesbordamientos, y tipos inesperados.</span><span class="sxs-lookup"><span data-stu-id="7c77b-128">All parameters for exported methods and all file data must be carefully verified for validity and robustly rejected if faulty, in order to protect against buffer overruns and underruns, arithmetic overflows and underflows, and unexpected types.</span></span>

-   <span data-ttu-id="7c77b-129">Utilice técnicas de aproximación de archivos para detectar posibles bloqueos y bloqueos.</span><span class="sxs-lookup"><span data-stu-id="7c77b-129">Use file fuzzing techniques to discover potential crashes and hangs.</span></span>

    <span data-ttu-id="7c77b-130">La aproximación de archivos es el proceso de probar el códec con entradas permutadas aleatoriamente.</span><span class="sxs-lookup"><span data-stu-id="7c77b-130">File fuzzing is the process of testing the codec with randomly permuted inputs.</span></span>

    <span data-ttu-id="7c77b-131">Hay dos formas de hacer una aproximación de archivos: las aproximaciones no directas (aleatorias) y las aproximadas dirigidas.</span><span class="sxs-lookup"><span data-stu-id="7c77b-131">There are two forms of file fuzzing: undirected (random) fuzzing and directed fuzzing.</span></span> <span data-ttu-id="7c77b-132">La aproximación no dirigida realiza un volteo de bits aleatorio para ver si la entrada aleatoria puede bloquear el códec.</span><span class="sxs-lookup"><span data-stu-id="7c77b-132">Undirected fuzzing does some random bit flipping to see if random input can crash the codec.</span></span> <span data-ttu-id="7c77b-133">La aproximación a la entrada se silencia en función de algún conocimiento del formato de archivo.</span><span class="sxs-lookup"><span data-stu-id="7c77b-133">Directed fuzzing permutes the input based on some knowledge of the file format.</span></span> <span data-ttu-id="7c77b-134">Por ejemplo, si hay una comprobación de redundancia de ciclo (CRC) en el desplazamiento de bytes 32, es probable que el cambio de cualquier byte sin actualizar el CRC no ejerza la mayor parte de los rutas.</span><span class="sxs-lookup"><span data-stu-id="7c77b-134">For example, if there is a cycle redundancy check (CRC) at byte offset 32, then changing any bytes without updating the CRC will likely not exercise most of the codepaths.</span></span> <span data-ttu-id="7c77b-135">En este ejemplo, un comparador dirigido debe corregir el CRC cuando se modifican los bytes.</span><span class="sxs-lookup"><span data-stu-id="7c77b-135">In this example, a directed fuzzer should fix the CRC when any bytes are modified.</span></span>

    <span data-ttu-id="7c77b-136">Se debe crear el conjunto de entrada de imágenes para la aproximación de archivos, de forma que se pruebe cada combinación de parámetros que admita el descodificador.</span><span class="sxs-lookup"><span data-stu-id="7c77b-136">The input set of images for file fuzzing should be created so that each parameter combination that the decoder supports is tested.</span></span> <span data-ttu-id="7c77b-137">Por ejemplo, si el descodificador admite archivos poco y big-endian y tres valores de compresión, el conjunto de entrada de imagen debe constar de archivos Little-Endian de cada configuración de compresión y archivos Big-Endian para cada configuración de compresión.</span><span class="sxs-lookup"><span data-stu-id="7c77b-137">For example, if the decoder supports little- and big-endian files and three compression settings, then the input set of image should consist of little-endian files of each compression setting and big-endian files for each compression setting.</span></span> <span data-ttu-id="7c77b-138">Este enfoque producirá un conjunto grande, pero muy sólido, de imágenes de entrada que se van a probar.</span><span class="sxs-lookup"><span data-stu-id="7c77b-138">This approach will yield a large, but very robust set of input images to be tested.</span></span> <span data-ttu-id="7c77b-139">Incluso si ninguna cámara produce cada una de las combinaciones, pero el descodificador es compatible con estas combinaciones teóricas, los creadores de códecs deben aproximar estas entradas.</span><span class="sxs-lookup"><span data-stu-id="7c77b-139">Even if no camera produces each of the combinations but the decoder supports these theoretical combinations, codec authors should fuzz these inputs.</span></span>

    <span data-ttu-id="7c77b-140">La seguridad se puede mejorar considerablemente mediante la realización de pruebas aproximadas de archivos de imagen durante el desarrollo de códecs.</span><span class="sxs-lookup"><span data-stu-id="7c77b-140">Security can be greatly enhanced by regularly performing fuzz testing of image files during codec development.</span></span> <span data-ttu-id="7c77b-141">Los códecs siempre deben ser capaces de detectar daños en los archivos de imagen y producir errores en el caso de una solicitud con formato incorrecto o de datos mal formados.</span><span class="sxs-lookup"><span data-stu-id="7c77b-141">Codecs should always be able to detect image file corruption and fail gracefully in the case of a malformed request or of malformed data.</span></span>

-   <span data-ttu-id="7c77b-142">Haga hincapié en el código.</span><span class="sxs-lookup"><span data-stu-id="7c77b-142">Stress the code.</span></span>

    <span data-ttu-id="7c77b-143">Stress: Pruebe el códec, para lo que debe ejecutarlo continuamente en varios procesos simultáneos, realizando todas las operaciones admitidas en todas las secuencias posibles, en imágenes de tamaños diferentes (incluidas imágenes muy grandes) de cada cámara compatible.</span><span class="sxs-lookup"><span data-stu-id="7c77b-143">Stress-test the codec by running it continually in multiple simultaneous processes, performing all supported operations in all possible sequences, on images of varying sizes (including very large images) from every supported camera.</span></span>

-   <span data-ttu-id="7c77b-144">Seguridad para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="7c77b-144">Thread safety.</span></span>

    <span data-ttu-id="7c77b-145">A partir de Windows 7, WIC requiere que los CÓDECs sin formato tengan el tipo de Apartamento COM "both".</span><span class="sxs-lookup"><span data-stu-id="7c77b-145">As of Windows 7, WIC requires that RAW CODECs be of COM apartment type "Both".</span></span> <span data-ttu-id="7c77b-146">Esto significa que debe realizar el bloqueo adecuado para administrar llamadores y llamadores entre apartamentos en escenarios de varios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="7c77b-146">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="7c77b-147">Se puede llamar a los objetos de un contenedor multiproceso (MTA) simultáneamente en cualquier número de subprocesos del MTA, lo que permite un mejor rendimiento en los sistemas de varios núcleos y en determinados escenarios de servidor.</span><span class="sxs-lookup"><span data-stu-id="7c77b-147">Objects within an Multi Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA, allowing for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="7c77b-148">Además, los CÓDECs WIC que viven dentro de un MTA pueden llamar a otros objetos que viven dentro del MTA sin el costo de serialización asociado a la llamada entre subprocesos que residen en distintos apartamentos STA.</span><span class="sxs-lookup"><span data-stu-id="7c77b-148">In addition, WIC CODECs that live within an MTA can call other objects that live within the MTA without the marshalling cost associated of calling between threads that live in different STA apartments.</span></span> <span data-ttu-id="7c77b-149">En Windows 7, todos los CÓDECs WIC integrados se han actualizado para admitir MTA, como JPEG, TIFF, PNG, GIF, ICO y BMP.</span><span class="sxs-lookup"><span data-stu-id="7c77b-149">In Windows 7, all in-box WIC CODECs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="7c77b-150">los CÓDECs de terceros que no son compatibles con los MTA provocarán importantes costos de rendimiento en las aplicaciones multiproceso debido a la serialización.</span><span class="sxs-lookup"><span data-stu-id="7c77b-150">3rd-party CODECs that do not to support MTAs will cause significant performance costs in multithreaded applications due to marshaling.</span></span> <span data-ttu-id="7c77b-151">La habilitación de la compatibilidad con MTA requiere que se implemente la sincronización adecuada en el códec de terceros.</span><span class="sxs-lookup"><span data-stu-id="7c77b-151">Enabling MTA support requires proper synchronization to be implemented in the 3rd-party CODEC.</span></span> <span data-ttu-id="7c77b-152">La implementación exacta de estas técnicas de sincronización está fuera del ámbito de este documento.</span><span class="sxs-lookup"><span data-stu-id="7c77b-152">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="7c77b-153">A continuación se proporciona una referencia general para la sincronización de objetos COM.</span><span class="sxs-lookup"><span data-stu-id="7c77b-153">A general reference for synchronizing COM objects is provided below.</span></span>

    https://msdn.microsoft.com/library/ms809971.aspx

## <a name="related-topics"></a><span data-ttu-id="7c77b-154">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="7c77b-154">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="7c77b-155">**Vista**</span><span class="sxs-lookup"><span data-stu-id="7c77b-155">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="7c77b-156">Información general sobre componentes de Windows Imaging</span><span class="sxs-lookup"><span data-stu-id="7c77b-156">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="7c77b-157">Instrucciones de WIC para formatos de imagen RAW de cámara</span><span class="sxs-lookup"><span data-stu-id="7c77b-157">WIC Guidelines for Camera RAW Image Formats</span></span>](-wic-rawguidelines.md)
</dt> <dt>

[<span data-ttu-id="7c77b-158">Cómo escribir un códec de WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="7c77b-158">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



