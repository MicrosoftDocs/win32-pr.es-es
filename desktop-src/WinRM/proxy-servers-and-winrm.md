---
title: Servidores proxy y WinRM
description: Administración remota de Windows (WinRM) usa HTTP y HTTPS para enviar mensajes entre los equipos cliente y servidor. En general, el cliente WinRM envía mensajes directamente al servidor WinRM. Los clientes de WinRM también se pueden configurar para usar un servidor proxy.
ms.assetid: f8137b3a-7704-4b21-a923-6e2692e18d90
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e07bbfebb4c8f0eb9e77a8942d54677b55c60006
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "103791698"
---
# <a name="proxy-servers-and-winrm"></a><span data-ttu-id="cc715-105">Servidores proxy y WinRM</span><span class="sxs-lookup"><span data-stu-id="cc715-105">Proxy Servers and WinRM</span></span>

<span data-ttu-id="cc715-106">Administración remota de Windows (WinRM) usa HTTP y HTTPS para enviar mensajes entre los equipos cliente y servidor.</span><span class="sxs-lookup"><span data-stu-id="cc715-106">Windows Remote Management (WinRM) uses HTTP and HTTPS to send messages between the client and server computers.</span></span> <span data-ttu-id="cc715-107">En general, el cliente WinRM envía mensajes directamente al servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="cc715-107">In general, the WinRM client sends messages directly to the WinRM server.</span></span> <span data-ttu-id="cc715-108">Los clientes de WinRM también se pueden configurar para usar un servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="cc715-108">WinRM clients can be also configured to use a proxy server.</span></span>

<span data-ttu-id="cc715-109">Para obtener más información, consulte las secciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="cc715-109">For more information, see the following sections:</span></span>

-   [<span data-ttu-id="cc715-110">Configuración de un servidor proxy para WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="cc715-110">Configuring a Proxy Server for WinRM 2.0</span></span>](#configuring-a-proxy-server-for-winrm-20)
    -   [<span data-ttu-id="cc715-111">Conexiones proxy basadas en HTTPS</span><span class="sxs-lookup"><span data-stu-id="cc715-111">HTTPS-Based Proxy Connections</span></span>](#https-based-proxy-connections)
    -   [<span data-ttu-id="cc715-112">Conexiones proxy basadas en HTTP</span><span class="sxs-lookup"><span data-stu-id="cc715-112">HTTP-Based Proxy Connections</span></span>](#http-based-proxy-connections)
-   [<span data-ttu-id="cc715-113">Configuración de un servidor proxy para WinRM 1,1 y versiones anteriores</span><span class="sxs-lookup"><span data-stu-id="cc715-113">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>](#configuring-a-proxy-server-for-winrm-11-and-earlier)

## <a name="configuring-a-proxy-server-for-winrm-20"></a><span data-ttu-id="cc715-114">Configuración de un servidor proxy para WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="cc715-114">Configuring a Proxy Server for WinRM 2.0</span></span>

<span data-ttu-id="cc715-115">WinRM 2,0 admite una amplia gama de configuraciones de proxy.</span><span class="sxs-lookup"><span data-stu-id="cc715-115">WinRM 2.0 supports a wide range of proxy configurations.</span></span> <span data-ttu-id="cc715-116">Por ejemplo, WinRM admite servidores proxy para transportes HTTP y HTTPS, así como para servidores proxy autenticados y no autenticados.</span><span class="sxs-lookup"><span data-stu-id="cc715-116">For example, WinRM supports proxies for HTTP and HTTPS transports and for authenticated and unauthenticated proxy servers.</span></span>

### <a name="https-based-proxy-connections"></a><span data-ttu-id="cc715-117">Conexiones proxy HTTPS-Based</span><span class="sxs-lookup"><span data-stu-id="cc715-117">HTTPS-Based Proxy Connections</span></span>

<span data-ttu-id="cc715-118">Para mejorar la seguridad y la afinidad basada en la conexión, se debe usar HTTPS como mecanismo de transporte.</span><span class="sxs-lookup"><span data-stu-id="cc715-118">For better security and connection-based affinity, HTTPS should be used as the transport mechanism.</span></span>

<span data-ttu-id="cc715-119">Si el servidor proxy requiere autenticación, los clientes y servidores de WinRM deben usar HTTPS.</span><span class="sxs-lookup"><span data-stu-id="cc715-119">If the proxy server requires authentication, the WinRM clients and servers must use HTTPS.</span></span>

> [!Note]  
> <span data-ttu-id="cc715-120">La autenticación en el servidor proxy es independiente de la autenticación en el servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="cc715-120">Authentication to the proxy server is independent from the authentication to the destination server.</span></span>

 

### <a name="http-based-proxy-connections"></a><span data-ttu-id="cc715-121">Conexiones proxy HTTP-Based</span><span class="sxs-lookup"><span data-stu-id="cc715-121">HTTP-Based Proxy Connections</span></span>

<span data-ttu-id="cc715-122">Si no se requiere autenticación del servidor proxy, se puede usar HTTP o HTTPs para el transporte.</span><span class="sxs-lookup"><span data-stu-id="cc715-122">If no proxy server authentication is required, either HTTP or HTTPs can be used for transport.</span></span> <span data-ttu-id="cc715-123">Sin embargo, las conexiones basadas en HTTP desde un cliente WinRM a un servidor WinRM a través de un servidor proxy pueden ser problemáticas.</span><span class="sxs-lookup"><span data-stu-id="cc715-123">However, HTTP-based connections from a WinRM client to a WinRM server through a proxy server can be problematic.</span></span>

<span data-ttu-id="cc715-124">Pueden surgir los siguientes problemas al usar conexiones basadas en HTTP:</span><span class="sxs-lookup"><span data-stu-id="cc715-124">The following issues might be encountered when using HTTP-based connections:</span></span>

-   <span data-ttu-id="cc715-125">El servidor proxy no admite la autenticación basada en conexión, lo que puede provocar que se produzca un error de acceso denegado en la autenticación en el servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="cc715-125">The proxy server does not support connection-based authentication, which can cause the authentication against the destination server to fail with an access denied error.</span></span>
-   <span data-ttu-id="cc715-126">Se necesita más de un conjunto de credenciales para conectarse al servidor de destino y al servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="cc715-126">More than one set of credentials is needed to connect to the destination server and to the proxy server.</span></span>
-   <span data-ttu-id="cc715-127">Es posible que los servidores proxy basados en HTTP no admitan la capacidad de mantener las conexiones basadas en el cliente y en el servidor asociadas.</span><span class="sxs-lookup"><span data-stu-id="cc715-127">HTTP-based proxy servers might not support the ability to maintain the associated client-based and server-based connections.</span></span> <span data-ttu-id="cc715-128">Si el proxy no vincula de un cliente a un servidor y mantiene la conexión TCP/IP, es posible que los clientes no autenticados obtengan acceso a los datos.</span><span class="sxs-lookup"><span data-stu-id="cc715-128">If the proxy does not strongly link a client to a server and maintain the TCP/IP connection, unauthenticated clients might gain access to data.</span></span> <span data-ttu-id="cc715-129">Además, la falta de afinidad de conexión podría provocar un error de autenticación en el servidor.</span><span class="sxs-lookup"><span data-stu-id="cc715-129">Also, the lack of connection affinity might cause the authentication to fail against the server.</span></span>

<span data-ttu-id="cc715-130">Si se debe usar HTTP como el transporte, el servidor proxy debe admitir la configuración siguiente para lograr una respuesta de WinRM mejor y evitar errores de acceso denegado para los clientes de WinRM:</span><span class="sxs-lookup"><span data-stu-id="cc715-130">If HTTP must be used as the transport, the proxy server should support the following configuration to achieve a better WinRM response and to prevent access denied failures for WinRM clients:</span></span>

-   <span data-ttu-id="cc715-131">Compatibilidad con HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="cc715-131">Support for HTTP/1.1.</span></span> <span data-ttu-id="cc715-132">HTTP/1.1 es más estricto en la asignación de afinidad de conexión entre el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="cc715-132">HTTP/1.1 is more stringent in mapping connection affinity between client and server.</span></span>
-   <span data-ttu-id="cc715-133">Autenticación basada en conexión para la autenticación Negotiate, Kerberos y CredSSP.</span><span class="sxs-lookup"><span data-stu-id="cc715-133">Connection-based authentication for Negotiate, Kerberos, and CredSSP authentication.</span></span>

    <span data-ttu-id="cc715-134">La autenticación de una solicitud requiere varios recorridos de ida y vuelta entre el cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="cc715-134">Authentication of a request requires multiple round-trips between the client and server.</span></span> <span data-ttu-id="cc715-135">La mayor parte de la negociación de la autenticación se completa después de que el servidor de autenticación (WinRM) envía una respuesta al cliente que no es una respuesta 401 (no autorizado).</span><span class="sxs-lookup"><span data-stu-id="cc715-135">Most negotiation for authentication is complete after the authenticating (WinRM) server sends a response to the client that is not a 401 response (Unauthorized).</span></span> <span data-ttu-id="cc715-136">Si el servidor WinRM devuelve una respuesta al cliente que no es una respuesta 401, el proxy no debe cerrar la conexión.</span><span class="sxs-lookup"><span data-stu-id="cc715-136">If the WinRM server returns a response to the client that is not a 401 response, the proxy should not close the connection.</span></span>

    <span data-ttu-id="cc715-137">Se pueden enviar varios pares de solicitud/respuesta entre el cliente y el servidor antes de que se envíen los datos del paquete real.</span><span class="sxs-lookup"><span data-stu-id="cc715-137">Multiple request/response pairs can be sent between client and server before the actual packet data is sent.</span></span> <span data-ttu-id="cc715-138">WinRM 2,0 usa los esquemas de autenticación Negotiate y Kerberos con cifrado, que puede Agregar viajes de ida y vuelta adicionales.</span><span class="sxs-lookup"><span data-stu-id="cc715-138">WinRM 2.0 uses the Negotiate and Kerberos authentication schemes with encryption, which can add extra round-trips.</span></span> <span data-ttu-id="cc715-139">No se pueden enviar datos al servidor hasta que se complete la autenticación.</span><span class="sxs-lookup"><span data-stu-id="cc715-139">Data cannot be sent to the server until the authentication is complete.</span></span>

    <span data-ttu-id="cc715-140">El servidor WinRM devuelve una respuesta de nivel 200 que indica que se ha completado la autenticación.</span><span class="sxs-lookup"><span data-stu-id="cc715-140">The WinRM server returns a 200-level response that indicates that the authentication is complete.</span></span> <span data-ttu-id="cc715-141">Los servidores proxy basados en HTTP pueden finalizar la afinidad de autenticación basada en conexión y cerrar la conexión TCP/IP después de recibir la respuesta de nivel 200 desde el servidor WinRM.</span><span class="sxs-lookup"><span data-stu-id="cc715-141">HTTP-based proxy servers might end the connection-based authentication affinity and close the TCP/IP connection after receiving the 200-level response from the WinRM server.</span></span> <span data-ttu-id="cc715-142">El recorrido de ida y vuelta final del cliente al servidor no incluye el paquete de solicitud original.</span><span class="sxs-lookup"><span data-stu-id="cc715-142">The final round-trip from client to server does not include the original request packet.</span></span> <span data-ttu-id="cc715-143">Si el servidor proxy cierra la conexión, el servidor intentará volver a autenticar el cliente y la solicitud del cliente nunca se puede enviar al servidor.</span><span class="sxs-lookup"><span data-stu-id="cc715-143">If the proxy server closes the connection, the server will attempt to re-authenticate the client and the client request might never be sent to the server.</span></span> <span data-ttu-id="cc715-144">Si no se mantiene la afinidad basada en conexión, se puede producir un error de acceso denegado en la autenticación con el servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="cc715-144">If the connection-based affinity is not maintained, authentication against the destination server can fail with an access denied error.</span></span>

-   <span data-ttu-id="cc715-145">Persistencia de la conexión.</span><span class="sxs-lookup"><span data-stu-id="cc715-145">Connection persistence.</span></span> <span data-ttu-id="cc715-146">La conexión TCP/IP del cliente con el proxy debe seguir asignando a la misma conexión TCP/IP desde el proxy al servidor.</span><span class="sxs-lookup"><span data-stu-id="cc715-146">The client TCP/IP connection to the proxy should continue to map to the same TCP/IP connection from the proxy to the server.</span></span> <span data-ttu-id="cc715-147">Mantener esta conexión ayuda a lograr un mayor nivel de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="cc715-147">Maintaining this connection helps to achieve a higher level of performance.</span></span> <span data-ttu-id="cc715-148">Si no se mantiene la conexión, se debe volver a autenticar cada solicitud, lo que puede afectar al rendimiento.</span><span class="sxs-lookup"><span data-stu-id="cc715-148">If the connection is not maintained, every request must be re-authenticated, which might affect performance.</span></span>

### <a name="encryption-and-winrm-20"></a><span data-ttu-id="cc715-149">Cifrado e WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="cc715-149">Encryption and WinRM 2.0</span></span>

<span data-ttu-id="cc715-150">WinRM 2,0 admite el cifrado a través de HTTP mediante los esquemas de autenticación Negotiate, Kerberos y CredSSP.</span><span class="sxs-lookup"><span data-stu-id="cc715-150">WinRM 2.0 supports encryption over HTTP by using the Negotiate, Kerberos, and CredSSP authentication schemes.</span></span> <span data-ttu-id="cc715-151">Si un servidor WinRM admite HTTP y se obtiene acceso a él a través de un proxy, el servidor WinRM debe aplicar el cifrado y no permitir el tráfico de red no cifrado.</span><span class="sxs-lookup"><span data-stu-id="cc715-151">If a WinRM server supports HTTP and is accessed through a proxy, the WinRM server must enforce encryption and not allow unencrypted network traffic.</span></span>

<span data-ttu-id="cc715-152">En ningún caso, se deben enviar solicitudes HTTP sin cifrar a través de servidores proxy.</span><span class="sxs-lookup"><span data-stu-id="cc715-152">Under no circumstances should unencrypted HTTP requests be sent through proxy servers.</span></span> <span data-ttu-id="cc715-153">Cuando los datos deben pasar a través de un servidor proxy antes de enviarse al servidor de destino, son muy importantes los siguientes problemas de seguridad:</span><span class="sxs-lookup"><span data-stu-id="cc715-153">When data must pass through a proxy server before being sent to the destination server, the following security issues are very important:</span></span>

-   <span data-ttu-id="cc715-154">Es posible que un servidor proxy malintencionado examine cada par solicitud-respuesta, incluidas las credenciales.</span><span class="sxs-lookup"><span data-stu-id="cc715-154">It is possible that a malicious proxy server could examine every request/response pair, including credentials.</span></span>
-   <span data-ttu-id="cc715-155">Si las conexiones TCP/IP no se asignan de forma segura entre el cliente WinRM y el servidor proxy y entre el servidor proxy y el servidor de destino, un cliente no autorizado podría conectarse al servidor de destino utilizando la misma conexión autenticada del servidor proxy con el servidor de destino.</span><span class="sxs-lookup"><span data-stu-id="cc715-155">If the TCP/IP connections are not strongly mapped between both the WinRM client and the proxy server and between the proxy server and the destination server, an unauthorized client could connect to the destination server by using the same authenticated connection from the proxy server to the destination server.</span></span> <span data-ttu-id="cc715-156">El servidor de destino podría permitir el acceso del cliente no autenticado a los datos.</span><span class="sxs-lookup"><span data-stu-id="cc715-156">The destination server might allow the unauthenticated client access to data.</span></span> <span data-ttu-id="cc715-157">Si se aplica el cifrado, el servidor de destino envía un mensaje de acceso denegado al cliente no autenticado.</span><span class="sxs-lookup"><span data-stu-id="cc715-157">If encryption is enforced, the destination server sends an access denied message to the unauthenticated client.</span></span>

<span data-ttu-id="cc715-158">El uso del cifrado mitigaría estos posibles problemas de seguridad.</span><span class="sxs-lookup"><span data-stu-id="cc715-158">Using encryption would mitigate these potential security issues.</span></span>

## <a name="configuring-a-proxy-server-for-winrm-11-and-earlier"></a><span data-ttu-id="cc715-159">Configuración de un servidor proxy para WinRM 1,1 y versiones anteriores</span><span class="sxs-lookup"><span data-stu-id="cc715-159">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>

<span data-ttu-id="cc715-160">Si se requiere un proxy para llegar al servidor WinRM, el cliente WinRM se basa en la configuración del proxy de servicios HTTP de Windows (WinHTTP).</span><span class="sxs-lookup"><span data-stu-id="cc715-160">If a proxy is required to reach the WinRM server, the WinRM client relies on the Windows HTTP services (WinHTTP) proxy configuration.</span></span> <span data-ttu-id="cc715-161">De forma predeterminada, WinHTTP no está configurado para usar un servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="cc715-161">By default, WinHTTP is not configured to use a proxy server.</span></span> <span data-ttu-id="cc715-162">La configuración del proxy WinHTTP se puede cambiar mediante las utilidades de línea de comandos [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) o [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) .</span><span class="sxs-lookup"><span data-stu-id="cc715-162">WinHTTP proxy configuration can be changed by using the [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) or [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) command-line utilities.</span></span>

<span data-ttu-id="cc715-163">**WinRM 1,1 y versiones anteriores:** WinRM no utiliza la configuración de proxy de Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="cc715-163">**WinRM 1.1 and Earlier:** WinRM does not use the Internet Explorer proxy settings.</span></span>

 

 