---
description: 'La terminación de un proceso tiene los siguientes resultados: los subprocesos restantes del proceso se marcan para su finalización. Se liberan todos los recursos asignados por el proceso. Todos los objetos de kernel están cerrados. El código de proceso se quita de la memoria. Se establece el código de salida del proceso. Se señala el objeto de proceso.'
ms.assetid: af24d157-2719-4052-8029-1eb8010047cc
title: Finalizar un proceso
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2010f1d4332a575c8ee94cf1b0f196e00ba7fb9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105677827"
---
# <a name="terminating-a-process"></a><span data-ttu-id="9bfec-103">Finalizar un proceso</span><span class="sxs-lookup"><span data-stu-id="9bfec-103">Terminating a Process</span></span>

<span data-ttu-id="9bfec-104">La terminación de un proceso tiene los siguientes resultados:</span><span class="sxs-lookup"><span data-stu-id="9bfec-104">Terminating a process has the following results:</span></span>

-   <span data-ttu-id="9bfec-105">El resto de subprocesos del proceso se marcan para su finalización.</span><span class="sxs-lookup"><span data-stu-id="9bfec-105">Any remaining threads in the process are marked for termination.</span></span>
-   <span data-ttu-id="9bfec-106">Se liberan todos los recursos asignados por el proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-106">Any resources allocated by the process are freed.</span></span>
-   <span data-ttu-id="9bfec-107">Todos los objetos de kernel están cerrados.</span><span class="sxs-lookup"><span data-stu-id="9bfec-107">All kernel objects are closed.</span></span>
-   <span data-ttu-id="9bfec-108">El código de proceso se quita de la memoria.</span><span class="sxs-lookup"><span data-stu-id="9bfec-108">The process code is removed from memory.</span></span>
-   <span data-ttu-id="9bfec-109">Se establece el código de salida del proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-109">The process exit code is set.</span></span>
-   <span data-ttu-id="9bfec-110">Se señala el objeto de proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-110">The process object is signaled.</span></span>

<span data-ttu-id="9bfec-111">Aunque los identificadores abiertos para los objetos de kernel se cierran automáticamente cuando finaliza un proceso, los propios objetos existen hasta que se cierran todos los identificadores abiertos.</span><span class="sxs-lookup"><span data-stu-id="9bfec-111">While open handles to kernel objects are closed automatically when a process terminates, the objects themselves exist until all open handles to them are closed.</span></span> <span data-ttu-id="9bfec-112">Por lo tanto, un objeto seguirá siendo válido después de que un proceso que lo esté usando termine si otro proceso tiene un identificador abierto.</span><span class="sxs-lookup"><span data-stu-id="9bfec-112">Therefore, an object will remain valid after a process that is using it terminates if another process has an open handle to it.</span></span>

<span data-ttu-id="9bfec-113">La función [**API GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) devuelve el estado de finalización de un proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-113">The [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) function returns the termination status of a process.</span></span> <span data-ttu-id="9bfec-114">Mientras se ejecuta un proceso, el estado de finalización sigue siendo \_ activo.</span><span class="sxs-lookup"><span data-stu-id="9bfec-114">While a process is executing, its termination status is STILL\_ACTIVE.</span></span> <span data-ttu-id="9bfec-115">Cuando finaliza un proceso, su estado de finalización cambia de todavía \_ activo al código de salida del proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-115">When a process terminates, its termination status changes from STILL\_ACTIVE to the exit code of the process.</span></span>

<span data-ttu-id="9bfec-116">Cuando finaliza un proceso, se señala el estado del objeto de proceso y se liberan los subprocesos que estaban esperando a que finalizara el proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-116">When a process terminates, the state of the process object becomes signaled, releasing any threads that had been waiting for the process to terminate.</span></span> <span data-ttu-id="9bfec-117">Para obtener más información sobre la sincronización, vea [sincronizar la ejecución de varios subprocesos](synchronizing-execution-of-multiple-threads.md).</span><span class="sxs-lookup"><span data-stu-id="9bfec-117">For more about synchronization, see [Synchronizing Execution of Multiple Threads](synchronizing-execution-of-multiple-threads.md).</span></span>

<span data-ttu-id="9bfec-118">Cuando el sistema termina un proceso, no finaliza los procesos secundarios que haya creado el proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-118">When the system is terminating a process, it does not terminate any child processes that the process has created.</span></span> <span data-ttu-id="9bfec-119">La terminación de un proceso no genera notificaciones para \_ los procedimientos de enlace de CBT.</span><span class="sxs-lookup"><span data-stu-id="9bfec-119">Terminating a process does not generate notifications for WH\_CBT hook procedures.</span></span>

<span data-ttu-id="9bfec-120">Utilice la función [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) para especificar determinados aspectos de la terminación del proceso en el cierre del sistema, por ejemplo, cuando un proceso debe finalizar en relación con los demás procesos del sistema.</span><span class="sxs-lookup"><span data-stu-id="9bfec-120">Use the [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) function to specify certain aspects of the process termination at system shutdown, such as when a process should terminate relative to the other processes in the system.</span></span>

## <a name="how-processes-are-terminated"></a><span data-ttu-id="9bfec-121">Cómo se terminan los procesos</span><span class="sxs-lookup"><span data-stu-id="9bfec-121">How Processes are Terminated</span></span>

<span data-ttu-id="9bfec-122">Un proceso se ejecuta hasta que se produce uno de los siguientes eventos:</span><span class="sxs-lookup"><span data-stu-id="9bfec-122">A process executes until one of the following events occurs:</span></span>

-   <span data-ttu-id="9bfec-123">Cualquier subproceso del proceso llama a la función [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="9bfec-123">Any thread of the process calls the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span> <span data-ttu-id="9bfec-124">Tenga en cuenta que algunas implementaciones de la biblioteca en tiempo de ejecución de C (CRT) llaman a **ExitProcess** si el subproceso principal del proceso devuelve.</span><span class="sxs-lookup"><span data-stu-id="9bfec-124">Note that some implementation of the C run-time library (CRT) call **ExitProcess** if the primary thread of the process returns.</span></span>
-   <span data-ttu-id="9bfec-125">Finaliza el último subproceso del proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-125">The last thread of the process terminates.</span></span>
-   <span data-ttu-id="9bfec-126">Cualquier subproceso llama a la función [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) con un identificador para el proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-126">Any thread calls the [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) function with a handle to the process.</span></span>
-   <span data-ttu-id="9bfec-127">En los procesos de la consola, el [controlador de control de consola](/windows/console/console-control-handlers) predeterminado llama a [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) cuando la consola recibe una señal CTRL + C o Ctrl + Inter.</span><span class="sxs-lookup"><span data-stu-id="9bfec-127">For console processes, the default [console control handler](/windows/console/console-control-handlers) calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) when the console receives a CTRL+C or CTRL+BREAK signal.</span></span>
-   <span data-ttu-id="9bfec-128">El usuario apaga el sistema o cierra la sesión.</span><span class="sxs-lookup"><span data-stu-id="9bfec-128">The user shuts down the system or logs off.</span></span>

<span data-ttu-id="9bfec-129">No finalice un proceso a menos que sus subprocesos se encuentren en Estados conocidos.</span><span class="sxs-lookup"><span data-stu-id="9bfec-129">Do not terminate a process unless its threads are in known states.</span></span> <span data-ttu-id="9bfec-130">Si un subproceso está esperando en un objeto de kernel, no se terminará hasta que se haya completado la espera.</span><span class="sxs-lookup"><span data-stu-id="9bfec-130">If a thread is waiting on a kernel object, it will not be terminated until the wait has completed.</span></span> <span data-ttu-id="9bfec-131">Esto puede hacer que la aplicación deje de responder.</span><span class="sxs-lookup"><span data-stu-id="9bfec-131">This can cause the application to stop responding.</span></span>

<span data-ttu-id="9bfec-132">El subproceso principal puede evitar la terminación de otros subprocesos dirigiendo para llamar a [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) antes de hacer que finalice el proceso (para obtener más información, vea [finalizar un subproceso](terminating-a-thread.md)).</span><span class="sxs-lookup"><span data-stu-id="9bfec-132">The primary thread can avoid terminating other threads by directing them to call [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) before causing the process to terminate (for more information, see [Terminating a Thread](terminating-a-thread.md)).</span></span> <span data-ttu-id="9bfec-133">El subproceso principal todavía puede llamar a [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) posteriormente para asegurarse de que todos los subprocesos se terminan.</span><span class="sxs-lookup"><span data-stu-id="9bfec-133">The primary thread can still call [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) afterwards to ensure that all threads are terminated.</span></span>

<span data-ttu-id="9bfec-134">El código de salida de un proceso es el valor especificado en la llamada a [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) o [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), o el valor devuelto por la función Main o [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) del proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-134">The exit code for a process is either the value specified in the call to [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), or the value returned by the main or [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) function of the process.</span></span> <span data-ttu-id="9bfec-135">Si un proceso finaliza debido a una excepción grave, el código de salida es el valor de la excepción que provocó la terminación.</span><span class="sxs-lookup"><span data-stu-id="9bfec-135">If a process is terminated due to a fatal exception, the exit code is the value of the exception that caused the termination.</span></span> <span data-ttu-id="9bfec-136">Además, este valor se usa como código de salida para todos los subprocesos que se estaban ejecutando cuando se produjo la excepción.</span><span class="sxs-lookup"><span data-stu-id="9bfec-136">In addition, this value is used as the exit code for all the threads that were executing when the exception occurred.</span></span>

<span data-ttu-id="9bfec-137">Si [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess)finaliza un proceso, el sistema llama a la función de punto de entrada de cada dll asociada con un valor que indica que el proceso se está desasociando de la dll.</span><span class="sxs-lookup"><span data-stu-id="9bfec-137">If a process is terminated by [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), the system calls the entry-point function of each attached DLL with a value indicating that the process is detaching from the DLL.</span></span> <span data-ttu-id="9bfec-138">No se notifica a los archivos dll cuando [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess)finaliza un proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-138">DLLs are not notified when a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="9bfec-139">Para obtener más información acerca de los archivos dll, consulte [bibliotecas de vínculos dinámicos](../dlls/dynamic-link-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="9bfec-139">For more information about DLLs, see [Dynamic-Link Libraries](../dlls/dynamic-link-libraries.md).</span></span>

<span data-ttu-id="9bfec-140">Si [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess)finaliza un proceso, todos los subprocesos del proceso se terminan inmediatamente sin que sea posible ejecutar código adicional.</span><span class="sxs-lookup"><span data-stu-id="9bfec-140">If a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), all threads of the process are terminated immediately with no chance to run additional code.</span></span> <span data-ttu-id="9bfec-141">Esto significa que el subproceso no ejecuta código en los bloques de controladores de terminación.</span><span class="sxs-lookup"><span data-stu-id="9bfec-141">This means that the thread does not execute code in termination handler blocks.</span></span> <span data-ttu-id="9bfec-142">Además, no se notifica a ningún dll adjunto que el proceso se está desasociando.</span><span class="sxs-lookup"><span data-stu-id="9bfec-142">In addition, no attached DLLs are notified that the process is detaching.</span></span> <span data-ttu-id="9bfec-143">Si necesita que un proceso termine otro proceso, los pasos siguientes proporcionan una solución mejor:</span><span class="sxs-lookup"><span data-stu-id="9bfec-143">If you need to have one process terminate another process, the following steps provide a better solution:</span></span>

-   <span data-ttu-id="9bfec-144">Haga que ambos procesos llamen a la función [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) para crear un mensaje privado.</span><span class="sxs-lookup"><span data-stu-id="9bfec-144">Have both processes call the [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) function to create a private message.</span></span>
-   <span data-ttu-id="9bfec-145">Un proceso puede terminar el otro proceso difundiendo un mensaje privado mediante la función [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="9bfec-145">One process can terminate the other process by broadcasting a private message using the [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) function as follows:</span></span>

    ``` syntax
     DWORD dwRecipients = BSM_APPLICATIONS;
        UINT uMessage = PM_MYMSG;
        WPARAM wParam = 0;
        LPARAM lParam = 0;

        BroadcastSystemMessage( 
            BSF_IGNORECURRENTTASK, // do not send message to this process
            &dwRecipients,         // broadcast only to applications
            uMessage,              // registered private message
            wParam,                // message-specific value
            lParam );              // message-specific value
    ```

-   <span data-ttu-id="9bfec-146">El proceso que recibe el mensaje privado llama a [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) para finalizar su ejecución.</span><span class="sxs-lookup"><span data-stu-id="9bfec-146">The process receiving the private message calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) to terminate its execution.</span></span>

<span data-ttu-id="9bfec-147">La ejecución de las funciones [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)y [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) se serializa en un espacio de direcciones.</span><span class="sxs-lookup"><span data-stu-id="9bfec-147">The execution of the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), and [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) functions is serialized within an address space.</span></span> <span data-ttu-id="9bfec-148">Se aplican las restricciones que se indican a continuación:</span><span class="sxs-lookup"><span data-stu-id="9bfec-148">The following restrictions apply:</span></span>

-   <span data-ttu-id="9bfec-149">Durante el inicio del proceso y las rutinas de inicialización de DLL, se pueden crear nuevos subprocesos, pero no inician la ejecución hasta que finalice la inicialización del archivo DLL para el proceso.</span><span class="sxs-lookup"><span data-stu-id="9bfec-149">During process startup and DLL initialization routines, new threads can be created, but they do not begin execution until DLL initialization is finished for the process.</span></span>
-   <span data-ttu-id="9bfec-150">Solo un subproceso a la vez puede estar en una rutina de inicialización o desasociación de DLL.</span><span class="sxs-lookup"><span data-stu-id="9bfec-150">Only one thread at a time can be in a DLL initialization or detach routine.</span></span>
-   <span data-ttu-id="9bfec-151">La función [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) no devuelve hasta que no haya subprocesos en sus rutinas de inicialización o desasociación de dll.</span><span class="sxs-lookup"><span data-stu-id="9bfec-151">The [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function does not return until there are no threads are in their DLL initialization or detach routines.</span></span>

 

 
