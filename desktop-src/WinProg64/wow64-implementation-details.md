---
title: Detalles de la implementación de WOW64
description: El emulador WOW64 se ejecuta en modo usuario.
ms.assetid: 93daf9d0-dfdb-42c3-8c3d-397b21991e83
keywords:
- WOW64 64 bits programación de Windows, variables de entorno
- Programación de Windows de 64 de bits WOW64, implementación
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4c7d095369b883171e39bffd4dc629b7f80a7f39
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104149367"
---
# <a name="wow64-implementation-details"></a><span data-ttu-id="92c92-105">Detalles de la implementación de WOW64</span><span class="sxs-lookup"><span data-stu-id="92c92-105">WOW64 Implementation Details</span></span>

<span data-ttu-id="92c92-106">El emulador WOW64 se ejecuta en modo usuario.</span><span class="sxs-lookup"><span data-stu-id="92c92-106">The WOW64 emulator runs in user mode.</span></span> <span data-ttu-id="92c92-107">Proporciona una interfaz entre la versión de 32 bits de Ntdll.dll y el kernel del procesador e intercepta las llamadas de kernel.</span><span class="sxs-lookup"><span data-stu-id="92c92-107">It provides an interface between the 32-bit version of Ntdll.dll and the kernel of the processor, and it intercepts kernel calls.</span></span> <span data-ttu-id="92c92-108">El emulador WOW64 consta de los siguientes archivos dll:</span><span class="sxs-lookup"><span data-stu-id="92c92-108">The WOW64 emulator consists of the following DLLs:</span></span>

-   <span data-ttu-id="92c92-109">Wow64.dll proporciona la infraestructura de emulación principal y los códigos thunk para las funciones de punto de entrada Ntoskrnl.exe.</span><span class="sxs-lookup"><span data-stu-id="92c92-109">Wow64.dll provides the core emulation infrastructure and the thunks for the Ntoskrnl.exe entry-point functions.</span></span>
-   <span data-ttu-id="92c92-110">Wow64Win.dll proporciona códigos thunk para las funciones de punto de entrada Win32k.sys.</span><span class="sxs-lookup"><span data-stu-id="92c92-110">Wow64Win.dll provides thunks for the Win32k.sys entry-point functions.</span></span>
-   <span data-ttu-id="92c92-111">(solo x64) Wow64Cpu.dll proporciona compatibilidad para ejecutar programas x86 en x64.</span><span class="sxs-lookup"><span data-stu-id="92c92-111">(x64 only) Wow64Cpu.dll provides support for running x86 programs on x64.</span></span>
-   <span data-ttu-id="92c92-112">(Sólo Intel Itanium) IA32Exec. bin contiene el emulador de software x86.</span><span class="sxs-lookup"><span data-stu-id="92c92-112">(Intel Itanium only) IA32Exec.bin contains the x86 software emulator.</span></span>
-   <span data-ttu-id="92c92-113">(Intel Itanium Only) Wowia32x.dll proporciona la interfaz entre IA32Exec. bin y WOW64.</span><span class="sxs-lookup"><span data-stu-id="92c92-113">(Intel Itanium only) Wowia32x.dll provides the interface between IA32Exec.bin and WOW64.</span></span>
-   <span data-ttu-id="92c92-114">(Solo ARM64) xtajit.dll contiene el emulador de software x86.</span><span class="sxs-lookup"><span data-stu-id="92c92-114">(ARM64 only) xtajit.dll contains the x86 software emulator.</span></span>
-   <span data-ttu-id="92c92-115">(Solo ARM64) wowarmw.dll proporciona compatibilidad para ejecutar programas de ARM32 en ARM64.</span><span class="sxs-lookup"><span data-stu-id="92c92-115">(ARM64 only) wowarmw.dll provides support for running ARM32 programs on ARM64.</span></span>

<span data-ttu-id="92c92-116">Estos archivos dll, junto con la versión de 64 bits de Ntdll.dll, son los únicos archivos binarios de 64 bits que se pueden cargar en un proceso de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="92c92-116">These DLLs, along with the 64-bit version of Ntdll.dll, are the only 64-bit binaries that can be loaded into a 32-bit process.</span></span> <span data-ttu-id="92c92-117">En Windows 10 en ARM, los binarios de CHPE (archivos ejecutables híbridos compilados) también se pueden cargar en un proceso de 32 bits x86.</span><span class="sxs-lookup"><span data-stu-id="92c92-117">On Windows 10 on ARM, CHPE (Compiled Hybrid Portable Executable) binaries may also be loaded into an x86 32-bit process.</span></span>

<span data-ttu-id="92c92-118">Al iniciarse, Wow64.dll carga la versión x86 de Ntdll.dll (o la versión CHPE, si está habilitada) y ejecuta el código de inicialización, que carga todos los archivos dll de 32 bits necesarios.</span><span class="sxs-lookup"><span data-stu-id="92c92-118">At startup, Wow64.dll loads the x86 version of Ntdll.dll (or the CHPE version, if enabled) and runs its initialization code, which loads all necessary 32-bit DLLs.</span></span> <span data-ttu-id="92c92-119">Casi todos los archivos dll de 32 bits son copias sin modificar de archivos binarios de Windows de 32 bits, aunque algunos se cargan como CHPE por motivos de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="92c92-119">Almost all 32-bit DLLs are unmodified copies of 32-bit Windows binaries, though some are loaded as CHPE for performance reasons.</span></span> <span data-ttu-id="92c92-120">Algunos de estos archivos DLL se escriben para comportarse de forma diferente en WOW64 que en Windows de 32 bits, normalmente porque comparten memoria con componentes del sistema de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="92c92-120">Some of these DLLs are written to behave differently on WOW64 than they do on 32-bit Windows, usually because they share memory with 64-bit system components.</span></span> <span data-ttu-id="92c92-121">El sistema reserva todo el espacio de direcciones del modo de usuario por encima del límite de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="92c92-121">All user-mode address space above the 32-bit limit is reserved by the system.</span></span> <span data-ttu-id="92c92-122">Para obtener más información, consulte [rendimiento y consumo de memoria en WOW64](performance-and-memory-consumption.md).</span><span class="sxs-lookup"><span data-stu-id="92c92-122">For more information, see [Performance and Memory Consumption under WOW64](performance-and-memory-consumption.md).</span></span>

<span data-ttu-id="92c92-123">En lugar de utilizar la secuencia de llamada de servicio del sistema x86, se vuelven a generar los archivos binarios de 32 bits que realizan llamadas del sistema para usar una secuencia de llamada personalizada.</span><span class="sxs-lookup"><span data-stu-id="92c92-123">Instead of using the x86 system-service call sequence, 32-bit binaries that make system calls are rebuilt to use a custom calling sequence.</span></span> <span data-ttu-id="92c92-124">Esta secuencia de llamada es económica para que WOW64 la intercepte porque permanece completamente en modo de usuario.</span><span class="sxs-lookup"><span data-stu-id="92c92-124">This calling sequence is inexpensive for WOW64 to intercept because it remains entirely in user mode.</span></span> <span data-ttu-id="92c92-125">Cuando se detecta la secuencia de llamada personalizada, la CPU de WOW64 vuelve al modo de 64 bits nativo y llama a Wow64.dll.</span><span class="sxs-lookup"><span data-stu-id="92c92-125">When the custom calling sequence is detected, the WOW64 CPU transitions back to native 64-bit mode and calls into Wow64.dll.</span></span> <span data-ttu-id="92c92-126">El código thunk se realiza en modo de usuario para reducir el impacto en el kernel de 64 bits y para reducir el riesgo de que se produzca un error en el código thunk que podría provocar un bloqueo en modo kernel, daños en los datos o un agujero de seguridad.</span><span class="sxs-lookup"><span data-stu-id="92c92-126">Thunking is done in user mode to reduce the impact on the 64-bit kernel and to reduce the risk of a bug in the thunk that might cause a kernel-mode crash, data corruption, or a security hole.</span></span> <span data-ttu-id="92c92-127">Los códigos thunk extraen los argumentos de la pila de 32 bits, los amplían a 64 bits y, a continuación, realizan la llamada del sistema nativa.</span><span class="sxs-lookup"><span data-stu-id="92c92-127">The thunks extract arguments from the 32-bit stack, extend them to 64 bits, then make the native system call.</span></span>

## <a name="environment-variables"></a><span data-ttu-id="92c92-128">Variables de entorno</span><span class="sxs-lookup"><span data-stu-id="92c92-128">Environment Variables</span></span>

<span data-ttu-id="92c92-129">Cuando un proceso de 64 bits crea un proceso de 32 bits, o cuando se crea un proceso de 64 bits mediante un proceso de 32 bits, WOW64 establece las variables de entorno para el proceso creado tal como se muestra en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="92c92-129">When a 32-bit process is created by a 64-bit process, or when a 64-bit process is created by a 32-bit process, WOW64 sets the environment variables for the created process as shown in the following table.</span></span>



| <span data-ttu-id="92c92-130">Proceso</span><span class="sxs-lookup"><span data-stu-id="92c92-130">Process</span></span>                   | <span data-ttu-id="92c92-131">Variables de entorno</span><span class="sxs-lookup"><span data-stu-id="92c92-131">Environment variables</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="92c92-132">proceso de 64 bits</span><span class="sxs-lookup"><span data-stu-id="92c92-132">64-bit process</span></span><br/> | <span data-ttu-id="92c92-133">\_Arquitectura de procesador = AMD64 o \_ arquitectura de procesador = ia64 o arquitectura de procesador \_ = ARM64</span><span class="sxs-lookup"><span data-stu-id="92c92-133">PROCESSOR\_ARCHITECTURE=AMD64 or PROCESSOR\_ARCHITECTURE=IA64 or PROCESSOR\_ARCHITECTURE=ARM64</span></span><br/> <span data-ttu-id="92c92-134">ProgramFiles =% ProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="92c92-134">ProgramFiles=%ProgramFiles%</span></span><br/> <span data-ttu-id="92c92-135">ProgramW6432 =% ProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="92c92-135">ProgramW6432=%ProgramFiles%</span></span><br/> <span data-ttu-id="92c92-136">CommonProgramFiles =% CommonProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="92c92-136">CommonProgramFiles=%CommonProgramFiles%</span></span><br/> <span data-ttu-id="92c92-137">CommonProgramW6432 =% CommonProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="92c92-137">CommonProgramW6432=%CommonProgramFiles%</span></span><br/> <span data-ttu-id="92c92-138">**Windows server 2008, Windows Vista, Windows server 2003 y Windows XP:** Las variables de entorno ProgramW6432 y CommonProgramW6432 se agregaron a partir de Windows 7 y Windows Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="92c92-138">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** The ProgramW6432 and CommonProgramW6432 environment variables were added starting with Windows 7 and Windows Server 2008 R2.</span></span> <br/> |
| <span data-ttu-id="92c92-139">proceso de 32 bits</span><span class="sxs-lookup"><span data-stu-id="92c92-139">32-bit process</span></span><br/> | <span data-ttu-id="92c92-140">Arquitectura de procesador \_ = x86</span><span class="sxs-lookup"><span data-stu-id="92c92-140">PROCESSOR\_ARCHITECTURE=x86</span></span><br/> <span data-ttu-id="92c92-141">ARCHITEW6432 de procesador \_ =% de arquitectura de procesador \_ %</span><span class="sxs-lookup"><span data-stu-id="92c92-141">PROCESSOR\_ARCHITEW6432=%PROCESSOR\_ARCHITECTURE%</span></span><br/> <span data-ttu-id="92c92-142">ProgramFiles =% ProgramFiles (x86)%</span><span class="sxs-lookup"><span data-stu-id="92c92-142">ProgramFiles=%ProgramFiles(x86)%</span></span><br/> <span data-ttu-id="92c92-143">ProgramW6432 =% ProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="92c92-143">ProgramW6432=%ProgramFiles%</span></span><br/> <span data-ttu-id="92c92-144">CommonProgramFiles =% CommonProgramFiles (x86)%</span><span class="sxs-lookup"><span data-stu-id="92c92-144">CommonProgramFiles=%CommonProgramFiles(x86)%</span></span><br/> <span data-ttu-id="92c92-145">CommonProgramW6432 =% CommonProgramFiles%</span><span class="sxs-lookup"><span data-stu-id="92c92-145">CommonProgramW6432=%CommonProgramFiles%</span></span><br/>                                                                                                                                                                                                                  |



 

## <a name="global-hooks"></a><span data-ttu-id="92c92-146">Enlaces globales</span><span class="sxs-lookup"><span data-stu-id="92c92-146">Global Hooks</span></span>

<span data-ttu-id="92c92-147">La función [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa) se puede usar para insertar un archivo dll en otro proceso si se cumplen las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="92c92-147">The [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa) function can be used to inject a DLL into another process if the following conditions are met:</span></span>

-   <span data-ttu-id="92c92-148">Un archivo DLL de 32 bits solo se puede insertar en un proceso de 32 bits y un archivo DLL de 64 bits solo se puede insertar en un proceso de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="92c92-148">A 32-bit DLL can be injected only into a 32-bit process, and a 64-bit DLL can be injected only into a 64-bit process.</span></span> <span data-ttu-id="92c92-149">No es posible insertar un archivo DLL de 32 bits en un proceso de 64 bits o viceversa.</span><span class="sxs-lookup"><span data-stu-id="92c92-149">It is not possible to inject a 32-bit DLL into a 64-bit process or vice versa.</span></span>
-   <span data-ttu-id="92c92-150">Los archivos dll de 32 bits y 64 bits deben tener nombres diferentes.</span><span class="sxs-lookup"><span data-stu-id="92c92-150">The 32-bit and 64-bit DLLs must have different names.</span></span>
-   <span data-ttu-id="92c92-151">Las arquitecturas de la DLL y el proceso deben coincidir.</span><span class="sxs-lookup"><span data-stu-id="92c92-151">The architectures of the DLL and the process must match.</span></span> <span data-ttu-id="92c92-152">Por ejemplo, no se puede insertar un archivo DLL x86 de 32 bits en un proceso ARM de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="92c92-152">For instance, you cannot inject a 32-bit x86 DLL into a 32-bit ARM process.</span></span>

<span data-ttu-id="92c92-153">Para obtener más información, vea [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa).</span><span class="sxs-lookup"><span data-stu-id="92c92-153">For more information, see [**SetWindowsHookEx**](/windows/win32/api/winuser/nf-winuser-setwindowshookexa).</span></span>

<span data-ttu-id="92c92-154">Tenga en cuenta que se puede llamar a la **\_ acción del mouse**, **qu \_**, el **\_ diario \*** de qu, qu y el **\_ Shell** de bajo nivel en el subproceso que instaló el enlace, en lugar del subproceso que procesa el enlace.</span><span class="sxs-lookup"><span data-stu-id="92c92-154">Be aware that the **WH\_MOUSE**, **WH\_KEYBOARD**, **WH\_JOURNAL\***, **WH\_SHELL**, and low-level hooks can be called on the thread that installed the hook rather than the thread processing the hook.</span></span> <span data-ttu-id="92c92-155">Para estos enlaces, es posible que se llame a los enlaces de 32 bits y 64 bits si un enlace de 32 bits está por encima de un enlace de 64 bits en la cadena de enlace.</span><span class="sxs-lookup"><span data-stu-id="92c92-155">For these hooks, it is possible that both the 32-bit and 64-bit hooks will be called if a 32-bit hook is ahead of a 64-bit hook in the hook chain.</span></span> <span data-ttu-id="92c92-156">Para obtener más información, vea [usar enlaces](../winmsg/using-hooks.md).</span><span class="sxs-lookup"><span data-stu-id="92c92-156">For more information, see [Using Hooks](../winmsg/using-hooks.md).</span></span>

 

