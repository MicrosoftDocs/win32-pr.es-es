---
description: En este tema se describe cómo una aplicación se conecta a un grupo del mismo nivel mediante las API de agrupación del mismo nivel.
ms.assetid: 56fa28d8-3b3a-4cd5-8448-c8c4ce8d0b2c
title: Cómo conectarse a un grupo del mismo nivel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d5bb3f41342573742e634a6e7ebce283188f3ffd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105667427"
---
# <a name="how-to-connect-to-a-peer-group"></a><span data-ttu-id="ca3a2-103">Cómo conectarse a un grupo del mismo nivel</span><span class="sxs-lookup"><span data-stu-id="ca3a2-103">How to Connect to a Peer Group</span></span>

<span data-ttu-id="ca3a2-104">En este tema se describe cómo una aplicación se conecta a un grupo del mismo nivel mediante las API de agrupación del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-104">This topic discusses how an application connects to a peer group using the Peer Grouping APIs.</span></span>

## <a name="joining-a-peer-group"></a><span data-ttu-id="ca3a2-105">Unirse a un grupo del mismo nivel</span><span class="sxs-lookup"><span data-stu-id="ca3a2-105">Joining a Peer Group</span></span>

<span data-ttu-id="ca3a2-106">Para unirse a un grupo del mismo nivel, llame a [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), pasando el nombre de identidad del elemento del mismo nivel y la invitación (y un nombre de nube PNRP opcional, si el nombre de la nube en la invitación es ambiguo).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-106">To join a peer group, call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), passing in the identity name of the peer and the invitation (and an optional PNRP cloud name, if the cloud name in the invitation is ambiguous).</span></span>

<span data-ttu-id="ca3a2-107">Si se realiza correctamente, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) devuelve un identificador al grupo del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-107">If successful, [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) returns a handle to the peer group.</span></span>

<span data-ttu-id="ca3a2-108">Si el elemento del mismo nivel ha unido previamente el grupo del mismo nivel y, a continuación, ha cerrado el identificador, se debe volver a abrir el grupo del mismo nivel llamando a [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) y pasando el nombre del grupo del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-108">If the peer has previously joined the peer group and then closed the handle, the peer group should be reopened by calling [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) and passing in the name of the peer group.</span></span> <span data-ttu-id="ca3a2-109">Esta llamada devuelve un nuevo identificador de grupo del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-109">This call returns a new peer group handle.</span></span>

<span data-ttu-id="ca3a2-110">Una vez que el grupo del mismo nivel se ha unido correctamente, el elemento del mismo nivel puede conectarse directamente al grupo del mismo nivel y comenzar a interactuar llamando a [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-110">Once the peer group is successfully joined, the peer may connect directly to the peer group and begin interacting by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="ca3a2-111">Después de la conexión, se considera que el elemento del mismo nivel está "en línea".</span><span class="sxs-lookup"><span data-stu-id="ca3a2-111">After connecting, the peer is considered to be "online".</span></span>

<span data-ttu-id="ca3a2-112">Si una aplicación no va a interactuar con el grupo en el momento, puede permanecer sin conexión.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-112">If an application will not interact with the group at the time, it can remain "offline".</span></span> <span data-ttu-id="ca3a2-113">Si decide participar directamente en el grupo del mismo nivel en una instancia posterior, una llamada subsiguiente a [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) lo pondrá en línea.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-113">If it chooses to participate directly in the peer group at a later instance, a subsequent call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) will bring it online.</span></span> <span data-ttu-id="ca3a2-114">Una vez que un elemento del mismo nivel se une al grupo del mismo nivel, se debe conectar al menos una vez antes de poder publicar registros en el grupo del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-114">After a peer has joined the peer group, it must connect at least once before it will be able to publish records to the peer group.</span></span>

## <a name="opening-a-peer-group-without-connecting-offline"></a><span data-ttu-id="ca3a2-115">Abrir un grupo del mismo nivel sin conexión (sin conexión)</span><span class="sxs-lookup"><span data-stu-id="ca3a2-115">Opening a Peer Group Without Connecting (Offline)</span></span>

<span data-ttu-id="ca3a2-116">A menudo, puede que desee que una aplicación se conecte a un grupo del mismo nivel, pero no la participe directamente, la recepción y publicación de actualizaciones de registros, pero no el envío ni la recepción de mensajes de datos.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-116">Often, you may wish to have an application connect to a peer group but not directly participate it, receiving and publishing record updates but not sending or receiving data messages.</span></span> <span data-ttu-id="ca3a2-117">Una aplicación se encuentra en este estado "sin conexión" inmediatamente después de que se haya llamado a [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)o [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) .</span><span class="sxs-lookup"><span data-stu-id="ca3a2-117">An application is in this "offline" state immediately after [**PeerGroupCreate**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) have been called.</span></span>

<span data-ttu-id="ca3a2-118">Una aplicación sin conexión puede conectarse en cualquier momento llamando a [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-118">An offline application can go online at any time by calling [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect).</span></span> <span data-ttu-id="ca3a2-119">Una vez conectado, un grupo del mismo nivel no puede desconectarse hasta que todas las demás aplicaciones asociadas a esta identidad y que comparten este grupo también tengan conexiones cerradas con él.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-119">Once connected, a peer group cannot go offline until all other applications associated with this identity and sharing this group have closed connections to it as well.</span></span>

<span data-ttu-id="ca3a2-120">Un grupo del mismo nivel es un recurso compartido, con el mismo grupo del mismo nivel disponible para varias aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-120">A peer group is a shared resource, with the same peer group available to multiple applications.</span></span> <span data-ttu-id="ca3a2-121">Si hay más de una aplicación para la misma identidad y usuario de Windows que usa el mismo grupo del mismo nivel, también comparten la misma base de datos y las mismas conexiones subyacentes (vecinos y directos).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-121">If more than one application for the same identity and Windows user is using the same peer group, they also share the same underlying database and connections (neighbor and direct).</span></span> <span data-ttu-id="ca3a2-122">Si una de estas aplicaciones llama a [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), todas las demás aplicaciones de esta identidad o usuario que participa en el grupo también se conectan al grupo.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-122">If any one of these applications calls [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), all of the other applications for this identity/user participating in the group also connect to the group.</span></span> <span data-ttu-id="ca3a2-123">Si una aplicación agrega un registro mientras el grupo está sin conexión, otras aplicaciones también podrán verlo.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-123">If a record is added by one application while the group is offline, other applications are also be able to see it.</span></span> <span data-ttu-id="ca3a2-124">Como resultado, una aplicación debe estar lista para conectarse en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-124">As a result, an application must be ready to go online at any time.</span></span>

## <a name="connecting-to-a-peer-group-online"></a><span data-ttu-id="ca3a2-125">Conexión a un grupo del mismo nivel (en línea)</span><span class="sxs-lookup"><span data-stu-id="ca3a2-125">Connecting to a Peer Group (Online)</span></span>

<span data-ttu-id="ca3a2-126">Para empezar a participar en un grupo, llame a [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) después de crear, unirse o abrir el grupo.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-126">To begin participating in a group, call [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) after creating, joining, or opening the group.</span></span> <span data-ttu-id="ca3a2-127">En este estado, las conexiones directas se pueden abrir con otros elementos del mismo nivel que participan en el mismo grupo mediante una llamada a [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-127">In this state, direct connections can be opened with other peers participating in the same group by calling [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).</span></span>

<span data-ttu-id="ca3a2-128">Para detectar si se ha producido un error en un intento de conexión, Regístrese para el \_ evento error de conexión de eventos de grupo del mismo nivel \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="ca3a2-128">To detect if a connection attempt has failed, register for the PEER\_GROUP\_EVENT\_CONNECTION\_FAILED event.</span></span> <span data-ttu-id="ca3a2-129">Este evento se desencadena si la infraestructura de agrupación no puede encontrar otro miembro al que conectarse o si se produce un error en la conexión antes de que se sincronice la base de datos del grupo y no se puede establecer otra conexión.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-129">This event is raised if the grouping infrastructure cannot find another member to connect to, or if the connection fails before the group database is synchronized and another connection cannot be established.</span></span>

<span data-ttu-id="ca3a2-130">Aunque es posible que varias aplicaciones que se ejecutan en el mismo nivel y que participan en el mismo grupo con la misma identidad del mismo nivel estén sin conexión, una llamada a [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) por parte de cualquiera de las aplicaciones produce la conexión de todas las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-130">Although multiple applications executing on the peer and participating in the same group with the same peer identity may be offline, a call to [**PeerGroupConnect**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) by any one of the applications results in all of the applications becoming online.</span></span>

<span data-ttu-id="ca3a2-131">Además, si una aplicación del mismo nivel se ha conectado al grupo, las demás aplicaciones que llaman a [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) o [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) también se conectan de inmediato.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-131">Also, if one application on the peer has connected to the group, any other applications that call [**PeerGroupJoin**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) or [**PeerGroupOpen**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) are immediately connected as well.</span></span> <span data-ttu-id="ca3a2-132">Si una aplicación llama a [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), el identificador se cierra solo para esa aplicación.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-132">If an application calls [**PeerGroupClose**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), the handle is closed for only that application.</span></span> <span data-ttu-id="ca3a2-133">Por lo tanto, una llamada subsiguiente a **PeerGroupOpen** por parte de la aplicación devuelve un nuevo identificador de grupo y la aplicación se pone en línea inmediatamente si cualquier otra aplicación que participa en el mismo grupo sigue conectada.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-133">Thus, a subsequent call to **PeerGroupOpen** by the application returns a new group handle, and the application is brought online immediately if any other applications participating in the same group are still connected.</span></span>

## <a name="sending-and-receiving-data"></a><span data-ttu-id="ca3a2-134">Envío y recepción de datos</span><span class="sxs-lookup"><span data-stu-id="ca3a2-134">Sending and Receiving Data</span></span>

<span data-ttu-id="ca3a2-135">Para enviar y recibir datos entre nodos de miembros específicos del grupo, se deben establecer conexiones directas con los miembros con los que pretende interactuar.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-135">To send and receive data between specific member nodes in the group, direct connections must be established with those members you intend to interact with.</span></span> <span data-ttu-id="ca3a2-136">Establecer una conexión directa es una llamada asincrónica a [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), pasando el identificador de un grupo conectado y la identidad del elemento del mismo nivel dentro del grupo al que desea conectarse.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-136">Establishing a direct connection is an asynchronous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), passing in the handle for a connected group as well as the identity of the peer within the group you wish to connect to.</span></span> <span data-ttu-id="ca3a2-137">Este método devolverá un identificador de conexión.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-137">This method will return a connection ID.</span></span> <span data-ttu-id="ca3a2-138">Si la llamada se realiza correctamente, \_ \_ \_ \_ se genera un evento de conexión directa de evento de grupo del mismo nivel en el elemento del mismo nivel, validando el identificador de conexión.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-138">If the call is successful, a PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event is raised on the peer, validating the connection ID.</span></span>

<span data-ttu-id="ca3a2-139">Para recibir conexiones directas de otros equipos del mismo nivel en línea, Regístrese para el evento de conexión directa de evento de grupo del mismo nivel \_ \_ \_ \_ con una llamada a [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-139">To receive direct connections from other online peers, register for the PEER\_GROUP\_EVENT\_DIRECT\_CONNECTION event with a call to [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span>

<span data-ttu-id="ca3a2-140">Una vez que se ha establecido correctamente una conexión directa, la aplicación puede empezar a enviar datos con llamadas a [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), pasando el identificador de conexión válido.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-140">Once a direct connection has been successfully established, the application can begin sending data with calls to [**PeerGroupSendData**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), passing the valid connection ID.</span></span> <span data-ttu-id="ca3a2-141">El orden de las transmisiones de datos de varias partes se controla mediante **PeerGroupSendData**.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-141">The ordering of multipart data transmissions is handled by **PeerGroupSendData**.</span></span> <span data-ttu-id="ca3a2-142">Sin embargo, las aplicaciones deben implementar una pila de protocolos adecuada para controlar los datos opacos devueltos por esta llamada API.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-142">However, applications should implement a proper protocol stack for handling the opaque data returned by this API call.</span></span>

<span data-ttu-id="ca3a2-143">Para recibir datos a través de una conexión directa, la aplicación debe registrarse para el evento de datos de entrada de evento de grupo del mismo nivel \_ \_ \_ \_ con [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span><span class="sxs-lookup"><span data-stu-id="ca3a2-143">To receive data over a direct connection, the application must register for the PEER\_GROUP\_EVENT\_INCOMING\_DATA event with [**PeerGroupRegisterEvent**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).</span></span> <span data-ttu-id="ca3a2-144">El controlador de eventos es responsable de obtener y ordenar los datos opacos y pasarlos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-144">The event handler is responsible for obtaining and ordering the opaque data, and passing it to the application.</span></span> <span data-ttu-id="ca3a2-145">Estos datos se obtienen dentro del controlador de eventos mediante una llamada a [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) con el identificador de los eventos registrados.</span><span class="sxs-lookup"><span data-stu-id="ca3a2-145">This data is obtained within the event handler by calling [**PeerGroupGetEventData**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) with the handle to the registered events.</span></span>

<span data-ttu-id="ca3a2-146">Una conexión directa se cierra llamando a [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) y pasando el identificador de conexión obtenido por una llamada anterior a [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) o recibido en los datos de evento para \_ la \_ conexión directa del grupo de eventos del mismo nivel \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="ca3a2-146">A direct connection is closed by calling [**PeerGroupCloseDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) and passing in the connection ID obtained by a previous call to [**PeerGroupOpenDirectConnection**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) or received in the event data for PEER\_EVENT\_GROUP\_DIRECT\_CONNECTION.</span></span>

 

 



