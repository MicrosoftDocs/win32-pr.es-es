---
title: Usar DsAddSidHistory
description: En este tema se describe cómo usar la función DsAddSidHistory.
ms.assetid: cbf4983c-551d-4771-870e-a192ed898eb7
ms.tgt_platform: multiple
keywords:
- Usar DsAddSidHistory Active Directory
- Active Directory Active Directory, usar, uso de DsAddSidHistory
- DsAddSidHistory Active Directory, usar
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d45792dbd8c7a2bfa2dd047111a3ed165a2011e
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "103773045"
---
# <a name="using-dsaddsidhistory"></a><span data-ttu-id="bc61a-106">Usar DsAddSidHistory</span><span class="sxs-lookup"><span data-stu-id="bc61a-106">Using DsAddSidHistory</span></span>

<span data-ttu-id="bc61a-107">La función [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) obtiene el identificador de seguridad (SID) de la cuenta principal de una entidad de seguridad de un dominio (el dominio de origen) y lo agrega al atributo **SIDHistory** de una entidad de seguridad en otro dominio (destino) de un bosque diferente.</span><span class="sxs-lookup"><span data-stu-id="bc61a-107">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function gets the primary account security identifier (SID) of a security principal from one domain (the source domain) and adds it to the **sIDHistory** attribute of a security principal in another (destination) domain in a different forest.</span></span> <span data-ttu-id="bc61a-108">Cuando el dominio de origen está en modo nativo de Windows 2000, esta función también recupera los valores de **SIDHistory** de la entidad de seguridad de origen y los agrega al **SIDHistory** de la entidad de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-108">When the source domain is in Windows 2000 native mode, this function also retrieves the **sIDHistory** values of the source principal and adds them to the destination principal's **sIDHistory**.</span></span>

<span data-ttu-id="bc61a-109">La adición de SID al **SIDHistory** de una entidad de seguridad es una operación que tiene en cuenta la seguridad que concede de manera eficaz al principal de destino acceso a todos los recursos a los que puede tener acceso la entidad de seguridad de origen, siempre que existan confianzas desde los dominios de recursos aplicables al dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-109">Adding SIDs to a security principal's **sIDHistory** is a security-sensitive operation that effectively grants to the destination principal access to all resources accessible to the source principal, provided that trusts exist from applicable resource domains to the destination domain.</span></span>

<span data-ttu-id="bc61a-110">En un dominio de Windows 2000 en modo nativo, un inicio de sesión de usuario crea un token de acceso que contiene el SID de la cuenta principal del usuario y los SID de grupo, así como el **SIDHistory** del usuario y el **SIDHistory** de los grupos de los que el usuario es miembro.</span><span class="sxs-lookup"><span data-stu-id="bc61a-110">In a native mode Windows 2000 domain a user logon creates an access token that contains the user primary account SID and group SIDs, as well as the user **sIDHistory** and the **sIDHistory** of the groups of which the user is a member.</span></span> <span data-ttu-id="bc61a-111">Tener estos SID anteriores (valores **SIDHistory** ) en el token del usuario concede al usuario acceso a los recursos protegidos por las listas de control de acceso (ACL) que contienen los SID anteriores.</span><span class="sxs-lookup"><span data-stu-id="bc61a-111">Having these former SIDs (**sIDHistory** values) in the user's token grants the user access to resources protected by access-control lists (ACLs) containing the former SIDs.</span></span>

<span data-ttu-id="bc61a-112">Esta operación facilita determinados escenarios de implementación de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-112">This operation facilitates certain Windows 2000 deployment scenarios.</span></span> <span data-ttu-id="bc61a-113">En concreto, admite un escenario en el que se crean cuentas en un nuevo bosque de Windows 2000 para usuarios y grupos que ya existen en un entorno de producción de Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="bc61a-113">In particular, it supports a scenario in which accounts in a new Windows 2000 forest are created for users and groups that already exist in an Windows NT 4.0 production environment.</span></span> <span data-ttu-id="bc61a-114">Al colocar el SID de cuenta de Windows NT 4,0 en la cuenta de Windows 2000 **SIDHistory**, se conserva el acceso a los recursos de red para el usuario que inicia sesión en su nueva cuenta de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-114">By placing the Windows NT 4.0 account SID in the Windows 2000 account **sIDHistory**, access to network resources is preserved for the user logging onto his new Windows 2000 account.</span></span>

<span data-ttu-id="bc61a-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) también admite la migración de servidores de recursos de controladores de dominio de copia de seguridad (BDC) de windows NT 4,0 (o controladores de dominio y servidores miembro en un dominio de Windows 2000 en modo nativo) a un dominio de Windows 2000 como servidores miembro.</span><span class="sxs-lookup"><span data-stu-id="bc61a-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) also supports migration of Windows NT 4.0 backup domain controllers (BDCs) resource servers (or DCs and member servers in a native mode Windows 2000 domain) to a Windows 2000 domain as member servers.</span></span> <span data-ttu-id="bc61a-116">Esta migración requiere la creación, en el dominio de destino de Windows 2000, de los grupos locales de dominio que contengan, en su **SIDHistory**, los SID primarios de los grupos locales definidos en el BDC (o los grupos locales de dominio a los que se hace referencia en las ACL de los servidores de Windows 2000) del dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-116">This migration requires the creation, in the destination Windows 2000 domain, of domain local groups that contain, in their **sIDHistory**, the primary SIDs of the local groups defined on the BDC (or domain local groups referenced in ACLs on the Windows 2000 servers) in the source domain.</span></span> <span data-ttu-id="bc61a-117">Al crear un grupo local de destino que contiene el **SIDHistory** y todos los miembros del grupo local de origen, el acceso a los recursos de servidor migrados, protegidos por las ACL que hacen referencia al grupo local de origen, se mantiene para todos los miembros.</span><span class="sxs-lookup"><span data-stu-id="bc61a-117">By creating a destination local group containing the **sIDHistory** and all members of the source local group, access to the migrated server resources, protected by ACLs referencing the source local group, is maintained for all members.</span></span>

> [!Note]  
> <span data-ttu-id="bc61a-118">El uso de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiere un conocimiento de sus implicaciones administrativas y de seguridad más amplias en estos y otros escenarios.</span><span class="sxs-lookup"><span data-stu-id="bc61a-118">Use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an understanding of its broader administrative and security implications in these and other scenarios.</span></span> <span data-ttu-id="bc61a-119">Para obtener más información, vea las notas del producto "planear la migración desde Windows NT a Microsoft Windows 2000", que se proporciona como Dommig.doc en las herramientas de soporte de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-119">For more information, see the white paper "Planning Migration from Windows NT to Microsoft Windows 2000", delivered as Dommig.doc in the Windows 2000 Support Tools.</span></span> <span data-ttu-id="bc61a-120">Esta documentación también puede encontrarse en el CD del producto en \\ herramientas de soporte técnico \\ .</span><span class="sxs-lookup"><span data-stu-id="bc61a-120">This documentation may also be found on the product CD under \\support\\tools.</span></span>

 

## <a name="authorization-requirements"></a><span data-ttu-id="bc61a-121">Requisitos de autorización</span><span class="sxs-lookup"><span data-stu-id="bc61a-121">Authorization Requirements</span></span>

<span data-ttu-id="bc61a-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiere privilegios de administrador en los dominios de origen y de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires administrator privileges in the source and destination domains.</span></span> <span data-ttu-id="bc61a-123">En concreto, el autor de la llamada de esta API debe ser miembro del grupo administradores de dominio en el dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-123">Specifically, the caller of this API must be a member of the Domain Administrators group in the destination domain.</span></span> <span data-ttu-id="bc61a-124">Se realiza una comprobación de la pertenencia codificada de forma rígida.</span><span class="sxs-lookup"><span data-stu-id="bc61a-124">A hard-coded check for this membership is performed.</span></span> <span data-ttu-id="bc61a-125">Además, el autor de la llamada o la cuenta proporcionada en el parámetro *SrcDomainCreds* , si no **es null**, debe ser miembro del grupo administradores o administradores de dominio del dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-125">Also, the caller or the account provided in the *SrcDomainCreds* parameter, if not **NULL**, must be a member of either the Administrators or Domain Administrators group in the source domain.</span></span>

## <a name="domain-and-trust-requirements"></a><span data-ttu-id="bc61a-126">Requisitos de dominio y confianza</span><span class="sxs-lookup"><span data-stu-id="bc61a-126">Domain and Trust Requirements</span></span>

<span data-ttu-id="bc61a-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiere que el dominio de destino esté en modo nativo de Windows 2000 o posterior, porque solo este tipo de dominio admite el atributo **SIDHistory** .</span><span class="sxs-lookup"><span data-stu-id="bc61a-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the destination domain be in Windows 2000 native mode or later, because only this domain type supports the **sIDHistory** attribute.</span></span> <span data-ttu-id="bc61a-128">El dominio de origen puede ser Windows NT 4,0 o Windows 2000, modo mixto o nativo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-128">The source domain may be either Windows NT 4.0 or Windows 2000, mixed or native mode.</span></span> <span data-ttu-id="bc61a-129">Los dominios de origen y de destino no deben estar en el mismo bosque.</span><span class="sxs-lookup"><span data-stu-id="bc61a-129">The source and destination domains must not be in the same forest.</span></span> <span data-ttu-id="bc61a-130">Los dominios de Windows NT 4,0 son por definición y no están en un bosque.</span><span class="sxs-lookup"><span data-stu-id="bc61a-130">Windows NT 4.0 domains are by definition not in a forest.</span></span> <span data-ttu-id="bc61a-131">Esta restricción entre bosques garantiza que los SID duplicados, ya sean valores SID o **SIDHistory** principales, no se creen en el mismo bosque.</span><span class="sxs-lookup"><span data-stu-id="bc61a-131">This inter-forest constraint ensures that duplicate SIDs, whether appearing as primary SIDs or **sIDHistory** values, are not created in the same forest.</span></span>

<span data-ttu-id="bc61a-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiere una confianza externa desde el dominio de origen al dominio de destino en los casos que se indican en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="bc61a-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an external trust from the source domain to the destination domain in the cases listed in the following table.</span></span>



| <span data-ttu-id="bc61a-133">Caso</span><span class="sxs-lookup"><span data-stu-id="bc61a-133">Case</span></span>                                                                             | <span data-ttu-id="bc61a-134">Descripción</span><span class="sxs-lookup"><span data-stu-id="bc61a-134">Description</span></span>                                                                                                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="bc61a-135">El dominio de origen es Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-135">The source domain is Windows 2000.</span></span><br/>                                    | <span data-ttu-id="bc61a-136">El atributo **SIDHistory** de origen, disponible solo en los dominios de origen de Windows 2000, solo puede leerse mediante LDAP, lo que requiere que esta confianza sea para la protección de la integridad.</span><span class="sxs-lookup"><span data-stu-id="bc61a-136">The source **sIDHistory** attribute, available only in Windows 2000 source domains, may be read only using LDAP, which requires this trust for integrity protection.</span></span><br/>                                                                                             |
| <span data-ttu-id="bc61a-137">El dominio de origen es Windows NT 4,0 y *SrcDomainCreds* es **null**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-137">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span><br/> | <span data-ttu-id="bc61a-138">La suplantación, necesaria para admitir las operaciones de dominio de origen con las credenciales del autor de la llamada, depende de esta confianza.</span><span class="sxs-lookup"><span data-stu-id="bc61a-138">The impersonation, required to support source domain operations using the caller's credentials, depends on this trust.</span></span> <span data-ttu-id="bc61a-139">La suplantación también requiere que el controlador de dominio de destino tenga habilitada la opción de confianza para delegación de forma predeterminada en los controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="bc61a-139">Impersonation also requires that the destination domain controller has "Trusted for Delegation" enabled by default on domain controllers.</span></span><br/> |



 

<span data-ttu-id="bc61a-140">Sin embargo, no se requiere ninguna relación de confianza entre los dominios de origen y de destino si el dominio de origen es Windows NT 4,0 y *SrcDomainCreds* no es **null**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-140">However, there is no trust required between the source and destination domains if the source domain is Windows NT 4.0 and *SrcDomainCreds* is not **NULL**.</span></span>

## <a name="source-domain-controller-requirements"></a><span data-ttu-id="bc61a-141">Requisitos del controlador de dominio de origen</span><span class="sxs-lookup"><span data-stu-id="bc61a-141">Source Domain Controller Requirements</span></span>

<span data-ttu-id="bc61a-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requiere que el controlador de dominio, seleccionado como destino para las operaciones en el dominio de origen, sea el PDC en los dominios de windows NT 4,0 o el emulador de PDC en los dominios de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the domain controller, selected as the target for operations in the source domain, be the PDC in Windows NT 4.0 domains or the PDC Emulator in Windows 2000 domains.</span></span> <span data-ttu-id="bc61a-143">La auditoría de dominios de origen se genera mediante operaciones de escritura, por lo que el PDC es necesario en los dominios de origen de Windows NT 4,0 y la restricción solo de PDC garantiza que las auditorías de **DsAddSidHistory** se generan en un único equipo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-143">Source domain auditing is generated by way of write operations, therefore, the PDC is required in Windows NT 4.0 source domains, and the PDC-only restriction ensures that **DsAddSidHistory** audits are generated on a single computer.</span></span> <span data-ttu-id="bc61a-144">Esto reduce la necesidad de revisar los registros de auditoría de todos los controladores de archivos para supervisar el uso de esta operación.</span><span class="sxs-lookup"><span data-stu-id="bc61a-144">This reduces the need to review the audit logs of all DCs to monitor use of this operation.</span></span>

> [!Note]  
> <span data-ttu-id="bc61a-145">En los dominios de origen de Windows NT 4,0, el PDC (destino de las operaciones en el dominio de origen) debe ejecutar Service Pack 4 (SP4) y versiones posteriores para garantizar un soporte de auditoría adecuado.</span><span class="sxs-lookup"><span data-stu-id="bc61a-145">In Windows NT 4.0 source domains, the PDC (target of operations in the source domain) must be running Service Pack 4 (SP4) and later to ensure proper auditing support.</span></span>

 

<span data-ttu-id="bc61a-146">El siguiente valor del registro debe crearse como un \_ valor de REG DWORD y establecerse en 1 en el controlador de dominio de origen para los DC de origen de Windows NT 4,0 y windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-146">The following registry value must be created as a REG\_DWORD value and set to 1 on the source domain controller for both Windows NT 4.0 and Windows 2000 source DCs.</span></span>

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Control
            Lsa
               TcpipClientSupport
```

<span data-ttu-id="bc61a-147">Al establecer este valor, se habilitan las llamadas RPC a través del transporte TCP.</span><span class="sxs-lookup"><span data-stu-id="bc61a-147">Setting this value enables RPC calls over the TCP transport.</span></span> <span data-ttu-id="bc61a-148">Esto es necesario porque, de forma predeterminada, las interfaces SAMRPC solo son remotas en las canalizaciones con nombre.</span><span class="sxs-lookup"><span data-stu-id="bc61a-148">This is required because, by default, SAMRPC interfaces are remotable only on named pipes.</span></span> <span data-ttu-id="bc61a-149">El uso de canalizaciones con nombre da como resultado un sistema de administración de credenciales adecuado para los usuarios que inician sesión de forma interactiva mediante llamadas en red, pero no es flexible para un proceso del sistema que realiza llamadas de red con credenciales proporcionadas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="bc61a-149">Using named pipes results in a credential management system suitable for interactively logged-on users making networked calls, but is not flexible for a system process that makes network calls with user-supplied credentials.</span></span> <span data-ttu-id="bc61a-150">RPC sobre TCP es más adecuado para ese propósito.</span><span class="sxs-lookup"><span data-stu-id="bc61a-150">RPC over TCP is more suitable for that purpose.</span></span> <span data-ttu-id="bc61a-151">El establecimiento de este valor no reduce la seguridad del sistema.</span><span class="sxs-lookup"><span data-stu-id="bc61a-151">Setting this value does not diminish system security.</span></span> <span data-ttu-id="bc61a-152">Si se crea o cambia este valor, el controlador de dominio de origen debe reiniciarse para que esta configuración surta efecto.</span><span class="sxs-lookup"><span data-stu-id="bc61a-152">If this value is created or changed, the source domain controller must be restarted for this setting to take effect.</span></span>

<span data-ttu-id="bc61a-153">Se debe crear un nuevo grupo local, " <SrcDomainName> $ $ $", en el dominio de origen con fines de auditoría.</span><span class="sxs-lookup"><span data-stu-id="bc61a-153">A new local group, "<SrcDomainName>$$$", must be created in the source domain for auditing purposes.</span></span>

## <a name="auditing"></a><span data-ttu-id="bc61a-154">Auditoría</span><span class="sxs-lookup"><span data-stu-id="bc61a-154">Auditing</span></span>

<span data-ttu-id="bc61a-155">Las operaciones de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) se auditan para asegurarse de que los administradores de dominio de origen y de destino pueden detectar cuándo se ha ejecutado esta función.</span><span class="sxs-lookup"><span data-stu-id="bc61a-155">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations are audited to ensure that both source and destination domain administrators are able to detect when this function has been run.</span></span> <span data-ttu-id="bc61a-156">La auditoría es obligatoria en los dominios de origen y de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-156">Auditing is mandatory in both the source and destination domains.</span></span> <span data-ttu-id="bc61a-157">**DsAddSidHistory** comprueba que el modo auditoría está activado en cada dominio y que la auditoría de administración de cuentas de eventos correctos y erróneos está activada.</span><span class="sxs-lookup"><span data-stu-id="bc61a-157">**DsAddSidHistory** verifies that the Audit Mode is on in each domain and that Account Management auditing of Success/Failure events is on.</span></span> <span data-ttu-id="bc61a-158">En el dominio de destino, se genera un evento de auditoría "agregar historial de Sid" único para cada operación de **DsAddSidHistory** correcta o errónea.</span><span class="sxs-lookup"><span data-stu-id="bc61a-158">In the destination domain, a unique "Add Sid History" audit event is generated for each successful or failed **DsAddSidHistory** operation.</span></span>

<span data-ttu-id="bc61a-159">Los eventos de auditoría "agregar historial de Sid" únicos no están disponibles en los sistemas Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="bc61a-159">Unique "Add Sid History" audit events are not available on Windows NT 4.0 systems.</span></span> <span data-ttu-id="bc61a-160">Para generar eventos de auditoría que reflejen inequívocamente el uso de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) en el dominio de origen, realiza operaciones en un grupo especial cuyo nombre es el identificador único en el registro de auditoría.</span><span class="sxs-lookup"><span data-stu-id="bc61a-160">To generate audit events that unambiguously reflect use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) against the source domain, it performs operations on a special group whose name is the unique identifier in the audit log.</span></span> <span data-ttu-id="bc61a-161">Se <SrcDomainName> debe crear en el controlador de dominio de origen un grupo local, "$ $ $", cuyo nombre se componga del nombre NetBIOS del dominio de origen con tres signos de dólar ($) (código ASCII = 0x24 y Unicode = U + 0024).</span><span class="sxs-lookup"><span data-stu-id="bc61a-161">A local group, "<SrcDomainName>$$$", whose name is composed of the source domain NetBIOS name appended with three dollar signs ($) (ASCII code = 0x24 and Unicode = U+0024), must be created on the source domain controller prior to calling **DsAddSidHistory**.</span></span> <span data-ttu-id="bc61a-162">Cada usuario de origen y grupo global que es un destino de esta operación se agrega a y, a continuación, se quita de la pertenencia de este grupo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-162">Each source user and global group that is a target of this operation is added to and then removed from the membership of this group.</span></span> <span data-ttu-id="bc61a-163">Esto genera eventos de auditoría agregar miembro y eliminar miembro en el dominio de origen, que se pueden supervisar buscando eventos que hagan referencia al nombre del grupo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-163">This generates Add Member and Delete Member audit events in the source domain, which can be monitored by searching for events that reference the group name.</span></span>

> [!Note]  
> <span data-ttu-id="bc61a-164">Las operaciones de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) en grupos locales en un dominio de origen de modo mixto de windows NT 4,0 o Windows 2000 no se pueden auditar porque los grupos locales no se pueden convertir en miembros de otro grupo local y, por tanto, no se pueden agregar al <SrcDomainName> grupo local especial "$ $ $".</span><span class="sxs-lookup"><span data-stu-id="bc61a-164">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations on local groups in a Windows NT 4.0, or Windows 2000 mixed-mode source domain cannot be audited because local groups cannot be made members of another local group and therefore cannot be added to the special "<SrcDomainName>$$$" local group.</span></span> <span data-ttu-id="bc61a-165">Esta falta de auditoría no presenta un problema de seguridad en el dominio de origen, ya que esta operación no afecta al acceso a los recursos del dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-165">This lack of auditing does not present a security issue to the source domain, because source domain resource access is not affected by this operation.</span></span> <span data-ttu-id="bc61a-166">La adición del SID de un grupo local de origen a un grupo local de destino no concede acceso a los recursos de origen, protegidos por ese grupo local, a los usuarios adicionales.</span><span class="sxs-lookup"><span data-stu-id="bc61a-166">Adding the SID of a source local group to a destination local group does not grant access to source resources, protected by that local group, to any additional users.</span></span> <span data-ttu-id="bc61a-167">Al agregar miembros al grupo local de destino no se les concede acceso a los recursos de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-167">Adding members to the destination local group does not grant them access to source resources.</span></span> <span data-ttu-id="bc61a-168">A los miembros agregados solo se les concede acceso a los servidores del dominio de destino migrados desde el dominio de origen, que pueden tener recursos protegidos por el SID del grupo local de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-168">Added members are granted access only to servers in the destination domain migrated from the source domain, which may have resources protected by the source local group SID.</span></span>

 

## <a name="data-transmission-security"></a><span data-ttu-id="bc61a-169">Seguridad de transmisión de datos</span><span class="sxs-lookup"><span data-stu-id="bc61a-169">Data Transmission Security</span></span>

<span data-ttu-id="bc61a-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) exige las siguientes medidas de seguridad:</span><span class="sxs-lookup"><span data-stu-id="bc61a-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) enforces the following security measures:</span></span>

-   <span data-ttu-id="bc61a-171">Se llama desde una estación de trabajo de Windows 2000, las credenciales del autor de la llamada se usan para autenticar y proteger la llamada RPC en el controlador de dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-171">Called from a Windows 2000 workstation, the caller's credentials are used to authenticate and privacy-protect the RPC call to the destination domain controller.</span></span> <span data-ttu-id="bc61a-172">Si *SrcDomainCreds* no es **null**, la estación de trabajo y el controlador de dominio de destino deben admitir el cifrado de 128 bits para proteger las credenciales.</span><span class="sxs-lookup"><span data-stu-id="bc61a-172">If *SrcDomainCreds* is not **NULL**, both the workstation and the destination DC must support 128-bit encryption to privacy-protect the credentials.</span></span> <span data-ttu-id="bc61a-173">Si el cifrado de 128 bits no está disponible y se proporcionan *SrcDomainCreds* , se debe realizar la llamada en el controlador de dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-173">If 128-bit encryption is not available and *SrcDomainCreds* are provided, then the call must be made on the destination DC.</span></span>
-   <span data-ttu-id="bc61a-174">El controlador de dominio de destino se comunica con el controlador de dominio de origen mediante *SrcDomainCreds* o las credenciales del autor de la llamada para autenticar y proteger mutuamente la lectura del SID de la cuenta de origen (mediante una búsqueda de Sam) y **SIDHistory** (mediante una lectura LDAP).</span><span class="sxs-lookup"><span data-stu-id="bc61a-174">The destination domain controller communicates with the source domain controller using either *SrcDomainCreds* or the caller's credentials to mutually authenticate and integrity-protect the read of the source account SID (using a SAM lookup) and **sIDHistory** (using an LDAP read).</span></span>

## <a name="threat-models"></a><span data-ttu-id="bc61a-175">Modelos de amenazas</span><span class="sxs-lookup"><span data-stu-id="bc61a-175">Threat Models</span></span>

<span data-ttu-id="bc61a-176">En la tabla siguiente se enumeran las posibles amenazas asociadas a la llamada [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) y se abordan las medidas de seguridad correspondientes a la amenaza concreta.</span><span class="sxs-lookup"><span data-stu-id="bc61a-176">The following table lists the potential threats associated with the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) call and addresses the security measures pertinent to the particular threat.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="bc61a-177">Posible amenaza</span><span class="sxs-lookup"><span data-stu-id="bc61a-177">Potential threat</span></span></th>
<th><span data-ttu-id="bc61a-178">Medida de seguridad</span><span class="sxs-lookup"><span data-stu-id="bc61a-178">Security measure</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="bc61a-179">Ataque del intermediario</span><span class="sxs-lookup"><span data-stu-id="bc61a-179">Man in the Middle Attack</span></span><br/> <span data-ttu-id="bc61a-180">Un usuario no autorizado intercepta el <em>SID de búsqueda de la llamada de devolución del objeto de origen</em> , reemplazando el SID del objeto de origen por un SID arbitrario para la inserción en un objeto de destino SIDHistory.</span><span class="sxs-lookup"><span data-stu-id="bc61a-180">An unauthorized user intercepts the <em>lookup SID of source object</em> return call, replacing the source object SID with an arbitrary SID for insertion into a target object SIDhistory.</span></span><br/></td>
<td><span data-ttu-id="bc61a-181">El <em>SID de búsqueda del objeto de origen</em> es una RPC autenticada mediante las credenciales de administrador del autor de la llamada, con protección de mensajes de integridad de paquetes.</span><span class="sxs-lookup"><span data-stu-id="bc61a-181">The <em>lookup SID of source object</em> is an authenticated RPC, using the caller's administrator credentials, with packet integrity message protection.</span></span> <span data-ttu-id="bc61a-182">Esto garantiza que la llamada de devolución no se puede modificar sin detección.</span><span class="sxs-lookup"><span data-stu-id="bc61a-182">This ensures that the return call cannot be modified without detection.</span></span> <span data-ttu-id="bc61a-183">El controlador de dominio de destino crea un &quot; evento de auditoría agregar historial de SID único &quot; que refleja el SID agregado a la cuenta de destino <strong>SIDHistory</strong>.</span><span class="sxs-lookup"><span data-stu-id="bc61a-183">The destination domain controller creates a unique &quot;Add SID History&quot; audit event that reflects the SID added to the destination account <strong>sIDHistory</strong>.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="bc61a-184">Dominio de origen troyano</span><span class="sxs-lookup"><span data-stu-id="bc61a-184">Trojan Source Domain</span></span><br/> <span data-ttu-id="bc61a-185">Un usuario no autorizado crea un &quot; &quot; dominio de origen troyano en una red privada que tiene el mismo SID de dominio y algunos de los mismos SID de cuenta que el dominio de origen legítimo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-185">An unauthorized user creates a &quot;Trojan Horse&quot; source domain on a private network that has the same domain SID and some of the same account SIDs as the legitimate source domain.</span></span> <span data-ttu-id="bc61a-186">A continuación, el usuario no autorizado intenta ejecutar <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> en un dominio de destino para obtener el SID de una cuenta de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-186">The unauthorized user then attempts to run <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> in a destination domain to obtain the SID of a source account.</span></span> <span data-ttu-id="bc61a-187">Esto se hace sin necesidad de las credenciales de administrador de dominio de origen real y sin tener que mantener una traza de auditoría en el dominio de origen real.</span><span class="sxs-lookup"><span data-stu-id="bc61a-187">This is done without the need for the real source Domain Administrator credentials and without leaving an audit trail in the real source domain.</span></span> <span data-ttu-id="bc61a-188">El método del usuario no autorizado para crear el dominio de origen del caballo de Troya podría ser uno de los siguientes:</span><span class="sxs-lookup"><span data-stu-id="bc61a-188">The unauthorized user's method for creating the Trojan Horse source domain could be one of the following:</span></span>
<ul>
<li><span data-ttu-id="bc61a-189">Obtenga una copia (copia de seguridad de BDC) del dominio de origen SAM.</span><span class="sxs-lookup"><span data-stu-id="bc61a-189">Obtain a copy (BDC backup) of the source domain SAM.</span></span></li>
<li><span data-ttu-id="bc61a-190">Cree un nuevo dominio, modificando el SID del dominio en el disco para que coincida con el SID del dominio de origen legítimo y, a continuación, cree suficientes usuarios para crear una instancia de una cuenta con el SID deseado.</span><span class="sxs-lookup"><span data-stu-id="bc61a-190">Create a new domain, altering the domain SID on disk to match the legitimate source domain SID, then create enough users to instantiate an account with the desired SID.</span></span></li>
<li><span data-ttu-id="bc61a-191">Cree una réplica de BDC.</span><span class="sxs-lookup"><span data-stu-id="bc61a-191">Create a BDC replica.</span></span> <span data-ttu-id="bc61a-192">Esto requiere credenciales de administrador de dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-192">This requires source domain Administrator credentials.</span></span> <span data-ttu-id="bc61a-193">Después, el usuario no autorizado toma la réplica en una red privada para implementar el ataque.</span><span class="sxs-lookup"><span data-stu-id="bc61a-193">Then the unauthorized user takes the replica to a private network to implement the attack.</span></span></li>
</ul>
<br/></td>
<td><span data-ttu-id="bc61a-194">Aunque hay muchas maneras de que un usuario no autorizado recupere o cree un SID de objeto de origen deseado, el usuario no autorizado no podrá usarlo para actualizar el <strong>SIDHistory</strong> de una cuenta sin ser miembro del grupo administradores de dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-194">Although there are many ways for an unauthorized user to retrieve or create a desired source object SID, the unauthorized user cannot use it to update an account's <strong>sIDHistory</strong> without being a member of the destination Domain Administrators group.</span></span> <span data-ttu-id="bc61a-195">Dado que la comprobación, en el controlador de dominio de destino, para la pertenencia del administrador de dominio está codificada de forma rígida, en el DC de destino no hay ningún método para realizar una modificación de disco para cambiar los datos de control de acceso que protegen esta función.</span><span class="sxs-lookup"><span data-stu-id="bc61a-195">Because the check, on the destination domain controller, for Domain Administrator membership is hard-coded, on the target DC, there is no method for doing a disk modification to change the access control data protecting this function.</span></span> <span data-ttu-id="bc61a-196">Un intento de clonar una cuenta de origen troyano se audita en el dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-196">An attempt to clone a Trojan Horse source account is audited in the destination domain.</span></span> <span data-ttu-id="bc61a-197">Este ataque se mitiga al reservar la pertenencia al grupo de administradores de dominio solo para usuarios de plena confianza.</span><span class="sxs-lookup"><span data-stu-id="bc61a-197">This attack is mitigated by reserving membership in the Domain Administrators group for only highly trusted individuals.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="bc61a-198">Modificación en disco del historial de SID</span><span class="sxs-lookup"><span data-stu-id="bc61a-198">On-disk Modification of SID History</span></span><br/> <span data-ttu-id="bc61a-199">Un usuario no autorizado sofisticado, con credenciales de administrador de dominio y acceso físico a un controlador de dominio en el dominio de destino, podría modificar el valor <strong>SIDHistory</strong> de la cuenta en el disco.</span><span class="sxs-lookup"><span data-stu-id="bc61a-199">A sophisticated unauthorized user, with Domain Administrator credentials and with physical access to a DC in the destination domain, could modify an account <strong>sIDHistory</strong> value on disk.</span></span><br/></td>
<td><span data-ttu-id="bc61a-200">Este intento no se habilita mediante el uso de <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="bc61a-200">This attempt is not enabled by use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span></span> <span data-ttu-id="bc61a-201">Este ataque se mitiga al impedir el acceso físico a los controladores de dominio a todos los administradores excepto a los de plena confianza.</span><span class="sxs-lookup"><span data-stu-id="bc61a-201">This attack is mitigated by preventing physical access to domain controllers to all except highly trusted administrators.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="bc61a-202">Código no autorizado usado para quitar protecciones</span><span class="sxs-lookup"><span data-stu-id="bc61a-202">Rogue Code Used to Remove Protections</span></span><br/> <span data-ttu-id="bc61a-203">Un usuario no autorizado o un administrador no autorizado con acceso físico al código del servicio de directorio podría crear código no autorizado que:</span><span class="sxs-lookup"><span data-stu-id="bc61a-203">An unauthorized user or rogue administrator with physical access to the Directory Service code could create rogue code that:</span></span>
<ol>
<li><span data-ttu-id="bc61a-204">Quita la comprobación de la pertenencia al grupo administradores de dominio en el código.</span><span class="sxs-lookup"><span data-stu-id="bc61a-204">Removes the check for membership in the Domain Administrators group in the code.</span></span></li>
<li><span data-ttu-id="bc61a-205">Cambia las llamadas en el controlador de dominio de origen que señala el SID a un LookupSidFromName que no se audita.</span><span class="sxs-lookup"><span data-stu-id="bc61a-205">Changes the calls on the source domain controller that points the SID to a LookupSidFromName that is not audited.</span></span></li>
<li><span data-ttu-id="bc61a-206">Quita las llamadas de registro de auditoría.</span><span class="sxs-lookup"><span data-stu-id="bc61a-206">Removes audit log calls.</span></span></li>
</ol>
<br/></td>
<td><span data-ttu-id="bc61a-207">Alguien con acceso físico al código DS y lo suficientemente conocido para crear código no autorizado tiene la capacidad de modificar arbitrariamente el atributo <strong>SIDHistory</strong> de una cuenta.</span><span class="sxs-lookup"><span data-stu-id="bc61a-207">Someone with physical access to the DS code and knowledgeable enough to create rogue code has the capability of arbitrarily modifying the <strong>sIDHistory</strong> attribute of an account.</span></span> <span data-ttu-id="bc61a-208">La API de <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> no aumenta este riesgo de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc61a-208">The <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> API does not increase this security risk.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="bc61a-209">Recursos vulnerables a Sid robados</span><span class="sxs-lookup"><span data-stu-id="bc61a-209">Resources Vulnerable to Stolen SIDs</span></span><br/> <span data-ttu-id="bc61a-210">Si un usuario no autorizado ha realizado correctamente el uso de uno de los métodos descritos aquí para modificar la cuenta <strong>SIDHistory</strong>, y si los dominios de recursos de interés confían en el dominio de cuenta de usuario no autorizado, el usuario no autorizado puede obtener acceso no autorizado a los recursos del SID robado, potencialmente sin tener una pista de auditoría en el dominio de cuenta del que se ha robado el SID</span><span class="sxs-lookup"><span data-stu-id="bc61a-210">If an unauthorized user has succeeded in using one of the methods described here to modify an account <strong>sIDHistory</strong>, and if the resource domains of interest trust the unauthorized user account domain, then the unauthorized user can get unauthorized access to the stolen SID's resources, potentially without leaving an audit trail in the account domain from which the SID was stolen.</span></span><br/></td>
<td><span data-ttu-id="bc61a-211">Los administradores de dominio de recursos protegen sus recursos mediante la configuración de las relaciones de confianza que tienen sentido desde una perspectiva de seguridad.</span><span class="sxs-lookup"><span data-stu-id="bc61a-211">Resource domain administrators protect their resources by setting up only those trust relationships that make sense from a security perspective.</span></span> <span data-ttu-id="bc61a-212">El uso de <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> está restringido, en el dominio de destino de confianza, a los miembros del grupo administradores de dominio que ya tienen amplios permisos en el ámbito de sus responsabilidades.</span><span class="sxs-lookup"><span data-stu-id="bc61a-212">Use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> is restricted, in the trusted target domain, to members of the Domain Administrators group who already have broad permissions within the scope of their responsibilities.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="bc61a-213">Dominio de destino no autorizado</span><span class="sxs-lookup"><span data-stu-id="bc61a-213">Rogue Target Domain</span></span><br/> <span data-ttu-id="bc61a-214">Un usuario no autorizado crea un dominio de Windows 2000 con una cuenta cuyo <strong>SIDHistory</strong> contiene un SID que ha sido robado de un dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-214">An unauthorized user creates a Windows 2000 domain with an account whose <strong>sIDHistory</strong> contains a SID that has been stolen from a source domain.</span></span> <span data-ttu-id="bc61a-215">El usuario no autorizado utiliza esta cuenta para el acceso no autorizado a los recursos.</span><span class="sxs-lookup"><span data-stu-id="bc61a-215">The unauthorized user uses this account for unauthorized access to resources.</span></span><br/></td>
<td><span data-ttu-id="bc61a-216">El usuario no autorizado requiere credenciales de administrador para el dominio de origen con el fin de usar <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>y deja una pista de auditoría en el controlador de dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-216">The unauthorized user requires Administrator credentials for the source domain in order to use <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>, and leaves an audit trail on the source domain controller.</span></span> <span data-ttu-id="bc61a-217">El dominio de destino no autorizado obtiene acceso no autorizado solo en otros dominios que confían en el dominio no autorizado, que requiere privilegios de administrador en esos dominios de recursos.</span><span class="sxs-lookup"><span data-stu-id="bc61a-217">The rogue target domain gains unauthorized access only in other domains that trust the rogue domain, which requires Administrator privileges in those resource domains.</span></span><br/></td>
</tr>
</tbody>
</table>



 

## <a name="operational-constraints"></a><span data-ttu-id="bc61a-218">Restricciones operativas</span><span class="sxs-lookup"><span data-stu-id="bc61a-218">Operational Constraints</span></span>

<span data-ttu-id="bc61a-219">En esta sección se describen las restricciones operativas del uso de la función [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) .</span><span class="sxs-lookup"><span data-stu-id="bc61a-219">This section describes the operational constraints of using the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function.</span></span>

<span data-ttu-id="bc61a-220">El SID de *SrcPrincipal* no debe existir ya en el bosque de destino, ya sea como SID de la cuenta principal o en el **SIDHistory** de una cuenta.</span><span class="sxs-lookup"><span data-stu-id="bc61a-220">The SID of *SrcPrincipal* must not already exist in the destination forest, either as a primary account SID or in the **sIDHistory** of an account.</span></span> <span data-ttu-id="bc61a-221">La excepción es que [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) no genera un error al intentar agregar un SID a un **SIDHistory** que contiene un SID idéntico.</span><span class="sxs-lookup"><span data-stu-id="bc61a-221">The exception is that [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) does not generate an error when attempting to add a SID to a **sIDHistory** that contains an identical SID.</span></span> <span data-ttu-id="bc61a-222">Este comportamiento permite que **DsAddSidHistory** se ejecute varias veces con una entrada idéntica, lo que da como resultado un éxito y un estado final coherente, para facilitar el uso del desarrollador de herramientas.</span><span class="sxs-lookup"><span data-stu-id="bc61a-222">This behavior enables **DsAddSidHistory** to be run multiple times with identical input, resulting in success and a consistent end state, for tool developer ease-of-use.</span></span>

> [!Note]  
> <span data-ttu-id="bc61a-223">La latencia de replicación de catálogo global puede proporcionar una ventana durante la cual se pueden crear SID duplicados.</span><span class="sxs-lookup"><span data-stu-id="bc61a-223">Global Catalog replication latency may provide a window during which duplicate SIDs may be created.</span></span> <span data-ttu-id="bc61a-224">Sin embargo, un administrador puede eliminar fácilmente los SID duplicados.</span><span class="sxs-lookup"><span data-stu-id="bc61a-224">However, duplicate SIDs can be easily deleted by an administrator.</span></span>

 

<span data-ttu-id="bc61a-225">*SrcPrincipal* y *DstPrincipal* deben ser de uno de los tipos siguientes:</span><span class="sxs-lookup"><span data-stu-id="bc61a-225">*SrcPrincipal* and *DstPrincipal* must be one of the following types:</span></span>

-   <span data-ttu-id="bc61a-226">User (Usuario)</span><span class="sxs-lookup"><span data-stu-id="bc61a-226">User</span></span>
-   <span data-ttu-id="bc61a-227">Grupo con seguridad habilitada, incluido:</span><span class="sxs-lookup"><span data-stu-id="bc61a-227">Security Enabled Group, including:</span></span>

    <dl> <span data-ttu-id="bc61a-228">Grupo local</span><span class="sxs-lookup"><span data-stu-id="bc61a-228">Local group</span></span>  
    <span data-ttu-id="bc61a-229">Grupo global</span><span class="sxs-lookup"><span data-stu-id="bc61a-229">Global group</span></span>  
    <span data-ttu-id="bc61a-230">Grupo local de dominio (solo en modo nativo de Windows 2000)</span><span class="sxs-lookup"><span data-stu-id="bc61a-230">Domain local group (Windows 2000 native mode only)</span></span>  
    <span data-ttu-id="bc61a-231">Grupo universal (solo en modo nativo de Windows 2000)</span><span class="sxs-lookup"><span data-stu-id="bc61a-231">Universal group (Windows 2000 native mode only)</span></span>  
    </dl>

<span data-ttu-id="bc61a-232">Los tipos de objeto de *SrcPrincipal* y *DstPrincipal* deben coincidir.</span><span class="sxs-lookup"><span data-stu-id="bc61a-232">The object types of *SrcPrincipal* and *DstPrincipal* must match.</span></span>

-   <span data-ttu-id="bc61a-233">Si *SrcPrincipal* es un usuario, *DstPrincipal* debe ser un usuario.</span><span class="sxs-lookup"><span data-stu-id="bc61a-233">If *SrcPrincipal* is a User, *DstPrincipal* must be a User.</span></span>
-   <span data-ttu-id="bc61a-234">Si *SrcPrincipal* es un grupo local de dominio o local, *DstPrincipal* debe ser un grupo local de dominio.</span><span class="sxs-lookup"><span data-stu-id="bc61a-234">If *SrcPrincipal* is a Local or Domain Local Group, *DstPrincipal* must be a Domain Local Group.</span></span>
-   <span data-ttu-id="bc61a-235">Si *SrcPrincipal* es un grupo global o universal, *DstPrincipal* debe ser un grupo global o universal.</span><span class="sxs-lookup"><span data-stu-id="bc61a-235">If *SrcPrincipal* is a Global or Universal Group, *DstPrincipal* must be a Global or Universal Group.</span></span>

<span data-ttu-id="bc61a-236">*SrcPrincipal* y *DstPrincipal* no pueden ser de uno de los tipos siguientes: ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) produce un error en estos casos)</span><span class="sxs-lookup"><span data-stu-id="bc61a-236">*SrcPrincipal* and *DstPrincipal* cannot be one of the following types: ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) fails with an error in these cases)</span></span>

-   <span data-ttu-id="bc61a-237">Equipo (estación de trabajo o controlador de dominio)</span><span class="sxs-lookup"><span data-stu-id="bc61a-237">Computer (workstation or domain controller)</span></span>
-   <span data-ttu-id="bc61a-238">Confianza entre dominios</span><span class="sxs-lookup"><span data-stu-id="bc61a-238">Inter-domain trust</span></span>
-   <span data-ttu-id="bc61a-239">Cuenta temporal duplicada (característica prácticamente sin usar, una heredada de LANman)</span><span class="sxs-lookup"><span data-stu-id="bc61a-239">Temporary duplicate account (virtually unused feature, a legacy of LANman)</span></span>
-   <span data-ttu-id="bc61a-240">Cuentas con SID conocidos.</span><span class="sxs-lookup"><span data-stu-id="bc61a-240">Accounts with Well Known SIDs.</span></span> <span data-ttu-id="bc61a-241">Los SID conocidos son idénticos en todos los dominios; por lo tanto, si se agregan a un **SIDHistory** , se infringiría el requisito de unicidad del SID de un bosque de Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="bc61a-241">Well Known SIDs are identical in every domain; thus adding them to a **sIDHistory** would violate the SID uniqueness requirement of a Windows 2000 forest.</span></span> <span data-ttu-id="bc61a-242">Entre las cuentas con SID conocidos se incluyen los siguientes grupos locales:</span><span class="sxs-lookup"><span data-stu-id="bc61a-242">Accounts with Well Known SIDs include the following local groups:</span></span>

    <dl> <span data-ttu-id="bc61a-243">Operadores de cuentas</span><span class="sxs-lookup"><span data-stu-id="bc61a-243">Account operators</span></span>  
    <span data-ttu-id="bc61a-244">Administradores</span><span class="sxs-lookup"><span data-stu-id="bc61a-244">Administrators</span></span>  
    <span data-ttu-id="bc61a-245">Operadores de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="bc61a-245">Backup operators</span></span>  
    <span data-ttu-id="bc61a-246">Invitados</span><span class="sxs-lookup"><span data-stu-id="bc61a-246">Guests</span></span>  
    <span data-ttu-id="bc61a-247">Operadores de impresión</span><span class="sxs-lookup"><span data-stu-id="bc61a-247">Print operators</span></span>  
    <span data-ttu-id="bc61a-248">Duplicadores</span><span class="sxs-lookup"><span data-stu-id="bc61a-248">Replicator</span></span>  
    <span data-ttu-id="bc61a-249">Operadores de servidores</span><span class="sxs-lookup"><span data-stu-id="bc61a-249">Server operators</span></span>  
    <span data-ttu-id="bc61a-250">Usuarios</span><span class="sxs-lookup"><span data-stu-id="bc61a-250">Users</span></span>  
    </dl>

<span data-ttu-id="bc61a-251">Si *SrcPrincipal* tiene un identificador relativo (RID) conocido y un prefijo específico del dominio, es decir, administradores de dominio, usuarios del dominio y equipos del dominio, *DstPrincipal* debe poseer el mismo RID conocido en orden para que [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) se realice correctamente.</span><span class="sxs-lookup"><span data-stu-id="bc61a-251">If *SrcPrincipal* has a well-known relative identifier (RID) and a domain specific prefix, that is, Domain Administrators, Domain Users, and Domain Computers, then *DstPrincipal* must possess the same well-known RID in order for [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) to succeed.</span></span> <span data-ttu-id="bc61a-252">Entre las cuentas con RID bien conocido se incluyen los siguientes usuarios y grupos globales:</span><span class="sxs-lookup"><span data-stu-id="bc61a-252">Accounts with well-known RIDs include the following users and global groups:</span></span>

-   <span data-ttu-id="bc61a-253">Administrador</span><span class="sxs-lookup"><span data-stu-id="bc61a-253">Administrator</span></span>
-   <span data-ttu-id="bc61a-254">Invitado</span><span class="sxs-lookup"><span data-stu-id="bc61a-254">Guest</span></span>
-   <span data-ttu-id="bc61a-255">Administradores de dominio</span><span class="sxs-lookup"><span data-stu-id="bc61a-255">Domain administrators</span></span>
-   <span data-ttu-id="bc61a-256">Invitados de dominio</span><span class="sxs-lookup"><span data-stu-id="bc61a-256">Domain guests</span></span>
-   <span data-ttu-id="bc61a-257">Usuarios de dominio</span><span class="sxs-lookup"><span data-stu-id="bc61a-257">Domain users</span></span>

## <a name="setting-the-registry-value"></a><span data-ttu-id="bc61a-258">Establecer el valor del registro</span><span class="sxs-lookup"><span data-stu-id="bc61a-258">Setting the Registry Value</span></span>

<span data-ttu-id="bc61a-259">En el procedimiento siguiente se muestra cómo establecer el valor TcpipClientSupport del registro.</span><span class="sxs-lookup"><span data-stu-id="bc61a-259">The following procedure shows how to set the TcpipClientSupport registry value.</span></span>

<span data-ttu-id="bc61a-260">**Para establecer el valor del registro TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="bc61a-260">**To Set the TcpipClientSupport Registry Value**</span></span>

1.  <span data-ttu-id="bc61a-261">Cree el siguiente valor del registro como un \_ valor de REG DWORD en el controlador de dominio de origen y establezca su valor en 1.</span><span class="sxs-lookup"><span data-stu-id="bc61a-261">Create the following registry value as a REG\_DWORD value on the source domain controller and set its value to 1.</span></span>

    <span data-ttu-id="bc61a-262">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ control \\ LSA \\ TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="bc61a-262">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\TcpipClientSupport**</span></span>

2.  <span data-ttu-id="bc61a-263">A continuación, reinicie el controlador de dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-263">Then, restart the source domain controller.</span></span> <span data-ttu-id="bc61a-264">Este valor del registro hace que SAM escuche en TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="bc61a-264">This registry value causes the SAM to listen on TCP/IP.</span></span> <span data-ttu-id="bc61a-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) producirá un error si no se establece este valor en el controlador de dominio de origen.</span><span class="sxs-lookup"><span data-stu-id="bc61a-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) will fail if this value is not set on the source domain controller.</span></span>

## <a name="enabling-auditing-of-usergroup-management-events"></a><span data-ttu-id="bc61a-266">Habilitar la auditoría de eventos de administración de usuarios y grupos</span><span class="sxs-lookup"><span data-stu-id="bc61a-266">Enabling Auditing of User/Group Management Events</span></span>

<span data-ttu-id="bc61a-267">El siguiente procedimiento muestra cómo habilitar la auditoría de eventos de administración de usuarios o grupos en un dominio de origen o destino de Windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="bc61a-267">The following procedure shows how to enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain.</span></span>

<span data-ttu-id="bc61a-268">**Para habilitar la auditoría de eventos de administración de usuarios o grupos en un dominio de origen o destino de Windows 2000 o Windows Server 2003**</span><span class="sxs-lookup"><span data-stu-id="bc61a-268">**To enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain**</span></span>

1.  <span data-ttu-id="bc61a-269">En el complemento MMC usuarios y equipos de Active Directory, seleccione el contenedor controladores de dominio del dominio de destino.</span><span class="sxs-lookup"><span data-stu-id="bc61a-269">In the Active Directory Users and Computers MMC Snap-in, select the destination domain Domain Controllers container.</span></span>
2.  <span data-ttu-id="bc61a-270">Haga clic con el botón secundario en **controladores de dominio** y elija **propiedades**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-270">Right-click **Domain Controllers** and choose **Properties**.</span></span>
3.  <span data-ttu-id="bc61a-271">Haga clic en la pestaña **Directiva de grupo** .</span><span class="sxs-lookup"><span data-stu-id="bc61a-271">Click the **Group Policy** tab.</span></span>
4.  <span data-ttu-id="bc61a-272">Seleccione la **directiva predeterminada de controladores de dominio** y haga clic en **Editar**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-272">Select the **Default Domain Controllers Policy** and click **Edit**.</span></span>
5.  <span data-ttu-id="bc61a-273">En **configuración del equipo Configuración de \\ Windows \\ configuración de seguridad \\ Directivas locales \\ Directiva de auditoría**, haga doble clic en **auditar la administración de cuentas**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-273">Under **Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Audit Policy**, double-click **Audit Account Management**.</span></span>
6.  <span data-ttu-id="bc61a-274">En la ventana **Auditoría de administración de cuentas** , seleccione auditoría de **aciertos** y **errores** .</span><span class="sxs-lookup"><span data-stu-id="bc61a-274">In the **Audit Account Management** window, select both **Success** and **Failure** auditing.</span></span> <span data-ttu-id="bc61a-275">Las actualizaciones de directivas surten efecto después de un reinicio o cuando se produce una actualización.</span><span class="sxs-lookup"><span data-stu-id="bc61a-275">Policy updates take effect after a restart or after a refresh occurs.</span></span>
7.  <span data-ttu-id="bc61a-276">Compruebe que la auditoría está habilitada mediante la visualización de la Directiva de auditoría efectiva en el complemento MMC de directiva de grupo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-276">Verify that auditing is enabled by viewing the effective audit policy in the Group Policy MMC Snap-in.</span></span>

<span data-ttu-id="bc61a-277">El siguiente procedimiento muestra cómo habilitar la auditoría de eventos de administración de usuarios o grupos en un dominio de Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="bc61a-277">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0 domain.</span></span>

<span data-ttu-id="bc61a-278">**Para habilitar la auditoría de eventos de administración de usuarios o grupos en un dominio de Windows NT 4,0**</span><span class="sxs-lookup"><span data-stu-id="bc61a-278">**To enable auditing of User/Group management events in a Windows NT 4.0 domain**</span></span>

1.  <span data-ttu-id="bc61a-279">En **Administrador de usuarios para dominios**, haga clic en el menú **directivas** y seleccione **Auditoría**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-279">In **User Manager for Domains**, click the **Policies** menu and select **Audit**.</span></span>
2.  <span data-ttu-id="bc61a-280">Seleccione **auditar estos eventos**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-280">Select **Audit These Events**.</span></span>
3.  <span data-ttu-id="bc61a-281">Para la **Administración de usuarios y grupos**, compruebe que la operación se ha **realizado correctamente**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-281">For **User and Group Management**, check **Success and Failure**.</span></span>

<span data-ttu-id="bc61a-282">El siguiente procedimiento muestra cómo habilitar la auditoría de eventos de administración de usuarios o grupos en un dominio de origen de Windows NT 4,0, Windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="bc61a-282">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain.</span></span>

<span data-ttu-id="bc61a-283">**Para habilitar la auditoría de eventos de administración de usuarios o grupos en un dominio de origen de Windows NT 4,0, Windows 2000 o Windows Server 2003**</span><span class="sxs-lookup"><span data-stu-id="bc61a-283">**To enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain**</span></span>

1.  <span data-ttu-id="bc61a-284">En **Administrador de usuarios para dominios**, haga clic en el menú **usuario** y seleccione **nuevo grupo local**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-284">In **User Manager for Domains**, click the **User** menu and select **New Local Group**.</span></span>
2.  <span data-ttu-id="bc61a-285">Escriba un nombre de grupo compuesto por el nombre NetBIOS del dominio de origen anexado con tres signos de dólar ($), por ejemplo, FABRIKAM $ $ $.</span><span class="sxs-lookup"><span data-stu-id="bc61a-285">Enter a group name composed of the source domain NetBIOS name appended with three dollar signs ($), for example, FABRIKAM$$$.</span></span> <span data-ttu-id="bc61a-286">El campo de descripción debe indicar que este grupo se utiliza para auditar el uso de [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) o las operaciones de clonación.</span><span class="sxs-lookup"><span data-stu-id="bc61a-286">The description field should indicate that this group is used to audit use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) or cloning operations.</span></span> <span data-ttu-id="bc61a-287">Asegúrese de que no hay miembros en el grupo.</span><span class="sxs-lookup"><span data-stu-id="bc61a-287">Ensure there are no members in the group.</span></span> <span data-ttu-id="bc61a-288">Haga clic en **OK**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-288">Click **OK**.</span></span>

<span data-ttu-id="bc61a-289">Se produce un error en la operación [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) si la auditoría de origen y de destino no está habilitada como se describe aquí.</span><span class="sxs-lookup"><span data-stu-id="bc61a-289">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operation fails if source and destination auditing are not enabled as described here.</span></span>

## <a name="set-up-trust-if-required"></a><span data-ttu-id="bc61a-290">Configuración de la confianza si es necesario</span><span class="sxs-lookup"><span data-stu-id="bc61a-290">Set up Trust if Required</span></span>

<span data-ttu-id="bc61a-291">Si se cumple una de las siguientes condiciones, se debe establecer una relación de confianza desde el dominio de origen al dominio de destino (esto debe ocurrir en un bosque diferente):</span><span class="sxs-lookup"><span data-stu-id="bc61a-291">If one of the following is true, a trust must be established from the source domain to the destination domain (this must occur in a different forest):</span></span>

-   <span data-ttu-id="bc61a-292">El dominio de origen es Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="bc61a-292">The source domain is Windows Server 2003.</span></span>
-   <span data-ttu-id="bc61a-293">El dominio de origen es Windows NT 4,0 y *SrcDomainCreds* es **null**.</span><span class="sxs-lookup"><span data-stu-id="bc61a-293">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span>

 

 





