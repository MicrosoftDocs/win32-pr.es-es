---
description: Windows Sockets 2 es compatible con e/s superpuestas y todos los proveedores de transporte admiten esta funcionalidad.
ms.assetid: b36ab606-df1a-4254-b048-6d47eb366275
title: Objetos de eventos e/s superpuestos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ed034f06243959d94a1ada7eaa71e33c84cd35ee
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105705601"
---
# <a name="overlapped-io-and-event-objects"></a><span data-ttu-id="b541f-103">Objetos de eventos e/s superpuestos</span><span class="sxs-lookup"><span data-stu-id="b541f-103">Overlapped I/O and Event Objects</span></span>

<span data-ttu-id="b541f-104">Windows Sockets 2 es compatible con e/s superpuestas y todos los proveedores de transporte admiten esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="b541f-104">Windows Sockets 2 supports overlapped I/O and all transport providers support this capability.</span></span> <span data-ttu-id="b541f-105">La e/s superpuesta sigue el modelo establecido en Windows y se puede realizar en sockets creados con la función de [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) o sockets creados con la función [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) con la marca **\_ \_ OVERLAPPED de marca WSA** establecida en el parámetro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="b541f-105">Overlapped I/O follows the model established in Windows and can be performed on sockets created with the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) function or sockets created with the [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the **WSA\_FLAG\_OVERLAPPED** flag set in the *dwFlags* parameter.</span></span>

> [!Note]  
> <span data-ttu-id="b541f-106">La creación de un socket con el atributo OVERLAPPED no tiene ningún efecto sobre si un socket está actualmente en modo de bloqueo o de no bloqueo.</span><span class="sxs-lookup"><span data-stu-id="b541f-106">Creating a socket with the overlapped attribute has no impact on whether a socket is currently in blocking or nonblocking mode.</span></span> <span data-ttu-id="b541f-107">Los sockets creados con el atributo OVERLAPPED se pueden usar para realizar operaciones de e/s superpuestas; al hacerlo, no se cambia el modo de bloqueo de un socket.</span><span class="sxs-lookup"><span data-stu-id="b541f-107">Sockets created with the overlapped attribute can be used to perform overlapped I/O—doing so does not change the blocking mode of a socket.</span></span> <span data-ttu-id="b541f-108">Dado que las operaciones de e/s superpuestas no se bloquean, el modo de bloqueo de un socket es irrelevante para estas operaciones.</span><span class="sxs-lookup"><span data-stu-id="b541f-108">Since overlapped I/O operations do not block, the blocking mode of a socket is irrelevant for these operations.</span></span>

 

<span data-ttu-id="b541f-109">En el caso de la recepción, las aplicaciones usan las funciones [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) o [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) para proporcionar búferes en los que se van a recibir los datos.</span><span class="sxs-lookup"><span data-stu-id="b541f-109">For receiving, applications use the [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) functions to supply buffers into which data is to be received.</span></span> <span data-ttu-id="b541f-110">Si se publican uno o más búferes antes del momento en que la red ha recibido los datos, los datos se pueden colocar en los búferes del usuario inmediatamente a medida que llegan.</span><span class="sxs-lookup"><span data-stu-id="b541f-110">If one or more buffers are posted prior to the time when data has been received by the network, that data could be placed in the user's buffers immediately as it arrives.</span></span> <span data-ttu-id="b541f-111">Por lo tanto, puede evitar la operación de copia que, de lo contrario, se produciría en el momento en que se invoca la función [**RECV**](/windows/desktop/api/winsock/nf-winsock-recv) o [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) .</span><span class="sxs-lookup"><span data-stu-id="b541f-111">Thus, it can avoid the copy operation that would otherwise occur at the time the [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) or [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) function is invoked.</span></span> <span data-ttu-id="b541f-112">Si los datos ya están presentes cuando se publican los búferes de recepción, se copian inmediatamente en los búferes del usuario.</span><span class="sxs-lookup"><span data-stu-id="b541f-112">If data is already present when receive buffers are posted, it is copied immediately into the user's buffers.</span></span>

<span data-ttu-id="b541f-113">Si los datos llegan cuando la aplicación no ha publicado ningún búfer de recepción, la red recurre al conocido estilo sincrónico de funcionamiento.</span><span class="sxs-lookup"><span data-stu-id="b541f-113">If data arrives when no receive buffers have been posted by the application, the network resorts to the familiar synchronous style of operation.</span></span> <span data-ttu-id="b541f-114">Es decir, los datos entrantes se almacenan en búfer internamente hasta que la aplicación emite una llamada de recepción y, por tanto, proporciona un búfer en el que se pueden copiar los datos.</span><span class="sxs-lookup"><span data-stu-id="b541f-114">That is, the incoming data is buffered internally until the application issues a receive call and thereby supplies a buffer into which the data can be copied.</span></span> <span data-ttu-id="b541f-115">Una excepción a esto es cuando la aplicación usa el valor de My para establecer el tamaño del búfer de [**recepción en cero**](/windows/desktop/api/winsock/nf-winsock-setsockopt) .</span><span class="sxs-lookup"><span data-stu-id="b541f-115">An exception to this is when the application uses [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) to set the size of the receive buffer to zero.</span></span> <span data-ttu-id="b541f-116">En esta instancia, los protocolos confiables solo permitirán que se reciban los datos cuando se publicaron los búferes de la aplicación y los datos de protocolos no confiables se perderían.</span><span class="sxs-lookup"><span data-stu-id="b541f-116">In this instance, reliable protocols would only allow data to be received when application buffers had been posted and data on unreliable protocols would be lost.</span></span>

<span data-ttu-id="b541f-117">En el lado de envío, las aplicaciones usan [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) o [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) para proporcionar punteros a búferes rellenos y, después, acuerdan no molestar los búferes de ningún modo hasta que la red haya consumido el contenido del búfer.</span><span class="sxs-lookup"><span data-stu-id="b541f-117">On the sending side, applications use [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) to supply pointers to filled buffers and then agree not to disturb the buffers in any way until the network has consumed the buffer's contents.</span></span>

<span data-ttu-id="b541f-118">Las llamadas de envío y recepción superpuestas se devuelven inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="b541f-118">Overlapped send and receive calls return immediately.</span></span> <span data-ttu-id="b541f-119">Un valor devuelto de cero indica que la operación de e/s se completó inmediatamente y que ya se ha producido la indicación de finalización correspondiente.</span><span class="sxs-lookup"><span data-stu-id="b541f-119">A return value of zero indicates that the I/O operation was completed immediately and that the corresponding completion indication already occurred.</span></span> <span data-ttu-id="b541f-120">Es decir, se ha señalado el objeto de evento asociado, o una rutina de finalización se ha puesto en cola y se ejecutará cuando el subproceso de llamada entre en el estado de espera de alerta.</span><span class="sxs-lookup"><span data-stu-id="b541f-120">That is, the associated event object has been signaled, or a completion routine has been queued and will be executed when the calling thread gets into the alertable wait state.</span></span>

<span data-ttu-id="b541f-121">Un valor devuelto de \_ error de socket junto con un código de error de la [ \_ e/s de WSA \_ pendiente](windows-sockets-error-codes-2.md) indica que la operación superpuesta se ha iniciado correctamente y que se proporcionará una indicación posterior cuando se hayan consumido los búferes de envío o cuando se haya completado una operación de recepción.</span><span class="sxs-lookup"><span data-stu-id="b541f-121">A return value of SOCKET\_ERROR coupled with an error code of [WSA\_IO\_PENDING](windows-sockets-error-codes-2.md) indicates that the overlapped operation has been successfully initiated and that a subsequent indication will be provided when send buffers have been consumed or when a receive operation has been completed.</span></span> <span data-ttu-id="b541f-122">Sin embargo, para los sockets que son de estilo de secuencia de bytes, la indicación de finalización se produce cada vez que se agotan los datos entrantes, independientemente de si los búferes están llenos.</span><span class="sxs-lookup"><span data-stu-id="b541f-122">However, for sockets that are byte-stream style, the completion indication occurs whenever the incoming data is exhausted, regardless of whether the buffers are full.</span></span> <span data-ttu-id="b541f-123">Cualquier otro código de error indica que la operación superpuesta no se ha iniciado correctamente y que no habrá ninguna indicación de finalización próxima.</span><span class="sxs-lookup"><span data-stu-id="b541f-123">Any other error code indicates that the overlapped operation was not successfully initiated and that no completion indication will be forthcoming.</span></span>

<span data-ttu-id="b541f-124">Las operaciones de envío y recepción se pueden superponer.</span><span class="sxs-lookup"><span data-stu-id="b541f-124">Both send and receive operations can be overlapped.</span></span> <span data-ttu-id="b541f-125">Las funciones Receive se pueden invocar varias veces para publicar búferes de recepción como preparación para los datos entrantes, y las funciones send se pueden invocar varias veces para poner en cola varios búferes que se van a enviar.</span><span class="sxs-lookup"><span data-stu-id="b541f-125">The receive functions can be invoked several times to post receive buffers in preparation for incoming data, and the send functions can be invoked several times to queue multiple buffers to send.</span></span> <span data-ttu-id="b541f-126">Aunque la aplicación puede basarse en una serie de búferes de envío superpuestos que se envían en el orden proporcionado, se pueden producir las indicaciones de finalización correspondientes en un orden diferente.</span><span class="sxs-lookup"><span data-stu-id="b541f-126">While the application can rely upon a series of overlapped send buffers being sent in the order supplied, the corresponding completion indications might occur in a different order.</span></span> <span data-ttu-id="b541f-127">Del mismo modo, en el lado receptor, los búferes se pueden rellenar en el orden en que se proporcionan, pero las indicaciones de finalización pueden aparecer en un orden diferente.</span><span class="sxs-lookup"><span data-stu-id="b541f-127">Likewise, on the receiving side, buffers can be filled in the order they are supplied, but the completion indications might occur in a different order.</span></span>

<span data-ttu-id="b541f-128">En muchos casos, las operaciones superpuestas de Winsock con las funciones [**AcceptEx**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile)y similares se pueden cancelar.</span><span class="sxs-lookup"><span data-stu-id="b541f-128">In many cases, Winsock overlapped operations using [**AcceptEx**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile), and similar functions are cancelable.</span></span> <span data-ttu-id="b541f-129">Sin embargo, el comportamiento no está definido para el uso continuado de un socket que ha cancelado las operaciones pendientes.</span><span class="sxs-lookup"><span data-stu-id="b541f-129">However, behavior is undefined for the continued use of a socket that has canceled outstanding operations.</span></span> <span data-ttu-id="b541f-130">Se debe llamar a la función [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) después de cancelar una operación superpuesta.</span><span class="sxs-lookup"><span data-stu-id="b541f-130">The [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function should be called after canceling an overlapped operation.</span></span> <span data-ttu-id="b541f-131">Por lo tanto, para obtener los mejores resultados, en lugar de cancelar la e/s directamente, se debe llamar a la función **closesocket** para cerrar el socket que finalmente interrumpirá todas las operaciones pendientes.</span><span class="sxs-lookup"><span data-stu-id="b541f-131">Therefore, for best results, instead of canceling the I/O directly, the **closesocket** function should be called to close the socket which will eventually discontinue all pending operations.</span></span>

<span data-ttu-id="b541f-132">La característica de finalización diferida de e/s superpuesta también está disponible para [**WSAIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), que es una versión mejorada de [**ioctlsocket**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).</span><span class="sxs-lookup"><span data-stu-id="b541f-132">The deferred completion feature of overlapped I/O is also available for [**WSAIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), which is an enhanced version of [**ioctlsocket**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).</span></span>

 

 
