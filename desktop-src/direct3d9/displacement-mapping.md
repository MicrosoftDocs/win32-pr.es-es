---
description: Los mapas de desplazamiento son similares a los mapas de textura, pero el motor de vértices tiene acceso a ellos.
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: Asignación de desplazamiento (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495311"
---
# <a name="displacement-mapping-direct3d-9"></a><span data-ttu-id="054b2-103">Asignación de desplazamiento (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="054b2-103">Displacement Mapping (Direct3D 9)</span></span>

<span data-ttu-id="054b2-104">Los mapas de desplazamiento son similares a los mapas de textura, pero el motor de vértices tiene acceso a ellos.</span><span class="sxs-lookup"><span data-stu-id="054b2-104">Displacement maps are similar to texture maps but are accessed by the vertex engine.</span></span>

## <a name="block-diagram"></a><span data-ttu-id="054b2-105">Diagrama de bloque</span><span class="sxs-lookup"><span data-stu-id="054b2-105">Block Diagram</span></span>

<span data-ttu-id="054b2-106">Hay una fase de muestra adicional en la parte temprana de la canalización de vértices, como se muestra en el diagrama siguiente, que puede muestrear un mapa de desplazamiento para proporcionar datos de desplazamiento de vértices.</span><span class="sxs-lookup"><span data-stu-id="054b2-106">An additional sampler stage is present in the early part of the vertex pipe, as shown in the following diagram, which can sample a displacement map to provide vertex displacement data.</span></span>

![diagrama de la fase de muestra en la canalización de vértices](images/tessellatordx9.png)

<span data-ttu-id="054b2-108">El estado de muestra del mapa de desplazamiento se puede establecer mediante [**SetSamplerState**](/windows/desktop/api) con el número de fase 256, que es un nuevo número de fase.</span><span class="sxs-lookup"><span data-stu-id="054b2-108">The displacement map sampler state can be set by the [**SetSamplerState**](/windows/desktop/api) using stage number 256, which is a new stage number.</span></span> <span data-ttu-id="054b2-109">La textura del mapa de desplazamiento se establece mediante [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span><span class="sxs-lookup"><span data-stu-id="054b2-109">The displacement map texture is set by [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span></span>

<span data-ttu-id="054b2-110">La asignación se puede premuestrear o no, lo que significa que se puede ordenar de forma que permita la búsqueda de los valores de desplazamiento sin filtrado.</span><span class="sxs-lookup"><span data-stu-id="054b2-110">The map can be presampled or not, which means that it can be ordered in a way that enables the lookup of the displacement values without filtering.</span></span>

-   <span data-ttu-id="054b2-111">Los mapas de desplazamiento son análogos a los mapas de textura, pero el motor de vértices tiene acceso a ellos.</span><span class="sxs-lookup"><span data-stu-id="054b2-111">Displacement maps are analogous to texture maps but are accessed by the vertex engine.</span></span>
-   <span data-ttu-id="054b2-112">Hay una fase de muestra adicional en la parte temprana de la canalización de vértices que puede muestrear un mapa de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-112">An additional sampler stage is present in the early part of the vertex pipe that can sample a displacement map.</span></span> <span data-ttu-id="054b2-113">A esta fase se accede mediante la API de SetSamplerState habitual, pero el número de fase es D3DDMAPSAMPLER = 256.</span><span class="sxs-lookup"><span data-stu-id="054b2-113">This stage is accessed by the usual SetSamplerState API but the stage number is D3DDMAPSAMPLER = 256.</span></span>
-   <span data-ttu-id="054b2-114">El estado de muestra del mapa de desplazamiento se puede establecer mediante SetSamplerState (D3DDMAPSAMPLER,...) API.</span><span class="sxs-lookup"><span data-stu-id="054b2-114">The displacement map sampler state can be set by the SetSamplerState(D3DDMAPSAMPLER, ...) API.</span></span>
-   <span data-ttu-id="054b2-115">La textura del mapa de desplazamiento se establece mediante la API SetTexture (D3DDMAPSAMPLER, Texture).</span><span class="sxs-lookup"><span data-stu-id="054b2-115">The displacement map texture is set by the SetTexture(D3DDMAPSAMPLER, texture) API.</span></span>
-   <span data-ttu-id="054b2-116">La asignación se puede mostrar previamente o no.</span><span class="sxs-lookup"><span data-stu-id="054b2-116">The map can be pre-sampled or not.</span></span> <span data-ttu-id="054b2-117">Esto significa que se puede ordenar de una manera determinada que habilita la búsqueda de los valores de desplazamiento sin filtrado.</span><span class="sxs-lookup"><span data-stu-id="054b2-117">This means that it can be ordered in a particular way that enables the lookup of the displacement values without filtering.</span></span>
-   <span data-ttu-id="054b2-118">Los cambios en la estructura de declaración permiten la especificación de la coordenada de textura utilizada para buscar el mapa de textura.</span><span class="sxs-lookup"><span data-stu-id="054b2-118">The changes in the declaration structure allow the specification of the texture coordinate used to look up the texture map.</span></span> <span data-ttu-id="054b2-119">Por ejemplo, Stream0, offset, FLOAT2, LOOKUP y el \_ valor de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-119">For example, Stream0, Offset, FLOAT2, LOOKUP, Displacement\_value.</span></span> <span data-ttu-id="054b2-120">Esto indica a del teselador que use el vector Float 2D en stream0 en un determinado desplazamiento como una coordenada de textura para buscar el mapa de desplazamiento y asociarle la \_ semántica del uso del valor de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-120">This tells the tessellator to use the 2D float vector in stream0 at a certain offset as a texture coordinate to look up the displacement map and associate the Displacement\_value usage semantic to it.</span></span> <span data-ttu-id="054b2-121">La declaración del sombreador de vértices contendría una línea similar a {DCL \_ texture0, V0} que indica que la semántica de texture0 se asociará con el registro de entrada de v0.</span><span class="sxs-lookup"><span data-stu-id="054b2-121">The vertex shader declaration would contain a line similar to {dcl\_texture0, v0} indicating that the texture0 semantic is to be associated with the v0 input register.</span></span> <span data-ttu-id="054b2-122">El valor de desplazamiento buscado se copia en el registro de entrada v0.</span><span class="sxs-lookup"><span data-stu-id="054b2-122">The displacement value looked up is copied into input register v0.</span></span>
-   <span data-ttu-id="054b2-123">Hay un tipo especial de asignación de desplazamiento, cuando el mapa de textura se muestrea previamente.</span><span class="sxs-lookup"><span data-stu-id="054b2-123">There is a special type of displacement mapping, when the texture map is pre-sampled.</span></span> <span data-ttu-id="054b2-124">El índice secuencial de los vértices generados se utiliza como una coordenada de textura a un mapa de textura.</span><span class="sxs-lookup"><span data-stu-id="054b2-124">Sequential index of generated vertices is used as a texture coordinate to a texture map.</span></span> <span data-ttu-id="054b2-125">Por ejemplo, 0, 0, (D3DDECLTYPE) 0, D3DDECLMETHOD \_ LOOKUPPRESAMPLED, Usage, UsageIndex.</span><span class="sxs-lookup"><span data-stu-id="054b2-125">For example, 0,0,(D3DDECLTYPE)0,D3DDECLMETHOD\_LOOKUPPRESAMPLED, Usage, UsageIndex.</span></span>
-   <span data-ttu-id="054b2-126">La salida de la búsqueda es 4 flotantes.</span><span class="sxs-lookup"><span data-stu-id="054b2-126">The output of the lookup is 4 floats.</span></span>
-   <span data-ttu-id="054b2-127">La asignación de desplazamiento solo se admite con N-patches.</span><span class="sxs-lookup"><span data-stu-id="054b2-127">Displacement mapping is supported only with N-patches.</span></span>
-   <span data-ttu-id="054b2-128">Los controladores deben omitir D3DDMAPSAMPLER en SetTextureStageState si no controlan los mapas de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-128">Drivers need to ignore D3DDMAPSAMPLER in SetTextureStageState if they do not handle displacement maps.</span></span>
-   <span data-ttu-id="054b2-129">\_No se admite el modo de filtro anisotrópico de D3DTEXF.</span><span class="sxs-lookup"><span data-stu-id="054b2-129">D3DTEXF\_ANISOTROPIC filter mode is not supported.</span></span>
-   <span data-ttu-id="054b2-130">Cuando D3DSAMP \_ MIPFILTER de la muestra de mapa de desplazamiento no es D3DTEXF \_ ninguno, el nivel de detalle se calcula como se indica a continuación (tenga en cuenta que el estado de teselación adaptable se usa incluso si el \_ ENABLEADAPTIVETESSELLATION D3DRS es **false**): Tmax = estado de representación D3DRS \_ MAXTESSELLATIONLEVEL</span><span class="sxs-lookup"><span data-stu-id="054b2-130">When D3DSAMP\_MIPFILTER in the displacement map sampler is not D3DTEXF\_NONE, the level of detail is computed as follows (Note that the adaptive tessellation state is used even if the D3DRS\_ENABLEADAPTIVETESSELLATION is **FALSE**): Tmax = render state D3DRS\_MAXTESSELLATIONLEVEL</span></span>
-   <span data-ttu-id="054b2-131">Nivel de teselación de proceso de un vértice VI: (XI, Yi, Zi) de la misma manera que se describe en la sección "teselación adaptativa".</span><span class="sxs-lookup"><span data-stu-id="054b2-131">Compute tessellation level Te for a vertex Vi: (Xi, Yi, Zi) the same way as described in the "Adaptive tessellation" section.</span></span> <span data-ttu-id="054b2-132">Nivel de detalle L = LOG2 (Tmax)-LOG2 (te).</span><span class="sxs-lookup"><span data-stu-id="054b2-132">Level of detail L = log2(Tmax) - log2 (Te).</span></span>
-   <span data-ttu-id="054b2-133">Las operaciones de filtrado y muestreo de textura siguen las mismas reglas que se aplican a la canalización de píxeles (el nivel de detalle (LOD), etc.).</span><span class="sxs-lookup"><span data-stu-id="054b2-133">Texture filtering and sampling operations follow the same rules as the pixel pipeline (level of detail (LOD) bias is applied, etc.).</span></span>
-   <span data-ttu-id="054b2-134">No todos los formatos se pueden usar como mapas de desplazamiento, sino solo aquellos que admiten \_ DMAP D3DUSAGE.</span><span class="sxs-lookup"><span data-stu-id="054b2-134">Not all formats can be used as displacement maps but only those that support the D3DUSAGE\_DMAP.</span></span> <span data-ttu-id="054b2-135">La aplicación puede consultarlo con el [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat)de CheckDeviceFormat.</span><span class="sxs-lookup"><span data-stu-id="054b2-135">The application can query that with the CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span></span>
-   <span data-ttu-id="054b2-136">D3DUSAGE \_ DMAP se debe especificar en [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) para notificar al controlador que esta textura se va a usar como un mapa de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-136">D3DUSAGE\_DMAP must be specified in [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) to notify the driver that this texture is to be used as a displacement map.</span></span>
-   <span data-ttu-id="054b2-137">D3DUSAGE \_ DMAP solo se puede usar con texturas.</span><span class="sxs-lookup"><span data-stu-id="054b2-137">D3DUSAGE\_DMAP can only be used with textures.</span></span> <span data-ttu-id="054b2-138">No se puede usar con asignaciones o volúmenes de cubos.</span><span class="sxs-lookup"><span data-stu-id="054b2-138">It cannot be used with cube maps or volumes.</span></span>
-   <span data-ttu-id="054b2-139">Las texturas y los destinos de representación creados con D3DUSAGE \_ DMAP se pueden establecer en fases normales de muestra y como destinos de representación.</span><span class="sxs-lookup"><span data-stu-id="054b2-139">Textures and render targets created with D3DUSAGE\_DMAP can be set at regular sampler stages and as render targets.</span></span>
-   <span data-ttu-id="054b2-140">Los Estados de representación para establecer el modo de ajuste para las coordenadas de textura se omiten en la asignación de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-140">The render states to set the wrap mode for the texture coordinates are ignored in displacement mapping.</span></span> <span data-ttu-id="054b2-141">En general, no hay modos de ajuste para el motor de del teselador.</span><span class="sxs-lookup"><span data-stu-id="054b2-141">In general, there are no wrap modes for the tessellator engine.</span></span>
-   <span data-ttu-id="054b2-142">Una muestra de mapa de desplazamiento tiene un comportamiento idéntico al de los ejemplos de textura de píxeles.</span><span class="sxs-lookup"><span data-stu-id="054b2-142">A displacement map sampler has behavior identical to that of the pixel texture samplers.</span></span> <span data-ttu-id="054b2-143">Si se busca una textura con menos de cuatro canales (como R32f), los valores buscados van a los canales adecuados del registro de destino (el registro de entrada del sombreador de vértices etiquetado con la \_ semántica del ejemplo), mientras que los demás canales tienen como valor predeterminado (1, 1, 1).</span><span class="sxs-lookup"><span data-stu-id="054b2-143">If a texture with less than four channels (like R32f) is looked up, the looked-up values go to the appropriate channels of the destination register (the vertex shader input register tagged with the \_sample semantic), while the other channels default to (1, 1, 1).</span></span> <span data-ttu-id="054b2-144">Cuando se busca, D3DFMT \_ L8 se emite en los canales R, G, B y el valor predeterminado es 1.</span><span class="sxs-lookup"><span data-stu-id="054b2-144">When looked up, D3DFMT\_L8 gets broadcast into the R, G, B channels and A defaults to 1.</span></span> <span data-ttu-id="054b2-145">El rasterizador de referencia tiene los detalles de implementación completos.</span><span class="sxs-lookup"><span data-stu-id="054b2-145">The reference rasterizer has the full implementation details.</span></span>

## <a name="pre-sampled-displacement-mapping"></a><span data-ttu-id="054b2-146">Asignación de desplazamiento previamente muestreada</span><span class="sxs-lookup"><span data-stu-id="054b2-146">Pre-Sampled Displacement Mapping</span></span>

-   <span data-ttu-id="054b2-147">Se introduce un nuevo estado de muestra: D3DSAMP \_ DMAPOFFSET (DWORD)-offset (en vértices) en un mapa de desplazamiento premuestreado.</span><span class="sxs-lookup"><span data-stu-id="054b2-147">New sampler state is introduced: D3DSAMP\_DMAPOFFSET (DWORD) - offset (in vertices) in a pre-sampled displacement map.</span></span>
-   <span data-ttu-id="054b2-148">Se presentó el nuevo método de declaración: D3DDECLMETHOD \_ LOOKUPPRESAMPLED.</span><span class="sxs-lookup"><span data-stu-id="054b2-148">New declaration method is introduced: D3DDECLMETHOD\_LOOKUPPRESAMPLED.</span></span>
-   <span data-ttu-id="054b2-149">La teselación adaptable debe estar deshabilitada.</span><span class="sxs-lookup"><span data-stu-id="054b2-149">Adaptive tessellation should be disabled.</span></span>
-   <span data-ttu-id="054b2-150">Se omite la configuración del filtro de textura.</span><span class="sxs-lookup"><span data-stu-id="054b2-150">Texture filter settings are ignored.</span></span> <span data-ttu-id="054b2-151">Se realiza el muestreo de puntos.</span><span class="sxs-lookup"><span data-stu-id="054b2-151">Point sampling is done.</span></span> <span data-ttu-id="054b2-152">Se supone que el filtro de textura MIP es D3DTEXF \_ ninguno.</span><span class="sxs-lookup"><span data-stu-id="054b2-152">The mip texture filter is assumed to be D3DTEXF\_NONE.</span></span> <span data-ttu-id="054b2-153">Se supone que todos los demás modos de filtro de textura son D3DTEXF \_ Point.</span><span class="sxs-lookup"><span data-stu-id="054b2-153">All other texture filter modes are assumed to be D3DTEXF\_POINT.</span></span>
-   <span data-ttu-id="054b2-154">Las coordenadas de textura se calculan como: U = (índice% TextureWidthInPixeles)/(float) (TextureWidthInPixeles) V = (index/TextureWidthInPixeles)/(float) (TextureHeightInPixeles), donde index es un índice secuencial de los vértices generados más TSS D3DSAMP DMAPOFFSET \[ \_ \] .</span><span class="sxs-lookup"><span data-stu-id="054b2-154">Texture coordinates are computed as: U = (Index % TextureWidthInPixeles) / (float)(TextureWidthInPixeles) V = (Index / TextureWidthInPixeles) / (float)(TextureHeightInPixeles) where Index is a sequential index of generated vertices plus TSS\[D3DSAMP\_DMAPOFFSET\].</span></span> <span data-ttu-id="054b2-155">El índice secuencial se establece en cero al principio de cada primitiva y se aumenta después de que se genere un vértice.</span><span class="sxs-lookup"><span data-stu-id="054b2-155">The sequential index is set to zero at the start of each primitive and is increased after a vertex is generated.</span></span>

<span data-ttu-id="054b2-156">Estos son los cambios de la API que admiten la asignación de desplazamiento.</span><span class="sxs-lookup"><span data-stu-id="054b2-156">These are the API changes that support displacement mapping.</span></span>

-   <span data-ttu-id="054b2-157">Un formato de canal único agregado, D3DFMT \_ L16.</span><span class="sxs-lookup"><span data-stu-id="054b2-157">A single channel format added, D3DFMT\_L16.</span></span>
-   <span data-ttu-id="054b2-158">Una nueva marca de uso, D3DUSAGE \_ DMAP.</span><span class="sxs-lookup"><span data-stu-id="054b2-158">A new usage flag, D3DUSAGE\_DMAP.</span></span>
-   <span data-ttu-id="054b2-159">Una fase de textura especial, que se usa para establecer una textura de mapa de desplazamiento, D3DDMAPSAMPLER.</span><span class="sxs-lookup"><span data-stu-id="054b2-159">A special texture stage, used to set a displacement map texture, D3DDMAPSAMPLER.</span></span>
-   <span data-ttu-id="054b2-160">Se han agregado nuevas Cap de hardware, D3DDEVCAPS2 \_ DMAPNPATCH y D3DDEVCAPS2 \_ PRESAMPLEDDMAPNPATCH.</span><span class="sxs-lookup"><span data-stu-id="054b2-160">New hardware caps have been added, D3DDEVCAPS2\_DMAPNPATCH and D3DDEVCAPS2\_PRESAMPLEDDMAPNPATCH.</span></span> <span data-ttu-id="054b2-161">Vea [D3DDEVCAPS2](d3ddevcaps2.md).</span><span class="sxs-lookup"><span data-stu-id="054b2-161">See [D3DDEVCAPS2](d3ddevcaps2.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="054b2-162">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="054b2-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="054b2-163">Canalización de vértices</span><span class="sxs-lookup"><span data-stu-id="054b2-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 
