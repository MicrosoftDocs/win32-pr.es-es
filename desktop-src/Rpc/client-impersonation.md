---
title: Suplantación de cliente (RPC)
description: La suplantación es útil en un entorno informático distribuido cuando los servidores deben pasar solicitudes de cliente a otros procesos de servidor o al sistema operativo.
ms.assetid: 49d833d8-c61c-4746-91cf-c0753847cd3d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d03ad3b4d9e2984708e8b274ab9bc57c3235808b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104149516"
---
# <a name="client-impersonation"></a><span data-ttu-id="983c4-103">Suplantación de cliente</span><span class="sxs-lookup"><span data-stu-id="983c4-103">Client Impersonation</span></span>

<span data-ttu-id="983c4-104">La suplantación es útil en un entorno informático distribuido cuando los servidores deben pasar solicitudes de cliente a otros procesos de servidor o al sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="983c4-104">Impersonation is useful in a distributed computing environment when servers must pass client requests to other server processes or to the operating system.</span></span> <span data-ttu-id="983c4-105">En este caso, un servidor suplanta el contexto de seguridad del cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-105">In this case, a server impersonates the client's security context.</span></span> <span data-ttu-id="983c4-106">Otros procesos de servidor pueden administrar la solicitud como si el cliente original lo hubiera hecho.</span><span class="sxs-lookup"><span data-stu-id="983c4-106">Other server processes can then handle the request as if the original client made it.</span></span>

![el servidor suplanta a un cliente que llama cuando realiza llamadas posteriores en nombre del cliente](images/impr.png)

<span data-ttu-id="983c4-108">Por ejemplo, un cliente realiza una solicitud al servidor a. Si el servidor a debe consultar al servidor B para completar la solicitud, el servidor A suplanta el contexto de seguridad del cliente y realiza la solicitud al servidor B en nombre del cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-108">For example, a client makes a request to Server A. If Server A must query Server B to complete the request, Server A impersonates the client security context and makes the request to Server B on behalf of the client.</span></span> <span data-ttu-id="983c4-109">El servidor B utiliza el contexto de seguridad del cliente original, en lugar de la identidad de seguridad del servidor a, para determinar si se debe completar la tarea.</span><span class="sxs-lookup"><span data-stu-id="983c4-109">Server B uses the original client's security context, instead of the security identity for Server A, to determine whether to complete the task.</span></span>

<span data-ttu-id="983c4-110">El servidor llama a [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) para sobrescribir la seguridad del subproceso de servidor con el contexto de seguridad del cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-110">The server calls [**RpcImpersonateClient**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) to overwrite the security for the server thread with the client security context.</span></span> <span data-ttu-id="983c4-111">Una vez completada la tarea, el servidor llama a [**RpcRevertToSelf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) o [**RpcRevertToSelfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) para restaurar el contexto de seguridad definido para el subproceso de servidor.</span><span class="sxs-lookup"><span data-stu-id="983c4-111">After the task is completed, the server calls [**RpcRevertToSelf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) or [**RpcRevertToSelfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) to restore the security context defined for the server thread.</span></span>

<span data-ttu-id="983c4-112">Al enlazar, el cliente puede especificar información de calidad de servicio sobre la seguridad que especifica cómo el servidor puede suplantar al cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-112">When binding, the client can specify quality-of-service information about security which specifies how the server can impersonate the client.</span></span> <span data-ttu-id="983c4-113">Por ejemplo, una de las opciones permite que el cliente especifique que el servidor no puede suplantarlo.</span><span class="sxs-lookup"><span data-stu-id="983c4-113">For example, one of the settings lets the client specify that the server is not allowed to impersonate it.</span></span> <span data-ttu-id="983c4-114">Para obtener más información, consulte [calidad de servicio](quality-of-service.md).</span><span class="sxs-lookup"><span data-stu-id="983c4-114">For more information, see [Quality of Service](quality-of-service.md).</span></span>

<span data-ttu-id="983c4-115">La capacidad de llamar a otros servidores durante la suplantación del cliente original se denomina *delegación*.</span><span class="sxs-lookup"><span data-stu-id="983c4-115">The capability to call other servers while impersonating the original client is called *delegation*.</span></span> <span data-ttu-id="983c4-116">Cuando se usa la delegación, un servidor que suplanta a un cliente puede llamar a otro servidor y puede realizar llamadas de red con las credenciales del cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-116">When delegation is used, a server impersonating a client can call another server, and can make network calls with the credentials of the client.</span></span> <span data-ttu-id="983c4-117">Es decir, desde la perspectiva del segundo servidor, las solicitudes procedentes del primer servidor no se distinguen de las solicitudes procedentes del cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-117">That is, from the perspective of the second server, requests coming from the first server are indistinguishable from requests coming from the client.</span></span> <span data-ttu-id="983c4-118">No todos los proveedores de seguridad admiten la delegación.</span><span class="sxs-lookup"><span data-stu-id="983c4-118">Not all security providers support delegation.</span></span> <span data-ttu-id="983c4-119">Microsoft envía solo un proveedor de seguridad que admite la delegación: Kerberos.</span><span class="sxs-lookup"><span data-stu-id="983c4-119">Microsoft ships only one security provider that supports delegation: Kerberos.</span></span>

<span data-ttu-id="983c4-120">La delegación puede ser una funcionalidad peligrosa debido a los privilegios que el cliente proporciona al servidor durante una llamada a procedimiento remoto.</span><span class="sxs-lookup"><span data-stu-id="983c4-120">Delegation can be a dangerous capability due to the privileges the client gives the server during a remote procedure call.</span></span> <span data-ttu-id="983c4-121">Este es el motivo por el que Kerberos permite llamadas con el nivel de suplantación de la delegación solo si se solicita la autenticación mutua.</span><span class="sxs-lookup"><span data-stu-id="983c4-121">This is why Kerberos allows calls with the impersonation level of delegation only if mutual authentication is requested.</span></span> <span data-ttu-id="983c4-122">Los administradores de dominio pueden limitar los equipos a los que se realizan llamadas con el nivel de suplantación de delegación para evitar que los clientes que no sean suscritos realicen llamadas a servidores que podrían hacer uso abusivo de sus credenciales.</span><span class="sxs-lookup"><span data-stu-id="983c4-122">Domain administrators can limit the computers to which calls with delegation impersonation level are made to prevent unsuspecting clients from making calls to servers that could abuse their credentials.</span></span>

<span data-ttu-id="983c4-123">Existe una excepción a la regla de delegación: llama a con [**ncalrpc**](/windows/desktop/Midl/ncalrpc).</span><span class="sxs-lookup"><span data-stu-id="983c4-123">One exception to the delegation rule exists: calls using [**ncalrpc**](/windows/desktop/Midl/ncalrpc).</span></span> <span data-ttu-id="983c4-124">Cuando se realizan estas llamadas, el servidor obtiene derechos de delegación, incluso si se especifica un nivel de suplantación de suplantación.</span><span class="sxs-lookup"><span data-stu-id="983c4-124">When these calls are made the server gets delegation rights, even if an impersonation level of impersonate is specified.</span></span> <span data-ttu-id="983c4-125">Es decir, un servidor puede llamar a otros servidores en nombre del cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-125">That is, a server can call other servers on behalf of the client.</span></span> <span data-ttu-id="983c4-126">Esto solo funciona para una llamada remota.</span><span class="sxs-lookup"><span data-stu-id="983c4-126">This works for one remote call only.</span></span> <span data-ttu-id="983c4-127">Por ejemplo, si el cliente A llama al servidor local LB mediante **ncalrpc** local Server lb puede suplantar y llamar a RB del servidor remoto.</span><span class="sxs-lookup"><span data-stu-id="983c4-127">For example, if client A calls local server LB using **ncalrpc** local server LB can impersonate and call remote server RB.</span></span> <span data-ttu-id="983c4-128">RB podrá actuar en nombre del cliente A, pero solo en el equipo remoto en el que se ejecuta RB.</span><span class="sxs-lookup"><span data-stu-id="983c4-128">RB will be able to act on behalf of client A, but only on the remote computer that RB is running on.</span></span> <span data-ttu-id="983c4-129">No puede hacer otra llamada de red al equipo remoto C a menos que LB especifique un nivel de suplantación de delegado cuando se llama RB.</span><span class="sxs-lookup"><span data-stu-id="983c4-129">It cannot make another network call to remote computer C unless LB specified an impersonation level of delegate when it called RB.</span></span>

> [!Note]  
> <span data-ttu-id="983c4-130">La *suplantación* representa dos significados superpuestos.</span><span class="sxs-lookup"><span data-stu-id="983c4-130">The term *impersonation* represents two overlapping meanings.</span></span> <span data-ttu-id="983c4-131">El primer significado de la suplantación es el proceso general de actuar en nombre de un cliente.</span><span class="sxs-lookup"><span data-stu-id="983c4-131">The first meaning of impersonation is the general process of acting on behalf of a client.</span></span> <span data-ttu-id="983c4-132">El segundo significado es el nivel de suplantación específico denominado suplantación.</span><span class="sxs-lookup"><span data-stu-id="983c4-132">The second meaning is the specific impersonation level called impersonation.</span></span> <span data-ttu-id="983c4-133">El contexto del texto generalmente clarifica el significado.</span><span class="sxs-lookup"><span data-stu-id="983c4-133">The context of the text generally clarifies the meaning.</span></span>

 

 

 