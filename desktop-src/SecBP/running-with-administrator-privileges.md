---
description: Para ayudar a evitar ataques malintencionados, determine si la aplicación requiere privilegios de administrador. En el caso de las funciones que requieren permisos de administrador, cree una aplicación independiente y use el comando de línea de comandos runas de Windows.
ms.assetid: afa520fc-c206-49de-8d73-8f6566ec4fb6
title: Ejecutar con privilegios de administrador
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc28843195e9b5cabadc13aa2317b0bdd8058ef8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105669741"
---
# <a name="running-with-administrator-privileges"></a><span data-ttu-id="df180-104">Ejecutar con privilegios de administrador</span><span class="sxs-lookup"><span data-stu-id="df180-104">Running with Administrator Privileges</span></span>

<span data-ttu-id="df180-105">El primer paso para establecer el tipo de cuenta con la que se debe ejecutar la aplicación es examinar qué recursos usará la aplicación y qué API con privilegios llamará.</span><span class="sxs-lookup"><span data-stu-id="df180-105">The first step in establishing which type of account your application needs to run under is to examine what resources the application will use and what privileged APIs it will call.</span></span> <span data-ttu-id="df180-106">Es posible que la aplicación, o partes grandes, no requieran privilegios de administrador.</span><span class="sxs-lookup"><span data-stu-id="df180-106">You may find that the application, or large parts of it, do not require administrator privileges.</span></span> <span data-ttu-id="df180-107">La *escritura de código seguro*, de Michael Howard y David LeBlanc, ofrece una excelente descripción de cómo llevar a cabo esta evaluación y es muy recomendable.</span><span class="sxs-lookup"><span data-stu-id="df180-107">*Writing Secure Code*, by Michael Howard and David LeBlanc offers an excellent description of how to carry out this assessment and is highly recommended.</span></span> <span data-ttu-id="df180-108">(Es posible que este recurso no esté disponible en algunos idiomas y países).</span><span class="sxs-lookup"><span data-stu-id="df180-108">(This resource may not be available in some languages and countries.)</span></span>

<span data-ttu-id="df180-109">Puede proporcionar los privilegios que la aplicación necesita con menos exposición a ataques malintencionados mediante uno de los métodos siguientes:</span><span class="sxs-lookup"><span data-stu-id="df180-109">You can provide the privileges your application needs with less exposure to malicious attack by using one of the following approaches:</span></span>

-   <span data-ttu-id="df180-110">Ejecutarse en una cuenta con menos privilegios.</span><span class="sxs-lookup"><span data-stu-id="df180-110">Run under an account with less privilege.</span></span> <span data-ttu-id="df180-111">Una manera de hacerlo es usar [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) para determinar qué privilegios están habilitados en un token.</span><span class="sxs-lookup"><span data-stu-id="df180-111">One way to do this is to use [**PrivilegeCheck**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) to determine what privileges are enabled in a token.</span></span> <span data-ttu-id="df180-112">Si los privilegios disponibles no son adecuados para la operación actual, puede deshabilitar ese código y pedir al usuario que inicie sesión en una cuenta con privilegios de administrador.</span><span class="sxs-lookup"><span data-stu-id="df180-112">If the available privileges are not adequate for the current operation, you can disable that code and ask the user to logon to an account with administrator privileges.</span></span>
-   <span data-ttu-id="df180-113">Divida en una función de aplicación independiente que requiera permisos de administrador.</span><span class="sxs-lookup"><span data-stu-id="df180-113">Break into a separate application functions that require administrator permissions.</span></span> <span data-ttu-id="df180-114">Puede proporcionar al usuario un acceso directo que ejecute el comando runas.</span><span class="sxs-lookup"><span data-stu-id="df180-114">You can provide for the user a shortcut that executes the RunAs command.</span></span> <span data-ttu-id="df180-115">Para obtener instrucciones detalladas sobre cómo configurar el acceso directo, busque "runas" en la ayuda de.</span><span class="sxs-lookup"><span data-stu-id="df180-115">For detailed instructions on how to set up the shortcut, search for "runas" in Help.</span></span> <span data-ttu-id="df180-116">Mediante programación, puede configurar el comando [runas](/windows/desktop/com/runas) en la clave del registro de [clave AppID](/windows/desktop/com/appid-key) de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="df180-116">Programmatically, you can configure the [RunAs](/windows/desktop/com/runas) command under the [AppId Key](/windows/desktop/com/appid-key) registry key for your application.</span></span>
-   <span data-ttu-id="df180-117">Autentique al usuario mediante una llamada a [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) o [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (línea de comandos) para obtener el nombre de usuario y la contraseña.</span><span class="sxs-lookup"><span data-stu-id="df180-117">Authenticate the user by calling [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) or [**CredUICmdLinePromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (command line) to obtain user name and password.</span></span> <span data-ttu-id="df180-118">Para obtener un ejemplo, consulte [solicitar credenciales al usuario](asking-the-user-for-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="df180-118">For an example, see [Asking the User for Credentials](asking-the-user-for-credentials.md).</span></span>
-   <span data-ttu-id="df180-119">Suplantar al usuario.</span><span class="sxs-lookup"><span data-stu-id="df180-119">Impersonate the user.</span></span> <span data-ttu-id="df180-120">Un proceso que se inicia en una cuenta con privilegios elevados, como sistema, puede suplantar una cuenta de usuario mediante una llamada a [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) o funciones de suplantación similares, lo que reduce el nivel de privilegios.</span><span class="sxs-lookup"><span data-stu-id="df180-120">A process that starts under a highly privileged account like System can impersonate a user account by calling [**ImpersonateLoggedOnUser**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) or similar Impersonate functions, thus reducing privilege level.</span></span> <span data-ttu-id="df180-121">Sin embargo, si se inserta una llamada a [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) en el subproceso, el proceso vuelve a los privilegios del sistema originales.</span><span class="sxs-lookup"><span data-stu-id="df180-121">However, if a call to [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) is injected into the thread, the process returns to the original System privileges.</span></span>

<span data-ttu-id="df180-122">Si ha determinado que la aplicación debe ejecutarse en una cuenta con privilegios de administrador y que se debe almacenar una contraseña de administrador en el sistema de software, consulte [Administración de contraseñas](handling-passwords.md) para los métodos de hacerlo de forma segura.</span><span class="sxs-lookup"><span data-stu-id="df180-122">If you have determined that your application must run under an account with administrator privileges and that an administrator password must be stored in the software system, see [Handling Passwords](handling-passwords.md) for methods of doing this safely.</span></span>

 

 
