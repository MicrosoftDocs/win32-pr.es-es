---
description: Tenga en cuenta los siguientes problemas importantes al usar la característica de AutoProxy WinHTTP.
ms.assetid: 9bae89b7-8f54-42ec-a240-998c97e26d25
title: Problemas de AutoProxy en WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22c6edbf56ec1ffc4dfac930a5d4858429cc6447
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104278420"
---
# <a name="autoproxy-issues-in-winhttp"></a><span data-ttu-id="ff523-103">Problemas de AutoProxy en WinHTTP</span><span class="sxs-lookup"><span data-stu-id="ff523-103">AutoProxy Issues in WinHTTP</span></span>

<span data-ttu-id="ff523-104">Tenga en cuenta los siguientes problemas importantes al usar la característica de AutoProxy WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="ff523-104">Consider the following important issues when using the WinHTTP autoproxy feature.</span></span>

## <a name="only-one-proxy-server-is-currently-supported"></a><span data-ttu-id="ff523-105">Actualmente solo se admite un servidor proxy</span><span class="sxs-lookup"><span data-stu-id="ff523-105">Only One Proxy Server is Currently Supported</span></span>

<span data-ttu-id="ff523-106">WinHTTP no admite actualmente configuraciones de proxy que especifiquen más de un servidor proxy.</span><span class="sxs-lookup"><span data-stu-id="ff523-106">WinHTTP does not currently support proxy configurations that specify more than one proxy server.</span></span> <span data-ttu-id="ff523-107">Si [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) devuelve una estructura de [**\_ \_ información del proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) que contiene una lista de servidores proxy, que la aplicación establece entonces en el identificador de solicitud mediante la opción de **\_ \_ proxy WinHTTP Option** , WinHTTP usa solo el primer servidor proxy de la lista.</span><span class="sxs-lookup"><span data-stu-id="ff523-107">If [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) returns a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains a list of proxy servers, which the application then sets on the request handle using the **WINHTTP\_OPTION\_PROXY** option, WinHTTP uses only the first proxy server in the list.</span></span> <span data-ttu-id="ff523-108">Si no se puede tener acceso a ese servidor proxy, WinHTTP no conmutará por error a ninguno de los demás servidores proxy de la lista.</span><span class="sxs-lookup"><span data-stu-id="ff523-108">If that proxy server is not accessible, WinHTTP does not failover to any of the other proxy servers in the list.</span></span> <span data-ttu-id="ff523-109">Depende de la aplicación controlar este caso estableciendo de nuevo la opción del **\_ \_ proxy WinHTTP Option** con el siguiente servidor proxy de la lista y reenviando la solicitud.</span><span class="sxs-lookup"><span data-stu-id="ff523-109">It is up to the application to handle this case by setting the **WINHTTP\_OPTION\_PROXY** option again with the next proxy server in the list, and resending the request.</span></span>

## <a name="security-risk-mitigation"></a><span data-ttu-id="ff523-110">Mitigación del riesgo de seguridad</span><span class="sxs-lookup"><span data-stu-id="ff523-110">Security Risk Mitigation</span></span>

<span data-ttu-id="ff523-111">El procesamiento del archivo de configuración automática del proxy requiere la ejecución del código de script descargado.</span><span class="sxs-lookup"><span data-stu-id="ff523-111">Processing the proxy auto-configuration file requires executing downloaded script code.</span></span> <span data-ttu-id="ff523-112">Algunos aspectos de seguridad que se deben tener en cuenta: Si el servidor en el que reside el archivo PAC está en peligro, es posible que el código de script PAC sea malintencionado.</span><span class="sxs-lookup"><span data-stu-id="ff523-112">Some security concerns to consider: If the server on which the PAC file resides has been compromised, it is possible the PAC script code is malicious.</span></span> <span data-ttu-id="ff523-113">Por lo tanto, WinHTTP usa las siguientes precauciones para proteger el cliente:</span><span class="sxs-lookup"><span data-stu-id="ff523-113">Therefore, WinHTTP uses the following precautions to protect the client:</span></span>

1.  <span data-ttu-id="ff523-114">Se impide que el código de script Cree instancias de objetos ActiveX.</span><span class="sxs-lookup"><span data-stu-id="ff523-114">The script code is prevented from instantiating any ActiveX objects.</span></span> <span data-ttu-id="ff523-115">Esto bloquea una gran cantidad de funcionalidad potencialmente peligrosa, como la capacidad de obtener acceso a los archivos y realizar la e/s de red.</span><span class="sxs-lookup"><span data-stu-id="ff523-115">This blocks a lot of potentially dangerous functionality, such as the ability to access files and to perform network I/O.</span></span>
2.  <span data-ttu-id="ff523-116">\* \* Windows Server 2003: \* \*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) delega todo el procesamiento de WPAD en un servicio externo fuera de proceso, el servicio de detección automática de proxy web WinHTTP, que se ejecuta en la cuenta de usuario integrada del servicio local con pocos privilegios.</span><span class="sxs-lookup"><span data-stu-id="ff523-116">\*\*Windows Server 2003:  \*\*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) delegates the entire WPAD processing to an external out-of-process service, the WinHTTP Web Proxy Auto-Discovery service, which runs under the low-privileged Local Service built-in user account.</span></span>

3.  <span data-ttu-id="ff523-117">**Windows XP con SP2 y Windows Server 2003:** No se permite que un script de PAC se ejecute durante más de 60 segundos, después de la finalización de la ejecución del script.</span><span class="sxs-lookup"><span data-stu-id="ff523-117">**Windows XP with SP2 and Windows Server 2003:** A PAC script is not permitted to execute for longer than 60 seconds, after which script execution is terminated.</span></span>

4.  <span data-ttu-id="ff523-118">**Windows XP con SP2 y Windows Server 2003:** WinHTTP rechaza los archivos PAC de más de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="ff523-118">**Windows XP with SP2 and Windows Server 2003:** WinHTTP rejects PAC files larger than 1MB.</span></span> <span data-ttu-id="ff523-119">Un archivo PAC típico no suele tener más de unos pocos kilobytes de tamaño.</span><span class="sxs-lookup"><span data-stu-id="ff523-119">A typical PAC file is usually no more than a few kilobytes in size.</span></span>

<span data-ttu-id="ff523-120">Tenga en cuenta que el procesamiento del código de script PAC requiere el uso de COM, porque WinHTTP usa el componente de Microsoft JScript para ejecutar el script.</span><span class="sxs-lookup"><span data-stu-id="ff523-120">Be aware that processing the PAC script code requires the use of COM, because WinHTTP uses Microsoft JScript component to execute the script.</span></span> <span data-ttu-id="ff523-121">Si WinHTTP no puede delegar el procesamiento del protocolo WPAD a un servicio externo de detección automática de proxy Web fuera de proceso, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) carga el tiempo de ejecución de com en el proceso de la aplicación mientras dure la llamada.</span><span class="sxs-lookup"><span data-stu-id="ff523-121">If WinHTTP cannot delegate WPAD protocol processing to an external, out-of-process Web Proxy Auto-Discovery service, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) loads the COM runtime within the application process for the duration of the call.</span></span> <span data-ttu-id="ff523-122">Si la propia aplicación ya usa COM, no debería ser un problema.</span><span class="sxs-lookup"><span data-stu-id="ff523-122">If the application itself is already using COM, this should not be a concern.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="ff523-123">Consideraciones de rendimiento</span><span class="sxs-lookup"><span data-stu-id="ff523-123">Performance Considerations</span></span>

<span data-ttu-id="ff523-124">El proceso de detección automática puede ser lento, posiblemente en varios segundos.</span><span class="sxs-lookup"><span data-stu-id="ff523-124">The auto-detection process can be slow, possibly as long as several seconds.</span></span> <span data-ttu-id="ff523-125">Las funciones [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) y [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) están bloqueando las funciones sincrónicas.</span><span class="sxs-lookup"><span data-stu-id="ff523-125">The [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) and [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) functions are blocking, synchronous functions.</span></span> <span data-ttu-id="ff523-126">Podría ser que un mecanismo de detección automática determinado (como DHCP) es mucho más lento que el otro (como DNS).</span><span class="sxs-lookup"><span data-stu-id="ff523-126">It could be that one particular auto-detection mechanism (such as DHCP) is much slower than the other (such as DNS).</span></span> <span data-ttu-id="ff523-127">Si el tipo de detección automática de WinHTTP es tipo de detección automática de **\_ \_ \_ \_ DHCP** y WinHTTP, se especifican marcas de detección automática de **\_ \_ \_ \_ DNS \_** , WinHTTP usará primero DHCP, de acuerdo con la especificación de WPAD.</span><span class="sxs-lookup"><span data-stu-id="ff523-127">If both the **WINHTTP\_AUTO\_DETECT\_TYPE\_DHCP** and **WINHTTP\_AUTO\_DETECT\_TYPE\_DNS\_A** auto-detection flags are specified, WinHTTP uses DHCP first, in accordance with the WPAD specification.</span></span> <span data-ttu-id="ff523-128">Si no se detecta ninguna dirección URL de PAC mediante la emisión de una solicitud DHCP, WinHTTP intentará localizar el archivo PAC en una dirección DNS conocida.</span><span class="sxs-lookup"><span data-stu-id="ff523-128">If no PAC URL is discovered by issuing a DHCP request, then WinHTTP tries to locate the PAC file at a well-known DNS address.</span></span>

<span data-ttu-id="ff523-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) usa el parámetro de identificador de sesión de WinHTTP para almacenar en caché el archivo PAC y los resultados de la detección automática.</span><span class="sxs-lookup"><span data-stu-id="ff523-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) uses the WinHTTP Session handle parameter for caching the PAC file and the results of auto-detection.</span></span> <span data-ttu-id="ff523-130">Es mejor usar el mismo identificador de sesión para varias llamadas **WinHttpGetProxyForUrl** , si es posible, para evitar la detección de archivos y la detección de direcciones URL de PAC repetidas.</span><span class="sxs-lookup"><span data-stu-id="ff523-130">It is best to use the same session handle for multiple **WinHttpGetProxyForUrl** calls if possible to avoid repeated PAC URL detection and file downloading.</span></span> <span data-ttu-id="ff523-131">El archivo PAC se almacena en caché únicamente en memoria y se descarta cuando la aplicación cierra el identificador de sesión.</span><span class="sxs-lookup"><span data-stu-id="ff523-131">The PAC file is cached in-memory only, and is discarded when the application closes the session handle.</span></span>

<span data-ttu-id="ff523-132">Debido al impacto en el rendimiento de AutoProxy, se recomienda que solo los servicios o aplicaciones cliente de escritorio usen la característica; las aplicaciones basadas en servidor deben confiar en el administrador del servidor mediante la utilidad "ProxyCfg.exe".</span><span class="sxs-lookup"><span data-stu-id="ff523-132">Because of the performance impact of autoproxy, it is recommended that only desktop client applications or services use the feature; server-based applications should rely on the server administrator using the "ProxyCfg.exe" utility.</span></span>

 

 



