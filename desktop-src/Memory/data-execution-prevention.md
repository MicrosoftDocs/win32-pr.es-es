---
description: La prevención de ejecución de datos (DEP) es una característica de protección de memoria de nivel de sistema integrada en el sistema operativo a partir de Windows XP y Windows Server 2003.
ms.assetid: 75cd83a5-4b77-4ca9-b595-e32d0dd609d0
title: Prevención de ejecución de datos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bc53febb383ef2789c2798b091960c2d20856d0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105677777"
---
# <a name="data-execution-prevention"></a><span data-ttu-id="32579-103">Prevención de ejecución de datos</span><span class="sxs-lookup"><span data-stu-id="32579-103">Data Execution Prevention</span></span>

<span data-ttu-id="32579-104">La prevención de ejecución de datos (DEP) es una característica de protección de memoria de nivel de sistema integrada en el sistema operativo a partir de Windows XP y Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="32579-104">Data Execution Prevention (DEP) is a system-level memory protection feature that is built into the operating system starting with Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="32579-105">DEP permite que el sistema Marque una o más páginas de memoria como no ejecutables.</span><span class="sxs-lookup"><span data-stu-id="32579-105">DEP enables the system to mark one or more pages of memory as non-executable.</span></span> <span data-ttu-id="32579-106">Marcar regiones de memoria como no ejecutables significa que el código no se puede ejecutar desde esa región de memoria, lo que dificulta la explotación de saturaciones del búfer.</span><span class="sxs-lookup"><span data-stu-id="32579-106">Marking memory regions as non-executable means that code cannot be run from that region of memory, which makes it harder for the exploitation of buffer overruns.</span></span>

<span data-ttu-id="32579-107">DEP impide que el código se ejecute desde páginas de datos como el montón predeterminado, las pilas y los grupos de memoria.</span><span class="sxs-lookup"><span data-stu-id="32579-107">DEP prevents code from being run from data pages such as the default heap, stacks, and memory pools.</span></span> <span data-ttu-id="32579-108">Si una aplicación intenta ejecutar código desde una página de datos que está protegida, se produce una excepción de infracción de acceso a la memoria y, si la excepción no se controla, se termina el proceso de llamada.</span><span class="sxs-lookup"><span data-stu-id="32579-108">If an application attempts to run code from a data page that is protected, a memory access violation exception occurs, and if the exception is not handled, the calling process is terminated.</span></span>

<span data-ttu-id="32579-109">DEP no pretende ser una defensa completa contra todas las vulnerabilidades; está pensado para ser otra herramienta que puede usar para proteger su aplicación.</span><span class="sxs-lookup"><span data-stu-id="32579-109">DEP is not intended to be a comprehensive defense against all exploits; it is intended to be another tool that you can use to secure your application.</span></span>

## <a name="how-data-execution-prevention-works"></a><span data-ttu-id="32579-110">Cómo funciona la prevención de ejecución de datos</span><span class="sxs-lookup"><span data-stu-id="32579-110">How Data Execution Prevention Works</span></span>

<span data-ttu-id="32579-111">Si una aplicación intenta ejecutar código desde una página protegida, la aplicación recibe una excepción con el estado de código **\_ \_ infracción de acceso**.</span><span class="sxs-lookup"><span data-stu-id="32579-111">If an application attempts to run code from a protected page, the application receives an exception with the status code **STATUS\_ACCESS\_VIOLATION**.</span></span> <span data-ttu-id="32579-112">Si la aplicación debe ejecutar código desde una página de memoria, debe asignar y establecer los atributos adecuados de [protección de memoria](memory-protection.md) virtual.</span><span class="sxs-lookup"><span data-stu-id="32579-112">If your application must run code from a memory page, it must allocate and set the proper virtual [memory protection](memory-protection.md) attributes.</span></span> <span data-ttu-id="32579-113">La memoria asignada debe estar marcada como **\_ Ejecutar página**, **página \_ ejecutar \_ lectura**, **página \_ ejecutar \_ ReadWrite** o **página \_ ejecutar \_ WRITECOPY** al asignar memoria.</span><span class="sxs-lookup"><span data-stu-id="32579-113">The allocated memory must be marked **PAGE\_EXECUTE**, **PAGE\_EXECUTE\_READ**, **PAGE\_EXECUTE\_READWRITE**, or **PAGE\_EXECUTE\_WRITECOPY** when allocating memory.</span></span> <span data-ttu-id="32579-114">Las asignaciones del montón realizadas llamando a las funciones **malloc** y [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) no son ejecutables.</span><span class="sxs-lookup"><span data-stu-id="32579-114">Heap allocations made by calling the **malloc** and [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) functions are non-executable.</span></span>

<span data-ttu-id="32579-115">Las aplicaciones no pueden ejecutar código del montón de proceso predeterminado o de la pila.</span><span class="sxs-lookup"><span data-stu-id="32579-115">Applications cannot run code from the default process heap or the stack.</span></span>

<span data-ttu-id="32579-116">DEP se configura en el arranque del sistema según la configuración de la Directiva de protección de página sin ejecutar en los datos de la configuración de arranque.</span><span class="sxs-lookup"><span data-stu-id="32579-116">DEP is configured at system boot according to the no-execute page protection policy setting in the boot configuration data.</span></span> <span data-ttu-id="32579-117">Una aplicación puede obtener la configuración de directiva actual mediante una llamada a la función [**GetSystemDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) .</span><span class="sxs-lookup"><span data-stu-id="32579-117">An application can get the current policy setting by calling the [**GetSystemDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) function.</span></span> <span data-ttu-id="32579-118">En función de la configuración de la Directiva, una aplicación puede cambiar la configuración de DEP para el proceso actual llamando a la función [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) .</span><span class="sxs-lookup"><span data-stu-id="32579-118">Depending on the policy setting, an application can change the DEP setting for the current process by calling the [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) function.</span></span>

## <a name="programming-considerations"></a><span data-ttu-id="32579-119">Consideraciones sobre la programación</span><span class="sxs-lookup"><span data-stu-id="32579-119">Programming Considerations</span></span>

<span data-ttu-id="32579-120">Una aplicación puede usar la función [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) para asignar memoria ejecutable con las opciones de protección de memoria adecuadas.</span><span class="sxs-lookup"><span data-stu-id="32579-120">An application can use the [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) function to allocate executable memory with the appropriate memory protection options.</span></span> <span data-ttu-id="32579-121">Se recomienda que una aplicación establezca, como mínimo, la opción de protección de memoria de la **página \_ Ejecutar** .</span><span class="sxs-lookup"><span data-stu-id="32579-121">It is suggested that an application set, at a minimum, the **PAGE\_EXECUTE** memory protection option.</span></span> <span data-ttu-id="32579-122">Una vez generado el código ejecutable, se recomienda que la aplicación establezca protecciones de memoria para no permitir el acceso de escritura a la memoria asignada.</span><span class="sxs-lookup"><span data-stu-id="32579-122">After the executable code is generated, it is recommended that the application set memory protections to disallow write access to the allocated memory.</span></span> <span data-ttu-id="32579-123">Las aplicaciones pueden impedir el acceso de escritura a la memoria asignada mediante la función [**VirtualProtect (**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) .</span><span class="sxs-lookup"><span data-stu-id="32579-123">Applications can disallow write access to allocated memory by using the [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) function.</span></span> <span data-ttu-id="32579-124">Si no se permite el acceso de escritura, se garantiza la protección máxima para las regiones ejecutables del espacio de direcciones de proceso.</span><span class="sxs-lookup"><span data-stu-id="32579-124">Disallowing write access ensures maximum protection for executable regions of process address space.</span></span> <span data-ttu-id="32579-125">Debe intentar crear aplicaciones que usen el menor espacio de direcciones ejecutable posible, lo que minimiza la cantidad de memoria expuesta a la explotación de la memoria.</span><span class="sxs-lookup"><span data-stu-id="32579-125">You should attempt to create applications that use the smallest executable address space possible, which minimizes the amount of memory that is exposed to memory exploitation.</span></span>

<span data-ttu-id="32579-126">También debe intentar controlar el diseño de la memoria virtual de la aplicación y crear regiones ejecutables.</span><span class="sxs-lookup"><span data-stu-id="32579-126">You should also attempt to control the layout of your application's virtual memory and create executable regions.</span></span> <span data-ttu-id="32579-127">Estas regiones ejecutables se deben ubicar en un espacio de memoria inferior al de las regiones no ejecutables.</span><span class="sxs-lookup"><span data-stu-id="32579-127">These executable regions should be located in a lower memory space than non-executable regions.</span></span> <span data-ttu-id="32579-128">Al buscar regiones ejecutables por debajo de regiones no ejecutables, puede ayudar a evitar que se produzca un desbordamiento del búfer en el área de memoria ejecutable.</span><span class="sxs-lookup"><span data-stu-id="32579-128">By locating executable regions below non-executable regions, you can help prevent a buffer overflow from overflowing into the executable area of memory.</span></span>

## <a name="application-compatibility"></a><span data-ttu-id="32579-129">Compatibilidad de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="32579-129">Application Compatibility</span></span>

<span data-ttu-id="32579-130">Alguna funcionalidad de la aplicación no es compatible con DEP.</span><span class="sxs-lookup"><span data-stu-id="32579-130">Some application functionality is incompatible with DEP.</span></span> <span data-ttu-id="32579-131">Las aplicaciones que realizan la generación dinámica de código (como la generación de código Just-in-Time) y no marcan explícitamente el código generado con el permiso Execute pueden tener problemas de compatibilidad en los equipos que usan DEP.</span><span class="sxs-lookup"><span data-stu-id="32579-131">Applications that perform dynamic code generation (such as Just-In-Time code generation) and do not explicitly mark generated code with execute permission may have compatibility issues on computers that are using DEP.</span></span> <span data-ttu-id="32579-132">Las aplicaciones escritas en la versión 7,1 de Active Template Library (ATL) y versiones anteriores pueden intentar ejecutar código en páginas marcadas como no ejecutables, lo que desencadena un error de NX y finaliza la aplicación; para obtener más información, vea [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy).</span><span class="sxs-lookup"><span data-stu-id="32579-132">Applications written to the Active Template Library (ATL) version 7.1 and earlier can attempt to execute code on pages marked as non-executable, which triggers an NX fault and terminates the application; for more information, see [**SetProcessDEPPolicy**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy).</span></span> <span data-ttu-id="32579-133">La mayoría de las aplicaciones que realizan acciones incompatibles con DEP deben actualizarse para funcionar correctamente.</span><span class="sxs-lookup"><span data-stu-id="32579-133">Most applications that perform actions incompatible with DEP must be updated to function properly.</span></span>

<span data-ttu-id="32579-134">Un pequeño número de bibliotecas y archivos ejecutables puede contener código ejecutable en la sección de datos de un archivo de imagen.</span><span class="sxs-lookup"><span data-stu-id="32579-134">A small number of executable files and libraries may contain executable code in the data section of an image file.</span></span> <span data-ttu-id="32579-135">En algunos casos, las aplicaciones pueden colocar pequeños segmentos de código (denominados comúnmente como thunks) en las secciones de datos.</span><span class="sxs-lookup"><span data-stu-id="32579-135">In some cases, applications may place small segments of code (commonly referred to as thunks) in the data sections.</span></span> <span data-ttu-id="32579-136">Sin embargo, DEP marca las secciones del archivo de imagen que se cargan en memoria como no ejecutables a menos que la sección tenga aplicado el atributo ejecutable.</span><span class="sxs-lookup"><span data-stu-id="32579-136">However, DEP marks sections of the image file that is loaded in memory as non-executable unless the section has the executable attribute applied.</span></span>

<span data-ttu-id="32579-137">Por lo tanto, el código ejecutable de las secciones de datos se debe migrar a una sección de código, o la sección de datos que contiene el código ejecutable debe marcarse explícitamente como ejecutable.</span><span class="sxs-lookup"><span data-stu-id="32579-137">Therefore, executable code in data sections should be migrated to a code section, or the data section that contains the executable code should be explicitly marked as executable.</span></span> <span data-ttu-id="32579-138">El atributo ejecutable, **Image \_ SCN \_ MEM \_ Execute**, debe agregarse al campo **Characteristics** del encabezado de sección correspondiente para las secciones que contienen código ejecutable.</span><span class="sxs-lookup"><span data-stu-id="32579-138">The executable attribute, **IMAGE\_SCN\_MEM\_EXECUTE**, should be added to the **Characteristics** field of the corresponding section header for sections that contain executable code.</span></span> <span data-ttu-id="32579-139">Para obtener más información sobre cómo agregar atributos a una sección, consulte la documentación que se incluye con el enlazador.</span><span class="sxs-lookup"><span data-stu-id="32579-139">For more information about adding attributes to a section, see the documentation included with your linker.</span></span>

## <a name="related-topics"></a><span data-ttu-id="32579-140">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="32579-140">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="32579-141">[Prevención de ejecución de datos (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))</span><span class="sxs-lookup"><span data-stu-id="32579-141">[Data Execution Prevention (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))</span></span>
</dt> <dt>

[<span data-ttu-id="32579-142">Cómo configurar la protección de memoria</span><span class="sxs-lookup"><span data-stu-id="32579-142">How to Configure Memory Protection</span></span>](https://www.microsoft.com/technet/security/prodtech/windowsxp/depcnfxp.mspx)
</dt> <dt>

[<span data-ttu-id="32579-143">Artículo de KB 875352</span><span class="sxs-lookup"><span data-stu-id="32579-143">KB Article 875352</span></span>](https://support.microsoft.com/kb/875352)
</dt> </dl>

 

 
