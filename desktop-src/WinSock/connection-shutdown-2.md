---
description: A continuación se describe el incidente de operaciones para cerrar una conexión de socket establecida.
ms.assetid: 052e04a4-5290-4dca-af7a-cd590ebfbe15
title: Cierre de la conexión
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bbde0cfe4c3a97435c2412d28970107f830308fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103907956"
---
# <a name="connection-shutdown"></a><span data-ttu-id="c4866-103">Cierre de la conexión</span><span class="sxs-lookup"><span data-stu-id="c4866-103">Connection Shutdown</span></span>

<span data-ttu-id="c4866-104">A continuación se describe el incidente de operaciones para cerrar una conexión de socket establecida.</span><span class="sxs-lookup"><span data-stu-id="c4866-104">The following describes operations incident to shutting down an established socket connection.</span></span>

## <a name="initiating-shutdown-sequence"></a><span data-ttu-id="c4866-105">Iniciando secuencia de apagado</span><span class="sxs-lookup"><span data-stu-id="c4866-105">Initiating Shutdown Sequence</span></span>

<span data-ttu-id="c4866-106">Una conexión de socket se puede desconectar de una de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="c4866-106">A socket connection can be taken down in one of several ways.</span></span> <span data-ttu-id="c4866-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (con *el mismo modo* que SD \_ send o SD \_ ) y [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) se puede usar para iniciar un cierre de conexión correcto.</span><span class="sxs-lookup"><span data-stu-id="c4866-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (with *how* equal to SD\_SEND or SD\_BOTH), and [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) may be used to initiate a graceful connection shutdown.</span></span> <span data-ttu-id="c4866-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) se puede usar para iniciar un apagado correcto o anulado, en función de las opciones de permanencia invocadas por el cierre de un socket.</span><span class="sxs-lookup"><span data-stu-id="c4866-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) can be used to initiate either a graceful or abortive shutdown, depending on the linger options invoked by the closing a socket.</span></span> <span data-ttu-id="c4866-109">Vea a continuación para obtener más información acerca de los apagados correctos y anulados y las opciones de permanencia.</span><span class="sxs-lookup"><span data-stu-id="c4866-109">See below for more information about graceful and abortive shutdowns, and linger options.</span></span>

## <a name="indicating-remote-shutdown"></a><span data-ttu-id="c4866-110">Indica apagado remoto</span><span class="sxs-lookup"><span data-stu-id="c4866-110">Indicating Remote Shutdown</span></span>

<span data-ttu-id="c4866-111">Los proveedores de servicios indican la destrucción de la conexión iniciada por la parte remota a través del \_ evento FD Close Network.</span><span class="sxs-lookup"><span data-stu-id="c4866-111">Service providers indicate connection teardown that is initiated by the remote party through the FD\_CLOSE network event.</span></span> <span data-ttu-id="c4866-112">El cierre estable también se indica a través de [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) cuando el número de bytes leídos es 0 para los protocolos de secuencia de bytes o a través de un código de error devuelto de WSAEDISCON para los protocolos orientados a mensajes.</span><span class="sxs-lookup"><span data-stu-id="c4866-112">Graceful shutdown is also be indicated through [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) when the number of bytes read is 0 for byte-stream protocols, or through a return error code of WSAEDISCON for message-oriented protocols.</span></span> <span data-ttu-id="c4866-113">En cualquier caso, un **WSPRecv** de error devuelto de WSAECONNRESET indica un cierre anulado.</span><span class="sxs-lookup"><span data-stu-id="c4866-113">In any case, a **WSPRecv** return error code of WSAECONNRESET indicates an abortive shutdown.</span></span>

## <a name="exchanging-user-data-at-shutdown-time"></a><span data-ttu-id="c4866-114">Intercambio de datos de usuario en tiempo de apagado</span><span class="sxs-lookup"><span data-stu-id="c4866-114">Exchanging User Data at Shutdown Time</span></span>

<span data-ttu-id="c4866-115">En el momento de la destrucción de la conexión, también es posible (para los protocolos que lo admiten) intercambiar datos de usuario entre los extremos.</span><span class="sxs-lookup"><span data-stu-id="c4866-115">At connection teardown time, it is also possible (for protocols that support this) to exchange user data between the endpoints.</span></span> <span data-ttu-id="c4866-116">El extremo que inicia el desmontaje puede llamar a [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) para indicar que no se van a enviar más datos y que se inicie la secuencia de destrucción de la conexión.</span><span class="sxs-lookup"><span data-stu-id="c4866-116">The end that initiates the teardown can call [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to indicate that no more data is to be sent and cause the connection teardown sequence to be initiated.</span></span> <span data-ttu-id="c4866-117">Para determinados protocolos, parte de esta secuencia de desmontaje es la entrega de datos de desconexión del iniciador de desmontaje.</span><span class="sxs-lookup"><span data-stu-id="c4866-117">For certain protocols, part of this teardown sequence is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="c4866-118">Después de recibir el aviso de que el extremo remoto ha iniciado la secuencia de desmontaje (normalmente mediante la indicación FD de \_ cierre), se puede llamar a la función [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) para recibir los datos de desconexión (si los hubiera).</span><span class="sxs-lookup"><span data-stu-id="c4866-118">After receiving notice that the remote end has initiated the teardown sequence (typically through the FD\_CLOSE indication), the [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) function may be called to receive the disconnect data (if any).</span></span>

<span data-ttu-id="c4866-119">Para ilustrar cómo se pueden usar los datos de desconexión, considere el siguiente escenario.</span><span class="sxs-lookup"><span data-stu-id="c4866-119">To illustrate how disconnect data might be used, consider the following scenario.</span></span> <span data-ttu-id="c4866-120">La mitad del cliente de una aplicación cliente/servidor es responsable de finalizar una conexión de socket.</span><span class="sxs-lookup"><span data-stu-id="c4866-120">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="c4866-121">Coincidentes con la terminación que proporciona (a través de los datos de desconexión) el número total de transacciones que ha procesado con el servidor.</span><span class="sxs-lookup"><span data-stu-id="c4866-121">Coincident with the termination it provides (through disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="c4866-122">A su vez, el servidor responde con el total general acumulado de transacciones que ha procesado con todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="c4866-122">The server in turn responds with the cumulative grand total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="c4866-123">La secuencia de llamadas e indicaciones podría producirse tal como se muestra en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="c4866-123">The sequence of calls and indications might occur as shown in the following table.</span></span>

| <span data-ttu-id="c4866-124">En el cliente</span><span class="sxs-lookup"><span data-stu-id="c4866-124">Client side</span></span>                                                                                                               | <span data-ttu-id="c4866-125">En el servidor</span><span class="sxs-lookup"><span data-stu-id="c4866-125">Server side</span></span>                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c4866-126">(1) invoca [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) para concluir la sesión y proporcionar el total de la transacción.</span><span class="sxs-lookup"><span data-stu-id="c4866-126">(1) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to conclude session and supply transaction total.</span></span>            |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="c4866-127">(2) obtiene FD \_ Close o [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) con un valor devuelto de cero o WSAEDISCON que indica un cierre correcto en curso.</span><span class="sxs-lookup"><span data-stu-id="c4866-127">(2) Gets FD\_CLOSE, or [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with a return value of zero or WSAEDISCON indicating graceful shutdown in progress.</span></span> |
|                                                                                                                           | <span data-ttu-id="c4866-128">(3) invoca [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) para obtener el total de la transacción del cliente.</span><span class="sxs-lookup"><span data-stu-id="c4866-128">(3) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to get client's transaction total.</span></span>                                         |
|                                                                                                                           | <span data-ttu-id="c4866-129">(4) calcula el total general acumulado de todas las transacciones.</span><span class="sxs-lookup"><span data-stu-id="c4866-129">(4) Computes cumulative grand total of all transactions.</span></span>                                                                                |
|                                                                                                                           | <span data-ttu-id="c4866-130">(5) invoca [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) para transmitir el total general.</span><span class="sxs-lookup"><span data-stu-id="c4866-130">(5) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to transmit grand total.</span></span>                                                   |
| <span data-ttu-id="c4866-131">(6) recibe la \_ indicación FD de cierre.</span><span class="sxs-lookup"><span data-stu-id="c4866-131">(6) Receives FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="c4866-132">(5 ') invoca [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="c4866-132">(5') Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                 |
| <span data-ttu-id="c4866-133">(7) invoca [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) para recibir y almacenar el total general acumulativo de transacciones.</span><span class="sxs-lookup"><span data-stu-id="c4866-133">(7) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="c4866-134">(8) invoca [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="c4866-134">(8) Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                  |



 

<span data-ttu-id="c4866-135">El paso (5 ') debe seguir el paso (5), pero no tiene ninguna relación de tiempo con los pasos (6), (7) o (8).</span><span class="sxs-lookup"><span data-stu-id="c4866-135">Step (5') must follow step (5), but has no timing relationship with steps (6), (7), or (8).</span></span>

 

 
