---
description: Conceptos básicos de los protocolos WSPListen, WSPAccept y WSPConnect para establecer una conexión de socket con Windows Sockets (Winsock).
ms.assetid: b1b4d6b9-36db-4000-9c6b-662765b6d091
title: 'Conceptos básicos del Protocolo: escuchar, conectar, aceptar'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d62ef290d71e571154b4d022c24c7e21f8fffa1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104154254"
---
# <a name="protocol-basics-listen-connect-accept"></a><span data-ttu-id="70460-103">Conceptos básicos del Protocolo: escuchar, conectar, aceptar</span><span class="sxs-lookup"><span data-stu-id="70460-103">Protocol Basics: Listen, Connect, Accept</span></span>

<span data-ttu-id="70460-104">Las operaciones básicas implicadas en el establecimiento de una conexión de socket se pueden explicar más fácilmente en términos del paradigma cliente-servidor.</span><span class="sxs-lookup"><span data-stu-id="70460-104">The basic operations involved with establishing a socket connection can be most conveniently explained in terms of the client-server paradigm.</span></span>

<span data-ttu-id="70460-105">En primer lugar, el lado servidor creará un socket, lo enlazará a una dirección local conocida (para que el cliente pueda encontrarlo) y colocará el socket en modo de escucha, a través de [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), para preparar las solicitudes de conexión entrantes y especificar la longitud de la cola de trabajo pendiente de conexión.</span><span class="sxs-lookup"><span data-stu-id="70460-105">The server side will first create a socket, bind it to a well known local address (so that the client can find it), and put the socket in listening mode, through [**WSPListen**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), in order to prepare for any incoming connection requests and to specify the length of the connection backlog queue.</span></span> <span data-ttu-id="70460-106">Los proveedores de servicios mantienen solicitudes de conexión pendientes en una cola de trabajos pendientes hasta que el servidor las actúa o cuando se retiran (debido a un tiempo de espera) el cliente.</span><span class="sxs-lookup"><span data-stu-id="70460-106">Service providers hold pending connection requests in a backlog queue until they are acted upon by the server or are withdrawn (due to a time-out) by the client.</span></span> <span data-ttu-id="70460-107">Un proveedor de servicios puede pasar por alto silenciosamente las solicitudes para ampliar el tamaño de la cola de trabajos pendientes más allá de un límite superior definido por el proveedor.</span><span class="sxs-lookup"><span data-stu-id="70460-107">A service provider may silently ignore requests to extend the size of the backlog queue beyond a provider-defined upper limit.</span></span>

<span data-ttu-id="70460-108">En este punto, si se usa un socket de bloqueo, el lado del servidor puede llamar inmediatamente a [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) , que se bloqueará hasta que haya una solicitud de conexión pendiente.</span><span class="sxs-lookup"><span data-stu-id="70460-108">At this point, if a blocking socket is being used, the server side may immediately call [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) which will block until a connection request is pending.</span></span> <span data-ttu-id="70460-109">Por el contrario, el servidor también puede usar uno de los mecanismos de indicación de eventos de red descritos anteriormente para organizar la notificación de solicitudes de conexión entrantes.</span><span class="sxs-lookup"><span data-stu-id="70460-109">Conversely, the server may also use one of the network event indication mechanisms discussed previously to arrange for notification of incoming connection requests.</span></span> <span data-ttu-id="70460-110">Dependiendo del mecanismo de notificación seleccionado, el proveedor emitirá un mensaje de Windows o señalizará un objeto de evento cuando lleguen las solicitudes de conexión.</span><span class="sxs-lookup"><span data-stu-id="70460-110">Depending on the notification mechanism selected, the provider will either issue a Windows message or signal an event object when connection requests arrive.</span></span> <span data-ttu-id="70460-111">Consulte [notificación de eventos de red](notification-of-network-events-2.md) sobre cómo registrarse para el evento de aceptación de red de FD \_ .</span><span class="sxs-lookup"><span data-stu-id="70460-111">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_ACCEPT network event.</span></span>

<span data-ttu-id="70460-112">El lado cliente creará un socket adecuado e iniciará la conexión mediante una llamada a [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), especificando la dirección del servidor conocido.</span><span class="sxs-lookup"><span data-stu-id="70460-112">The client side will create an appropriate socket, and initiate the connection by calling [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85)), specifying the known server address.</span></span> <span data-ttu-id="70460-113">Normalmente, los clientes no realizan una operación de [**enlace**](/windows/desktop/api/winsock/nf-winsock-bind) explícita antes de iniciar una conexión, lo que permite al proveedor de servicios realizar un enlace implícito en su nombre.</span><span class="sxs-lookup"><span data-stu-id="70460-113">Clients usually do not perform an explicit [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) operation prior to initiating a connection, allowing the service provider to perform an implicit bind on their behalf.</span></span> <span data-ttu-id="70460-114">Si el socket está en modo de bloqueo, **WSPConnect** se bloqueará hasta que el servidor haya recibido y actuado en la solicitud de conexión (o hasta que se agote el tiempo de espera).</span><span class="sxs-lookup"><span data-stu-id="70460-114">If the socket is in blocking mode, **WSPConnect** will block until the server has received and acted upon the connection request (or until a time-out occurs).</span></span> <span data-ttu-id="70460-115">De lo contrario, el cliente debe usar uno de los mecanismos de indicación de eventos de red descritos anteriormente para solicitar la notificación de que se ha establecido una nueva conexión.</span><span class="sxs-lookup"><span data-stu-id="70460-115">Otherwise, the client should use one of the network event indication mechanisms discussed previously to arrange for notification of a new connection being established.</span></span> <span data-ttu-id="70460-116">Dependiendo del mecanismo de notificación seleccionado, el proveedor lo indicará a través de un mensaje de Windows o mediante la señalización de un objeto de evento.</span><span class="sxs-lookup"><span data-stu-id="70460-116">Depending on the notification mechanism selected, the provider will indicate this either through a Windows message or by signaling an event object.</span></span>

<span data-ttu-id="70460-117">Cuando el lado del servidor invoca [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), el proveedor de servicios llama a la función de condición proporcionada por la aplicación, usando los parámetros de función para pasar a la información del servidor de la entrada superior en la cola de trabajo pendiente de solicitud de conexión.</span><span class="sxs-lookup"><span data-stu-id="70460-117">When the server side invokes [**WSPAccept**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), the service provider calls the application-supplied condition function, using function parameters to pass into the server information from the top entry in the connection request backlog queue.</span></span> <span data-ttu-id="70460-118">Esta información incluye aspectos como la dirección del host de conexión, los datos de usuario disponibles y cualquier información de QoS disponible.</span><span class="sxs-lookup"><span data-stu-id="70460-118">This information includes such things as address of connecting host, any available user data, and any available QoS information.</span></span> <span data-ttu-id="70460-119">Con esta información, la función de condición del servidor determina si se debe aceptar la solicitud, rechazar la solicitud o aplazar la toma de decisiones hasta más tarde.</span><span class="sxs-lookup"><span data-stu-id="70460-119">Using this information the server's condition function determines whether to accept the request, reject the request, or defer making a decision until later.</span></span> <span data-ttu-id="70460-120">Esta decisión se indica mediante el valor devuelto de la función condition.</span><span class="sxs-lookup"><span data-stu-id="70460-120">This decision is indicated through the return value of the condition function.</span></span> <span data-ttu-id="70460-121">Consulte [notificación de eventos de red](notification-of-network-events-2.md) sobre cómo registrarse para el \_ evento de red FD Connect.</span><span class="sxs-lookup"><span data-stu-id="70460-121">See [Notification of Network Events](notification-of-network-events-2.md) for how to register for the FD\_CONNECT network event.</span></span>

<span data-ttu-id="70460-122">Si el servidor decide aceptar la solicitud, el proveedor debe crear un nuevo socket con todos los mismos atributos y registros de eventos que el socket de escucha.</span><span class="sxs-lookup"><span data-stu-id="70460-122">If the server decides to accept the request, the provider must create a new socket with all of the same attributes and event registrations as the listening socket.</span></span> <span data-ttu-id="70460-123">El socket original permanece en el estado de escucha para que se puedan recibir las solicitudes de conexión posteriores.</span><span class="sxs-lookup"><span data-stu-id="70460-123">The original socket remains in the listening state so that subsequent connection requests can be received.</span></span> <span data-ttu-id="70460-124">A través de los parámetros de salida de la función condition, el servidor también puede proporcionar los datos de usuario de respuesta y asignar parámetros de QoS (suponiendo que estas operaciones sean compatibles con el proveedor de servicios).</span><span class="sxs-lookup"><span data-stu-id="70460-124">Through output parameters of the condition function, the server may also supply any response user data and assign QoS parameters (assuming that these operations are supported by the service provider).</span></span>

 

 
