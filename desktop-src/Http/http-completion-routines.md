---
title: Rutinas de finalización HTTP
description: Las aplicaciones tienen varias opciones para recibir indicaciones de finalización y proporcionar cierta flexibilidad a los desarrolladores.
ms.assetid: c48a64d2-b6c8-4694-8600-f84751954bad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8aee05efc8284cb29130efae4bcaefb4834a3fb4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "103995239"
---
# <a name="http-completion-routines"></a><span data-ttu-id="3d3a5-103">Rutinas de finalización HTTP</span><span class="sxs-lookup"><span data-stu-id="3d3a5-103">HTTP Completion Routines</span></span>

<span data-ttu-id="3d3a5-104">Las aplicaciones tienen varias opciones para recibir indicaciones de finalización y proporcionar cierta flexibilidad a los desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-104">Applications have several options for receiving completion indications and providing some flexibility for developers.</span></span> <span data-ttu-id="3d3a5-105">Las opciones se bloquean mientras se espera a que se complete una llamada API o se usan rutinas de finalización para las operaciones asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-105">The options are to block while waiting for an API call to complete or to use completion routines for asynchronous operations.</span></span> <span data-ttu-id="3d3a5-106">La ventaja de usar operaciones asincrónicas es un aumento de la capacidad de respuesta de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-106">The advantage of using asynchronous operations is an increase in responsiveness of the application.</span></span>

## <a name="blocked-io"></a><span data-ttu-id="3d3a5-107">E/s bloqueada</span><span class="sxs-lookup"><span data-stu-id="3d3a5-107">Blocked I/O</span></span>

<span data-ttu-id="3d3a5-108">Las aplicaciones pueden bloquear mientras esperan a que se complete la llamada a la API estableciendo la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) en **null**.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-108">Applications can block while waiting for the API call to complete by setting the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to **NULL**.</span></span> <span data-ttu-id="3d3a5-109">Esto bloquea realmente todas las operaciones en el subproceso.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-109">This truly blocks all operations on the thread.</span></span> <span data-ttu-id="3d3a5-110">Por ejemplo, en las llamadas a [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), la llamada se bloquea hasta que se interrumpe la conexión.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-110">For example, in calls to [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), the call blocks until the connection is broken.</span></span>

## <a name="asynchronous-io"></a><span data-ttu-id="3d3a5-111">E/s asincrónica</span><span class="sxs-lookup"><span data-stu-id="3d3a5-111">Asynchronous I/O</span></span>

<span data-ttu-id="3d3a5-112">Las aplicaciones que prefieren no bloquearse pueden utilizar la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) para obtener los resultados de finalización.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-112">Applications that prefer not to block can use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to obtain the completion results.</span></span> <span data-ttu-id="3d3a5-113">La aplicación proporciona un puntero a una estructura **superpuesta** , que se utiliza con un objeto de evento o un puerto de finalización.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-113">The application supplies a pointer to an **OVERLAPPED** structure, which is used with an event object or a completion port.</span></span> <span data-ttu-id="3d3a5-114">Con un puerto de finalización de e/s, se usa un identificador HTTP como identificador de archivo en una operación asincrónica de e/s de archivos.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-114">With an I/O completion port, an HTTP handle is used as a file handle would be in an asynchronous file I/O operation.</span></span> <span data-ttu-id="3d3a5-115">En la tabla siguiente se resumen las opciones de finalización disponibles para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-115">The following table summarizes the completion options available to the applications.</span></span>



| <span data-ttu-id="3d3a5-116">Estructura superpuesta</span><span class="sxs-lookup"><span data-stu-id="3d3a5-116">Overlapped structure</span></span> | <span data-ttu-id="3d3a5-117">Objeto de evento</span><span class="sxs-lookup"><span data-stu-id="3d3a5-117">Event object</span></span>   | <span data-ttu-id="3d3a5-118">Puerto de finalización</span><span class="sxs-lookup"><span data-stu-id="3d3a5-118">Completion port</span></span> | <span data-ttu-id="3d3a5-119">Completion</span><span class="sxs-lookup"><span data-stu-id="3d3a5-119">Completion</span></span>                                                                                                   |
|----------------------|----------------|-----------------|--------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3d3a5-120">**NULL**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-120">**NULL**</span></span>             | <span data-ttu-id="3d3a5-121">No es aplicable</span><span class="sxs-lookup"><span data-stu-id="3d3a5-121">Not Applicable</span></span> | <span data-ttu-id="3d3a5-122">Omitido</span><span class="sxs-lookup"><span data-stu-id="3d3a5-122">Ignored</span></span>         | <span data-ttu-id="3d3a5-123">La operación se completa de forma sincrónica.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-123">Operation completes synchronously.</span></span>                                                                           |
| <span data-ttu-id="3d3a5-124">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-124">Non-**NULL**</span></span>         | <span data-ttu-id="3d3a5-125">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-125">Non-**NULL**</span></span>   | <span data-ttu-id="3d3a5-126">**NULL**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-126">**NULL**</span></span>        | <span data-ttu-id="3d3a5-127">La operación se completa de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-127">Operation completes asynchronously.</span></span> <span data-ttu-id="3d3a5-128">La notificación superpuesta se realiza mediante la señalización de un objeto de evento.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-128">Overlapped notification is performed by signaling an event object.</span></span>       |
| <span data-ttu-id="3d3a5-129">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-129">Non-**NULL**</span></span>         | <span data-ttu-id="3d3a5-130">Omitido</span><span class="sxs-lookup"><span data-stu-id="3d3a5-130">Ignored</span></span>        | <span data-ttu-id="3d3a5-131">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-131">Non-**NULL**</span></span>    | <span data-ttu-id="3d3a5-132">La operación se completa de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-132">Operation completes asynchronously.</span></span> <span data-ttu-id="3d3a5-133">La notificación superpuesta se realiza mediante la programación de una rutina de finalización.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-133">Overlapped notification is performed by scheduling a completion routine.</span></span> |



 

## <a name="returning-the-number-of-bytes-read"></a><span data-ttu-id="3d3a5-134">Devolver el número de bytes leídos</span><span class="sxs-lookup"><span data-stu-id="3d3a5-134">Returning the Number of Bytes Read</span></span>

<span data-ttu-id="3d3a5-135">Algunas de las funciones que usan la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) para la finalización asincrónica devuelven un parámetro *PBytesReceived* (o *pBytesSent* o *pBytesRead*) que indica el número de bytes transferidos sincrónicamente.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-135">Some of the functions that use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure for asynchronous completion return a *pBytesReceived* (or *pBytesSent* or *pBytesRead*) parameter that indicates the number of bytes transferred synchronously.</span></span> <span data-ttu-id="3d3a5-136">En el caso de las llamadas asincrónicas, este parámetro debe establecerse en **null**.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-136">For asynchronous calls, this parameter should be set to **NULL**.</span></span> <span data-ttu-id="3d3a5-137">En el caso de las llamadas sincrónicas, el parámetro *pBytesReceived* es opcional y puede ser **null** o no **null**.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-137">For synchronous calls, the *pBytesReceived* parameter is optional and can be either **NULL** or non-**NULL**.</span></span>

<span data-ttu-id="3d3a5-138">Si el objeto de evento se utiliza para la finalización asincrónica, se llama a la función [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) para determinar el número de bytes leídos.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-138">If the event object is used for asynchronous completion, the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function is called to determine the number of bytes read.</span></span> <span data-ttu-id="3d3a5-139">Si se usa el puerto de finalización (el parámetro *hFile* está asociado a un puerto de finalización de e/s), la aplicación llama a la función [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) para determinar el número de bytes leídos.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-139">If the completion port is used (the *hFile* parameter is associated with an I/O completion port), the application calls the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to determine the number of bytes read.</span></span> <span data-ttu-id="3d3a5-140">Si no se han completado las operaciones asincrónicas, las aplicaciones pueden llamar a la función [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) para obtener información de error extendida.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-140">If the asynchronous operations have not completed, applications can call the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to obtain extended error information.</span></span>

<span data-ttu-id="3d3a5-141">En la tabla siguiente se resume el comportamiento de finalización de la finalización sincrónica y asincrónica de funciones como [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) que usan el parámetro *pBytesReceived* .</span><span class="sxs-lookup"><span data-stu-id="3d3a5-141">The following table summarizes the completion behavior for synchronous and asynchronous completion in functions such as [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) that use the *pBytesReceived* parameter.</span></span>



| <span data-ttu-id="3d3a5-142">pBytesReceived\*</span><span class="sxs-lookup"><span data-stu-id="3d3a5-142">pBytesReceived\*</span></span> | <span data-ttu-id="3d3a5-143">pOverlapped</span><span class="sxs-lookup"><span data-stu-id="3d3a5-143">pOverlapped</span></span>  | <span data-ttu-id="3d3a5-144">Descripción</span><span class="sxs-lookup"><span data-stu-id="3d3a5-144">Description</span></span>                                                                             |
|------------------|--------------|-----------------------------------------------------------------------------------------|
| <span data-ttu-id="3d3a5-145">**NULL**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-145">**NULL**</span></span>         | <span data-ttu-id="3d3a5-146">**NULL**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-146">**NULL**</span></span>     | <span data-ttu-id="3d3a5-147">La aplicación no recibe información sobre el número de bytes devueltos.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-147">The application does not receive information on the number of bytes returned.</span></span>           |
| <span data-ttu-id="3d3a5-148">**NULL**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-148">**NULL**</span></span>         | <span data-ttu-id="3d3a5-149">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-149">Non-**NULL**</span></span> | <span data-ttu-id="3d3a5-150">Operación asincrónica, *pBytesReceived* no tiene sentido.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-150">Asynchronous operation, *pBytesReceived* is meaningless.</span></span>                                |
| <span data-ttu-id="3d3a5-151">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-151">Non-**NULL**</span></span>     | <span data-ttu-id="3d3a5-152">**NULL**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-152">**NULL**</span></span>     | <span data-ttu-id="3d3a5-153">Operación sincrónica, número de bytes devueltos en *pBytesReceived*.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-153">Synchronous operation, number of bytes returned in *pBytesReceived*.</span></span>                    |
| <span data-ttu-id="3d3a5-154">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-154">Non-**NULL**</span></span>     | <span data-ttu-id="3d3a5-155">No **null**</span><span class="sxs-lookup"><span data-stu-id="3d3a5-155">Non-**NULL**</span></span> | <span data-ttu-id="3d3a5-156">Operación asincrónica, *pBytesReceived* se omite aunque no sea **null**.\*\*</span><span class="sxs-lookup"><span data-stu-id="3d3a5-156">Asynchronous operation, *pBytesReceived* is ignored even though it is not **NULL**.\*\*</span></span> |



 

> [!Note]  
> <span data-ttu-id="3d3a5-157">\*Este parámetro también puede ser *pBytesSent* o *pBytesRead*.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-157">\*This parameter can also be *pBytesSent* or *pBytesRead*.</span></span>

 

> [!Note]  
> <span data-ttu-id="3d3a5-158">\*\*Se recomienda que las aplicaciones pasen un **valor null** en *pBytesReceived* para las operaciones asincrónicas y obtengan el número de bytes recibidos de [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) o [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span><span class="sxs-lookup"><span data-stu-id="3d3a5-158">\*\*It is recommended that applications pass a **NULL** in *pBytesReceived* for asynchronous operations and obtain the number of bytes received from either [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span></span>

 

## <a name="return-codes"></a><span data-ttu-id="3d3a5-159">Códigos de retorno</span><span class="sxs-lookup"><span data-stu-id="3d3a5-159">Return Codes</span></span>

<span data-ttu-id="3d3a5-160">La API del servidor HTTP devuelve tres clases de códigos para las llamadas de función asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-160">The HTTP Server API returns three classes of codes for asynchronous function calls.</span></span>

-   <span data-ttu-id="3d3a5-161">SIN \_ errores</span><span class="sxs-lookup"><span data-stu-id="3d3a5-161">NO\_ERROR</span></span>
-   <span data-ttu-id="3d3a5-162">\_e/s de errores \_ pendientes</span><span class="sxs-lookup"><span data-stu-id="3d3a5-162">ERROR\_IO\_PENDING</span></span>
-   <span data-ttu-id="3d3a5-163">Cualquier otro [código de error del sistema](/windows/desktop/Debug/system-error-codes).</span><span class="sxs-lookup"><span data-stu-id="3d3a5-163">Any other [system error code](/windows/desktop/Debug/system-error-codes).</span></span>

<span data-ttu-id="3d3a5-164">Cuando \_ se produce un error de e/s \_ pendiente o no \_ se devuelve ningún error de la llamada de función asincrónica, los usuarios deben esperar que se señale el evento o la rutina de finalización.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-164">When ERROR\_IO\_PENDING or NO\_ERROR are returned from the asynchronous function call, users should expect the event or completion routine to be signaled.</span></span> <span data-ttu-id="3d3a5-165">La llamada a la función [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) para el evento o la función [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) para el puerto de finalización devuelve el estado de finalización.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-165">Calling the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function for the event or the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function for the completion port returns the completion status.</span></span> <span data-ttu-id="3d3a5-166">Además, si NO \_ se devuelve ningún error, las aplicaciones pueden realizar el procesamiento posterior en el mismo subproceso que realizó la llamada API.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-166">In addition, if NO\_ERROR is returned, applications can perform post-processing on the same thread that made the API call.</span></span>

<span data-ttu-id="3d3a5-167">Si la API del servidor HTTP devuelve algo distinto del ERROR de \_ e/s \_ pendiente o NO hay ningún \_ error, de la llamada de función asincrónica, la rutina de finalización no se señala y el error lo devuelve directamente la API.</span><span class="sxs-lookup"><span data-stu-id="3d3a5-167">If the HTTP Server API returns anything other than ERROR\_IO\_PENDING or NO\_ERROR, from the asynchronous function call, the completion routine is not signaled, and the error is directly returned by the API.</span></span>

 

 