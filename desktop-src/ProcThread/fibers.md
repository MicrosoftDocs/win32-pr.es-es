---
description: Una fibra es una unidad de ejecución que debe ser programada manualmente por la aplicación.
ms.assetid: 6283f56b-23ae-4840-abd0-2478a50c670c
title: Fibra
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ea0383e6d207a77c621f00f358c72bb8873ecb5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103813771"
---
# <a name="fibers"></a><span data-ttu-id="515e2-103">Fibra</span><span class="sxs-lookup"><span data-stu-id="515e2-103">Fibers</span></span>

<span data-ttu-id="515e2-104">Una *fibra* es una unidad de ejecución que debe ser programada manualmente por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="515e2-104">A *fiber* is a unit of execution that must be manually scheduled by the application.</span></span> <span data-ttu-id="515e2-105">Las fibras se ejecutan en el contexto de los subprocesos que las programan.</span><span class="sxs-lookup"><span data-stu-id="515e2-105">Fibers run in the context of the threads that schedule them.</span></span> <span data-ttu-id="515e2-106">Cada subproceso puede programar varios fibras.</span><span class="sxs-lookup"><span data-stu-id="515e2-106">Each thread can schedule multiple fibers.</span></span> <span data-ttu-id="515e2-107">En general, las fibras no proporcionan ventajas en una aplicación multiproceso bien diseñada.</span><span class="sxs-lookup"><span data-stu-id="515e2-107">In general, fibers do not provide advantages over a well-designed multithreaded application.</span></span> <span data-ttu-id="515e2-108">Sin embargo, el uso de fibras puede facilitar el traslado de aplicaciones diseñadas para programar sus propios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="515e2-108">However, using fibers can make it easier to port applications that were designed to schedule their own threads.</span></span>

<span data-ttu-id="515e2-109">Desde el punto de vista del sistema, una fibra supone la identidad del subproceso que la ejecuta.</span><span class="sxs-lookup"><span data-stu-id="515e2-109">From a system standpoint, a fiber assumes the identity of the thread that runs it.</span></span> <span data-ttu-id="515e2-110">Por ejemplo, si una fibra tiene acceso al [almacenamiento local de subprocesos](thread-local-storage.md) (TLS), tiene acceso al almacenamiento local de subprocesos del subproceso que lo está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="515e2-110">For example, if a fiber accesses [thread local storage](thread-local-storage.md) (TLS), it is accessing the thread local storage of the thread that is running it.</span></span> <span data-ttu-id="515e2-111">Además, si una fibra llama a la función [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) , el subproceso que lo está ejecutando finaliza.</span><span class="sxs-lookup"><span data-stu-id="515e2-111">In addition, if a fiber calls the [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) function, the thread that is running it exits.</span></span> <span data-ttu-id="515e2-112">Sin embargo, una fibra no tiene la misma información de estado asociada que la asociada a un subproceso.</span><span class="sxs-lookup"><span data-stu-id="515e2-112">However, a fiber does not have all the same state information associated with it as that associated with a thread.</span></span> <span data-ttu-id="515e2-113">La única información de estado que se mantiene para una fibra es su pila, un subconjunto de sus registros y los datos de fibra proporcionados durante la creación de fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-113">The only state information maintained for a fiber is its stack, a subset of its registers, and the fiber data provided during fiber creation.</span></span> <span data-ttu-id="515e2-114">Los registros guardados son el conjunto de registros que normalmente se conservan a través de una llamada de función.</span><span class="sxs-lookup"><span data-stu-id="515e2-114">The saved registers are the set of registers typically preserved across a function call.</span></span>

<span data-ttu-id="515e2-115">Las fibras no se programan de forma preferente.</span><span class="sxs-lookup"><span data-stu-id="515e2-115">Fibers are not preemptively scheduled.</span></span> <span data-ttu-id="515e2-116">Puede programar una fibra cambiando a ella desde otra fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-116">You schedule a fiber by switching to it from another fiber.</span></span> <span data-ttu-id="515e2-117">El sistema sigue programando los subprocesos para ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="515e2-117">The system still schedules threads to run.</span></span> <span data-ttu-id="515e2-118">Cuando se modifica un subproceso que ejecuta fibras, se retiene la fibra que se está ejecutando actualmente, pero permanece seleccionada.</span><span class="sxs-lookup"><span data-stu-id="515e2-118">When a thread running fibers is preempted, its currently running fiber is preempted but remains selected.</span></span> <span data-ttu-id="515e2-119">La fibra seleccionada se ejecuta cuando se ejecuta el subproceso.</span><span class="sxs-lookup"><span data-stu-id="515e2-119">The selected fiber runs when its thread runs.</span></span>

<span data-ttu-id="515e2-120">Antes de programar la primera fibra, llame a la función [**ConvertThreadToFiber**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) para crear un área en la que guardar la información de estado de fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-120">Before scheduling the first fiber, call the [**ConvertThreadToFiber**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) function to create an area in which to save fiber state information.</span></span> <span data-ttu-id="515e2-121">El subproceso que realiza la llamada es ahora la fibra que se está ejecutando actualmente.</span><span class="sxs-lookup"><span data-stu-id="515e2-121">The calling thread is now the currently executing fiber.</span></span> <span data-ttu-id="515e2-122">La información de estado almacenada para esta fibra incluye los datos de fibra pasados como argumento a **ConvertThreadToFiber**.</span><span class="sxs-lookup"><span data-stu-id="515e2-122">The stored state information for this fiber includes the fiber data passed as an argument to **ConvertThreadToFiber**.</span></span>

<span data-ttu-id="515e2-123">La función [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) se usa para crear una nueva fibra a partir de una fibra existente. la llamada requiere el tamaño de la pila, la dirección inicial y los datos de fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-123">The [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function is used to create a new fiber from an existing fiber; the call requires the stack size, the starting address, and the fiber data.</span></span> <span data-ttu-id="515e2-124">Normalmente, la dirección de inicio es una función proporcionada por el usuario, denominada función de fibra, que toma un parámetro (los datos de fibra) y no devuelve un valor.</span><span class="sxs-lookup"><span data-stu-id="515e2-124">The starting address is typically a user-supplied function, called the fiber function, that takes one parameter (the fiber data) and does not return a value.</span></span> <span data-ttu-id="515e2-125">Si la función de fibra devuelve, el subproceso que ejecuta la fibra sale.</span><span class="sxs-lookup"><span data-stu-id="515e2-125">If your fiber function returns, the thread running the fiber exits.</span></span> <span data-ttu-id="515e2-126">Para ejecutar cualquier fibra creada con **CreateFiber**, llame a la función [**SwitchToFiber**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) .</span><span class="sxs-lookup"><span data-stu-id="515e2-126">To execute any fiber created with **CreateFiber**, call the [**SwitchToFiber**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) function.</span></span> <span data-ttu-id="515e2-127">Puede llamar a **SwitchToFiber** con la dirección de una fibra creada por un subproceso diferente.</span><span class="sxs-lookup"><span data-stu-id="515e2-127">You can call **SwitchToFiber** with the address of a fiber created by a different thread.</span></span> <span data-ttu-id="515e2-128">Para ello, debe tener la dirección devuelta al otro subproceso cuando llame a **CreateFiber** y debe usar la sincronización adecuada.</span><span class="sxs-lookup"><span data-stu-id="515e2-128">To do this, you must have the address returned to the other thread when it called **CreateFiber** and you must use proper synchronization.</span></span>

<span data-ttu-id="515e2-129">Una fibra puede recuperar los datos de fibra llamando a la macro [**GetFiberData**](/windows/win32/api/winnt/nf-winnt-getfiberdata) .</span><span class="sxs-lookup"><span data-stu-id="515e2-129">A fiber can retrieve the fiber data by calling the [**GetFiberData**](/windows/win32/api/winnt/nf-winnt-getfiberdata) macro.</span></span> <span data-ttu-id="515e2-130">Una fibra puede recuperar la dirección de fibra en cualquier momento llamando a la macro [**GetCurrentFiber**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) .</span><span class="sxs-lookup"><span data-stu-id="515e2-130">A fiber can retrieve the fiber address at any time by calling the [**GetCurrentFiber**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) macro.</span></span>

## <a name="fiber-local-storage"></a><span data-ttu-id="515e2-131">Almacenamiento local de fibra</span><span class="sxs-lookup"><span data-stu-id="515e2-131">Fiber Local Storage</span></span>

<span data-ttu-id="515e2-132">Una fibra puede usar el *almacenamiento local de fibra* (FLS) para crear una copia única de una variable para cada fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-132">A fiber can use *fiber local storage* (FLS) to create a unique copy of a variable for each fiber.</span></span> <span data-ttu-id="515e2-133">Si no se produce la conmutación de fibra, FLS actúa exactamente igual que el [almacenamiento local del subproceso](thread-local-storage.md).</span><span class="sxs-lookup"><span data-stu-id="515e2-133">If no fiber switching occurs, FLS acts exactly the same as [thread local storage](thread-local-storage.md).</span></span> <span data-ttu-id="515e2-134">Las funciones FLS ([**FlsAlloc**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**FlsFree**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**FlsGetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue)y [**FlsSetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) manipulan el FLS asociado al subproceso actual.</span><span class="sxs-lookup"><span data-stu-id="515e2-134">The FLS functions ([**FlsAlloc**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**FlsFree**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**FlsGetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue), and [**FlsSetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) manipulate the FLS associated with the current thread.</span></span> <span data-ttu-id="515e2-135">Si el subproceso está ejecutando una fibra y se cambia la fibra, también se cambia el FLS.</span><span class="sxs-lookup"><span data-stu-id="515e2-135">If the thread is executing a fiber and the fiber is switched, the FLS is also switched.</span></span>

<span data-ttu-id="515e2-136">Para limpiar los datos asociados a una fibra, llame a la función [**DeleteFiber**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) .</span><span class="sxs-lookup"><span data-stu-id="515e2-136">To clean up the data associated with a fiber, call the [**DeleteFiber**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) function.</span></span> <span data-ttu-id="515e2-137">Estos datos incluyen la pila, un subconjunto de los registros y los datos de fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-137">This data includes the stack, a subset of the registers, and the fiber data.</span></span> <span data-ttu-id="515e2-138">Si la fibra que se está ejecutando actualmente llama a **DeleteFiber**, su subproceso llama a [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) y termina.</span><span class="sxs-lookup"><span data-stu-id="515e2-138">If the currently running fiber calls **DeleteFiber**, its thread calls [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) and terminates.</span></span> <span data-ttu-id="515e2-139">Sin embargo, si una fibra que se ejecuta en otro subproceso elimina la fibra seleccionada de un subproceso, es probable que el subproceso con la fibra eliminada finalice de forma anómala porque se ha liberado la pila de fibra.</span><span class="sxs-lookup"><span data-stu-id="515e2-139">However, if the selected fiber of a thread is deleted by a fiber running in another thread, the thread with the deleted fiber is likely to terminate abnormally because the fiber stack has been freed.</span></span>

## <a name="related-topics"></a><span data-ttu-id="515e2-140">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="515e2-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="515e2-141">Uso de fibras</span><span class="sxs-lookup"><span data-stu-id="515e2-141">Using Fibers</span></span>](using-fibers.md)
</dt> </dl>

 

 
