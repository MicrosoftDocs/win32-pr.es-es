---
title: Firma de Authenticode para desarrolladores de juegos
description: En este artículo se describe cómo empezar a trabajar con la autenticación del juego y cómo integrar la autenticación en un proceso de compilación diario.
ms.assetid: 0b3138ea-e4ea-57fb-756b-62fdc20cf813
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f304e6cc8e185264699709987f62dfdca17bf8b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105665851"
---
# <a name="authenticode-signing-for-game-developers"></a><span data-ttu-id="9f8a1-103">Firma de Authenticode para desarrolladores de juegos</span><span class="sxs-lookup"><span data-stu-id="9f8a1-103">Authenticode Signing for Game Developers</span></span>

<span data-ttu-id="9f8a1-104">La autenticación de datos es cada vez más importante para los desarrolladores de juegos.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-104">Data authentication is increasingly important for game developers.</span></span> <span data-ttu-id="9f8a1-105">Windows Vista y Windows 7 tienen una serie de características, como controles parentales, que requieren que los juegos estén firmados correctamente para asegurarse de que nadie haya manipulado los datos.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-105">Windows Vista and Windows 7 have a number of features, such as parental controls, that require games to be properly signed to ensure that no one has tampered with the data.</span></span> <span data-ttu-id="9f8a1-106">Microsoft Authenticode permite a los usuarios finales y al sistema operativo comprobar que el código de programa procede del propietario legítimo y que no se ha modificado o dañado accidentalmente.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-106">Microsoft Authenticode enables end users and the operating system to verify that program code comes from the rightful owner and that it hasn't been maliciously altered or accidentally corrupted.</span></span> <span data-ttu-id="9f8a1-107">En este artículo se describe cómo empezar a trabajar con la autenticación del juego y cómo integrar la autenticación en un proceso de compilación diario.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-107">This article discusses how to get started with authenticating your game and how to integrate authentication into a daily build process.</span></span>

-   [<span data-ttu-id="9f8a1-108">Información preliminar</span><span class="sxs-lookup"><span data-stu-id="9f8a1-108">Background</span></span>](#background)
-   [<span data-ttu-id="9f8a1-109">Introducción</span><span class="sxs-lookup"><span data-stu-id="9f8a1-109">Getting Started</span></span>](#getting-started)
-   [<span data-ttu-id="9f8a1-110">Usar una entidad de certificación de confianza</span><span class="sxs-lookup"><span data-stu-id="9f8a1-110">Using a Trusted Certificate Authority</span></span>](#using-a-trusted-certificate-authority)
-   [<span data-ttu-id="9f8a1-111">Ejemplo de uso de un certificado de prueba</span><span class="sxs-lookup"><span data-stu-id="9f8a1-111">Example Using a Test Certificate</span></span>](#example-using-a-test-certificate)
-   [<span data-ttu-id="9f8a1-112">Integración del código que inicia sesión en el sistema de compilación diario</span><span class="sxs-lookup"><span data-stu-id="9f8a1-112">Integrating Code Signing into the Daily Build System</span></span>](#integrating-code-signing-into-the-daily-build-system)
-   [<span data-ttu-id="9f8a1-113">Revocación</span><span class="sxs-lookup"><span data-stu-id="9f8a1-113">Revocation</span></span>](#revocation)
-   [<span data-ttu-id="9f8a1-114">Controladores de firma de código</span><span class="sxs-lookup"><span data-stu-id="9f8a1-114">Code-Signing Drivers</span></span>](#code-signing-drivers)
-   [<span data-ttu-id="9f8a1-115">Resumen</span><span class="sxs-lookup"><span data-stu-id="9f8a1-115">Summary</span></span>](#summary)
-   [<span data-ttu-id="9f8a1-116">Más información</span><span class="sxs-lookup"><span data-stu-id="9f8a1-116">More information</span></span>](#more-information)

> [!Note]  
> <span data-ttu-id="9f8a1-117">A partir del 1 de enero de 2016, Windows 7 y versiones posteriores ya no confían en ningún certificado de firma de código SHA-1 con una fecha de expiración del 1 de enero de 2016 o posterior.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-117">As of January 1, 2016, Windows 7 and later no longer trust any SHA-1 code signing certificate with an expiration date of January 1, 2016 or later.</span></span> <span data-ttu-id="9f8a1-118">Para obtener más información [, vea aplicación de Windows de firma de código Authenticode y marcas](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) de tiempo.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-118">See [Windows Enforcement of Authenticode Code Signing and Timestamping](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) for more information.</span></span>

 

## <a name="background"></a><span data-ttu-id="9f8a1-119">Información previa</span><span class="sxs-lookup"><span data-stu-id="9f8a1-119">Background</span></span>

<span data-ttu-id="9f8a1-120">Los certificados digitales se usan para establecer la identidad del autor.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-120">Digital certificates are used to establish the identity of the author.</span></span> <span data-ttu-id="9f8a1-121">Los certificados digitales los emite un tercero de confianza conocido como una entidad de certificación (CA), como VeriSign o Thawte.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-121">Digital certificates are issued by a trusted third party known as a Certificate Authority (CA) such as VeriSign or Thawte.</span></span> <span data-ttu-id="9f8a1-122">La entidad de certificación es responsable de comprobar que el propietario no reclama una identificación falsa.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-122">The CA is responsible for verifying that owner is not claiming a false identify.</span></span> <span data-ttu-id="9f8a1-123">Después de aplicar a una entidad de certificación (CA) para un certificado, los desarrolladores comerciales pueden esperar una respuesta a su aplicación en menos de dos semanas.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-123">After applying to a CA for a certificate, commercial developers can expect a response to their application in less than two weeks.</span></span>

<span data-ttu-id="9f8a1-124">Después de que la CA decida que cumple sus criterios de Directiva, genera un certificado de firma de código que se ajusta a X. 509, el formato de certificado estándar del sector creado por la Unión Internacional de telecomunicaciones, con las extensiones de la versión 3.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-124">After the CA decides that you meet its policy criteria, it generates a code-signing certificate that conforms to X.509, the industry-standard certificate format created by the International Telecommunications Union, with Version 3 extensions.</span></span> <span data-ttu-id="9f8a1-125">Este certificado le identifica y contiene la clave pública.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-125">This certificate identifies you and contains your public key.</span></span> <span data-ttu-id="9f8a1-126">Lo almacena la CA como referencia y se le proporciona una copia electrónicamente.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-126">It is stored by the CA for reference, and a copy is given to you electronically.</span></span> <span data-ttu-id="9f8a1-127">Al mismo tiempo, también se crea una clave privada que debe mantener la seguridad y que no debe compartir con nadie, ni siquiera con la CA.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-127">At the same time, you also create a private, key which you must keep safe and which you must not share with anyone, even the CA.</span></span>

<span data-ttu-id="9f8a1-128">Una vez que tenga una clave pública y una privada, puede empezar a distribuir el software firmado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-128">After you have a public and private key, you can then begin distributing signed software.</span></span> <span data-ttu-id="9f8a1-129">Microsoft proporciona herramientas para hacerlo en el Windows SDK.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-129">Microsoft provides tools to do this in the Windows SDK.</span></span> <span data-ttu-id="9f8a1-130">Las herramientas de usan un hash unidireccional, producen un resumen de longitud fija y generan una firma cifrada con una clave privada.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-130">The tools utilize a one-way hash, produce a fixed-length digest, and generate an encrypted signature with a private key.</span></span> <span data-ttu-id="9f8a1-131">A continuación, combinan esa firma cifrada con el certificado y las credenciales en una estructura denominada bloque de firma e incrustarla en el formato de archivo del ejecutable.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-131">They then combine that encrypted signature with your certificate and credentials into a structure known as a signature block and embed it into the file format of the executable.</span></span> <span data-ttu-id="9f8a1-132">Se puede firmar cualquier tipo de archivo binario ejecutable, incluidos los archivos dll, los archivos ejecutables y los archivos. cab.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-132">Any type of executable binary file can be signed, including DLLs, executable files, and cabinet files.</span></span>

<span data-ttu-id="9f8a1-133">La firma se puede comprobar de varias maneras.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-133">The signature can be verified in multiple ways.</span></span> <span data-ttu-id="9f8a1-134">Los programas pueden llamar a la función CertVerifyCertificateChainPolicy y se puede usar SignTool (signtool.exe) para comprobar una firma desde el símbolo de la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-134">Programs can call the CertVerifyCertificateChainPolicy function, and SignTool (signtool.exe) can be used to verify a signature from the command-line prompt.</span></span> <span data-ttu-id="9f8a1-135">El explorador de Windows también tiene una pestaña firmas digitales en las propiedades del archivo que muestra cada certificado de un archivo binario firmado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-135">Windows Explorer also has a Digital Signatures tab in File Properties that displays each certificate of a signed binary file.</span></span> <span data-ttu-id="9f8a1-136">(La pestaña firmas digitales solo aparece en las propiedades de archivo de los archivos firmados.) Además, una aplicación se puede autocomprobar mediante el uso de [**CertVerifyCertificateChainPolicy**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-136">(The Digital Signatures tab only appears in File Properties for signed files.) Also, an application can be self-verifying by use of [**CertVerifyCertificateChainPolicy**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).</span></span>

<span data-ttu-id="9f8a1-137">La firma Authenticode no solo es útil para la autenticación de datos por parte de los usuarios finales, sino que también se necesita para aplicar revisiones de cuentas de usuario limitadas y controles parentales en Windows Vista y Windows 7.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-137">Authenticode signing is not only useful for data authentication by end users, but is also needed for patching of Limited User Accounts and by parental controls in Windows Vista and Windows 7.</span></span> <span data-ttu-id="9f8a1-138">Además, las tecnologías futuras de los sistemas operativos Windows también pueden requerir que el código esté firmado, por lo que se recomienda encarecidamente que todos los desarrolladores profesionales y aficionados adquieran un certificado de firma de código de una entidad de certificación.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-138">In addition, future technologies in Windows operating systems may also require that code is signed, so it is strongly advised that all professional and amateur developers acquire a code-signing certificate from a CA.</span></span> <span data-ttu-id="9f8a1-139">Puede encontrar más información sobre cómo hacerlo más adelante en este artículo sobre el [uso de una entidad de certificación de confianza](#using-a-trusted-certificate-authority).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-139">More information on how this is done can be found later in this article in [Using a Trusted Certificate Authority](#using-a-trusted-certificate-authority).</span></span>

<span data-ttu-id="9f8a1-140">El código de juego, los evaluadores y los instaladores pueden aprovechar aún más la firma de Authenicode comprobando que los archivos son auténticos en el código.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-140">Game code, patchers, and installers can further leverage Authenicode signing by verifying files are authentic in code.</span></span> <span data-ttu-id="9f8a1-141">Se puede usar para la protección de la red y la prevención de la seguridad general.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-141">This can be used for anti-cheat and general network security.</span></span> <span data-ttu-id="9f8a1-142">Aquí se puede encontrar código de ejemplo para comprobar si un archivo está firmado: [ejemplo de programa C: comprobar la firma de un archivo PE](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file)y ver el código de ejemplo para comprobar la propiedad de un certificado de firma en un archivo firmado: [Cómo obtener información de los ejecutables firmados con Authenticode](https://support.microsoft.com/kb/323809).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-142">Example code for checking if a file is signed can be found here: [Example C Program: Verifying the Signature of a PE File](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file), and example code for checking ownership of a signing certificate on a signed file can be found here: [How To Get Information from Authenticode Signed Executables](https://support.microsoft.com/kb/323809).</span></span>

## <a name="getting-started"></a><span data-ttu-id="9f8a1-143">Introducción</span><span class="sxs-lookup"><span data-stu-id="9f8a1-143">Getting Started</span></span>

<span data-ttu-id="9f8a1-144">Para empezar, Microsoft proporciona herramientas con Visual Studio 2005 y Visual Studio 2008 y, en el [Windows SDK](https://msdn.microsoft.com/windowsserver/bb980924.aspx), para ayudar a realizar y comprobar el proceso de firma de código.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-144">To get started, Microsoft provides tools with Visual Studio 2005 and Visual Studio 2008, and in the [Windows SDK](https://msdn.microsoft.com/windowsserver/bb980924.aspx), to help perform and verify the code-signing process.</span></span> <span data-ttu-id="9f8a1-145">Después de instalar Visual Studio o el Windows SDK, las herramientas descritas en este artículo técnico se encuentran en un subdirectorio de la instalación, que puede incluir uno o varios de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="9f8a1-145">After installing Visual Studio or the Windows SDK, the tools described in this technical article are located in a subdirectory of the installation, which may include one or more of the following:</span></span>

-   <span data-ttu-id="9f8a1-146">% SystemDrive% \\ archivos de programa \\ Microsoft Visual Studio 8 \\ SDK \\ v 2.0 \\ bin</span><span class="sxs-lookup"><span data-stu-id="9f8a1-146">%SystemDrive%\\Program Files\\Microsoft Visual Studio 8\\SDK\\v2.0\\Bin</span></span>
-   <span data-ttu-id="9f8a1-147">% SystemDrive% \\ archivos de programa \\ Microsoft Visual Studio 8 \\ VC \\ PlatformSDK \\ bin</span><span class="sxs-lookup"><span data-stu-id="9f8a1-147">%SystemDrive%\\Program Files\\Microsoft Visual Studio 8\\VC\\PlatformSDK\\Bin</span></span>
-   <span data-ttu-id="9f8a1-148">% SystemDrive% \\ archivos de programa \\ Microsoft Visual Studio 9,0 \\ SmartDevices \\ SDK \\ SDKTools</span><span class="sxs-lookup"><span data-stu-id="9f8a1-148">%SystemDrive%\\Program Files\\Microsoft Visual Studio 9.0\\SmartDevices\\SDK\\SDKTools</span></span>\\
-   <span data-ttu-id="9f8a1-149">% SystemDrive% \\ archivos \\ de programa Microsoft SDK \\ Windows \\ v 6.0 a \\ bin</span><span class="sxs-lookup"><span data-stu-id="9f8a1-149">%SystemDrive%\\Program Files\\Microsoft SDKs\\Windows\\v6.0A\\bin</span></span>\\

<span data-ttu-id="9f8a1-150">Las siguientes herramientas son las más útiles para firmar código:</span><span class="sxs-lookup"><span data-stu-id="9f8a1-150">The following tools are the most useful for signing code:</span></span>

<dl> <dt>

<span data-ttu-id="9f8a1-151"><span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Herramienta de creación de certificados (MakeCert.exe)</span><span class="sxs-lookup"><span data-stu-id="9f8a1-151"><span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Certificate Creation Tool (MakeCert.exe)</span></span>
</dt> <dd>

<span data-ttu-id="9f8a1-152">Genera un certificado X. 509 de prueba, como un archivo. cer, que contiene la clave pública y una clave privada, como un archivo. PVK.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-152">Generates a test X.509 certificate, as a .cer file, that contains your public key and a private key, as a .pvk file.</span></span> <span data-ttu-id="9f8a1-153">Este certificado solo es para fines de pruebas internas y no se puede usar públicamente.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-153">This certificate is only for internal testing purposes and can't be used publicly.</span></span>

</dd> <dt>

<span data-ttu-id="9f8a1-154"><span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe</span><span class="sxs-lookup"><span data-stu-id="9f8a1-154"><span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe</span></span>
</dt> <dd>

<span data-ttu-id="9f8a1-155">Crea un archivo de intercambio de información personal (. pfx) a partir de un par de archivos. cer y. PVK.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-155">Creates a Personal Information Exchange (.pfx) file from a pair of .cer and .pvk files.</span></span> <span data-ttu-id="9f8a1-156">El archivo. pfx contiene la clave pública y la privada.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-156">The .pfx file contains both your public and private key.</span></span>

</dd> <dt>

<span data-ttu-id="9f8a1-157"><span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>SignTool (SignTool.exe)</span><span class="sxs-lookup"><span data-stu-id="9f8a1-157"><span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>SignTool (SignTool.exe)</span></span>
</dt> <dd>

<span data-ttu-id="9f8a1-158">Firma el archivo con el archivo. pfx.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-158">Signs file by using the .pfx file.</span></span> <span data-ttu-id="9f8a1-159">SignTool admite la firma de archivos DLL, archivos ejecutables, archivos de Windows Installer (. msi) y archivos contenedores (. cab).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-159">SignTool supports the signing of DLL files, executable files, Windows Installer (.msi) files, and cabinet (.cab) files.</span></span>

</dd> </dl>

> [!Note]  
> <span data-ttu-id="9f8a1-160">Al leer otra documentación, es posible que encuentre referencias a SignCode (SignCode.exe), pero esta herramienta está en desuso y ya no se admite; use SignTool en su lugar.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-160">While reading other documentation, you might find references to SignCode (SignCode.exe), but this tool is deprecated and is no longer supported—use SignTool instead.</span></span>

 

## <a name="using-a-trusted-certificate-authority"></a><span data-ttu-id="9f8a1-161">Usar una entidad de certificación de confianza</span><span class="sxs-lookup"><span data-stu-id="9f8a1-161">Using a Trusted Certificate Authority</span></span>

<span data-ttu-id="9f8a1-162">Para obtener un certificado de confianza, debe solicitar una entidad de certificación (CA), como VeriSign o Thawte.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-162">To obtain a trusted certificate, you must apply to a Certificate Authority (CA), such as VeriSign or Thawte.</span></span> <span data-ttu-id="9f8a1-163">Microsoft no recomienda ninguna entidad de certificación (CA), pero si desea integrarla en el servicio Informe de errores de Windows (WER), considere la posibilidad de usar VeriSign para emitir el certificado, ya que el acceso a la base de datos WER requiere una cuenta de WinQual que requiera un identificador de VeriSign.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-163">Microsoft doesn't recommend any CA over another, but if you want to integrate into the Windows Error Reporting (WER) service, you should consider using VeriSign to issue the certificate, because accessing the WER database requires a WinQual account which requires a VeriSign ID.</span></span> <span data-ttu-id="9f8a1-164">Para obtener una lista completa de entidades de certificación de terceros de confianza, vea [miembros del programa de certificados raíz de Microsoft](/previous-versions/ms995347(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-164">For a complete list of trusted third-party certificate authorities, see [Microsoft Root Certificate Program Members](/previous-versions/ms995347(v=msdn.10)).</span></span> <span data-ttu-id="9f8a1-165">Para obtener más información acerca del registro con WER, consulte "[Introducción a informe de errores de Windows](https://msdn.microsoft.com/)" en la zona de [ISV](https://msdn.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-165">For more information about registering with WER, see "[Introducing Windows Error Reporting](https://msdn.microsoft.com/)" in [ISV Zone](https://msdn.microsoft.com/).</span></span>

<span data-ttu-id="9f8a1-166">Después de recibir el certificado de la CA, puede firmar el programa mediante SignTool y publicar el programa en el público.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-166">After you receive your certificate from the CA, you can sign your program by using SignTool and release your program to the public.</span></span> <span data-ttu-id="9f8a1-167">Sin embargo, debe tener cuidado de proteger la clave privada, que se encuentra en los archivos. pfx y. PVK.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-167">However, you must be careful to protect your private key, which is contained in your .pfx and .pvk files.</span></span> <span data-ttu-id="9f8a1-168">Asegúrese de mantener estos archivos en una ubicación segura.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-168">Be sure to keep these files in a secure location.</span></span>

## <a name="example-using-a-test-certificate"></a><span data-ttu-id="9f8a1-169">Ejemplo de uso de un certificado de prueba</span><span class="sxs-lookup"><span data-stu-id="9f8a1-169">Example Using a Test Certificate</span></span>

<span data-ttu-id="9f8a1-170">En los pasos siguientes se muestra la creación de un certificado de firma de código con fines de prueba, seguido de la firma de un programa de ejemplo de Direct3D (llamado BasicHLSL.exe) con este certificado de prueba.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-170">The following steps demonstrate the creation of a code-signing certificate for testing purposes, followed by the signing of a Direct3D sample program (called BasicHLSL.exe) with this test certificate.</span></span> <span data-ttu-id="9f8a1-171">Este procedimiento crea archivos. cer y. PVK, que son las claves públicas y privadas, respectivamente, que no se pueden usar para la certificación pública.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-171">This procedure creates .cer and .pvk files—your public and private keys, respectively — which cannot be used for public certification.</span></span>

<span data-ttu-id="9f8a1-172">En este ejemplo, también se agrega una marca de tiempo a la firma.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-172">In this example, a time stamp is also added to the signature.</span></span> <span data-ttu-id="9f8a1-173">Una marca de tiempo evita que la firma deje de ser válida cuando el certificado expira.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-173">A time stamp prevents the signature from becoming invalid when the certificate expires.</span></span> <span data-ttu-id="9f8a1-174">El código que está firmado pero que carece de una marca de tiempo no se validará después de que expire el certificado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-174">Code that is signed but lacking a time stamp will not validate after the certificate expires.</span></span> <span data-ttu-id="9f8a1-175">Por lo tanto, todo el código publicado públicamente debe tener una marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-175">Therefore, all publicly released code should have a time stamp.</span></span>

<span data-ttu-id="9f8a1-176">**Para crear un certificado y firmar un programa**</span><span class="sxs-lookup"><span data-stu-id="9f8a1-176">**To create a certificate and sign a program**</span></span>

1.  <span data-ttu-id="9f8a1-177">Cree un certificado de prueba y una clave privada mediante la herramienta de creación de certificados (MakeCert.exe).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-177">Create a test certificate and private key by using the Certificate Creation Tool (MakeCert.exe).</span></span>

    <span data-ttu-id="9f8a1-178">En el siguiente ejemplo de línea de comandos se especifica MyPrivateKey como nombre de archivo para el archivo de clave privada (. PVK), MyPublicKey como nombre de archivo para el archivo de certificado (. cer) y MySoftwareCompany como nombre del certificado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-178">The following command-line example specifies MyPrivateKey as the file name for the private key (.pvk) file, MyPublicKey as the file name for the certificate (.cer) file, and MySoftwareCompany as the name of the certificate.</span></span> <span data-ttu-id="9f8a1-179">También hace que el certificado sea autofirmado, para que no tenga una entidad de certificación raíz que no sea de confianza.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-179">It also makes the certificate self-signed, so that it does not have an untrusted root authority.</span></span>

    ```
    MakeCert /n CN=MySoftwareCompany /r /h 0 /eku "1.3.6.1.5.5.7.3.3,1.3.6.1.4.1.311.10.3.13" /e 12-31-2020 /sv MyPrivateKey.pvk MyPublicKey.cer
    ```

    

2.  <span data-ttu-id="9f8a1-180">Cree un archivo de intercambio de información personal (. pfx) desde el archivo de clave privada (. PVK) y el archivo de certificado (. cer) mediante pvk2pfx.exe.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-180">Create a Personal Information Exchange (.pfx) file from your private key (.pvk) file and certificate (.cer) file by using pvk2pfx.exe.</span></span>

    <span data-ttu-id="9f8a1-181">El archivo. pfx combina las claves públicas y privadas en un único archivo.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-181">The .pfx file combines your public and private keys into a single file.</span></span> <span data-ttu-id="9f8a1-182">En el siguiente ejemplo de línea de comandos se usan los archivos. PVK y. cer del paso anterior para crear el archivo. pfx denominado MyPFX con la contraseña de la contraseña \_ :</span><span class="sxs-lookup"><span data-stu-id="9f8a1-182">The following command-line example uses the .pvk and .cer files from the previous step to create the .pfx file named MyPFX with the password your\_password:</span></span>

    ```
    pvk2pfx.exe -pvk MyPrivateKey.pvk -spc MyPublicKey.cer -pfx MyPFX.pfx -po your_password
    ```

    

3.  <span data-ttu-id="9f8a1-183">Firme el programa con el archivo de intercambio de información personal (. pfx) mediante SignTool.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-183">Sign your program with your Personal Information Exchange (.pfx) file by using SignTool.</span></span>

    <span data-ttu-id="9f8a1-184">Puede especificar varias opciones en la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-184">You can specify several options on the command line.</span></span> <span data-ttu-id="9f8a1-185">En el siguiente ejemplo de línea de comandos se usa el archivo. pfx del paso anterior, se le proporciona la contraseña \_ , se especifica BasicHLSL como el archivo que se va a firmar y se recupera una marca de tiempo de un servidor especificado:</span><span class="sxs-lookup"><span data-stu-id="9f8a1-185">The following command-line example uses the .pfx file from the previous step, gives your\_password as the password, specifies BasicHLSL as the file to be signed, and retrieves a time stamp from a specified server:</span></span>

    ```
    signtool.exe sign /fd SHA256 /f MyPFX.pfx /p your_password /v /t URL_to_time_stamp_service BasicHLSL.exe
    ```

    

    > [!Note]  
    > <span data-ttu-id="9f8a1-186">La entidad de certificación proporciona la dirección URL del servicio de marca de tiempo y es opcional para las pruebas.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-186">The URL to the time stamp service is provided by the CA, and is optional for testing.</span></span> <span data-ttu-id="9f8a1-187">Es importante que la firma de producción incluya una autoridad de marca de tiempo válida, o bien la firma no se validará cuando expire el certificado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-187">It is important for production signing to include a valid time stamp authority, or the signature will fail to validate when the certificate expires.</span></span>

     

4.  <span data-ttu-id="9f8a1-188">Compruebe que el programa está firmado mediante SignTool.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-188">Verify that the program is signed by using SignTool.</span></span>

    <span data-ttu-id="9f8a1-189">El siguiente ejemplo de línea de comandos especifica que SignTool debe intentar comprobar la firma en BasicHLSL.exe mediante todos los métodos disponibles a la vez que proporciona una salida detallada:</span><span class="sxs-lookup"><span data-stu-id="9f8a1-189">The following command-line example specifies that SignTool should attempt to verify the signature on BasicHLSL.exe by using all available methods while providing verbose output:</span></span>

    ```
    signtool.exe verify /a /v BasicHLSL.exe
    ```

    

    <span data-ttu-id="9f8a1-190">En este ejemplo, SignTool debe indicar que el certificado está asociado, a la vez que indica que no es de confianza, ya que no lo emite una entidad de certificación.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-190">In this example, SignTool should indicate that the certificate is attached, while also stating that it is not trusted, since it is not issued by a CA.</span></span>

5.  <span data-ttu-id="9f8a1-191">Confíe en el certificado de prueba.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-191">Trust the test certificate.</span></span>

    <span data-ttu-id="9f8a1-192">En el caso de los certificados de prueba, debe confiar en el certificado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-192">For test certificates you need to trust the certificate.</span></span> <span data-ttu-id="9f8a1-193">Este paso se debe omitir para los certificados proporcionados por una CA, ya que serán de confianza de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-193">This step should be skipped for certificates provided by a CA since those will trusted by default.</span></span>

    <span data-ttu-id="9f8a1-194">En solo los equipos en los que desea confiar en el certificado de prueba, ejecute lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="9f8a1-194">On only the computers where you want to trust the test certificate, run the following:</span></span>

    ```
    certmgr.msc
    ```

    

    <span data-ttu-id="9f8a1-195">A continuación, haga clic con el botón derecho en entidades de certificación raíz de confianza y elija todas las tareas \| Importar.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-195">Then right click on Trusted Root Certification Authorities and choose All Tasks \| Import.</span></span> <span data-ttu-id="9f8a1-196">A continuación, busque el archivo. pfx que creó y siga los pasos del asistente y coloque el certificado en las entidades de certificación raíz de confianza.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-196">Then browse to the .pfx file you created and follow the wizard steps, placing the certificate in the Trusted Root Certification Authorities.</span></span>

    <span data-ttu-id="9f8a1-197">Cuando se complete el asistente, podrá iniciar las pruebas con el certificado de confianza en dicho equipo.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-197">When the wizard completes, you can start testing with the trusted certificate on that computer.</span></span>

## <a name="integrating-code-signing-into-the-daily-build-system"></a><span data-ttu-id="9f8a1-198">Integración del código que inicia sesión en el sistema de compilación diario</span><span class="sxs-lookup"><span data-stu-id="9f8a1-198">Integrating Code Signing into the Daily Build System</span></span>

<span data-ttu-id="9f8a1-199">Para integrar la firma de código en un proyecto de, puede crear un archivo por lotes o un script para ejecutar las herramientas de línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-199">To integrate code signing into a project, you can create a batch file or script to run the command line tools.</span></span> <span data-ttu-id="9f8a1-200">Una vez compilado el proyecto, ejecute SignTool con la configuración adecuada (como se muestra en el paso 3 de nuestro ejemplo).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-200">After the project is built, run SignTool with the proper settings (as shown in step 3 of our example).</span></span>

<span data-ttu-id="9f8a1-201">Tenga especial cuidado en el proceso de compilación para asegurarse de que el acceso a los archivos. pfx y. PVK está restringido a tantos equipos como usuarios como sea posible.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-201">Be especially cautious in your build process to insure that access to the .pfx and .pvk files is restricted to as few computers and users as possible.</span></span> <span data-ttu-id="9f8a1-202">Como procedimiento recomendado, los desarrolladores solo deben firmar el código mediante el certificado de prueba hasta que estén listos para su envío.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-202">As a best practice, developers should only sign code by using the test certificate until they are ready to ship.</span></span> <span data-ttu-id="9f8a1-203">Una vez más, la clave privada (. PVK) debe mantenerse en una ubicación segura, como una habitación segura o bloqueada, y idealmente en un dispositivo criptográfico, como una tarjeta inteligente.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-203">Again, the private key (.pvk) should be kept in a secured location, like a safe or locked room, and ideally on a cryptographic device, like a smart card.</span></span>

<span data-ttu-id="9f8a1-204">Se proporciona otro nivel de protección mediante Microsoft Authenticode para firmar el paquete de Windows Installer (MSI).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-204">Another layer of protection is provided by using Microsoft Authenticode to sign the Windows Installer (MSI) package itself.</span></span> <span data-ttu-id="9f8a1-205">Esto ayuda a proteger el paquete MSI frente a alteraciones y daños accidentales.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-205">This helps protect the MSI package against tampering and accidental corruption.</span></span> <span data-ttu-id="9f8a1-206">Consulte la documentación de la herramienta de creación de MSI para obtener más información sobre cómo firmar paquetes con Authenticode.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-206">Refer to the documentation for your MSI creation tool for more information about how to sign packages with Authenticode.</span></span>

## <a name="revocation"></a><span data-ttu-id="9f8a1-207">Revocación</span><span class="sxs-lookup"><span data-stu-id="9f8a1-207">Revocation</span></span>

<span data-ttu-id="9f8a1-208">En caso de que la seguridad de la clave privada se vea comprometida o algún evento relacionado con la seguridad presente un Code-Signing certificado no válido, el desarrollador debe revocar el certificado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-208">In the event that the security of the private key is compromised or some security-related event renders a Code-Signing certificate invalid, the developer must revoke the certificate.</span></span> <span data-ttu-id="9f8a1-209">Si no lo hace, se debilitaría la integridad del desarrollador y la eficacia de firmar el código.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-209">Not doing so would weaken the integrity of the developer and the effectiveness of signing code.</span></span> <span data-ttu-id="9f8a1-210">Una CA también puede emitir una revocación con hora específica; el código firmado con una marca de tiempo antes del tiempo de revocación se seguirá considerando válido, pero el código con una marca de tiempo subsiguiente no será válido.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-210">A CA can also issue a revocation with specific time; code signed with a time stamp prior to the revocation time will still be considered valid, but code with a subsequent time stamp will be invalid.</span></span> <span data-ttu-id="9f8a1-211">La revocación de certificados afecta al código de las aplicaciones firmadas con el certificado revocado.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-211">Certificate revocation affects code in any applications that is signed with the revoked certificate.</span></span>

## <a name="code-signing-drivers"></a><span data-ttu-id="9f8a1-212">Controladores Code-Signing</span><span class="sxs-lookup"><span data-stu-id="9f8a1-212">Code-Signing Drivers</span></span>

<span data-ttu-id="9f8a1-213">Los controladores pueden y deben estar firmados con Authenticode.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-213">Drivers can and should be Authenticode-signed.</span></span> <span data-ttu-id="9f8a1-214">Los controladores en modo kernel tienen requisitos adicionales: las ediciones de 64 bits de Windows Vista y Windows 7 impedirán la instalación de todos los controladores de modo kernel sin firmar y todas las versiones de Windows presentarán un mensaje de advertencia cuando un usuario intente instalar un controlador sin firmar.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-214">Kernel-mode drivers have additional requirements: 64-bit editions of Windows Vista and Windows 7 will prevent installation of all unsigned kernel-mode drivers, and all versions of Windows will present a warning prompt when a user attempts to install an unsigned driver.</span></span> <span data-ttu-id="9f8a1-215">Además, los administradores pueden establecer directiva de grupo para impedir que se instalen controladores sin firmar en las ediciones Microsoft Windows Server 2003, Windows XP Professional x64 Edition y 32-bit de Windows Vista y Windows 7.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-215">In addition, administrators can set Group Policy to prevent unsigned drivers from being installed on Microsoft Windows Server 2003, Windows XP Professional x64 Edition, and 32-bit editions of Windows Vista and Windows 7.</span></span>

<span data-ttu-id="9f8a1-216">Muchos tipos de controladores pueden estar firmados con una firma de confianza de Microsoft, como parte del programa de certificación de Windows de los [laboratorios de calidad de hardware de Windows](https://www.microsoft.com/whdc/whql/) (WHQL) o el programa de firma no [clasificada](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (anteriormente denominado firma de confiabilidad de controladores), que permite al sistema confiar plenamente en estos controladores e instalarlos incluso sin credenciales administrativas.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-216">Many types of drivers can be signed with a Microsoft-trusted signature — as part of the Windows Certification Program of [Windows Hardware Quality Labs](https://www.microsoft.com/whdc/whql/) (WHQL) or the [Unclassified Signature Program](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (formerly named Driver Reliability Signature) — which allows the system to fully trust these drivers and install them even without administrative credentials.</span></span>

<span data-ttu-id="9f8a1-217">Como mínimo, los controladores deben estar firmados con Authenticode, ya que los controladores que no están firmados o autofirmados (es decir, que están firmados con un certificado de prueba) no se instalarán en muchas plataformas basadas en Windows.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-217">At a minimum, drivers should be Authenticode-signed, because drivers that are unsigned or self-signed (that is, signed with a test certificate) will fail to install on many Windows-based platforms.</span></span> <span data-ttu-id="9f8a1-218">Para obtener más información acerca de la firma de controladores y código y características relacionadas, consulte [requisitos de firma de controladores para Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) en el [centro de desarrollo de hardware de Windows](https://www.microsoft.com/whdc/).</span><span class="sxs-lookup"><span data-stu-id="9f8a1-218">For more information about signing drivers and code and related feature, see [Driver Signing Requirements for Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) on [Windows Hardware Developer Central](https://www.microsoft.com/whdc/).</span></span>

## <a name="summary"></a><span data-ttu-id="9f8a1-219">Resumen</span><span class="sxs-lookup"><span data-stu-id="9f8a1-219">Summary</span></span>

<span data-ttu-id="9f8a1-220">El uso de Microsoft Authenticode es un proceso sencillo.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-220">Using Microsoft Authenticode is a straightforward process.</span></span> <span data-ttu-id="9f8a1-221">Una vez que haya obtenido una CER y creado una clave privada, se trata de una cuestión sencilla del uso de las herramientas proporcionadas por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-221">Once you have obtained a CER and created a private key, it is a simple matter of using the tools provided by Microsoft.</span></span> <span data-ttu-id="9f8a1-222">Después, puede habilitar características importantes en Windows Vista y Windows 7, como el control parental, y permitir que los clientes sepan que el producto procede directamente de su propietario legítimo.</span><span class="sxs-lookup"><span data-stu-id="9f8a1-222">You can then enable important features in Windows Vista and Windows 7, such as parental controls, and let customers know that your product comes directly from its rightful owner.</span></span>

## <a name="more-information"></a><span data-ttu-id="9f8a1-223">Más información</span><span class="sxs-lookup"><span data-stu-id="9f8a1-223">More information</span></span>

<span data-ttu-id="9f8a1-224">Para obtener más información sobre las herramientas y los procesos relacionados con la firma de código, vea los vínculos siguientes:</span><span class="sxs-lookup"><span data-stu-id="9f8a1-224">More information about tools and processes related to signing code, see the following links:</span></span>

-   [<span data-ttu-id="9f8a1-225">Herramientas de criptografía</span><span class="sxs-lookup"><span data-stu-id="9f8a1-225">Cryptography Tools</span></span>](/windows/desktop/SecCrypto/cryptography-tools)
-   [<span data-ttu-id="9f8a1-226">Referencia de herramientas de Crypto API</span><span class="sxs-lookup"><span data-stu-id="9f8a1-226">Crypto API Tools Reference</span></span>](/windows/desktop/SecCrypto/cryptoapi-tools-reference)
-   <span data-ttu-id="9f8a1-227">[Información general sobre Authenticode y turtorials](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="9f8a1-227">[Authenticode Overview and Turtorials](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))</span></span>
-   [<span data-ttu-id="9f8a1-228">Certificados digitales</span><span class="sxs-lookup"><span data-stu-id="9f8a1-228">Digital Certificates</span></span>](/windows/desktop/SecCrypto/digital-certificates)
-   [<span data-ttu-id="9f8a1-229">Implementar Authenticode</span><span class="sxs-lookup"><span data-stu-id="9f8a1-229">Deploying Authenticode</span></span>](https://www.microsoft.com/technet/security/topics/cryptographyetc/authenticodets.mspx)
-   [<span data-ttu-id="9f8a1-230">Cómo: crear certificados temporales para su uso durante el desarrollo</span><span class="sxs-lookup"><span data-stu-id="9f8a1-230">How To: Create Temporary Certificates for Use During Development</span></span>](/dotnet/framework/wcf/feature-details/how-to-create-temporary-certificates-for-use-during-development)

 

 