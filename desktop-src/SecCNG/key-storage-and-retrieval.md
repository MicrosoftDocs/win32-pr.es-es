---
description: CNG proporciona un modelo para el almacenamiento de claves privadas que permite adaptarse a las demandas actuales y futuras de la creación de aplicaciones que usan características de criptografía como el cifrado de claves públicas o privadas, así como las demandas del almacenamiento de material de clave.
ms.assetid: 95e5750f-fdc5-41f3-a4ce-9593a7081e95
title: Almacenamiento y recuperación de claves
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5abfd6319353440c580d53990075a71613a1eba9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104361150"
---
# <a name="key-storage-and-retrieval"></a><span data-ttu-id="700fb-103">Almacenamiento y recuperación de claves</span><span class="sxs-lookup"><span data-stu-id="700fb-103">Key Storage and Retrieval</span></span>

-   [<span data-ttu-id="700fb-104">Arquitectura de almacenamiento de claves</span><span class="sxs-lookup"><span data-stu-id="700fb-104">Key Storage Architecture</span></span>](#key-storage-architecture)
-   [<span data-ttu-id="700fb-105">Tipos de clave</span><span class="sxs-lookup"><span data-stu-id="700fb-105">Key Types</span></span>](#key-types)
-   [<span data-ttu-id="700fb-106">Algoritmos admitidos</span><span class="sxs-lookup"><span data-stu-id="700fb-106">Supported Algorithms</span></span>](#supported-algorithms)
-   [<span data-ttu-id="700fb-107">Archivos y directorios clave</span><span class="sxs-lookup"><span data-stu-id="700fb-107">Key Directories and Files</span></span>](#key-directories-and-files)

## <a name="key-storage-architecture"></a><span data-ttu-id="700fb-108">Arquitectura de almacenamiento de claves</span><span class="sxs-lookup"><span data-stu-id="700fb-108">Key Storage Architecture</span></span>

<span data-ttu-id="700fb-109">CNG proporciona un modelo para el almacenamiento de claves privadas que permite adaptarse a las demandas actuales y futuras de la creación de aplicaciones que usan características de criptografía como el cifrado de claves públicas o privadas, así como las demandas del almacenamiento de material de clave.</span><span class="sxs-lookup"><span data-stu-id="700fb-109">CNG provides a model for private key storage that allows adapting to the current and future demands of creating applications that use cryptography features such as public or private key encryption, as well as the demands of the storage of key material.</span></span> <span data-ttu-id="700fb-110">El enrutador de almacenamiento de claves es la rutina central de este modelo y se implementa en Ncrypt.dll.</span><span class="sxs-lookup"><span data-stu-id="700fb-110">The key storage router is the central routine in this model and is implemented in Ncrypt.dll.</span></span> <span data-ttu-id="700fb-111">Una aplicación tiene acceso a los proveedores de almacenamiento de claves (KSP) en el sistema a través del enrutador de almacenamiento de claves, que oculta los detalles, como el aislamiento de claves, tanto de la aplicación como del propio proveedor de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="700fb-111">An application accesses the key storage providers (KSPs) on the system through the key storage router, which conceals details, such as key isolation, from both the application and the storage provider itself.</span></span> <span data-ttu-id="700fb-112">En la ilustración siguiente se muestra el diseño y la función de la arquitectura de aislamiento de claves CNG.</span><span class="sxs-lookup"><span data-stu-id="700fb-112">The following illustration shows the design and function of the CNG key isolation architecture.</span></span>

![proveedor de almacenamiento de claves CNG](images/cng-key-storage-provider.png)

<span data-ttu-id="700fb-114">Para cumplir los requisitos de criterios comunes (CC), las claves de larga duración deben estar aisladas para que nunca estén presentes en el proceso de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="700fb-114">To comply with common criteria (CC) requirements, the long-lived keys must be isolated so that they are never present in the application process.</span></span> <span data-ttu-id="700fb-115">CNG actualmente admite el almacenamiento de claves privadas asimétricas mediante el KSP software de Microsoft que se incluye con Windows Server 2008 y Windows Vista, y se instala de manera predeterminada.</span><span class="sxs-lookup"><span data-stu-id="700fb-115">CNG currently supports the storage of asymmetric private keys by using the Microsoft software KSP that is included with Windows Server 2008 and Windows Vista and installed by default.</span></span>

<span data-ttu-id="700fb-116">El aislamiento de claves está habilitado de forma predeterminada en Windows Server 2008 y Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="700fb-116">Key isolation is enabled by default in Windows Server 2008 and Windows Vista.</span></span> <span data-ttu-id="700fb-117">La característica de aislamiento de claves no está disponible en las plataformas anteriores a ellas.</span><span class="sxs-lookup"><span data-stu-id="700fb-117">The key isolation feature is not available on platforms prior to these.</span></span> <span data-ttu-id="700fb-118">Además, los KSP de terceros no se cargan en el servicio de aislamiento de claves (proceso LSA).</span><span class="sxs-lookup"><span data-stu-id="700fb-118">Also, third party KSPs are not loaded in the key isolation service (LSA process).</span></span> <span data-ttu-id="700fb-119">Solo se carga el KSP de Microsoft en el servicio de aislamiento de claves.</span><span class="sxs-lookup"><span data-stu-id="700fb-119">Only the Microsoft KSP is loaded in the key isolation service.</span></span>

<span data-ttu-id="700fb-120">El proceso de LSA se utiliza como el proceso de aislamiento de claves para maximizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="700fb-120">The LSA process is used as the key isolation process to maximize performance.</span></span> <span data-ttu-id="700fb-121">Todo el acceso a las claves privadas se realiza a través del enrutador de almacenamiento de claves, que expone un conjunto completo de funciones para administrar y usar las claves privadas.</span><span class="sxs-lookup"><span data-stu-id="700fb-121">All access to private keys goes through the key storage router, which exposes a comprehensive set of functions for managing and using private keys.</span></span>

<span data-ttu-id="700fb-122">CNG almacena la parte pública de la clave almacenada de forma independiente de la parte privada.</span><span class="sxs-lookup"><span data-stu-id="700fb-122">CNG stores the public portion of the stored key separately from the private portion.</span></span> <span data-ttu-id="700fb-123">La parte pública de un par de claves también se mantiene en el servicio de aislamiento de claves y se tiene acceso a ella mediante la llamada a procedimiento remoto local (LRPC).</span><span class="sxs-lookup"><span data-stu-id="700fb-123">The public portion of a key pair is also maintained in the key isolation service and is accessed by using local remote procedure call (LRPC).</span></span> <span data-ttu-id="700fb-124">El enrutador de almacenamiento de claves usa LRPC cuando llama al proceso de aislamiento de claves.</span><span class="sxs-lookup"><span data-stu-id="700fb-124">The key storage router uses LRPC when calling into the key isolation process.</span></span> <span data-ttu-id="700fb-125">Todo el acceso a las claves privadas se realiza a través del enrutador de clave privada y se audita mediante CNG.</span><span class="sxs-lookup"><span data-stu-id="700fb-125">All access to private keys goes through the private key router and is audited by CNG.</span></span>

<span data-ttu-id="700fb-126">Tal y como se ha descrito anteriormente, se puede admitir una amplia gama de dispositivos de almacenamiento de hardware.</span><span class="sxs-lookup"><span data-stu-id="700fb-126">As described above, a wide range of hardware storage devices can be supported.</span></span> <span data-ttu-id="700fb-127">En cada caso, la interfaz para todos estos dispositivos de almacenamiento es idéntica.</span><span class="sxs-lookup"><span data-stu-id="700fb-127">In each case, the interface to all of these storage devices is identical.</span></span> <span data-ttu-id="700fb-128">Incluye funciones para realizar varias operaciones de clave privada, así como funciones que pertenecen al almacenamiento y la administración de claves.</span><span class="sxs-lookup"><span data-stu-id="700fb-128">It includes functions to perform various private key operations as well as functions that pertain to key storage and management.</span></span>

<span data-ttu-id="700fb-129">CNG proporciona un conjunto de API que se usan para crear, almacenar y recuperar claves criptográficas.</span><span class="sxs-lookup"><span data-stu-id="700fb-129">CNG provides a set of APIs that are used to create, store, and retrieve cryptographic keys.</span></span> <span data-ttu-id="700fb-130">Para obtener una lista de estas API, consulte [funciones de almacenamiento de claves CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="700fb-130">For a list of these APIs, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="key-types"></a><span data-ttu-id="700fb-131">Tipos de clave</span><span class="sxs-lookup"><span data-stu-id="700fb-131">Key Types</span></span>

<span data-ttu-id="700fb-132">CNG admite los siguientes tipos de clave:</span><span class="sxs-lookup"><span data-stu-id="700fb-132">CNG supports the following key types:</span></span>

-   <span data-ttu-id="700fb-133">Diffie-Hellman claves públicas y privadas.</span><span class="sxs-lookup"><span data-stu-id="700fb-133">Diffie-Hellman public and private keys.</span></span>
-   <span data-ttu-id="700fb-134">Claves públicas y privadas del algoritmo de firma digital (DSA, FIPS 186-2).</span><span class="sxs-lookup"><span data-stu-id="700fb-134">Digital Signature Algorithm (DSA, FIPS 186-2) public and private keys.</span></span>
-   <span data-ttu-id="700fb-135">\#Claves públicas y privadas RSA (PKCS 1).</span><span class="sxs-lookup"><span data-stu-id="700fb-135">RSA (PKCS \#1) public and private keys.</span></span>
-   <span data-ttu-id="700fb-136">Varias claves públicas y privadas heredadas (CryptoAPI).</span><span class="sxs-lookup"><span data-stu-id="700fb-136">Several legacy (CryptoAPI) public and private keys.</span></span>
-   <span data-ttu-id="700fb-137">Claves públicas y privadas de criptografía de curva elíptica.</span><span class="sxs-lookup"><span data-stu-id="700fb-137">Elliptic Curve Cryptography public and private keys.</span></span>

## <a name="supported-algorithms"></a><span data-ttu-id="700fb-138">Algoritmos admitidos</span><span class="sxs-lookup"><span data-stu-id="700fb-138">Supported Algorithms</span></span>

<span data-ttu-id="700fb-139">CNG admite los siguientes algoritmos de clave.</span><span class="sxs-lookup"><span data-stu-id="700fb-139">CNG supports the following key algorithms.</span></span>

| <span data-ttu-id="700fb-140">Algoritmo</span><span class="sxs-lookup"><span data-stu-id="700fb-140">Algorithm</span></span> | <span data-ttu-id="700fb-141">Longitud de clave/hash (bits)</span><span class="sxs-lookup"><span data-stu-id="700fb-141">Key/hash length (bits)</span></span>             |
|-----------|------------------------------------|
| <span data-ttu-id="700fb-142">RSA</span><span class="sxs-lookup"><span data-stu-id="700fb-142">RSA</span></span>       | <span data-ttu-id="700fb-143">de 512 a 16384, en incrementos de 64 bits</span><span class="sxs-lookup"><span data-stu-id="700fb-143">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="700fb-144">DH</span><span class="sxs-lookup"><span data-stu-id="700fb-144">DH</span></span>        | <span data-ttu-id="700fb-145">de 512 a 16384, en incrementos de 64 bits</span><span class="sxs-lookup"><span data-stu-id="700fb-145">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="700fb-146">DSA</span><span class="sxs-lookup"><span data-stu-id="700fb-146">DSA</span></span>       | <span data-ttu-id="700fb-147">de 512 a 1024, en incrementos de 64 bits</span><span class="sxs-lookup"><span data-stu-id="700fb-147">512 to 1024, in 64 bit increments</span></span>  |
| <span data-ttu-id="700fb-148">ECDSA</span><span class="sxs-lookup"><span data-stu-id="700fb-148">ECDSA</span></span>     | <span data-ttu-id="700fb-149">P-256, P-384, P-521 (curvas NIST)</span><span class="sxs-lookup"><span data-stu-id="700fb-149">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="700fb-150">ECDH</span><span class="sxs-lookup"><span data-stu-id="700fb-150">ECDH</span></span>      | <span data-ttu-id="700fb-151">P-256, P-384, P-521 (curvas NIST)</span><span class="sxs-lookup"><span data-stu-id="700fb-151">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="700fb-152">MD2</span><span class="sxs-lookup"><span data-stu-id="700fb-152">MD2</span></span>       | <span data-ttu-id="700fb-153">128</span><span class="sxs-lookup"><span data-stu-id="700fb-153">128</span></span>                                |
| <span data-ttu-id="700fb-154">MD4</span><span class="sxs-lookup"><span data-stu-id="700fb-154">MD4</span></span>       | <span data-ttu-id="700fb-155">128</span><span class="sxs-lookup"><span data-stu-id="700fb-155">128</span></span>                                |
| <span data-ttu-id="700fb-156">MD5</span><span class="sxs-lookup"><span data-stu-id="700fb-156">MD5</span></span>       | <span data-ttu-id="700fb-157">128</span><span class="sxs-lookup"><span data-stu-id="700fb-157">128</span></span>                                |
| <span data-ttu-id="700fb-158">SHA-1</span><span class="sxs-lookup"><span data-stu-id="700fb-158">SHA-1</span></span>     | <span data-ttu-id="700fb-159">160</span><span class="sxs-lookup"><span data-stu-id="700fb-159">160</span></span>                                |
| <span data-ttu-id="700fb-160">SHA-256</span><span class="sxs-lookup"><span data-stu-id="700fb-160">SHA-256</span></span>   | <span data-ttu-id="700fb-161">256</span><span class="sxs-lookup"><span data-stu-id="700fb-161">256</span></span>                                |
| <span data-ttu-id="700fb-162">SHA-384</span><span class="sxs-lookup"><span data-stu-id="700fb-162">SHA-384</span></span>   | <span data-ttu-id="700fb-163">384</span><span class="sxs-lookup"><span data-stu-id="700fb-163">384</span></span>                                |
| <span data-ttu-id="700fb-164">SHA-512</span><span class="sxs-lookup"><span data-stu-id="700fb-164">SHA-512</span></span>   | <span data-ttu-id="700fb-165">512</span><span class="sxs-lookup"><span data-stu-id="700fb-165">512</span></span>                                |



 

## <a name="key-directories-and-files"></a><span data-ttu-id="700fb-166">Archivos y directorios clave</span><span class="sxs-lookup"><span data-stu-id="700fb-166">Key Directories and Files</span></span>

<span data-ttu-id="700fb-167">Las claves privadas de los CSP de CryptoAPI heredadas de Microsoft se almacenan en los siguientes directorios.</span><span class="sxs-lookup"><span data-stu-id="700fb-167">The Microsoft legacy CryptoAPI CSPs store private keys in the following directories.</span></span>

| <span data-ttu-id="700fb-168">Tipo de clave</span><span class="sxs-lookup"><span data-stu-id="700fb-168">Key type</span></span>                | <span data-ttu-id="700fb-169">Directorios</span><span class="sxs-lookup"><span data-stu-id="700fb-169">Directories</span></span>                                                                                                                                                 |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="700fb-170">Usuario privado</span><span class="sxs-lookup"><span data-stu-id="700fb-170">User private</span></span>            | <span data-ttu-id="700fb-171">% APPDATA% \\ \\ SID de \\ \\ *usuario* de RSA de Microsoft Crypto</span><span class="sxs-lookup"><span data-stu-id="700fb-171">%APPDATA%\\Microsoft\\Crypto\\RSA\\*User SID*</span></span>\\<br/><span data-ttu-id="700fb-172">% APPDATA% \\ SID de usuario de Microsoft \\ Crypto \\ DSS \\ </span><span class="sxs-lookup"><span data-stu-id="700fb-172">%APPDATA%\\Microsoft\\Crypto\\DSS\\*User SID*</span></span>\\<br/>                                                   |
| <span data-ttu-id="700fb-173">Privado del sistema local</span><span class="sxs-lookup"><span data-stu-id="700fb-173">Local system private</span></span>    | <span data-ttu-id="700fb-174">% ALLUSERSPROFILE% de \\ datos de aplicación \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="700fb-174">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-18</span></span>\\<br/><span data-ttu-id="700fb-175">% ALLUSERSPROFILE% \\ datos de aplicación \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="700fb-175">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-18</span></span>\\<br/>   |
| <span data-ttu-id="700fb-176">Servicio local privado</span><span class="sxs-lookup"><span data-stu-id="700fb-176">Local service private</span></span>   | <span data-ttu-id="700fb-177">% ALLUSERSPROFILE% de \\ datos de aplicación \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="700fb-177">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-19</span></span>\\<br/><span data-ttu-id="700fb-178">% ALLUSERSPROFILE% \\ datos de aplicación \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="700fb-178">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-19</span></span>\\<br/>   |
| <span data-ttu-id="700fb-179">Servicio de red privado</span><span class="sxs-lookup"><span data-stu-id="700fb-179">Network service private</span></span> | <span data-ttu-id="700fb-180">% ALLUSERSPROFILE% de \\ datos de aplicación \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="700fb-180">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-20</span></span>\\<br/><span data-ttu-id="700fb-181">% ALLUSERSPROFILE% \\ datos de aplicación \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="700fb-181">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-20</span></span>\\<br/>   |
| <span data-ttu-id="700fb-182">Privado compartido</span><span class="sxs-lookup"><span data-stu-id="700fb-182">Shared private</span></span>          | <span data-ttu-id="700fb-183">% ALLUSERSPROFILE% \\ datos de aplicación \\ Microsoft \\ Crypto \\ RSA \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="700fb-183">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\MachineKeys</span></span><br/><span data-ttu-id="700fb-184">% ALLUSERSPROFILE% \\ datos de aplicación \\ Microsoft \\ Crypto \\ DSS \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="700fb-184">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\MachineKeys</span></span><br/> |



 

<span data-ttu-id="700fb-185">CNG almacena las claves privadas en los directorios siguientes.</span><span class="sxs-lookup"><span data-stu-id="700fb-185">CNG stores private keys in the following directories.</span></span>

| <span data-ttu-id="700fb-186">Tipo de clave</span><span class="sxs-lookup"><span data-stu-id="700fb-186">Key type</span></span>                | <span data-ttu-id="700fb-187">Directorio</span><span class="sxs-lookup"><span data-stu-id="700fb-187">Directory</span></span>                                                          |
|-------------------------|--------------------------------------------------------------------|
| <span data-ttu-id="700fb-188">Usuario privado</span><span class="sxs-lookup"><span data-stu-id="700fb-188">User private</span></span>            | <span data-ttu-id="700fb-189">% APPDATA% \\ \\ claves criptográficas de Microsoft \\</span><span class="sxs-lookup"><span data-stu-id="700fb-189">%APPDATA%\\Microsoft\\Crypto\\Keys</span></span>                                 |
| <span data-ttu-id="700fb-190">Privado del sistema local</span><span class="sxs-lookup"><span data-stu-id="700fb-190">Local system private</span></span>    | <span data-ttu-id="700fb-191">% ALLUSERSPROFILE% \\ datos de aplicación \\ Microsoft \\ Crypto \\ SystemKeys</span><span class="sxs-lookup"><span data-stu-id="700fb-191">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\SystemKeys</span></span> |
| <span data-ttu-id="700fb-192">Servicio local privado</span><span class="sxs-lookup"><span data-stu-id="700fb-192">Local service private</span></span>   | <span data-ttu-id="700fb-193">% WINDIR% \\ ServiceProfiles \\ LocalService</span><span class="sxs-lookup"><span data-stu-id="700fb-193">%WINDIR%\\ServiceProfiles\\LocalService</span></span>                            |
| <span data-ttu-id="700fb-194">Servicio de red privado</span><span class="sxs-lookup"><span data-stu-id="700fb-194">Network service private</span></span> | <span data-ttu-id="700fb-195">% WINDIR% \\ ServiceProfiles \\ NetworkService</span><span class="sxs-lookup"><span data-stu-id="700fb-195">%WINDIR%\\ServiceProfiles\\NetworkService</span></span>                          |
| <span data-ttu-id="700fb-196">Privado compartido</span><span class="sxs-lookup"><span data-stu-id="700fb-196">Shared private</span></span>          | <span data-ttu-id="700fb-197">% ALLUSERSPROFILE% de \\ datos de aplicaciones \\ Microsoft \\ Crypto \\ Keys</span><span class="sxs-lookup"><span data-stu-id="700fb-197">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\Keys</span></span>       |



 

<span data-ttu-id="700fb-198">A continuación se muestran algunas de las diferencias entre los contenedores de claves de CryptoAPI y CNG.</span><span class="sxs-lookup"><span data-stu-id="700fb-198">The following are some of the differences between the CryptoAPI and CNG key containers.</span></span>

-   <span data-ttu-id="700fb-199">CNG usa nombres de archivo diferentes para los archivos de clave que los archivos de clave creados por el Rsaenh.dll y Dssenh.dll CSP heredados.</span><span class="sxs-lookup"><span data-stu-id="700fb-199">CNG uses different file names for key files than key files that are created by the Rsaenh.dll and Dssenh.dll legacy CSPs.</span></span> <span data-ttu-id="700fb-200">Los archivos de clave heredados también tienen la extensión. Key, pero los archivos de clave CNG no tienen la extensión. Key.</span><span class="sxs-lookup"><span data-stu-id="700fb-200">The legacy key files also have the .key extension, but CNG key files do not have the .key extension.</span></span>
-   <span data-ttu-id="700fb-201">CNG es totalmente compatible con los nombres de contenedor de claves Unicode; CNG usa un hash del nombre del contenedor Unicode, mientras que CryptoAPI usa un hash del nombre del contenedor ANSI.</span><span class="sxs-lookup"><span data-stu-id="700fb-201">CNG fully supports Unicode key container names; CNG uses a hash of the Unicode container name, whereas CryptoAPI uses a hash of the ANSI container name.</span></span>
-   <span data-ttu-id="700fb-202">CNG es más flexible con respecto a los pares de claves RSA.</span><span class="sxs-lookup"><span data-stu-id="700fb-202">CNG is more flexible with regard to RSA key pairs.</span></span> <span data-ttu-id="700fb-203">Por ejemplo, CNG admite exponentes públicos mayores de 32 bits de longitud y admite claves en las que p y q tienen longitudes diferentes.</span><span class="sxs-lookup"><span data-stu-id="700fb-203">For example, CNG supports public exponents larger than 32-bits in length, and it supports keys in which p and q are different lengths.</span></span>
-   <span data-ttu-id="700fb-204">En CryptoAPI, el archivo de contenedor de claves se almacena en un directorio cuyo nombre es el equivalente textual del SID del usuario.</span><span class="sxs-lookup"><span data-stu-id="700fb-204">In CryptoAPI, the key container file is stored in a directory whose name is the textual equivalent of the user's SID.</span></span> <span data-ttu-id="700fb-205">Esto ya no es así en CNG, lo que elimina la dificultad de mover usuarios de un dominio a otro sin perder todas sus claves privadas.</span><span class="sxs-lookup"><span data-stu-id="700fb-205">This is no longer the case in CNG, which removes the difficulty of moving users from one domain to another without losing all of their private keys.</span></span>
-   <span data-ttu-id="700fb-206">Los nombres de clave y KSP de CNG se limitan a caracteres Unicode de **\_ ruta de acceso máxima** .</span><span class="sxs-lookup"><span data-stu-id="700fb-206">The CNG KSP and key names are limited to **MAX\_PATH** Unicode characters.</span></span> <span data-ttu-id="700fb-207">Los nombres de clave y CSP de CryptoAPI se limitan a caracteres ANSI de **\_ ruta de acceso máxima** .</span><span class="sxs-lookup"><span data-stu-id="700fb-207">The CryptoAPI CSP and key names are limited to **MAX\_PATH** ANSI characters.</span></span>
-   <span data-ttu-id="700fb-208">CNG ofrece la funcionalidad de las propiedades de clave definidas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="700fb-208">CNG offers the capability of user-defined key properties.</span></span> <span data-ttu-id="700fb-209">Los usuarios pueden crear y asociar propiedades personalizadas con claves y hacer que se almacenen con claves persistentes.</span><span class="sxs-lookup"><span data-stu-id="700fb-209">Users can create and associate custom properties with keys, and have them stored with persisted keys.</span></span>

<span data-ttu-id="700fb-210">Cuando se conserva una clave, CNG puede crear dos archivos.</span><span class="sxs-lookup"><span data-stu-id="700fb-210">When persisting a key, CNG can create two files.</span></span> <span data-ttu-id="700fb-211">El primer archivo contiene la clave privada en el nuevo formato CNG y siempre se crea.</span><span class="sxs-lookup"><span data-stu-id="700fb-211">The first file contains the private key in the new CNG format and is always created.</span></span> <span data-ttu-id="700fb-212">Los CSP de CryptoAPI heredados no pueden usar este archivo.</span><span class="sxs-lookup"><span data-stu-id="700fb-212">This file is not usable by the legacy CryptoAPI CSPs.</span></span> <span data-ttu-id="700fb-213">El segundo archivo contiene la misma clave privada en el contenedor de claves CryptoAPI heredado.</span><span class="sxs-lookup"><span data-stu-id="700fb-213">The second file contains the same private key in the legacy CryptoAPI key container.</span></span> <span data-ttu-id="700fb-214">El segundo archivo se ajusta al formato y la ubicación que usa Rsaenh.dll.</span><span class="sxs-lookup"><span data-stu-id="700fb-214">The second file conforms to the format and location used by Rsaenh.dll.</span></span> <span data-ttu-id="700fb-215">La creación del segundo archivo solo se produce si se especifica la marca de **marcador de escritura de NCRYPT \_ en el \_ \_ \_ \_ almacén \_ heredado** cuando se llama a la función [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) para finalizar una clave RSA.</span><span class="sxs-lookup"><span data-stu-id="700fb-215">Creation of the second file only occurs if the **NCRYPT\_WRITE\_KEY\_TO\_LEGACY\_STORE\_FLAG** flag is specified when the [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) function is called to finalize an RSA key.</span></span> <span data-ttu-id="700fb-216">Esta característica no se admite para las claves DSA y DH.</span><span class="sxs-lookup"><span data-stu-id="700fb-216">This feature is not supported for DSA and DH keys.</span></span>

<span data-ttu-id="700fb-217">Cuando una aplicación intenta abrir una clave persistente existente, CNG intenta abrir primero el archivo CNG nativo.</span><span class="sxs-lookup"><span data-stu-id="700fb-217">When an application attempts to open an existing persisted key, CNG first attempts to open the native CNG file.</span></span> <span data-ttu-id="700fb-218">Si este archivo no existe, CNG intenta encontrar una clave coincidente en el contenedor de claves CryptoAPI heredado.</span><span class="sxs-lookup"><span data-stu-id="700fb-218">If this file does not exist, then CNG attempts to locate a matching key in the legacy CryptoAPI key container.</span></span>

<span data-ttu-id="700fb-219">Cuando se mueven o copian las claves de CryptoAPI de una máquina de origen a un equipo de destino con Herramienta de migración de estado de usuario de Windows (USMT), CNG no podrá tener acceso a las claves en el equipo de destino.</span><span class="sxs-lookup"><span data-stu-id="700fb-219">When you move or copy CryptoAPI keys from a source machine to a target machine with Windows User State Migration Tool (USMT), CNG will fail to access the keys on the target machine.</span></span> <span data-ttu-id="700fb-220">Para tener acceso a estas claves migradas, debe usar la CryptoAPI.</span><span class="sxs-lookup"><span data-stu-id="700fb-220">To access such migrated keys, you must use the CryptoAPI.</span></span>

 

 




