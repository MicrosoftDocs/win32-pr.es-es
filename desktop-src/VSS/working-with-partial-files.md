---
description: A veces resulta útil realizar copias de seguridad y restaurar solo secciones de archivos. VSS proporciona mecanismos de archivos parciales que, si los solicitan, permiten a los escritores especificar copias de seguridad de archivos parciales y restauraciones.
ms.assetid: 02b74a4e-d69f-4eeb-866a-3399598b7035
title: Trabajar con archivos parciales
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7194f01df11f6c0e368941e17ef6ab1620b17f67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696430"
---
# <a name="working-with-partial-files"></a><span data-ttu-id="1a45a-104">Trabajar con archivos parciales</span><span class="sxs-lookup"><span data-stu-id="1a45a-104">Working with Partial Files</span></span>

<span data-ttu-id="1a45a-105">A veces resulta útil realizar copias de seguridad y restaurar solo secciones de archivos.</span><span class="sxs-lookup"><span data-stu-id="1a45a-105">It is sometimes useful to back up and restore only sections of files.</span></span> <span data-ttu-id="1a45a-106">VSS proporciona mecanismos de [*archivos parciales*](vssgloss-p.md) que, si los solicitan, permiten a los escritores especificar copias de seguridad de archivos parciales y restauraciones.</span><span class="sxs-lookup"><span data-stu-id="1a45a-106">VSS provides [*partial file*](vssgloss-p.md) mechanisms, which, if requesters support it, allows writers to specify partial file backups and restores.</span></span>

<span data-ttu-id="1a45a-107">Las operaciones de archivos parciales suelen ser de mayor uso para los escritores que mantienen archivos muy grandes, solo una pequeña fracción de los cambios entre las operaciones de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1a45a-107">Partial file operations are frequently of greatest use to writers that maintain very large files, only a small fraction of which change between backup operations.</span></span> <span data-ttu-id="1a45a-108">Este es el caso, a menudo resulta útil copiar solo la sección que cambió al medio de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1a45a-108">This being the case, it is frequently useful to copy only that section that changed to backup media.</span></span> <span data-ttu-id="1a45a-109">Por este motivo, las operaciones de archivos parciales normalmente se usan, pero no exclusivamente, para admitir operaciones de copia de seguridad y restauración incrementales.</span><span class="sxs-lookup"><span data-stu-id="1a45a-109">For this reason, partial file operations are typically, but not exclusively, used to support incremental backup and restore operations.</span></span>

<span data-ttu-id="1a45a-110">Si un escritor desea implementar una operación de archivo parcial, usa [**CVssWriter:: IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) para determinar si el solicitante con el que trabaja admite la operación.</span><span class="sxs-lookup"><span data-stu-id="1a45a-110">If a writer wants to implement a partial file operation, it uses [**CVssWriter::IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) to determine whether the requester it is working with supports the operation.</span></span>

<span data-ttu-id="1a45a-111">Si el solicitante admite operaciones de archivo parciales y agrega el componente que administra el archivo (o el componente que define el conjunto de componentes que contiene el archivo) al documento componentes de copia de seguridad, un escritor indica qué secciones del archivo se deben guardar (normalmente al controlar un evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) o [*postsnapshot*](vssgloss-p.md) ) mediante una llamada a [**IVssComponent:: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="1a45a-111">If the requester supports partial file operations, and if it adds the component that manages the file (or the component that defines the component set that contains the file) to the Backup Components Document, a writer indicates which sections of the file to save (typically while handling a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or [*PostSnapshot*](vssgloss-p.md) event) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="1a45a-112">Además de una ruta de acceso y un nombre de archivo, el escritor proporciona la información de metadatos opcional del intervalo a [**IVssComponent:: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="1a45a-112">In addition to a path and file name, the writer supplies the range, optional metadata information to [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="1a45a-113">La información del intervalo se proporciona como una cadena que contiene una de las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="1a45a-113">The range information is provided as a string that contains either of the following:</span></span>

-   <span data-ttu-id="1a45a-114">Pares de desplazamientos en el archivo del que se va a hacer una copia de seguridad (en bytes) y la longitud de la sección de la que se va a hacer una copia de seguridad (en bytes), el desplazamiento y la longitud separados por dos puntos, y cada par separado por una coma, por ejemplo, \*Offset1 \***:**_length1 (_*_,_* \* Offset2 \***:**_length2 (_.</span><span class="sxs-lookup"><span data-stu-id="1a45a-114">Pairs of offsets into the file to be backed up (in bytes) and the length of the section to be backed up (in bytes), the offset and length being separated by a colon, and each pair separated by a comma, for example, *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span>

    <span data-ttu-id="1a45a-115">Cada valor es un entero de 64 bits (en formato hexadecimal o decimal) que especifica un desplazamiento de bytes y una longitud en bytes, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1a45a-115">Each value is a 64-bit integer (in either hexadecimal or decimal format) specifying a byte offset and length in bytes, respectively.</span></span>

-   <span data-ttu-id="1a45a-116">La ruta de acceso completa, incluido el nombre de archivo, en el sistema actual de un archivo de intervalos binarios que contiene lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="1a45a-116">The full path, including file name, on the current system of a binary ranges file containing the following:</span></span>
    -   <span data-ttu-id="1a45a-117">El número (expresado como un entero de 64 bits) de distintos intervalos de archivos contenidos en el archivo.</span><span class="sxs-lookup"><span data-stu-id="1a45a-117">The number (expressed as a 64-bit integer) of distinct file ranges contained in the file</span></span>
    -   <span data-ttu-id="1a45a-118">Cada intervalo expresado como un par de enteros de 64 bits: el primer miembro del par es el desplazamiento en el archivo del que se realiza la copia de seguridad (en bytes) y el segundo miembro es la longitud de los datos de los que se va a hacer una copia de seguridad (en bytes).</span><span class="sxs-lookup"><span data-stu-id="1a45a-118">Each range expressed as a pair of 64-bit integers: the first member of the pair being the offset into the file being backed up (in bytes), and the second member being the length of data to be backed up (in bytes)</span></span>

<span data-ttu-id="1a45a-119">Si un sistema de escritura usa un archivo de rangos para especificar una operación de archivo parcial, un solicitante debe garantizar que se realice una copia de seguridad de este archivo (aunque el archivo no sea necesariamente parte del conjunto de copia de seguridad predeterminado) o que la información de los intervalos se conserve en el medio de copia de seguridad de otra manera.</span><span class="sxs-lookup"><span data-stu-id="1a45a-119">If a writer uses a ranges file to specify a partial file operation, a requester must guarantee that either this file is backed up (even if the file is not necessarily part of the default backup set) or that the ranges information is preserved on the backup media in some other way.</span></span> <span data-ttu-id="1a45a-120">Si no se realiza una copia de seguridad de la información del archivo de intervalos, no será posible restaurar el archivo de copia de seguridad parcial.</span><span class="sxs-lookup"><span data-stu-id="1a45a-120">If the ranges file's information is not backed up, restoring the partially backed up file will be impossible.</span></span>

<span data-ttu-id="1a45a-121">El escritor también puede Agregar una cadena que contiene metadatos.</span><span class="sxs-lookup"><span data-stu-id="1a45a-121">The writer can also add a string containing metadata.</span></span> <span data-ttu-id="1a45a-122">Estos metadatos pueden estar en un formato específico del escritor porque está diseñado para permitir que el escritor valide las restauraciones futuras.</span><span class="sxs-lookup"><span data-stu-id="1a45a-122">This metadata can be in a writer-specific format because it is intended to allow the writer to validate any future restores.</span></span>

<span data-ttu-id="1a45a-123">Con esta información, un solicitante auxiliar puede realizar una copia de seguridad de archivos parcial.</span><span class="sxs-lookup"><span data-stu-id="1a45a-123">With this information, a supporting requester can perform a partial file backup.</span></span>

<span data-ttu-id="1a45a-124">Como ejemplo, considere un archivo grande cuyo encabezado (bytes 64-512) contiene un recuento de registros y otra información actualizada con frecuencia, y cuyos datos más recientes se van a encontrar en los últimos 65536 bytes del archivo, bytes 0x1239E8577A a 0x1239E7577A.</span><span class="sxs-lookup"><span data-stu-id="1a45a-124">As an example, consider a large file whose header (bytes 64-512) contains a record count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A.</span></span>

<span data-ttu-id="1a45a-125">Un escritor puede especificar una lista de intervalos como la cadena "**64:448, 0x1239E8577A: 65536**".</span><span class="sxs-lookup"><span data-stu-id="1a45a-125">A writer could specify a range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="1a45a-126">En la restauración y antes de realizar realmente una operación de restauración, un solicitante debe comprobar si algún archivo requiere compatibilidad con archivos parciales.</span><span class="sxs-lookup"><span data-stu-id="1a45a-126">On restore, and prior to actually performing a restore operation, a requester should check to see if any files require partial file support.</span></span>

<span data-ttu-id="1a45a-127">Para ello, el solicitante primero recorre en iteración los escritores con componentes almacenados en su documento de componentes de copia de seguridad mediante [**IVssBackupComponents:: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) y [**Ivssbackupcomponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="1a45a-127">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="1a45a-128">La interfaz [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) se usa para devolver instancias de la interfaz [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , que proporcionan [**IVssWriterComponentsExt:: getComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) y [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), que permiten al solicitante obtener instancias de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="1a45a-128">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provide [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="1a45a-129">Esto permite que un solicitante obtenga información sobre los archivos de copia de seguridad parcial para participar en una restauración mediante [**IVssComponent:: GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) y [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) para la instancia de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondiente al componente que administra el archivo (o el componente que define el conjunto de componentes que contiene el archivo).</span><span class="sxs-lookup"><span data-stu-id="1a45a-129">This allows a requester to obtain information about the partially backed up files to participate in a restore by using [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="1a45a-130">Si la operación de archivo parcial se controló mediante un archivo de rangos, ese archivo debe restaurarse antes de copiar los datos de nuevo en el disco.</span><span class="sxs-lookup"><span data-stu-id="1a45a-130">If the partial file operation was controlled by a ranges file, that file should be restored prior to copied data back to disk.</span></span> <span data-ttu-id="1a45a-131">Puede ocurrir que el solicitante necesite volver a copiar el archivo de intervalos en una nueva ubicación en el disco.</span><span class="sxs-lookup"><span data-stu-id="1a45a-131">It may happen that the requester needed to copy the ranges file back to a new location on disk.</span></span> <span data-ttu-id="1a45a-132">En este caso, indica que se ha hecho a través de [**IVssBackupComponents:: SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span><span class="sxs-lookup"><span data-stu-id="1a45a-132">In this case, it indicates that it has done so through the [**IVssBackupComponents::SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span></span>

<span data-ttu-id="1a45a-133">A continuación, el solicitante continúa para copiar los datos en las ubicaciones adecuadas del destino de restauración ya en el disco.</span><span class="sxs-lookup"><span data-stu-id="1a45a-133">The requester then proceeds to copy data into the appropriate locations in the restore destination already on disk.</span></span>

<span data-ttu-id="1a45a-134">Un escritor (mientras se controla un evento [**Postrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) ) examinando [**IVssComponent:: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) para los archivos indicados por [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determina si la operación de archivo parcial se realizó correctamente.</span><span class="sxs-lookup"><span data-stu-id="1a45a-134">A writer (while handling a [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event), by examining [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) for the files indicated by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determines if the partial file operation was successful.</span></span> <span data-ttu-id="1a45a-135">El escritor siempre debe intentar comprobar la corrección de esta restauración con la información de desplazamiento y los metadatos incluidos en el documento componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1a45a-135">The writer should always attempt to verify the correctness of this restore using the offset information and any metadata included in the Backup Components Document.</span></span>

<span data-ttu-id="1a45a-136">Si el solicitante ha tenido que restaurar el archivo de intervalos en una nueva ubicación, VSS actualizará esta información para que la ruta de acceso devuelta por [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) sea correcta.</span><span class="sxs-lookup"><span data-stu-id="1a45a-136">If the requester has had to restore the ranges file to a new location, VSS will update this information so that the path returned by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) is correct.</span></span>

 

 
