---
title: Escribir ejemplos de imagen de vídeo
description: Escribir ejemplos de imagen de vídeo
ms.assetid: 1d375186-230a-4a18-a995-b331c72a76e7
keywords:
- Advanced Systems Format (ASF), escribir ejemplos de imágenes de vídeo
- ASF (formato de sistemas avanzados), escribir ejemplos de imagen de vídeo
- imágenes de vídeo, escribir ejemplos
- flujos, escribir ejemplos de imagen de vídeo
- códecs, escribir ejemplos de imagen de vídeo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0fbac644d7938477ba3d2e8b21ebb6e631a47708
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/19/2020
ms.locfileid: "104358678"
---
# <a name="writing-video-image-samples"></a><span data-ttu-id="d0abe-108">Escribir ejemplos de imagen de vídeo</span><span class="sxs-lookup"><span data-stu-id="d0abe-108">Writing Video Image Samples</span></span>

<span data-ttu-id="d0abe-109">Una secuencia de imágenes de vídeo es un vídeo que contiene una serie de imágenes fijas.</span><span class="sxs-lookup"><span data-stu-id="d0abe-109">A Video Image stream is a video that contains a series of still images.</span></span> <span data-ttu-id="d0abe-110">Las imágenes pueden moverse dentro del fotograma y cada imagen puede fusionarse en el siguiente.</span><span class="sxs-lookup"><span data-stu-id="d0abe-110">The images can move within the frame, and each image can blend into the next.</span></span> <span data-ttu-id="d0abe-111">Los flujos de imagen de vídeo se codifican con el códec Windows Media Video 9 Image V2.</span><span class="sxs-lookup"><span data-stu-id="d0abe-111">Video Image streams are encoded using the Windows Media Video 9 Image v2 codec.</span></span> <span data-ttu-id="d0abe-112">El vídeo de salida es similar al creado por el códec Windows Media Video 9.</span><span class="sxs-lookup"><span data-stu-id="d0abe-112">The output video is similar to that created by the Windows Media Video 9 codec.</span></span>

<span data-ttu-id="d0abe-113">Para crear un perfil que contenga una secuencia de imágenes de vídeo, empiece por enumerar los códecs de vídeo, tal como se describe en [obtención de información de configuración de flujo de códecs](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="d0abe-113">To create a profile that contains a Video Image stream, start by enumerating the video codecs as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="d0abe-114">Busque el códec que admite el \_ subtipo WMMEDIASUBTYPE WVP2.</span><span class="sxs-lookup"><span data-stu-id="d0abe-114">Search for the codec that supports the WMMEDIASUBTYPE\_WVP2 subtype.</span></span>

<span data-ttu-id="d0abe-115">Después de establecer el perfil en el objeto de escritor, llame a [**IWMWriter:: GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) para obtener las propiedades multimedia para el flujo de entrada de la imagen de vídeo.</span><span class="sxs-lookup"><span data-stu-id="d0abe-115">After you set the profile on the writer object, call [**IWMWriter::GetInputProps**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) to get the media properties for the Video Image input stream.</span></span> <span data-ttu-id="d0abe-116">Obtenga el tipo de medio del objeto de propiedades de medios, llamando a [**IWMMediaProps:: GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), y cambie el subtipo a WMMEDIASUBTYPE \_ videoimage.</span><span class="sxs-lookup"><span data-stu-id="d0abe-116">Get the media type from the media properties object, by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), and change the subtype to WMMEDIASUBTYPE\_VIDEOIMAGE.</span></span> <span data-ttu-id="d0abe-117">Debe establecer el ancho y el alto del vídeo en las dimensiones máximas necesarias para abarcar las imágenes que se van a agregar a la secuencia.</span><span class="sxs-lookup"><span data-stu-id="d0abe-117">You should set the video width and height to the maximum dimensions needed to encompass the images you will add to the stream.</span></span> <span data-ttu-id="d0abe-118">A continuación, llame a [**IWMMediaProps:: SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) con el tipo de entrada modificado.</span><span class="sxs-lookup"><span data-stu-id="d0abe-118">Then call [**IWMMediaProps::SetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) with the modified input type.</span></span> <span data-ttu-id="d0abe-119">Ahora ya está listo para empezar a enviar ejemplos al objeto escritor.</span><span class="sxs-lookup"><span data-stu-id="d0abe-119">Now you are ready to begin sending samples to the writer object.</span></span>

<span data-ttu-id="d0abe-120">Cada ejemplo debe comenzar con una estructura de **\_ \_ SAMPLE2 de imágenes WMT** .</span><span class="sxs-lookup"><span data-stu-id="d0abe-120">Each sample must begin with a **WMT\_VIDEOIMAGE\_SAMPLE2** structure.</span></span> <span data-ttu-id="d0abe-121">Además, los ejemplos pueden contener imágenes de mapa de bits.</span><span class="sxs-lookup"><span data-stu-id="d0abe-121">Additionally, samples may contain bitmap images.</span></span> <span data-ttu-id="d0abe-122">Una imagen solo se adjunta a un ejemplo para el primer fotograma en el que aparece.</span><span class="sxs-lookup"><span data-stu-id="d0abe-122">An image is only attached to a sample for the first frame in which it appears.</span></span> <span data-ttu-id="d0abe-123">Todos los marcos adicionales que usan esa imagen solo necesitan información en la estructura.</span><span class="sxs-lookup"><span data-stu-id="d0abe-123">All additional frames using that image need only information in the structure.</span></span> <span data-ttu-id="d0abe-124">Los mapas de bits de entrada deben tener formato de RGB, 24 bits por píxel.</span><span class="sxs-lookup"><span data-stu-id="d0abe-124">Input bitmaps must be formatted as RGB, 24 bits per pixel.</span></span>

<span data-ttu-id="d0abe-125">Los archivos de mapa de bits almacenan los datos de la imagen de modo que los datos de cada fila de la imagen contengan un número de bytes divisible por cuatro.</span><span class="sxs-lookup"><span data-stu-id="d0abe-125">Bitmap files store the image data so that the data for each row of the image takes a number of bytes divisible by four.</span></span> <span data-ttu-id="d0abe-126">(Esto se denomina intervalo del mapa de bits). Esto obliga al principio de cada fila de vídeo a un límite **DWORD** , lo que hace que la copia sea más eficaz.</span><span class="sxs-lookup"><span data-stu-id="d0abe-126">(This is called the stride of the bitmap.) This forces the beginning of every row of video to a **DWORD** boundary, which makes copying more efficient.</span></span> <span data-ttu-id="d0abe-127">Si las filas de la imagen no son divisible en cuatro partes, la fila se rellenará hasta el siguiente múltiplo más alto de cuatro bytes.</span><span class="sxs-lookup"><span data-stu-id="d0abe-127">If the image rows are not evenly divisible by four, the row is padded to the next highest multiple of four bytes.</span></span> <span data-ttu-id="d0abe-128">Al adjuntar datos de imagen, debe quitar cualquier relleno que exista al final de los datos de cada fila.</span><span class="sxs-lookup"><span data-stu-id="d0abe-128">When you attach image data, you must remove any padding that exists at the end of the data for each row.</span></span>

<span data-ttu-id="d0abe-129">El códec Windows Media Video 9 Image V2 mantiene hasta dos imágenes en la memoria a la vez.</span><span class="sxs-lookup"><span data-stu-id="d0abe-129">The Windows Media Video 9 Image v2 codec maintains up to two images in memory at a time.</span></span> <span data-ttu-id="d0abe-130">Estas imágenes se denominan la imagen anterior y la imagen actual.</span><span class="sxs-lookup"><span data-stu-id="d0abe-130">These images are called the previous image and the current image.</span></span> <span data-ttu-id="d0abe-131">Cada imagen tiene un conjunto de miembros de la estructura de **\_ \_ SAMPLE2 de imágenes WMT** , que dictan cómo se presenta la imagen en el fotograma.</span><span class="sxs-lookup"><span data-stu-id="d0abe-131">Each image has a set of members in the **WMT\_VIDEOIMAGE\_SAMPLE2** structure, which dictate how the image is presented in the frame.</span></span> <span data-ttu-id="d0abe-132">Puede Agregar una imagen estableciendo el miembro dwControlFlags de la **imagen de \_ videoimage \_ SAMPLE2 de WMT** en el \_ \_ \_ fotograma de entrada del ejemplo de imagen de videoimage \_ .</span><span class="sxs-lookup"><span data-stu-id="d0abe-132">You can add an image by setting the dwControlFlags member of **WMT\_VIDEOIMAGE\_SAMPLE2** to WMT\_VIDEOIMAGE\_SAMPLE\_INPUT\_FRAME.</span></span> <span data-ttu-id="d0abe-133">Al pasar un fotograma de entrada al códec, esa imagen se convierte en la imagen actual.</span><span class="sxs-lookup"><span data-stu-id="d0abe-133">When you pass an input frame to the codec, that image becomes the current image.</span></span> <span data-ttu-id="d0abe-134">La imagen que era la imagen actual en el ejemplo anterior se convierte normalmente en la imagen anterior y se descarta la imagen que era la imagen anterior en el ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="d0abe-134">The image that was the current image in the previous sample usually becomes the previous image, and the image that was the previous image in the previous sample is discarded.</span></span> <span data-ttu-id="d0abe-135">Puede configurar el códec para conservar la imagen anterior antigua estableciendo el miembro **bKeepPrevImage** en **true**.</span><span class="sxs-lookup"><span data-stu-id="d0abe-135">You can configure the codec to retain the old previous image by setting the **bKeepPrevImage** member to **TRUE**.</span></span> <span data-ttu-id="d0abe-136">En ese caso, se descarta la imagen que era la imagen actual en el ejemplo anterior.</span><span class="sxs-lookup"><span data-stu-id="d0abe-136">In that case, the image that was the current image in the previous sample is discarded.</span></span>

<span data-ttu-id="d0abe-137">La composición básica de un fotograma de imagen de vídeo viene determinada por dos factores para cada imagen: región de interés y coeficiente de mezcla.</span><span class="sxs-lookup"><span data-stu-id="d0abe-137">The basic composition of a Video Image frame is determined by two factors for each image: region of interest and blend coefficient.</span></span> <span data-ttu-id="d0abe-138">La región de interés para una imagen se define mediante un punto de origen, ancho y alto.</span><span class="sxs-lookup"><span data-stu-id="d0abe-138">The region of interest for an image is defined by an origin point, width, and height.</span></span> <span data-ttu-id="d0abe-139">La parte de una imagen que se describe en la región de interés rellena el fotograma de salida.</span><span class="sxs-lookup"><span data-stu-id="d0abe-139">The part of an image described by the region of interest fills the output frame.</span></span> <span data-ttu-id="d0abe-140">Si el tamaño de la región de interés es distinto al del fotograma de salida, el códec lo cambia de tamaño.</span><span class="sxs-lookup"><span data-stu-id="d0abe-140">If the region of interest is a different size than the output frame, the codec resizes it.</span></span> <span data-ttu-id="d0abe-141">El coeficiente de fusión de la imagen determina la combinación de las dos imágenes.</span><span class="sxs-lookup"><span data-stu-id="d0abe-141">The blend coefficient of the image determines the blending of the two images.</span></span> <span data-ttu-id="d0abe-142">Los coeficientes de combinación de las imágenes actual y anterior deben ser totales de 1,0.</span><span class="sxs-lookup"><span data-stu-id="d0abe-142">The blend coefficients for the current and previous images must total 1.0.</span></span> <span data-ttu-id="d0abe-143">Por ejemplo, si **fCurrBlendCoef** se establece en 0,5 y **fPrevBlendCoef** se establece en 0,5, el fotograma de salida se compone de una combinación igual de las regiones de interés de ambas imágenes.</span><span class="sxs-lookup"><span data-stu-id="d0abe-143">For example, if **fCurrBlendCoef** is set to 0.5 and **fPrevBlendCoef** is set to 0.5, then the output frame is composed of an equal blend of the regions of interest from both images.</span></span>

<span data-ttu-id="d0abe-144">Mediante la manipulación de la región de interés de una imagen, puede crear efectos de panorámica y zoom.</span><span class="sxs-lookup"><span data-stu-id="d0abe-144">By manipulating the region of interest for an image, you can create pan and zoom effects.</span></span> <span data-ttu-id="d0abe-145">Los coeficientes de Blend permiten el fundido cruzado (disolución) entre las imágenes.</span><span class="sxs-lookup"><span data-stu-id="d0abe-145">The blend coefficients enable you to cross-fade (dissolve) between images.</span></span> <span data-ttu-id="d0abe-146">Además de estos efectos, puede usar una de las transiciones predefinidas para crear fotogramas más complejos.</span><span class="sxs-lookup"><span data-stu-id="d0abe-146">In addition to these effects, you can use one of the predefined transitions to create more complex frames.</span></span> <span data-ttu-id="d0abe-147">Las transiciones disponibles se describen en la sección [transiciones de imagen de vídeo](video-image-transitions.md) de esta documentación.</span><span class="sxs-lookup"><span data-stu-id="d0abe-147">The available transitions are described in the [Video Image Transitions](video-image-transitions.md) section of this documentation.</span></span> <span data-ttu-id="d0abe-148">Cuando se usa una transición, se debe configurar cada fotograma.</span><span class="sxs-lookup"><span data-stu-id="d0abe-148">When using a transition, you must configure each frame.</span></span> <span data-ttu-id="d0abe-149">La forma más fácil de hacerlo es crear una función que cambie incrementalmente los miembros de la estructura **de \_ \_ SAMPLE2 de imágenes WMT** para obtener un efecto completo.</span><span class="sxs-lookup"><span data-stu-id="d0abe-149">The easiest way to do this is to create a function that incrementally changes members of the **WMT\_VIDEOIMAGE\_SAMPLE2** structure for a complete effect.</span></span>

<span data-ttu-id="d0abe-150">Para obtener más información sobre los valores que se deben establecer para las desformaciones, vea [**WMT \_ videoimage \_ SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span><span class="sxs-lookup"><span data-stu-id="d0abe-150">For more information about the values to set for deformations, see [**WMT\_VIDEOIMAGE\_SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).</span></span>

<span data-ttu-id="d0abe-151">**Nota:** Si desea incluir audio en un archivo con una secuencia de imágenes de vídeo, debe usar la entrada de audio sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="d0abe-151">**Note** If you want to include audio in a file with a Video Image stream, you must use uncompressed audio input.</span></span> <span data-ttu-id="d0abe-152">Para combinar una secuencia de imágenes de vídeo con una secuencia de audio comprimida existente, debe descomprimir el audio y pasar los ejemplos sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="d0abe-152">To combine a Video Image stream with an existing compressed audio stream, you must decompress the audio and pass the samples in uncompressed.</span></span> <span data-ttu-id="d0abe-153">Si pasa muestras comprimidas al escritor cuando escribe una secuencia de imagen de vídeo, se producirá un error, lo que hará que se quiten los ejemplos del vídeo.</span><span class="sxs-lookup"><span data-stu-id="d0abe-153">If you pass compressed samples to the writer when writing a Video Image stream, an error will occur, resulting in samples being dropped from the video.</span></span>

<span data-ttu-id="d0abe-154">Además, los archivos de imagen de vídeo comprimidos sin secuencias de audio pueden contener varios fotogramas de vídeo muy pequeños y muy comprimidos en un único paquete ASF, lo que puede dar lugar a una mala experiencia de reproducción en versiones anteriores de Windows Media Player.</span><span class="sxs-lookup"><span data-stu-id="d0abe-154">Also, compressed Video Image files with no audio streams can contain several very small, highly compressed video frames in a single ASF packet, which can result in a poor playback experience on previous versions of Windows Media Player.</span></span> <span data-ttu-id="d0abe-155">Para evitar este problema, la mejor solución consiste en insertar una secuencia de audio silenciosa en el archivo, aunque también aumentará el tamaño del archivo.</span><span class="sxs-lookup"><span data-stu-id="d0abe-155">To avoid this problem, the best solution is to insert a silent audio stream into the file, although this will also increase the file size.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d0abe-156">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d0abe-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d0abe-157">**Imagen de vídeo**</span><span class="sxs-lookup"><span data-stu-id="d0abe-157">**Video Image**</span></span>](video-image.md)
</dt> <dt>

[<span data-ttu-id="d0abe-158">**Escribir archivos ASF**</span><span class="sxs-lookup"><span data-stu-id="d0abe-158">**Writing ASF Files**</span></span>](writing-asf-files.md)
</dt> </dl>

 

 




