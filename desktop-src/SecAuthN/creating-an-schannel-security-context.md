---
description: Explica cómo establecer un contexto de seguridad que protege las comunicaciones entre un cliente y un servidor.
ms.assetid: eb1eadb2-14b2-4265-994a-dcea4208e650
title: Crear un contexto de seguridad de Schannel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 23e364e6319fbaddb50bffaf59541af9e8f43bfb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105648385"
---
# <a name="creating-an-schannel-security-context"></a><span data-ttu-id="80e07-103">Crear un contexto de seguridad de Schannel</span><span class="sxs-lookup"><span data-stu-id="80e07-103">Creating an Schannel Security Context</span></span>

<span data-ttu-id="80e07-104">Para establecer un [*contexto de seguridad*](/windows/desktop/SecGloss/s-gly) que protegerá las comunicaciones entre un cliente y un servidor, ambos deben participar en el siguiente proceso de intercambio de información:</span><span class="sxs-lookup"><span data-stu-id="80e07-104">To establish a [*security context*](/windows/desktop/SecGloss/s-gly) that will protect communications between a client and server, both must participate in the following information exchange process:</span></span>

## <a name="client"></a><span data-ttu-id="80e07-105">Remoto</span><span class="sxs-lookup"><span data-stu-id="80e07-105">Client</span></span>

1.  <span data-ttu-id="80e07-106">El cliente llama a la función [**InitializeSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) .</span><span class="sxs-lookup"><span data-stu-id="80e07-106">The client calls the [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) function.</span></span>
2.  <span data-ttu-id="80e07-107">Schannel comienza a crear un contexto de seguridad de acuerdo con las reglas del Protocolo de seguridad seleccionado.</span><span class="sxs-lookup"><span data-stu-id="80e07-107">Schannel begins creating a security context according to the rules of the selected security protocol.</span></span> <span data-ttu-id="80e07-108">El código de retorno de la función indica si el cliente debe volver a llamar a la función.</span><span class="sxs-lookup"><span data-stu-id="80e07-108">The function's return code indicates whether the client must call the function again.</span></span> <span data-ttu-id="80e07-109">[**InitializeSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) puede devolver un token que representa el contexto.</span><span class="sxs-lookup"><span data-stu-id="80e07-109">[**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) may return a token that represents the context.</span></span>
3.  <span data-ttu-id="80e07-110">Si se devolvió un token, el cliente lo envía al servidor.</span><span class="sxs-lookup"><span data-stu-id="80e07-110">If a token was returned, the client sends it to the server.</span></span>
4.  <span data-ttu-id="80e07-111">Cuando [**InitializeSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) devuelve sec \_ E \_ OK, se realiza el cliente.</span><span class="sxs-lookup"><span data-stu-id="80e07-111">When [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) returns SEC\_E\_OK, the client is done.</span></span> <span data-ttu-id="80e07-112">Si la función devuelve los segundos \_ que \_ continúan \_ necesarios, el cliente debe esperar a que el servidor lo envíe a un token.</span><span class="sxs-lookup"><span data-stu-id="80e07-112">If the function returns SEC\_I\_CONTINUE\_NEEDED, the client must wait for the server to send it a token.</span></span> <span data-ttu-id="80e07-113">Cuando el cliente tiene el token del servidor, debe llamar de nuevo a la [*función*](/windows/desktop/SecGloss/c-gly) **InitializeSecurityContext (general)** .</span><span class="sxs-lookup"><span data-stu-id="80e07-113">When the client has the token from the server, it must call the **InitializeSecurityContext (General)** [*function*](/windows/desktop/SecGloss/c-gly) again.</span></span> <span data-ttu-id="80e07-114">(Vuelva al paso 2).</span><span class="sxs-lookup"><span data-stu-id="80e07-114">(Return to step 2.)</span></span>

## <a name="server"></a><span data-ttu-id="80e07-115">Servidor</span><span class="sxs-lookup"><span data-stu-id="80e07-115">Server</span></span>

1.  <span data-ttu-id="80e07-116">El servidor espera a que un cliente envíe un mensaje que contiene un token de seguridad.</span><span class="sxs-lookup"><span data-stu-id="80e07-116">The server waits for a client to send a message that contains a security token.</span></span> <span data-ttu-id="80e07-117">El servidor pasa el token recibido del cliente a la función [**AcceptSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="80e07-117">The server passes the token received from the client into the [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span>
2.  <span data-ttu-id="80e07-118">Schannel se basa en el contexto de seguridad parcial representado por el token.</span><span class="sxs-lookup"><span data-stu-id="80e07-118">Schannel builds on the partial security context represented by the token.</span></span> <span data-ttu-id="80e07-119">Schannel devuelve un token al servidor y un código de retorno que indica si el servidor debe volver a llamar a la función.</span><span class="sxs-lookup"><span data-stu-id="80e07-119">Schannel returns a token to the server, and a return code indicating whether the server must call the function again.</span></span>
3.  <span data-ttu-id="80e07-120">Si se devolvió un token, el servidor lo envía al cliente.</span><span class="sxs-lookup"><span data-stu-id="80e07-120">If a token was returned, the server sends it to the client.</span></span>
4.  <span data-ttu-id="80e07-121">Cuando [**AcceptSecurityContext (general)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) devuelve sec \_ E \_ OK, el servidor se hace.</span><span class="sxs-lookup"><span data-stu-id="80e07-121">When [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) returns SEC\_E\_OK, the server is done.</span></span> <span data-ttu-id="80e07-122">Si la función devuelve los segundos \_ que \_ continúan siendo \_ necesarios, el servidor debe esperar a que el cliente lo envíe a un token.</span><span class="sxs-lookup"><span data-stu-id="80e07-122">If the function returns SEC\_I\_CONTINUE\_NEEDED, then the server must wait for the client to send it a token.</span></span> <span data-ttu-id="80e07-123">Cuando el servidor tiene el token del cliente, debe llamar de nuevo a la función **AcceptSecurityContext (general)** .</span><span class="sxs-lookup"><span data-stu-id="80e07-123">When the server has the token from the client, it must call the **AcceptSecurityContext (General)** function again.</span></span> <span data-ttu-id="80e07-124">(Vuelva al paso 2).</span><span class="sxs-lookup"><span data-stu-id="80e07-124">(Return to step 2.)</span></span>

<span data-ttu-id="80e07-125">Si alguna de las funciones devuelve un valor distinto de SEC \_ e \_ \_ \_ \_ incompletos, es necesario que se requiera, o \_ un mensaje de s e \_ incompleta \_ (vea el párrafo siguiente), se ha producido un error.</span><span class="sxs-lookup"><span data-stu-id="80e07-125">If either function returns a value other than SEC\_E\_OK, SEC\_I\_CONTINUE\_NEEDED, or SEC\_E\_INCOMPLETE\_MESSAGE (see the following paragraph) an error has occurred.</span></span> <span data-ttu-id="80e07-126">El cliente y el servidor deben llamar a la función [**DeleteSecurityContext**](/windows/desktop/api/Sspi/nf-sspi-deletesecuritycontext) para eliminar el contexto de seguridad establecido parcialmente.</span><span class="sxs-lookup"><span data-stu-id="80e07-126">The client and server should call the [**DeleteSecurityContext**](/windows/desktop/api/Sspi/nf-sspi-deletesecuritycontext) function to delete the partially established security context.</span></span>

<span data-ttu-id="80e07-127">Un caso especial que puede modificar el procesamiento del cliente y del servidor es cuando se envía demasiado o demasiada información al cliente o al servidor de la otra parte.</span><span class="sxs-lookup"><span data-stu-id="80e07-127">A special case that can alter client and server processing is when too little or too much information is sent to the client or server from the other party.</span></span> <span data-ttu-id="80e07-128">En el caso de que haya poca información, ambas funciones devuelven un \_ \_ mensaje incompleto de sec \_ .</span><span class="sxs-lookup"><span data-stu-id="80e07-128">In the case of too little information, both functions return SEC\_E\_INCOMPLETE\_MESSAGE.</span></span> <span data-ttu-id="80e07-129">Para obtener información sobre cómo reconocer y controlar la información insuficiente o excesiva, consulte [búferes adicionales devueltos por Schannel](extra-buffers-returned-by-schannel.md).</span><span class="sxs-lookup"><span data-stu-id="80e07-129">For information about recognizing and handling insufficient or excess information, see [Extra buffers Returned by Schannel](extra-buffers-returned-by-schannel.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="80e07-130">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="80e07-130">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="80e07-131">Realizar la autenticación mediante Schannel</span><span class="sxs-lookup"><span data-stu-id="80e07-131">Performing Authentication Using Schannel</span></span>](performing-authentication-using-schannel.md)
</dt> <dt>

[<span data-ttu-id="80e07-132">Asignación de certificados</span><span class="sxs-lookup"><span data-stu-id="80e07-132">Mapping Certificates</span></span>](mapping-certificates.md)
</dt> <dt>

[<span data-ttu-id="80e07-133">Validar manualmente las credenciales de Schannel</span><span class="sxs-lookup"><span data-stu-id="80e07-133">Manually Validating Schannel Credentials</span></span>](manually-validating-schannel-credentials.md)
</dt> </dl>

 

 
