---
title: Cómo usar la API de cliente de Conexión a Escritorio remoto Broker
description: La API de cliente de Conexión a Escritorio remoto Broker permite a los proveedores de protocolos de terceros aprovechar el agente de conexión para agilizar el control de las conexiones que usan su Protocolo para conectarse a máquinas virtuales o servidores de Escritorio remoto en una granja.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104359324"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a><span data-ttu-id="58b58-103">Cómo usar la API de cliente de Conexión a Escritorio remoto Broker</span><span class="sxs-lookup"><span data-stu-id="58b58-103">How to use the Remote Desktop Connection Broker client API</span></span>

<span data-ttu-id="58b58-104">La API de cliente de Conexión a Escritorio remoto Broker permite a los proveedores de protocolos de terceros aprovechar el agente de conexión para agilizar el control de las conexiones que usan su Protocolo para conectarse a máquinas virtuales o servidores de Escritorio remoto en una granja.</span><span class="sxs-lookup"><span data-stu-id="58b58-104">The Remote Desktop Connection Broker client API allows third party protocol vendors to leverage the Connection Broker to expedite the handling of connections that use their protocol to connect to virtual machines or Remote Desktop servers in a farm.</span></span>

## <a name="instructions"></a><span data-ttu-id="58b58-105">Instrucciones</span><span class="sxs-lookup"><span data-stu-id="58b58-105">Instructions</span></span>

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a><span data-ttu-id="58b58-106">Paso 1: obtener la interfaz IConnectionBrokerClient</span><span class="sxs-lookup"><span data-stu-id="58b58-106">Step 1: Obtain the IConnectionBrokerClient interface</span></span>

<span data-ttu-id="58b58-107">Una vez inicializado el proveedor de la aplicación o el protocolo, realice los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="58b58-107">When your application or protocol provider is initialized, perform the following steps.</span></span>

1.  <span data-ttu-id="58b58-108">Llame a la función [**CBCreateClientInstance**](cbcreateclientinstance.md) para obtener la interfaz [**IConnectionBrokerClient**](iconnectionbrokerclient.md) .</span><span class="sxs-lookup"><span data-stu-id="58b58-108">Call the [**CBCreateClientInstance**](cbcreateclientinstance.md) function to obtain the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface.</span></span>
2.  <span data-ttu-id="58b58-109">Mantenga la interfaz [**IConnectionBrokerClient**](iconnectionbrokerclient.md) siempre que la necesite.</span><span class="sxs-lookup"><span data-stu-id="58b58-109">Keep the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface as long as you need it.</span></span>
3.  <span data-ttu-id="58b58-110">Cuando ya no se necesite la interfaz [**IConnectionBrokerClient**](iconnectionbrokerclient.md) , llame al método [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) .</span><span class="sxs-lookup"><span data-stu-id="58b58-110">When the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface is no longer needed, call the [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) method.</span></span>

### <a name="step-2-request-the-target-information"></a><span data-ttu-id="58b58-111">Paso 2: solicitar la información de destino</span><span class="sxs-lookup"><span data-stu-id="58b58-111">Step 2: Request the target information</span></span>

<span data-ttu-id="58b58-112">Cuando el proveedor de protocolo reciba una solicitud de conexión entrante, realice los pasos siguientes para llamar al método [**IConnectionBrokerClient:: GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="58b58-112">When your protocol provider receives an incoming connection request, perform the following steps to call the [**IConnectionBrokerClient::GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method.</span></span> <span data-ttu-id="58b58-113">Este método obtiene, del agente de conexión, el servidor adecuado al que se redirigirá la conexión.</span><span class="sxs-lookup"><span data-stu-id="58b58-113">This method obtains, from the Connection Broker, the appropriate server to redirect the connection to.</span></span>

1.  <span data-ttu-id="58b58-114">Cree un evento que se pueda señalizar mediante el [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), o una función similar, para usar para el parámetro *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="58b58-114">Create an event that can be signaled using the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), or similar function, to use for the *hStatusEvent* parameter.</span></span>
2.  <span data-ttu-id="58b58-115">Asigne memoria para los parámetros *pTargetInfo* y *pResult* .</span><span class="sxs-lookup"><span data-stu-id="58b58-115">Allocate memory for the *pTargetInfo* and *pResult* parameters.</span></span> <span data-ttu-id="58b58-116">Estos bloques de memoria deben permanecer vigentes hasta que se complete toda la secuencia.</span><span class="sxs-lookup"><span data-stu-id="58b58-116">These memory blocks must remain in place until after this entire sequence is complete.</span></span>
3.  <span data-ttu-id="58b58-117">Rellene una estructura de [**\_ \_ información de conexión CB**](cb-connection-info.md) que contenga toda la información sobre la conexión entrante.</span><span class="sxs-lookup"><span data-stu-id="58b58-117">Fill out a [**CB\_CONNECTION\_INFO**](cb-connection-info.md) structure that contains all of the information about the incoming connection.</span></span>
4.  <span data-ttu-id="58b58-118">Llame al método [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) y pase todos los parámetros necesarios.</span><span class="sxs-lookup"><span data-stu-id="58b58-118">Call the [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method, passing all of the required parameters.</span></span> <span data-ttu-id="58b58-119">Este es un método asincrónico que devolverá una instancia de la interfaz [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="58b58-119">This is an asynchronous method that will return an instance of the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
5.  <span data-ttu-id="58b58-120">Espere a que se establezca el evento *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="58b58-120">Wait for the *hStatusEvent* event to become set.</span></span>
6.  <span data-ttu-id="58b58-121">Siempre que se establezca el evento *hStatusEvent* , llame al método [**IConnectionBrokerRequest:: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) para determinar el estado de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="58b58-121">Whenever the *hStatusEvent* event is set, call the [**IConnectionBrokerRequest::CheckStatus**](iconnectionbrokerrequest-checkstatus.md) method to determine the status of the request.</span></span>
7.  <span data-ttu-id="58b58-122">Cuando [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) devuelve **la \_ solicitud de estado CB \_ \_ completada**, los parámetros *pTargetInfo* y *pResult* contendrán su información.</span><span class="sxs-lookup"><span data-stu-id="58b58-122">When [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) returns **CB\_STATUS\_REQUEST\_COMPLETED**, the *pTargetInfo* and *pResult* parameters will contain their information.</span></span> <span data-ttu-id="58b58-123">Puede salir del bucle de espera porque ya no se usará el parámetro *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="58b58-123">You can break out of the wait loop because the *hStatusEvent* parameter will no longer be used.</span></span>
8.  <span data-ttu-id="58b58-124">Utilice la información de la estructura de [**\_ \_ información del destino CB**](cb-target-info.md) representada por el parámetro *pTargetInfo* para determinar a dónde debe redirigirse la conexión entrante.</span><span class="sxs-lookup"><span data-stu-id="58b58-124">Use the information in the [**CB\_TARGET\_INFO**](cb-target-info.md) structure represented by the *pTargetInfo* parameter to determine where to redirect the incoming connection to.</span></span>
9.  <span data-ttu-id="58b58-125">Libere la interfaz [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="58b58-125">Release the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
10. <span data-ttu-id="58b58-126">Cierre el identificador de evento *hStatusEvent* o puede reutilizarlo para las solicitudes de conexión posteriores.</span><span class="sxs-lookup"><span data-stu-id="58b58-126">Close the *hStatusEvent* event handle, or you can reuse it for subsequent connection requests.</span></span>

 

 