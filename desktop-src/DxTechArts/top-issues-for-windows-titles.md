---
title: Principales problemas de los títulos de Windows
description: En este artículo se resaltan muchos de los problemas comunes que se han visto en los juegos de PC de la generación actual.
ms.assetid: 89b83473-1aa9-9a2d-8778-15cfb91cdea4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 547c977f7d8e4895ef73ba229a9012854a7c6d27
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105665861"
---
# <a name="top-issues-for-windows-titles"></a><span data-ttu-id="8459b-103">Principales problemas de los títulos de Windows</span><span class="sxs-lookup"><span data-stu-id="8459b-103">Top Issues for Windows Titles</span></span>

<span data-ttu-id="8459b-104">El grupo de relaciones para desarrolladores de tecnologías de juegos y gráficos de Microsoft Windows realiza el análisis de rendimiento de muchos juegos de Windows cada año.</span><span class="sxs-lookup"><span data-stu-id="8459b-104">The Microsoft Windows Gaming and Graphics Technologies Developer Relations group performs performance analysis for many Windows games each year.</span></span> <span data-ttu-id="8459b-105">Durante estas sesiones, obtenemos experiencia práctica para relacionar los comentarios de los desarrolladores y las consultas que recibimos diariamente.</span><span class="sxs-lookup"><span data-stu-id="8459b-105">During these sessions, we get hands-on experience to tie into the developer feedback and queries we receive daily.</span></span> <span data-ttu-id="8459b-106">En ocasiones, le ayudamos a realizar un seguimiento de un bloqueo misterioso u otro problema en un título, que nos proporciona más información sobre los problemas que se encuentran en los desarrolladores.</span><span class="sxs-lookup"><span data-stu-id="8459b-106">Occasionally we help track down a mysterious crash or other problem in a title, which gives us further insight into problems that developers are encountering.</span></span>

<span data-ttu-id="8459b-107">En este artículo se resaltan muchos de los problemas comunes que se han visto en los juegos de PC de la generación actual.</span><span class="sxs-lookup"><span data-stu-id="8459b-107">This article highlights many of the common issues we've seen in current-generation PC games.</span></span>

-   [<span data-ttu-id="8459b-108">Rendimiento limitado por CPU</span><span class="sxs-lookup"><span data-stu-id="8459b-108">CPU-Limited Performance</span></span>](#cpu-limited-performance)
-   [<span data-ttu-id="8459b-109">Administración de lotes deficiente</span><span class="sxs-lookup"><span data-stu-id="8459b-109">Poor Batch Management</span></span>](#poor-batch-management)
-   [<span data-ttu-id="8459b-110">Copia excesiva de memoria</span><span class="sxs-lookup"><span data-stu-id="8459b-110">Excessive Memory Copying</span></span>](#excessive-memory-copying)
-   [<span data-ttu-id="8459b-111">Uso excesivo del envío dinámico de Draw</span><span class="sxs-lookup"><span data-stu-id="8459b-111">Excessive Use of Dynamic Draw Submission</span></span>](#excessive-use-of-dynamic-draw-submission)
-   [<span data-ttu-id="8459b-112">Gran sobrecarga en el procesamiento de archivos</span><span class="sxs-lookup"><span data-stu-id="8459b-112">High Overhead in File Processing</span></span>](#high-overhead-in-file-processing)
-   [<span data-ttu-id="8459b-113">Instalación lenta y frustrante</span><span class="sxs-lookup"><span data-stu-id="8459b-113">Slow and Frustrating Installation</span></span>](#slow-and-frustrating-installation)
-   [<span data-ttu-id="8459b-114">Falta de consideración de la memoria física</span><span class="sxs-lookup"><span data-stu-id="8459b-114">Lack of Consideration of Physical Memory</span></span>](#lack-of-consideration-of-physical-memory)
-   [<span data-ttu-id="8459b-115">Exceso de dependencia en la conversión de la frecuencia de muestreo de Real-Time audio</span><span class="sxs-lookup"><span data-stu-id="8459b-115">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>](#over-reliance-on-real-time-audio-sample-rate-conversion)
-   [<span data-ttu-id="8459b-116">Fragmentación de la memoria virtual</span><span class="sxs-lookup"><span data-stu-id="8459b-116">Fragmention of Virtual Memory</span></span>](#fragmention-of-virtual-memory)
-   [<span data-ttu-id="8459b-117">Manipulación de la palabra de control Floating-Point</span><span class="sxs-lookup"><span data-stu-id="8459b-117">Manipulation of the Floating-Point Control Word</span></span>](#manipulation-of-the-floating-point-control-word)
-   [<span data-ttu-id="8459b-118">Instalación opcional del tiempo de ejecución de DirectX</span><span class="sxs-lookup"><span data-stu-id="8459b-118">Optional Installation of the DirectX Runtime</span></span>](#optional-installation-of-the-directx-runtime)
-   [<span data-ttu-id="8459b-119">Uso excesivo de la sincronización de subprocesos</span><span class="sxs-lookup"><span data-stu-id="8459b-119">Excessive Use of Thread Synchronization</span></span>](#excessive-use-of-thread-synchronization)
-   [<span data-ttu-id="8459b-120">Uso de RDTSC</span><span class="sxs-lookup"><span data-stu-id="8459b-120">Use of RDTSC</span></span>](#use-of-rdtsc)

## <a name="cpu-limited-performance"></a><span data-ttu-id="8459b-121">Rendimiento de CPU-Limited</span><span class="sxs-lookup"><span data-stu-id="8459b-121">CPU-Limited Performance</span></span>

<span data-ttu-id="8459b-122">La gran mayoría de los juegos están limitados por el rendimiento de la CPU en sistemas con unidades de procesamiento de gráficos (GPU) de alto rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8459b-122">The vast majority of games are limited by CPU performance on systems with high-performance graphics processing units (GPUs).</span></span> <span data-ttu-id="8459b-123">En ocasiones, esto se debe a un uso deficiente del procesamiento por lotes para el envío de tablas, pero lo más habitual es que otros sistemas de juegos consuman una gran parte de los ciclos de CPU disponibles.</span><span class="sxs-lookup"><span data-stu-id="8459b-123">This is sometimes due to poor use of batching for draw submissions, but more typically, this is due to other game systems consuming a large portion of the available CPU cycles.</span></span> <span data-ttu-id="8459b-124">En los pocos casos en los que hemos detectado que la GPU es la limitación, la causa es una velocidad de relleno muy alta o una demanda del sombreador de píxeles, en la configuración de alta resolución o en el rendimiento del sombreador de vértices bajo una tarjeta de vídeo.</span><span class="sxs-lookup"><span data-stu-id="8459b-124">In the few cases in which we have seen the GPU as the limitation, the cause is very high fill rates or pixel shader demand, in high-resolution settings, or low vertex-shader performance by a video card.</span></span>

<span data-ttu-id="8459b-125">Dado que la mayoría de los títulos están limitados por la CPU, el mayor rendimiento gana de la optimización de los sistemas de juegos con un uso intensivo de la CPU.</span><span class="sxs-lookup"><span data-stu-id="8459b-125">Because most titles are CPU-limited, the biggest performance wins come from optimizing CPU-intensive game systems.</span></span> <span data-ttu-id="8459b-126">Normalmente, los sistemas de inteligencia artificial o de física y la lógica de detección de colisiones asociada son los consumidores principales de los ciclos de la CPU en las aplicaciones de Microsoft Direct3D.</span><span class="sxs-lookup"><span data-stu-id="8459b-126">Typically, the AI or physics systems and the associated collision-detection logic are the primary consumers of CPU cycles in well-behaving Microsoft Direct3D applications.</span></span> <span data-ttu-id="8459b-127">Cualquier trabajo para mejorar estos sistemas puede mejorar el rendimiento general del juego.</span><span class="sxs-lookup"><span data-stu-id="8459b-127">Any work to improve these systems can improve the overall performance of the game.</span></span>

## <a name="poor-batch-management"></a><span data-ttu-id="8459b-128">Administración de lotes deficiente</span><span class="sxs-lookup"><span data-stu-id="8459b-128">Poor Batch Management</span></span>

<span data-ttu-id="8459b-129">Para lograr un buen paralelismo con la GPU, es necesario que los lotes de Draw contengan una geometría suficiente, y que los sombreadores tengan la complejidad adecuada, para mantener la tarjeta de vídeo ocupada, aunque no se use el mismo número de lotes que el búfer de comandos esté inundado.</span><span class="sxs-lookup"><span data-stu-id="8459b-129">Achieving good parallelism with the GPU requires that draw batches contain enough geometry — and the shaders have the right complexity — to keep the video card busy, while not using so many batches that the command buffer is flooded.</span></span> <span data-ttu-id="8459b-130">En el hardware de generación actual, se recomiendan aproximadamente 300 o menos envíos de Draw batch por fotograma (menos en CPU de menor rendimiento) para evitar que el procesamiento del controlador del búfer de comandos se convierta en un cuello de botella de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8459b-130">On current-generation hardware, we recommend approximately 300 or fewer draw-batch submissions per frame (fewer on lower-performance CPUs) to prevent the driver's processing of the command-buffer from becoming a performance bottleneck.</span></span> <span data-ttu-id="8459b-131">Algunas otras llamadas de estado de API y combinaciones de controladores pueden dar lugar a un costo de procesamiento de la CPU (por ejemplo, la compilación de controladores de los sombreadores), por lo que se recomienda encarecidamente un análisis de rendimiento rutinario.</span><span class="sxs-lookup"><span data-stu-id="8459b-131">Some other API state calls and driver combinations can result in costly CPU processing (driver compiling of shaders, for example), so we highly recommend routine performance analysis.</span></span>

## <a name="excessive-memory-copying"></a><span data-ttu-id="8459b-132">Copia excesiva de memoria</span><span class="sxs-lookup"><span data-stu-id="8459b-132">Excessive Memory Copying</span></span>

<span data-ttu-id="8459b-133">Durante el desarrollo de la mayoría de los títulos de PC, los desarrolladores usan estructuras y cadenas de datos útiles para la administración de contenido.</span><span class="sxs-lookup"><span data-stu-id="8459b-133">During the development of most PC titles, developers use convenient data structures and strings for content management.</span></span> <span data-ttu-id="8459b-134">El trabajo de CPU necesario para la comparación de cadenas, la copia y otras manipulaciones a menudo tiene una sobrecarga mensurable, especialmente cuando se tienen en cuenta los resultados de rendimiento asociados a la memoria caché y al subsistema de memoria.</span><span class="sxs-lookup"><span data-stu-id="8459b-134">The CPU work required for string comparison, copying, and other manipulations often has a measurable overhead, particularly when taking into account the performance hits associated with the cache and memory subsystem.</span></span> <span data-ttu-id="8459b-135">Los planes deben realizarse al desarrollar estos sistemas para quitar o minimizar la dependencia del procesamiento de cadenas una vez que el producto entra en las fases principales de pruebas y versiones.</span><span class="sxs-lookup"><span data-stu-id="8459b-135">Plans should be made when developing these systems for removing or minimizing the reliance on string processing once the product enters into the primary testing and release phases.</span></span>

## <a name="excessive-use-of-dynamic-draw-submission"></a><span data-ttu-id="8459b-136">Uso excesivo del envío dinámico de Draw</span><span class="sxs-lookup"><span data-stu-id="8459b-136">Excessive Use of Dynamic Draw Submission</span></span>

<span data-ttu-id="8459b-137">El hardware de vídeo moderno funciona bien cuando se trabaja con datos estáticos.</span><span class="sxs-lookup"><span data-stu-id="8459b-137">Modern video hardware performs well when dealing with static data.</span></span> <span data-ttu-id="8459b-138">Los adaptadores de gama alta suelen tener una gran cantidad de memoria de vídeo, pero los datos dinámicos no pueden utilizar esta memoria de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="8459b-138">High-end adapters often have a very large amount of video memory, but this memory cannot be effectively utilized by dynamic data.</span></span>

<span data-ttu-id="8459b-139">Aunque se pueden implementar patrones de uso que sean razonablemente eficientes de búferes de vértices dinámicos o búferes de índice para el contenido dinámico, muchos títulos no sobrepasan esta expresión para lo que de otro modo es contenido estático.</span><span class="sxs-lookup"><span data-stu-id="8459b-139">While reasonably efficient usage patterns of dynamic vertex buffers/index buffers can be implemented for dynamic content, many titles overuse this idiom for what is otherwise static content.</span></span> <span data-ttu-id="8459b-140">Lo más frecuente es que esto se vea con árboles de particiones de espacio binario (BSP) y sistemas basados en el portal que almacenan geometría en una estructura de datos que no se asigna al hardware y se deben procesar en búferes para cada fotograma.</span><span class="sxs-lookup"><span data-stu-id="8459b-140">We most often see this with binary space partitioning (BSP) trees and portal-based systems that store geometry in a data structure that does not map to the hardware and must be processed into buffers for every frame.</span></span> <span data-ttu-id="8459b-141">Poner todo el contenido en los recursos estáticos como sea posible puede reducir en gran medida la sobrecarga de ancho de banda que supone la transferencia de datos a la tarjeta de vídeo, hacer un mejor uso de VRAM incorporada y reducir la sobrecarga de CPU/caché que conlleva el procesamiento de este contenido.</span><span class="sxs-lookup"><span data-stu-id="8459b-141">Putting as much content into static resources as possible can greatly reduce the bandwidth overhead of transferring data to the video card, make better use of on-board VRAM, and reduce the CPU/cache overhead involved in processing this content.</span></span>

## <a name="high-overhead-in-file-processing"></a><span data-ttu-id="8459b-142">Gran sobrecarga en el procesamiento de archivos</span><span class="sxs-lookup"><span data-stu-id="8459b-142">High Overhead in File Processing</span></span>

<span data-ttu-id="8459b-143">Los juegos de PC han obtenido la reputación de tiempos de carga prolongados, en particular cuando se comparan con los títulos de la consola con requisitos estrictos en tiempo de carga.</span><span class="sxs-lookup"><span data-stu-id="8459b-143">PC games have gotten a reputation for long loading times, particular when compared with console titles with strict loading-time requirements.</span></span> <span data-ttu-id="8459b-144">Nuestro análisis de la forma en que muchos títulos hacen uso del subsistema de archivos revela algunos problemas comunes.</span><span class="sxs-lookup"><span data-stu-id="8459b-144">Our analysis of the way that many titles make use of the file subsystem reveals some common issues.</span></span>

<span data-ttu-id="8459b-145">La sobrecarga de abrir un archivo suele ser mucho mayor de lo que los desarrolladores esperan.</span><span class="sxs-lookup"><span data-stu-id="8459b-145">The overhead of opening a file is usually much higher than developers expect.</span></span> <span data-ttu-id="8459b-146">Con los escáneres de virus a petición en uso generalizado y la funcionalidad adicional de NTFS, la apertura de un archivo es una operación bastante costosa.</span><span class="sxs-lookup"><span data-stu-id="8459b-146">With on-demand virus scanners in widespread use, and the additional functionality of NTFS, opening a file is a fairly expensive operation.</span></span> <span data-ttu-id="8459b-147">Abrir muchos archivos al mismo tiempo o abrir y cerrar el mismo archivo repetidamente es, por lo tanto, un método pobre de tratar con la administración de archivos.</span><span class="sxs-lookup"><span data-stu-id="8459b-147">Opening many files at once or opening and closing the same file repeatedly is therefore a poor method of dealing with file management.</span></span> <span data-ttu-id="8459b-148">Algunos juegos han intentado mitigar este costo de rendimiento comprobando la existencia de un archivo antes de abrirlo.</span><span class="sxs-lookup"><span data-stu-id="8459b-148">Some games have attempted to mitigate this performance cost by testing for the existence of a file before opening it.</span></span> <span data-ttu-id="8459b-149">La realidad es que comprobar la existencia de un archivo en NTFS requiere abrir el archivo, por lo que realizar pruebas antes de abrir los resultados es pagar el costo dos veces.</span><span class="sxs-lookup"><span data-stu-id="8459b-149">The reality is that testing for the existence of a file on NTFS requires opening the file, so testing before opening results in paying the cost twice.</span></span>

<span data-ttu-id="8459b-150">Los juegos que permiten modificaciones de complementos, o mods, o que todavía incluyen scaffolding de desarrollo para comprobar los archivos de datos de invalidación, pueden tener retrasos significativos en la carga del juego debido a la comprobación de estos archivos, incluso cuando esos archivos no están presentes.</span><span class="sxs-lookup"><span data-stu-id="8459b-150">Games that allow add-on modifications, or mods, or that still include development scaffolding to check for override data files, can have significant delays in loading the game because of checking for these files, even when those files are not present.</span></span> <span data-ttu-id="8459b-151">Se recomienda que los juegos solo comprueben estos archivos cuando se ejecuten con un modificador de línea de comandos especial u otro indicador de modo, de modo que solo los usuarios que usan esta funcionalidad paguen realmente el costo de rendimiento de estas comprobaciones (a menudo amplias).</span><span class="sxs-lookup"><span data-stu-id="8459b-151">We recommend that games only check for these files when run with a special command-line switch, or other mode indicator, so that only those users who make use of this functionality actually pay the performance cost of these (often extensive) checks.</span></span>

<span data-ttu-id="8459b-152">Puede obtener un rendimiento adicional del sistema de archivos de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="8459b-152">Additional performance can be obtained from the file system by the following:</span></span>

-   <span data-ttu-id="8459b-153">Uso apropiado de la marca de archivo de sugerencias de sistema de archivos \_ \_ \_ acceso aleatorio y el \_ \_ examen secuencial del indicador de archivo \_</span><span class="sxs-lookup"><span data-stu-id="8459b-153">Appropriate use of the file system hints FILE\_FLAG\_RANDOM\_ACCESS and FILE\_FLAG\_SEQUENTIAL\_SCAN</span></span>
-   <span data-ttu-id="8459b-154">Cambiar el tamaño de los búferes para evitar una gran cantidad de llamadas a las API de lectura y escritura del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="8459b-154">Sizing buffers to avoid a large quantity of calls to the read/write APIs of the OS</span></span>
-   <span data-ttu-id="8459b-155">Obtener acceso a los archivos de forma asincrónica</span><span class="sxs-lookup"><span data-stu-id="8459b-155">Accessing files asynchronously</span></span>
-   <span data-ttu-id="8459b-156">Carga de subprocesos en segundo plano</span><span class="sxs-lookup"><span data-stu-id="8459b-156">Loading threads in the background</span></span>

<span data-ttu-id="8459b-157">También recomendamos encarecidamente convertir los datos sin conexión (en el momento de la compilación o la instalación) en lugar de basarse en la conversión cuando el juego se ejecuta por primera vez, ya que esto impone un importante impuesto de rendimiento para todos los usuarios.</span><span class="sxs-lookup"><span data-stu-id="8459b-157">We also strongly recommend converting data offline (at build or installation time) rather than relying on conversion when the game is first run, as doing so imposes a significant performance tax for every user.</span></span>

## <a name="slow-and-frustrating-installation"></a><span data-ttu-id="8459b-158">Instalación lenta y frustrante</span><span class="sxs-lookup"><span data-stu-id="8459b-158">Slow and Frustrating Installation</span></span>

<span data-ttu-id="8459b-159">Otro problema común que hemos visto es tiempos de instalación muy largos necesarios para muchos juegos de PC modernos.</span><span class="sxs-lookup"><span data-stu-id="8459b-159">Another common issue we've seen is very long installation times required for many modern PC games.</span></span> <span data-ttu-id="8459b-160">Los instaladores solicitan al usuario muchas veces, a veces simplemente para indicar al usuario, por ejemplo, "no necesita DirectX instalado".</span><span class="sxs-lookup"><span data-stu-id="8459b-160">The installers prompt the user many times, sometimes simply to tell the user, for example, "You do not need DirectX installed."</span></span> <span data-ttu-id="8459b-161">Por lo general, estos instaladores infractores requieren que el usuario seleccione **siguiente** o **Aceptar** muchas veces antes de que se inicie realmente la instalación del juego.</span><span class="sxs-lookup"><span data-stu-id="8459b-161">Generally, these offending installers require the user to select **Next** or **OK** many times before installation of the game actually begins.</span></span> <span data-ttu-id="8459b-162">Una vez que comience, hemos visto que algunos títulos tardan una hora o más antes de que el usuario obtenga la oportunidad de jugar.</span><span class="sxs-lookup"><span data-stu-id="8459b-162">Once it does begin, we've seen some titles take an hour or more before the user gets the opportunity to play the game.</span></span> <span data-ttu-id="8459b-163">Creemos que la primera hora de la experiencia de juego no debe ser la instalación.</span><span class="sxs-lookup"><span data-stu-id="8459b-163">We feel strongly that the first hour of game play experience should not be the installation.</span></span>

<span data-ttu-id="8459b-164">Se recomiendan varios enfoques para tratar con la instalación de.</span><span class="sxs-lookup"><span data-stu-id="8459b-164">We recommend a number of approaches for dealing with installation.</span></span> <span data-ttu-id="8459b-165">En primer lugar, mantenga los mensajes sencillos y como mínimo.</span><span class="sxs-lookup"><span data-stu-id="8459b-165">First, keep the prompts simple and to a minimum.</span></span> <span data-ttu-id="8459b-166">En segundo lugar, diseñe los datos del juego de modo que algunos o todos los archivos de datos se puedan usar directamente desde el disco de distribución, siempre que sea posible: las unidades de DVD modernas tienen un ancho de banda muy alto.</span><span class="sxs-lookup"><span data-stu-id="8459b-166">Second, architect your game data such that some or all the data files can be used directly from the distribution disk where possible — modern DVD drives have very high bandwidth.</span></span> <span data-ttu-id="8459b-167">En tercer lugar, considere la posibilidad de implementar la instalación a petición en sus títulos para reducir o eliminar el proceso de instalación y permitir a los usuarios entrar en el juego lo más rápido posible.</span><span class="sxs-lookup"><span data-stu-id="8459b-167">Third, consider implementing install-on-demand in your titles to reduce or eliminate the installation process and allow users to get into the game as quickly as possible.</span></span> <span data-ttu-id="8459b-168">(Para obtener más información sobre la instalación a petición, vea [instalación a petición para juegos](/windows/desktop/DxTechArts/install-on-demand-for-games)).</span><span class="sxs-lookup"><span data-stu-id="8459b-168">(For more information about installing on demand, see [Install-on-Demand for Games](/windows/desktop/DxTechArts/install-on-demand-for-games).)</span></span>

<span data-ttu-id="8459b-169">Para obtener más recomendaciones sobre la instalación de juegos, consulte [simplificar la instalación de juegos](/windows/desktop/DxTechArts/simplifying-game-installation).</span><span class="sxs-lookup"><span data-stu-id="8459b-169">For more recommendations about game installation, see [Simplifying Game Installation](/windows/desktop/DxTechArts/simplifying-game-installation).</span></span>

## <a name="lack-of-consideration-of-physical-memory"></a><span data-ttu-id="8459b-170">Falta de consideración de la memoria física</span><span class="sxs-lookup"><span data-stu-id="8459b-170">Lack of Consideration of Physical Memory</span></span>

<span data-ttu-id="8459b-171">Debido a la amplia variabilidad del hardware de PC en el mercado, los títulos suelen usar las pruebas de configuración ad hoc para seleccionar la configuración predeterminada para el nivel de detalle gráfico.</span><span class="sxs-lookup"><span data-stu-id="8459b-171">Because of the wide variability of PC hardware in the market, titles typically make use of ad hoc configuration tests to select default settings for the level of graphical detail.</span></span> <span data-ttu-id="8459b-172">Algunos de los títulos que hemos visto están usando el tamaño de la memoria de vídeo en estas pruebas, pero no se pueden poner en correlación con el tamaño de la memoria física.</span><span class="sxs-lookup"><span data-stu-id="8459b-172">Some of the titles we've seen are using video memory size in these tests, but failing to correlate this with physical memory size.</span></span> <span data-ttu-id="8459b-173">Con el fin de controlar las situaciones de dispositivo perdido, la mayor parte de la memoria de vídeo (tanto la VRAM local en la tarjeta como la abertura de memoria AGP no local) debe estar respaldada por la memoria física, ya sea mediante el uso de recursos administrados o estructuras de datos personalizadas.</span><span class="sxs-lookup"><span data-stu-id="8459b-173">In order to handle lost-device situations, the majority of the video memory (both local VRAM on the card and the non-local AGP memory aperture) must be backed by physical memory, either through the use of managed resources or custom data structures.</span></span> <span data-ttu-id="8459b-174">Algunas tarjetas de vídeo de gama alta tienen tamaños de VRAM que tienen un tamaño mayor que el de memorias de CPU de bajo nivel.</span><span class="sxs-lookup"><span data-stu-id="8459b-174">Some high-end video cards have VRAM sizes rivaling the size of low-end CPU memories.</span></span> <span data-ttu-id="8459b-175">En situaciones en las que el sistema tiene una memoria física limitada en comparación con la tarjeta de vídeo, la mayor parte de esa VRAM no se puede usar de forma eficaz y se debe configurar una configuración de detalle inferior.</span><span class="sxs-lookup"><span data-stu-id="8459b-175">In situations where the system has limited physical memory compared to the video card, most of that VRAM cannot be effectively utilized, and lower detail settings should be configured.</span></span>

## <a name="over-reliance-on-real-time-audio-sample-rate-conversion"></a><span data-ttu-id="8459b-176">Over-Reliance en Real-Time conversión de velocidad de muestra de audio</span><span class="sxs-lookup"><span data-stu-id="8459b-176">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>

<span data-ttu-id="8459b-177">Otro origen común de la grabación del ciclo de la CPU que hemos visto tiene lugar cuando se necesita el sistema de audio para convertir la velocidad de reproducción durante la combinación en el búfer de hardware.</span><span class="sxs-lookup"><span data-stu-id="8459b-177">Another common source of CPU cycle burn we've seen occurs when the audio system is required to convert the playback rate during mix into the hardware buffer.</span></span> <span data-ttu-id="8459b-178">Con los controladores de Modelo de controlador de Windows (WDM), el formato de búfer de hardware no está bajo el control de aplicaciones directo, ya que se trata de un recurso de nivel de kernel. en su lugar, se selecciona el formato en función del formato de mayor calidad de todos los orígenes y de las capacidades del hardware.</span><span class="sxs-lookup"><span data-stu-id="8459b-178">With Windows Driver Model (WDM) drivers, the hardware buffer format is not under direct application control, because it is a kernel-level resource; instead, the format is selected based on the highest-quality format of all sources and the capabilities of the hardware.</span></span> <span data-ttu-id="8459b-179">De forma predeterminada, Windows XP usa una conversión de velocidad de muestra de alta calidad para este proceso y, si la mayoría de las muestras de audio requiere una conversión de velocidad, se consumirá una parte significativa de los ciclos de la CPU.</span><span class="sxs-lookup"><span data-stu-id="8459b-179">By default, Windows XP uses a high-quality sample rate conversion for this process, and if the majority of the audio samples require a rate conversion, a significant portion of the CPU cycles will be consumed.</span></span>

<span data-ttu-id="8459b-180">Se recomienda crear todos los búferes de DirectSound con la misma velocidad de muestra.</span><span class="sxs-lookup"><span data-stu-id="8459b-180">We recommend creating all of your DirectSound buffers with the same sample rate.</span></span> <span data-ttu-id="8459b-181">Si realiza cualquier uso de las funciones de Microsoft Win32 **WaveOut** , debe usar también una velocidad de muestra coherente.</span><span class="sxs-lookup"><span data-stu-id="8459b-181">If you make any use of Microsoft Win32 **waveOut** functions, you should use a consistent sample rate with these, too.</span></span> <span data-ttu-id="8459b-182">Con los controladores WDM, el kernel combinará todos los búferes y, si usa una frecuencia de muestreo superior en algunos de ellos, se convertirán las velocidades de muestra de todo el resto para que coincidan.</span><span class="sxs-lookup"><span data-stu-id="8459b-182">With WDM drivers, the buffers will all be mixed by the kernel, and if you use a higher sampling rate on some of them, the sample rates of all of the rest will be converted to match.</span></span> <span data-ttu-id="8459b-183">Tenga en cuenta que esto implica el uso de la misma velocidad de reproducción para todas las muestras de audio, incluido cualquier búfer de descompresión de audio de streaming.</span><span class="sxs-lookup"><span data-stu-id="8459b-183">Note that this implies using the same playback rate for all your audio samples, including any streaming audio decompression buffers.</span></span> <span data-ttu-id="8459b-184">La configuración de la tasa de búfer principal no tiene ningún efecto a menos que el destino sea Windows 98 o Windows Millennium Edition.</span><span class="sxs-lookup"><span data-stu-id="8459b-184">Setting the primary buffer rate has no effect unless you are targeting either Windows 98 or Windows Millennium Edition.</span></span>

> [!Note]  
> <span data-ttu-id="8459b-185">En Windows Vista y versiones posteriores del sistema operativo, DirectSound y **WaveOut** usan la [API de sesión de audio de Windows (WASAPI)](/windows/desktop/CoreAudio/wasapi) para todas las salidas de audio.</span><span class="sxs-lookup"><span data-stu-id="8459b-185">On Windows Vista and later versions of the operating system, DirectSound and **waveOut** use the [Windows Audio Session API (WASAPI)](/windows/desktop/CoreAudio/wasapi) for all audio output.</span></span>

 

## <a name="fragmention-of-virtual-memory"></a><span data-ttu-id="8459b-186">Fragmentación de la memoria virtual</span><span class="sxs-lookup"><span data-stu-id="8459b-186">Fragmention of Virtual Memory</span></span>

<span data-ttu-id="8459b-187">Hemos visto varios problemas recientes relacionados con el límite de 32 bits en el espacio de memoria de proceso.</span><span class="sxs-lookup"><span data-stu-id="8459b-187">We've seen a number of recent issues related to the 32-bit limit on process memory space.</span></span> <span data-ttu-id="8459b-188">Aunque 2 GB de espacio de direcciones virtuales para los procesos de modo de usuario ha sido más adecuado históricamente, el mayor uso de archivos asignados a memoria de gran tamaño, asignadores de memoria personalizados y un aumento del tamaño de VRAM (que debe asignarse en el espacio de proceso) ha empezado a producir situaciones en las que se producen errores en las asignaciones de espacio de memoria virtual.</span><span class="sxs-lookup"><span data-stu-id="8459b-188">While 2 GB of virtual address space for user-mode processes has been more than adequate historically, the increased use of large memory-mapped files, custom memory allocators, and increasing VRAM size (which must be mapped into process space) has started to cause situations where allocations of virtual memory space are failing.</span></span> <span data-ttu-id="8459b-189">Algunos archivos DLL que no son de Microsoft usan ubicaciones de inicio fijo en medio del espacio de direcciones virtuales, lo que provoca la fragmentación que da como resultado asignaciones con errores.</span><span class="sxs-lookup"><span data-stu-id="8459b-189">Some non-Microsoft DLLs are using fixed-start locations in the middle of the virtual address space, which is causing fragmentation that results in failed allocations.</span></span>

<span data-ttu-id="8459b-190">Estos problemas suelen aparecer cuando el juego hace uso de un esquema de asignación de memoria personalizado que intenta asignar un gran fragmento continuo de espacio de memoria virtual.</span><span class="sxs-lookup"><span data-stu-id="8459b-190">These problems most often appear when the game makes use of a custom memory allocation scheme that attempts to allocate a large continuous chunk of virtual memory space.</span></span> <span data-ttu-id="8459b-191">Nuestra recomendación es escribir asignadores de modo que soliciten partes más razonables del espacio de direcciones virtuales según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="8459b-191">Our recommendation is to write allocators such that they request more reasonably sized portions of the virtual address space as needed.</span></span> <span data-ttu-id="8459b-192">Por ejemplo, al solicitar 64 o 256 MB a la vez, pero no 1 GB.</span><span class="sxs-lookup"><span data-stu-id="8459b-192">For example, requesting 64 or 256 MB at a time, but not 1 GB.</span></span> <span data-ttu-id="8459b-193">Sin embargo, se debe tener cuidado de no producir más fragmentación.</span><span class="sxs-lookup"><span data-stu-id="8459b-193">However, care should be taken to not cause further fragmentation.</span></span> <span data-ttu-id="8459b-194">La llegada de los sistemas operativos y el hardware de 64 bits ayudará en gran medida a estos problemas en el futuro, pero debe tener cuidado en los sistemas de 32 bits de generación actual.</span><span class="sxs-lookup"><span data-stu-id="8459b-194">The advent of 64-bit operating systems and hardware will greatly help these issues in the future, but care must be taken on current-generation 32-bit systems.</span></span>

## <a name="manipulation-of-the-floating-point-control-word"></a><span data-ttu-id="8459b-195">Manipulación de la palabra de control Floating-Point</span><span class="sxs-lookup"><span data-stu-id="8459b-195">Manipulation of the Floating-Point Control Word</span></span>

<span data-ttu-id="8459b-196">Como ayuda para la depuración, algunos desarrolladores han habilitado las excepciones en la unidad de punto flotante (FPU) a través de manipulaciones de la palabra de control de punto flotante.</span><span class="sxs-lookup"><span data-stu-id="8459b-196">As a debugging aid, some developers have been enabling exceptions on the floating-point unit (FPU) via manipulations of the floating-point control word.</span></span> <span data-ttu-id="8459b-197">Hacer esto es muy problemático y probablemente hará que se bloquee el proceso.</span><span class="sxs-lookup"><span data-stu-id="8459b-197">Doing this is highly problematic and will likely cause the process to crash.</span></span> <span data-ttu-id="8459b-198">Del mismo modo que la Convención de llamada requiere que se conserve el registro EBX, la mayoría del sistema asume que FPU está en un estado predeterminado, proporcionará resultados razonables y no generará excepciones.</span><span class="sxs-lookup"><span data-stu-id="8459b-198">Just like the calling convention requires that the ebx register be preserved, the majority of the system assumes that the FPU is in a default state, will give reasonable results, and won't generate exceptions.</span></span> <span data-ttu-id="8459b-199">Los controladores y otros componentes del sistema suelen calcular los resultados en función de la suposición de que los valores de error estándar aparecerán en los registros de condiciones incorrectas, pero si las excepciones están habilitadas, no se controlarán y se producirán bloqueos.</span><span class="sxs-lookup"><span data-stu-id="8459b-199">Drivers and other system components will often compute results based on the assumption that standard error values will appear in the registers for bad conditions, but if exceptions are enabled, these will go unhandled and result in crashes.</span></span>

<span data-ttu-id="8459b-200">Direct3D establecerá la unidad de punto flotante en una sola precisión y de un extremo a más cercano como parte de la inicialización para el subproceso que realiza la llamada, a menos que se use la marca de D3DCREATE FPU de la \_ \_ función preserve, en cuyo caso no se toca la palabra de control de punto flotante.</span><span class="sxs-lookup"><span data-stu-id="8459b-200">Direct3D will set the floating-point unit to single-precision, round-to-nearest as part of initialization for the calling thread, unless the D3DCREATE\_FPU\_PRESERVE flag is used, in which case, the floating-point control word is untouched.</span></span> <span data-ttu-id="8459b-201">Dado que la palabra de control es una configuración por subproceso, asegurarse de que todos los subprocesos de la aplicación estén establecidos en el modo de precisión sencilla puede optimizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8459b-201">Since the control word is a per-thread setting, ensuring that all of your application threads are set to single-precision mode may optimize performance.</span></span> <span data-ttu-id="8459b-202">Recuerde que la llamada a [**\_ control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) no es válida para la codificación x64-Native, que usa SSE exclusivamente en su lugar, y es muy costosa en la arquitectura basada en POWERPC de la CPU Xbox 360.</span><span class="sxs-lookup"><span data-stu-id="8459b-202">Remember that calling [**\_control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) is not valid for x64-native coding, which uses SSE exclusively instead, and it is extremely expensive on the PowerPC-based architecture of the Xbox 360 CPU.</span></span>

> [!Note]  
> <span data-ttu-id="8459b-203">Si modifica la palabra de control, use [**\_ controlfp \_ s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) y tenga en cuenta que para plataformas x64 no puede cambiar la precisión de punto flotante a través de la palabra de control.</span><span class="sxs-lookup"><span data-stu-id="8459b-203">If you modify the control word, use [**\_controlfp\_s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) and be aware that for x64 platforms you can't change the floating-point precision via the control word.</span></span>

 

<span data-ttu-id="8459b-204">En cualquier biblioteca en la que sea necesario tener diferentes reglas de redondeo u otro comportamiento, como el tratamiento de los sombreadores de vértices de software o la compilación, se guarda y se restaura la palabra de control.</span><span class="sxs-lookup"><span data-stu-id="8459b-204">In any libraries where we need to have different rounding rules or other behavior — such as dealing with software vertex shaders or compilation — we save and restore the control word.</span></span> <span data-ttu-id="8459b-205">Si un juego necesita usar excepciones de redondeo o de FPU no estándar, debe guardar y restaurar la palabra de control de punto flotante, y debe asegurarse de que no llama a ningún código externo que no se haya demostrado que sea seguro de estos problemas, incluidas las API del sistema.</span><span class="sxs-lookup"><span data-stu-id="8459b-205">If a game needs to make use of non-standard rounding or FPU exceptions, it should save and restore the floating-point control word, and you should be sure that it does not call any external code that has not been proven to be safe from these problems, including system APIs.</span></span>

## <a name="optional-installation-of-the-directx-runtime"></a><span data-ttu-id="8459b-206">Instalación opcional del tiempo de ejecución de DirectX</span><span class="sxs-lookup"><span data-stu-id="8459b-206">Optional Installation of the DirectX Runtime</span></span>

<span data-ttu-id="8459b-207">Una serie de juegos pregunte al usuario si desea instalar DirectX.</span><span class="sxs-lookup"><span data-stu-id="8459b-207">A number of games ask the user whether to install DirectX.</span></span> <span data-ttu-id="8459b-208">Esto puede causar problemas si el usuario asume que el sistema tiene la versión más reciente de DirectX redistribuible instalada, omite la instalación y, posteriormente, la instalación continúa correctamente.</span><span class="sxs-lookup"><span data-stu-id="8459b-208">This can cause problems if the user assumes that the system has the latest DirectX redistributable installed and skips installation, and subsequently, the installation continues successfully.</span></span> <span data-ttu-id="8459b-209">Si el juego requiere una versión específica de D3DX, u otra funcionalidad actualizada que no se haya instalado, el juego no funcionará y el usuario se verá muy frustrado.</span><span class="sxs-lookup"><span data-stu-id="8459b-209">If the game requires a specific version of D3DX, or other updated functionality that was not installed, then the game won't work, and the user will get very frustrated.</span></span>

<span data-ttu-id="8459b-210">Se recomienda encarecidamente que el instalador del juego Instale de forma silenciosa el paquete redistribuible de DirectX con el que se compiló el juego.</span><span class="sxs-lookup"><span data-stu-id="8459b-210">It is strongly recommended that the game's installer silently install the DirectX redistributable that the game was built against.</span></span> <span data-ttu-id="8459b-211">El proceso de instalación de DirectX está diseñado de modo que compruebe si es necesario actualizar algo y devuelve rápidamente si no lo hace.</span><span class="sxs-lookup"><span data-stu-id="8459b-211">The DirectX installation process is designed so that it verifies whether anything needs to be updated and quickly returns if it doesn't.</span></span> <span data-ttu-id="8459b-212">Por lo tanto, no es necesario preguntar al usuario sobre la instalación de DirectX.</span><span class="sxs-lookup"><span data-stu-id="8459b-212">So, there is no need to ask the user about installing DirectX.</span></span>

<span data-ttu-id="8459b-213">Para realizar una instalación silenciosa de DirectX, ejecute este comando desde el paquete de instalación: **dxsetup.exe/Silent**</span><span class="sxs-lookup"><span data-stu-id="8459b-213">A silent installation of DirectX can be done by running this command from your installation package: **dxsetup.exe /silent**</span></span>

<span data-ttu-id="8459b-214">Además, el tamaño real de la carpeta redistribuible se puede configurar para incluir solo los archivos. cab que realmente se necesitan para las plataformas de destino y el uso del juego.</span><span class="sxs-lookup"><span data-stu-id="8459b-214">Furthermore, the actual size of the redistributable folder can be configured to include only those cabinet files (.cab) that are actually needed for the game's target platforms and usage.</span></span>

> [!Note]  
> <span data-ttu-id="8459b-215">Antes de usar **DxSetup**, lea [no para la configuración directa](https://walbourn.github.io/).</span><span class="sxs-lookup"><span data-stu-id="8459b-215">Before you use **dxsetup**, read [Not So Direct Setup](https://walbourn.github.io/).</span></span>

 

## <a name="excessive-use-of-thread-synchronization"></a><span data-ttu-id="8459b-216">Uso excesivo de la sincronización de subprocesos</span><span class="sxs-lookup"><span data-stu-id="8459b-216">Excessive Use of Thread Synchronization</span></span>

<span data-ttu-id="8459b-217">Al generar perfiles de juegos, a menudo se encuentran las zonas activas principales relacionadas con la entrada y la salida de secciones críticas.</span><span class="sxs-lookup"><span data-stu-id="8459b-217">When profiling games, the top hotspots are often found to be related to entering and leaving critical sections.</span></span> <span data-ttu-id="8459b-218">Con la prevalencia de CPU de varios núcleos, el uso de multithreading en los juegos ha aumentado drásticamente y muchas implementaciones se basan en el uso intensivo de la sincronización de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="8459b-218">With the prevalence of multi-core CPUs, the use of multithreading in games has increased dramatically, and many implementations rely on heavy use of thread synchronization.</span></span> <span data-ttu-id="8459b-219">El tiempo de CPU para tomar una sección crítica incluso sin contención es bastante significativo y todas las demás formas de sincronización de subprocesos son incluso más costosas.</span><span class="sxs-lookup"><span data-stu-id="8459b-219">The CPU time to take a critical section even without any contention is quite significant, and all other forms of thread synchronization are even more expensive.</span></span> <span data-ttu-id="8459b-220">Por lo tanto, debe tener cuidado para minimizar el uso de estas primitivas.</span><span class="sxs-lookup"><span data-stu-id="8459b-220">So, care must be taken to minimize the use of these primitives.</span></span>

<span data-ttu-id="8459b-221">Un origen común de la sincronización excesiva en los juegos es el uso de [D3DCREATE \_ multiproceso](/windows/desktop/direct3d9/d3dcreate).</span><span class="sxs-lookup"><span data-stu-id="8459b-221">A common source of excessive synchronization in games is the use of [D3DCREATE\_MULTITHREADED](/windows/desktop/direct3d9/d3dcreate).</span></span> <span data-ttu-id="8459b-222">Esta marca, a la vez que se hace seguro para subprocesos de Direct3D para la representación desde varios subprocesos, toma un enfoque muy conservador, lo que produce una sobrecarga de sincronización alta.</span><span class="sxs-lookup"><span data-stu-id="8459b-222">This flag, while making Direct3D thread-safe for rendering from multiple threads, takes a very conservative approach, resulting in high synchronization overhead.</span></span> <span data-ttu-id="8459b-223">Los juegos deben evitar esta marca.</span><span class="sxs-lookup"><span data-stu-id="8459b-223">Games should avoid this flag.</span></span> <span data-ttu-id="8459b-224">En su lugar, diseñe el motor para que toda la comunicación con Direct3D sea de un solo subproceso y cualquier comunicación entre subprocesos se controle directamente.</span><span class="sxs-lookup"><span data-stu-id="8459b-224">Instead, architect the engine so that all communication with Direct3D is from a single thread and any communication between threads is handled directly.</span></span> <span data-ttu-id="8459b-225">Para obtener más información sobre el diseño de juegos multiproceso, consulte el artículo [codificación de varios núcleos en Xbox 360 y Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span><span class="sxs-lookup"><span data-stu-id="8459b-225">For more information about designing multi-threaded games, see the article [Coding For Multiple Cores on Xbox 360 and Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span></span>

## <a name="use-of-rdtsc"></a><span data-ttu-id="8459b-226">Uso de RDTSC</span><span class="sxs-lookup"><span data-stu-id="8459b-226">Use of RDTSC</span></span>

<span data-ttu-id="8459b-227">No se recomienda el uso de la instrucción **RDTSC** de x86.</span><span class="sxs-lookup"><span data-stu-id="8459b-227">Use of the x86 instruction **RDTSC** is not recommended.</span></span> <span data-ttu-id="8459b-228">**RDTSC** no puede calcular correctamente el tiempo en algunos esquemas de administración de energía que cambian la frecuencia de la CPU de forma dinámica y en muchas CPU de varios núcleos para los que el contador de ciclo no está sincronizado entre núcleos.</span><span class="sxs-lookup"><span data-stu-id="8459b-228">**RDTSC** fails to correctly compute timing on some power management schemes that change the CPU frequency dynamically and on many multi-core CPUs for which the cycle counter is not synchronized between cores.</span></span> <span data-ttu-id="8459b-229">En su lugar, los juegos deben usar la API de [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="8459b-229">Games should instead use the [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="8459b-230">Para obtener más información acerca de los problemas de **RDTSC** e implementación de tiempos de alta resolución con **QueryPerformanceCounter**, consulte el artículo sobre el [control de tiempo y los procesadores de varios núcleos](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span><span class="sxs-lookup"><span data-stu-id="8459b-230">For more information about issues with **RDTSC** and implementing high-resolution timing with **QueryPerformanceCounter**, see the article [Game Timing and Multicore Processors](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span></span>

 

 