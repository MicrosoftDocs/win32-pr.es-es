---
description: Un token restringido es un token de acceso principal o de suplantación modificado por la función CreateRestrictedToken.
ms.assetid: 06580ab9-ff58-4aa9-bf88-9536a2e1981d
title: Tokens restringidos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fee8e6c89915e3edd0a9206f84a0d3d5697a3cb9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104154757"
---
# <a name="restricted-tokens"></a><span data-ttu-id="e6430-103">Tokens restringidos</span><span class="sxs-lookup"><span data-stu-id="e6430-103">Restricted Tokens</span></span>

<span data-ttu-id="e6430-104">Un token restringido es un [*token de acceso*](/windows/desktop/SecGloss/a-gly) [*principal*](/windows/desktop/SecGloss/p-gly) o de suplantación modificado por la función [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) .</span><span class="sxs-lookup"><span data-stu-id="e6430-104">A restricted token is a [*primary*](/windows/desktop/SecGloss/p-gly) or impersonation [*access token*](/windows/desktop/SecGloss/a-gly) that has been modified by the [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) function.</span></span> <span data-ttu-id="e6430-105">Un [*proceso*](/windows/desktop/SecGloss/p-gly) o subproceso de suplantación que se ejecuta en el [*contexto de seguridad*](/windows/desktop/SecGloss/s-gly) de un token restringido está restringido en su capacidad de obtener acceso a objetos protegibles o realizar operaciones con privilegios.</span><span class="sxs-lookup"><span data-stu-id="e6430-105">A [*process*](/windows/desktop/SecGloss/p-gly) or impersonating thread running in the [*security context*](/windows/desktop/SecGloss/s-gly) of a restricted token is restricted in its ability to access securable objects or perform privileged operations.</span></span> <span data-ttu-id="e6430-106">La función **CreateRestrictedToken** puede restringir un token de las siguientes maneras:</span><span class="sxs-lookup"><span data-stu-id="e6430-106">The **CreateRestrictedToken** function can restrict a token in the following ways:</span></span>

-   <span data-ttu-id="e6430-107">Quite los [privilegios](privileges.md) del token.</span><span class="sxs-lookup"><span data-stu-id="e6430-107">Remove [privileges](privileges.md) from the token.</span></span>
-   <span data-ttu-id="e6430-108">Aplique el atributo de solo denegación a los SID en el token para que no se puedan usar para tener acceso a los objetos protegidos.</span><span class="sxs-lookup"><span data-stu-id="e6430-108">Apply the deny-only attribute to SIDs in the token so that they cannot be used to access secured objects.</span></span> <span data-ttu-id="e6430-109">Para obtener más información sobre el atributo de solo denegación, vea [atributos SID en un token de acceso](sid-attributes-in-an-access-token.md).</span><span class="sxs-lookup"><span data-stu-id="e6430-109">For more information about the deny-only attribute, see [SID Attributes in an Access Token](sid-attributes-in-an-access-token.md).</span></span>
-   <span data-ttu-id="e6430-110">Especifique una lista de SID restrictivos, que puede limitar el acceso a los objetos protegibles.</span><span class="sxs-lookup"><span data-stu-id="e6430-110">Specify a list of restricting SIDs, which can limit access to securable objects.</span></span>

<span data-ttu-id="e6430-111">El sistema utiliza la lista de restricciones de SID cuando comprueba el acceso del token a un objeto protegible.</span><span class="sxs-lookup"><span data-stu-id="e6430-111">The system uses the list of restricting SIDs when it checks the token's access to a securable object.</span></span> <span data-ttu-id="e6430-112">Cuando un proceso o subproceso restringido intenta tener acceso a un objeto protegible, el sistema realiza dos comprobaciones de acceso: una con los SID habilitados del token y otra mediante la lista de SID restrictivos.</span><span class="sxs-lookup"><span data-stu-id="e6430-112">When a restricted process or thread tries to access a securable object, the system performs two access checks: one using the token's enabled SIDs, and another using the list of restricting SIDs.</span></span> <span data-ttu-id="e6430-113">El acceso se concede solo si ambas comprobaciones de acceso permiten los derechos de acceso solicitados.</span><span class="sxs-lookup"><span data-stu-id="e6430-113">Access is granted only if both access checks allow the requested access rights.</span></span> <span data-ttu-id="e6430-114">Para obtener más información sobre las comprobaciones de acceso, vea [cómo los DACL controlan el acceso a un objeto](how-dacls-control-access-to-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="e6430-114">For more information about access checks, see [How DACLs Control Access to an Object](how-dacls-control-access-to-an-object.md).</span></span>

<span data-ttu-id="e6430-115">Puede usar un [*token primario*](/windows/desktop/SecGloss/p-gly) restringido en una llamada a la función [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) .</span><span class="sxs-lookup"><span data-stu-id="e6430-115">You can use a restricted [*primary token*](/windows/desktop/SecGloss/p-gly) in a call to the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function.</span></span> <span data-ttu-id="e6430-116">Normalmente, el proceso que llama a **CreateProcessAsUser** debe tener el \_ privilegio de nombre de ASSIGNPRIMARYTOKEN se \_ , que normalmente solo se mantiene en el código del sistema o en los servicios que se ejecutan en la cuenta LocalSystem.</span><span class="sxs-lookup"><span data-stu-id="e6430-116">Typically, the process that calls **CreateProcessAsUser** must have the SE\_ASSIGNPRIMARYTOKEN\_NAME privilege, which is usually held only by system code or by services running in the LocalSystem account.</span></span> <span data-ttu-id="e6430-117">Sin embargo, si la llamada de **CreateProcessAsUser** especifica una versión restringida del token principal del llamador, este privilegio no es necesario.</span><span class="sxs-lookup"><span data-stu-id="e6430-117">However, if the **CreateProcessAsUser** call specifies a restricted version of the caller's primary token, this privilege is not required.</span></span> <span data-ttu-id="e6430-118">Esto permite a las aplicaciones normales crear procesos restringidos.</span><span class="sxs-lookup"><span data-stu-id="e6430-118">This enables ordinary applications to create restricted processes.</span></span>

<span data-ttu-id="e6430-119">También puede usar un [*token de suplantación*](/windows/desktop/SecGloss/i-gly) Primary Primary o Primary en la función [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) .</span><span class="sxs-lookup"><span data-stu-id="e6430-119">You can also use a restricted primary or [*impersonation token*](/windows/desktop/SecGloss/i-gly) in the [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) function.</span></span>

<span data-ttu-id="e6430-120">Para determinar si un token tiene una lista de SID restrictivos, llame a la función [**IsTokenRestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) .</span><span class="sxs-lookup"><span data-stu-id="e6430-120">To determine whether a token has a list of restricting SIDs, call the [**IsTokenRestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) function.</span></span>

> [!Note]  
> <span data-ttu-id="e6430-121">Las aplicaciones que usan tokens restringidos deben ejecutar la aplicación restringida en equipos de escritorio distintos del escritorio predeterminado.</span><span class="sxs-lookup"><span data-stu-id="e6430-121">Applications that use restricted tokens should run the restricted application on desktops other than the default desktop.</span></span> <span data-ttu-id="e6430-122">Esto es necesario para evitar un ataque por parte de una aplicación restringida, mediante **SendMessage** o **PostMessage**, en aplicaciones sin restricciones en el escritorio predeterminado.</span><span class="sxs-lookup"><span data-stu-id="e6430-122">This is necessary to prevent an attack by a restricted application, using **SendMessage** or **PostMessage**, to unrestricted applications on the default desktop.</span></span> <span data-ttu-id="e6430-123">Si es necesario, cambie entre equipos de escritorio para los fines de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="e6430-123">If necessary, switch between desktops for your application purposes.</span></span>

 

 

 
