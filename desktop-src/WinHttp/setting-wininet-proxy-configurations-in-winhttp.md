---
description: Es posible que las aplicaciones que portan desde WinINet a WinHTTP deban usar la misma configuración de AutoProxy que pueden recuperar en WinINet o Internet Explorer (IE).
ms.assetid: c3e867d8-9d67-4e6a-8551-1fa846e089ed
title: Establecer configuraciones de proxy WinINet en WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91306f6591e0aab0f96fa010ee2a83d3f32c8fb4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104003012"
---
# <a name="setting-wininet-proxy-configurations-in-winhttp"></a><span data-ttu-id="b1ab2-103">Establecer configuraciones de proxy WinINet en WinHTTP</span><span class="sxs-lookup"><span data-stu-id="b1ab2-103">Setting WinINet Proxy Configurations in WinHTTP</span></span>

## <a name="setting-automatic-proxy-on-winhttp-51"></a><span data-ttu-id="b1ab2-104">Configuración de proxy automático en WinHTTP 5,1</span><span class="sxs-lookup"><span data-stu-id="b1ab2-104">Setting Automatic Proxy on WinHTTP 5.1</span></span>

<span data-ttu-id="b1ab2-105">Es posible que las aplicaciones que portan desde WinINet a WinHTTP deban usar la misma configuración de AutoProxy que pueden recuperar en WinINet o Internet Explorer (IE).</span><span class="sxs-lookup"><span data-stu-id="b1ab2-105">Applications that port from WinINet to WinHTTP may need to use the same autoproxy settings that they can retrieve under WinINet or Internet Explorer (IE).</span></span> <span data-ttu-id="b1ab2-106">La API de la versión 5,1 de WinHTTP puede recuperar y usar esta configuración de proxy.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-106">The WinHTTP version 5.1 API can retrieve and use these proxy settings.</span></span> <span data-ttu-id="b1ab2-107">En general, WinHTTP especifica el proxy y los servidores de derivación de proxy por sesión cuando se crea la sesión.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-107">In general, WinHTTP specifies the proxy and proxy bypass servers on a per-session basis when the session is created.</span></span> <span data-ttu-id="b1ab2-108">Esta configuración se puede invalidar en función de cada solicitud.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-108">These settings can be overridden on a per-request basis.</span></span>

<span data-ttu-id="b1ab2-109">Para usar la misma configuración de proxy que WinINet o IE, el cliente WinHTTP debe establecer la configuración de proxy para la sesión.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-109">To use the same proxy configuration as WinINet or IE, the WinHTTP client should set proxy settings for the session.</span></span> <span data-ttu-id="b1ab2-110">Además, si IE o WinINet están configurados para usar la detección automática de proxy web (WPAD), el cliente de WinHTTP que utiliza esa configuración debe establecer la configuración de proxy por solicitud.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-110">In addition, if IE or WinINet are configured to use Web Proxy Auto-Discovery (WPAD), the WinHTTP client that uses those settings must set proxy settings on a per-request basis.</span></span> <span data-ttu-id="b1ab2-111">En las secciones siguientes se describe cómo especificar la configuración de proxy para una sesión y una solicitud:</span><span class="sxs-lookup"><span data-stu-id="b1ab2-111">The following sections describe how to specify the proxy settings for a session and a request:</span></span>

-   [<span data-ttu-id="b1ab2-112">Establecimiento de la configuración de proxy en una sesión</span><span class="sxs-lookup"><span data-stu-id="b1ab2-112">Setting the Proxy Configuration on a Session</span></span>](#setting-the-proxy-configuration-on-a-session)
-   [<span data-ttu-id="b1ab2-113">Establecimiento de la configuración de proxy en una única solicitud</span><span class="sxs-lookup"><span data-stu-id="b1ab2-113">Setting the Proxy Configuration on a Single Request</span></span>](#setting-the-proxy-configuration-on-a-single-request)

## <a name="setting-the-proxy-configuration-on-a-session"></a><span data-ttu-id="b1ab2-114">Establecimiento de la configuración de proxy en una sesión</span><span class="sxs-lookup"><span data-stu-id="b1ab2-114">Setting the Proxy Configuration on a Session</span></span>

## <a name="the-application-is-running-on-a-user-account"></a><span data-ttu-id="b1ab2-115">La aplicación se ejecuta en una cuenta de usuario</span><span class="sxs-lookup"><span data-stu-id="b1ab2-115">The Application is Running on a User Account</span></span>

<span data-ttu-id="b1ab2-116">Antes de crear una sesión, la aplicación llama a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) para obtener la configuración del proxy de Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-116">Before a session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to get the IE proxy settings.</span></span> <span data-ttu-id="b1ab2-117">La aplicación debe ejecutarse como una cuenta de usuario para obtener esta configuración.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-117">The application must be running as a user account to obtain these settings.</span></span> <span data-ttu-id="b1ab2-118">El *parámetro pProxyConfig* es un puntero a una estructura de configuración del [**\_ proxy de \_ IE del usuario \_ \_ \_ actual de WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) que contiene los servidores de nombre de proxy (*lpszProxy*) y de omisión de proxy (*lpszProxyBypass*).</span><span class="sxs-lookup"><span data-stu-id="b1ab2-118">The *pProxyConfig* parameter is a pointer to a [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the proxy name (*lpszProxy*) and proxy bypass (*lpszProxyBypass*) servers.</span></span> <span data-ttu-id="b1ab2-119">El nombre del proxy y los valores de omisión del proxy de la estructura de **configuración del proxy de \_ \_ IE del usuario \_ \_ \_ actual** se utilizan para inicializar la sesión de winhttp.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-119">The proxy name and proxy bypass values of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure are then used to initialize the WinHTTP session.</span></span> <span data-ttu-id="b1ab2-120">La sesión se inicializa llamando a [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) con los parámetros *pwszProxyName* y *PwszProxyBypass* obtenidos de los miembros **lpszProxy** y **lpszProxyBypass** de la estructura **de \_ \_ configuración del \_ \_ proxy de \_ IE del usuario actual de WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-120">The session is initialized by calling [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the *pwszProxyName* and *pwszProxyBypass* parameters obtained from the **lpszProxy** and **lpszProxyBypass** members of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span>

## <a name="the-application-is-running-as-a-service"></a><span data-ttu-id="b1ab2-121">La aplicación se ejecuta como un servicio</span><span class="sxs-lookup"><span data-stu-id="b1ab2-121">The Application is Running as a Service</span></span>

<span data-ttu-id="b1ab2-122">La aplicación debe asegurarse de que la configuración del registro para un usuario individual se carga en el registro antes de llamar a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="b1ab2-122">The application must ensure that the registry settings for an individual user are loaded into the registry before calling [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="b1ab2-123">Si esta configuración no se carga en el registro, **WinHttpGetIEProxyConfigForCurrentUser** no puede obtener la configuración del proxy.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-123">If these settings are not loaded into the registry, **WinHttpGetIEProxyConfigForCurrentUser** cannot obtain the proxy settings.</span></span> <span data-ttu-id="b1ab2-124">La configuración del registro para un usuario individual se puede cargar en el registro mediante una llamada a la función **LoadUserProfile** .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-124">Registry settings for an individual user can be loaded into the registry by calling the **LoadUserProfile** function.</span></span> <span data-ttu-id="b1ab2-125">Si la carga de la configuración del registro del usuario no es una opción, la aplicación puede llamar a [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) con el **\_ \_ \_ \_ proxy predeterminado de tipo de acceso de WinHTTP** especificado en el parámetro *dwAcessType* .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-125">If loading the user's registry settings is not an option, the application can call [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the **WINHTTP\_ACCESS\_TYPE\_DEFAULT\_PROXY** specified in the *dwAcessType* parameter.</span></span> <span data-ttu-id="b1ab2-126">Al especificar el proxy predeterminado en la llamada a **WinHttpOpen** se indica a la API de WinHTTP que recupere el conjunto de configuración de proxy mediante la utilidad WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-126">Specifying the default proxy in the call to **WinHttpOpen** tells the WinHTTP API to retrieve the proxy configuration set by using the WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) utility.</span></span> <span data-ttu-id="b1ab2-127">Una vez cargados los valores del registro para un usuario individual, la aplicación sigue los pasos descritos en [la aplicación se está ejecutando en una cuenta de usuario](#the-application-is-running-on-a-user-account) para establecer el nombre del proxy y los servidores de omisión del proxy.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-127">After the registry settings for an individual user have been loaded, the application follows the steps outlined under [The application is running on a user account](#the-application-is-running-on-a-user-account) to set the proxy name and proxy bypass servers.</span></span>

## <a name="setting-the-proxy-configuration-on-a-single-request"></a><span data-ttu-id="b1ab2-128">Establecimiento de la configuración de proxy en una única solicitud</span><span class="sxs-lookup"><span data-stu-id="b1ab2-128">Setting the Proxy Configuration on a Single Request</span></span>

<span data-ttu-id="b1ab2-129">Antes de crear la sesión, la aplicación llama a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) para determinar si WinInet e IE están configurados para usar WPAD.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-129">Before the session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to determine if WinINet and IE are configured to use WPAD.</span></span> <span data-ttu-id="b1ab2-130">**WinHttpGetIEProxyConfigForCurrentUser** devuelve la estructura de [**configuración del proxy de \_ \_ IE del usuario \_ \_ \_ actual de WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) que contiene el miembro **fAutoDetect** .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-130">**WinHttpGetIEProxyConfigForCurrentUser** returns the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the **fAutoDetect** member.</span></span> <span data-ttu-id="b1ab2-131">Un valor de **true** para este miembro indica que se utiliza wpad y el miembro **lpszAutoConfigUrl** contiene la dirección URL de WPAD.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-131">A value of **TRUE** for this member indicates that WPAD is used, and the **lpszAutoConfigUrl** member contains the WPAD URL.</span></span>

## <a name="automatic-proxy-configuration-is-used"></a><span data-ttu-id="b1ab2-132">Se usa la configuración automática del proxy</span><span class="sxs-lookup"><span data-stu-id="b1ab2-132">Automatic Proxy Configuration Is Used</span></span>

<span data-ttu-id="b1ab2-133">Si se usa WPAD, la aplicación llama a [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) para recuperar el proxy de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-133">If WPAD is used, the application calls [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) to retrieve the proxy for the request.</span></span> <span data-ttu-id="b1ab2-134">El parámetro *lpwszUrl* contiene la dirección URL a la que se envía la solicitud y el parámetro *pAutoProxyOptions* contiene un puntero a la estructura ([**\_ \_ Opciones de AutoProxy de WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) que contiene las opciones de AutoProxy.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-134">The *lpwszUrl* parameter contains the URL that the request is being sent to, and the *pAutoProxyOptions* parameter contains a pointer to the structure ([**WINHTTP\_AUTOPROXY\_OPTIONS**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) that contains the autoproxy options.</span></span> <span data-ttu-id="b1ab2-135">La aplicación inicializa la estructura **de \_ \_ Opciones de AutoProxy WinHTTP** con la configuración devuelta por la estructura de configuración del [**proxy de \_ \_ IE del usuario \_ \_ \_ actual de WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) en la llamada a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="b1ab2-135">The application initializes the **WINHTTP\_AUTOPROXY\_OPTIONS** structure with the settings returned from the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure in the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="b1ab2-136">La marca de **\_ \_ \_ dirección URL** de configuración de proxy automático WinHTTP se especifica en el miembro **dwFlags** de la estructura de **Opciones de \_ AUTOPROXY \_ WinHTTP** y el miembro **lpszAutoconfigUrl** contiene la dirección URL de configuración automática de proxy de la estructura de configuración del proxy de **IE del \_ \_ usuario \_ \_ \_ actual** .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-136">The **WINHTTP\_AUTOPROXY\_CONFIG\_URL** flag is specified in the **dwFlags** member of the **WINHTTP\_AUTOPROXY\_OPTIONS** structure, and the **lpszAutoconfigUrl** member contains the proxy auto-configuration URL from the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span> <span data-ttu-id="b1ab2-137">La función **WinHttpGetProxyForUrl** devuelve el nombre del proxy y la lista de omisión de proxy en los miembros **lpszProxy** y **lpszProxyBypass** de la estructura de [**\_ \_ información del proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-137">The **WinHttpGetProxyForUrl** function returns the proxy name and the proxy bypass list in the **lpszProxy** and **lpszProxyBypass** members of the [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure.</span></span>

<span data-ttu-id="b1ab2-138">Una vez que el proxy de la solicitud se obtiene de [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), la aplicación crea la solicitud con [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="b1ab2-138">After the proxy for the request is obtained from [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), the application creates the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="b1ab2-139">A continuación, se llama a [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) para establecer el proxy para la solicitud mediante la especificación del identificador de solicitud en el parámetro *hInternet* .</span><span class="sxs-lookup"><span data-stu-id="b1ab2-139">Then [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) is called to set the proxy for the request by specifying the request handle in the *hInternet* parameter.</span></span> <span data-ttu-id="b1ab2-140">El parámetro *dwOption* de la llamada a **WinHttpSetOption** debe establecerse en el proxy de la **\_ opción \_ WinHTTP** y el parámetro *lpBuffer* es un puntero a una estructura de [**\_ \_ información del proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) que contiene el proxy y la omisión del proxy que se usará para la solicitud.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-140">The *dwOption* parameter in the call to **WinHttpSetOption** should be set to **WINHTTP\_OPTION\_PROXY** and the *lpBuffer* parameter is a pointer to a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains the proxy and proxy bypass to be used for the request.</span></span>

## <a name="automatic-proxy-configuration-is-not-used"></a><span data-ttu-id="b1ab2-141">No se utiliza la configuración automática del proxy</span><span class="sxs-lookup"><span data-stu-id="b1ab2-141">Automatic Proxy Configuration Is Not Used</span></span>

<span data-ttu-id="b1ab2-142">Si la llamada a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indica que no se utiliza AutoProxy, la aplicación puede simplemente crear la solicitud con [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="b1ab2-142">If the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indicates that autoproxy is not used, the application can simply create the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="b1ab2-143">La configuración del proxy es la misma para toda la sesión y no se necesitan cambios por solicitud.</span><span class="sxs-lookup"><span data-stu-id="b1ab2-143">The proxy configuration is the same for the entire session, and per-request changes are not needed.</span></span>

 

 



