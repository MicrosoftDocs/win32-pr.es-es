---
description: Para crear una nueva consulta que recopile datos de rendimiento de un archivo de registro o de origen en tiempo real, llame a la función PdhOpenQuery. La función devuelve un identificador a la consulta que se utiliza en las siguientes llamadas de función de PDH.
ms.assetid: 6fd4716e-b163-47a3-b0cb-5f9599f8681f
title: Crear una consulta
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5a9d50ec52966529a3476a6d375606ba3d0b538b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104156528"
---
# <a name="creating-a-query"></a><span data-ttu-id="39bc9-104">Crear una consulta</span><span class="sxs-lookup"><span data-stu-id="39bc9-104">Creating a Query</span></span>

<span data-ttu-id="39bc9-105">Para crear una nueva consulta que recopile datos de rendimiento de un archivo de registro o de origen en tiempo real, llame a la función [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) .</span><span class="sxs-lookup"><span data-stu-id="39bc9-105">To create a new query that collects performance data from a real-time source or log file, call the [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) function.</span></span> <span data-ttu-id="39bc9-106">La función devuelve un identificador a la consulta que se utiliza en las siguientes llamadas de función de PDH.</span><span class="sxs-lookup"><span data-stu-id="39bc9-106">The function returns a handle to the query that you use in subsequent PDH function calls.</span></span>

<span data-ttu-id="39bc9-107">Después de crear la consulta, llame a la función [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) para cada contador que desee agregar a la consulta.</span><span class="sxs-lookup"><span data-stu-id="39bc9-107">After creating the query, call the [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) function for each counter that you want to add to the query.</span></span> <span data-ttu-id="39bc9-108">Puede usar uno de los métodos siguientes para proporcionar la ruta de acceso completa del contador.</span><span class="sxs-lookup"><span data-stu-id="39bc9-108">You can use one of the following methods to provide the fully qualified counter path.</span></span>

-   <span data-ttu-id="39bc9-109">Defina la ruta de acceso del contador como una cadena estática.</span><span class="sxs-lookup"><span data-stu-id="39bc9-109">Define the counter path as a static string.</span></span> <span data-ttu-id="39bc9-110">Use este método si siempre supervisa el mismo contador y si está familiarizado con la sintaxis correcta de una ruta de acceso de contador.</span><span class="sxs-lookup"><span data-stu-id="39bc9-110">Use this method if you always monitor the same counter, and if you are familiar with the correct syntax of a counter path.</span></span> <span data-ttu-id="39bc9-111">Para obtener información sobre la sintaxis correcta que se usa para especificar un contador, vea [especificar una ruta de acceso de contador](specifying-a-counter-path.md).</span><span class="sxs-lookup"><span data-stu-id="39bc9-111">For information on the correct syntax used to specify a counter, see [Specifying a Counter Path](specifying-a-counter-path.md).</span></span>
-   <span data-ttu-id="39bc9-112">Inicialice una estructura de [**\_ elementos de ruta de \_ acceso \_ de contador PDH**](/windows/desktop/api/Pdh/ns-pdh-pdh_counter_path_elements_a) con los nombres del equipo, el objeto, el contador y la instancia.</span><span class="sxs-lookup"><span data-stu-id="39bc9-112">Initialize a [**PDH\_COUNTER\_PATH\_ELEMENTS**](/windows/desktop/api/Pdh/ns-pdh-pdh_counter_path_elements_a) structure with the names of the computer, object, counter, and instance.</span></span> <span data-ttu-id="39bc9-113">Pase esta estructura a [**PdhMakeCounterPath**](/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha) , que devolverá una ruta de contador para los elementos especificados.</span><span class="sxs-lookup"><span data-stu-id="39bc9-113">Pass this structure to [**PdhMakeCounterPath**](/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha) which will return a counter path for the specified elements.</span></span>
-   <span data-ttu-id="39bc9-114">Especifique una ruta de acceso de contador que contenga caracteres comodín y llame a [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) para obtener una lista de nombres de contadores que coincidan con los caracteres comodín de la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="39bc9-114">Specify a counter path that contains wildcard characters and call [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to get a list of counter names that match the wildcard characters in the path.</span></span> <span data-ttu-id="39bc9-115">Examine la lista de nombres de contadores y agregue a la consulta los contadores que desee de esta lista.</span><span class="sxs-lookup"><span data-stu-id="39bc9-115">Scan through the list of counter names and add to the query the counters that you want from this list.</span></span>
-   <span data-ttu-id="39bc9-116">Llame a la función [**PdhBrowseCounters**](/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa) para mostrar un cuadro de diálogo que permita al usuario examinar y seleccionar los contadores de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="39bc9-116">Call the [**PdhBrowseCounters**](/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa) function to display a dialog box that lets the user browse and select performance counters.</span></span> <span data-ttu-id="39bc9-117">Para obtener más información, vea [examinar contadores](browsing-counters.md).</span><span class="sxs-lookup"><span data-stu-id="39bc9-117">For more information, see [Browsing Counters](browsing-counters.md).</span></span>

<span data-ttu-id="39bc9-118">Tenga en cuenta que si se especifica una instancia de contador que no existe, [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) no notifica una condición de error.</span><span class="sxs-lookup"><span data-stu-id="39bc9-118">Note that if a counter instance is specified that does not exist, [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) does not report an error condition.</span></span> <span data-ttu-id="39bc9-119">En su lugar, devuelve el ERROR \_ Success.</span><span class="sxs-lookup"><span data-stu-id="39bc9-119">Instead, it returns ERROR\_SUCCESS.</span></span> <span data-ttu-id="39bc9-120">La razón de este comportamiento es que no se conoce si se ha especificado una instancia de contador no existente o una que exista pero que todavía no se haya creado.</span><span class="sxs-lookup"><span data-stu-id="39bc9-120">The reason for this behavior is that it is not known if a nonexistent counter instance has been specified or one that will exist but has not yet been created.</span></span>

<span data-ttu-id="39bc9-121">La instancia de contador que falta se informará de [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata), [**PdhGetRawCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue)o [**PdhGetFormattedCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue).</span><span class="sxs-lookup"><span data-stu-id="39bc9-121">The missing counter instance will be reported by either [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata), [**PdhGetRawCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue), or [**PdhGetFormattedCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue).</span></span> <span data-ttu-id="39bc9-122">Cuando solo se llama a **PdhCollectQueryData** para una instancia de Counter y la instancia de Counter todavía no existe, se supone que la instancia de Counter no existirá y la función devolverá los datos de PDH \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="39bc9-122">When calling **PdhCollectQueryData** for one counter instance only, and the counter instance still does not exist, it is assumed that the counter instance will not exist and the function returns PDH\_NO\_DATA.</span></span> <span data-ttu-id="39bc9-123">Sin embargo, si se consulta más de un contador, **PdhCollectQueryData** puede seguir devolviendo el error \_ si aún no existe una de las instancias de contador.</span><span class="sxs-lookup"><span data-stu-id="39bc9-123">However, if more than one counter is queried, **PdhCollectQueryData** may still return ERROR\_SUCCESS even if one of the counter instances does not yet exist.</span></span> <span data-ttu-id="39bc9-124">En este caso, llame a **PdhGetRawCounterValue** o **PdhGetFormattedCounterValue** para cada una de las instancias de contador de interés.</span><span class="sxs-lookup"><span data-stu-id="39bc9-124">In this case, call **PdhGetRawCounterValue** or **PdhGetFormattedCounterValue** for each of the counter instances of interest.</span></span> <span data-ttu-id="39bc9-125">Si la instancia no existe al llamar a **PdhGetRawCounterValue**, la función devuelve el error \_ Success y establece el miembro **CStatus** del [**\_ \_ contador sin formato de PDH**](/windows/desktop/api/Pdh/ns-pdh-pdh_raw_counter) en el estado de PDH \_ \_ sin \_ instancia.</span><span class="sxs-lookup"><span data-stu-id="39bc9-125">If the instance does not exist when calling **PdhGetRawCounterValue**, the function returns ERROR\_SUCCESS and sets the **CStatus** member of [**PDH\_RAW\_COUNTER**](/windows/desktop/api/Pdh/ns-pdh-pdh_raw_counter) to PDH\_STATUS\_NO\_INSTANCE.</span></span> <span data-ttu-id="39bc9-126">Si la instancia no existe cuando se llama a **PdhGetFormattedCounterValue**, la función devuelve los \_ datos no válidos de PDH \_ y establece el miembro **CSTATUS** del valor de un [**\_ \_ valor de PDH FMT**](/windows/desktop/api/Pdh/ns-pdh-pdh_fmt_countervalue) en PDH \_ CStatus \_ sin \_ instancia.</span><span class="sxs-lookup"><span data-stu-id="39bc9-126">If the instance does not exist when calling **PdhGetFormattedCounterValue**, the function returns PDH\_INVALID\_DATA and sets the **CStatus** member of the [**PDH\_FMT\_COUNTERVALUE**](/windows/desktop/api/Pdh/ns-pdh-pdh_fmt_countervalue) to PDH\_CSTATUS\_NO\_INSTANCE.</span></span>

<span data-ttu-id="39bc9-127">Tenga en cuenta que la ruta de acceso del contador especificada en la función [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) debe estar localizada.</span><span class="sxs-lookup"><span data-stu-id="39bc9-127">Note that the counter path specified in the [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) function must be localized.</span></span> <span data-ttu-id="39bc9-128">La función [**PdhAddEnglishCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera) proporciona una manera independiente de la configuración regional de agregar contadores de rendimiento a la consulta.</span><span class="sxs-lookup"><span data-stu-id="39bc9-128">The [**PdhAddEnglishCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera) function provides a locale-neutral way to add performance counters to the query.</span></span> <span data-ttu-id="39bc9-129">Esta función es la forma recomendada de agregar contadores de configuración regional neutro a una consulta.</span><span class="sxs-lookup"><span data-stu-id="39bc9-129">This function is the recommended way to add locale-neutral counters to a query.</span></span>

<span data-ttu-id="39bc9-130">Para quitar un contador de una consulta, llame a la función [**PdhRemoveCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter) .</span><span class="sxs-lookup"><span data-stu-id="39bc9-130">To remove a counter from a query, call the [**PdhRemoveCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter) function.</span></span>

<span data-ttu-id="39bc9-131">Cuando termine de recopilar datos de una consulta, llame a la función [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) para cerrar la consulta y liberar todos los recursos del sistema asignados.</span><span class="sxs-lookup"><span data-stu-id="39bc9-131">After you finish collecting data for a query, call the [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) function to close the query and release all allocated system resources.</span></span> <span data-ttu-id="39bc9-132">**PdhCloseQuery** cierra todos los identificadores de contador asociados a la consulta.</span><span class="sxs-lookup"><span data-stu-id="39bc9-132">**PdhCloseQuery** closes all counter handles associated with the query.</span></span>

 

 



