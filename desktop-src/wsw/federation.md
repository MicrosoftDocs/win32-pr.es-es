---
title: Federación
description: La Federación permite la delegación de autoridad de autorización a otros miembros de una instancia de.
ms.assetid: 574496df-95dc-45f7-8c42-e646aec12e69
keywords:
- Servicios Web de Federación para Windows
- WWSAPI
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45a02744c9c0a5358da35f4c31c20633c420fee9
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/12/2021
ms.locfileid: "104555169"
---
# <a name="federation"></a><span data-ttu-id="8c8e2-106">Federación</span><span class="sxs-lookup"><span data-stu-id="8c8e2-106">Federation</span></span>

<span data-ttu-id="8c8e2-107">La Federación permite la delegación de autoridad de autorización a otros miembros de una instancia de.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-107">Federation allows the delegation of authorization authority to other members of an interprise.</span></span> <span data-ttu-id="8c8e2-108">Por ejemplo, tenga en cuenta el siguiente problema empresarial: la empresa auto Manufacturing Company contoso Ltd desea permitir que los empleados autorizados de su cliente Fabrikam Inc accedan de forma segura al servicio Web de pedidos de piezas de contoso.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-108">For example, consider the following business problem: The auto parts manufacturing company Contoso Ltd would like to allow authorized employees of its customer Fabrikam Inc to securely access Contoso's parts order Web Service.</span></span> <span data-ttu-id="8c8e2-109">Una solución de seguridad para este escenario es que contoso establezca un mecanismo de confianza con Fabrikam para delegar la decisión de autorización de acceso a fabrikam.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-109">One security solution for this scenario is for Contoso to set up a trust mechanism with Fabrikam to delegate the access authorization decision to Fabrikam.</span></span> <span data-ttu-id="8c8e2-110">Este proceso podría funcionar de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="8c8e2-110">This process could work as follows:</span></span>

-   <span data-ttu-id="8c8e2-111">Fabrikam, cuando se convierte en socio de Contoso, configura un acuerdo de confianza con contoso.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-111">Fabrikam, when it becomes a partner of Contoso, sets up a trust agreement with Contoso.</span></span> <span data-ttu-id="8c8e2-112">El objetivo de este paso es acordar el tipo de token de seguridad y el contenido que representará la autorización de Fabrikam, y será aceptable para contoso.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-112">The goal of this step is to agree on the security token type and content that will represent Fabrikam's authorization and will be acceptable to Contoso.</span></span> <span data-ttu-id="8c8e2-113">Por ejemplo, se puede decidir que un certificado X. 509 de confianza con el nombre de sujeto "CN = Fabrikam Inc Supplier STS" debe firmar un token SAML para que SAML lo acepte el servicio Web de contoso.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-113">For example, it may be decided that a trusted X.509 certificate with subject name "CN=Fabrikam Inc Supplier STS" should sign a SAML token for that SAML to be accepted by the Contoso Web Service.</span></span> <span data-ttu-id="8c8e2-114">Además, se puede decidir que la demanda de seguridad en el token SAML emitido debe ser ' https://schemas.contoso.com/claims/lookup ' (para la autorización de búsqueda de piezas) o ' https://schemas.contoso.com/claims/order ' (para la autorización de ordenación de partes).</span><span class="sxs-lookup"><span data-stu-id="8c8e2-114">Further, it may be decided that the security claim in the issued SAML token should be either 'https://schemas.contoso.com/claims/lookup' (for part lookup authorization) or 'https://schemas.contoso.com/claims/order' (for part ordering authorization).</span></span>
-   <span data-ttu-id="8c8e2-115">Cuando un empleado de Fabrikam usa la aplicación de pedidos de piezas internas, primero se pone en contacto con un servicio de token de seguridad (STS) dentro de fabrikam.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-115">When a Fabrikam employee uses the internal parts ordering application, it first contacts a security token service (STS) inside Fabrikam.</span></span> <span data-ttu-id="8c8e2-116">Ese empleado se autentica mediante el mecanismo de seguridad interno de Fabrikam (por ejemplo, nombre de usuario y contraseña de dominio de Windows), se comprueba la autorización de los elementos de pedido y se emite un token SAML de corta duración que contiene las notificaciones adecuadas y firmado por el certificado X. 509 que se decidió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-116">That employee is authenticated using the internal Fabrikam security mechanism (say, Windows domain username/password), his authorization to order parts is verified, and he is issued a short lived SAML token containing the appropriate claims and signed by the X.509 certificate decided above.</span></span> <span data-ttu-id="8c8e2-117">A continuación, la aplicación de pedidos de piezas se pone en contacto con el servicio de Contoso que presenta el token SAML emitido para autenticarse y realizar la tarea de ordenación.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-117">The parts ordering application then contacts the Contoso service presenting the issued SAML token to authenticate and perform the ordering task.</span></span>

<span data-ttu-id="8c8e2-118">En este caso, el STS de Fabrikam actúa como la "entidad emisora" y el servicio de piezas de Contoso actúa como el "usuario de confianza".</span><span class="sxs-lookup"><span data-stu-id="8c8e2-118">Here, the Fabrikam STS acts as the 'issuing party' and the Contoso parts service acts as the 'relying party'.</span></span> ![Diagrama que muestra una entidad emisora y un usuario de confianza en una Federación.](images/stsmodel.png)

## <a name="federation-features"></a><span data-ttu-id="8c8e2-120">Características de Federación</span><span class="sxs-lookup"><span data-stu-id="8c8e2-120">Federation Features</span></span>

<span data-ttu-id="8c8e2-121">A continuación se indican las características de seguridad admitidas para las entidades o los roles implicados en un escenario de Federación:</span><span class="sxs-lookup"><span data-stu-id="8c8e2-121">The following are the supported security features for the parties or roles involved in a federation scenario:</span></span>

-   <span data-ttu-id="8c8e2-122">Lado cliente: para obtener el token de seguridad del STS, puede usar la función [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) .</span><span class="sxs-lookup"><span data-stu-id="8c8e2-122">Client-side: For obtaining the security token from the STS, one may use [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) function.</span></span> <span data-ttu-id="8c8e2-123">Como alternativa, puede usar una biblioteca del proveedor de tokens de seguridad del lado cliente como CardSpace o LiveID y, a continuación, usar la salida para crear localmente un token de seguridad mediante [**WsCreateXmlSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken).</span><span class="sxs-lookup"><span data-stu-id="8c8e2-123">Alternatively, one may use a client side security token provider library such as CardSpace or LiveID, and then use their output to locally create a security token using [**WsCreateXmlSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken).</span></span> <span data-ttu-id="8c8e2-124">En cualquier caso, una vez que el cliente tenga el token de seguridad, puede crear un canal para el servicio especificando el [**enlace de seguridad de mensaje de token de WS \_ XML \_ \_ \_ \_**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) para presentar el token, junto con un enlace de seguridad de transporte como el enlace de [**\_ seguridad de \_ transporte \_ \_ WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) para proteger el canal.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-124">Either way, once the client has the security token, it may then create a channel to the service specifying [**WS\_XML\_TOKEN\_MESSAGE\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) to present the token, together with a transport security binding such as [**WS\_SSL\_TRANSPORT\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) to protect the channel.</span></span>
-   <span data-ttu-id="8c8e2-125">Lado servidor: en un escenario de Federación con un servicio de token de seguridad que emite tokens SAML, el servidor puede usar el [**\_ enlace de seguridad de \_ mensajes \_ \_ WS SAML**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), junto con un enlace de seguridad de transporte como el [**enlace de \_ seguridad de \_ transporte \_ \_ WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) para proteger el canal.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-125">Server-side: In a federation scenario with a security token service that issues SAML tokens, the server may use the [**WS\_SAML\_MESSAGE\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), together with a transport security binding such as [**WS\_SSL\_TRANSPORT\_SECURITY\_BINDING**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) to protect the channel.</span></span>
-   <span data-ttu-id="8c8e2-126">STS-Side: tenga en cuenta que el STS es una aplicación de servicio Web y puede especificar los requisitos de seguridad para los que solicitan un token de seguridad de él mediante una estructura de [**Descripción de seguridad**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) en el momento de creación del agente de escucha de la misma forma que cualquier otro servicio Web seguro.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-126">STS-side: Note that the STS is a Web Service application, and it can specify the security requirements for those requesting a security token from it using a [**security description**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) structure at listener creation time just as any other secure Web Service would.</span></span> <span data-ttu-id="8c8e2-127">A continuación, puede analizar las cargas de mensajes de solicitud entrantes para validar las solicitudes de token y devolver los tokens emitidos como cargas de mensajes de respuesta.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-127">It may then parse incoming request message payloads to validate the token requests and send back issued tokens as reply message payloads.</span></span> <span data-ttu-id="8c8e2-128">Actualmente, no se proporcionan características que ayuden a analizar y emitir pasos.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-128">Currently, no features are provided to help these parsing and issuing steps.</span></span>

<span data-ttu-id="8c8e2-129">Tenga en cuenta que el lado cliente puede controlar el token de seguridad emitido de forma genérica como un token de seguridad XML sin conocer el tipo de token o realizar el procesamiento específico del tipo de token.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-129">Note that the client side can handle the issued security token generically as an XML security token without knowing the token type, or doing token type specific processing.</span></span> <span data-ttu-id="8c8e2-130">Sin embargo, el servidor tiene que entender el tipo de token de seguridad específico para poder comprenderlo y procesarlo.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-130">However, the server has to understand the specific security token type in order to understand and process it.</span></span> <span data-ttu-id="8c8e2-131">Los pasos de solicitud y respuesta del token de seguridad usan las construcciones definidas en la especificación WS-Trust.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-131">The security token request and response steps use the constructs defined in the WS-Trust specification.</span></span>

## <a name="more-complex-federation-scenarios"></a><span data-ttu-id="8c8e2-132">Escenarios de Federación más complejos</span><span class="sxs-lookup"><span data-stu-id="8c8e2-132">More Complex Federation Scenarios</span></span>

<span data-ttu-id="8c8e2-133">Un escenario de Federación puede implicar varios STS que forman una cadena de Federación.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-133">A federation scenario may involve multiple STSs that form a federation chain.</span></span> <span data-ttu-id="8c8e2-134">Considere el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8c8e2-134">Consider the following example:</span></span>

-   <span data-ttu-id="8c8e2-135">El cliente se autentica en el STS de LiveID mediante un nombre de usuario y contraseña de LiveID y obtiene un token de seguridad T1.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-135">Client authenticates to the LiveID STS using a LiveID username/password, and obtains a security token T1.</span></span>
-   <span data-ttu-id="8c8e2-136">El cliente se autentica en STS1 con T1 y obtiene un token de seguridad T2.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-136">Client authenticates to STS1 using T1 and obtains a security token T2.</span></span>
-   <span data-ttu-id="8c8e2-137">El cliente se autentica en STS2 con T2 y obtiene un token de seguridad T3.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-137">Client authenticates to STS2 using T2 and obtains a security token T3.</span></span>
-   <span data-ttu-id="8c8e2-138">El cliente se autentica en el servicio de destino con T3.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-138">Client authenticates to the target service S using T3.</span></span>

<span data-ttu-id="8c8e2-139">Aquí, el STS de LiveID, STS1, STS2 y S forman la cadena de Federación.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-139">Here, the LiveID STS, STS1, STS2 and S form the federation chain.</span></span> <span data-ttu-id="8c8e2-140">El STS de una cadena de Federación puede realizar varios roles para el escenario de aplicación general.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-140">The STSs in a federation chain may perform various roles for the overall application scenario.</span></span> <span data-ttu-id="8c8e2-141">Entre los ejemplos de estos roles funcionales de STS se incluyen proveedor de identidades, responsable de decisiones de autorización, Anonymizer y Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-141">Examples of such STS functional roles include identity provider, authorization decision maker, anonymizer, and resource manager.</span></span>

## <a name="sts-request-parameters-and-metadata-exchange"></a><span data-ttu-id="8c8e2-142">Parámetros de solicitud y intercambio de metadatos de STS</span><span class="sxs-lookup"><span data-stu-id="8c8e2-142">STS Request Parameters and Metadata Exchange</span></span>

<span data-ttu-id="8c8e2-143">Para que el cliente realice una llamada [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) correcta, debe conocer los parámetros de esa llamada (como el tipo de token y los tipos de notificaciones necesarios), los requisitos de [**Descripción de seguridad**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) del canal de solicitud al STS y la dirección del [punto de conexión](endpoint-address.md) del STS.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-143">For the client to make a successful [**WsRequestSecurityToken**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) call, it needs to know the parameters of that call (such as the required token type and claim types), the [**security description**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) requirements of the request channel to the STS, and the [endpoint address](endpoint-address.md) of the STS.</span></span> <span data-ttu-id="8c8e2-144">La aplicación cliente puede utilizar cualquiera de las técnicas siguientes para determinar esta información:</span><span class="sxs-lookup"><span data-stu-id="8c8e2-144">The client application may use any of the following techniques for determining this information:</span></span>

-   <span data-ttu-id="8c8e2-145">Codifique la información de la aplicación como parte de las decisiones de tiempo de diseño.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-145">Hard code the information in the application as part of the design time decisions.</span></span>
-   <span data-ttu-id="8c8e2-146">Lea esta información de un archivo de configuración de nivel de aplicación configurado por el implementador de la aplicación local.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-146">Read this information from an application level configuration file set up by the local application deployer.</span></span>
-   <span data-ttu-id="8c8e2-147">Detecte dinámicamente esta información en tiempo de ejecución mediante la característica de [importación de metadatos](metadata-import.md) con la estructura de [**restricción de enlace de \_ \_ seguridad de mensaje de token \_ \_ \_ \_ emitido de WS**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) .</span><span class="sxs-lookup"><span data-stu-id="8c8e2-147">Dynamically discover this information at runtime using the [metadata import](metadata-import.md) feature with the [**WS\_ISSUED\_TOKEN\_MESSAGE\_SECURITY\_BINDING\_CONSTRAINT**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) structure.</span></span>

<span data-ttu-id="8c8e2-148">Para ilustrar el uso de MEX dinámico con la Federación, considere el ejemplo 3 STS anterior.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-148">To illustrate the use of dynamic MEX with federation, consider the 3 STS example above.</span></span> <span data-ttu-id="8c8e2-149">El cliente realizará primero un MEX dinámico con S para obtener información sobre T3 (es decir, qué se debe preguntar desde STS2), así como la dirección MEX dinámica de STS2 (es decir, dónde encontrar STS2).</span><span class="sxs-lookup"><span data-stu-id="8c8e2-149">The client will first do a dynamic MEX with S to obtain information about T3 (i.e., what to ask from STS2) as well as the STS2 dynamic MEX address (i.e., where to find STS2).</span></span> <span data-ttu-id="8c8e2-150">A continuación, usará esa información para realizar una MEX dinámica con STS2 para detectar información sobre T2 y STS1, etc.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-150">It will then use that information to do a dynamic MEX with STS2 to discover information about T2 and STS1, and so on.</span></span>

<span data-ttu-id="8c8e2-151">Por lo tanto, los pasos de MEX dinámico tienen lugar en el orden 4, 3, 2, 1 para crear la cadena de Federación y los pasos de solicitud y presentación de tokens tienen lugar en el orden 1, 2, 3, 4 para desenredar la cadena de Federación.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-151">Thus, the dynamic MEX steps take place in the order 4, 3, 2, 1 to build up the federation chain and the token request and presentation steps take place in the order 1, 2, 3, 4 to unwind the federation chain.</span></span>

> [!Note]  
> <span data-ttu-id="8c8e2-152">Windows 7 y Windows Server 2008 R2: WWSAPI solo admite [WS-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) y [WS-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) , tal y como se define en [Lightweight seguridad de servicios web Profile (LWSSP)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e).</span><span class="sxs-lookup"><span data-stu-id="8c8e2-152">Windows 7 and Windows Server 2008 R2: WWSAPI only supports [Ws-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) and [Ws-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) as defined by [Lightweight Web Services Security Profile (LWSSP)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e).</span></span> <span data-ttu-id="8c8e2-153">Para obtener más información sobre la implementación de Microsoft, consulte la sección sobre la [Sintaxis del mensaje](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) de LWSSP.</span><span class="sxs-lookup"><span data-stu-id="8c8e2-153">For details regarding Microsoft's implementation please see the [MESSAGE Syntax](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) section of LWSSP.</span></span>

 

 

 