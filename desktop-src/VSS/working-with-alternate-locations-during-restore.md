---
description: Hay muchas razones por las que un solicitante no debe ser capaz de restaurar archivos desde un medio de copia de seguridad a su ubicación original.
ms.assetid: 2a9cfd99-5a2c-4c0c-98ff-11c745298cda
title: Trabajar con ubicaciones alternativas durante la restauración
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1338d76f98153ccb388e86e738b408c03dd253b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696434"
---
# <a name="working-with-alternate-locations-during-restore"></a><span data-ttu-id="f719b-103">Trabajar con ubicaciones alternativas durante la restauración</span><span class="sxs-lookup"><span data-stu-id="f719b-103">Working with Alternate Locations during Restore</span></span>

<span data-ttu-id="f719b-104">Hay muchas razones por las que un solicitante no debe ser capaz de restaurar archivos desde un medio de copia de seguridad a su ubicación original.</span><span class="sxs-lookup"><span data-stu-id="f719b-104">There are many reasons why a requester either should not, or may not, be able to restore files from backup media to their original location.</span></span> <span data-ttu-id="f719b-105">Por ejemplo, un método o un destino de restauración puede requerir una restauración de este tipo, o la ubicación de restauración actual puede estar ocupada y sin escritura.</span><span class="sxs-lookup"><span data-stu-id="f719b-105">For example, a restore method or target may require such a restoration, or the current restoration location may be occupied and unwritable.</span></span>

<span data-ttu-id="f719b-106">Para controlar estos casos, un escritor puede haber definido una [*asignación de ubicación alternativa*](vssgloss-a.md), un destino de restauración no estándar que se usará para circunstancias especiales.</span><span class="sxs-lookup"><span data-stu-id="f719b-106">To handle such cases, a writer may have defined an [*alternate location mapping*](vssgloss-a.md), a nonstandard restore destination to be used for special circumstances.</span></span>

<span data-ttu-id="f719b-107">El término asignación de ubicación alternativa, tal y como se usa con VSS, no se debe confundir con el término [*ruta de acceso alternativa*](vssgloss-a.md).</span><span class="sxs-lookup"><span data-stu-id="f719b-107">The term alternate location mapping, as used with VSS, should not be confused with the term [*alternate path*](vssgloss-a.md).</span></span> <span data-ttu-id="f719b-108">Las asignaciones de ubicación alternativas solo se usan durante las operaciones de restauración y hacen referencia a un destino alternativo para las operaciones de restauración.</span><span class="sxs-lookup"><span data-stu-id="f719b-108">Alternate location mappings are used only during restore operations, and refer to an alternate destination for restore operations.</span></span> <span data-ttu-id="f719b-109">Las rutas de acceso alternativas solo se usan durante las operaciones de copia de seguridad y hacen referencia a un origen alternativo del que se va a realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="f719b-109">Alternate paths are used only during backup operations, and refer to an alternate source from which to back up.</span></span>

<span data-ttu-id="f719b-110">Para usar asignaciones de ubicación alternativas durante la restauración, un solicitante haría lo siguiente (normalmente después de la generación de un evento de [**prerestauración**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ):</span><span class="sxs-lookup"><span data-stu-id="f719b-110">To use alternate location mappings during restore, a requester would do the following (typically following the generation of a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event):</span></span>

1.  <span data-ttu-id="f719b-111">Mediante el uso de una instancia de la interfaz [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) obtenida al recuperar un escritor almacenado, un solicitante usa el método [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) para obtener las asignaciones de ubicación alternativas de un escritor como instancias de la interfaz [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .</span><span class="sxs-lookup"><span data-stu-id="f719b-111">Using an instance of the [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interface obtained by retrieving a stored writer, a requester uses the [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) method to obtain a writer's alternate location mappings as instances of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) interface.</span></span>

    > [!Note]  
    > <span data-ttu-id="f719b-112">El solicitante usa [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), no [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="f719b-112">The requester uses [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), not [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="f719b-113">El primero devuelve las asignaciones de ubicación alternativas disponibles para que las use un solicitante.</span><span class="sxs-lookup"><span data-stu-id="f719b-113">The former returns those alternate location mappings available for use by a requester.</span></span> <span data-ttu-id="f719b-114">Esta última se usa para indicar las asignaciones de ubicación alternativas utilizadas realmente por un solicitante.</span><span class="sxs-lookup"><span data-stu-id="f719b-114">The latter is used to indicate those alternate location mappings actually used by a requester.</span></span>

     

2.  <span data-ttu-id="f719b-115">La llamada a [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) devuelve una instancia de la interfaz [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .</span><span class="sxs-lookup"><span data-stu-id="f719b-115">The call to the [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) returns an instance of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) interface.</span></span> <span data-ttu-id="f719b-116">Esta instancia contiene información de conjunto de archivos, una ruta de acceso especificada por [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), una especificación de archivo devuelta a través de [**IVssWMFiledesc:: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)y una marca de recursividad obtenida de [**IVssWMFiledesc:: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive), que coincide con uno de los conjuntos de archivos agregados (mediante [**IVssCreateWriterMetadata:: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)o [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) a uno de los componentes</span><span class="sxs-lookup"><span data-stu-id="f719b-116">This instance contains file set information—a path specified by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), a file specification returned through [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and a recursion flag obtained from [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)—matching one of the file sets added (using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) to one of the components managed by the writer.</span></span>

    <span data-ttu-id="f719b-117">El valor devuelto por [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) es la asignación de ubicación alternativa para este conjunto de archivos.</span><span class="sxs-lookup"><span data-stu-id="f719b-117">The value returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is the alternate location mapping for this file set.</span></span>

3.  <span data-ttu-id="f719b-118">Las asignaciones de ubicación alternativas no contienen información de componentes, por lo que será necesario comparar la información del conjunto de archivos (ruta de acceso, especificación de archivo y marca de recursividad) obtenida llamando a [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) a la que contengan los componentes del escritor.</span><span class="sxs-lookup"><span data-stu-id="f719b-118">Alternate location mappings do not contain component information, so it will be necessary to compare the file set information (path, file specification, and recursion flag) obtained by calling [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to that contained by the writer's components.</span></span>

    <span data-ttu-id="f719b-119">Para encontrar esta información, puede recorrer en iteración los componentes del escritor y llamar a [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) para obtener una instancia de la interfaz [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) y usar [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) para obtener una instancia de [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) que contiene la información del conjunto de archivos de componentes.</span><span class="sxs-lookup"><span data-stu-id="f719b-119">This information can be found by iterating over the writer's components and calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) to get an instance of the [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface and use [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) to obtain a [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) instance containing the component file set information.</span></span>

    <span data-ttu-id="f719b-120">Cuando la información de conjunto de archivos devuelta por la instancia de [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) obtenida de [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) y [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) coincide con la que se obtiene de la instancia de **IVssWMFiledesc** derivada de [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), se ha encontrado el componente que administra los archivos con la asignación de ubicación alternativa específica.</span><span class="sxs-lookup"><span data-stu-id="f719b-120">When the file set information returned by the instance of [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) obtained from [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) and [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) matches that obtained from the **IVssWMFiledesc** instance derived from [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), the component managing the files with the specific alternate location mapping has been found.</span></span>

4.  <span data-ttu-id="f719b-121">Una vez localizado el componente, el solicitante puede determinar las condiciones en las que se debe usar una asignación de ubicación alternativa haciendo lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f719b-121">Having located the component, the requester can determine the conditions under which an alternate location mapping should be used by doing the following:</span></span>

    -   <span data-ttu-id="f719b-122">Examinar el método de restauración del componente, que se obtiene llamando a [**IVssExamineWriterMetadata:: GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="f719b-122">Examining the component's restore method, which is obtained by calling [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>
    -   <span data-ttu-id="f719b-123">Comprobando si un destino de restauración invalida el método de restauración mediante una llamada a [**IVssComponent:: GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).</span><span class="sxs-lookup"><span data-stu-id="f719b-123">Checking to see if a restore target overrides the restore method, by calling [**IVssComponent::GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).</span></span>

        <span data-ttu-id="f719b-124">Si el componente que se encuentra en el documento de metadatos del escritor se [*incluyó explícitamente*](vssgloss-e.md) en la copia de seguridad, la instancia de la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) se corresponderá con ese componente.</span><span class="sxs-lookup"><span data-stu-id="f719b-124">If the component found in the Writer Metadata Document had been [*explicitly included*](vssgloss-e.md) in the backup, the instance of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface will correspond to that component.</span></span> <span data-ttu-id="f719b-125">Si el componente se [*incluyó implícitamente*](vssgloss-i.md) en la copia de seguridad, la instancia de **IVssComponent** se corresponderá con el componente que define el conjunto de componentes del que el componente del documento de metadatos del escritor es un subcomponente.</span><span class="sxs-lookup"><span data-stu-id="f719b-125">If the component had been [*implicitly included*](vssgloss-i.md) in the backup, then the instance of **IVssComponent** will correspond to the component defining the component set of which the component in the Writer Metadata Document is a subcomponent.</span></span>

5.  <span data-ttu-id="f719b-126">Con esta información, el solicitante puede determinar cada componente en función de si necesita restaurar un determinado conjunto de archivos de un componente determinado a un destino definido por la asignación de ubicación alternativa.</span><span class="sxs-lookup"><span data-stu-id="f719b-126">With this information, the requester can determine on a component-by-component basis if it needs to restore a given file set of a given component to a destination defined by the alternate location mapping.</span></span>

6.  <span data-ttu-id="f719b-127">Cuando se usa una asignación de ubicación alternativa, el solicitante respeta el descriptor de archivo del conjunto de archivos y la marca recursiva, y utiliza la ruta de acceso proporcionada por la asignación de ubicación alternativa.</span><span class="sxs-lookup"><span data-stu-id="f719b-127">When using an alternate location mapping, the requester respects the file set's file descriptor and recursive flag and uses the path provided by the alternate location mapping.</span></span>

    <span data-ttu-id="f719b-128">El solicitante indica que ha usado una asignación de ubicación alternativa durante una operación de restauración mediante una llamada a la función [**IVssBackupComponents:: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) con la información de ubicación predeterminada del conjunto de archivos, el destino de restauración alternativo usado y un nombre de componente.</span><span class="sxs-lookup"><span data-stu-id="f719b-128">The requester indicates that it has used an alternate location mapping during a restore operation by calling the [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) with the file set's default location information, the alternate restore destination used, and a component name.</span></span>

    <span data-ttu-id="f719b-129">Si el conjunto de archivos lo ha administrado un componente que se incluyó explícitamente en la copia de seguridad, se usará ese nombre de componente.</span><span class="sxs-lookup"><span data-stu-id="f719b-129">If the file set was managed by a component that was explicitly included in the backup, that component name will be used.</span></span> <span data-ttu-id="f719b-130">Si el conjunto de archivos lo ha administrado un componente que se incluyó implícitamente en la copia de seguridad, el nombre utilizado será el del componente que define el conjunto de componentes del que el componente que administra el conjunto de archivos es un subcomponente.</span><span class="sxs-lookup"><span data-stu-id="f719b-130">If the file set was managed by a component that was implicitly included in the backup, then the name used will be that of the component defining the component set of which the component managing the file set is a subcomponent.</span></span>

<span data-ttu-id="f719b-131">Los escritores comprueban si los conjuntos de archivos de uno de sus componentes se restauraron en una asignación de ubicación alternativa mediante una llamada a [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="f719b-131">Writers verify whether file sets from one of their components were restored to an alternate location mapping by calling [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>

 

 



