---
description: Control de cookies en WinHTTP
ms.assetid: ef0f0847-05f6-4477-8e48-e0bea66314ab
title: Control de cookies en WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e3b596225dc3c741ab9ed0139a63e343e7afb3d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105707491"
---
# <a name="cookie-handling-in-winhttp"></a><span data-ttu-id="36ff7-103">Control de cookies en WinHTTP</span><span class="sxs-lookup"><span data-stu-id="36ff7-103">Cookie Handling in WinHTTP</span></span>

<span data-ttu-id="36ff7-104">Los datos de la sesión HTTP se pasan entre el cliente y el servidor en el encabezado de la cookie de la solicitud o la respuesta.</span><span class="sxs-lookup"><span data-stu-id="36ff7-104">HTTP session data is passed between the client and server in the cookie header of the request or the response.</span></span> <span data-ttu-id="36ff7-105">El servidor envía cookies al cliente en el encabezado Set-Cookie de la respuesta y la API WinHTTP reenvía la cookie del servidor al servidor en el encabezado de la cookie de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-105">The server sends cookies to the client in the Set-cookie header of the response and the WinHTTP API resends the server cookie to the server in the cookie header of the request.</span></span> <span data-ttu-id="36ff7-106">Las especificaciones de control de cookies, descritas en RFC 2109 (mecanismo de administración de Estado HTTP), se implementan de forma predeterminada en WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="36ff7-106">The cookie handling specifications, described in rfc 2109 (HTTP State Management Mechanism), are implemented by default in WinHTTP.</span></span> <span data-ttu-id="36ff7-107">Las especificaciones recientes de administración de cookies, descritas en RFC 2964, no son compatibles con WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="36ff7-107">Recent cookie handling specifications, described in rfc 2964, are not supported by WinHTTP.</span></span>

<span data-ttu-id="36ff7-108">WinHTTP obtiene la cookie del encabezado servidores Set-Cookie y la almacena en una caché por sesión.</span><span class="sxs-lookup"><span data-stu-id="36ff7-108">WinHTTP obtains the cookie from the servers Set-Cookie header and stores it in a cache on a per-session basis.</span></span> <span data-ttu-id="36ff7-109">Esta cookie se vuelve a enviar en las solicitudes posteriores de la misma sesión de WinHTTP en la que el destino coincide con el origen de la cookie.</span><span class="sxs-lookup"><span data-stu-id="36ff7-109">This cookie is resent on subsequent requests in the same WinHTTP session where the target matches the source of the cookie.</span></span> <span data-ttu-id="36ff7-110">La API de WinHTTP vuelve a generar el encabezado de la cookie de solicitud para cada segmento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-110">The WinHTTP API regenerates the request cookie header for each leg in the request.</span></span>

<span data-ttu-id="36ff7-111">En la lista siguiente se describen varias opciones que las aplicaciones cliente de WinHTTP pueden utilizar para controlar las cookies:</span><span class="sxs-lookup"><span data-stu-id="36ff7-111">The follow list describes several options that WinHTTP client applications can use to handle cookies:</span></span>

-   <span data-ttu-id="36ff7-112">Control automático de cookies: WinHTTP controla automáticamente las cookies y la aplicación cliente no realiza ningún control de cookies personalizado.</span><span class="sxs-lookup"><span data-stu-id="36ff7-112">Automatic Cookie Handling - WinHTTP automatically handles cookies and the client application performs no custom cookie handling.</span></span>
-   <span data-ttu-id="36ff7-113">Deshabilitar el control de cookies automático: el control automático de cookies en la API WinHTTP está deshabilitado y no se envían cookies.</span><span class="sxs-lookup"><span data-stu-id="36ff7-113">Disable Automatic Cookie Handling - Automatic cookie handling in the WinHTTP API is disabled and no cookies are sent.</span></span>
-   <span data-ttu-id="36ff7-114">Especificar manualmente todas las cookies: el control automático de cookies está deshabilitado y la aplicación cliente agrega o quita todos los encabezados de cookie para cada solicitud de la sesión.</span><span class="sxs-lookup"><span data-stu-id="36ff7-114">Manually specify all Cookies – Automatic cookie handling is disabled and the client application adds or removes all cookie headers for each request in the session.</span></span>
-   <span data-ttu-id="36ff7-115">Control manual y automático de cookies: Combine el control de cookies automática y manual.</span><span class="sxs-lookup"><span data-stu-id="36ff7-115">Manual and Automatic Cookie Handling - Combine automatic and manual cookie handling.</span></span>

## <a name="disabling-automatic-cookie-handling"></a><span data-ttu-id="36ff7-116">Deshabilitar el control automático de cookies</span><span class="sxs-lookup"><span data-stu-id="36ff7-116">Disabling Automatic Cookie Handling</span></span>

<span data-ttu-id="36ff7-117">Para deshabilitar el control de cookies, la aplicación cliente WinHTTP llama a la función [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) con el parámetro *DWOPTION* establecido en WinHTTP \_ OPTION \_ Disable \_ Feature, y el parámetro *lpBuffer* establecido en WinHTTP \_ deshabilitar \_ cookies.</span><span class="sxs-lookup"><span data-stu-id="36ff7-117">To disable cookie handling, the WinHTTP client application calls the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the *dwOption* parameter set to WINHTTP\_OPTION\_DISABLE\_FEATURE, and the *lpBuffer* parameter set to WINHTTP\_DISABLE\_COOKIES.</span></span> <span data-ttu-id="36ff7-118">El parámetro *hInternet* puede ser un identificador de sesión o un identificador de solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-118">The *hInternet* parameter can be either a session handle or a request handle.</span></span> <span data-ttu-id="36ff7-119">Cuando se deshabilita el control de cookies en un identificador de solicitud que ha enviado una solicitud anterior, el cliente debe quitar manualmente los encabezados de cookie de solicitud existentes con la función [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) antes de enviar la solicitud siguiente.</span><span class="sxs-lookup"><span data-stu-id="36ff7-119">When cookie handling is disabled on a request handle that has sent a previous request, the client should manually remove existing request cookie headers with the [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) function before sending the next request.</span></span> <span data-ttu-id="36ff7-120">Para obtener más información, consulte [quitar encabezados de cookies](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="36ff7-120">For more information, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

<span data-ttu-id="36ff7-121">**Nota:**  La aplicación cliente debe establecer todas las cookies de la sesión después de que se haya deshabilitado el modo automático.</span><span class="sxs-lookup"><span data-stu-id="36ff7-121">**Note**  The client application must set all cookies on the session after automatic mode has been disabled.</span></span>

## <a name="manually-specifying-all-cookies"></a><span data-ttu-id="36ff7-122">Especificación manual de todas las cookies</span><span class="sxs-lookup"><span data-stu-id="36ff7-122">Manually Specifying All Cookies</span></span>

<span data-ttu-id="36ff7-123">Cuando se deshabilita el control automático de cookies, la aplicación cliente WinHTTP tiene la opción de especificar manualmente todas las cookies.</span><span class="sxs-lookup"><span data-stu-id="36ff7-123">When automatic cookie handling is disabled, the WinHTTP client application has the option to manually specify all cookies.</span></span> <span data-ttu-id="36ff7-124">Para establecer manualmente la cookie, la aplicación llama a [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) especificando el encabezado de la cookie en el parámetro *pwszHeaders* .</span><span class="sxs-lookup"><span data-stu-id="36ff7-124">To manually set the cookie, the application calls [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) specifying the cookie header in the *pwszHeaders* parameter.</span></span> <span data-ttu-id="36ff7-125">La aplicación cliente debe borrar todos los encabezados de cookie antes de volver a enviar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-125">The client application should clear all cookie headers before resending the request.</span></span>

<span data-ttu-id="36ff7-126">La aplicación cliente también debe cambiar el encabezado de la cookie cuando se ha redirigido la solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-126">The client application should also change the cookie header when the request has been redirected.</span></span> <span data-ttu-id="36ff7-127">Para cambiar la cookie en las solicitudes redirigidas, el cliente especifica una función de devolución de llamada con [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) que responde al caso de devolución de llamada de redirección.</span><span class="sxs-lookup"><span data-stu-id="36ff7-127">To change the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="36ff7-128">El controlador de devolución de llamada debe borrar la cookie enviada anteriormente en la solicitud mediante una llamada a [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="36ff7-128">The callback handler should clear the cookie previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="36ff7-129">Para obtener más información acerca de cómo quitar encabezados de cookies, consulte [quitar encabezados de cookies](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="36ff7-129">For more information about removing cookie headers, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

## <a name="manual-and-automatic-cookie-handling"></a><span data-ttu-id="36ff7-130">Control manual y automático de cookies</span><span class="sxs-lookup"><span data-stu-id="36ff7-130">Manual and Automatic Cookie Handling</span></span>

<span data-ttu-id="36ff7-131">Las aplicaciones cliente de WinHTTP pueden combinar el mecanismo de control de cookies automático de WinHTTP con el control manual de cookies.</span><span class="sxs-lookup"><span data-stu-id="36ff7-131">WinHTTP client applications can combine the WinHTTP automatic cookie handling mechanism with manual cookie handling.</span></span> <span data-ttu-id="36ff7-132">La aplicación agrega cookies personalizadas al encabezado de cookie generado automáticamente antes de enviar la solicitud con la función [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) .</span><span class="sxs-lookup"><span data-stu-id="36ff7-132">The application adds custom cookies to the automatically generated cookie header before sending the request with the [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) function.</span></span> <span data-ttu-id="36ff7-133">La cookie personalizada debe ser el primer encabezado de cookie en la solicitud de la API de WinHTTP para almacenar correctamente en caché la cookie.</span><span class="sxs-lookup"><span data-stu-id="36ff7-133">The custom cookie should be the first cookie header in the request for the WinHTTP API to properly cache the cookie.</span></span> <span data-ttu-id="36ff7-134">La aplicación cliente también debe quitar las cookies enviadas en las solicitudes anteriores antes de volver a enviar una solicitud en el mismo identificador de solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-134">The client application should also remove cookies sent on previous requests before resending a request on the same request handle.</span></span> <span data-ttu-id="36ff7-135">Para obtener más información, consulte quitar encabezados de cookies.</span><span class="sxs-lookup"><span data-stu-id="36ff7-135">For more information, see Removing Cookie Headers.</span></span>

<span data-ttu-id="36ff7-136">Las cookies agregadas a una solicitud antes de la llamada a [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) se incluyen en todas las solicitudes WinHTTP enviadas en nombre de las siguientes llamadas a **WinHttpSendRequest** y [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) .</span><span class="sxs-lookup"><span data-stu-id="36ff7-136">Cookies added to a request before the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) are included in all WinHTTP requests sent on behalf of the next **WinHttpSendRequest** and [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) calls.</span></span> <span data-ttu-id="36ff7-137">Es posible que la aplicación cliente tenga que borrar el encabezado de la cookie cuando se haya Redirigido la solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-137">The client application may need to clear the cookie header when the request has been redirected.</span></span> <span data-ttu-id="36ff7-138">Para borrar la cookie en las solicitudes redirigidas, el cliente especifica una función de devolución de llamada con [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) que responde al caso de devolución de llamada de redirección.</span><span class="sxs-lookup"><span data-stu-id="36ff7-138">To clear the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="36ff7-139">El controlador de devolución de llamada debe borrar la cookie que se envió previamente en la solicitud mediante una llamada a [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="36ff7-139">The callback handler should clear the cookie that was previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="36ff7-140">Es posible que la función de devolución de llamada no establezca cookies personalizadas nuevas en la devolución de llamada de redirección.</span><span class="sxs-lookup"><span data-stu-id="36ff7-140">The callback function may not set new custom cookies on the redirect callback.</span></span> <span data-ttu-id="36ff7-141">El cliente debe esperar a que se complete **WinHttpReceiveResponse** antes de agregar nuevas cookies para la siguiente llamada a **WinHttpSendRequest** .</span><span class="sxs-lookup"><span data-stu-id="36ff7-141">The client must wait for **WinHttpReceiveResponse** to complete before adding new cookies for the next **WinHttpSendRequest** call.</span></span>

## <a name="removing-cookie-headers"></a><span data-ttu-id="36ff7-142">Quitar encabezados de cookies</span><span class="sxs-lookup"><span data-stu-id="36ff7-142">Removing Cookie Headers</span></span>

<span data-ttu-id="36ff7-143">Es posible que la aplicación cliente WinHTTP tenga que borrar la cookie de solicitud existente antes de volver a enviar una solicitud para evitar que las cookies enviadas en solicitudes anteriores se envíen de nuevo en la solicitud actual. para obtener más información, vea la nota siguiente.</span><span class="sxs-lookup"><span data-stu-id="36ff7-143">The WinHTTP client application may need to clear the existing request cookie before resending a request to prevent cookies that were sent on previous requests from being sent again on the current request; for more information, see the following Note.</span></span> <span data-ttu-id="36ff7-144">Tenga en cuenta también que no es necesario borrar las cookies antes de que se envíe la primera solicitud en el identificador de solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-144">Also be aware that Cookies do not have to be cleared before the first request is sent on the request handle.</span></span> <span data-ttu-id="36ff7-145">El cliente puede borrar las cookies existentes mediante una llamada a [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) con un encabezado de cookie vacío en el parámetro *pwszHeaders* y el indicador de \_ \_ reemplazo de la marca de WinHTTP ADDREQ \_ establecido en el parámetro *dwModifier* .</span><span class="sxs-lookup"><span data-stu-id="36ff7-145">The client can clear existing cookies by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) with an empty cookie header in the *pwszHeaders* parameter and the WINHTTP\_ADDREQ\_FLAG\_REPLACE flag set in the *dwModifier* parameter.</span></span> <span data-ttu-id="36ff7-146">En el ejemplo de código siguiente se muestra cómo borrar el encabezado de la cookie en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-146">The following code example shows how to clear the cookie header on the request.</span></span>

``` syntax
WinHttpAddRequestHeaders( hRequest, 
                          L"Cookie:", 
                          -1, 
                          WINHTTP_ADDREQ_FLAG_REPLACE);
```

<span data-ttu-id="36ff7-147">La API WinHTTP tiene distintos comportamientos de control de cookies para las versiones del sistema operativo anteriores a Windows XP con Service Pack 2 (SP2) y Windows Server 2003 con Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="36ff7-147">The WinHTTP API has different cookie handling behaviors for versions of the operating system earlier than Windows XP with Service Pack 2 (SP2) and Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="36ff7-148">\* \* Windows XP con SP2 y versiones posteriores y Windows Server 2003 con SP1 y versiones posteriores: \* \*</span><span class="sxs-lookup"><span data-stu-id="36ff7-148">\*\*Windows XP with SP2 and later and Windows Server 2003 with SP1 and later:  \*\*</span></span>

<span data-ttu-id="36ff7-149">La API WinHTTP borra todas las cookies enviadas en las solicitudes anteriores para el identificador de solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-149">The WinHTTP API clears all cookies sent on previous requests for the request handle.</span></span> <span data-ttu-id="36ff7-150">El cliente puede Agregar manualmente nuevos encabezados de cookie antes de cada llamada a WinHttpSendRequest.</span><span class="sxs-lookup"><span data-stu-id="36ff7-150">The client can manually add new cookie headers before each call to WinHttpSendRequest.</span></span> <span data-ttu-id="36ff7-151">Si la funcionalidad de control de cookies automática de la API WinHTTP no se ha deshabilitado, la API de WinHTTP anexará el nuevo encabezado de cookie (o agregará un encabezado de cookie nuevo si la aplicación cliente no agregó uno manualmente) con la cookie del servidor.</span><span class="sxs-lookup"><span data-stu-id="36ff7-151">If the automatic cookie handling functionality of the WinHTTP API has not been disabled, the WinHTTP API will append the new cookie header (or add a new cookie header if the client application did not add one manually) with the cookie from the server.</span></span>

<span data-ttu-id="36ff7-152">\* \* Windows XP con SP2 y Windows Server 2003 con SP1: \* \*</span><span class="sxs-lookup"><span data-stu-id="36ff7-152">\*\*Windows XP with SP2 and Windows Server 2003 with SP1:  \*\*</span></span>

<span data-ttu-id="36ff7-153">La API de WinHTTP no borra el encabezado de la cookie de solicitud una vez finalizada la [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) .</span><span class="sxs-lookup"><span data-stu-id="36ff7-153">The WinHTTP API does not clear the request cookie header after [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) completes.</span></span> <span data-ttu-id="36ff7-154">Las cookies enviadas en solicitudes anteriores se reenviarán en las llamadas posteriores a [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span><span class="sxs-lookup"><span data-stu-id="36ff7-154">Cookies sent in previous requests will be resent in subsequent calls to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span> <span data-ttu-id="36ff7-155">La aplicación cliente WinHTTP debe borrar los encabezados de cookies existentes antes de volver a enviar una solicitud en el identificador de solicitud.</span><span class="sxs-lookup"><span data-stu-id="36ff7-155">The WinHTTP client application should clear existing cookies headers before resending a request on the request handle.</span></span>

 

 



