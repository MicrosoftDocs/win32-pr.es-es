---
description: Estados de filtro
ms.assetid: 97418307-eb50-4c8e-b03b-a2cd08139bdc
title: Estados de filtro
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2d61f66e1446d97d289f7e489f116f747f339d9a
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "105652323"
---
# <a name="filter-states"></a><span data-ttu-id="44680-103">Estados de filtro</span><span class="sxs-lookup"><span data-stu-id="44680-103">Filter States</span></span>

<span data-ttu-id="44680-104">Los filtros tienen tres Estados posibles: detenido, en pausa y en ejecución.</span><span class="sxs-lookup"><span data-stu-id="44680-104">Filters have three possible states: stopped, paused, and running.</span></span> <span data-ttu-id="44680-105">El propósito del estado de pausa es indicar los datos en el gráfico, de modo que un comando de ejecución responda inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="44680-105">The purpose of the paused state is to cue data in the graph, so that a run command responds immediately.</span></span> <span data-ttu-id="44680-106">El administrador de gráficos de filtro controla todas las transiciones de estado.</span><span class="sxs-lookup"><span data-stu-id="44680-106">The Filter Graph Manager controls all state transitions.</span></span> <span data-ttu-id="44680-107">Cuando una aplicación llama a [**IMediaControl:: Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run), [**IMediaControl::P ause**](/windows/desktop/api/Control/nf-control-imediacontrol-pause)o [**IMediaControl:: Stop**](/windows/desktop/api/Control/nf-control-imediacontrol-stop), el administrador de gráficos de filtro llama al método [**IMediaFilter**](/windows/desktop/api/Strmif/nn-strmif-imediafilter) correspondiente en todos los filtros.</span><span class="sxs-lookup"><span data-stu-id="44680-107">When an application calls [**IMediaControl::Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run), [**IMediaControl::Pause**](/windows/desktop/api/Control/nf-control-imediacontrol-pause), or [**IMediaControl::Stop**](/windows/desktop/api/Control/nf-control-imediacontrol-stop), the Filter Graph Manager calls the corresponding [**IMediaFilter**](/windows/desktop/api/Strmif/nn-strmif-imediafilter) method on all of the filters.</span></span> <span data-ttu-id="44680-108">Las transiciones entre Stopped y Running siempre pasan por el estado de pausa, por lo que si la aplicación llama a **ejecutada** en un gráfico detenido, el administrador de gráficos de filtro pausa el gráfico antes de ejecutarlo.</span><span class="sxs-lookup"><span data-stu-id="44680-108">Transitions between stopped and running always go through the paused state, so if the application calls **Run** on a stopped graph, the Filter Graph Manager pauses the graph before running it.</span></span>

<span data-ttu-id="44680-109">Para la mayoría de los filtros, los Estados en ejecución y en pausa son idénticos.</span><span class="sxs-lookup"><span data-stu-id="44680-109">For most filters, the running and paused states are identical.</span></span> <span data-ttu-id="44680-110">Considere el siguiente gráfico de filtros:</span><span class="sxs-lookup"><span data-stu-id="44680-110">Consider the following filter graph:</span></span>

<span data-ttu-id="44680-111">> representador de transformación de > de origen</span><span class="sxs-lookup"><span data-stu-id="44680-111">Source > Transform > Renderer</span></span>

<span data-ttu-id="44680-112">Supongamos por ahora que el filtro de origen no es un origen de captura en directo.</span><span class="sxs-lookup"><span data-stu-id="44680-112">Assume for now that the source filter is not a live capture source.</span></span> <span data-ttu-id="44680-113">Cuando el filtro de origen se pausa, crea un subproceso que genera nuevos datos y los escribe en los ejemplos multimedia lo más rápido posible.</span><span class="sxs-lookup"><span data-stu-id="44680-113">When the source filter pauses, it creates a thread that generates new data and writes it into media samples as quickly as possible.</span></span> <span data-ttu-id="44680-114">El subproceso "envía" los ejemplos inferiores llamando a [**IMemInputPin:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) en el PIN de entrada del filtro de transformación.</span><span class="sxs-lookup"><span data-stu-id="44680-114">The thread "pushes" the samples downstream by calling [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) on the transform filter's input pin.</span></span> <span data-ttu-id="44680-115">El filtro de transformación recibe los ejemplos en el subproceso del filtro de origen.</span><span class="sxs-lookup"><span data-stu-id="44680-115">The transform filter receives the samples on the source filter's thread.</span></span> <span data-ttu-id="44680-116">Puede usar un subproceso de trabajo para entregar los ejemplos al representador, pero normalmente los entrega en el mismo subproceso.</span><span class="sxs-lookup"><span data-stu-id="44680-116">It may use a worker thread to deliver the samples to the renderer, but typically it delivers them on the same thread.</span></span> <span data-ttu-id="44680-117">Mientras el representador está en pausa, espera a recibir un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="44680-117">While the renderer is paused, it waits to receive a sample.</span></span> <span data-ttu-id="44680-118">Una vez que recibe uno, lo bloquea y contiene ese ejemplo indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="44680-118">After it receives one, it blocks and holds that sample indefinitely.</span></span> <span data-ttu-id="44680-119">Si se trata de un representador de vídeo, muestra el ejemplo como una imagen de póster y vuelve a dibujar la imagen según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="44680-119">If it is a video renderer, it displays the sample as a poster image, repainting the image as necessary.</span></span>

<span data-ttu-id="44680-120">En este momento, el flujo está totalmente preparado y listo para la representación.</span><span class="sxs-lookup"><span data-stu-id="44680-120">At this point, the stream is fully cued and ready for rendering.</span></span> <span data-ttu-id="44680-121">Si el gráfico permanece en pausa, los ejemplos se "amontonarán" en el gráfico detrás del primer ejemplo, hasta que todos los filtros se bloqueen en la [**recepción**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) o [**IMemAllocator:: getBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer).</span><span class="sxs-lookup"><span data-stu-id="44680-121">If the graph remains paused, samples will "pile up" in the graph behind the first sample, until every filter is blocked in [**Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) or [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer).</span></span> <span data-ttu-id="44680-122">Sin embargo, no se pierden datos.</span><span class="sxs-lookup"><span data-stu-id="44680-122">No data is lost, though.</span></span> <span data-ttu-id="44680-123">Una vez desbloqueado el subproceso de origen, simplemente se reanuda desde el punto en el que se bloqueó.</span><span class="sxs-lookup"><span data-stu-id="44680-123">Once the source thread is unblocked, it simply resumes from the point where it blocked.</span></span>

<span data-ttu-id="44680-124">El filtro de origen y el filtro de transformación omiten la transición de en pausa a en ejecución; simplemente continúan procesando los datos lo más rápido posible.</span><span class="sxs-lookup"><span data-stu-id="44680-124">The source filter and the transform filter ignore the transition from paused to running—they simply continue to process data as fast as possible.</span></span> <span data-ttu-id="44680-125">Pero cuando se ejecuta el representador, se inician los ejemplos de representación.</span><span class="sxs-lookup"><span data-stu-id="44680-125">But when the renderer runs, it starts rendering samples.</span></span> <span data-ttu-id="44680-126">En primer lugar, representa el ejemplo que se mantiene mientras estaba en pausa.</span><span class="sxs-lookup"><span data-stu-id="44680-126">First it renders the sample it held while it was paused.</span></span> <span data-ttu-id="44680-127">Después, cada vez que recibe un nuevo ejemplo, calcula el tiempo de presentación del ejemplo.</span><span class="sxs-lookup"><span data-stu-id="44680-127">Then, each time it receives a new sample, it calculates the sample's presentation time.</span></span> <span data-ttu-id="44680-128">(Para obtener más información, consulte [hora y relojes en DirectShow](time-and-clocks-in-directshow.md)). El representador contiene cada ejemplo hasta el momento de la presentación, momento en el que representa el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="44680-128">(For details, see [Time and Clocks in DirectShow](time-and-clocks-in-directshow.md).) The renderer holds each sample until the presentation time, at which point it renders the sample.</span></span> <span data-ttu-id="44680-129">Mientras espera el tiempo de presentación, se bloquea en el método [**Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) o recibe nuevos ejemplos en un subproceso de trabajo con una cola.</span><span class="sxs-lookup"><span data-stu-id="44680-129">While it waits for the presentation time, it either blocks in the [**Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) method, or receives new samples on a worker thread with a queue.</span></span> <span data-ttu-id="44680-130">Los filtros ascendentes del representador no están implicados en la programación.</span><span class="sxs-lookup"><span data-stu-id="44680-130">Filters upstream from the renderer are not involved in scheduling.</span></span>

<span data-ttu-id="44680-131">Los orígenes en directo, como los dispositivos de captura, son una excepción a esta arquitectura general.</span><span class="sxs-lookup"><span data-stu-id="44680-131">Live sources, such as capture devices, are an exception to this general architecture.</span></span> <span data-ttu-id="44680-132">Con un origen en directo, no es adecuado señalar ningún dato de antemano.</span><span class="sxs-lookup"><span data-stu-id="44680-132">With a live source, it is not appropriate to cue any data in advance.</span></span> <span data-ttu-id="44680-133">La aplicación podría pausar el gráfico y esperar mucho tiempo antes de ejecutarlo.</span><span class="sxs-lookup"><span data-stu-id="44680-133">The application might pause the graph and then wait for a long time before running it.</span></span> <span data-ttu-id="44680-134">El gráfico no debe presentar muestras "obsoletas".</span><span class="sxs-lookup"><span data-stu-id="44680-134">The graph should not render "stale" samples.</span></span> <span data-ttu-id="44680-135">Por lo tanto, un origen en directo no genera ninguna muestra mientras se está en pausa, solo durante la ejecución.</span><span class="sxs-lookup"><span data-stu-id="44680-135">Therefore, a live source produces no samples while paused, only while running.</span></span> <span data-ttu-id="44680-136">Para indicar este hecho al administrador de gráficos de filtro, el método [**IMediaFilter:: GetState**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-getstate) del filtro de origen devuelve la pila de no \_ \_ peralte de VFW \_ .</span><span class="sxs-lookup"><span data-stu-id="44680-136">To signal this fact to the Filter Graph Manager, the source filter's [**IMediaFilter::GetState**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-getstate) method returns VFW\_S\_CANT\_CUE.</span></span> <span data-ttu-id="44680-137">Este código de retorno indica que el filtro ha cambiado al estado en pausa, aunque el representador no haya recibido ningún dato.</span><span class="sxs-lookup"><span data-stu-id="44680-137">This return code indicates that the filter has switched to the paused state, even though the renderer did not receive any data.</span></span>

<span data-ttu-id="44680-138">Cuando se detiene un filtro, se rechazan todos los ejemplos que se le hayan entregado.</span><span class="sxs-lookup"><span data-stu-id="44680-138">When a filter stops, it rejects any more samples delivered to it.</span></span> <span data-ttu-id="44680-139">Los filtros de origen apagan los subprocesos de streaming y otros filtros apagan los subprocesos de trabajo que pueden haber creado.</span><span class="sxs-lookup"><span data-stu-id="44680-139">Source filters shut down their streaming threads, and other filters shut down any worker threads they may have created.</span></span> <span data-ttu-id="44680-140">Los pin anulan la confirmación de los asignadores.</span><span class="sxs-lookup"><span data-stu-id="44680-140">Pins decommit their allocators.</span></span>

### <a name="state-transitions"></a><span data-ttu-id="44680-141">Transiciones de estado</span><span class="sxs-lookup"><span data-stu-id="44680-141">State Transitions</span></span>

<span data-ttu-id="44680-142">Filter Graph Manager realiza todas las transiciones de estado en orden ascendente, comenzando por el representador y trabajando hacia atrás hasta el filtro de origen.</span><span class="sxs-lookup"><span data-stu-id="44680-142">The Filter Graph Manager carries out all state transitions in upstream order, starting from the renderer and working backward to the source filter.</span></span> <span data-ttu-id="44680-143">Esta ordenación es necesaria para evitar que se quiten las muestras y evitar que el gráfico se interbloquee.</span><span class="sxs-lookup"><span data-stu-id="44680-143">This ordering is necessary to prevent samples from being dropped and to prevent the graph from deadlocking.</span></span> <span data-ttu-id="44680-144">Las transiciones de estado más cruciales están entre pausada y detenida:</span><span class="sxs-lookup"><span data-stu-id="44680-144">The most crucial state transitions are between paused and stopped:</span></span>

-   <span data-ttu-id="44680-145">Detenido para pausarse: a medida que cada filtro se pausa, está listo para recibir muestras del filtro siguiente.</span><span class="sxs-lookup"><span data-stu-id="44680-145">Stopped to paused: As each filter pauses, it becomes ready to receive samples from the next filter.</span></span> <span data-ttu-id="44680-146">El filtro de origen es el último que se va a pausar.</span><span class="sxs-lookup"><span data-stu-id="44680-146">The source filter is the last to pause.</span></span> <span data-ttu-id="44680-147">Crea el subproceso de streaming y comienza a entregar ejemplos.</span><span class="sxs-lookup"><span data-stu-id="44680-147">It creates the streaming thread and begins delivering samples.</span></span> <span data-ttu-id="44680-148">Dado que todos los filtros de nivel inferior están en pausa, ningún filtro rechaza ningún ejemplo.</span><span class="sxs-lookup"><span data-stu-id="44680-148">Because all of the downstream filters are paused, no filter rejects any samples.</span></span> <span data-ttu-id="44680-149">El administrador de gráficos de filtro no completa la transición hasta que todos los representadores del grafo hayan recibido un ejemplo (con la excepción de los orígenes en directo, como se describió anteriormente).</span><span class="sxs-lookup"><span data-stu-id="44680-149">The Filter Graph Manager does not complete the transition until every renderer in the graph has received a sample (with the exception of live sources, as described earlier).</span></span>
-   <span data-ttu-id="44680-150">Pausado para detenerse: cuando se detiene un filtro, libera cualquier ejemplo que contiene, lo que desbloquea los filtros ascendentes que esperan en [**getBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer).</span><span class="sxs-lookup"><span data-stu-id="44680-150">Paused to stopped: When a filter stops, it releases any samples that it holds, which unblocks any upstream filters waiting in [**GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer).</span></span> <span data-ttu-id="44680-151">Si el filtro está esperando un recurso dentro del método [**Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) , deja de esperar y vuelve de **Receive**, que desbloquea el filtro de llamada.</span><span class="sxs-lookup"><span data-stu-id="44680-151">If the filter is waiting for a resource inside the [**Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) method, it stops waiting and returns from **Receive**, which unblocks the calling filter.</span></span> <span data-ttu-id="44680-152">Por lo tanto, cuando el administrador de gráficos de filtro detiene el siguiente filtro ascendente, ese filtro no se bloquea en **getBuffer** ni en **Receive**, y puede responder al comando STOP.</span><span class="sxs-lookup"><span data-stu-id="44680-152">Therefore, when the Filter Graph Manager stops the next upstream filter, that filter is not blocked in either **GetBuffer** or **Receive**, and can respond to the stop command.</span></span> <span data-ttu-id="44680-153">El filtro de nivel superior podría ofrecer algunos ejemplos adicionales antes de obtener el comando de detención, pero el filtro de bajada simplemente los rechaza, porque ya se ha detenido.</span><span class="sxs-lookup"><span data-stu-id="44680-153">The upstream filter might deliver a few extra samples before it gets the stop command, but the downstream filter simply rejects them, because it already stopped.</span></span>

## <a name="related-topics"></a><span data-ttu-id="44680-154">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="44680-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="44680-155">Flujo de datos en el gráfico de filtros</span><span class="sxs-lookup"><span data-stu-id="44680-155">Data Flow in the Filter Graph</span></span>](data-flow-in-the-filter-graph.md)
</dt> </dl>

 

 



