---
title: Implementar el objeto COM del menú contextual
description: Una extensión de menú contextual es un objeto COM implementado como un servidor en proceso.
ms.assetid: 362dd8e5-1518-4bf4-ac53-115263cd6c62
ms.tgt_platform: multiple
keywords:
- menú contextual objeto COM AD
- menú contextual objeto COM AD, implementar
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a34d6b487d130327b379ed845f2d0157f2b28056
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "105656334"
---
# <a name="implementing-the-context-menu-com-object"></a><span data-ttu-id="4381a-105">Implementar el objeto COM del menú contextual</span><span class="sxs-lookup"><span data-stu-id="4381a-105">Implementing the Context Menu COM Object</span></span>

<span data-ttu-id="4381a-106">Una extensión de menú contextual es un objeto COM implementado como un servidor en proceso.</span><span class="sxs-lookup"><span data-stu-id="4381a-106">A context menu extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="4381a-107">La extensión del menú contextual debe implementar las interfaces [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) y [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) .</span><span class="sxs-lookup"><span data-stu-id="4381a-107">The context menu extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interfaces.</span></span> <span data-ttu-id="4381a-108">Se crea una instancia de una extensión de menú contextual cuando el usuario muestra el menú contextual de un objeto de una clase para la que se ha registrado la extensión del menú contextual.</span><span class="sxs-lookup"><span data-stu-id="4381a-108">A context menu extension is instantiated when the user displays the context menu for an object of a class for which the context menu extension has been registered.</span></span>

## <a name="implementing-ishellextinit"></a><span data-ttu-id="4381a-109">Implementación de IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="4381a-109">Implementing IShellExtInit</span></span>

<span data-ttu-id="4381a-110">Después de crear una instancia del objeto COM de la extensión del menú contextual, se llama al método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) .</span><span class="sxs-lookup"><span data-stu-id="4381a-110">After the context menu extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="4381a-111">**IShellExtInit:: Initialize** proporciona la extensión de menú contextual con un objeto [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) que contiene los datos pertinentes para el objeto de directorio al que se aplica el menú contextual.</span><span class="sxs-lookup"><span data-stu-id="4381a-111">**IShellExtInit::Initialize** supplies the context menu extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data pertinent to the directory object that the context menu applies to.</span></span>

<span data-ttu-id="4381a-112">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contiene datos en el formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="4381a-112">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="4381a-113">El formato de datos **\_ DSOBJECTNAMES de CFSTR** es un **HGLOBAL** que contiene una estructura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="4381a-113">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="4381a-114">La estructura **DSOBJECTNAMES** contiene datos sobre el objeto de directorio al que se aplica la extensión de la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="4381a-114">The **DSOBJECTNAMES** structure contains data about the directory object that the property sheet extension applies to.</span></span>

<span data-ttu-id="4381a-115">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) también contiene datos en el formato [**CFSTR \_ DS \_ Display \_ Spec \_ Options**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="4381a-115">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="4381a-116">El formato de datos **CFSTR \_ DS \_ Display \_ Spec \_ Options** es un **HGLOBAL** que contiene una estructura [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="4381a-116">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="4381a-117">**DSDISPLAYSPECOPTIONS** contiene datos de configuración para su uso por la extensión.</span><span class="sxs-lookup"><span data-stu-id="4381a-117">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="4381a-118">Si se devuelve cualquier valor que no sea **\_ correcto** desde [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), no se utilizará la extensión del menú contextual.</span><span class="sxs-lookup"><span data-stu-id="4381a-118">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the context menu extension will not be used.</span></span>

<span data-ttu-id="4381a-119">No se usan los parámetros *pidlFolder* y *HkeyProgID* del método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) .</span><span class="sxs-lookup"><span data-stu-id="4381a-119">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

## <a name="implementing-icontextmenu"></a><span data-ttu-id="4381a-120">Implementación de IContextMenu</span><span class="sxs-lookup"><span data-stu-id="4381a-120">Implementing IContextMenu</span></span>

<span data-ttu-id="4381a-121">Después de que [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) devuelva, se llama al método [**IContextMenu:: QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) para obtener el elemento de menú o los elementos que agregará la extensión del menú contextual.</span><span class="sxs-lookup"><span data-stu-id="4381a-121">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IContextMenu::QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) method is called to obtain the menu item or items that the context menu extension will add.</span></span> <span data-ttu-id="4381a-122">La implementación de **QueryContextMenu** es bastante sencilla.</span><span class="sxs-lookup"><span data-stu-id="4381a-122">The **QueryContextMenu** implementation is fairly straightforward.</span></span> <span data-ttu-id="4381a-123">La extensión del menú contextual agrega sus elementos de menú mediante la función [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) o similar.</span><span class="sxs-lookup"><span data-stu-id="4381a-123">The context menu extension adds its menu items using the [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) or similar function.</span></span> <span data-ttu-id="4381a-124">Los identificadores de comando de menú deben ser mayores o iguales que *idCmdFirst* y deben ser menores que *idCmdLast*.</span><span class="sxs-lookup"><span data-stu-id="4381a-124">The menu command identifiers must be greater than or equal to *idCmdFirst* and must be less than *idCmdLast*.</span></span> <span data-ttu-id="4381a-125">**QueryContextMenu** debe devolver el identificador numérico más alto agregado al menú más uno.</span><span class="sxs-lookup"><span data-stu-id="4381a-125">**QueryContextMenu** must return the greatest numeric identifier added to the menu plus one.</span></span> <span data-ttu-id="4381a-126">La mejor manera de asignar identificadores de comando de menú es comenzar por cero y subir en orden.</span><span class="sxs-lookup"><span data-stu-id="4381a-126">The best way to assign menu command identifiers is to start at zero and work up in sequence.</span></span> <span data-ttu-id="4381a-127">Si la extensión del menú contextual no necesita ningún elemento de menú, simplemente no debe agregar ningún elemento al menú y devolver cero desde **QueryContextMenu**.</span><span class="sxs-lookup"><span data-stu-id="4381a-127">If the context menu extension does not need to any menu items, it should simply not add any items to the menu and return zero from **QueryContextMenu**.</span></span>

<span data-ttu-id="4381a-128">Se llama a [**IContextMenu:: GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) para recuperar datos de texto para el elemento de menú, como el texto de ayuda que se va a mostrar para el elemento de menú.</span><span class="sxs-lookup"><span data-stu-id="4381a-128">[**IContextMenu::GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) is called to retrieve textual data for the menu item, such as help text to be displayed for the menu item.</span></span> <span data-ttu-id="4381a-129">Es posible que el host del menú contextual use cadenas Unicode, mientras que la extensión utiliza cadenas ANSI.</span><span class="sxs-lookup"><span data-stu-id="4381a-129">It is possible that the context menu host will use Unicode strings while the extension uses ANSI strings.</span></span> <span data-ttu-id="4381a-130">Por este motivo, los casos de **GC \_ HELPTEXTA**, **GC \_ HELPTEXTW**, los **GC \_ verboa** y **GC \_ VERBW** deben administrarse individualmente.</span><span class="sxs-lookup"><span data-stu-id="4381a-130">Because of this, the **GCS\_HELPTEXTA**, **GCS\_HELPTEXTW**, **GCS\_VERBA** and **GCS\_VERBW** cases must be handled individually.</span></span> <span data-ttu-id="4381a-131">La implementación de este método es opcional.</span><span class="sxs-lookup"><span data-stu-id="4381a-131">Implementation of this method is optional.</span></span>

<span data-ttu-id="4381a-132">Se llama a [**IContextMenu:: InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) cuando se selecciona uno de los elementos de menú instalados por la extensión del menú contextual.</span><span class="sxs-lookup"><span data-stu-id="4381a-132">[**IContextMenu::InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) is called when one of the menu items installed by the context menu extension is selected.</span></span> <span data-ttu-id="4381a-133">El menú contextual realiza o inicia las acciones deseadas en respuesta a este método.</span><span class="sxs-lookup"><span data-stu-id="4381a-133">The context menu performs or initiates the desired actions in response to this method.</span></span>

 

 