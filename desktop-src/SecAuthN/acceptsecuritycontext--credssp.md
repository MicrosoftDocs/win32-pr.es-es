---
description: Permite al componente de servidor de una aplicación de transporte establecer un contexto de seguridad entre el servidor y un cliente remoto.
ms.assetid: a53f733e-b646-4431-b021-a2c446308849
title: AcceptSecurityContext (CredSSP) (función)
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 681e03ea15729cc8726d63551e8b7b0a2b39ecac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105720552"
---
# <a name="acceptsecuritycontext-credssp-function"></a><span data-ttu-id="1fb8a-103">AcceptSecurityContext (CredSSP) (función)</span><span class="sxs-lookup"><span data-stu-id="1fb8a-103">AcceptSecurityContext (CredSSP) function</span></span>

<span data-ttu-id="1fb8a-104">La función **AcceptSecurityContext (CredSSP)** permite al componente de servidor de una aplicación de transporte establecer un contexto de seguridad entre el servidor y un cliente remoto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-104">The **AcceptSecurityContext (CredSSP)** function lets the server component of a transport application establish a security context between the server and a remote client.</span></span> <span data-ttu-id="1fb8a-105">El cliente remoto llama a la función [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) para iniciar el proceso de establecer un contexto de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-105">The remote client calls the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="1fb8a-106">El servidor puede requerir uno o más tokens de respuesta del cliente remoto para completar el establecimiento del contexto de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="1fb8a-107">Sintaxis</span><span class="sxs-lookup"><span data-stu-id="1fb8a-107">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        unsigned long  fContextReq,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```

## <a name="parameters"></a><span data-ttu-id="1fb8a-108">Parámetros</span><span class="sxs-lookup"><span data-stu-id="1fb8a-108">Parameters</span></span>

<span data-ttu-id="1fb8a-109">*phCredential* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-109">*phCredential* \[in, optional\]</span></span>

<span data-ttu-id="1fb8a-110">Identificador de las credenciales del servidor.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-110">A handle to the server credentials.</span></span> <span data-ttu-id="1fb8a-111">Para recuperar este identificador, el servidor llama a la función [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) con el valor de SECPKG \_ CRED \_ entrante o SECPKG \_ CRED \_ ambos establecidos.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-111">To retrieve this handle, the server calls the [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set.</span></span>

<span data-ttu-id="1fb8a-112">*phContext* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-112">*phContext* \[in, optional\]</span></span>

<span data-ttu-id="1fb8a-113">Puntero a una estructura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="1fb8a-114">En la primera llamada a **AcceptSecurityContext (CredSSP)**, este puntero es **null**.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-114">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer is **NULL**.</span></span> <span data-ttu-id="1fb8a-115">En las llamadas posteriores, *phContext* especifica el contexto parcialmente formado que devuelve el parámetro *phNewContext* en la primera llamada.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-115">On subsequent calls, *phContext* specifies the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="1fb8a-116">*pInput* \[ en, opcional\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-116">*pInput* \[in, optional\]</span></span>

<span data-ttu-id="1fb8a-117">Puntero a una estructura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) generada por una llamada de cliente a [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="1fb8a-118">La estructura contiene el descriptor de búfer de entrada.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-118">The structure contains the input buffer descriptor.</span></span>

<span data-ttu-id="1fb8a-119">El primer búfer debe ser del tipo **SECBUFFER \_ token** y contener el token de seguridad recibido del cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-119">The first buffer must be of type **SECBUFFER\_TOKEN** and contain the security token received from the client.</span></span> <span data-ttu-id="1fb8a-120">El segundo búfer debe ser de tipo **SECBUFFER \_ vacío**.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-120">The second buffer should be of type **SECBUFFER\_EMPTY**.</span></span>

<span data-ttu-id="1fb8a-121">*fContextReq* \[ de\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-121">*fContextReq* \[in\]</span></span>

<span data-ttu-id="1fb8a-122">: Marcas de bits que especifican los atributos requeridos por el servidor para establecer el contexto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-122">-Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="1fb8a-123">**Las marcas de bits** se pueden combinar mediante operaciones OR bit a bit.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-123">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="1fb8a-124">Este parámetro puede ser uno o varios de los valores siguientes.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-124">This parameter can be one or more of the following values.</span></span>

| <span data-ttu-id="1fb8a-125">Value</span><span class="sxs-lookup"><span data-stu-id="1fb8a-125">Value</span></span>                          | <span data-ttu-id="1fb8a-126">Significado</span><span class="sxs-lookup"><span data-stu-id="1fb8a-126">Meaning</span></span>                                                                                                                                                                                                        |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1fb8a-127">**ASC \_ req \_ asignar \_ memoria**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-127">**ASC\_REQ\_ALLOCATE\_MEMORY**</span></span> | <span data-ttu-id="1fb8a-128">El proveedor de compatibilidad para seguridad de credenciales (CredSSP) asignará búferes de salida.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-128">Credential Security Support Provider (CredSSP) will allocate output buffers.</span></span> <span data-ttu-id="1fb8a-129">Cuando haya terminado de usar los búferes de salida, liberelos mediante una llamada a la función [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-129">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span> |
| <span data-ttu-id="1fb8a-130">**\_conexión de REQ de ASC \_**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-130">**ASC\_REQ\_CONNECTION**</span></span>       | <span data-ttu-id="1fb8a-131">El contexto de seguridad no controlará los mensajes de formato.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-131">The security context will not handle formatting messages.</span></span>                                                                                                                                                      |
| <span data-ttu-id="1fb8a-132">**\_delegado de REQ de ASC \_**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-132">**ASC\_REQ\_DELEGATE**</span></span>         | <span data-ttu-id="1fb8a-133">El servidor puede suplantar al cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-133">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="1fb8a-134">Omita esta marca para la delegación restringida.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-134">Ignore this flag for constrained delegation.</span></span>                                                         |
| <span data-ttu-id="1fb8a-135">**\_error de solicitud \_ EXTENDIda ASC \_**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-135">**ASC\_REQ\_EXTENDED\_ERROR**</span></span>  | <span data-ttu-id="1fb8a-136">Cuando se produzcan errores, se notificará a la parte remota.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-136">When errors occur, the remote party will be notified.</span></span>                                                                                                                                                          |
| <span data-ttu-id="1fb8a-137">**\_detección de \_ repeticiones de ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-137">**ASC\_REQ\_REPLAY\_DETECT**</span></span>   | <span data-ttu-id="1fb8a-138">Detectar paquetes reproducidos.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-138">Detect replayed packets.</span></span>                                                                                                                                                                                       |
| <span data-ttu-id="1fb8a-139">**\_detección de \_ secuencia de REQ de ASC \_**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-139">**ASC\_REQ\_SEQUENCE\_DETECT**</span></span> | <span data-ttu-id="1fb8a-140">Detecta mensajes recibidos de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-140">Detect messages received out of sequence.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="1fb8a-141">**\_flujo de REQ de ASC \_**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-141">**ASC\_REQ\_STREAM**</span></span>           | <span data-ttu-id="1fb8a-142">Admitir una conexión orientada a flujos.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-142">Support a stream-oriented connection.</span></span>                                                                                                                                                                          |

<span data-ttu-id="1fb8a-143">Para ver posibles marcas de atributo y su significado, vea [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-143">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="1fb8a-144">Las marcas usadas para este parámetro llevan el prefijo ASC \_ req, por ejemplo, \_ el \_ delegado de REQ.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-144">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="1fb8a-145">Es posible que el cliente no admita los atributos solicitados.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-145">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="1fb8a-146">Para obtener más información, consulte el parámetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-146">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="1fb8a-147">*TargetDataRep* \[ de\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-147">*TargetDataRep* \[in\]</span></span>

<span data-ttu-id="1fb8a-148">Representación de los datos, como el orden de los bytes, en el destino.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-148">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="1fb8a-149">Este parámetro puede ser **\_ \_ DREP nativo de seguridad** o **\_ \_ DREP de seguridad de red**.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-149">This parameter can be either **SECURITY\_NATIVE\_DREP** or **SECURITY\_NETWORK\_DREP**.</span></span>

<span data-ttu-id="1fb8a-150">*phNewContext* \[ in, out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-150">*phNewContext* \[in, out, optional\]</span></span>

<span data-ttu-id="1fb8a-151">Puntero a una estructura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-151">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="1fb8a-152">En la primera llamada a **AcceptSecurityContext (CredSSP)**, este puntero recibe el nuevo identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-152">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="1fb8a-153">En las llamadas posteriores, *phNewContext* puede ser el mismo que el identificador especificado en el parámetro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-153">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="1fb8a-154">*pOutput* \[ in, out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-154">*pOutput* \[in, out, optional\]</span></span>

<span data-ttu-id="1fb8a-155">Puntero a una estructura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) que contiene el descriptor del búfer de salida.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-155">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="1fb8a-156">Este búfer se envía al cliente para la entrada en llamadas adicionales a [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-156">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="1fb8a-157">Se puede generar un búfer de salida aunque la función devuelva SEC \_ E \_ Aceptar.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-157">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="1fb8a-158">Cualquier búfer generado debe volver a enviarse a la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-158">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="1fb8a-159">En la salida, este búfer recibe un token para el contexto de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-159">On output, this buffer receives a token for the security context.</span></span> <span data-ttu-id="1fb8a-160">El token se debe enviar al cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-160">The token must be sent to the client.</span></span> <span data-ttu-id="1fb8a-161">La función también puede devolver un búfer de tipo SECBUFFER \_ extra.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-161">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span>

<span data-ttu-id="1fb8a-162">*pfContextAttr* \[ enuncia\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-162">*pfContextAttr* \[out\]</span></span>

<span data-ttu-id="1fb8a-163">Un puntero a un conjunto de marcadores de bits que indica los atributos del contexto establecido.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-163">A pointer to a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="1fb8a-164">Para obtener una descripción de los distintos atributos, vea [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-164">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="1fb8a-165">Las marcas usadas para este parámetro tienen el prefijo ASC \_ RET, por ejemplo, el delegado de ASC \_ RET \_ .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-165">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="1fb8a-166">No Compruebe los atributos relacionados con la seguridad hasta que la llamada a la función final se devuelva correctamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-166">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="1fb8a-167">Las marcas de atributo no relacionadas con la seguridad, como \_ la \_ marca ASC RET asignado \_ memoria, se pueden comprobar antes de la devolución final.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-167">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

<span data-ttu-id="1fb8a-168">*ptsExpiry* \[ out, opcional\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-168">*ptsExpiry* \[out, optional\]</span></span>

<span data-ttu-id="1fb8a-169">Puntero a una estructura de [**marca**](timestamp.md) de tiempo que recibe la hora de expiración del contexto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-169">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="1fb8a-170">Se recomienda que el paquete de seguridad devuelva siempre este valor en la hora local.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-170">We recommend that the security package always return this value in local time.</span></span>

> [!Note]  
> <span data-ttu-id="1fb8a-171">Hasta la última llamada del proceso de autenticación, la hora de expiración del contexto puede ser incorrecta porque se proporcionará más información en las fases posteriores de la negociación.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-171">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="1fb8a-172">Por lo tanto, *ptsTimeStamp* debe ser **null** hasta la última llamada a la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-172">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

## <a name="return-value"></a><span data-ttu-id="1fb8a-173">Valor devuelto</span><span class="sxs-lookup"><span data-stu-id="1fb8a-173">Return value</span></span>

<span data-ttu-id="1fb8a-174">Esta función devuelve uno de los valores siguientes.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-174">This function returns one of the following values.</span></span>

| <span data-ttu-id="1fb8a-175">Código o valor devuelto</span><span class="sxs-lookup"><span data-stu-id="1fb8a-175">Return code/value</span></span>                                   | <span data-ttu-id="1fb8a-176">Descripción</span><span class="sxs-lookup"><span data-stu-id="1fb8a-176">Description</span></span>                                                                                                                                                                 |
|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="1fb8a-177">SEC_E_INCOMPLETE_MESSAGE</span><span class="sxs-lookup"><span data-stu-id="1fb8a-177">SEC_E_INCOMPLETE_MESSAGE</span></span> <br/> <span data-ttu-id="1fb8a-178">0x80090318L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-178">0x80090318L</span></span>          | <span data-ttu-id="1fb8a-179">La función se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-179">The function succeeded.</span></span> <span data-ttu-id="1fb8a-180">Los datos del búfer de entrada están incompletos.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-180">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="1fb8a-181">La aplicación debe leer datos adicionales del cliente y llamar de nuevo a [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-181">The application must read additional data from the client and call [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) again.</span></span> |
| <span data-ttu-id="1fb8a-182">SEC_E_INSUFFICIENT_MEMORY</span><span class="sxs-lookup"><span data-stu-id="1fb8a-182">SEC_E_INSUFFICIENT_MEMORY</span></span> <br/> <span data-ttu-id="1fb8a-183">0x80090300L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-183">0x80090300L</span></span>         | <span data-ttu-id="1fb8a-184">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-184">The function failed.</span></span> <span data-ttu-id="1fb8a-185">No hay suficiente memoria disponible para completar la acción solicitada.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-185">There is not enough memory available to complete the requested action.</span></span>                                                                                 |
| <span data-ttu-id="1fb8a-186">SEC_E_INTERNAL_ERROR</span><span class="sxs-lookup"><span data-stu-id="1fb8a-186">SEC_E_INTERNAL_ERROR</span></span> <br/> <span data-ttu-id="1fb8a-187">0x80090304L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-187">0x80090304L</span></span>              | <span data-ttu-id="1fb8a-188">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-188">The function failed.</span></span> <span data-ttu-id="1fb8a-189">Error que no se ha asignado a un código de error SSPI.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-189">An error occurred that did not map to an SSPI error code.</span></span>                                                                                              |
| <span data-ttu-id="1fb8a-190">SEC_E_INVALID_HANDLE</span><span class="sxs-lookup"><span data-stu-id="1fb8a-190">SEC_E_INVALID_HANDLE</span></span> <br/> <span data-ttu-id="1fb8a-191">0x80100003L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-191">0x80100003L</span></span>              | <span data-ttu-id="1fb8a-192">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-192">The function failed.</span></span> <span data-ttu-id="1fb8a-193">El identificador pasado a la función no es válido.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-193">The handle passed to the function is not valid.</span></span>                                                                                                        |
| <span data-ttu-id="1fb8a-194">SEC_E_INVALID_TOKEN</span><span class="sxs-lookup"><span data-stu-id="1fb8a-194">SEC_E_INVALID_TOKEN</span></span> <br/> <span data-ttu-id="1fb8a-195">0x80090308L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-195">0x80090308L</span></span>               | <span data-ttu-id="1fb8a-196">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-196">The function failed.</span></span> <span data-ttu-id="1fb8a-197">El token que se ha pasado a la función no es válido.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-197">The token passed to the function is not valid.</span></span>                                                                                                         |
| <span data-ttu-id="1fb8a-198">SEC_E_LOGON_DENIED</span><span class="sxs-lookup"><span data-stu-id="1fb8a-198">SEC_E_LOGON_DENIED</span></span> <br/> <span data-ttu-id="1fb8a-199">0x8009030CL</span><span class="sxs-lookup"><span data-stu-id="1fb8a-199">0x8009030CL</span></span>                | <span data-ttu-id="1fb8a-200">Error de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-200">The logon failed.</span></span>                                                                                                                                                           |
| <span data-ttu-id="1fb8a-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span><span class="sxs-lookup"><span data-stu-id="1fb8a-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span></span> <br/> <span data-ttu-id="1fb8a-202">0x80090311L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-202">0x80090311L</span></span> | <span data-ttu-id="1fb8a-203">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-203">The function failed.</span></span> <span data-ttu-id="1fb8a-204">No se pudo establecer contacto con ninguna autoridad para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-204">No authority could be contacted for authentication.</span></span> <span data-ttu-id="1fb8a-205">Esto puede deberse a las siguientes condiciones:</span><span class="sxs-lookup"><span data-stu-id="1fb8a-205">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="1fb8a-206">El nombre de dominio de la entidad de autenticación no es correcto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-206">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="1fb8a-207">El dominio no está disponible.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-207">The domain is unavailable.</span></span></li><li><span data-ttu-id="1fb8a-208">Error en la relación de confianza.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-208">The trust relationship has failed.</span></span> |
| <span data-ttu-id="1fb8a-209">SEC_E_NO_CREDENTIALS</span><span class="sxs-lookup"><span data-stu-id="1fb8a-209">SEC_E_NO_CREDENTIALS</span></span> <br/><span data-ttu-id="1fb8a-210">0x8009030EL</span><span class="sxs-lookup"><span data-stu-id="1fb8a-210">0x8009030EL</span></span>               | <span data-ttu-id="1fb8a-211">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-211">The function failed.</span></span> <span data-ttu-id="1fb8a-212">El identificador de credenciales especificado en el parámetro *phCredential* no es válido.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-212">The credentials handle specified in the *phCredential* parameter is not valid.</span></span>                            |
| <span data-ttu-id="1fb8a-213">SEC_E_OK</span><span class="sxs-lookup"><span data-stu-id="1fb8a-213">SEC_E_OK</span></span> <br/> <span data-ttu-id="1fb8a-214">0x00000000L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-214">0x00000000L</span></span>                          | <span data-ttu-id="1fb8a-215">La función se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-215">The function succeeded.</span></span> <span data-ttu-id="1fb8a-216">Se aceptó el contexto de seguridad recibido del cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-216">The security context received from the client was accepted.</span></span> <span data-ttu-id="1fb8a-217">Si la función genera un token de salida, el token se debe enviar al proceso del cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-217">If the function generated an output token, the token must be sent to the client process.</span></span> |
| <span data-ttu-id="1fb8a-218">SEC_E_UNSUPPORTED_FUNCTION</span><span class="sxs-lookup"><span data-stu-id="1fb8a-218">SEC_E_UNSUPPORTED_FUNCTION</span></span> <br/> <span data-ttu-id="1fb8a-219">0x80090302L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-219">0x80090302L</span></span>        | <span data-ttu-id="1fb8a-220">Error en la función.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-220">The function failed.</span></span> <span data-ttu-id="1fb8a-221">El parámetro *fContextReq* especificó una marca de atributo de contexto (ASC_REQ_DELEGATE o ASC_REQ_PROMPT_FOR_CREDS) que no era válida.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-221">The *fContextReq* parameter specified a context attribute flag (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) that was not valid.</span></span>                       |
| <span data-ttu-id="1fb8a-222">SEC_I_COMPLETE_AND_CONTINUE</span><span class="sxs-lookup"><span data-stu-id="1fb8a-222">SEC_I_COMPLETE_AND_CONTINUE</span></span> <br/> <span data-ttu-id="1fb8a-223">0x00090314L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-223">0x00090314L</span></span>       | <span data-ttu-id="1fb8a-224">La función se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-224">The function succeeded.</span></span> <span data-ttu-id="1fb8a-225">El servidor debe llamar a [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) y pasar el token de salida al cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-225">The server must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="1fb8a-226">Después, el servidor debe esperar un token de devolución del cliente antes de hacer otra llamada a [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-226">The server must then wait for a return token from the client before making another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span> |
| <span data-ttu-id="1fb8a-227">SEC_I_COMPLETE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="1fb8a-227">SEC_I_COMPLETE_NEEDED</span></span> <br/> <span data-ttu-id="1fb8a-228">0x00090313L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-228">0x00090313L</span></span>             | <span data-ttu-id="1fb8a-229">La función se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-229">The function succeeded.</span></span> <span data-ttu-id="1fb8a-230">El servidor debe terminar de compilar el mensaje desde el cliente antes de llamar a [ **CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span><span class="sxs-lookup"><span data-stu-id="1fb8a-230">The server must finish building the message from the client before calling [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span></span>                             |
| <span data-ttu-id="1fb8a-231">SEC_I_CONTINUE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="1fb8a-231">SEC_I_CONTINUE_NEEDED</span></span> <br/> <span data-ttu-id="1fb8a-232">0x00090312L</span><span class="sxs-lookup"><span data-stu-id="1fb8a-232">0x00090312L</span></span>             | <span data-ttu-id="1fb8a-233">La función se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-233">The function succeeded.</span></span> <span data-ttu-id="1fb8a-234">El servidor debe enviar el token de salida al cliente y esperar un token devuelto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-234">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="1fb8a-235">El token devuelto se debe pasar en *pInput* para otra llamada a [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-235">The returned token should be passed in *pInput* for another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span>


## <a name="remarks"></a><span data-ttu-id="1fb8a-236">Observaciones</span><span class="sxs-lookup"><span data-stu-id="1fb8a-236">Remarks</span></span>

<span data-ttu-id="1fb8a-237">La función **AcceptSecurityContext (CredSSP)** es el homólogo del servidor para la función [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-237">The **AcceptSecurityContext (CredSSP)** function is the server counterpart to the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function.</span></span>

<span data-ttu-id="1fb8a-238">Cuando el servidor recibe una solicitud de un cliente, usa el parámetro *fContextReq* para especificar lo que requiere la sesión.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-238">When the server receives a request from a client, it uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="1fb8a-239">De este modo, un servidor puede requerir que los clientes sean capaces de usar una sesión confidencial o comprobada por [*integridad*](../secgloss/i-gly.md); puede rechazar clientes que no puedan satisfacer esa demanda.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-239">In this fashion, a server can require that clients be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session; it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="1fb8a-240">Como alternativa, un servidor no puede requerir nada; lo que el cliente necesita o puede proporcionar se devuelve en el parámetro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-240">Alternatively, a server can require nothing; whatever the client requires or can provide is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="1fb8a-241">Los parámetros *fContextReq* y *pfContextAttr* son máscaras de texto que representan varios atributos de contexto.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-241">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="1fb8a-242">Para obtener una descripción de los distintos atributos, vea [requisitos de contexto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="1fb8a-242">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="1fb8a-243">Aunque el parámetro *pfContextAttr* es válido en cualquier devolución correcta, debe examinar las marcas que pertenecen a los aspectos de seguridad del contexto solo en la devolución correcta final.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-243">While the *pfContextAttr* parameter is valid on any successful return, you should examine the flags pertaining to security aspects of the context only on the final successful return.</span></span> <span data-ttu-id="1fb8a-244">Las devoluciones intermedias se pueden establecer, por ejemplo, la \_ \_ marca de memoria asignada de ISC \_ .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-244">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="1fb8a-245">El autor de la llamada es responsable de determinar si los atributos de contexto finales son suficientes.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-245">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="1fb8a-246">Por ejemplo, si se solicitó la confidencialidad (cifrado) pero no se pudo establecer, algunas aplicaciones pueden optar por cerrar la conexión inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-246">For example, if confidentiality (encryption) was requested but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="1fb8a-247">Si no se puede establecer el contexto de seguridad, el servidor debe liberar el contexto creado parcialmente mediante una llamada a la función [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="1fb8a-247">If the security context cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="1fb8a-248">Para obtener información sobre cuándo se debe llamar a la función **DeleteSecurityContext** , vea **DeleteSecurityContext**.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-248">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="1fb8a-249">Una vez establecido el contexto de seguridad, la aplicación de servidor puede usar la función [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) para recuperar un identificador de la cuenta de usuario a la que se asignó el certificado de cliente.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-249">After the security context has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="1fb8a-250">Además, el servidor puede usar la función [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) para suplantar al usuario.</span><span class="sxs-lookup"><span data-stu-id="1fb8a-250">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="1fb8a-251">Requisitos</span><span class="sxs-lookup"><span data-stu-id="1fb8a-251">Requirements</span></span>

| <span data-ttu-id="1fb8a-252">Requisito</span><span class="sxs-lookup"><span data-stu-id="1fb8a-252">Requirement</span></span> | <span data-ttu-id="1fb8a-253">Value</span><span class="sxs-lookup"><span data-stu-id="1fb8a-253">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="1fb8a-254">Cliente mínimo compatible</span><span class="sxs-lookup"><span data-stu-id="1fb8a-254">Minimum supported client</span></span> | <span data-ttu-id="1fb8a-255">Solo aplicaciones de escritorio de Windows Vista \[\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-255">Windows�Vista \[desktop apps only\]</span></span>       |
| <span data-ttu-id="1fb8a-256">Servidor mínimo compatible</span><span class="sxs-lookup"><span data-stu-id="1fb8a-256">Minimum supported server</span></span> | <span data-ttu-id="1fb8a-257">Solo aplicaciones de escritorio de Windows Server 2008 \[\]</span><span class="sxs-lookup"><span data-stu-id="1fb8a-257">Windows Server�2008 \[desktop apps only\]</span></span> |
| <span data-ttu-id="1fb8a-258">Encabezado</span><span class="sxs-lookup"><span data-stu-id="1fb8a-258">Header</span></span>                   | <span data-ttu-id="1fb8a-259">SSPI. h (incluir Security. h)</span><span class="sxs-lookup"><span data-stu-id="1fb8a-259">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="1fb8a-260">Biblioteca</span><span class="sxs-lookup"><span data-stu-id="1fb8a-260">Library</span></span>                  | <span data-ttu-id="1fb8a-261">SECUR32. lib</span><span class="sxs-lookup"><span data-stu-id="1fb8a-261">Secur32.lib</span></span>                               |
| <span data-ttu-id="1fb8a-262">Archivo DLL</span><span class="sxs-lookup"><span data-stu-id="1fb8a-262">DLL</span></span>                      | <span data-ttu-id="1fb8a-263">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="1fb8a-263">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="1fb8a-264">Vea también</span><span class="sxs-lookup"><span data-stu-id="1fb8a-264">See also</span></span>

- [<span data-ttu-id="1fb8a-265">Funciones SSPI</span><span class="sxs-lookup"><span data-stu-id="1fb8a-265">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="1fb8a-266">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-266">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
- [<span data-ttu-id="1fb8a-267">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="1fb8a-267">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)
