---
description: Los solicitantes tienen la responsabilidad principal del ciclo de vida de un documento de componentes de copia de seguridad.
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: Ciclo de vida de documentos de componentes de copia de seguridad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105697792"
---
# <a name="backup-components-document-life-cycle"></a><span data-ttu-id="5333f-103">Ciclo de vida de documentos de componentes de copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="5333f-103">Backup Components Document Life Cycle</span></span>

<span data-ttu-id="5333f-104">Los solicitantes tienen la responsabilidad principal del ciclo de vida de un documento de componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5333f-104">Requesters have primary responsibility for the life cycle of a Backup Components Document.</span></span>

<span data-ttu-id="5333f-105">Este control lo ejercita una instancia del objeto de interfaz [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) devuelto por [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="5333f-105">This control is exercised by an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface object returned by [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span></span>

<span data-ttu-id="5333f-106">Un solicitante debe inicializar un documento de componentes de copia de seguridad antes de realizar una copia de seguridad o una restauración mediante una llamada a [**ivssbackupcomponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) o [**Ivssbackupcomponents:: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span><span class="sxs-lookup"><span data-stu-id="5333f-106">A requester must initialize a Backup Components Document prior to a backup or restore by calling [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) or [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span></span> <span data-ttu-id="5333f-107">El solicitante puede inicializar el documento como vacío o puede cargar una copia almacenada previamente del documento.</span><span class="sxs-lookup"><span data-stu-id="5333f-107">The requester can initialize the document as empty, or it can load a previously stored copy of the document.</span></span>

<span data-ttu-id="5333f-108">En el caso de las operaciones de copia de seguridad, un documento de componentes de copia de seguridad se inicializa normalmente como vacío.</span><span class="sxs-lookup"><span data-stu-id="5333f-108">For backup operations, a Backup Components Document is typically initialized as empty.</span></span> <span data-ttu-id="5333f-109">Sus datos se rellenarán con la cooperación de los escritores del sistema durante el procesamiento de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5333f-109">Its data will be filled in with cooperation from the system's writers in the course of processing the backup.</span></span>

<span data-ttu-id="5333f-110">En el caso de las operaciones de restauración, un documento de componentes de copia de seguridad se inicializa normalmente a partir de un documento almacenado generado durante la copia de seguridad inicial.</span><span class="sxs-lookup"><span data-stu-id="5333f-110">For restore operations, a Backup Components Document is typically initialized from a stored document generated during the initial backup.</span></span> <span data-ttu-id="5333f-111">Esto permite la restauración (junto con el examen de los documentos de metadatos del escritor almacenados) para determinar en qué datos se hizo una copia de seguridad inicialmente y cómo debe restaurarse.</span><span class="sxs-lookup"><span data-stu-id="5333f-111">This allows the restore (in conjunction with examination of stored Writer Metadata Documents) to determine what data was initially backed up and how it should be restored.</span></span>

<span data-ttu-id="5333f-112">La realización de copias de seguridad de las [*instantáneas transportables*](vssgloss-t.md) es una excepción a esta regla.</span><span class="sxs-lookup"><span data-stu-id="5333f-112">Backing up [*transportable shadow copies*](vssgloss-t.md) is an exception to this rule.</span></span> <span data-ttu-id="5333f-113">En este caso, es posible que se haya pasado una instantánea de un sistema (donde se creó junto con el documento de componentes de copia de seguridad inicial) a otro por medio de la reasignación de la unidad lógica de un dispositivo de almacenamiento compartido.</span><span class="sxs-lookup"><span data-stu-id="5333f-113">In this case, a shadow copy could have been moved from one system (where it was created along with the initial Backup Components Document) to another by means of reassigning a shared storage device's logical unit.</span></span> <span data-ttu-id="5333f-114">Para realizar una copia de seguridad en estas circunstancias, un solicitante carga el estado de copia de seguridad almacenado y continúa desde donde se quedó el sistema inicial.</span><span class="sxs-lookup"><span data-stu-id="5333f-114">To back up under these circumstances, a requester loads the stored backup state and proceeds from where the initial system left off.</span></span> <span data-ttu-id="5333f-115">(Para obtener más información, vea [importar volúmenes de instantáneas transportables](importing-transportable-shadow-copied-volumes.md)).</span><span class="sxs-lookup"><span data-stu-id="5333f-115">(For more information, see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md).)</span></span>

<span data-ttu-id="5333f-116">En el transcurso del procesamiento de una copia de seguridad, el solicitante decide qué componentes se deben copiar realmente en función de qué componentes están marcados como [*seleccionables para la copia de seguridad*](vssgloss-s.md), las rutas de acceso [*lógicas*](vssgloss-l.md)del componente y su propia lógica interna.</span><span class="sxs-lookup"><span data-stu-id="5333f-116">In the course of processing a backup, the requester decides which components to actually copy on the basis of which components are marked as [*selectable for backup*](vssgloss-s.md), the component's [*logical paths*](vssgloss-l.md), and its own internal logic.</span></span>

<span data-ttu-id="5333f-117">Algunos de los componentes se [*incluirán explícitamente*](vssgloss-e.md) en la operación de copia de seguridad; la información sobre el componente se agregará al documento componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5333f-117">Some of the components will be [*explicitly included*](vssgloss-e.md) in the backup operation; information about the component will be added to the Backup Components Document.</span></span> <span data-ttu-id="5333f-118">Otros se [*incluirán implícitamente*](vssgloss-i.md) en la copia de seguridad; la información sobre los componentes agregados no se agregará al documento componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5333f-118">Others will be [*implicitly included*](vssgloss-i.md) in the backup; information about the added components will not be added to the Backup Components Document.</span></span>

<span data-ttu-id="5333f-119">Todas las opciones no seleccionables de un escritor para los componentes de copia de seguridad sin un antecesor seleccionable en su ruta de acceso lógica, y las que seleccionan los componentes de copia de seguridad que elige el solicitante, se agregan explícitamente.</span><span class="sxs-lookup"><span data-stu-id="5333f-119">All of a writer's nonselectable for backup components without a selectable ancestor in their logical path, and those selectable for backup components the requester chooses, will be added explicitly.</span></span>

<span data-ttu-id="5333f-120">Los componentes de copia de seguridad no seleccionables y seleccionables se pueden agregar implícitamente si tienen un antecesor seleccionable en su ruta de acceso lógica, que se incluye explícitamente en la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5333f-120">Both nonselectable and selectable for backup components can be added implicitly if they have a selectable ancestor in their logical path, which is explicitly included in the backup.</span></span> <span data-ttu-id="5333f-121">Estos componentes ([*subcomponentes*](vssgloss-s.md)) son miembros de los [*conjuntos de componentes*](vssgloss-s.md) definidos por su antecesor seleccionable.</span><span class="sxs-lookup"><span data-stu-id="5333f-121">These components ([*subcomponents*](vssgloss-s.md)) are members of [*component sets*](vssgloss-s.md) defined by their selectable ancestor.</span></span>

<span data-ttu-id="5333f-122">Al controlar las operaciones de restauración, el solicitante usa la [*selección de la restauración*](vssgloss-s.md) en lugar de la selección para la copia de seguridad junto con la información de ruta de acceso lógica y su propia lógica interna para decidir qué archivos se van a restaurar.</span><span class="sxs-lookup"><span data-stu-id="5333f-122">When handling restore operations, the requester uses [*selectability for restore*](vssgloss-s.md) instead of selectability for backup in conjunction with logical path information and its own internal logic to decide which files to restore.</span></span>

<span data-ttu-id="5333f-123">Si un componente que se ha agregado implícitamente a la copia de seguridad ahora se va a agregar explícitamente a la restauración, el solicitante actualizará el documento de componentes de copia de seguridad con la información de ese componente.</span><span class="sxs-lookup"><span data-stu-id="5333f-123">If a component that had been implicitly added to the backup is now to be explicitly added to the restore, the requester will update the Backup Components Document with that component's information.</span></span>

<span data-ttu-id="5333f-124">La información sobre los componentes almacenados está disponible para los solicitantes y escritores a través de instancias de la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="5333f-124">Information about the stored components is available both to requesters and writers through instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="5333f-125">Es a través de las interfaces [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) que los escritores pueden consultar y (hasta el final de los eventos [**postsnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) y [**postrestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) ) modificar la información del documento componentes de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="5333f-125">It is through [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces that writers can query and (until the end of [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) and [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) events) modify information in the Backup Components Document.</span></span>

<span data-ttu-id="5333f-126">Cuando se llama al controlador de eventos [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)o [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) , un escritor recibe una instancia de una interfaz [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) .</span><span class="sxs-lookup"><span data-stu-id="5333f-126">When the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete), or [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) event handler is called, a writer receives an instance of an [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface.</span></span>

<span data-ttu-id="5333f-127">Tenga en cuenta que, tras la generación del evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , el documento componentes de copia de seguridad se convierte en solo lectura y, por lo tanto, [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) no puede usar la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para modificarlo.</span><span class="sxs-lookup"><span data-stu-id="5333f-127">Note that upon generation of the [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event, the Backup Components Document is made read-only, and therefore [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) cannot use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to modify it.</span></span>

<span data-ttu-id="5333f-128">Desde la interfaz [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , el escritor puede recuperar instancias de la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) que le permitirá tener acceso a todos sus componentes agregados explícitamente al documento componentes de copia de seguridad y modificar su estado.</span><span class="sxs-lookup"><span data-stu-id="5333f-128">From the [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, the writer can retrieve instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface that will allow it to access all of its components explicitly added to the Backup Components Document and to alter their state.</span></span> <span data-ttu-id="5333f-129">Para obtener más información, vea información [General sobre el procesamiento de una copia de seguridad en VSS](overview-of-processing-a-backup-under-vss.md) e [información general sobre el procesamiento de una restauración en VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="5333f-129">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="5333f-130">Los documentos de componentes de copia de seguridad se quitan de la memoria cuando se libera la interfaz [**ivssbackupcomponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) y deben almacenarse mediante [**IVssBackupComponents:: SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), o toda su información se perderá.</span><span class="sxs-lookup"><span data-stu-id="5333f-130">Backup Components Documents are removed from memory when the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface is released, and must be stored using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), or all their information will be lost.</span></span>

<span data-ttu-id="5333f-131">Además, cuando un documento [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) se libera correctamente, se genera un evento [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) y se eliminan las [*instantáneas de liberación automática*](vssgloss-a.md) .</span><span class="sxs-lookup"><span data-stu-id="5333f-131">In addition, when an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) document is properly released, a [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) event is generated and [*auto-release shadow copies*](vssgloss-a.md) are deleted.</span></span>

 

 



