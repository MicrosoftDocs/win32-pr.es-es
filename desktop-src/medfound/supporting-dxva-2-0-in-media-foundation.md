---
description: Compatibilidad con DXVA 2,0 en Media Foundation
ms.assetid: d7330370-adb3-4c6a-962a-7b46c344500c
title: Compatibilidad con DXVA 2,0 en Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ce144c24a1aeeda6281ddb423757f3e339903440
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "105670079"
---
# <a name="supporting-dxva-20-in-media-foundation"></a><span data-ttu-id="84679-103">Compatibilidad con DXVA 2,0 en Media Foundation</span><span class="sxs-lookup"><span data-stu-id="84679-103">Supporting DXVA 2.0 in Media Foundation</span></span>

<span data-ttu-id="84679-104">En este tema se describe cómo admitir la aceleración de vídeo de DirectX (DXVA) 2,0 en una transformación de Media Foundation (MFT) con Microsoft Direct3D 9, en concreto, se describe la comunicación entre el descodificador y el representador de vídeo, que se corrige mediante el cargador de topología.</span><span class="sxs-lookup"><span data-stu-id="84679-104">This topic describes how to support DirectX Video Acceleration (DXVA) 2.0 in a Media Foundation transform (MFT) using Microsoft Direct3D 9 Specifically, it describes the communication between the decoder and the video renderer, which is mediated by the topology loader.</span></span> <span data-ttu-id="84679-105">En este tema no se describe cómo implementar la descodificación de DXVA.</span><span class="sxs-lookup"><span data-stu-id="84679-105">This topic does not describe how to implement DXVA decoding.</span></span>

<span data-ttu-id="84679-106">En el resto de este tema, el término *descodificador* hace referencia a la MFT del descodificador, que recibe vídeo comprimido y genera vídeo sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="84679-106">In the remainder of this topic, the term *decoder* refers to the decoder MFT, which receives compressed video and outputs uncompressed video.</span></span> <span data-ttu-id="84679-107">El término *dispositivo descodificador* hace referencia a un acelerador de vídeo de hardware implementado por el controlador de gráficos.</span><span class="sxs-lookup"><span data-stu-id="84679-107">The term *decoder device* refers to a hardware video accelerator implemented by the graphics driver.</span></span>

> [!TIP]
> <span data-ttu-id="84679-108">Para obtener información sobre la descodificación de vídeo de Microsoft Direct3D 11, consulte [compatibilidad con la descodificación de vídeo Direct3D 11 en Media Foundation](supporting-direct3d-11-video-decoding-in-media-foundation.md).</span><span class="sxs-lookup"><span data-stu-id="84679-108">For info on Microsoft Direct3D 11 video decoding see, [Supporting Direct3D 11 Video Decoding in Media Foundation](supporting-direct3d-11-video-decoding-in-media-foundation.md).</span></span>

 

> [!Note]  
> <span data-ttu-id="84679-109">Las aplicaciones de la tienda Windows deben usar Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="84679-109">Windows Store apps must use Direct3D 11.</span></span>

 

<span data-ttu-id="84679-110">Estos son los pasos básicos que debe realizar un descodificador para admitir DXVA 2,0 en Media Foundation:</span><span class="sxs-lookup"><span data-stu-id="84679-110">Here are the basic steps that a decoder must perform to support DXVA 2.0 in Media Foundation:</span></span>

1.  <span data-ttu-id="84679-111">Abra un identificador para el dispositivo de Direct3D 9.</span><span class="sxs-lookup"><span data-stu-id="84679-111">Open a handle to the Direct3D 9 device.</span></span>
2.  <span data-ttu-id="84679-112">Busque una configuración de descodificador de DXVA.</span><span class="sxs-lookup"><span data-stu-id="84679-112">Find a DXVA decoder configuration.</span></span>
3.  <span data-ttu-id="84679-113">Asignar búferes sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="84679-113">Allocate uncompressed Buffers.</span></span>
4.  <span data-ttu-id="84679-114">Descodificar fotogramas.</span><span class="sxs-lookup"><span data-stu-id="84679-114">Decode frames.</span></span>

<span data-ttu-id="84679-115">Estos pasos se describen con más detalle en el resto de este tema.</span><span class="sxs-lookup"><span data-stu-id="84679-115">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="opening-a-direct3d-device-handle"></a><span data-ttu-id="84679-116">Apertura de un controlador de dispositivo Direct3D</span><span class="sxs-lookup"><span data-stu-id="84679-116">Opening a Direct3D Device Handle</span></span>

<span data-ttu-id="84679-117">MFT usa el administrador de dispositivos de Microsoft Direct3D para obtener un identificador para el dispositivo de Direct3D 9.</span><span class="sxs-lookup"><span data-stu-id="84679-117">The MFT uses the Microsoft Direct3D device manager to get a handle to the Direct3D 9 device.</span></span> <span data-ttu-id="84679-118">Para abrir el identificador del dispositivo, realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="84679-118">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="84679-119">Exponga el [atributo \_ MF \_ SA \_ compatible](mf-sa-d3d-aware-attribute.md) con el valor **true**.</span><span class="sxs-lookup"><span data-stu-id="84679-119">Expose the [MF\_SA\_D3D\_AWARE](mf-sa-d3d-aware-attribute.md) attribute with the value **TRUE**.</span></span> <span data-ttu-id="84679-120">El cargador de topología consulta este atributo mediante una llamada a [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span><span class="sxs-lookup"><span data-stu-id="84679-120">The topology loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="84679-121">Al establecer el atributo en **true** , se notifica al cargador de topología que el MFT admite DXVA.</span><span class="sxs-lookup"><span data-stu-id="84679-121">Setting the attribute to **TRUE** notifies the topology loader that the MFT supports DXVA.</span></span>
2.  <span data-ttu-id="84679-122">Cuando comienza la negociación de formato, el cargador de topología llama a [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con el mensaje de [**Administrador de D3D del conjunto de mensajes de MFT \_ \_ \_ \_**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="84679-122">When format negotiation begins, the topology loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="84679-123">El parámetro *ulParam* es un puntero **IUnknown** al administrador de dispositivos de Direct3D del representador de vídeo.</span><span class="sxs-lookup"><span data-stu-id="84679-123">The *ulParam* parameter is an **IUnknown** pointer to the video renderer's Direct3D device manager.</span></span> <span data-ttu-id="84679-124">Consulte este puntero para la interfaz [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) .</span><span class="sxs-lookup"><span data-stu-id="84679-124">Query this pointer for the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) interface.</span></span>
3.  <span data-ttu-id="84679-125">Llame a [**IDirect3DDeviceManager9:: OpenDeviceHandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-opendevicehandle) para obtener un identificador para el dispositivo Direct3D del representador.</span><span class="sxs-lookup"><span data-stu-id="84679-125">Call [**IDirect3DDeviceManager9::OpenDeviceHandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-opendevicehandle) to get a handle to the renderer's Direct3D device.</span></span>
4.  <span data-ttu-id="84679-126">Llame a [**IDirect3DDeviceManager9:: GetVideoService**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-getvideoservice) y pase el identificador del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="84679-126">Call [**IDirect3DDeviceManager9::GetVideoService**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-getvideoservice) and pass in the device handle.</span></span> <span data-ttu-id="84679-127">Este método devuelve un puntero a la interfaz [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) .</span><span class="sxs-lookup"><span data-stu-id="84679-127">This method returns a pointer to the [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) interface.</span></span>
5.  <span data-ttu-id="84679-128">Almacene en caché los punteros y el identificador del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="84679-128">Cache the pointers and the device handle.</span></span>

## <a name="finding-a-decoder-configuration"></a><span data-ttu-id="84679-129">Buscar una configuración de descodificador</span><span class="sxs-lookup"><span data-stu-id="84679-129">Finding a Decoder Configuration</span></span>

<span data-ttu-id="84679-130">La MFT debe encontrar una configuración compatible para el dispositivo descodificador de DXVA.</span><span class="sxs-lookup"><span data-stu-id="84679-130">The MFT must find a compatible configuration for the DXVA decoder device.</span></span> <span data-ttu-id="84679-131">Siga los pasos que se indican a continuación en el método [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) después de validar el tipo de entrada:</span><span class="sxs-lookup"><span data-stu-id="84679-131">Perform the following steps inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, after validating the input type:</span></span>

1.  <span data-ttu-id="84679-132">Llame a [**IDirectXVideoDecoderService:: GetDecoderDeviceGuids**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderdeviceguids).</span><span class="sxs-lookup"><span data-stu-id="84679-132">Call [**IDirectXVideoDecoderService::GetDecoderDeviceGuids**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderdeviceguids).</span></span> <span data-ttu-id="84679-133">Este método devuelve una matriz de GUID de dispositivo de descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-133">This method returns an array of decoder device GUIDs.</span></span>
2.  <span data-ttu-id="84679-134">Recorra en bucle la matriz de GUID del descodificador para buscar los que admite el descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-134">Loop through the array of decoder GUIDs to find the ones that the decoder supports.</span></span> <span data-ttu-id="84679-135">Por ejemplo, para un descodificador MPEG-2, buscará **DXVA2 \_ ModeMPEG2 \_ MOCOMP**, **DXVA2 \_ ModeMPEG2 \_ IDCT** o **DXVA2 \_ \_** ModeMPEG2 VLD.</span><span class="sxs-lookup"><span data-stu-id="84679-135">For example, for an MPEG-2 decoder, you would look for **DXVA2\_ModeMPEG2\_MOCOMP**, **DXVA2\_ModeMPEG2\_IDCT**, or **DXVA2\_ModeMPEG2\_VLD**.</span></span>

3.  <span data-ttu-id="84679-136">Cuando encuentre un GUID de dispositivo descodificador candidato, pase el GUID al método [**IDirectXVideoDecoderService:: GetDecoderRenderTargets**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderrendertargets) .</span><span class="sxs-lookup"><span data-stu-id="84679-136">When you find a candidate decoder device GUID, pass the GUID to the [**IDirectXVideoDecoderService::GetDecoderRenderTargets**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderrendertargets) method.</span></span> <span data-ttu-id="84679-137">Este método devuelve una matriz de formatos de destino de representación, especificados como valores de **D3DFORMAT** .</span><span class="sxs-lookup"><span data-stu-id="84679-137">This method returns an array of render target formats, specified as **D3DFORMAT** values.</span></span>
4.  <span data-ttu-id="84679-138">Recorra los formatos de destino de representación y busque un formato compatible con el descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-138">Loop through the render target formats and look for a format supported by the decoder.</span></span>
5.  <span data-ttu-id="84679-139">Llame a [**IDirectXVideoDecoderService:: GetDecoderConfigurations**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderconfigurations).</span><span class="sxs-lookup"><span data-stu-id="84679-139">Call [**IDirectXVideoDecoderService::GetDecoderConfigurations**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-getdecoderconfigurations).</span></span> <span data-ttu-id="84679-140">Pase el mismo GUID del dispositivo de descodificador, junto con una estructura [**DXVA2 \_ videodesc**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videodesc) que describe el formato de salida propuesto.</span><span class="sxs-lookup"><span data-stu-id="84679-140">Pass in the same decoder device GUID, along with a [**DXVA2\_VideoDesc**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videodesc) structure that describes the proposed output format.</span></span> <span data-ttu-id="84679-141">El método devuelve una matriz de estructuras [**DXVA2 \_ ConfigPictureDecode**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_configpicturedecode) .</span><span class="sxs-lookup"><span data-stu-id="84679-141">The method returns an array of [**DXVA2\_ConfigPictureDecode**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_configpicturedecode) structures.</span></span> <span data-ttu-id="84679-142">Cada estructura describe una posible configuración para el dispositivo descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-142">Each structure describes one possible configuration for the decoder device.</span></span> <span data-ttu-id="84679-143">Busque una configuración que admita el descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-143">Look for a configuration that the decoder supports.</span></span>
6.  <span data-ttu-id="84679-144">Almacene el formato y la configuración del destino de representación.</span><span class="sxs-lookup"><span data-stu-id="84679-144">Store the render target format and configuration.</span></span>

<span data-ttu-id="84679-145">En el método [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) , devuelve un formato de vídeo sin comprimir, basado en el formato de destino de representación propuesto.</span><span class="sxs-lookup"><span data-stu-id="84679-145">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format, based on the proposed render target format.</span></span>

<span data-ttu-id="84679-146">En el método [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) , compruebe el tipo de medio con el formato de destino de representación.</span><span class="sxs-lookup"><span data-stu-id="84679-146">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

### <a name="fallback-to-software-decoding"></a><span data-ttu-id="84679-147">Retroceso a descodificación de software</span><span class="sxs-lookup"><span data-stu-id="84679-147">Fallback to Software Decoding</span></span>

<span data-ttu-id="84679-148">Si el MFT no puede encontrar una configuración de DXVA (por ejemplo, si el controlador de gráficos no tiene las capacidades adecuadas), debe devolver el **\_ \_ \_ \_ tipo D3D no compatible con** el código de error MF e de los métodos [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) y [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) .</span><span class="sxs-lookup"><span data-stu-id="84679-148">If the MFT cannot find a DXVA configuration (for example, if the graphics driver does not have the right capabilities), it should return the error code **MF\_E\_UNSUPPORTED\_D3D\_TYPE** from the [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods.</span></span> <span data-ttu-id="84679-149">El cargador de topología responderá enviando el mensaje [**del \_ \_ \_ \_ Administrador D3D del conjunto de mensajes de MFT**](mft-message-set-d3d-manager.md) con el valor **null** para el parámetro *ulParam* .</span><span class="sxs-lookup"><span data-stu-id="84679-149">The topology loader will respond by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span> <span data-ttu-id="84679-150">La MFT debe liberar su puntero a la interfaz [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) .</span><span class="sxs-lookup"><span data-stu-id="84679-150">The MFT should release its pointer to the [**IDirect3DDeviceManager9**](/windows/desktop/api/dxva2api/nn-dxva2api-idirect3ddevicemanager9) interface.</span></span> <span data-ttu-id="84679-151">El cargador de topología volverá a negociar el tipo de medio y el MFT podrá usar la descodificación de software.</span><span class="sxs-lookup"><span data-stu-id="84679-151">The topology loader will then renegotiate the media type, and the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="84679-152">Asignación de búferes sin comprimir</span><span class="sxs-lookup"><span data-stu-id="84679-152">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="84679-153">En DXVA 2,0, el descodificador es responsable de asignar las superficies de Direct3D que se usarán como búferes de vídeo sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="84679-153">In DXVA 2.0, the decoder is responsible for allocating Direct3D surfaces to use as uncompressed video buffers.</span></span> <span data-ttu-id="84679-154">El descodificador debe asignar 3 superficies para que el EVR lo use para el desentrelazado.</span><span class="sxs-lookup"><span data-stu-id="84679-154">The decoder should allocate 3 surfaces for the EVR to use for deinterlacing.</span></span> <span data-ttu-id="84679-155">Este número es fijo, ya que Media Foundation no proporciona una manera para que EVR especifique cuántas superficies necesita el controlador de gráficos para el desentrelazado.</span><span class="sxs-lookup"><span data-stu-id="84679-155">This number is fixed, because Media Foundation does not provide a way for the EVR to specify how many surfaces the graphics driver requires for deinterlacing.</span></span> <span data-ttu-id="84679-156">Tres superficies deben ser suficientes para cualquier controlador.</span><span class="sxs-lookup"><span data-stu-id="84679-156">Three surfaces should be sufficient for any driver.</span></span>

<span data-ttu-id="84679-157">En el método [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) , establezca el **flujo de salida de MFT proporciona la marca \_ \_ \_ \_ Samples** en la estructura de información del flujo de salida de [**MFT \_ \_ \_**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_stream_info) .</span><span class="sxs-lookup"><span data-stu-id="84679-157">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_stream_info) structure.</span></span> <span data-ttu-id="84679-158">Esta marca notifica a la sesión de medios que la MFT asigna sus propios ejemplos de salida.</span><span class="sxs-lookup"><span data-stu-id="84679-158">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span>

<span data-ttu-id="84679-159">Para crear las superficies, llame a [**IDirectXVideoAccelerationService:: CreateSurface**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoaccelerationservice-createsurface).</span><span class="sxs-lookup"><span data-stu-id="84679-159">To create the surfaces, call [**IDirectXVideoAccelerationService::CreateSurface**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoaccelerationservice-createsurface).</span></span> <span data-ttu-id="84679-160">(La interfaz [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) hereda este método de [**IDirectXVideoAccelerationService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideoaccelerationservice)). Puede hacer esto en [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype), después de encontrar el formato de destino de representación.</span><span class="sxs-lookup"><span data-stu-id="84679-160">(The [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) interface inherits this method from [**IDirectXVideoAccelerationService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideoaccelerationservice).) You can do this in [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype), after finding the render target format.</span></span>

<span data-ttu-id="84679-161">Para cada superficie, llame a [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) para crear un ejemplo multimedia que contenga la superficie.</span><span class="sxs-lookup"><span data-stu-id="84679-161">For each surface, call [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) to create a media sample to hold the surface.</span></span> <span data-ttu-id="84679-162">El método devuelve un puntero a la interfaz [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) .</span><span class="sxs-lookup"><span data-stu-id="84679-162">The method returns a pointer to the [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>

## <a name="decoding"></a><span data-ttu-id="84679-163">Descodificación</span><span class="sxs-lookup"><span data-stu-id="84679-163">Decoding</span></span>

<span data-ttu-id="84679-164">Para crear el dispositivo descodificador, llame a [**IDirectXVideoDecoderService:: CreateVideoDecoder**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-createvideodecoder).</span><span class="sxs-lookup"><span data-stu-id="84679-164">To create the decoder device, call [**IDirectXVideoDecoderService::CreateVideoDecoder**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoderservice-createvideodecoder).</span></span> <span data-ttu-id="84679-165">El método devuelve un puntero a la interfaz [**IDirectXVideoDecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) del dispositivo descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-165">The method returns a pointer to the [**IDirectXVideoDecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) interface of the decoder device.</span></span>

<span data-ttu-id="84679-166">La descodificación debe realizarse dentro del método [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="84679-166">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="84679-167">En cada fotograma, llame a [**IDirect3DDeviceManager9:: TestDevice**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-testdevice) para probar el identificador del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="84679-167">On each frame, call [**IDirect3DDeviceManager9::TestDevice**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-testdevice) to test the device handle.</span></span> <span data-ttu-id="84679-168">Si el dispositivo ha cambiado, el método devuelve **DXVA2 \_ E \_ nuevo \_ \_ dispositivo de vídeo**.</span><span class="sxs-lookup"><span data-stu-id="84679-168">If the device has changed, the method returns **DXVA2\_E\_NEW\_VIDEO\_DEVICE**.</span></span> <span data-ttu-id="84679-169">Si esto ocurre, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="84679-169">If this occurs, do the following:</span></span>

1.  <span data-ttu-id="84679-170">Cierre el identificador del dispositivo mediante una llamada a [**IDirect3DDeviceManager9:: CloseDeviceHandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-closedevicehandle).</span><span class="sxs-lookup"><span data-stu-id="84679-170">Close the device handle by calling [**IDirect3DDeviceManager9::CloseDeviceHandle**](/windows/desktop/api/dxva2api/nf-dxva2api-idirect3ddevicemanager9-closedevicehandle).</span></span>
2.  <span data-ttu-id="84679-171">Libere los punteros [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) y [**IDirectXVideoDecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) .</span><span class="sxs-lookup"><span data-stu-id="84679-171">Release the [**IDirectXVideoDecoderService**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoderservice) and [**IDirectXVideoDecoder**](/windows/desktop/api/dxva2api/nn-dxva2api-idirectxvideodecoder) pointers.</span></span>
3.  <span data-ttu-id="84679-172">Abra un nuevo identificador de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="84679-172">Open a new device handle.</span></span>
4.  <span data-ttu-id="84679-173">Negocie una nueva configuración del descodificador, tal como se describe en "buscar una configuración de descodificador" anteriormente en esta página.</span><span class="sxs-lookup"><span data-stu-id="84679-173">Negotiate a new decoder configuration, as described in "Finding a Decoder Configuration" earlier on this page.</span></span>
5.  <span data-ttu-id="84679-174">Cree un nuevo dispositivo descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-174">Create a new decoder device.</span></span>

<span data-ttu-id="84679-175">Suponiendo que el identificador del dispositivo es válido, el proceso de descodificación funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="84679-175">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="84679-176">Obtiene una superficie disponible que no está actualmente en uso.</span><span class="sxs-lookup"><span data-stu-id="84679-176">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="84679-177">(Inicialmente, todas las superficies están disponibles).</span><span class="sxs-lookup"><span data-stu-id="84679-177">(Initially all of the surfaces are available.)</span></span>
2.  <span data-ttu-id="84679-178">Consulte el ejemplo multimedia para la interfaz [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) .</span><span class="sxs-lookup"><span data-stu-id="84679-178">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="84679-179">Llame a [**IMFTrackedSample:: SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) y proporcione un puntero a la interfaz [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) , implementada por el descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-179">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface, implemented by the decoder.</span></span> <span data-ttu-id="84679-180">Cuando el representador de vídeo libera el ejemplo, se invocará la devolución de llamada del descodificador.</span><span class="sxs-lookup"><span data-stu-id="84679-180">When the video renderer releases the sample, the decoder's callback will be invoked.</span></span>
4.  <span data-ttu-id="84679-181">Llame a [**IDirectXVideoDecoder:: BeginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe).</span><span class="sxs-lookup"><span data-stu-id="84679-181">Call [**IDirectXVideoDecoder::BeginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe).</span></span>
5.  <span data-ttu-id="84679-182">Haga lo siguiente una o varias veces:</span><span class="sxs-lookup"><span data-stu-id="84679-182">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="84679-183">Llame a [**IDirectXVideoDecoder:: getBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) para obtener un búfer del descodificador de DXVA.</span><span class="sxs-lookup"><span data-stu-id="84679-183">Call [**IDirectXVideoDecoder::GetBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) to get a DXVA decoder buffer.</span></span>
    2.  <span data-ttu-id="84679-184">Rellene el búfer.</span><span class="sxs-lookup"><span data-stu-id="84679-184">Fill the buffer.</span></span>
    3.  <span data-ttu-id="84679-185">Llame a [**IDirectXVideoDecoder:: ReleaseBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-releasebuffer).</span><span class="sxs-lookup"><span data-stu-id="84679-185">Call [**IDirectXVideoDecoder::ReleaseBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-releasebuffer).</span></span>
    4.  <span data-ttu-id="84679-186">Llame a [**IDirectXVideoDecoder:: Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) para realizar las operaciones de descodificación en el marco.</span><span class="sxs-lookup"><span data-stu-id="84679-186">Call [**IDirectXVideoDecoder::Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) to perform the decoding operations on the frame.</span></span>

<span data-ttu-id="84679-187">DXVA 2,0 utiliza las mismas estructuras de datos que DXVA 1,0 para las operaciones de descodificación.</span><span class="sxs-lookup"><span data-stu-id="84679-187">DXVA 2.0 uses the same data structures as DXVA 1.0 for decoding operations.</span></span> <span data-ttu-id="84679-188">En el conjunto original de perfiles de DXVA (para H. 261, H. 263 y MPEG-2), estas estructuras de datos se describen en la [especificación de DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration).</span><span class="sxs-lookup"><span data-stu-id="84679-188">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="84679-189">Dentro de cada par de llamadas de ejecución de [**BeginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe) / [](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) , puede llamar a [**getBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) varias veces, pero solo una vez para cada tipo de búfer de DXVA.</span><span class="sxs-lookup"><span data-stu-id="84679-189">Within each pair of [**BeginFrame**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-beginframe)/[**Execute**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-execute) calls, you may call [**GetBuffer**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideodecoder-getbuffer) multiple times, but only once for each type of DXVA buffer.</span></span> <span data-ttu-id="84679-190">Si se llama dos veces con el mismo tipo de búfer, se sobrescribirán los datos.</span><span class="sxs-lookup"><span data-stu-id="84679-190">If you call it twice with the same buffer type, you will overwrite the data.</span></span>

<span data-ttu-id="84679-191">Use la devolución de llamada del método [**SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) (paso 3) para realizar un seguimiento de los ejemplos que están disponibles actualmente y que están en uso.</span><span class="sxs-lookup"><span data-stu-id="84679-191">Use the callback from the [**SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) method (step 3) to keep track of which samples are currently available and which are in use.</span></span>

## <a name="related-topics"></a><span data-ttu-id="84679-192">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="84679-192">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="84679-193">Aceleración de vídeo de DirectX 2,0</span><span class="sxs-lookup"><span data-stu-id="84679-193">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> <dt>

[<span data-ttu-id="84679-194">Media Foundation transformaciones</span><span class="sxs-lookup"><span data-stu-id="84679-194">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 
