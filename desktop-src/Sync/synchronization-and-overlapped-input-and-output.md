---
description: Puede realizar operaciones de e/s sincrónicas o asincrónicas (también denominadas superpuestas) en archivos, canalizaciones con nombre y dispositivos de comunicaciones serie.
ms.assetid: db44990e-5a0f-4153-8ff6-79dd7cda48af
title: Sincronización y entrada y salida superpuestas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e263bb39badc7cbfadd67d80eb169dc1fe6d6c35
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105668449"
---
# <a name="synchronization-and-overlapped-input-and-output"></a><span data-ttu-id="c598c-103">Sincronización y entrada y salida superpuestas</span><span class="sxs-lookup"><span data-stu-id="c598c-103">Synchronization and Overlapped Input and Output</span></span>

<span data-ttu-id="c598c-104">Puede realizar operaciones de e/s sincrónicas o asincrónicas (también denominadas superpuestas) en archivos, canalizaciones con nombre y dispositivos de comunicaciones serie.</span><span class="sxs-lookup"><span data-stu-id="c598c-104">You can perform either synchronous or asynchronous (also called overlapped) I/O operations on files, named pipes, and serial communications devices.</span></span> <span data-ttu-id="c598c-105">Las funciones [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile), [**readfile**](/windows/win32/api/fileapi/nf-fileapi-readfile), [**DeviceIoControl**](/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol), [**WaitCommEvent**](/windows/win32/api/winbase/nf-winbase-waitcommevent), [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe)y [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe) se pueden realizar de forma sincrónica o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="c598c-105">The [**WriteFile**](/windows/win32/api/fileapi/nf-fileapi-writefile), [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile), [**DeviceIoControl**](/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol), [**WaitCommEvent**](/windows/win32/api/winbase/nf-winbase-waitcommevent), [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe), and [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe) functions can be performed either synchronously or asynchronously.</span></span> <span data-ttu-id="c598c-106">Las funciones [**ReadFileEx**](/windows/win32/api/fileapi/nf-fileapi-readfileex) y [**WriteFileEx**](/windows/win32/api/fileapi/nf-fileapi-writefileex) solo se pueden realizar de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="c598c-106">The [**ReadFileEx**](/windows/win32/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/win32/api/fileapi/nf-fileapi-writefileex) functions can be performed only asynchronously.</span></span>

<span data-ttu-id="c598c-107">Cuando una función se ejecuta sincrónicamente, no devuelve ningún resultado hasta que se haya completado la operación.</span><span class="sxs-lookup"><span data-stu-id="c598c-107">When a function is executed synchronously, it does not return until the operation has been completed.</span></span> <span data-ttu-id="c598c-108">Esto significa que la ejecución del subproceso que realiza la llamada puede bloquearse durante un período indefinido mientras espera a que finalice una operación que consume mucho tiempo.</span><span class="sxs-lookup"><span data-stu-id="c598c-108">This means that the execution of the calling thread can be blocked for an indefinite period while it waits for a time-consuming operation to finish.</span></span> <span data-ttu-id="c598c-109">Las funciones a las que se llama para la operación superpuesta pueden volver inmediatamente, aunque no se haya completado la operación.</span><span class="sxs-lookup"><span data-stu-id="c598c-109">Functions called for overlapped operation can return immediately, even though the operation has not been completed.</span></span> <span data-ttu-id="c598c-110">Esto permite que una operación de e/s que tarda mucho tiempo se ejecute en segundo plano, mientras que el subproceso que realiza la llamada puede realizar otras tareas.</span><span class="sxs-lookup"><span data-stu-id="c598c-110">This enables a time-consuming I/O operation to be executed in the background while the calling thread is free to perform other tasks.</span></span> <span data-ttu-id="c598c-111">Por ejemplo, un único subproceso puede realizar operaciones de e/s simultáneas en diferentes identificadores, o incluso en operaciones de lectura y escritura simultáneas en el mismo identificador.</span><span class="sxs-lookup"><span data-stu-id="c598c-111">For example, a single thread can perform simultaneous I/O operations on different handles, or even simultaneous read and write operations on the same handle.</span></span>

<span data-ttu-id="c598c-112">Para sincronizar su ejecución con la realización de la operación superpuesta, el subproceso que realiza la llamada utiliza la función [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) , la función [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) o una de las [funciones de espera](wait-functions.md) para determinar cuándo se ha completado la operación superpuesta.</span><span class="sxs-lookup"><span data-stu-id="c598c-112">To synchronize its execution with the completion of the overlapped operation, the calling thread uses the [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) function, the [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) function, or one of the [wait functions](wait-functions.md) to determine when the overlapped operation has been completed.</span></span> <span data-ttu-id="c598c-113">También puede usar la macro [**HasOverlappedIoCompleted**](/windows/desktop/api/WinBase/nf-winbase-hasoverlappediocompleted) para sondear la finalización.</span><span class="sxs-lookup"><span data-stu-id="c598c-113">You can also use the [**HasOverlappedIoCompleted**](/windows/desktop/api/WinBase/nf-winbase-hasoverlappediocompleted) macro to poll for completion.</span></span>

<span data-ttu-id="c598c-114">Para cancelar todas las operaciones de e/s asincrónicas pendientes, utilice la función [**CancelIoEx**](/windows/win32/api/ioapiset/nf-ioapiset-cancelioex) y proporcione una estructura [**superpuesta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) que especifique la solicitud que se va a cancelar.</span><span class="sxs-lookup"><span data-stu-id="c598c-114">To cancel all pending asynchronous I/O operations, use the [**CancelIoEx**](/windows/win32/api/ioapiset/nf-ioapiset-cancelioex) function and provide an [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure that specifies the request to cancel.</span></span> <span data-ttu-id="c598c-115">Use la función [**CancelIo**](/windows/win32/api/ioapiset/nf-ioapiset-cancelio) para cancelar las operaciones de e/s asincrónicas pendientes emitidas por el subproceso que realiza la llamada para el identificador de archivo especificado.</span><span class="sxs-lookup"><span data-stu-id="c598c-115">Use the [**CancelIo**](/windows/win32/api/ioapiset/nf-ioapiset-cancelio) function to cancel pending asynchronous I/O operations issued by the calling thread for the specified file handle.</span></span>

<span data-ttu-id="c598c-116">Las operaciones superpuestas requieren un archivo, una canalización con nombre o un dispositivo de comunicaciones creado con la marca de superposición de **\_ \_ marca de archivo** .</span><span class="sxs-lookup"><span data-stu-id="c598c-116">Overlapped operations require a file, named pipe, or communications device that was created with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span> <span data-ttu-id="c598c-117">Cuando un subproceso llama a una función (como la función [**readfile**](/windows/win32/api/fileapi/nf-fileapi-readfile) ) para realizar una operación superpuesta, el subproceso que realiza la llamada debe especificar un puntero a una estructura [**superpuesta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="c598c-117">When a thread calls a function (such as the [**ReadFile**](/windows/win32/api/fileapi/nf-fileapi-readfile) function) to perform an overlapped operation, the calling thread must specify a pointer to an [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="c598c-118">(Si este puntero es **null**, el valor devuelto de la función puede indicar incorrectamente que la operación se completó). Todos los miembros de la estructura **superpuesta** se deben inicializar en cero, a menos que se use un evento para indicar la finalización de una operación de e/s.</span><span class="sxs-lookup"><span data-stu-id="c598c-118">(If this pointer is **NULL**, the function return value may incorrectly indicate that the operation completed.) All of the members of the **OVERLAPPED** structure must be initialized to zero unless an event will be used to signal completion of an I/O operation.</span></span> <span data-ttu-id="c598c-119">Si se utiliza un evento, el miembro **hEvent** de la estructura **OVERLAPPED** especifica un identificador para el objeto de evento asignado.</span><span class="sxs-lookup"><span data-stu-id="c598c-119">If an event is used, the **hEvent** member of the **OVERLAPPED** structure specifies a handle to the allocated event object.</span></span> <span data-ttu-id="c598c-120">El sistema establece el estado del objeto de evento en no señalado cuando una llamada a la función de e/s se devuelve antes de que se haya completado la operación.</span><span class="sxs-lookup"><span data-stu-id="c598c-120">The system sets the state of the event object to nonsignaled when a call to the I/O function returns before the operation has been completed.</span></span> <span data-ttu-id="c598c-121">El sistema establece el estado del objeto de evento en señalado cuando se ha completado la operación.</span><span class="sxs-lookup"><span data-stu-id="c598c-121">The system sets the state of the event object to signaled when the operation has been completed.</span></span> <span data-ttu-id="c598c-122">Un evento solo es necesario si hay más de una operación de e/s pendiente al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="c598c-122">An event is needed only if there will be more than one outstanding I/O operation at the same time.</span></span> <span data-ttu-id="c598c-123">Si no se utiliza un evento, cada operación de e/s completada señalará el archivo, la canalización con nombre o el dispositivo de comunicaciones.</span><span class="sxs-lookup"><span data-stu-id="c598c-123">If an event is not used, each completed I/O operation will signal the file, named pipe, or communications device.</span></span>

<span data-ttu-id="c598c-124">Cuando se llama a una función para realizar una operación superpuesta, es posible que la operación se complete antes de que se devuelva la función.</span><span class="sxs-lookup"><span data-stu-id="c598c-124">When a function is called to perform an overlapped operation, the operation might be completed before the function returns.</span></span> <span data-ttu-id="c598c-125">Cuando esto ocurre, los resultados se controlan como si la operación se hubiera realizado sincrónicamente.</span><span class="sxs-lookup"><span data-stu-id="c598c-125">When this happens, the results are handled as if the operation had been performed synchronously.</span></span> <span data-ttu-id="c598c-126">Sin embargo, si la operación no se completó, el valor devuelto de la función es **false** y la función [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) devuelve el **error de \_ e/s \_ pendiente**.</span><span class="sxs-lookup"><span data-stu-id="c598c-126">If the operation was not completed, however, the function's return value is **FALSE**, and the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns **ERROR\_IO\_PENDING**.</span></span>

<span data-ttu-id="c598c-127">Un subproceso puede administrar las operaciones superpuestas por uno de estos dos métodos:</span><span class="sxs-lookup"><span data-stu-id="c598c-127">A thread can manage overlapped operations by either of two methods:</span></span>

-   <span data-ttu-id="c598c-128">Utilice la función [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) o [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) para esperar a que se complete la operación superpuesta.</span><span class="sxs-lookup"><span data-stu-id="c598c-128">Use the [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex) function to wait for the overlapped operation to be completed.</span></span> <span data-ttu-id="c598c-129">Si se usa **GetOverlappedResultEx** , el subproceso que realiza la llamada puede especificar un tiempo de espera para la operación superpuesta o realizar una espera de alerta.</span><span class="sxs-lookup"><span data-stu-id="c598c-129">If **GetOverlappedResultEx** is used, the calling thread can specify a timeout for the overlapped operation or perform an alertable wait.</span></span>
-   <span data-ttu-id="c598c-130">Especifique un identificador para el objeto de evento de restablecimiento manual de la estructura [**superpuesta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) en una de las [funciones de espera](wait-functions.md) y, después, después de que se devuelva la función wait, llame a [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) o [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex).</span><span class="sxs-lookup"><span data-stu-id="c598c-130">Specify a handle to the [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure's manual-reset event object in one of the [wait functions](wait-functions.md) and then, after the wait function returns, call [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetOverlappedResultEx**](/windows/desktop/api/Ioapiset/nf-ioapiset-getoverlappedresultex).</span></span> <span data-ttu-id="c598c-131">La función devuelve los resultados de la operación superpuesta completada y, en el caso de las funciones en las que la información es adecuada, informa del número real de bytes transferidos.</span><span class="sxs-lookup"><span data-stu-id="c598c-131">The function returns the results of the completed overlapped operation, and for functions in which such information is appropriate, it reports the actual number of bytes that were transferred.</span></span>

<span data-ttu-id="c598c-132">Al realizar varias operaciones simultáneas superpuestas en un único subproceso, el subproceso que realiza la llamada debe especificar una estructura [**superpuesta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) para cada operación.</span><span class="sxs-lookup"><span data-stu-id="c598c-132">When performing multiple simultaneous overlapped operations on a single thread, the calling thread must specify an [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure for each operation.</span></span> <span data-ttu-id="c598c-133">Cada estructura **superpuesta** debe especificar un identificador para un objeto de evento de restablecimiento manual diferente.</span><span class="sxs-lookup"><span data-stu-id="c598c-133">Each **OVERLAPPED** structure must specify a handle to a different manual-reset event object.</span></span> <span data-ttu-id="c598c-134">Para esperar a que se complete una de las operaciones superpuestas, el subproceso especifica todos los identificadores de eventos de restablecimiento manual como criterios de espera en una de las [funciones de espera](wait-functions.md)de varios objetos.</span><span class="sxs-lookup"><span data-stu-id="c598c-134">To wait for any one of the overlapped operations to be completed, the thread specifies all the manual-reset event handles as wait criteria in one of the multiple-object [wait functions](wait-functions.md).</span></span> <span data-ttu-id="c598c-135">El valor devuelto de la función de varios objetos wait indica qué objeto de evento de restablecimiento manual se ha señalado, por lo que el subproceso puede determinar qué operación superpuesta ha provocado la finalización de la operación de espera.</span><span class="sxs-lookup"><span data-stu-id="c598c-135">The return value of the multiple-object wait function indicates which manual-reset event object was signaled, so the thread can determine which overlapped operation caused the wait operation to be completed.</span></span>

<span data-ttu-id="c598c-136">Es más seguro utilizar un objeto de evento independiente para cada operación superpuesta, en lugar de no especificar ningún objeto de evento ni volver a usar el mismo objeto de evento para varias operaciones.</span><span class="sxs-lookup"><span data-stu-id="c598c-136">It is safer to use a separate event object for each overlapped operation, rather than specify no event object or reuse the same event object for multiple operations.</span></span> <span data-ttu-id="c598c-137">Si no se especifica ningún objeto de evento en la estructura [**superpuesta**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) , el sistema indica el estado del archivo, la canalización con nombre o el dispositivo de comunicaciones cuando se ha completado la operación superpuesta.</span><span class="sxs-lookup"><span data-stu-id="c598c-137">If no event object is specified in the [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structure, the system signals the state of the file, named pipe, or communications device when the overlapped operation has been completed.</span></span> <span data-ttu-id="c598c-138">Por lo tanto, puede especificar estos identificadores como objetos de sincronización en una función de espera, aunque su uso para este propósito puede ser difícil de administrar porque, al realizar operaciones superpuestas simultáneamente en el mismo archivo, canalización con nombre o dispositivo de comunicaciones, no hay ninguna manera de saber qué operación provocó la señal del estado del objeto.</span><span class="sxs-lookup"><span data-stu-id="c598c-138">Thus, you can specify these handles as synchronization objects in a wait function, though their use for this purpose can be difficult to manage because, when performing simultaneous overlapped operations on the same file, named pipe, or communications device, there is no way to know which operation caused the object's state to be signaled.</span></span>

<span data-ttu-id="c598c-139">Un subproceso no debe reutilizar un evento con la suposición de que el evento solo será señalizado por la operación superpuesta del subproceso.</span><span class="sxs-lookup"><span data-stu-id="c598c-139">A thread should not reuse an event with the assumption that the event will be signaled only by that thread's overlapped operation.</span></span> <span data-ttu-id="c598c-140">Un evento se señaliza en el mismo subproceso que la operación superpuesta que se está completando.</span><span class="sxs-lookup"><span data-stu-id="c598c-140">An event is signaled on the same thread as the overlapped operation that is completing.</span></span> <span data-ttu-id="c598c-141">El uso del mismo evento en varios subprocesos puede conducir a una condición de carrera en la que el evento se señaliza correctamente para el subproceso cuya operación se completa primero y prematuramente para otros subprocesos que usan ese evento.</span><span class="sxs-lookup"><span data-stu-id="c598c-141">Using the same event on multiple threads can lead to a race condition in which the event is signaled correctly for the thread whose operation completes first and prematurely for other threads using that event.</span></span> <span data-ttu-id="c598c-142">A continuación, cuando se completa la siguiente operación superpuesta, el evento se vuelve a señalizar para todos los subprocesos que usan ese evento, y así sucesivamente hasta que se completan todas las operaciones superpuestas.</span><span class="sxs-lookup"><span data-stu-id="c598c-142">Then, when the next overlapped operation completes, the event is signaled again for all threads using that event, and so on until all overlapped operations are complete.</span></span>

<span data-ttu-id="c598c-143">Para obtener ejemplos que ilustran el uso de operaciones superpuestas, rutinas de finalización y la función [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) , vea [usar canalizaciones](../ipc/using-pipes.md).</span><span class="sxs-lookup"><span data-stu-id="c598c-143">For examples that illustrate the use of overlapped operations, completion routines, and the [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) function, see [Using Pipes](../ipc/using-pipes.md).</span></span>

<span data-ttu-id="c598c-144">\* \* Windows Vista, Windows Server 2003 y Windows XP: \* \*</span><span class="sxs-lookup"><span data-stu-id="c598c-144">\*\*Windows Vista, Windows Server 2003 and Windows XP:  \*\*</span></span>

<span data-ttu-id="c598c-145">Tenga cuidado al reutilizar estructuras [**SUPERpuestas**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="c598c-145">Be careful when reusing [**OVERLAPPED**](/windows/win32/api/minwinbase/ns-minwinbase-overlapped) structures.</span></span> <span data-ttu-id="c598c-146">Si se reutilizan las estructuras **SUPERpuestas** en varios subprocesos y se llama a [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) con el parámetro *bWait* establecido en **true**, el subproceso de llamada debe asegurarse de que el evento asociado se señaliza antes de volver a utilizar la estructura.</span><span class="sxs-lookup"><span data-stu-id="c598c-146">If **OVERLAPPED** structures are reused on multiple threads and [**GetOverlappedResult**](/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult) is called with the *bWait* parameter set to **TRUE**, the calling thread must ensure that the associated event is signaled before reusing the structure.</span></span> <span data-ttu-id="c598c-147">Esto puede realizarse mediante la función [**WaitForSingleObject**](/windows/win32/api/winbase/nf-winbase-registerwaitforsingleobject) después de llamar a **GetOverlappedResult** para obligar a que el subproceso espere hasta que se complete la operación.</span><span class="sxs-lookup"><span data-stu-id="c598c-147">This can be accomplished by using the [**WaitForSingleObject**](/windows/win32/api/winbase/nf-winbase-registerwaitforsingleobject) function after calling **GetOverlappedResult** to force the thread to wait until the operation completes.</span></span> <span data-ttu-id="c598c-148">Tenga en cuenta que el objeto de evento debe ser un objeto de evento de restablecimiento manual.</span><span class="sxs-lookup"><span data-stu-id="c598c-148">Note that the event object must be a manual-reset event object.</span></span> <span data-ttu-id="c598c-149">Si se utiliza un objeto de evento AutoReset, la llamada a **GetOverlappedResult** con el parámetro *BWait* establecido en **true** hace que la función se bloquee indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="c598c-149">If an autoreset event object is used, calling **GetOverlappedResult** with the *bWait* parameter set to **TRUE** causes the function to be blocked indefinitely.</span></span> <span data-ttu-id="c598c-150">Este comportamiento ha cambiado a partir de Windows 7 y Windows Server 2008 R2 para las aplicaciones que especifican Windows 7 como sistema operativo compatible en el manifiesto de aplicación.</span><span class="sxs-lookup"><span data-stu-id="c598c-150">This behavior changed starting with Windows 7 and Windows Server 2008 R2 for applications that specify Windows 7 as the supported operating system in the application manifest.</span></span> <span data-ttu-id="c598c-151">Para obtener más información, consulte [manifiestos de aplicación](/previous-versions/windows/desktop/adrms_sdk/application-manifests).</span><span class="sxs-lookup"><span data-stu-id="c598c-151">For more information see [Application Manifests](/previous-versions/windows/desktop/adrms_sdk/application-manifests).</span></span>

## <a name="related-topics"></a><span data-ttu-id="c598c-152">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="c598c-152">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c598c-153">Conceptos de e/s</span><span class="sxs-lookup"><span data-stu-id="c598c-153">I/O Concepts</span></span>](../fileio/i-o-concepts.md)
</dt> </dl>

 

 
