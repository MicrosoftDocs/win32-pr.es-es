---
title: 'IDirectWriterLock: implementación de archivos compuestos'
description: La implementación de archivos compuestos de IDirectWriterLock proporciona una manera de abrir un archivo compuesto en modo directo con un solo escritor y varios lectores.
ms.assetid: 4b247dae-d937-430a-bdb7-c47fa3c026b6
keywords:
- IDirectWriterLock Strctd STG, implementación de archivo compuesto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 861935a4c373ce03408c0e633e581e56d39623da
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "103773987"
---
# <a name="idirectwriterlock---compound-file-implementation"></a><span data-ttu-id="3d242-104">IDirectWriterLock: implementación de archivos compuestos</span><span class="sxs-lookup"><span data-stu-id="3d242-104">IDirectWriterLock - Compound File Implementation</span></span>

<span data-ttu-id="3d242-105">La implementación de archivos compuestos de [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) proporciona una manera de abrir un archivo compuesto en modo directo con un solo escritor y varios lectores.</span><span class="sxs-lookup"><span data-stu-id="3d242-105">The compound file implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) provides a way to open a compound file in direct mode with a single writer and multiple readers.</span></span>

<span data-ttu-id="3d242-106">Los archivos compuestos se pueden abrir en modo directo mediante la \_ marca de STGM Direct.</span><span class="sxs-lookup"><span data-stu-id="3d242-106">Compound files can be opened in direct mode using the STGM\_DIRECT flag.</span></span> <span data-ttu-id="3d242-107">La interfaz [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) establece el \_ marcador STGM ReadWrite \| STGM \_ share \_ Deny \_ Write como válido en modo directo sin requerir la sobrecarga de una copia de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="3d242-107">The [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) interface sets the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag as valid in direct mode without requiring the overhead of a snapshot copy.</span></span>

<span data-ttu-id="3d242-108">Cuando se abre un archivo compuesto en el modo de transacción mediante el uso de la \_ marca STGM transacción, también puede tener varios lectores y un único escritor mediante \_ la \| marca de \_ denegación de lectura del recurso compartido STGM ReadWrite STGM \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="3d242-108">When a compound file is opened in transacted mode using the STGM\_TRANSACTED flag, you can also have multiple readers and a single writer using the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag.</span></span> <span data-ttu-id="3d242-109">Sin embargo, en este caso, se realiza una copia de la instantánea del archivo para los lectores.</span><span class="sxs-lookup"><span data-stu-id="3d242-109">However, in this case, a snapshot copy of the file is made for the readers.</span></span> <span data-ttu-id="3d242-110">A menudo hay sobrecarga de una copia temporal.</span><span class="sxs-lookup"><span data-stu-id="3d242-110">There is often overhead of a scratch copy.</span></span>

## <a name="when-to-use"></a><span data-ttu-id="3d242-111">Cuándo usar</span><span class="sxs-lookup"><span data-stu-id="3d242-111">When to Use</span></span>

<span data-ttu-id="3d242-112">Use la implementación proporcionada por el sistema de [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) cuando abra un almacenamiento en modo directo (STGM \_ Direct) con las \_ marcas de \| \_ denegación de escritura del recurso compartido STGM ReadWrite STGM \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="3d242-112">Use the system-supplied implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) when you open a storage in direct mode (STGM\_DIRECT) with the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flags.</span></span>

<span data-ttu-id="3d242-113">Para obtener un puntero a [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), llame a **QueryInterface** en [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) para obtener el objeto de almacenamiento raíz para el archivo compuesto.</span><span class="sxs-lookup"><span data-stu-id="3d242-113">To obtain a pointer to [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), call **QueryInterface** on [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) to get the root storage object for the compound file.</span></span>

<span data-ttu-id="3d242-114">Llame a [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) para obtener acceso exclusivo de escritura a un archivo compuesto.</span><span class="sxs-lookup"><span data-stu-id="3d242-114">Call [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access to a compound file.</span></span> <span data-ttu-id="3d242-115">Llame a [**IDirectWriterLock:: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) para liberar el acceso de escritura exclusivo.</span><span class="sxs-lookup"><span data-stu-id="3d242-115">Call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release exclusive write access.</span></span>

<span data-ttu-id="3d242-116">[**IDirectWriterLock:: HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indica si el archivo está bloqueado actualmente.</span><span class="sxs-lookup"><span data-stu-id="3d242-116">[**IDirectWriterLock::HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indicates whether the file is currently locked.</span></span>

## <a name="remarks"></a><span data-ttu-id="3d242-117">Observaciones</span><span class="sxs-lookup"><span data-stu-id="3d242-117">Remarks</span></span>

<span data-ttu-id="3d242-118">La implementación de archivos compuestos de la característica de un solo escritor y varios lectores se basa en el bloqueo de intervalo.</span><span class="sxs-lookup"><span data-stu-id="3d242-118">The compound file implementation of the single-writer, multiple-reader feature is based on range locking.</span></span> <span data-ttu-id="3d242-119">El escritor obtiene acceso exclusivo al almacenamiento que se va a escribir después de que todos los lectores actuales hayan cerrado el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="3d242-119">The writer obtains exclusive access to the storage to write after all current readers have closed the storage.</span></span> <span data-ttu-id="3d242-120">Mientras el escritor está activo, los lectores posteriores no pueden abrir el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="3d242-120">While the writer is active, subsequent readers cannot open the storage.</span></span> <span data-ttu-id="3d242-121">El escritor llama a [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) para obtener acceso de escritura exclusivo.</span><span class="sxs-lookup"><span data-stu-id="3d242-121">The writer calls [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access.</span></span> <span data-ttu-id="3d242-122">Después, el escritor debe llamar a [**IDirectWriterLock:: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) para liberar el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="3d242-122">The writer must then call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release the storage.</span></span>

<span data-ttu-id="3d242-123">La llamada a [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) es necesaria antes de escribir en este modo de lector único y de varios escritores.</span><span class="sxs-lookup"><span data-stu-id="3d242-123">The call to [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) is required before writing in this single-reader, multiple-writer mode.</span></span> <span data-ttu-id="3d242-124">Los intentos de escribir en el archivo sin llamar a **IDirectWriterLock:: WaitForWriteAccess** primero generan STG \_ E \_ ACCESSDENIED.</span><span class="sxs-lookup"><span data-stu-id="3d242-124">Attempts to write to the file without calling **IDirectWriterLock::WaitForWriteAccess** first result in STG\_E\_ACCESSDENIED.</span></span> <span data-ttu-id="3d242-125">Este error se devuelve incluso si el escritor abrió el archivo inicialmente y ningún lector tiene abierto el archivo.</span><span class="sxs-lookup"><span data-stu-id="3d242-125">This error is returned even if the writer opened the file initially, and no readers currently have the file open.</span></span>

## <a name="marshaling-considerations"></a><span data-ttu-id="3d242-126">Consideraciones sobre el cálculo de referencias</span><span class="sxs-lookup"><span data-stu-id="3d242-126">Marshaling Considerations</span></span>

<span data-ttu-id="3d242-127">Normalmente, se utiliza el cálculo de referencias personalizado cuando se calculan las referencias de un archivo compuesto a otro proceso en el mismo equipo.</span><span class="sxs-lookup"><span data-stu-id="3d242-127">Custom marshaling is typically used when a compound file is marshaled to another process on the same machine.</span></span> <span data-ttu-id="3d242-128">Al calcular las referencias de los almacenamientos, no se tienen en cuenta los derechos de acceso y el puntero [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) se pasa al nuevo proceso con los mismos modos de acceso y derechos que el proceso de cálculo de referencias original.</span><span class="sxs-lookup"><span data-stu-id="3d242-128">When marshaling storages, access rights are not considered, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to the new process with the same access modes and rights as the original marshaling process.</span></span> <span data-ttu-id="3d242-129">Para obtener más información sobre los modos de acceso, vea [**constantes STGM**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="3d242-129">For more information about access modes, see [**STGM Constants**](stgm-constants.md).</span></span> <span data-ttu-id="3d242-130">Durante el cálculo de referencias, no se realiza ningún bloqueo ni se comprueba para garantizar el acceso exclusivo de escritura.</span><span class="sxs-lookup"><span data-stu-id="3d242-130">During marshaling, no locks are taken or verified to ensure exclusive write access.</span></span> <span data-ttu-id="3d242-131">En este caso, no hay ninguna aplicación de la Directiva de un solo escritor para los archivos compuestos abiertos en el modo de varios lectores.</span><span class="sxs-lookup"><span data-stu-id="3d242-131">In this case, there is no enforcement of the single-writer policy for compound files opened in the single-writer, multiple-reader mode.</span></span> <span data-ttu-id="3d242-132">En su lugar, la implementación de archivo compuesto controla internamente la aplicación.</span><span class="sxs-lookup"><span data-stu-id="3d242-132">Instead, enforcement is handled internally by the compound file implementation.</span></span>

<span data-ttu-id="3d242-133">Dado que el puntero [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) se pasa a otro proceso durante el cálculo de referencias, es posible que dos procesos tengan acceso simultáneo al mismo archivo compuesto.</span><span class="sxs-lookup"><span data-stu-id="3d242-133">Because the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to another process during marshaling, it is possible for two processes to have simultaneous access to the same compound file.</span></span> <span data-ttu-id="3d242-134">Aunque un llamador puede haber obtenido acceso exclusivo de escritura al almacenamiento mediante una llamada a [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), la versión de serialización también puede tener acceso a la vez.</span><span class="sxs-lookup"><span data-stu-id="3d242-134">Even though a caller may have obtained exclusive write access to the storage by calling [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled version can also have access simultaneously.</span></span> <span data-ttu-id="3d242-135">Las versiones serializadas no se pueden cerrar mientras el escritor único accede al archivo.</span><span class="sxs-lookup"><span data-stu-id="3d242-135">The marshaled versions are not forced to close while the single writer accesses the file.</span></span> <span data-ttu-id="3d242-136">En este caso, la implementación de archivo compuesto sincroniza las escrituras internamente.</span><span class="sxs-lookup"><span data-stu-id="3d242-136">In this case, the compound file implementation synchronizes the writes internally.</span></span>

<span data-ttu-id="3d242-137">Si un solo escritor obtiene acceso exclusivo llamando a, [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), el almacenamiento de cálculo de referencias también tiene acceso de escritura y no tiene que llamar a **IDirectWriterLock:: WaitForWriteAccess**.</span><span class="sxs-lookup"><span data-stu-id="3d242-137">If a single writer obtains exclusive access by calling, [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled storage also has write access and does not have to call **IDirectWriterLock::WaitForWriteAccess**.</span></span> <span data-ttu-id="3d242-138">Ambos procesos tienen acceso de escritura y la sincronización se controla mediante la implementación interna de archivos compuestos.</span><span class="sxs-lookup"><span data-stu-id="3d242-138">Both processes have write access and synchronization is controlled by the internal compound file implementation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3d242-139">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="3d242-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3d242-140">**IDirectWriterLock**</span><span class="sxs-lookup"><span data-stu-id="3d242-140">**IDirectWriterLock**</span></span>](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock)
</dt> </dl>

 

 




