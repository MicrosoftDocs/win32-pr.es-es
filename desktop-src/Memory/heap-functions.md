---
description: Cada proceso tiene un montón predeterminado proporcionado por el sistema. Las aplicaciones que realizan asignaciones frecuentes del montón pueden mejorar el rendimiento mediante el uso de montones privados.
ms.assetid: cfb683fa-4f46-48b5-9a28-f4625a9cb8cd
title: Funciones del montón
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0e591c1e349ed6806cbebe00a178a99e63bb412
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909478"
---
# <a name="heap-functions"></a><span data-ttu-id="42493-104">Funciones del montón</span><span class="sxs-lookup"><span data-stu-id="42493-104">Heap Functions</span></span>

<span data-ttu-id="42493-105">Cada proceso tiene un montón predeterminado proporcionado por el sistema.</span><span class="sxs-lookup"><span data-stu-id="42493-105">Each process has a default heap provided by the system.</span></span> <span data-ttu-id="42493-106">Las aplicaciones que realizan asignaciones frecuentes del montón pueden mejorar el rendimiento mediante el uso de montones privados.</span><span class="sxs-lookup"><span data-stu-id="42493-106">Applications that make frequent allocations from the heap can improve performance by using private heaps.</span></span>

<span data-ttu-id="42493-107">Un montón privado es un bloque de una o varias páginas en el espacio de direcciones del proceso de llamada.</span><span class="sxs-lookup"><span data-stu-id="42493-107">A private heap is a block of one or more pages in the address space of the calling process.</span></span> <span data-ttu-id="42493-108">Después de crear el montón privado, el proceso usa funciones como [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) y [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) para administrar la memoria del montón.</span><span class="sxs-lookup"><span data-stu-id="42493-108">After creating the private heap, the process uses functions such as [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) and [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) to manage the memory in that heap.</span></span>

<span data-ttu-id="42493-109">Las funciones del montón también se pueden usar para administrar la memoria en el montón predeterminado del proceso, utilizando el identificador devuelto por la función [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) .</span><span class="sxs-lookup"><span data-stu-id="42493-109">The heap functions can also be used to manage memory in the process's default heap, using the handle returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function.</span></span> <span data-ttu-id="42493-110">Las nuevas aplicaciones deben usar las funciones del montón en lugar de las [funciones globales y locales](global-and-local-functions.md) para este fin.</span><span class="sxs-lookup"><span data-stu-id="42493-110">New applications should use the heap functions instead of the [global and local functions](global-and-local-functions.md) for this purpose.</span></span>

<span data-ttu-id="42493-111">No hay ninguna diferencia entre la memoria asignada de un montón privado y la asignada mediante las demás funciones de asignación de memoria.</span><span class="sxs-lookup"><span data-stu-id="42493-111">There is no difference between memory allocated from a private heap and that allocated by using the other memory allocation functions.</span></span> <span data-ttu-id="42493-112">Para obtener una lista completa de las funciones, consulte la tabla en [funciones de administración de memoria](memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="42493-112">For a complete list of functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="42493-113">Un subproceso debe llamar a las funciones del montón solo para el montón predeterminado del proceso y los montones privados que el subproceso crea y administra, utilizando los identificadores devueltos por la función [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) o [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="42493-113">A thread should call heap functions only for the process's default heap and private heaps that the thread creates and manages, using handles returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) or [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span>

 

<span data-ttu-id="42493-114">La función [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) crea un objeto de montón privado desde el que el proceso de llamada puede asignar bloques de memoria mediante la función [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) .</span><span class="sxs-lookup"><span data-stu-id="42493-114">The [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function creates a private heap object from which the calling process can allocate memory blocks by using the [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function.</span></span> <span data-ttu-id="42493-115">**HeapCreate** especifica tanto el tamaño inicial como el tamaño máximo del montón.</span><span class="sxs-lookup"><span data-stu-id="42493-115">**HeapCreate** specifies both an initial size and a maximum size for the heap.</span></span> <span data-ttu-id="42493-116">El tamaño inicial determina el número de páginas confirmadas, de lectura y escritura asignadas inicialmente para el montón.</span><span class="sxs-lookup"><span data-stu-id="42493-116">The initial size determines the number of committed, read/write pages initially allocated for the heap.</span></span> <span data-ttu-id="42493-117">El tamaño máximo determina el número total de páginas reservadas.</span><span class="sxs-lookup"><span data-stu-id="42493-117">The maximum size determines the total number of reserved pages.</span></span> <span data-ttu-id="42493-118">Estas páginas crean un bloque contiguo en el espacio de direcciones virtuales de un proceso en el que el montón puede crecer.</span><span class="sxs-lookup"><span data-stu-id="42493-118">These pages create a contiguous block in the virtual address space of a process into which the heap can grow.</span></span> <span data-ttu-id="42493-119">Las páginas adicionales se confirman automáticamente desde este espacio reservado si las solicitudes de **HeapAlloc** superan el tamaño actual de las páginas confirmadas, siempre que el almacenamiento físico esté disponible.</span><span class="sxs-lookup"><span data-stu-id="42493-119">Additional pages are automatically committed from this reserved space if requests by **HeapAlloc** exceed the current size of committed pages, assuming that the physical storage for it is available.</span></span> <span data-ttu-id="42493-120">Una vez que se confirman las páginas, no se desasignan hasta que finaliza el proceso o hasta que el montón se destruye llamando a la función [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) .</span><span class="sxs-lookup"><span data-stu-id="42493-120">Once the pages are committed, they are not decommitted until the process is terminated or until the heap is destroyed by calling the [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function.</span></span>

<span data-ttu-id="42493-121">La memoria de un objeto de montón privado solo es accesible para el proceso que lo creó.</span><span class="sxs-lookup"><span data-stu-id="42493-121">The memory of a private heap object is accessible only to the process that created it.</span></span> <span data-ttu-id="42493-122">Si una biblioteca de vínculos dinámicos (DLL) crea un montón privado, lo hace en el espacio de direcciones del proceso que llamó a la DLL.</span><span class="sxs-lookup"><span data-stu-id="42493-122">If a dynamic-link library (DLL) creates a private heap, it does so in the address space of the process that called the DLL.</span></span> <span data-ttu-id="42493-123">Solo es accesible para ese proceso.</span><span class="sxs-lookup"><span data-stu-id="42493-123">It is accessible only to that process.</span></span>

<span data-ttu-id="42493-124">La función [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) asigna un número especificado de bytes de un montón privado y devuelve un puntero al bloque asignado.</span><span class="sxs-lookup"><span data-stu-id="42493-124">The [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function allocates a specified number of bytes from a private heap and returns a pointer to the allocated block.</span></span> <span data-ttu-id="42493-125">Este puntero se puede usar en las funciones [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)y [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) .</span><span class="sxs-lookup"><span data-stu-id="42493-125">This pointer can be used in the [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize), and [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) functions.</span></span>

<span data-ttu-id="42493-126">La memoria asignada por [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) no es movible.</span><span class="sxs-lookup"><span data-stu-id="42493-126">Memory allocated by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is not movable.</span></span> <span data-ttu-id="42493-127">La dirección devuelta por **HeapAlloc** es válida hasta que el bloque de memoria se libera o se vuelve a asignar. no es necesario que el bloque de memoria esté bloqueado.</span><span class="sxs-lookup"><span data-stu-id="42493-127">The address returned by **HeapAlloc** is valid until the memory block is freed or reallocated; the memory block does not need to be locked.</span></span>

<span data-ttu-id="42493-128">Dado que el sistema no puede compactar un montón privado, se puede fragmentar.</span><span class="sxs-lookup"><span data-stu-id="42493-128">Because the system cannot compact a private heap, it can become fragmented.</span></span> <span data-ttu-id="42493-129">Las aplicaciones que asignan grandes cantidades de memoria en varios tamaños de asignación pueden utilizar el [montón de baja fragmentación](low-fragmentation-heap.md) para reducir la fragmentación del montón.</span><span class="sxs-lookup"><span data-stu-id="42493-129">Applications that allocate large amounts of memory in various allocation sizes can use the [low-fragmentation heap](low-fragmentation-heap.md) to reduce heap fragmentation.</span></span>

<span data-ttu-id="42493-130">Un posible uso de las funciones del montón es crear un montón privado cuando se inicia un proceso, especificando un tamaño inicial suficiente para satisfacer los requisitos de memoria del proceso.</span><span class="sxs-lookup"><span data-stu-id="42493-130">A possible use for the heap functions is to create a private heap when a process starts up, specifying an initial size sufficient to satisfy the memory requirements of the process.</span></span> <span data-ttu-id="42493-131">Si se produce un error en la llamada a la función [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) , el proceso puede finalizar o notificar al usuario sobre la escasez de memoria. sin embargo, si se realiza correctamente, se garantiza que el proceso tiene la memoria que necesita.</span><span class="sxs-lookup"><span data-stu-id="42493-131">If the call to the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function fails, the process can terminate or notify the user of the memory shortage; if it succeeds, however, the process is assured of having the memory it needs.</span></span>

<span data-ttu-id="42493-132">La memoria solicitada por [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) puede ser contigua o no.</span><span class="sxs-lookup"><span data-stu-id="42493-132">Memory requested by [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) may or may not be contiguous.</span></span> <span data-ttu-id="42493-133">La memoria asignada dentro de un montón por [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) es contigua.</span><span class="sxs-lookup"><span data-stu-id="42493-133">Memory allocated within a heap by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is contiguous.</span></span> <span data-ttu-id="42493-134">No debe escribir ni leer de la memoria en un montón, salvo que lo asigna **HeapAlloc**, y no debe asumir ninguna relación entre dos áreas de memoria asignadas por **HeapAlloc**.</span><span class="sxs-lookup"><span data-stu-id="42493-134">You should not write to or read from memory in a heap except that allocated by **HeapAlloc**, nor should you assume any relationship between two areas of memory allocated by **HeapAlloc**.</span></span>

<span data-ttu-id="42493-135">No debe hacer referencia de ningún modo a la memoria que se ha liberado por [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span><span class="sxs-lookup"><span data-stu-id="42493-135">You should not refer in any way to memory that has been freed by [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span></span> <span data-ttu-id="42493-136">Una vez liberada la memoria, toda la información que pueda haber estado en ella desaparecerá para siempre.</span><span class="sxs-lookup"><span data-stu-id="42493-136">After the memory is freed, any information that may have been in it is gone forever.</span></span> <span data-ttu-id="42493-137">Si necesita información, no libere memoria que contenga la información.</span><span class="sxs-lookup"><span data-stu-id="42493-137">If you require information, do not free memory containing the information.</span></span> <span data-ttu-id="42493-138">Las llamadas de función que devuelven información sobre la memoria (como [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) no se pueden usar con la memoria liberada, ya que pueden devolver datos ficticios.</span><span class="sxs-lookup"><span data-stu-id="42493-138">Function calls that return information about memory (such as [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) may not be used with freed memory, as they may return bogus data.</span></span>

<span data-ttu-id="42493-139">La función [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) destruye un objeto de montón privado.</span><span class="sxs-lookup"><span data-stu-id="42493-139">The [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function destroys a private heap object.</span></span> <span data-ttu-id="42493-140">Anula la confirmación y libera todas las páginas del objeto Heap, y invalida el identificador del montón.</span><span class="sxs-lookup"><span data-stu-id="42493-140">It decommits and releases all the pages of the heap object, and it invalidates the handle to the heap.</span></span>

## <a name="related-topics"></a><span data-ttu-id="42493-141">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="42493-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="42493-142">Comparar métodos de asignación de memoria</span><span class="sxs-lookup"><span data-stu-id="42493-142">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 



