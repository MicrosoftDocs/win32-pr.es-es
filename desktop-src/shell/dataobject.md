---
description: El objeto de datos es fundamental para todas las transferencias de datos de Shell.
ms.assetid: c63d339e-ac62-4da1-b5ce-22d45a6a3413
title: Objeto de datos de shell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 69a6c411310b6c9e9f28df4de048d3b6909c44b9
ms.sourcegitcommit: 822413efb4a70dd464e5db4d9e8693ef74f8132f
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/09/2021
ms.locfileid: "113581633"
---
# <a name="shell-data-object"></a><span data-ttu-id="0dd1c-103">Objeto de datos de shell</span><span class="sxs-lookup"><span data-stu-id="0dd1c-103">Shell Data Object</span></span>

<span data-ttu-id="0dd1c-104">El objeto de datos es fundamental para todas las transferencias de datos de Shell.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-104">The data object is central to all Shell data transfers.</span></span> <span data-ttu-id="0dd1c-105">Es principalmente un contenedor para contener los datos transferidos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-105">It is primarily a container to hold the transferred data.</span></span> <span data-ttu-id="0dd1c-106">Sin embargo, el destino también puede comunicarse con el objeto de datos para facilitar algunos tipos especializados de transferencia de datos de Shell, como los movimientos optimizados.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-106">However, the target can also communicate with the data object to facilitate some specialized types of Shell data transfer such as optimized moves.</span></span> <span data-ttu-id="0dd1c-107">En este tema se proporciona una explicación general de cómo funcionan los objetos de datos de Shell, cómo se construyen mediante un origen y cómo se controlan mediante un destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-107">This topic provides a general discussion of how Shell data objects work, how they are constructed by a source, and how they are handled by a target.</span></span> <span data-ttu-id="0dd1c-108">Para obtener una explicación detallada de cómo usar objetos de datos para transferir diferentes tipos de datos de Shell, vea [Handling Shell Data Transfer Scenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-108">For a detailed discussion of how to use data objects to transfer different types of Shell data, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

-   [<span data-ttu-id="0dd1c-109">Cómo funcionan los objetos de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-109">How Data Objects Work</span></span>](#how-data-objects-work)
    -   [<span data-ttu-id="0dd1c-110">Formatos del Portapapeles</span><span class="sxs-lookup"><span data-stu-id="0dd1c-110">Clipboard Formats</span></span>](#clipboard-formats)
    -   [<span data-ttu-id="0dd1c-111">Estructura FORMATETC</span><span class="sxs-lookup"><span data-stu-id="0dd1c-111">FORMATETC Structure</span></span>](#formatetc-structure)
    -   [<span data-ttu-id="0dd1c-112">Estructura STGMEDIUM</span><span class="sxs-lookup"><span data-stu-id="0dd1c-112">STGMEDIUM structure</span></span>](#stgmedium-structure)
-   [<span data-ttu-id="0dd1c-113">Cómo un origen crea un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-113">How a Source Creates a Data Object</span></span>](#how-a-source-creates-a-data-object)
    -   [<span data-ttu-id="0dd1c-114">Cómo agregar un objeto de memoria global a un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-114">How to Add a Global Memory Object to a Data Object</span></span>](#how-to-add-a-global-memory-object-to-a-data-object)
    -   [<span data-ttu-id="0dd1c-115">Implementación de IDataObject</span><span class="sxs-lookup"><span data-stu-id="0dd1c-115">Implementing IDataObject</span></span>](#implementing-idataobject)
    -   [<span data-ttu-id="0dd1c-116">Implementación de IDropSource</span><span class="sxs-lookup"><span data-stu-id="0dd1c-116">Implementing IDropSource</span></span>](#implementing-idropsource)
-   [<span data-ttu-id="0dd1c-117">Cómo controla un destino un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-117">How a Target Handles a Data Object</span></span>](#how-a-target-handles-a-data-object)
    -   [<span data-ttu-id="0dd1c-118">Extracción de datos de shell de un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-118">Extracting Shell Data from a Data Object</span></span>](#extracting-shell-data-from-a-data-object)
    -   [<span data-ttu-id="0dd1c-119">Implementación de IDropTarget</span><span class="sxs-lookup"><span data-stu-id="0dd1c-119">Implementing IDropTarget</span></span>](#implementing-idroptarget)
-   [<span data-ttu-id="0dd1c-120">Usar el objeto auxiliar de arrastrar y colocar</span><span class="sxs-lookup"><span data-stu-id="0dd1c-120">Using the Drag-and-Drop Helper Object</span></span>](#using-the-drag-and-drop-helper-object)
    -   [<span data-ttu-id="0dd1c-121">Uso de la interfaz IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="0dd1c-121">Using the IDragSourceHelper Interface</span></span>](#using-the-idragsourcehelper-interface)
    -   [<span data-ttu-id="0dd1c-122">Uso de la interfaz IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="0dd1c-122">Using the IDropTargetHelper Interface</span></span>](#using-the-idroptargethelper-interface)

## <a name="how-data-objects-work"></a><span data-ttu-id="0dd1c-123">Cómo funcionan los objetos de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-123">How Data Objects Work</span></span>

<span data-ttu-id="0dd1c-124">Los objetos de datos son objetos del Modelo de objetos componentes (COM), creados por el origen de datos para transferir datos a un destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-124">Data objects are Component Object Model (COM) objects, created by the data source to transfer data to a target.</span></span> <span data-ttu-id="0dd1c-125">Normalmente llevan más de un elemento de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-125">They typically carry more than one item of data.</span></span> <span data-ttu-id="0dd1c-126">Hay dos razones para esta práctica:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-126">There are two reasons for this practice:</span></span>

-   <span data-ttu-id="0dd1c-127">Aunque casi cualquier tipo de datos se puede transferir con un objeto de datos, el origen normalmente no sabe qué tipo de datos puede aceptar el destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-127">While almost any type of data can be transferred with a data object, the source typically does not know what kind of data the target can accept.</span></span> <span data-ttu-id="0dd1c-128">Por ejemplo, los datos pueden ser una parte de un documento de texto con formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-128">For instance, the data might be a portion of a formatted text document.</span></span> <span data-ttu-id="0dd1c-129">Aunque es posible que el destino pueda controlar información de formato compleja, también podría aceptar solo texto ANSI.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-129">While the target might be able to handle complex formatting information, it might also be able to accept only ANSI text.</span></span> <span data-ttu-id="0dd1c-130">Por esta razón, los objetos de datos suelen incluir los mismos datos en varios formatos diferentes.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-130">For this reason, data objects often include the same data in several different formats.</span></span> <span data-ttu-id="0dd1c-131">A continuación, el destino puede extraer los datos en un formato que pueda controlar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-131">The target can then extract the data in a format that it can handle.</span></span>
-   <span data-ttu-id="0dd1c-132">Los objetos de datos también pueden contener elementos de datos auxiliares que no son versiones de los datos de origen.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-132">Data objects can also contain auxiliary data items that are not versions of source data.</span></span> <span data-ttu-id="0dd1c-133">Este tipo de elemento de datos normalmente proporciona información adicional sobre la operación de transferencia de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-133">This type of data item typically provides additional information about the data transfer operation.</span></span> <span data-ttu-id="0dd1c-134">Por ejemplo, el Shell usa elementos de datos auxiliares para indicar si un archivo se va a copiar o mover.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-134">For instance, the Shell uses auxiliary data items to indicate whether a file is to be copied or moved.</span></span>

### <a name="clipboard-formats"></a><span data-ttu-id="0dd1c-135">Formatos del Portapapeles</span><span class="sxs-lookup"><span data-stu-id="0dd1c-135">Clipboard Formats</span></span>

<span data-ttu-id="0dd1c-136">Cada elemento de datos de un objeto de datos tiene un formato asociado, normalmente denominado formato *del Portapapeles*.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-136">Each item of data in a data object has an associated format, usually called a *clipboard format*.</span></span> <span data-ttu-id="0dd1c-137">Hay una serie de formatos estándar del Portapapeles, declarados en Winuser.h, que corresponden a tipos de datos usados habitualmente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-137">There are a number of standard clipboard formats, declared in Winuser.h, that correspond to commonly used types of data.</span></span> <span data-ttu-id="0dd1c-138">Los formatos del Portapapeles son enteros, pero normalmente se hace referencia a ellos por su nombre equivalente, que tiene el formato CF \_ *XXX*.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-138">Clipboard formats are integers, but they are normally referred to by their equivalent name, which has the form CF\_*XXX*.</span></span> <span data-ttu-id="0dd1c-139">Por ejemplo, el formato del Portapapeles para el texto ANSI es CF \_ TEXT.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-139">For instance, the clipboard format for ANSI text is CF\_TEXT.</span></span>

<span data-ttu-id="0dd1c-140">Las aplicaciones pueden ampliar el intervalo de formatos disponibles del Portapapeles mediante la definición de formatos privados.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-140">Applications can extend the range of available clipboard formats by defining private formats.</span></span> <span data-ttu-id="0dd1c-141">Para definir un formato privado, una aplicación llama a [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) con una cadena que identifica el formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-141">To define a private format, an application calls [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) with a string that identifies the format.</span></span> <span data-ttu-id="0dd1c-142">El entero sin signo que devuelve la función es un valor de formato válido que se puede usar igual que un formato estándar del Portapapeles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-142">The unsigned integer that the function returns is a valid format value that can be used just like a standard clipboard format.</span></span> <span data-ttu-id="0dd1c-143">Sin embargo, tanto el origen como el destino deben registrar el formato para poder usarlo.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-143">However, both source and target must register the format in order to use it.</span></span> <span data-ttu-id="0dd1c-144">Con una excepción,[CF \_ HDROP,](clipboard.md)los formatos del Portapapeles usados para transferir datos de Shell se definen como formatos privados.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-144">With one exception—[CF\_HDROP](clipboard.md)—the clipboard formats used to transfer Shell data are defined as private formats.</span></span> <span data-ttu-id="0dd1c-145">Deben estar registrados por el origen y el destino para poder usarse.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-145">They must be registered by the source and target before they can be used.</span></span> <span data-ttu-id="0dd1c-146">Para obtener una descripción de los formatos de Portapapeles de Shell disponibles, vea Formatos del Portapapeles de Shell.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-146">For a description of the available Shell clipboard formats, see Shell Clipboard Formats.</span></span>

<span data-ttu-id="0dd1c-147">Aunque hay algunas excepciones, los objetos de datos normalmente contienen solo un elemento de datos para cada formato del Portapapeles que admitan.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-147">Although there are some exceptions, data objects normally contain only one item of data for each clipboard format they support.</span></span> <span data-ttu-id="0dd1c-148">Esta correlación uno a uno entre el formato y los datos permite que el valor de formato se utilice como identificador para el elemento de datos asociado.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-148">This one-to-one correlation between format and data allows the format value to be used as an identifier for the associated data item.</span></span> <span data-ttu-id="0dd1c-149">De hecho, al analizar el contenido de un objeto de datos, un elemento determinado de datos normalmente se denomina "formato" y se hace referencia a él por su nombre de formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-149">In fact, when discussing the contents of a data object, a particular item of data is typically called a "format" and is referred to by its format name.</span></span> <span data-ttu-id="0dd1c-150">Por ejemplo, frases como "Extraer el formato CF \_ TEXT..." se usan normalmente al analizar el elemento de datos de texto ANSI de un objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-150">For example, phrases such as "Extract the CF\_TEXT format..." are typically used when discussing a data object's ANSI text data item.</span></span>

<span data-ttu-id="0dd1c-151">Cuando el destino de colocación recibe el puntero al objeto de datos, el destino de colocación enumera los formatos disponibles para determinar qué tipos de datos están disponibles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-151">When the drop target receives the pointer to the data object, the drop target enumerates the available formats to determine what types of data are available.</span></span> <span data-ttu-id="0dd1c-152">A continuación, solicita uno o varios de los formatos disponibles y extrae los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-152">It then requests one or more of the available formats and extracts the data.</span></span> <span data-ttu-id="0dd1c-153">La forma específica en que el destino extrae datos de Shell de un objeto de datos varía según el formato; esto se describe en detalle en [How a Target Handles a Data Object](#how-a-target-handles-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-153">The specific way that the target extracts Shell data from a data object varies with the format; this is discussed in detail in [How a Target Handles a Data Object](#how-a-target-handles-a-data-object).</span></span>

<span data-ttu-id="0dd1c-154">Con transferencias de datos sencillas del Portapapeles, los datos se colocan en un objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-154">With simple clipboard data transfers, the data is placed in a global memory object.</span></span> <span data-ttu-id="0dd1c-155">La dirección de ese objeto se coloca en el Portapapeles, junto con su formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-155">The address of that object is placed on the Clipboard, along with its format.</span></span> <span data-ttu-id="0dd1c-156">El formato del Portapapeles indica al destino qué tipo de datos encontrará en la dirección asociada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-156">The clipboard format tells the target what kind of data it will find at the associated address.</span></span> <span data-ttu-id="0dd1c-157">Aunque las transferencias sencillas del Portapapeles son fáciles de implementar:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-157">While simple clipboard transfers are easy to implement:</span></span>

-   <span data-ttu-id="0dd1c-158">Los objetos de datos proporcionan una manera mucho más flexible de transferir datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-158">Data objects provide a much more flexible way to transfer data.</span></span>
-   <span data-ttu-id="0dd1c-159">Los objetos de datos son más adecuados para transferir grandes cantidades de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-159">Data objects are better suited for transferring large amounts of data.</span></span>
-   <span data-ttu-id="0dd1c-160">Los objetos de datos se deben usar para transferir datos con una operación de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-160">Data objects must be used to transfer data with a drag-and-drop operation.</span></span>

<span data-ttu-id="0dd1c-161">Por estos motivos, todas las transferencias de datos de Shell usan objetos de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-161">For these reasons, all Shell data transfers use data objects.</span></span> <span data-ttu-id="0dd1c-162">Con objetos de datos, los formatos del Portapapeles no se usan directamente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-162">With data objects, clipboard formats are not used directly.</span></span> <span data-ttu-id="0dd1c-163">En su lugar, los elementos de datos se identifican con una generalización del formato del Portapapeles, [**una estructura FORMATETC.**](/windows/win32/api/objidl/ns-objidl-formatetc)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-163">Instead, data items are identified with a generalization of the clipboard format, a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span>

### <a name="formatetc-structure"></a><span data-ttu-id="0dd1c-164">Estructura FORMATETC</span><span class="sxs-lookup"><span data-stu-id="0dd1c-164">FORMATETC Structure</span></span>

<span data-ttu-id="0dd1c-165">La [**estructura FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) es una versión extendida de un formato del Portapapeles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-165">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is an extended version of a clipboard format.</span></span> <span data-ttu-id="0dd1c-166">Como se usa para las transferencias de datos de Shell, **la estructura FORMATETC** tiene las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-166">As used for Shell data transfers, the **FORMATETC** structure has the following characteristics:</span></span>

-   <span data-ttu-id="0dd1c-167">Un elemento de datos todavía se identifica por su formato de Portapapeles, en el **miembro cfFormat.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-167">A data item is still identified by its clipboard format, in the **cfFormat** member.</span></span>
-   <span data-ttu-id="0dd1c-168">La transferencia de datos no se limita a los objetos de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-168">Data transfer is not limited to global memory objects.</span></span> <span data-ttu-id="0dd1c-169">El **miembro tymed** se usa para indicar el mecanismo de transferencia de datos contenido en la estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) asociada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-169">The **tymed** member is used to indicate the data transfer mechanism contained in the associated [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0dd1c-170">Se establece en uno de los valores [**\_ XXX de TYMED.**](/windows/win32/api/objidl/ne-objidl-tymed)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-170">It is set to one of the [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) values.</span></span>
-   <span data-ttu-id="0dd1c-171">El shell usa el **miembro lIndex** con su formato [ \_ FILECONTENTS de CFSTR](clipboard.md) para permitir que un objeto de datos contenga más de un elemento de datos por formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-171">The Shell uses the **lIndex** member with its [CFSTR\_FILECONTENTS](clipboard.md) format to allow a data object to contain more than one data item per format.</span></span> <span data-ttu-id="0dd1c-172">Para obtener una explicación sobre cómo usar este formato, vea la sección Using *the CFSTR \_ FILECONTENTS Format to Extract Data from a File* (Uso del formato FILECONTENTS de CFSTR para extraer datos de un archivo) de [Handling Shell Data Transfer Scenarios](datascenarios.md)(Controlar escenarios de transferencia de datos del shell).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-172">For a discussion of how to use this format, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>
-   <span data-ttu-id="0dd1c-173">El **miembro dwAspect** normalmente se establece en DVASPECT \_ CONTENT.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-173">The **dwAspect** member is typically set to DVASPECT\_CONTENT.</span></span> <span data-ttu-id="0dd1c-174">Sin embargo, hay tres valores definidos en Shlobj.h que se pueden usar para la transferencia de datos de Shell.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-174">However, there are three values defined in Shlobj.h that can be used for Shell data transfer.</span></span> 

    | <span data-ttu-id="0dd1c-175">Value</span><span class="sxs-lookup"><span data-stu-id="0dd1c-175">Value</span></span>               | <span data-ttu-id="0dd1c-176">Descripción</span><span class="sxs-lookup"><span data-stu-id="0dd1c-176">Description</span></span>                                                                                       |
    |---------------------|---------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="0dd1c-177">DVASPECT \_ COPY</span><span class="sxs-lookup"><span data-stu-id="0dd1c-177">DVASPECT\_COPY</span></span>      | <span data-ttu-id="0dd1c-178">Se usa para indicar que el formato representa una copia de los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-178">Used to indicate that the format represents a copy of the data.</span></span>                                   |
    | <span data-ttu-id="0dd1c-179">VÍNCULO \_ DVASPECT</span><span class="sxs-lookup"><span data-stu-id="0dd1c-179">DVASPECT\_LINK</span></span>      | <span data-ttu-id="0dd1c-180">Se usa para indicar que el formato representa un acceso directo a los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-180">Used to indicate that the format represents a shortcut to the data.</span></span>                               |
    | <span data-ttu-id="0dd1c-181">DVASPECT \_ SHORTNAME</span><span class="sxs-lookup"><span data-stu-id="0dd1c-181">DVASPECT\_SHORTNAME</span></span> | <span data-ttu-id="0dd1c-182">Se usa con el formato CF HDROP para solicitar una ruta de \_ acceso de archivo con los nombres abreviados al formato 8.3.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-182">Used with the CF\_HDROP format to request a file path with the names shortened to the 8.3 format.</span></span> |

    

     

-   <span data-ttu-id="0dd1c-183">El **miembro ptd** no se usa para las transferencias de datos de Shell y normalmente se establece en **NULL.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-183">The **ptd** member is not used for Shell data transfers and is normally set to **NULL**.</span></span>

### <a name="stgmedium-structure"></a><span data-ttu-id="0dd1c-184">Estructura STGMEDIUM</span><span class="sxs-lookup"><span data-stu-id="0dd1c-184">STGMEDIUM structure</span></span>

<span data-ttu-id="0dd1c-185">La [**estructura STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) proporciona acceso a los datos que se transfieren.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-185">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure provides access to the data being transferred.</span></span> <span data-ttu-id="0dd1c-186">Se admiten tres mecanismos de transferencia de datos para los datos de Shell:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-186">Three data transfer mechanisms are supported for Shell data:</span></span>

-   <span data-ttu-id="0dd1c-187">Objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-187">A global memory object.</span></span>
-   <span data-ttu-id="0dd1c-188">Interfaz [**IStream.**](/windows/win32/api/objidl/nn-objidl-istream)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-188">An [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span>
-   <span data-ttu-id="0dd1c-189">Interfaz [**IStorage.**](/windows/win32/api/objidl/nn-objidl-istorage)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-189">An [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span>

<span data-ttu-id="0dd1c-190">El **miembro tymed** de la [**estructura STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) es un valor [**\_ XXX de TYMED**](/windows/win32/api/objidl/ne-objidl-tymed) que identifica el mecanismo de transferencia de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-190">The **tymed** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure is a [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) value that identifies the data transfer mechanism.</span></span> <span data-ttu-id="0dd1c-191">El segundo miembro es un puntero que usa el destino para extraer los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-191">The second member is a pointer that is used by the target to extract the data.</span></span> <span data-ttu-id="0dd1c-192">El puntero puede ser uno de varios tipos, dependiendo del **valor tymed.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-192">The pointer can be one of a variety of types, depending on the **tymed** value.</span></span> <span data-ttu-id="0dd1c-193">Los tres **valores de tymed** que se usan para las transferencias de datos de Shell se resumen en la tabla siguiente, junto con su nombre de miembro **STGMEDIUM** correspondiente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-193">The three **tymed** values that are used for Shell data transfers are summarized in the following table, along with their corresponding **STGMEDIUM** member name.</span></span>



| <span data-ttu-id="0dd1c-194">Valor de tymed</span><span class="sxs-lookup"><span data-stu-id="0dd1c-194">tymed Value</span></span>     | <span data-ttu-id="0dd1c-195">Nombre del miembro</span><span class="sxs-lookup"><span data-stu-id="0dd1c-195">Member name</span></span> | <span data-ttu-id="0dd1c-196">Descripción</span><span class="sxs-lookup"><span data-stu-id="0dd1c-196">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="0dd1c-197">TYMED \_ HGLOBAL</span><span class="sxs-lookup"><span data-stu-id="0dd1c-197">TYMED\_HGLOBAL</span></span>  | <span data-ttu-id="0dd1c-198">**hGlobal**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-198">**hGlobal**</span></span> | <span data-ttu-id="0dd1c-199">Puntero a un objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-199">A pointer to a global memory object.</span></span> <span data-ttu-id="0dd1c-200">Este tipo de puntero se usa normalmente para transferir pequeñas cantidades de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-200">This pointer type is typically used for transferring small amounts of data.</span></span> <span data-ttu-id="0dd1c-201">Por ejemplo, el Shell usa objetos de memoria global para transferir cadenas de texto cortas, como nombres de archivo o direcciones URL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-201">For instance, the Shell uses global memory objects to transfer short text strings such as file names or URLs.</span></span>                                                                                    |
| <span data-ttu-id="0dd1c-202">TYMED \_ ISTREAM</span><span class="sxs-lookup"><span data-stu-id="0dd1c-202">TYMED\_ISTREAM</span></span>  | <span data-ttu-id="0dd1c-203">**pstm**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-203">**pstm**</span></span>    | <span data-ttu-id="0dd1c-204">Puntero a una [**interfaz IStream.**](/windows/win32/api/objidl/nn-objidl-istream)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-204">A pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="0dd1c-205">Este tipo de puntero es el preferido para la mayoría de las transferencias de datos de Shell porque requiere relativamente poca memoria en comparación con TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-205">This pointer type is preferred for most Shell data transfers because it requires relatively little memory compared to TYMED\_HGLOBAL.</span></span> <span data-ttu-id="0dd1c-206">Además, el mecanismo de transferencia de datos ISTREAM de TYMED no requiere que el origen almacene \_ sus datos de ninguna manera determinada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-206">Also, the TYMED\_ISTREAM data transfer mechanism does not require the source to store its data in any particular way.</span></span> |
| <span data-ttu-id="0dd1c-207">TYMED \_ ISTORAGE</span><span class="sxs-lookup"><span data-stu-id="0dd1c-207">TYMED\_ISTORAGE</span></span> | <span data-ttu-id="0dd1c-208">**Pstg**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-208">**pstg**</span></span>    | <span data-ttu-id="0dd1c-209">Puntero a una [**interfaz IStorage.**](/windows/win32/api/objidl/nn-objidl-istorage)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-209">A pointer to an [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="0dd1c-210">El destino llama a los métodos de interfaz para extraer los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-210">The target calls the interface methods to extract the data.</span></span> <span data-ttu-id="0dd1c-211">Al igual que TYMED \_ ISTREAM, este tipo de puntero requiere relativamente poca memoria.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-211">Like TYMED\_ISTREAM, this pointer type requires relatively little memory.</span></span> <span data-ttu-id="0dd1c-212">Sin embargo, dado que TYMED ISTORAGE es menos flexible que \_ TYMED ISTREAM, no se \_ usa con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-212">However, because TYMED\_ISTORAGE is less flexible than TYMED\_ISTREAM, it is not as commonly used.</span></span>                  |



 

## <a name="how-a-source-creates-a-data-object"></a><span data-ttu-id="0dd1c-213">Cómo crea un origen un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-213">How a Source Creates a Data Object</span></span>

<span data-ttu-id="0dd1c-214">Cuando un usuario inicia una transferencia de datos de Shell, el origen es responsable de crear un objeto de datos y cargarlo con datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-214">When a user initiates a Shell data transfer, the source is responsible for creating a data object and loading it with data.</span></span> <span data-ttu-id="0dd1c-215">En el procedimiento siguiente se resume el proceso:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-215">The following procedure summarizes the process:</span></span>

1.  <span data-ttu-id="0dd1c-216">Llame [a RegisterClipboardFormat para](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) obtener un valor de formato de Portapapeles válido para cada formato de shell que se incluirá en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-216">Call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for each Shell format that will be included in the data object.</span></span> <span data-ttu-id="0dd1c-217">Recuerde que [CF \_ HDROP](clipboard.md) ya es un formato válido del Portapapeles y no es necesario registrarlo.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-217">Remember that [CF\_HDROP](clipboard.md) is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="0dd1c-218">Para cada formato que se va a transferir, coloque los datos asociados en un objeto de memoria global o cree un objeto que proporciona acceso a los datos a través de una [**interfaz IStream**](/windows/win32/api/objidl/nn-objidl-istream) [**o IStorage.**](/windows/win32/api/objidl/nn-objidl-istorage)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-218">For each format to be transferred, either put the associated data into a global memory object or create an object that provides access to that data through an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="0dd1c-219">Las **interfaces IStream** **e IStorage** se crean mediante técnicas COM estándar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-219">The **IStream** and **IStorage** interfaces are created using standard COM techniques.</span></span> <span data-ttu-id="0dd1c-220">Para obtener una explicación sobre cómo controlar objetos de memoria global, vea Cómo agregar un objeto de [memoria global a un objeto de datos](#how-to-add-a-global-memory-object-to-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-220">For a discussion of how to handle global memory objects, see [How to Add a Global Memory Object to a Data Object](#how-to-add-a-global-memory-object-to-a-data-object).</span></span>
3.  <span data-ttu-id="0dd1c-221">Cree [**estructuras FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) [**y STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) para cada formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-221">Create [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures for each format.</span></span>
4.  <span data-ttu-id="0dd1c-222">Cree una instancia de un objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-222">Instantiate a data object.</span></span>
5.  <span data-ttu-id="0dd1c-223">Cargue los datos en el objeto de datos llamando al método [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para cada formato admitido y pasando las estructuras [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) y [**STGMEDIUM del**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-223">Load the data into the data object by calling the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method for each supported format and passing in the format's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>
6.  <span data-ttu-id="0dd1c-224">Con las transferencias de datos del Portapapeles, llame a [**OleSetClipboard para**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) colocar un puntero a la interfaz [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) del objeto de datos en el Portapapeles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-224">With clipboard data transfers, call [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) to place a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span> <span data-ttu-id="0dd1c-225">Para las transferencias de arrastrar y colocar, inicie un *bucle de arrastre* mediante una llamada a [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-225">For drag-and-drop transfers, initiate a *drag loop* by calling [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span> <span data-ttu-id="0dd1c-226">El **puntero IDataObject** se pasará al destino de colocación cuando se coloquen los datos, finalizando el bucle de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-226">The **IDataObject** pointer will be passed to the drop target when the data is dropped, ending the drag loop.</span></span>

<span data-ttu-id="0dd1c-227">El objeto de datos ya está listo para transferirse al destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-227">The data object is now ready to be transferred to the target.</span></span> <span data-ttu-id="0dd1c-228">Para las transferencias de datos del Portapapeles, el objeto simplemente se mantiene hasta que el destino lo solicita mediante una [**llamada a OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-228">For clipboard data transfers, the object is simply held until the target requests it by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="0dd1c-229">Para las transferencias de datos de arrastrar y colocar, el objeto de datos es responsable de crear un icono para representar los datos y moverlos a medida que el usuario mueve el cursor.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-229">For drag-and-drop data transfers, the data object is responsible for creating an icon to represent the data and moving it as the user moves the cursor.</span></span> <span data-ttu-id="0dd1c-230">Mientras el objeto está en el bucle de arrastre, el origen recibe información de estado a través de su [**interfaz IDropSource.**](/windows/win32/api/oleidl/nn-oleidl-idropsource)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-230">While the object is in the drag loop, the source receives status information through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="0dd1c-231">Para obtener más información, [vea Implementación de IDropSource.](#implementing-idropsource)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-231">For further discussion, see [Implementing IDropSource](#implementing-idropsource).</span></span>

<span data-ttu-id="0dd1c-232">El origen no recibe ninguna notificación si un destino recupera el objeto de datos del Portapapeles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-232">The source receives no notification if the data object is retrieved from the Clipboard by a target.</span></span> <span data-ttu-id="0dd1c-233">Cuando un objeto se coloca en un destino mediante una operación de arrastrar y colocar, se devolverá la función [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) a la que se llamó para iniciar el bucle de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-233">When an object is dropped on a target by a drag-and-drop operation, the [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) function that was called to initiate the drag loop will return.</span></span>

### <a name="how-to-add-a-global-memory-object-to-a-data-object"></a><span data-ttu-id="0dd1c-234">Cómo agregar un objeto de memoria global a un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-234">How to Add a Global Memory Object to a Data Object</span></span>

<span data-ttu-id="0dd1c-235">Muchos de los formatos de datos de Shell tienen el formato de un objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-235">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="0dd1c-236">Use el procedimiento siguiente para crear un formato que contenga un objeto de memoria global y cargarlo en el objeto de datos:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-236">Use the following procedure to create a format containing a global memory object and load it into the data object:</span></span>

1.  <span data-ttu-id="0dd1c-237">Cree una [**estructura FORMATETC.**](/windows/win32/api/objidl/ns-objidl-formatetc)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-237">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="0dd1c-238">Establezca el **miembro cfFormat** en el valor de formato del Portapapeles adecuado y el miembro **tymed** en TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-238">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="0dd1c-239">Cree una [**estructura STGMEDIUM.**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-239">Create an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0dd1c-240">Establezca el **miembro tymed** en TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-240">Set the **tymed** member to TYMED\_HGLOBAL.</span></span>
3.  <span data-ttu-id="0dd1c-241">Cree un objeto de memoria global mediante una llamada a [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) para asignar un bloque de memoria de tamaño adecuado.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-241">Create a global memory object by calling [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) to allocate a suitably sized block of memory.</span></span>
4.  <span data-ttu-id="0dd1c-242">Asigne el bloque de datos que se va a transferir a la dirección devuelta [**por GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-242">Assign the block of data to be transferred to the address returned by [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span></span>
5.  <span data-ttu-id="0dd1c-243">Asigne la dirección del objeto de memoria global al **miembro hGlobal** de la [**estructura STGMEDIUM.**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-243">Assign the global memory object's address to the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
6.  <span data-ttu-id="0dd1c-244">Cargue el formato en el objeto de datos llamando a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) y pasando las estructuras [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) y [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) creadas en los pasos anteriores.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-244">Load the format into the data object by calling [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) and passing in the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures created in the previous steps.</span></span>

<span data-ttu-id="0dd1c-245">La siguiente función de ejemplo crea un objeto de memoria global que contiene un **valor DWORD** y lo carga en un objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-245">The following sample function creates a global memory object containing a **DWORD** value and loads it into a data object.</span></span> <span data-ttu-id="0dd1c-246">El **parámetro pdtobj** es un puntero a la interfaz [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) del objeto de datos, **cf** es el valor de formato del Portapapeles y **dw** es el valor de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-246">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format value, and **dw** is the data value.</span></span>


```C++
STDAPI DataObj_SetDWORD(IDataObject *pdtobj, UINT cf, DWORD dw)
{
    FORMATETC fmte = {(CLIPFORMAT) cf, 
                      NULL, 
                      DVASPECT_CONTENT, 
                      -1, 
                      TYMED_HGLOBAL};
    STGMEDIUM medium;

    HRESULT hres = E_OUTOFMEMORY;
    DWORD *pdw = (DWORD *)GlobalAlloc(GPTR, sizeof(DWORD));
    
    if (pdw)
    {
        *pdw = dw;       
        medium.tymed = TYMED_HGLOBAL;
        medium.hGlobal = pdw;
        medium.pUnkForRelease = NULL;

        hres = pdtobj->SetData(&fmte, &medium, TRUE);
 
        if (FAILED(hres))
            GlobalFree((HGLOBAL)pdw);
    }
    return hres;
}
```



### <a name="implementing-idataobject"></a><span data-ttu-id="0dd1c-247">Implementación de IDataObject</span><span class="sxs-lookup"><span data-stu-id="0dd1c-247">Implementing IDataObject</span></span>

<span data-ttu-id="0dd1c-248">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) es la interfaz principal de un objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-248">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) is a data object's primary interface.</span></span> <span data-ttu-id="0dd1c-249">Todos los objetos de datos deben implementarlo.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-249">It must be implemented by all data objects.</span></span> <span data-ttu-id="0dd1c-250">Tanto el origen como el destino lo usan para diversos propósitos, entre los que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-250">It is used by both source and target for a variety of purposes, including:</span></span>

-   <span data-ttu-id="0dd1c-251">Carga de datos en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-251">Loading data into the data object.</span></span>
-   <span data-ttu-id="0dd1c-252">Extraer datos del objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-252">Extracting data from the data object.</span></span>
-   <span data-ttu-id="0dd1c-253">Determinar qué tipos de datos están en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-253">Determining what types of data are in the data object.</span></span>
-   <span data-ttu-id="0dd1c-254">Proporcionar comentarios al objeto de datos sobre el resultado de la transferencia de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-254">Providing feedback to the data object on outcome of the data transfer.</span></span>

<span data-ttu-id="0dd1c-255">[**IDataObject admite**](/windows/win32/api/objidl/nn-objidl-idataobject) varios métodos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-255">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) supports a number of methods.</span></span> <span data-ttu-id="0dd1c-256">En esta sección se describe cómo implementar los tres métodos más importantes para los objetos de datos de Shell, [SetData,](#setdata-method) [EnumFormatEtc](#enumformatetc-method)y [GetData.](#getdata-method)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-256">This section discusses how to implement the three most important methods for Shell data objects, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method), and [GetData](#getdata-method).</span></span> <span data-ttu-id="0dd1c-257">Para obtener una explicación de los otros métodos, vea la **referencia de IDataObject.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-257">For a discussion of the other methods, see the **IDataObject** reference.</span></span>

### <a name="setdata-method"></a><span data-ttu-id="0dd1c-258">SetData (método)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-258">SetData method</span></span>

<span data-ttu-id="0dd1c-259">La función principal del [**método IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) es permitir que el origen cargue datos en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-259">The primary function of the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method is to allow the source to load data into the data object.</span></span> <span data-ttu-id="0dd1c-260">Para cada formato que se va a incluir, el origen crea una estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para identificar el formato y una estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) para contener un puntero a los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-260">For each format to be included, the source creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to identify the format and an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure to hold a pointer to the data.</span></span> <span data-ttu-id="0dd1c-261">A continuación, el origen llama al método **IDataObject::SetData** del objeto y pasa las estructuras **FORMATETC** y **STGMEDIUM del** formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-261">The source then calls the object's **IDataObject::SetData** method and passes in the format's **FORMATETC** and **STGMEDIUM** structures.</span></span> <span data-ttu-id="0dd1c-262">El método debe almacenar esta información para que esté disponible cuando el destino llame a [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para extraer datos del objeto .</span><span class="sxs-lookup"><span data-stu-id="0dd1c-262">The method must store this information so that it is available when the target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract data from the object.</span></span>

<span data-ttu-id="0dd1c-263">Sin embargo, al transferir archivos, el Shell suele poner la información de cada archivo que se va a transferir a un formato [ \_ FILECONTENTS de CFSTR](clipboard.md) independiente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-263">However, when transferring files, the Shell often puts the information for each file to be transferred into a separate [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="0dd1c-264">Para distinguir los distintos archivos, el **miembro lIndex** de la estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) de cada archivo se establece en un valor de índice que identifica el archivo determinado.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-264">To distinguish the different files, the **lIndex** member of each file's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is set to an index value that identifies the particular file.</span></span> <span data-ttu-id="0dd1c-265">La [**implementación de IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) debe ser capaz de almacenar varios formatos FILECONTENTS de CFSTR que solo difieren \_ en sus miembros **lIndex.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-265">Your [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) implementation must be capable of storing multiple CFSTR\_FILECONTENTS formats that differ only by their **lIndex** members.</span></span>

<span data-ttu-id="0dd1c-266">Mientras el cursor está sobre la ventana de destino, el destino puede usar el objeto auxiliar de arrastrar y colocar [para](#using-the-drag-and-drop-helper-object) especificar la imagen de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-266">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="0dd1c-267">El objeto auxiliar de arrastrar y colocar llama a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para cargar formatos privados en el objeto de datos que se usan para la compatibilidad entre procesos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-267">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="0dd1c-268">Para admitir el objeto auxiliar de arrastrar y colocar, la implementación de **IDataObject::SetData** debe ser capaz de aceptar y almacenar formatos privados arbitrarios.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-268">To support the drag-and-drop helper object, your **IDataObject::SetData** implementation must be able to accept and store arbitrary private formats.</span></span>

<span data-ttu-id="0dd1c-269">Después de quitar los datos, algunos tipos de transferencia de datos de Shell requieren que el destino llame a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para proporcionar al objeto de datos información sobre el resultado de la operación de colocación.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-269">After the data has been dropped, some types of Shell data transfer require the target to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to provide the data object with information about the outcome of the drop operation.</span></span> <span data-ttu-id="0dd1c-270">Por ejemplo, al mover archivos con una operación de movimiento optimizada, el destino normalmente elimina los archivos originales, pero no es necesario hacerlo.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-270">For example, when moving files with an optimized move operation, the target normally deletes the original files, but it is not required to do so.</span></span> <span data-ttu-id="0dd1c-271">El destino informa al objeto de datos si eliminó los archivos mediante una llamada a **IDataObject::SetData** con un formato [ \_ CFSTR LOGICALPERFORMEDDROPEFFECT.](clipboard.md)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-271">The target informs the data object whether it deleted the files by calling **IDataObject::SetData** with a [CFSTR\_LOGICALPERFORMEDDROPEFFECT](clipboard.md) format.</span></span> <span data-ttu-id="0dd1c-272">Hay otros formatos del [Portapapeles de Shell](clipboard.md) que también usa el destino para pasar información al objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-272">There are several other [Shell Clipboard Formats](clipboard.md) that are also used by the target to pass information to the data object.</span></span> <span data-ttu-id="0dd1c-273">La **implementación de IDataObject::SetData** debe ser capaz de reconocer estos formatos y responder correctamente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-273">Your **IDataObject::SetData** implementation must be able to recognize these formats and respond appropriately.</span></span> <span data-ttu-id="0dd1c-274">Para obtener más información, vea [Handling Shell Data Transfer Scenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-274">For further discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

### <a name="enumformatetc-method"></a><span data-ttu-id="0dd1c-275">Método EnumFormatEtc</span><span class="sxs-lookup"><span data-stu-id="0dd1c-275">EnumFormatEtc method</span></span>

<span data-ttu-id="0dd1c-276">Cuando el destino recibe un objeto de datos, normalmente llama a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para determinar qué formatos contiene el objeto.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-276">When the target receives a data object, it commonly calls [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) to determine what formats the object contains.</span></span> <span data-ttu-id="0dd1c-277">El método crea un objeto de enumeración OLE y devuelve un puntero a la interfaz [**IEnumFORMATETC del**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) objeto.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-277">The method creates an OLE enumeration object and returns a pointer to the object's [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="0dd1c-278">A continuación, el destino usa la interfaz para enumerar los formatos disponibles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-278">The target then uses the interface to enumerate the available formats.</span></span>

<span data-ttu-id="0dd1c-279">Un objeto de enumeración siempre debe enumerar los formatos disponibles en orden de calidad, empezando por el mejor.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-279">An enumeration object should always enumerate the available formats in order of quality, starting with the best.</span></span> <span data-ttu-id="0dd1c-280">El origen de colocación define la calidad relativa de los formatos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-280">The relative quality of formats is defined by the drop source.</span></span> <span data-ttu-id="0dd1c-281">En general, los formatos de mayor calidad contienen los datos más completos y enriquecidos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-281">In general, the highest-quality formats contain the richest and most complete data.</span></span> <span data-ttu-id="0dd1c-282">Por ejemplo, una imagen de color de 24 bits normalmente se consideraría de mayor calidad que una versión de escala de grises de esa imagen.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-282">For instance, a 24-bit color image would normally be considered higher quality than a gray-scale version of that image.</span></span> <span data-ttu-id="0dd1c-283">La razón para enumerar los formatos por orden de calidad es que los destinos suelen enumerarse hasta llegar a un formato que admiten y, a continuación, usan ese formato para extraer los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-283">The reason for enumerating formats in order of their quality is that targets typically enumerate until they get to a format that they support, and then they use that format to extract the data.</span></span> <span data-ttu-id="0dd1c-284">Para que este procedimiento produzca el mejor formato disponible que el destino pueda admitir, los formatos deben enumerarse en orden de calidad.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-284">For this procedure to produce the best available format that the target can support, the formats must be enumerated in order of their quality.</span></span>

<span data-ttu-id="0dd1c-285">Un objeto de enumeración para los datos de Shell se implementa de la misma manera que para otros tipos de transferencia de datos, con una excepción importante.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-285">An enumeration object for Shell data is implemented in much the same way as for other types of data transfer, with one notable exception.</span></span> <span data-ttu-id="0dd1c-286">Dado que los objetos de datos normalmente contienen solo un elemento de datos por formato, normalmente enumeran todos los formatos que se pasan a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-286">Because data objects typically contain only one data item per format, they normally enumerate every format that is passed to [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="0dd1c-287">Sin embargo, como se describe en la [sección Método SetData,](#setdata-method) los objetos de datos de Shell pueden contener varios [ \_ formatos FILECONTENTS de CFSTR.](clipboard.md)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-287">However, as discussed in the [SetData method](#setdata-method) section, Shell data objects can contain multiple [CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span>

<span data-ttu-id="0dd1c-288">Dado que el propósito de [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) es permitir que el destino determine qué tipos de datos hay, no es necesario enumerar más de un formato [ \_ FILECONTENTS de CFSTR.](clipboard.md)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-288">Because the purpose of [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) is to allow the target to determine what types of data are present, there is no need to enumerate more than one [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="0dd1c-289">Si el destino necesita saber cuántos de estos formatos contiene el objeto de datos, el destino puede recuperar esa información del formato FILEDESCRIPTOR de CFSTR \_ que lo acompaña.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-289">If the target needs to know how many of these formats the data object contains, the target can retrieve that information from the accompanying CFSTR\_FILEDESCRIPTOR format.</span></span> <span data-ttu-id="0dd1c-290">Para obtener más información sobre cómo implementar **IDataObject::EnumFormatEtc,** vea la documentación de referencia del método.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-290">For further discussion of how to implement **IDataObject::EnumFormatEtc**, see the method's reference documentation.</span></span>

### <a name="getdata-method"></a><span data-ttu-id="0dd1c-291">Método GetData</span><span class="sxs-lookup"><span data-stu-id="0dd1c-291">GetData method</span></span>

<span data-ttu-id="0dd1c-292">El destino llama [**a IDataObject::GetData para**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) extraer un formato de datos determinado.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-292">The target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract a particular data format.</span></span> <span data-ttu-id="0dd1c-293">El destino especifica el formato pasando la estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) adecuada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-293">The target specifies the format by passing in the appropriate [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="0dd1c-294">**IDataObject::GetData** devuelve la estructura [**STGMEDIUM del**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) formato.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-294">**IDataObject::GetData** returns the format's [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>

<span data-ttu-id="0dd1c-295">El destino puede establecer el miembro **tymed** de la estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) en un valor XXX de TYMED específico para especificar qué mecanismo de transferencia de datos usará para extraer \_  los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-295">The target can set the **tymed** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to a specific TYMED\_*XXX* value to specify which data transfer mechanism it will use to extract the data.</span></span> <span data-ttu-id="0dd1c-296">Sin embargo, el destino también puede realizar una solicitud más genérica y dejar que el objeto de datos decida.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-296">However, the target can also make a more generic request and let the data object decide.</span></span> <span data-ttu-id="0dd1c-297">Para pedir al objeto de datos que seleccione el mecanismo de transferencia de datos, el destino establece todos los valores XXX de TYMED \_  que admite.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-297">To ask the data object to select the data transfer mechanism, the target sets all the TYMED\_*XXX* values that it supports.</span></span> <span data-ttu-id="0dd1c-298">[**IDataObject::GetData selecciona**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) uno de estos mecanismos de transferencia de datos y devuelve la estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) adecuada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-298">[**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) selects one of these data transfer mechanisms and returns the appropriate [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0dd1c-299">Por ejemplo, **tymed** se establece normalmente en \_ \| TYMED TYMED \_ TYMED \| ISTREAM \_ IYMED ISTORAGE para solicitar cualquiera de los tres mecanismos de transferencia de datos de Shell.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-299">For instance, **tymed** is commonly set to TYMED\_HGLOBAL \| TYMED\_ISTREAM \| TYMED\_ISTORAGE to request any of the three Shell data transfer mechanisms.</span></span>

> [!Note]  
> <span data-ttu-id="0dd1c-300">Dado que puede haber varios [ \_ formatos FILECONTENTS de CFSTR,](clipboard.md) los miembros **cfFormat** y **tymed** de la estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) no son suficientes para indicar qué estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) debe devolver.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-300">Because there can be multiple [CFSTR\_FILECONTENTS](clipboard.md) formats, the **cfFormat** and **tymed** members of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure are not sufficient to indicate which [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should return.</span></span> <span data-ttu-id="0dd1c-301">Para el formato \_ FILECONTENTS de CFSTR, **IDataObject::GetData** también debe examinar el miembro **lIndex** de la estructura **FORMATETC** para devolver la estructura **STGMEDIUM** correcta.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-301">For the CFSTR\_FILECONTENTS format, **IDataObject::GetData** must also examine the **FORMATETC** structure's **lIndex** member in order to return the correct **STGMEDIUM** structure.</span></span>

 

<span data-ttu-id="0dd1c-302">El [formato CFSTR \_ INDRAGLOOP](clipboard.md) se coloca en objetos de datos para permitir que los destinos comprueben el estado del bucle de arrastrar y colocar, al tiempo que se evita la representación intensiva de memoria de los datos del objeto.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-302">The [CFSTR\_INDRAGLOOP](clipboard.md) format is placed in data objects to allow targets to check the status of the drag-and-drop loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="0dd1c-303">Los datos del formato son un **valor DWORD** que se establece en un valor distinto de cero si el objeto de datos está dentro de un bucle de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-303">The format's data is a **DWORD** value that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="0dd1c-304">El valor de datos del formato se establece en cero si se han eliminado los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-304">The format's data value is set to zero if the data has been dropped.</span></span> <span data-ttu-id="0dd1c-305">Si un destino solicita este formato y el origen no lo ha cargado, [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) debe responder como si el origen hubiera cargado el formato con un valor de cero.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-305">If a target requests this format and it has not been loaded by the source, [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should respond as if the source had loaded the format with a value of zero.</span></span>

<span data-ttu-id="0dd1c-306">Mientras el cursor está sobre la ventana de destino, el destino puede usar el objeto auxiliar de arrastrar y colocar [para](#using-the-drag-and-drop-helper-object) especificar la imagen de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-306">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="0dd1c-307">El objeto auxiliar de arrastrar y colocar llama a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para cargar formatos privados en el objeto de datos que se usan para la compatibilidad entre procesos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-307">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="0dd1c-308">Más adelante llama [**a IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para recuperarlos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-308">It later calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to retrieve them.</span></span> <span data-ttu-id="0dd1c-309">Para admitir el objeto auxiliar de arrastrar y colocar, la implementación del objeto de datos de shell debe ser capaz de devolver formatos privados arbitrarios cuando se soliciten.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-309">To support the drag-and-drop helper object, your Shell Data Object implementation must be able to return arbitrary private formats when they are requested.</span></span>

### <a name="implementing-idropsource"></a><span data-ttu-id="0dd1c-310">Implementación de IDropSource</span><span class="sxs-lookup"><span data-stu-id="0dd1c-310">Implementing IDropSource</span></span>

<span data-ttu-id="0dd1c-311">El origen debe crear un objeto que exponga una [**interfaz IDropSource.**](/windows/win32/api/oleidl/nn-oleidl-idropsource)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-311">The source must create an object that exposes an [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="0dd1c-312">Esta interfaz permite al  origen actualizar la imagen de arrastre que indica la posición actual del cursor y proporcionar comentarios al sistema sobre cómo finalizar una operación de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-312">This interface allows the source to update the *drag image* that indicates the current position of the cursor and to provide feedback to the system on how to terminate a drag-and-drop operation.</span></span> <span data-ttu-id="0dd1c-313">**IDropSource** tiene dos métodos: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) y [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-313">**IDropSource** has two methods: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) and [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span></span>

### <a name="givefeedback-method"></a><span data-ttu-id="0dd1c-314">GiveFeedback (método)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-314">GiveFeedback method</span></span>

<span data-ttu-id="0dd1c-315">Mientras se encuentra en el bucle de arrastre, un origen de colocación es responsable de realizar un seguimiento de la posición del cursor y mostrar una imagen de arrastre adecuada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-315">While in the drag loop, a drop source is responsible for keeping track of the cursor position and displaying an appropriate drag image.</span></span> <span data-ttu-id="0dd1c-316">Sin embargo, en algunos casos es posible que quiera cambiar la apariencia de la imagen de arrastre cuando se encuentra sobre la ventana del destino de colocación.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-316">However, in some cases you might want to change the appearance of the drag image when it is over the drop target's window.</span></span>

<span data-ttu-id="0dd1c-317">Cuando el cursor entra o sale de la ventana de destino y mientras se mueve sobre la ventana de destino, el sistema llama periódicamente a la interfaz [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) del destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-317">When the cursor enters or leaves the target window and while it is moving over the target window, the system periodically calls the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="0dd1c-318">El destino responde con un [**valor DROPEFFECT**](../com/dropeffect-constants.md) que se reenvía al origen mediante el [**método GiveFeedback.**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-318">The target responds with a [**DROPEFFECT**](../com/dropeffect-constants.md) value that is forwarded to the source through the [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) method.</span></span> <span data-ttu-id="0dd1c-319">Si procede, el origen puede modificar la apariencia del cursor en función del **valor DROPEFFECT.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-319">If appropriate, the source can modify the appearance of the cursor based on the **DROPEFFECT** value.</span></span> <span data-ttu-id="0dd1c-320">Para más información, consulte las **referencias GiveFeedback** y [**DoDragDrop.**](/windows/win32/api/ole2/nf-ole2-dodragdrop)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-320">For further details, see the **GiveFeedback** and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

### <a name="querycontinuedrag-method"></a><span data-ttu-id="0dd1c-321">QueryContinueDrag (método)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-321">QueryContinueDrag method</span></span>

<span data-ttu-id="0dd1c-322">Se llama a este método si el estado del teclado o el botón del mouse cambia mientras el objeto de datos está en el bucle de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-322">This method is called if the mouse button or keyboard state changes while the data object is in the drag loop.</span></span> <span data-ttu-id="0dd1c-323">Notifica al origen si se ha presionado la tecla ESC y proporciona el estado actual de las teclas modificadoras de teclado, como CTRL o MAYÚS.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-323">It notifies the source whether the ESC key has been pressed and provides the current state of the keyboard modifier keys, such as CTRL or SHIFT.</span></span> <span data-ttu-id="0dd1c-324">El [**valor devuelto del método QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) especifica una de estas tres acciones:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-324">The [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) method's return value specifies one of three actions:</span></span>

-   <span data-ttu-id="0dd1c-325">Está \_ bien.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-325">S\_OK.</span></span> <span data-ttu-id="0dd1c-326">Continuar con la operación de arrastre</span><span class="sxs-lookup"><span data-stu-id="0dd1c-326">Continue the drag operation</span></span>
-   <span data-ttu-id="0dd1c-327">ARRASTRE DROP \_ S \_ DROP.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-327">DRAGDROP\_S\_DROP.</span></span> <span data-ttu-id="0dd1c-328">Quitar los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-328">Drop the data.</span></span> <span data-ttu-id="0dd1c-329">A continuación, el sistema llama al [**método IDropTarget::D rop del**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-329">The system then calls the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method.</span></span>
-   <span data-ttu-id="0dd1c-330">DRAGDROP \_ S \_ CANCEL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-330">DRAGDROP\_S\_CANCEL.</span></span> <span data-ttu-id="0dd1c-331">Finalice el bucle de arrastre sin quitar los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-331">Terminate the drag loop without dropping the data.</span></span> <span data-ttu-id="0dd1c-332">Este valor se devuelve normalmente si se presionó la tecla ESCAPE.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-332">This value is normally returned if the ESCAPE key was pressed.</span></span>

<span data-ttu-id="0dd1c-333">Para más información, consulte las [**referencias QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) y [**DoDragDrop.**](/windows/win32/api/ole2/nf-ole2-dodragdrop)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-333">For further discussion, see the [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

## <a name="how-a-target-handles-a-data-object"></a><span data-ttu-id="0dd1c-334">Cómo controla un destino un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-334">How a Target Handles a Data Object</span></span>

<span data-ttu-id="0dd1c-335">El destino recibe un objeto de datos cuando recupera el objeto de datos del Portapapeles o el usuario lo deja en la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-335">The target receives a data object when it either retrieves the data object from the Clipboard or has it dropped on the target window by the user.</span></span> <span data-ttu-id="0dd1c-336">A continuación, el destino puede extraer datos del objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-336">The target can then extract data from the data object.</span></span> <span data-ttu-id="0dd1c-337">Si es necesario, el destino también puede notificar al objeto de datos el resultado de la operación.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-337">If necessary, the target can also notify the data object of the outcome of the operation.</span></span> <span data-ttu-id="0dd1c-338">Antes de una transferencia de datos de Shell, un destino de colocación debe prepararse para la operación:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-338">Prior to a Shell data transfer, a drop target must prepare itself for the operation:</span></span>

1.  <span data-ttu-id="0dd1c-339">El destino debe llamar a [RegisterClipboardFormat para](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) obtener un valor de formato de Portapapeles válido para todos los formatos de Shell, distintos de [CF \_ HDROP,](clipboard.md)que podrían incluirse en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-339">The target must call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for all Shell formats, other than [CF\_HDROP](clipboard.md), that might be included in the data object.</span></span> <span data-ttu-id="0dd1c-340">CF \_ HDROP ya es un formato válido del Portapapeles y no es necesario registrarlo.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-340">CF\_HDROP is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="0dd1c-341">Para admitir una operación de arrastrar y colocar, el destino debe implementar una [**interfaz IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) y registrar una ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-341">To support a drag-and-drop operation, the target must implement an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface and register a target window.</span></span> <span data-ttu-id="0dd1c-342">Para registrar una ventana de destino, el destino llama [**a RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) y pasa el identificador de la ventana y el puntero de interfaz **IDropTarget.**</span><span class="sxs-lookup"><span data-stu-id="0dd1c-342">To register a target window, the target calls [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) and passes in the window's handle and the **IDropTarget** interface pointer.</span></span>

<span data-ttu-id="0dd1c-343">Para las transferencias del Portapapeles, el destino no recibe ninguna notificación de que se ha colocado un objeto de datos en el Portapapeles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-343">For clipboard transfers, the target does not receive any notification that a data object has been placed on the Clipboard.</span></span> <span data-ttu-id="0dd1c-344">Normalmente, una acción del usuario notifica a una aplicación que un objeto está en el Portapapeles, como hacer clic en el botón Pegar de la barra de herramientas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-344">Typically, an application is notified that an object is on the Clipboard by a user action, such as clicking the Paste button on the application's toolbar.</span></span> <span data-ttu-id="0dd1c-345">A continuación, el destino recupera el puntero [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) del objeto de datos del Portapapeles mediante una llamada [**a OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-345">The target then retrieves the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer from the Clipboard by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="0dd1c-346">Para las transferencias de datos de arrastrar y colocar, el sistema usa la interfaz [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) del destino para proporcionar al destino información sobre el progreso de la transferencia de datos:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-346">For drag-and-drop data transfers, the system uses the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to provide the target with information about the progress of the data transfer:</span></span>

-   <span data-ttu-id="0dd1c-347">El sistema llama [**a IDropTarget::D ragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) cuando el cursor entra en la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-347">The system calls [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) when the cursor enters the target window.</span></span>
-   <span data-ttu-id="0dd1c-348">El sistema llama periódicamente a [**IDropTarget::D ragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) a medida que el cursor pasa por la ventana de destino para proporcionar al destino la posición actual del cursor.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-348">The system periodically calls [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) as the cursor passes over the target window, to give the target the current cursor position.</span></span>
-   <span data-ttu-id="0dd1c-349">El sistema llama [**a IDropTarget::D ragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) cuando el cursor sale de la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-349">The system calls [**IDropTarget::DragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) when the cursor leaves the target window.</span></span>
-   <span data-ttu-id="0dd1c-350">El sistema llama [**a IDropTarget::D rop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) cuando el usuario quita el objeto de datos en la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-350">The system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) when the user drops the data object on the target window.</span></span>

<span data-ttu-id="0dd1c-351">Para obtener una explicación sobre cómo implementar estos métodos, vea [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-351">For a discussion of how to implement these methods, see [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span></span>

<span data-ttu-id="0dd1c-352">Cuando se descartan los datos, [**IDropTarget::D rop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) proporciona al destino un puntero a la interfaz [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) del objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-352">When the data is dropped, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) provides the target with a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="0dd1c-353">A continuación, el destino usa esta interfaz para extraer datos del objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-353">The target then uses this interface to extract data from the data object.</span></span>

### <a name="extracting-shell-data-from-a-data-object"></a><span data-ttu-id="0dd1c-354">Extracción de datos de shell de un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-354">Extracting Shell Data from a Data Object</span></span>

<span data-ttu-id="0dd1c-355">Una vez que un objeto de datos se ha eliminado o recuperado del Portapapeles, el destino puede extraer los datos que necesita.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-355">Once a data object has been dropped or retrieved from the Clipboard, the target can extract the data it needs.</span></span> <span data-ttu-id="0dd1c-356">El primer paso del proceso de extracción suele ser enumerar los formatos contenidos en el objeto de datos:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-356">The first step in the extraction process is typically to enumerate the formats contained by the data object:</span></span>

-   <span data-ttu-id="0dd1c-357">Llame [**a IDataObject::EnumFormatEtc.**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-357">Call [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span></span> <span data-ttu-id="0dd1c-358">El objeto de datos crea un objeto de enumeración OLE estándar y devuelve un puntero a su [**interfaz IEnumFORMATETC.**](/windows/win32/api/objidl/nn-objidl-ienumformatetc)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-358">The data object creates a standard OLE enumeration object and returns a pointer to its [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span>
-   <span data-ttu-id="0dd1c-359">Use los [**métodos IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) para enumerar los formatos contenidos en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-359">Use the [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) methods to enumerate the formats contained by the data object.</span></span> <span data-ttu-id="0dd1c-360">Esta operación normalmente recupera una [**estructura FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para cada formato que contiene el objeto .</span><span class="sxs-lookup"><span data-stu-id="0dd1c-360">This operation usually retrieves one [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure for each format that the object contains.</span></span> <span data-ttu-id="0dd1c-361">Sin embargo, el objeto de enumeración normalmente devuelve solo una única estructura **FORMATETC** para el formato [ \_ FILECONTENTS de CFSTR,](clipboard.md) independientemente de cuántos formatos de este tipo contenga el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-361">However, the enumeration object normally returns only a single **FORMATETC** structure for the [CFSTR\_FILECONTENTS](clipboard.md) format, regardless of how many such formats are contained by the data object.</span></span>
-   <span data-ttu-id="0dd1c-362">Seleccione uno o varios formatos que se extraerán y almacene sus [**estructuras FORMATETC.**](/windows/win32/api/objidl/ns-objidl-formatetc)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-362">Select one or more formats to be extracted, and store their [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures.</span></span>

<span data-ttu-id="0dd1c-363">Para recuperar un formato determinado, pase la estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) asociada a [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-363">To retrieve a particular format, pass the associated [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span></span> <span data-ttu-id="0dd1c-364">Este método devuelve una [**estructura STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) que proporciona acceso a los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-364">This method returns an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that provides access to the data.</span></span> <span data-ttu-id="0dd1c-365">Para especificar un mecanismo de transferencia de datos determinado, establezca el valor **tymed** de la **estructura FORMATETC** en el valor XXX de TYMED \_  correspondiente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-365">To specify a particular data transfer mechanism, set the **tymed** value of the **FORMATETC** structure to the corresponding TYMED\_*XXX* value.</span></span> <span data-ttu-id="0dd1c-366">Para pedir al objeto de datos que seleccione un mecanismo de transferencia de datos, el destino establece los valores XXX de TYMED para cada mecanismo de transferencia de datos que el \_  destino puede controlar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-366">To ask the data object to select a data transfer mechanism, the target sets the TYMED\_*XXX* values for every data transfer mechanism that the target can handle.</span></span> <span data-ttu-id="0dd1c-367">El objeto de datos selecciona uno de estos mecanismos de transferencia de datos y devuelve la estructura **STGMEDIUM** adecuada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-367">The data object selects one of these data transfer mechanisms and returns the appropriate **STGMEDIUM** structure.</span></span>

<span data-ttu-id="0dd1c-368">Para la mayoría de los formatos, el destino puede recuperar los datos pasando la estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) que recibió al enumerar los formatos disponibles.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-368">For most formats, the target can retrieve the data by passing the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure that it received when it enumerated the available formats.</span></span> <span data-ttu-id="0dd1c-369">Una excepción a esta regla es [CFSTR \_ FILECONTENTS.](clipboard.md)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-369">One exception to this rule is [CFSTR\_FILECONTENTS](clipboard.md).</span></span> <span data-ttu-id="0dd1c-370">Dado que un objeto de datos puede contener varias instancias de este formato, es posible que la estructura **FORMATETC** devuelta por el enumerador no se corresponda con el formato concreto que desea extraer.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-370">Because a data object can contain multiple instances of this format, the **FORMATETC** structure returned by the enumerator might not correspond to the particular format you want to extract.</span></span> <span data-ttu-id="0dd1c-371">Además de especificar los miembros **cfFormat** y **tymed,** también debe establecer el miembro **lIndex** en el valor de índice del archivo.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-371">In addition to specifying the **cfFormat** and **tymed** members, you must also set the **lIndex** member to the file's index value.</span></span> <span data-ttu-id="0dd1c-372">Para obtener más información, consulte la sección Using the CFSTR FILECONTENTS Format to Extract Data from a File (Uso del formato *\_ CFSTR FILECONTENTS* para extraer datos de un archivo) [de Handling Shell Data Transfer Scenarios](datascenarios.md)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-372">For further discussion, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md)</span></span>

<span data-ttu-id="0dd1c-373">El proceso de extracción de datos depende del tipo de puntero incluido en la [**estructura STGMEDIUM devuelta.**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-373">The data extraction process depends on the type of pointer contained by the returned [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="0dd1c-374">Si la estructura contiene un puntero a una [**interfaz IStream**](/windows/win32/api/objidl/nn-objidl-istream) o [**IStorage,**](/windows/win32/api/objidl/nn-objidl-istorage) use los métodos de interfaz para extraer los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-374">If the structure contains a pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface, use the interface methods to extract the data.</span></span> <span data-ttu-id="0dd1c-375">El proceso de extracción de datos de un objeto de memoria global se describe en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-375">The process of extracting data from a global memory object is discussed in the next section.</span></span>

### <a name="extracting-a-global-memory-object-from-a-data-object"></a><span data-ttu-id="0dd1c-376">Extracción de un objeto de memoria global de un objeto de datos</span><span class="sxs-lookup"><span data-stu-id="0dd1c-376">Extracting a global memory object from a data object</span></span>

<span data-ttu-id="0dd1c-377">Muchos de los formatos de datos de Shell tienen la forma de un objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-377">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="0dd1c-378">Use el procedimiento siguiente para extraer un formato que contiene un objeto de memoria global de un objeto de datos y asignar sus datos a una variable local:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-378">Use the following procedure to extract a format containing a global memory object from a data object and assign its data to a local variable:</span></span>

1.  <span data-ttu-id="0dd1c-379">Cree una [**estructura FORMATETC.**](/windows/win32/api/objidl/ns-objidl-formatetc)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-379">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="0dd1c-380">Establezca el **miembro cfFormat** en el valor de formato del Portapapeles adecuado y el miembro **tymed** en TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-380">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="0dd1c-381">Cree una estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) vacía.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-381">Create an empty [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
3.  <span data-ttu-id="0dd1c-382">Llame [**a IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata)y pase punteros a las estructuras [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) y [**STGMEDIUM.**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-382">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata), and pass in pointers to the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>

    <span data-ttu-id="0dd1c-383">Cuando [**se devuelve IDataObject::GetData,**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) la estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) contendrá un puntero al objeto de memoria global que contiene los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-383">When [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns, the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure will contain a pointer to the global memory object that contains the data.</span></span>

4.  <span data-ttu-id="0dd1c-384">Asigne los datos a una variable local llamando a [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) y pasando el **miembro hGlobal** de la [**estructura STGMEDIUM.**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-384">Assign the data to a local variable by calling [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) and passing in the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
5.  <span data-ttu-id="0dd1c-385">Llame [**a GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) para liberar el bloqueo en el objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-385">Call [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) to release the lock on the global memory object.</span></span>
6.  <span data-ttu-id="0dd1c-386">Llame [**a ReleaseStgMedium para**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) liberar el objeto de memoria global.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-386">Call [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object.</span></span>

> [!Note]  
> <span data-ttu-id="0dd1c-387">Debe usar [**ReleaseStgMedium para**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) liberar el objeto de memoria global, no [**GlobalFree.**](/windows/win32/api/winbase/nf-winbase-globalfree)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-387">You must use [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object, not [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span></span>

 

<span data-ttu-id="0dd1c-388">En el ejemplo siguiente se muestra cómo extraer un **valor DWORD** almacenado como un objeto de memoria global de un objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-388">The following example shows how to extract a **DWORD** value stored as a global memory object from a data object.</span></span> <span data-ttu-id="0dd1c-389">El **parámetro pdtobj** es un puntero a la interfaz [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) del objeto de datos, **cf** es el formato del Portapapeles que identifica los datos deseados y **pdwOut** se usa para devolver el valor de los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-389">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format that identifies the desired data, and **pdwOut** is used to return the data value.</span></span>


```C++
STDAPI DataObj_GetDWORD(IDataObject *pdtobj, UINT cf, DWORD *pdwOut)
{    STGMEDIUM medium;
   FORMATETC fmte = {(CLIPFORMAT) cf, NULL, DVASPECT_CONTENT, -1, 
       TYMED_HGLOBAL};
    HRESULT hres = pdtobj->GetData(&fmte, &medium);
    if (SUCCEEDED(hres))
   {
       DWORD *pdw = (DWORD *)GlobalLock(medium.hGlobal);
       if (pdw)
       {
           *pdwOut = *pdw;
           GlobalUnlock(medium.hGlobal);
       }
       else
       {
           hres = E_UNEXPECTED;
       }
       ReleaseStgMedium(&medium);
   }
   return hres;
}
```



### <a name="implementing-idroptarget"></a><span data-ttu-id="0dd1c-390">Implementación de IDropTarget</span><span class="sxs-lookup"><span data-stu-id="0dd1c-390">Implementing IDropTarget</span></span>

<span data-ttu-id="0dd1c-391">El sistema usa la [**interfaz IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) para comunicarse con el destino mientras el cursor está sobre la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-391">The system uses the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to communicate with the target while the cursor is over the target window.</span></span> <span data-ttu-id="0dd1c-392">Las respuestas del destino se reenvía al origen a través de su [**interfaz IDropSource.**](/windows/win32/api/oleidl/nn-oleidl-idropsource)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-392">The target's responses are forwarded to the source through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="0dd1c-393">Según la respuesta, el origen puede modificar el icono que representa los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-393">Depending on the response, the source can modify the icon that represents the data.</span></span> <span data-ttu-id="0dd1c-394">Si el destino de colocación necesita especificar el icono de datos, puede hacerlo mediante la creación de un objeto auxiliar de arrastrar [y colocar](#using-the-drag-and-drop-helper-object).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-394">If the drop target needs to specify the data icon, it can do so by creating a [drag-and-drop helper object](#using-the-drag-and-drop-helper-object).</span></span>

<span data-ttu-id="0dd1c-395">Con las operaciones convencionales de arrastrar y colocar, el destino informa al objeto de datos del resultado de la operación estableciendo el parámetro *pdwEffect* de [**IDropTarget::D rop en**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) el valor [**DROPEFFECT**](../com/dropeffect-constants.md) adecuado.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-395">With conventional drag-and-drop operations, the target informs the data object of the outcome of the operation by setting the *pdwEffect* parameter of [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) to the appropriate [**DROPEFFECT**](../com/dropeffect-constants.md) value.</span></span> <span data-ttu-id="0dd1c-396">Con los objetos de datos de Shell, es posible que el destino también tenga que llamar a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-396">With Shell data objects, the target might also need to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="0dd1c-397">Para obtener una explicación de cómo deben responder los destinos para distintos escenarios de transferencia de datos, vea [Handling Shell Data Transfer Scenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-397">For a discussion of how targets should respond for different data transfer scenarios, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="0dd1c-398">En las secciones siguientes se describe brevemente cómo implementar los métodos [**IDropTarget::D ragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::D ragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)e [**IDropTarget::D rop.**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-398">The following sections briefly discuss how to implement the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover), and [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) methods.</span></span> <span data-ttu-id="0dd1c-399">Para más información, consulte la documentación de referencia.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-399">For further details, see the reference documentation.</span></span>

### <a name="dragenter-method"></a><span data-ttu-id="0dd1c-400">DragEnter (método)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-400">DragEnter method</span></span>

<span data-ttu-id="0dd1c-401">El sistema llama al [**método IDropTarget::D ragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) cuando el cursor entra en la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-401">The system calls the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) method when the cursor enters the target window.</span></span> <span data-ttu-id="0dd1c-402">Sus parámetros proporcionan al destino la ubicación del cursor, el estado de las teclas modificadoras de teclado, como la tecla CTRL, y un puntero a la interfaz [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) del objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-402">Its parameters provide the target with the location of the cursor, the state of keyboard modifier keys such as the CTRL key, and a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="0dd1c-403">El destino es responsable de usar esa interfaz para determinar si puede aceptar cualquiera de los formatos contenidos en el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-403">The target is responsible for using that interface to determine whether it can accept any of the formats contained by the data object.</span></span> <span data-ttu-id="0dd1c-404">Si es posible, normalmente deja el valor de *pdwEffect* sin cambios.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-404">If it can, it normally leaves the value of *pdwEffect* unchanged.</span></span> <span data-ttu-id="0dd1c-405">Si no puede aceptar ningún dato del objeto de datos, establece el *parámetro pdwEffect* en DROPEFFECT \_ NONE.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-405">If it cannot accept any data from the data object, it sets the *pdwEffect* parameter to DROPEFFECT\_NONE.</span></span> <span data-ttu-id="0dd1c-406">El sistema pasa el valor de este parámetro a la interfaz [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) del objeto de datos para permitirle mostrar la imagen de arrastre adecuada.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-406">The system passes the value of this parameter to the data object's [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface to allow it to display the appropriate drag image.</span></span>

<span data-ttu-id="0dd1c-407">Los destinos no deben usar [**el método IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) para representar los datos de Shell antes de que se hayan eliminado.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-407">Targets should not use the [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method to render Shell data before it has been dropped.</span></span> <span data-ttu-id="0dd1c-408">La representación completa de los datos del objeto para cada repetición de este tipo podría hacer que el cursor de arrastre se detendría.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-408">Fully rendering the object's data for each such occurrence might cause the drag cursor to stall.</span></span> <span data-ttu-id="0dd1c-409">Para evitar este problema, algunos objetos de Shell contienen un formato [ \_ CFSTR INDRAGLOOP.](clipboard.md)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-409">To avoid this problem, some Shell objects contain a [CFSTR\_INDRAGLOOP](clipboard.md) format.</span></span> <span data-ttu-id="0dd1c-410">Al extraer este formato, los destinos pueden comprobar el estado del bucle de arrastre y evitar la representación intensiva de memoria de los datos del objeto.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-410">By extracting this format, targets can check the status of the drag loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="0dd1c-411">El valor de datos del formato es **un DWORD** que se establece en un valor distinto de cero si el objeto de datos está dentro de un bucle de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-411">The format's data value is a **DWORD** that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="0dd1c-412">El valor de datos del formato se establece en cero si se han eliminado los datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-412">The format's data value is set to zero if the data has been dropped.</span></span>

<span data-ttu-id="0dd1c-413">Si el destino puede aceptar datos del objeto de datos, debe examinar **grfKeyState** para determinar si se ha presionado alguna tecla modificadora para modificar el comportamiento de colocación normal.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-413">If the target can accept data from the data object, it should examine **grfKeyState** to determine whether any modifier keys have been pressed to modify the normal drop behavior.</span></span> <span data-ttu-id="0dd1c-414">Por ejemplo, la operación predeterminada suele ser un movimiento, pero la despresión de la tecla CTRL suele indicar una operación de copia.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-414">For instance, the default operation is typically a move, but depressing the CTRL key usually indicates a copy operation.</span></span>

<span data-ttu-id="0dd1c-415">Mientras el cursor está sobre la ventana [](#using-the-drag-and-drop-helper-object) de destino, el destino puede usar el objeto auxiliar de arrastrar y colocar para reemplazar la imagen de arrastre del objeto de datos por la suya propia.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-415">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to replace the data object's drag image with its own.</span></span> <span data-ttu-id="0dd1c-416">Si es así, [**IDropTarget::D ragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) debe llamar a [**IDropTargetHelper::D ragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) para pasar la información contenida en los parámetros *DragEnter* al objeto auxiliar de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-416">If so, [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) should call [**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) to pass the information contained in the *DragEnter* parameters to the drag-and-drop helper object.</span></span>

### <a name="dragover-method"></a><span data-ttu-id="0dd1c-417">Método DragOver</span><span class="sxs-lookup"><span data-stu-id="0dd1c-417">DragOver method</span></span>

<span data-ttu-id="0dd1c-418">A medida que el cursor se mueve dentro de la ventana de destino, el sistema llama periódicamente al [**método IDropTarget::D ragOver.**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-418">As the cursor moves within the target window, the system periodically calls the [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) method.</span></span> <span data-ttu-id="0dd1c-419">Sus parámetros proporcionan al destino la ubicación del cursor y el estado de las teclas modificadoras de teclado, como la tecla CTRL.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-419">Its parameters provide the target with the location of the cursor and the state of keyboard modifier keys such as the CTRL key.</span></span> <span data-ttu-id="0dd1c-420">**IDropTarget::D ragOver** tiene las mismas responsabilidades que [**IDropTarget::D ragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter)y las implementaciones suelen ser muy similares.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-420">**IDropTarget::DragOver** has much the same responsibilities as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), and the implementations are usually very similar.</span></span>

<span data-ttu-id="0dd1c-421">Si el destino usa el objeto auxiliar de arrastrar y colocar, [**IDropTarget::D ragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) debe llamar a [**IDropTargetHelper::D ragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) para reenviar la información contenida en los parámetros *DragOver* al objeto auxiliar de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-421">If the target is using the drag-and-drop helper object, [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) should call [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) to forward the information contained in the *DragOver* parameters to the drag-and-drop helper object.</span></span>

### <a name="drop-method"></a><span data-ttu-id="0dd1c-422">Método Drop</span><span class="sxs-lookup"><span data-stu-id="0dd1c-422">Drop method</span></span>

<span data-ttu-id="0dd1c-423">El sistema llama al [**método IDropTarget::D rop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) para notificar al destino que el usuario ha eliminado los datos, normalmente al soltar el botón del mouse.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-423">The system calls the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to notify the target that the user has dropped the data, typically by releasing the mouse button.</span></span> <span data-ttu-id="0dd1c-424">**IDropTarget::D rop** tiene los mismos parámetros que [**IDropTarget::D ragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-424">**IDropTarget::Drop** has the same parameters as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span></span> <span data-ttu-id="0dd1c-425">Normalmente, el destino responde mediante la extracción de uno o varios formatos del objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-425">The target normally responds by extracting one or more formats from the data object.</span></span> <span data-ttu-id="0dd1c-426">Cuando termine, el destino debe establecer el *parámetro pdwEffect* en un [**valor DROPEFFECT**](../com/dropeffect-constants.md) que indique el resultado de la operación.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-426">When finished, the target should set the *pdwEffect* parameter to a [**DROPEFFECT**](../com/dropeffect-constants.md) value that indicates the outcome of the operation.</span></span> <span data-ttu-id="0dd1c-427">Para algunos tipos de transferencia de datos de Shell, el destino también debe llamar a [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) para pasar un formato con información adicional sobre el resultado de la operación al objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-427">For some types of Shell data transfer, the target must also call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to pass a format with additional information on the outcome of the operation to the data object.</span></span> <span data-ttu-id="0dd1c-428">Para obtener una explicación detallada, vea [Handling Shell Data Transfer Scenarios](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-428">For a detailed discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="0dd1c-429">Si el destino usa el objeto auxiliar de arrastrar y colocar, [**IDropTarget::D rop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) debe llamar a [**IDropTargetHelper::D rop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) para reenviar la información contenida en los parámetros [**IDropTargetHelper::D ragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) al objeto auxiliar de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-429">If the target is using the drag-and-drop helper object, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) should call [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) to forward the information contained in the [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) parameters to the drag-and-drop helper object.</span></span>

## <a name="using-the-drag-and-drop-helper-object"></a><span data-ttu-id="0dd1c-430">Usar el objeto auxiliar de arrastrar y colocar</span><span class="sxs-lookup"><span data-stu-id="0dd1c-430">Using the Drag-and-Drop Helper Object</span></span>

<span data-ttu-id="0dd1c-431">El shell exporta el objeto auxiliar de arrastrar y colocar (CLSID DragDropHelper) para permitir que los destinos especifiquen la imagen de arrastre mientras está sobre la ventana \_ de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-431">The drag-and-drop helper object (CLSID\_DragDropHelper) is exported by the Shell to allow targets to specify the drag image while it is over the target window.</span></span> <span data-ttu-id="0dd1c-432">Para usar el objeto auxiliar de arrastrar y colocar, cree un objeto de servidor en proceso llamando a [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) con un identificador de clase (CLSID) de CLSID \_ DragDropHelper.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-432">To use the drag-and-drop helper object, create an in-process server object by calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) with a class identifier (CLSID) of CLSID\_DragDropHelper.</span></span> <span data-ttu-id="0dd1c-433">El objeto auxiliar de arrastrar y colocar expone dos interfaces que se usan de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-433">The drag-and-drop helper object exposes two interfaces that are used in the following way:</span></span>

-   <span data-ttu-id="0dd1c-434">La [**interfaz IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) permite que el destino de colocación especifique un icono para representar el objeto de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-434">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface allows the drop target to specify an icon to represent the data object.</span></span>
-   <span data-ttu-id="0dd1c-435">La [**interfaz IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) permite que el destino de colocación informe al objeto auxiliar de arrastrar y colocar de la ubicación del cursor y mostrar u ocultar el icono de datos.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-435">The [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) interface allows the drop target to inform the drag-and-drop helper object of the cursor location, and to show or hide the data icon.</span></span>

### <a name="using-the-idragsourcehelper-interface"></a><span data-ttu-id="0dd1c-436">Uso de la interfaz IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="0dd1c-436">Using the IDragSourceHelper Interface</span></span>

<span data-ttu-id="0dd1c-437">El objeto auxiliar de arrastrar y colocar expone la interfaz [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) para permitir que un destino de colocación proporcione la imagen que se mostrará mientras el cursor está sobre la ventana de destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-437">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface is exposed by the drag-and-drop helper object to allow a drop target to provide the image that will be displayed while the cursor is over the target window.</span></span> <span data-ttu-id="0dd1c-438">**IDragSourceHelper proporciona** dos maneras alternativas de especificar el mapa de bits que se usará como imagen de arrastre:</span><span class="sxs-lookup"><span data-stu-id="0dd1c-438">**IDragSourceHelper** provides two alternative ways to specify the bitmap to be used as a drag image:</span></span>

-   <span data-ttu-id="0dd1c-439">Los destinos de colocación que tienen una ventana pueden registrar un mensaje de ventana DI GETDRAGIMAGE para él inicializando el objeto auxiliar de arrastrar y colocar con \_ [**IDragSourceHelper::InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-439">Drop targets that have a window can register a DI\_GETDRAGIMAGE window message for it by initializing the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span></span> <span data-ttu-id="0dd1c-440">Cuando el destino recibe un mensaje DI GETDRAGIMAGE, el controlador coloca la información de mapa de bits de la imagen de arrastre en la \_ [**estructura SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) que se pasa como el valor *lParam del* mensaje.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-440">When the target receives a DI\_GETDRAGIMAGE message, the handler puts the drag image bitmap information in the [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) structure that is passed as the message's *lParam* value.</span></span>
-   <span data-ttu-id="0dd1c-441">Los destinos de colocación sin ventanas especifican un mapa de bits al inicializar el objeto auxiliar de arrastrar y colocar con [**IDragSourceHelper::InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span><span class="sxs-lookup"><span data-stu-id="0dd1c-441">Windowless drop targets specify a bitmap when they initialize the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span></span>

### <a name="using-the-idroptargethelper-interface"></a><span data-ttu-id="0dd1c-442">Uso de la interfaz IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="0dd1c-442">Using the IDropTargetHelper Interface</span></span>

<span data-ttu-id="0dd1c-443">Esta interfaz permite que el destino de colocación notifique al objeto auxiliar de arrastrar y colocar cuando el cursor entra o sale del destino.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-443">This interface allows the drop target to notify the drag-and-drop helper object when the cursor enters or leaves the target.</span></span> <span data-ttu-id="0dd1c-444">Mientras el cursor está sobre la ventana de destino, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) permite al destino proporcionar al objeto auxiliar de arrastrar y colocar la información que el destino recibe a través de su [**interfaz IDropTarget.**](/windows/win32/api/oleidl/nn-oleidl-idroptarget)</span><span class="sxs-lookup"><span data-stu-id="0dd1c-444">While the cursor is over the target window, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) allows the target to give the drag-and-drop helper object the information that the target receives through its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

<span data-ttu-id="0dd1c-445">Cuatro de los métodos [**IDropTargetHelper:**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) [**IDropTargetHelper::D ragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::D ragLeave,**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave) [**IDropTargetHelper::D ragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover)y [**IDropTargetHelper::D rop)**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)están asociados al método [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) del mismo nombre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-445">Four of the [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) methods—[**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::DragLeave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover), and [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)—are associated with the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) method of the same name.</span></span> <span data-ttu-id="0dd1c-446">Para usar el objeto auxiliar de arrastrar y colocar, cada uno de los métodos **IDropTarget** debe llamar al método **IDropTargetHelper** correspondiente para reenviar la información al objeto auxiliar de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-446">To use the drag-and-drop helper object, each of the **IDropTarget** methods should call the corresponding **IDropTargetHelper** method to forward the information to the drag-and-drop helper object.</span></span> <span data-ttu-id="0dd1c-447">El quinto **método IDropTargetHelper,** [**IDropTargetHelper::Show,**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show)notifica al objeto auxiliar de arrastrar y colocar que muestre u oculte la imagen de arrastre.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-447">The fifth **IDropTargetHelper** method, [**IDropTargetHelper::Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifies the drag-and-drop helper object to show or hide the drag image.</span></span> <span data-ttu-id="0dd1c-448">Este método se usa al arrastrar sobre una ventana de destino en un modo de vídeo de baja profundidad de color.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-448">This method is used when dragging over a target window in a low color-depth video mode.</span></span> <span data-ttu-id="0dd1c-449">Permite que el destino oculte la imagen de arrastre mientras pinta la ventana.</span><span class="sxs-lookup"><span data-stu-id="0dd1c-449">It allows the target to hide the drag image while it is painting the window.</span></span>

 

 
