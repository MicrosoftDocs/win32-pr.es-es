---
title: Crear descriptores de seguridad para nuevos objetos de directorio
description: Puede usar ADSI para crear un descriptor de seguridad y establecerlo como la propiedad nTSecurityDescriptor de un objeto nuevo o usarlo para reemplazar la propiedad nTSecurityDescriptor de un objeto existente.
ms.assetid: b9ff626f-17f1-4fc1-9d6e-4f47e29a5aeb
ms.tgt_platform: multiple
keywords:
- Crear un descriptor de seguridad para un nuevo objeto de directorio AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78265d27c52023d669e27fc9890fd2d5273e2ffd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "104487475"
---
# <a name="creating-security-descriptors-for-new-directory-objects"></a><span data-ttu-id="1cee7-104">Crear descriptores de seguridad para nuevos objetos de directorio</span><span class="sxs-lookup"><span data-stu-id="1cee7-104">Creating Security Descriptors for new directory objects</span></span>

<span data-ttu-id="1cee7-105">Puede usar ADSI para crear un descriptor de seguridad y establecerlo como la propiedad **ntSecurityDescriptor** de un objeto nuevo o usarlo para reemplazar la propiedad **ntSecurityDescriptor** de un objeto existente.</span><span class="sxs-lookup"><span data-stu-id="1cee7-105">You can use ADSI to create a security descriptor and set it as a new object's **nTSecurityDescriptor** property or use it to replace an existing object's **nTSecurityDescriptor** property.</span></span>

<span data-ttu-id="1cee7-106">Para crear un descriptor de seguridad para un objeto:</span><span class="sxs-lookup"><span data-stu-id="1cee7-106">To create a security descriptor for an object:</span></span>

1.  <span data-ttu-id="1cee7-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para crear el objeto com ADSI para el nuevo descriptor de seguridad y obtener un puntero de interfaz [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) a ese objeto.</span><span class="sxs-lookup"><span data-stu-id="1cee7-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new security descriptor and get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface pointer to that object.</span></span> <span data-ttu-id="1cee7-108">Tenga en cuenta que el ID. de clase es el **\_ SecurityDescriptor de CLSID**.</span><span class="sxs-lookup"><span data-stu-id="1cee7-108">Be aware that the class ID is **CLSID\_SecurityDescriptor**.</span></span>
2.  <span data-ttu-id="1cee7-109">Use el método de [**\_ propietario IADsSecurityDescriptor::p UT**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para establecer el propietario del objeto.</span><span class="sxs-lookup"><span data-stu-id="1cee7-109">Use the [**IADsSecurityDescriptor::put\_Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the owner of the object.</span></span> <span data-ttu-id="1cee7-110">El administrador de confianza es un usuario, un grupo u otra entidad de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1cee7-110">The trustee is a user, group, or other security principal.</span></span> <span data-ttu-id="1cee7-111">Una aplicación debe usar el valor de la propiedad adecuada del objeto de usuario o grupo del administrador de confianza al que se va a aplicar la ACE.</span><span class="sxs-lookup"><span data-stu-id="1cee7-111">An application should use the value from the appropriate property from the user or group object of the trustee to which to apply the ACE.</span></span>
3.  <span data-ttu-id="1cee7-112">Use el método de [**\_ control IADsSecurityDescriptor::p UT**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para controlar si el objeto hereda DACL y SACL de su contenedor primario.</span><span class="sxs-lookup"><span data-stu-id="1cee7-112">Use the [**IADsSecurityDescriptor::put\_Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to control whether DACLs and SACLs are inherited by the object from its parent container.</span></span>
4.  <span data-ttu-id="1cee7-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para crear el objeto com ADSI para la DACL para el nuevo descriptor de seguridad y obtener un puntero de interfaz [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) a ese objeto.</span><span class="sxs-lookup"><span data-stu-id="1cee7-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the DACL for the new security descriptor and get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface pointer to that object.</span></span> <span data-ttu-id="1cee7-114">Tenga en cuenta que el identificador de clase es **CLSID \_ AccessControlList**.</span><span class="sxs-lookup"><span data-stu-id="1cee7-114">Be aware that the class ID is **CLSID\_AccessControlList**.</span></span>
5.  <span data-ttu-id="1cee7-115">Para cada ACE que se va a agregar a la DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para crear el objeto com ADSI para la nueva ACE y obtener un puntero de interfaz [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) a ese objeto.</span><span class="sxs-lookup"><span data-stu-id="1cee7-115">For each ACE to add to the DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new ACE and get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface pointer to that object.</span></span> <span data-ttu-id="1cee7-116">Tenga en cuenta que el identificador de clase es CLSID \_ AccessControlEntry.</span><span class="sxs-lookup"><span data-stu-id="1cee7-116">Be aware that the class ID is CLSID\_AccessControlEntry.</span></span>
6.  <span data-ttu-id="1cee7-117">Para cada ACE que se va a agregar a la DACL, establezca las propiedades de la ACE mediante los métodos de propiedad del objeto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) de la ACE.</span><span class="sxs-lookup"><span data-stu-id="1cee7-117">For each ACE to add to the DACL, set the properties of the ACE using the property methods of the ACE's [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object.</span></span> <span data-ttu-id="1cee7-118">Para obtener más información sobre las propiedades que se deben establecer en una ACE, vea [establecer derechos de acceso en un objeto](setting-access-rights-on-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="1cee7-118">For more information about the properties to set on an ACE, see [Setting Access Rights on an Object](setting-access-rights-on-an-object.md).</span></span>
7.  <span data-ttu-id="1cee7-119">Para cada ACE que se va a agregar a la DACL, use el método **QueryInterface** en el objeto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) para obtener un puntero [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="1cee7-119">For each ACE to add to the DACL, use the **QueryInterface** method on the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object to get an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="1cee7-120">El método [**IADsAccessControlList:: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) requiere un puntero de interfaz **IDISPATCH** a la ACE.</span><span class="sxs-lookup"><span data-stu-id="1cee7-120">The [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) method requires an **IDispatch** interface pointer to the ACE.</span></span>
8.  <span data-ttu-id="1cee7-121">Para cada ACE que se va a agregar a la DACL, use [**IADsAccessControlList:: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) para agregar la nueva ACE a la DACL.</span><span class="sxs-lookup"><span data-stu-id="1cee7-121">For each ACE to add to the DACL, use [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) to add the new ACE to the DACL.</span></span> <span data-ttu-id="1cee7-122">Tenga en cuenta que el orden de las ACE dentro de la ACL puede afectar a la evaluación del acceso al objeto.</span><span class="sxs-lookup"><span data-stu-id="1cee7-122">Be aware that the order of the ACEs within the ACL can affect the evaluation of access to the object.</span></span> <span data-ttu-id="1cee7-123">El acceso correcto al objeto puede requerir que cree una nueva ACL, que agregue las ACE de la ACL existente en el orden correcto a la nueva ACL y que, a continuación, reemplace la ACL existente en el descriptor de seguridad por la nueva ACL.</span><span class="sxs-lookup"><span data-stu-id="1cee7-123">The correct access to the object may require you to create a new ACL, add the ACEs from the existing ACL in the correct order to the new ACL, and then replace the existing ACL in the security descriptor with the new ACL.</span></span> <span data-ttu-id="1cee7-124">Para obtener más información, vea [orden de las ACE en una DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span><span class="sxs-lookup"><span data-stu-id="1cee7-124">For more information, see [Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span></span>
9.  <span data-ttu-id="1cee7-125">Siga los pasos del 4-8 para crear la SACL para el nuevo descriptor de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1cee7-125">Follow Steps 4-8 to create the SACL for the new security descriptor.</span></span>
10. <span data-ttu-id="1cee7-126">Use el método [**IADsSecurityDescriptor::p UT \_ DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para establecer la DACL.</span><span class="sxs-lookup"><span data-stu-id="1cee7-126">Use the [**IADsSecurityDescriptor::put\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the DACL.</span></span> <span data-ttu-id="1cee7-127">Para obtener más información acerca de las DACL, vea [DACL NULL y DACL vacías](null-dacls-and-empty-dacls.md).</span><span class="sxs-lookup"><span data-stu-id="1cee7-127">For more information about DACLs, see [Null DACLs and Empty DACLs](null-dacls-and-empty-dacls.md).</span></span>
11. <span data-ttu-id="1cee7-128">Use el método [**IADsSecurityDescriptor::p UT \_ SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para establecer la SACL.</span><span class="sxs-lookup"><span data-stu-id="1cee7-128">Use the [**IADsSecurityDescriptor::put\_SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the SACL.</span></span>
12. <span data-ttu-id="1cee7-129">Convierta el objeto [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) en una [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) mediante el método **QueryInterface** del objeto **IADsSecurityDescriptor** para obtener una interfaz [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="1cee7-129">Convert the [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) object to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) by using the **QueryInterface** method of the **IADsSecurityDescriptor** object to obtain an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) interface.</span></span> <span data-ttu-id="1cee7-130">A continuación, establezca el miembro **VT** de la **variante** en el **\_ envío de VT** y establezca el miembro **pdispVal** de la **variante** igual al puntero **IDispatch** .</span><span class="sxs-lookup"><span data-stu-id="1cee7-130">Then set the **vt** member of the **VARIANT** to **VT\_DISPATCH** and set the **pdispVal** member of the **VARIANT** equal to the **IDispatch** pointer.</span></span>
13. <span data-ttu-id="1cee7-131">Obtener un puntero de interfaz [**IADs**](/windows/desktop/api/iads/nn-iads-iads) al objeto.</span><span class="sxs-lookup"><span data-stu-id="1cee7-131">Obtain an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
14. <span data-ttu-id="1cee7-132">Use el método [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) con "nTSecurityDescriptor" y la [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) creada anteriormente para escribir el nuevo descriptor de seguridad en la caché de propiedades.</span><span class="sxs-lookup"><span data-stu-id="1cee7-132">Use the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) method with "nTSecurityDescriptor" and the [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) created above to write the new security descriptor to the property cache.</span></span>
15. <span data-ttu-id="1cee7-133">Use el método [**IADs:: SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) para actualizar la propiedad en el objeto en el directorio.</span><span class="sxs-lookup"><span data-stu-id="1cee7-133">Use the [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) method to update the property on the object in the directory.</span></span>

 

 