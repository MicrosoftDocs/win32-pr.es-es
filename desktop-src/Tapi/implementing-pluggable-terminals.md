---
description: A continuación se enumeran los requisitos generales para la implementación del terminal acoplable.
ms.assetid: 7cee19b1-ceea-494a-b576-4deede759905
title: Implementación de terminales conectables
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 494b2f6bc5ccb214bc7101f570a4db3037fd8cae
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105687700"
---
# <a name="implementing-pluggable-terminals"></a><span data-ttu-id="ffd08-103">Implementación de terminales conectables</span><span class="sxs-lookup"><span data-stu-id="ffd08-103">Implementing Pluggable Terminals</span></span>

<span data-ttu-id="ffd08-104">Los requisitos generales para la implementación del terminal acoplable son:</span><span class="sxs-lookup"><span data-stu-id="ffd08-104">The general requirements for pluggable terminal implementation are:</span></span>

-   <span data-ttu-id="ffd08-105">El código de streaming subyacente de un terminal acoplable debe coincidir con las capacidades de los MSP deseados.</span><span class="sxs-lookup"><span data-stu-id="ffd08-105">A pluggable terminal's underlying streaming code should match the capabilities of the desired MSPs.</span></span>
-   <span data-ttu-id="ffd08-106">El terminal debe usar filtros de DirectShow para trabajar con la mayoría de los MSP (esto se presupone aquí).</span><span class="sxs-lookup"><span data-stu-id="ffd08-106">The terminal must use DirectShow filters to work with most MSPs (this is assumed from here on).</span></span>
-   <span data-ttu-id="ffd08-107">Los terminales de audio deben admitir el PCM lineal mono de 16 bits de 8 kHz para la mayoría de los MSP.</span><span class="sxs-lookup"><span data-stu-id="ffd08-107">Audio terminals must support 8 kHz 16-bit mono linear PCM for most MSPs.</span></span>
-   <span data-ttu-id="ffd08-108">El terminal debe habilitar la serialización de subprocesamiento libre mediante la implementación de [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="ffd08-108">The terminal should enable free threaded marshalling by implementing [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="ffd08-109">El terminal puede hacer esto llamando a la API de COM [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) y agregando **IMarshal** al puntero devuelto.</span><span class="sxs-lookup"><span data-stu-id="ffd08-109">The terminal can do this by calling the COM API [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) and aggregating **IMarshal** to the returned pointer.</span></span> <span data-ttu-id="ffd08-110">El destructor del objeto terminal debe llamar a la [**versión IMarshal->**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="ffd08-110">The terminal object's destructor should call [**IMarshal->Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>
-   <span data-ttu-id="ffd08-111">El terminal debe implementar o agregar interfaces adicionales específicas del terminal que sean adecuadas.</span><span class="sxs-lookup"><span data-stu-id="ffd08-111">The terminal should implement or aggregate any additional terminal-specific interfaces that are appropriate.</span></span>
-   <span data-ttu-id="ffd08-112">La implementación de terminal debe ser segura para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="ffd08-112">The terminal implementation must be thread-safe.</span></span>
-   <span data-ttu-id="ffd08-113">La implementación de terminal debe \# incluir Termmgr. h para la definición de [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span><span class="sxs-lookup"><span data-stu-id="ffd08-113">The terminal implementation must \#include Termmgr.h for the definition of [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span></span> <span data-ttu-id="ffd08-114">Además de las inclusiones y las bibliotecas habituales que son necesarias para las aplicaciones TAPI 3 o TAPI 3 en Windows 2000 SP1.</span><span class="sxs-lookup"><span data-stu-id="ffd08-114">This is in addition to the usual includes and libs that are needed for TAPI 3 or TAPI 3 applications under Windows 2000 SP1.</span></span>

<span data-ttu-id="ffd08-115">Notas sobre la implementación de la interfaz y el método:</span><span class="sxs-lookup"><span data-stu-id="ffd08-115">Interface and method implementation notes:</span></span>

<span data-ttu-id="ffd08-116">El terminal debe implementar [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (interfaz dual: vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span><span class="sxs-lookup"><span data-stu-id="ffd08-116">The terminal must implement [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (dual interface–vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span></span>

[<span data-ttu-id="ffd08-117">**ITTerminal:: get \_ TerminalClass**</span><span class="sxs-lookup"><span data-stu-id="ffd08-117">**ITTerminal::get\_TerminalClass**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminalclass)

<span data-ttu-id="ffd08-118">El terminal debe devolver una representación **BSTR** de un GUID que haya seleccionado y que identifique el tipo de terminal.</span><span class="sxs-lookup"><span data-stu-id="ffd08-118">The terminal must return a **BSTR** representation of a GUID you've picked that identifies your type of terminal.</span></span> <span data-ttu-id="ffd08-119">Asigne el **BSTR** a través de [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="ffd08-119">Allocate the **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="ffd08-120">Para convertir de GUID a **BSTR**, llame a [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString** y [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span><span class="sxs-lookup"><span data-stu-id="ffd08-120">To convert from GUID to **BSTR**, call [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString**, and [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span></span>

[<span data-ttu-id="ffd08-121">**ITTerminal:: get \_ TerminalType**</span><span class="sxs-lookup"><span data-stu-id="ffd08-121">**ITTerminal::get\_TerminalType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminaltype)

<span data-ttu-id="ffd08-122">Por lo general, el terminal debe devolver TT \_ Dynamic si una aplicación implementa el terminal.</span><span class="sxs-lookup"><span data-stu-id="ffd08-122">The terminal should generally return TT\_DYNAMIC if an application implements the terminal.</span></span> <span data-ttu-id="ffd08-123">La devolución \_ del TT static también funcionará y la devolución de este valor puede ser adecuada si el terminal corresponde a un dispositivo de hardware; sin embargo, esto puede resultar confuso para los usuarios porque un terminal estático no estará presente en la enumeración de terminales estática de MSP.</span><span class="sxs-lookup"><span data-stu-id="ffd08-123">Returning TT\_STATIC will also work, and returning this value may be appropriate if the terminal corresponds to a hardware device; however, doing this may be confusing to users because a static terminal will not be present in the MSP's static terminal enumeration.</span></span>

[<span data-ttu-id="ffd08-124">**ITTerminal:: get \_ State**</span><span class="sxs-lookup"><span data-stu-id="ffd08-124">**ITTerminal::get\_State**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)

<span data-ttu-id="ffd08-125">Si la implementación de terminal no limita arbitrariamente el número de flujos a los que se puede conectar el terminal simultáneamente, el terminal siempre debe devolver NOTINUSE de TS \_ .</span><span class="sxs-lookup"><span data-stu-id="ffd08-125">If the terminal implementation does not arbitrarily limit the number of streams that the terminal can be concurrently connected to, then the terminal should always return TS\_NOTINUSE.</span></span>

<span data-ttu-id="ffd08-126">De lo contrario, la implementación de terminal limita arbitrariamente el número de secuencias a las que se puede conectar el terminal a la vez.</span><span class="sxs-lookup"><span data-stu-id="ffd08-126">Otherwise, the terminal implementation arbitrarily limits the number of streams that the terminal can be connected to at a time.</span></span> <span data-ttu-id="ffd08-127">En este caso, el terminal debe mantener un recuento del número de secuencias a las que está conectado.</span><span class="sxs-lookup"><span data-stu-id="ffd08-127">In this case, the terminal should keep a count of how many streams it is connected to.</span></span> <span data-ttu-id="ffd08-128">El terminal debe incrementar este recuento interno en una llamada a [**ITTerminalControl:: ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) correcta y disminuirlo en una llamada [**ITTerminalControl::D isconnectterminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) correcta.</span><span class="sxs-lookup"><span data-stu-id="ffd08-128">The terminal should increment this internal count on a successful [**ITTerminalControl::ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call and decrement it on a successful [**ITTerminalControl::DisconnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) call.</span></span> <span data-ttu-id="ffd08-129">En [**ITTerminal:: get \_ State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), debe devolver TS \_ inuse si este recuento es igual al número máximo de flujos en los que se puede seleccionar el terminal a la vez; de lo contrario, debería devolver \_ NOTINUSE de TS.</span><span class="sxs-lookup"><span data-stu-id="ffd08-129">In [**ITTerminal::get\_State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), it should return TS\_INUSE if this count is equal to the maximum number of streams that the terminal can be selected on at a time; otherwise, it should return TS\_NOTINUSE.</span></span> <span data-ttu-id="ffd08-130">Tenga en cuenta que si el límite es uno, el recuento puede ser simplemente un valor booleano o un valor de estado de TERMINAL \_ .</span><span class="sxs-lookup"><span data-stu-id="ffd08-130">Note that if the limit is one, the count can simply be a Boolean or a TERMINAL\_STATE value.</span></span>

[<span data-ttu-id="ffd08-131">**ITTerminal:: get \_ Name**</span><span class="sxs-lookup"><span data-stu-id="ffd08-131">**ITTerminal::get\_Name**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_name)

<span data-ttu-id="ffd08-132">El terminal debe devolver un nombre **BSTR** de su elección, asignado a través de [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="ffd08-132">The terminal should return a **BSTR** name of its choice, allocated via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="ffd08-133">Este nombre debe ser significativo para el usuario y debe localizarse.</span><span class="sxs-lookup"><span data-stu-id="ffd08-133">This name should be meaningful to the user and should be localized.</span></span>

[<span data-ttu-id="ffd08-134">**ITTerminal:: get \_ mediatype**</span><span class="sxs-lookup"><span data-stu-id="ffd08-134">**ITTerminal::get\_MediaType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_mediatype)

<span data-ttu-id="ffd08-135">El terminal debe devolver su tipo de medio, ya sea TAPIMEDIATYPE \_ audio o TAPIMEDIATYPE \_ video.</span><span class="sxs-lookup"><span data-stu-id="ffd08-135">The terminal should return its media type, either TAPIMEDIATYPE\_AUDIO or TAPIMEDIATYPE\_VIDEO.</span></span>

[<span data-ttu-id="ffd08-136">**ITTerminal:: get \_ Direction**</span><span class="sxs-lookup"><span data-stu-id="ffd08-136">**ITTerminal::get\_Direction**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_direction)

<span data-ttu-id="ffd08-137">El terminal devuelve el \_ valor de enumeración de dirección de terminal que indica la dirección del terminal.</span><span class="sxs-lookup"><span data-stu-id="ffd08-137">The terminal returns the TERMINAL\_DIRECTION enum value indicating the direction of the terminal.</span></span> <span data-ttu-id="ffd08-138">Si el terminal es bidireccional (por ejemplo, un puente), debe devolver TD \_ bidireccionales.</span><span class="sxs-lookup"><span data-stu-id="ffd08-138">If the terminal is bidirectional (for example, a bridge), then it must return TD\_BIDIRECTIONAL.</span></span>

<span data-ttu-id="ffd08-139">El terminal debe implementar [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (solo vtable).</span><span class="sxs-lookup"><span data-stu-id="ffd08-139">The terminal must implement [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (vtable only).</span></span>

[<span data-ttu-id="ffd08-140">**ITTerminalControl:: get \_ AddressHandle**</span><span class="sxs-lookup"><span data-stu-id="ffd08-140">**ITTerminalControl::get\_AddressHandle**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-get_addresshandle)

<span data-ttu-id="ffd08-141">Un terminal proporcionado por la aplicación siempre debe devolver **null** como identificador de dirección.</span><span class="sxs-lookup"><span data-stu-id="ffd08-141">An application-provided terminal should always return **NULL** as the address handle.</span></span> <span data-ttu-id="ffd08-142">Esto indica al MSP que este terminal no se ha creado en un objeto de dirección MSP específico.</span><span class="sxs-lookup"><span data-stu-id="ffd08-142">This indicates to the MSP that this terminal was not created on a specific MSP address object.</span></span>

[<span data-ttu-id="ffd08-143">**ITTerminalControl::ConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="ffd08-143">**ITTerminalControl::ConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal)

<span data-ttu-id="ffd08-144">En esta llamada, el terminal agregará sus filtros al gráfico especificado y los conectará entre sí, si procede.</span><span class="sxs-lookup"><span data-stu-id="ffd08-144">On this call, the terminal will add its filter(s) to the given graph and connect them to each other, if applicable.</span></span> <span data-ttu-id="ffd08-145">Después, el terminal debe devolver los PIN que expone el terminal para la dirección de flujo especificada.</span><span class="sxs-lookup"><span data-stu-id="ffd08-145">Then the terminal should return the pin(s) exposed by the terminal for the stream direction specified.</span></span>

<span data-ttu-id="ffd08-146">Un terminal que no admite conexiones simultáneas a varias secuencias establecería una variable interna para el uso \_ de TS cuando se completase correctamente este método.</span><span class="sxs-lookup"><span data-stu-id="ffd08-146">A terminal that does not support concurrent connection to multiple streams would set an internal variable to TS\_INUSE on successful completion of this method.</span></span>

<span data-ttu-id="ffd08-147">El terminal puede usar el parámetro *dwTerminalDirection* de esta llamada para determinar la dirección de la secuencia a la que se está conectando.</span><span class="sxs-lookup"><span data-stu-id="ffd08-147">The terminal can use the *dwTerminalDirection* parameter from this call to determine the direction of the stream that it is being connected to.</span></span> <span data-ttu-id="ffd08-148">Esto es necesario para los terminales bidireccionales.</span><span class="sxs-lookup"><span data-stu-id="ffd08-148">This is required for bidirectional terminals.</span></span>

> [!Note]  
> <span data-ttu-id="ffd08-149">Normalmente (en las clases base MSP y en todos los MSP conocidos), el código de secuencia MSP no podrá conectarse si el terminal devuelve más de un PIN de una única llamada [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) .</span><span class="sxs-lookup"><span data-stu-id="ffd08-149">Typically (in the MSP base classes and in all known MSPs), the MSP stream code will fail the connection if the terminal returns more than one pin from a single [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call.</span></span> <span data-ttu-id="ffd08-150">Esto es correcto, ya que un terminal que devuelve más de un PIN durante la conexión requiere que el MSP tenga un conocimiento especial del terminal para que el uso de los pin adicionales sea eficaz.</span><span class="sxs-lookup"><span data-stu-id="ffd08-150">This is fine, because a terminal that returns more than one pin during connection requires the MSP to have special knowledge of the terminal to make use of the extra pins effectively.</span></span>

 

[<span data-ttu-id="ffd08-151">**ITTerminalControl::CompleteConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="ffd08-151">**ITTerminalControl::CompleteConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-completeconnectterminal)

<span data-ttu-id="ffd08-152">El terminal solo debe devolver S \_ correcto.</span><span class="sxs-lookup"><span data-stu-id="ffd08-152">The terminal should just return S\_OK.</span></span> <span data-ttu-id="ffd08-153">El terminal también puede realizar la inicialización posterior a la conexión si es necesario.</span><span class="sxs-lookup"><span data-stu-id="ffd08-153">The terminal may also do post-connection initialization if it needs to.</span></span>

[<span data-ttu-id="ffd08-154">**ITTerminalControl::D isconnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="ffd08-154">**ITTerminalControl::DisconnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal)

<span data-ttu-id="ffd08-155">El terminal debe hacer todo lo necesario para desconectar el terminal del resto del gráfico.</span><span class="sxs-lookup"><span data-stu-id="ffd08-155">The terminal should do whatever is needed to disconnect the terminal from the rest of the graph.</span></span> <span data-ttu-id="ffd08-156">Normalmente esto implica la eliminación de todos los filtros de los terminales del gráfico y el establecimiento del estado de terminal en TS \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="ffd08-156">Typically this involves removing all the terminals' filters from the graph and setting the terminal state to TS\_NOTINUSE.</span></span>

[<span data-ttu-id="ffd08-157">**ITTerminalControl::RunRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="ffd08-157">**ITTerminalControl::RunRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-runrenderfilter)

<span data-ttu-id="ffd08-158">El terminal solo debe devolver E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="ffd08-158">The terminal should just return E\_NOTIMPL.</span></span>

[<span data-ttu-id="ffd08-159">**ITTerminalControl::StopRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="ffd08-159">**ITTerminalControl::StopRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-stoprenderfilter)

<span data-ttu-id="ffd08-160">El terminal solo debe devolver E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="ffd08-160">The terminal should just return E\_NOTIMPL.</span></span>

 

 
