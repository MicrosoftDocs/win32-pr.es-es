---
description: Normalmente, los servicios son aplicaciones de consola diseñadas para ejecutarse en modo desatendido sin una interfaz gráfica de usuario (GUI).
ms.assetid: 3d6e090a-00b1-47d8-a4fb-620f3db8ba9c
title: Servicios interactivos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57dda3018b4b37e8c5ee56d67cd1db2c56da9b67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "103912229"
---
# <a name="interactive-services"></a><span data-ttu-id="853f0-103">Servicios interactivos</span><span class="sxs-lookup"><span data-stu-id="853f0-103">Interactive Services</span></span>

<span data-ttu-id="853f0-104">Normalmente, los servicios son aplicaciones de consola diseñadas para ejecutarse en modo desatendido sin una interfaz gráfica de usuario (GUI).</span><span class="sxs-lookup"><span data-stu-id="853f0-104">Typically, services are console applications that are designed to run unattended without a graphical user interface (GUI).</span></span> <span data-ttu-id="853f0-105">Sin embargo, algunos servicios pueden requerir una interacción ocasional con un usuario.</span><span class="sxs-lookup"><span data-stu-id="853f0-105">However, some services may require occasional interaction with a user.</span></span> <span data-ttu-id="853f0-106">En esta página se describen las mejores formas de interactuar con el usuario desde un servicio.</span><span class="sxs-lookup"><span data-stu-id="853f0-106">This page discusses the best ways to interact with the user from a service.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="853f0-107">Los servicios no pueden interactuar directamente con un usuario a partir de Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="853f0-107">Services cannot directly interact with a user as of Windows Vista.</span></span> <span data-ttu-id="853f0-108">Por lo tanto, las técnicas mencionadas en la sección titulada uso de un servicio interactivo no deben usarse en el código nuevo.</span><span class="sxs-lookup"><span data-stu-id="853f0-108">Therefore, the techniques mentioned in the section titled Using an Interactive Service should not be used in new code.</span></span>

 

## <a name="interacting-with-a-user-from-a-service-indirectly"></a><span data-ttu-id="853f0-109">Interactuar indirectamente con un usuario de un servicio</span><span class="sxs-lookup"><span data-stu-id="853f0-109">Interacting with a User from a Service Indirectly</span></span>

<span data-ttu-id="853f0-110">Puede usar las técnicas siguientes para interactuar con el usuario desde un servicio en todas las versiones compatibles de Windows:</span><span class="sxs-lookup"><span data-stu-id="853f0-110">You can use the following techniques to interact with the user from a service on all supported versions of Windows:</span></span>

-   <span data-ttu-id="853f0-111">Muestra un cuadro de diálogo en la sesión del usuario mediante la función [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) .</span><span class="sxs-lookup"><span data-stu-id="853f0-111">Display a dialog box in the user's session using the [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) function.</span></span>
-   <span data-ttu-id="853f0-112">Cree una aplicación independiente de GUI oculta y use la función [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) para ejecutar la aplicación en el contexto del usuario interactivo.</span><span class="sxs-lookup"><span data-stu-id="853f0-112">Create a separate hidden GUI application and use the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to run the application within the context of the interactive user.</span></span> <span data-ttu-id="853f0-113">Diseñe la aplicación de GUI para comunicarse con el servicio a través de algún método de comunicación entre procesos (IPC), por ejemplo, canalizaciones con nombre.</span><span class="sxs-lookup"><span data-stu-id="853f0-113">Design the GUI application to communicate with the service through some method of interprocess communication (IPC), for example, named pipes.</span></span> <span data-ttu-id="853f0-114">El servicio se comunica con la aplicación GUI para indicarle Cuándo se debe mostrar la GUI.</span><span class="sxs-lookup"><span data-stu-id="853f0-114">The service communicates with the GUI application to tell it when to display the GUI.</span></span> <span data-ttu-id="853f0-115">La aplicación comunica los resultados de la interacción del usuario de nuevo con el servicio para que el servicio pueda realizar la acción adecuada.</span><span class="sxs-lookup"><span data-stu-id="853f0-115">The application communicates the results of the user interaction back to the service so that the service can take the appropriate action.</span></span> <span data-ttu-id="853f0-116">Tenga en cuenta que IPC puede exponer las interfaces de servicio a través de la red a menos que utilice una lista de control de acceso (ACL) adecuada.</span><span class="sxs-lookup"><span data-stu-id="853f0-116">Note that IPC can expose your service interfaces over the network unless you use an appropriate access control list (ACL).</span></span>

    <span data-ttu-id="853f0-117">Si este servicio se ejecuta en un sistema multiusuario, agregue la aplicación a la siguiente clave para que se ejecute en cada sesión: **HKEY \_ local \_ Machine \\ software \\ Microsoft \\ Windows \\ CurrentVersion \\ Run**.</span><span class="sxs-lookup"><span data-stu-id="853f0-117">If this service runs on a multiuser system, add the application to the following key so that it is run in each session: **HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run**.</span></span> <span data-ttu-id="853f0-118">Si la aplicación usa canalizaciones con nombre para IPC, el servidor puede distinguir entre varios procesos de usuario al asignar a cada canalización un nombre único basado en el ID. de sesión.</span><span class="sxs-lookup"><span data-stu-id="853f0-118">If the application uses named pipes for IPC, the server can distinguish between multiple user processes by giving each pipe a unique name based on the session ID.</span></span>

<span data-ttu-id="853f0-119">La técnica siguiente también está disponible para Windows Server 2003 y Windows XP:</span><span class="sxs-lookup"><span data-stu-id="853f0-119">The following technique is also available for Windows Server 2003 and Windows XP:</span></span>

-   <span data-ttu-id="853f0-120">Para mostrar un cuadro de mensaje, llame a la función [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) con la **\_ \_ notificación de servicio MB**.</span><span class="sxs-lookup"><span data-stu-id="853f0-120">Display a message box by calling the [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) function with **MB\_SERVICE\_NOTIFICATION**.</span></span> <span data-ttu-id="853f0-121">Esto se recomienda para mostrar mensajes de estado sencillos.</span><span class="sxs-lookup"><span data-stu-id="853f0-121">This is recommended for displaying simple status messages.</span></span> <span data-ttu-id="853f0-122">No llame a **MessageBox** durante la inicialización del servicio o desde la rutina [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) , a menos que lo llame desde un subproceso independiente, de modo que vuelva al SCM de manera oportuna.</span><span class="sxs-lookup"><span data-stu-id="853f0-122">Do not call **MessageBox** during service initialization or from the [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) routine, unless you call it from a separate thread, so that you return to the SCM in a timely manner.</span></span>

## <a name="using-an-interactive-service"></a><span data-ttu-id="853f0-123">Uso de un servicio interactivo</span><span class="sxs-lookup"><span data-stu-id="853f0-123">Using an Interactive Service</span></span>

<span data-ttu-id="853f0-124">De forma predeterminada, los servicios usan una [estación de ventana](/windows/desktop/winstation/window-stations) no interactiva y no pueden interactuar con el usuario.</span><span class="sxs-lookup"><span data-stu-id="853f0-124">By default, services use a noninteractive [window station](/windows/desktop/winstation/window-stations) and cannot interact with the user.</span></span> <span data-ttu-id="853f0-125">Sin embargo, un *servicio interactivo* puede mostrar una interfaz de usuario y recibir datos proporcionados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="853f0-125">However, an *interactive service* can display a user interface and receive user input.</span></span>

> [!Caution]  
> <span data-ttu-id="853f0-126">Los servicios que se ejecutan en un contexto de seguridad elevado, como la cuenta LocalSystem, no deben crear una ventana en el escritorio interactivo porque cualquier otra aplicación que se ejecute en el escritorio interactivo puede interactuar con esta ventana.</span><span class="sxs-lookup"><span data-stu-id="853f0-126">Services running in an elevated security context, such as the LocalSystem account, should not create a window on the interactive desktop because any other application that is running on the interactive desktop can interact with this window.</span></span> <span data-ttu-id="853f0-127">Esto expone el servicio a cualquier aplicación que ejecute un usuario que haya iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="853f0-127">This exposes the service to any application that a logged-on user executes.</span></span> <span data-ttu-id="853f0-128">Además, los servicios que se ejecutan como LocalSystem no deben tener acceso al escritorio interactivo mediante una llamada a la función [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) o [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) .</span><span class="sxs-lookup"><span data-stu-id="853f0-128">Also, services that are running as LocalSystem should not access the interactive desktop by calling the [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) or [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) function.</span></span>

 

<span data-ttu-id="853f0-129">Para crear un servicio interactivo, haga lo siguiente al llamar a la función [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) :</span><span class="sxs-lookup"><span data-stu-id="853f0-129">To create an interactive service, do the following when calling the [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) function:</span></span>

1.  <span data-ttu-id="853f0-130">Especifique NULL para el parámetro *lpServiceStartName* para ejecutar el servicio en el contexto de la [cuenta LocalSystem](localsystem-account.md).</span><span class="sxs-lookup"><span data-stu-id="853f0-130">Specify NULL for the *lpServiceStartName* parameter to run the service in the context of the [LocalSystem account](localsystem-account.md).</span></span>
2.  <span data-ttu-id="853f0-131">Especifique el marcador de **\_ \_ proceso interactivo de servicio** .</span><span class="sxs-lookup"><span data-stu-id="853f0-131">Specify the **SERVICE\_INTERACTIVE\_PROCESS** flag.</span></span>

<span data-ttu-id="853f0-132">Para determinar si un servicio se ejecuta como un servicio interactivo, llame a la función [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) para recuperar un identificador de la estación de ventana y la función [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) para comprobar si la estación de ventana tiene el atributo **\_ visible de WSF** .</span><span class="sxs-lookup"><span data-stu-id="853f0-132">To determine whether a service is running as an interactive service, call the [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) function to retrieve a handle to the window station, and the [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) function to test whether the window station has the **WSF\_VISIBLE** attribute.</span></span>

<span data-ttu-id="853f0-133">Sin embargo, tenga en cuenta que la siguiente clave del registro contiene un valor, **NoInteractiveServices**, que controla el efecto del \_ proceso interactivo de servicio \_ :</span><span class="sxs-lookup"><span data-stu-id="853f0-133">However, note that the following registry key contains a value, **NoInteractiveServices**, that controls the effect of SERVICE\_INTERACTIVE\_PROCESS:</span></span>

<span data-ttu-id="853f0-134">**HKEY \_ local \_ Machine \\ System \\ CurrentControlSet \\ control \\ Windows**</span><span class="sxs-lookup"><span data-stu-id="853f0-134">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Windows**</span></span>

<span data-ttu-id="853f0-135">El valor predeterminado de **NoInteractiveServices** es 1, lo que significa que no se permite que ningún servicio se ejecute de forma interactiva, independientemente de si tiene un **\_ \_ proceso interactivo de servicio**.</span><span class="sxs-lookup"><span data-stu-id="853f0-135">The **NoInteractiveServices** value defaults to 1, which means that no service is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span> <span data-ttu-id="853f0-136">Cuando **NoInteractiveServices** se establece en 0, se permite que los servicios con el **\_ \_ proceso interactivo de servicio** se ejecuten de forma interactiva.</span><span class="sxs-lookup"><span data-stu-id="853f0-136">When **NoInteractiveServices** is set to a 0, services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span>

<span data-ttu-id="853f0-137">**Windows 7, Windows server 2008 R2, Windows XP y Windows server 2003:** El valor predeterminado de **NoInteractiveServices** es 0, lo que significa que los servicios con el **\_ \_ proceso interactivo de servicio** pueden ejecutarse de forma interactiva.</span><span class="sxs-lookup"><span data-stu-id="853f0-137">**Windows 7, Windows Server 2008 R2, Windows XP and Windows Server 2003:** The **NoInteractiveServices** value defaults to 0, which means that services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span> <span data-ttu-id="853f0-138">Cuando **NoInteractiveServices** se establece en un valor distinto de cero, no se permite que ningún servicio iniciado después se ejecute de forma interactiva, independientemente de si tiene un **\_ \_ proceso interactivo de servicio**.</span><span class="sxs-lookup"><span data-stu-id="853f0-138">When **NoInteractiveServices** is set to a nonzero value, no service started thereafter is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="853f0-139">Todos los servicios se ejecutan en Terminal Services sesión 0.</span><span class="sxs-lookup"><span data-stu-id="853f0-139">All services run in Terminal Services session 0.</span></span> <span data-ttu-id="853f0-140">Por lo tanto, si un servicio interactivo muestra una interfaz de usuario, solo es visible para el usuario que se conectó a la sesión 0.</span><span class="sxs-lookup"><span data-stu-id="853f0-140">Therefore, if an interactive service displays a user interface, it is visible only to the user who connected to session 0.</span></span> <span data-ttu-id="853f0-141">Dado que no hay ninguna manera de garantizar que el usuario interactivo esté conectado a la sesión 0, no configure un servicio para que se ejecute como un servicio interactivo en Terminal Services o en un sistema que admita el cambio rápido de usuario (el cambio rápido de usuario se implementa mediante Terminal Services).</span><span class="sxs-lookup"><span data-stu-id="853f0-141">Because there is no way to guarantee that the interactive user is connected to session 0, do not configure a service to run as an interactive service under Terminal Services or on a system that supports fast user switching (fast user switching is implemented using Terminal Services).</span></span>

 

 

 
