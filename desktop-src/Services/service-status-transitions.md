---
description: Un servicio es responsable de notificar los cambios en su estado al administrador de control de servicios (SCM).
ms.assetid: 74a85730-6667-46fe-ae12-26561ccedb73
title: Transiciones de estado del servicio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8df7684b1ebc04aa1116b09a3ae4321f2552d7b6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104568767"
---
# <a name="service-state-transitions"></a><span data-ttu-id="3025c-103">Transiciones de estado del servicio</span><span class="sxs-lookup"><span data-stu-id="3025c-103">Service State Transitions</span></span>

<span data-ttu-id="3025c-104">Un servicio es responsable de notificar los cambios en su estado al administrador de control de servicios (SCM).</span><span class="sxs-lookup"><span data-stu-id="3025c-104">A service is responsible for reporting changes in its state to the service control manager (SCM).</span></span> <span data-ttu-id="3025c-105">Los programas de control de servicios y el sistema pueden averiguar el estado de un servicio únicamente desde el SCM, por lo que es importante que un servicio notifique su estado correctamente.</span><span class="sxs-lookup"><span data-stu-id="3025c-105">Service control programs and the system can find out the state of a service only from the SCM, so it is important that a service report its state correctly.</span></span> <span data-ttu-id="3025c-106">Un servicio informa de su estado mediante una llamada a la función [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) con un puntero a una estructura de [**\_ Estado de servicio**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) completamente inicializada.</span><span class="sxs-lookup"><span data-stu-id="3025c-106">A service reports its state by calling the [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) function with a pointer to a fully initialized [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure.</span></span> <span data-ttu-id="3025c-107">El miembro **dwCurrentState** de la estructura contiene el estado del servicio que se va a informar.</span><span class="sxs-lookup"><span data-stu-id="3025c-107">The **dwCurrentState** member of the structure contains the service state to be reported.</span></span>

<span data-ttu-id="3025c-108">El estado inicial de un servicio es \_ detenido.</span><span class="sxs-lookup"><span data-stu-id="3025c-108">The initial state of a service is SERVICE\_STOPPED.</span></span> <span data-ttu-id="3025c-109">Cuando el SCM inicia el servicio, establece el estado del servicio en Inicio de servicio \_ \_ pendiente y llama a la función [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) del servicio.</span><span class="sxs-lookup"><span data-stu-id="3025c-109">When the SCM starts the service, it sets the service state to SERVICE\_START\_PENDING and calls the service's [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function.</span></span> <span data-ttu-id="3025c-110">Después, el servicio completa su inicialización mediante una de las técnicas descritas en la [función ServiceMain de servicio](service-servicemain-function.md).</span><span class="sxs-lookup"><span data-stu-id="3025c-110">The service then completes its initialization using one of the techniques described in [Service ServiceMain Function](service-servicemain-function.md).</span></span> <span data-ttu-id="3025c-111">Una vez que el servicio completa su inicialización y está listo para empezar a recibir solicitudes de control, el servicio llama a [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) para informar del servicio en \_ ejecución y especifica las solicitudes de control que el servicio está preparado para aceptar.</span><span class="sxs-lookup"><span data-stu-id="3025c-111">After the service completes its initialization and is ready to start receiving control requests, the service calls [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) to report SERVICE\_RUNNING and specify the control requests the service is prepared to accept.</span></span> <span data-ttu-id="3025c-112">La transición desde \_ el inicio del servicio \_ pendiente al servicio en \_ ejecución indica al SCM y a las herramientas de supervisión de servicios que el servicio se ha iniciado correctamente.</span><span class="sxs-lookup"><span data-stu-id="3025c-112">The transition from SERVICE\_START\_PENDING to SERVICE\_RUNNING indicates to the SCM and service-monitoring tools that the service has started successfully.</span></span> <span data-ttu-id="3025c-113">Si el servicio informa de un Estado distinto del servicio \_ que se está ejecutando, el SCM o las herramientas de supervisión de servicios podrían marcar el servicio como no se pudo iniciar.</span><span class="sxs-lookup"><span data-stu-id="3025c-113">If the service reports a state other than SERVICE\_RUNNING, the SCM or service-monitoring tools might mark the service as having failed to start.</span></span>

<span data-ttu-id="3025c-114">El SCM envía solo las solicitudes de control especificadas al servicio (excepto para la \_ solicitud de interrogación de control de servicio \_ , que siempre se envía).</span><span class="sxs-lookup"><span data-stu-id="3025c-114">The SCM sends only the specified control requests to the service (except for the SERVICE\_CONTROL\_INTERROGATE request, which is always sent).</span></span> <span data-ttu-id="3025c-115">Para obtener una lista de las solicitudes de control que puede aceptar un servicio, consulte el miembro **dwControlsAccepted** de la estructura de [**\_ Estado del servicio**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) .</span><span class="sxs-lookup"><span data-stu-id="3025c-115">For a list of the control requests that a service can accept, see the **dwControlsAccepted** member of the [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure.</span></span> <span data-ttu-id="3025c-116">Para obtener información sobre el registro para recibir eventos de dispositivo, consulte la función [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) .</span><span class="sxs-lookup"><span data-stu-id="3025c-116">For information about registering to receive device events, see the [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) function.</span></span>

<span data-ttu-id="3025c-117">Normalmente, el estado del servicio cambia como resultado de controlar una solicitud de control.</span><span class="sxs-lookup"><span data-stu-id="3025c-117">The service state typically changes as a result of handling a control request.</span></span> <span data-ttu-id="3025c-118">Las solicitudes de control que provocan el cambio del estado del servicio incluyen la \_ detención del control \_ de servicio, la pausa del control de servicio y el \_ \_ control de servicio \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="3025c-118">Control requests that cause the service state to change include SERVICE\_CONTROL\_STOP, SERVICE\_CONTROL\_PAUSE, and SERVICE\_CONTROL\_CONTINUE.</span></span> <span data-ttu-id="3025c-119">Si el servicio debe realizar un procesamiento prolongado para controlar cualquiera de estas solicitudes, debe crear un subproceso secundario para realizar el procesamiento largo y notificar el estado pendiente correspondiente al SCM.</span><span class="sxs-lookup"><span data-stu-id="3025c-119">If the service must do lengthy processing to handle any of these requests, it should create a secondary thread to perform the lengthy processing and report the corresponding pending state to the SCM.</span></span> <span data-ttu-id="3025c-120">(Para obtener el mejor rendimiento en Windows Vista y versiones posteriores de Windows, el servicio debe usar un subproceso de trabajo de un [grupo de subprocesos](/windows/desktop/ProcThread/thread-pools) para este propósito). Después, el servicio debe notificar la transición de estado completado cuando finalice el procesamiento prolongado.</span><span class="sxs-lookup"><span data-stu-id="3025c-120">(For best performance on Windows Vista and later versions of Windows, the service should use a worker thread from a [thread pool](/windows/desktop/ProcThread/thread-pools) for this purpose.) The service should then report the completed state transition when the lengthy processing is finished.</span></span> <span data-ttu-id="3025c-121">Para obtener más información sobre cómo controlar las solicitudes de control, vea [función de controlador de control de servicio](service-control-handler-function.md).</span><span class="sxs-lookup"><span data-stu-id="3025c-121">For more information about handling control requests, see [Service Control Handler Function](service-control-handler-function.md).</span></span>

<span data-ttu-id="3025c-122">Solo algunas transiciones de estado del servicio son válidas.</span><span class="sxs-lookup"><span data-stu-id="3025c-122">Only certain service state transitions are valid.</span></span> <span data-ttu-id="3025c-123">En el diagrama siguiente se muestran las transiciones válidas.</span><span class="sxs-lookup"><span data-stu-id="3025c-123">The following diagram shows the valid transitions.</span></span>

![transiciones de estado de servicio válidas](images/service-status-transitions.png)

<span data-ttu-id="3025c-125">El estado de servicio comunicado al SCM determina cómo interactúa el SCM con el servicio.</span><span class="sxs-lookup"><span data-stu-id="3025c-125">The service state reported to the SCM determines how the SCM interacts with the service.</span></span> <span data-ttu-id="3025c-126">Por ejemplo, si un servicio de notificaciones de servicio está \_ \_ pendiente, el SCM no transmite más solicitudes de control al servicio porque este estado indica que el servicio se está cerrando.</span><span class="sxs-lookup"><span data-stu-id="3025c-126">For example, if a service reports SERVICE\_STOP\_PENDING, the SCM does not transmit further control requests to the service because this state indicates that the service is shutting down.</span></span> <span data-ttu-id="3025c-127">El siguiente estado indicado por el servicio debe ser \_ detenido porque es el único estado válido después de que el servicio se \_ detenga \_ .</span><span class="sxs-lookup"><span data-stu-id="3025c-127">The next state reported by the service should be SERVICE\_STOPPED because that is the only valid state after SERVICE\_STOP\_PENDING.</span></span> <span data-ttu-id="3025c-128">Sin embargo, si un servicio informa de una transición que no es válida, el SCM no producirá un error en la llamada.</span><span class="sxs-lookup"><span data-stu-id="3025c-128">However, if a service reports a transition that is not valid, the SCM does not fail the call.</span></span>

<span data-ttu-id="3025c-129">En el diagrama siguiente se muestran las transiciones de estado del servicio con más detalle, incluidas las solicitudes de control iniciadas por un programa de control de servicios (el cliente del servicio) y las llamadas [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) que un servicio realiza para informar de los cambios de estado en el SCM.</span><span class="sxs-lookup"><span data-stu-id="3025c-129">The following diagram shows service state transitions in more detail, including the control requests initiated by a service control program (the service client) and the [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) calls that a service makes to report state changes to the SCM.</span></span> <span data-ttu-id="3025c-130">Como se mencionó anteriormente, el SCM envía solo las solicitudes de control que el servicio ha especificado y acepta, por lo que es posible que un servicio no reciba todas las solicitudes que se muestran en el diagrama.</span><span class="sxs-lookup"><span data-stu-id="3025c-130">As mentioned earlier, the SCM sends only control requests that the service has specified it will accept, so a service might not receive all of the requests shown in the diagram.</span></span>

![<span data-ttu-id="3025c-131">transiciones de estado de servicio en detalle</span><span class="sxs-lookup"><span data-stu-id="3025c-131">service status transitions in detail</span></span> ](images/service-status-flow-diagram.png)

## <a name="related-topics"></a><span data-ttu-id="3025c-132">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="3025c-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3025c-133">**ControlService**</span><span class="sxs-lookup"><span data-stu-id="3025c-133">**ControlService**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-controlservice)
</dt> <dt>

[<span data-ttu-id="3025c-134">**ControlServiceEx**</span><span class="sxs-lookup"><span data-stu-id="3025c-134">**ControlServiceEx**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-controlserviceexa)
</dt> <dt>

[<span data-ttu-id="3025c-135">**SetServiceStatus**</span><span class="sxs-lookup"><span data-stu-id="3025c-135">**SetServiceStatus**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus)
</dt> </dl>

 

 
