---
description: Usar los códecs de Windows Media en DirectShow
ms.assetid: 5b930447-6bf2-4bb3-8dfb-05f4c1e7cd64
title: Usar los códecs de Windows Media en DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb521c0e3897dc2415fbd613f97b755a146657d3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105687170"
---
# <a name="using-the-window-media-codecs-in-directshow"></a><span data-ttu-id="b7cfa-103">Usar los códecs de Windows Media en DirectShow</span><span class="sxs-lookup"><span data-stu-id="b7cfa-103">Using the Window Media Codecs in DirectShow</span></span>

<span data-ttu-id="b7cfa-104">Los objetos de codificador y descodificador de Windows Media Audio y vídeo se diseñaron y optimizaron originalmente para trabajar con el formato de contenedor de archivos ASF y el SDK de Windows Media Format.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-104">The Windows Media Audio and Video encoder and decoder objects were originally designed and optimized to work with the ASF file container format and the Windows Media Format SDK.</span></span> <span data-ttu-id="b7cfa-105">Los objetos de códec funcionan bien en DirectShow en algunos escenarios, es decir, un paso de una sola fase y una codificación VBR basada en la calidad de las secuencias de vídeo.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-105">The codec objects work well in DirectShow for certain scenarios, namely one-pass CBR and quality based VBR encoding of video streams.</span></span> <span data-ttu-id="b7cfa-106">Pero si está pensando en utilizar los objetos de códec directamente en DirectShow mediante contenedores de archivos que no sean ASF, existen ciertos comportamientos y problemas que debe tener en cuenta de antemano.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-106">But if you are considering using the codec objects directly in DirectShow using file containers other than ASF, there are certain behaviors and issues that you should be aware of in advance.</span></span>

> [!Note]  
> <span data-ttu-id="b7cfa-107">Si va a utilizar códecs independientes con DirectShow, es probable que solo desee usarlos como DMOs.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-107">If you are going to use standalone codecs with DirectShow, you will probably want to use them as DMOs only.</span></span> <span data-ttu-id="b7cfa-108">En otras palabras, utilizará la interfaz [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) en lugar de [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span><span class="sxs-lookup"><span data-stu-id="b7cfa-108">In other words, you will be using the [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) interface instead of [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span></span>

 

## <a name="wm-audio-in-avi-files"></a><span data-ttu-id="b7cfa-109">Audio de WM en archivos AVI</span><span class="sxs-lookup"><span data-stu-id="b7cfa-109">WM Audio in AVI Files</span></span>

<span data-ttu-id="b7cfa-110">Puede usar DirectShow para codificar secuencias WMA en cualquier formato de contenedor de archivos para el que tenga un filtro multiplexor.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-110">You can use DirectShow to encode WMA streams into any file container format for which you have a multiplexer filter.</span></span> <span data-ttu-id="b7cfa-111">Sin embargo, las interfaces de Windows Media Audio y códec de vídeo no admiten WMA en archivos AVI porque no es posible, mediante los filtros de reproducción de DirectShow AVI predeterminados, para mantener la sincronización de audio y vídeo en un archivo AVI con una secuencia WMA.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-111">However, the Windows Media Audio and Video codec interfaces do not support WMA in AVI files because it is impossible, using the default DirectShow AVI playback filters, to maintain audio-video sync in an AVI file with a WMA stream.</span></span> <span data-ttu-id="b7cfa-112">Para obtener más información, vea [almacenar medios comprimidos en archivos AVI](storingcompressedmediainavifiles.md).</span><span class="sxs-lookup"><span data-stu-id="b7cfa-112">For more information, see [Storing Compressed Media in AVI Files](storingcompressedmediainavifiles.md).</span></span>

<span data-ttu-id="b7cfa-113">El codificador de audio DMO genera ejemplos de duración variable, incluso cuando está en modo de "velocidad de bits constante".</span><span class="sxs-lookup"><span data-stu-id="b7cfa-113">The audio encoder DMO outputs samples of varying duration, even when in "constant bit rate" mode.</span></span> <span data-ttu-id="b7cfa-114">Por lo tanto, funciona mejor con formatos de contenedor de archivos que usan marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-114">It therefore works best with file container formats that use time stamps.</span></span> <span data-ttu-id="b7cfa-115">Los archivos AVI no proporcionan una marca de tiempo para cada ejemplo de audio o grupo de muestras.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-115">AVI files do not provide a time stamp for each audio sample or group of samples.</span></span> <span data-ttu-id="b7cfa-116">En DirectShow, el filtro de divisor de AVI fabrica marcas de tiempo para cada grupo de muestras (cada fotograma de audio) basándose en el valor **nAvgBytesPerSec** de la estructura [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) del encabezado de la secuencia AVI.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-116">In DirectShow, the AVI Splitter filter manufactures time stamps for each group of samples (each audio frame) based on the **nAvgBytesPerSec** value in the [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure in the AVI stream header.</span></span>

<span data-ttu-id="b7cfa-117">La suposición subyacente de este cálculo es que todas las muestras de audio del flujo tienen la misma duración. sin embargo, los ejemplos generados por DMO no tienen la misma duración, por lo que las marcas de tiempo aplicadas por el divisor de AVI no son precisas.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-117">The assumption underlying this calculation is that all audio samples in the stream are of equal duration; however, the samples output by the DMO are not of equal duration, and so the time stamps applied by the AVI Splitter are not accurate.</span></span> <span data-ttu-id="b7cfa-118">Por lo tanto, no es posible, sin modificar el divisor de AVI o el descodificador de audio DMO, para usar cualquier aplicación basada en DirectShow para reproducir archivos AVI con secuencias de audio y vídeo sincronizadas. El códec de voz de Windows Media Audio 9 funcionará en algunos casos, pero incluso esto perderá la sincronización después de cualquier operación de búsqueda, por lo que realmente no se puede considerar una solución viable.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-118">Therefore, it is not possible, without modifying either the AVI Splitter or the audio decoder DMO, to use any DirectShow-based application to play back AVI files with audio and video streams in sync. The Windows Media Audio 9 Voice codec will work in some cases, but even this will lose sync after any seek operation, so it really cannot be considered a viable solution.</span></span>

<span data-ttu-id="b7cfa-119">Si tiene un codificador MP3, puede crear archivos AVI con WMV y MP3 para la secuencia de audio.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-119">If you have an MP3 encoder, you can create AVI files with WMV and MP3 for the audio stream.</span></span> <span data-ttu-id="b7cfa-120">Estos archivos se reproducirán y buscarán correctamente en Windows Media Player y otras aplicaciones basadas en DirectShow, ya que el divisor de AVI contiene código de control especial para flujos MP3.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-120">Such files will play back and seek correctly in Windows Media Player and other DirectShow-based applications, because the AVI Splitter contains special handling code for MP3 streams.</span></span> <span data-ttu-id="b7cfa-121">Otra opción consiste en usar audio PCM sin comprimir, aunque obviamente el tamaño de archivo resultante será mucho mayor que con una secuencia de audio comprimida.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-121">Another option is to use uncompressed PCM audio, although obviously the resulting file size will be much larger than with a compressed audio stream.</span></span> <span data-ttu-id="b7cfa-122">Dado que la aplicación de ejemplo de DirectShow crea archivos AVI, no muestra cómo usar el codificador de audio DMO.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-122">Because the DirectShow sample application creates AVI files, it does not demonstrate how to use the audio encoder DMO.</span></span>

## <a name="one-pass-encoding"></a><span data-ttu-id="b7cfa-123">Codificación de un paso</span><span class="sxs-lookup"><span data-stu-id="b7cfa-123">One-pass Encoding</span></span>

<span data-ttu-id="b7cfa-124">El codificador de vídeo DMO funciona fácilmente en DirectShow con dos modos de codificación: CBR y VBR basada en la calidad.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-124">The video encoder DMO works easily in DirectShow for two encoding modes: CBR and quality based VBR.</span></span> <span data-ttu-id="b7cfa-125">Siempre que siga el orden correcto de las operaciones al compilar el gráfico de filtros, tal como se muestra en la aplicación de ejemplo, es relativamente sencillo colocar el contenido WMV en un archivo AVI mediante el multiplexor de AVI y el escritor de archivos.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-125">As long as you follow the correct order of operations when building the filter graph, as demonstrated in the sample application, it is relatively simple to place WMV content into an AVI file using the AVI Multiplexer and the File Writer.</span></span>

## <a name="two-pass-encoding"></a><span data-ttu-id="b7cfa-126">Codificación de dos pasos</span><span class="sxs-lookup"><span data-stu-id="b7cfa-126">Two-pass Encoding</span></span>

<span data-ttu-id="b7cfa-127">Los modos de codificación de dos pasos requieren un enfoque más complejo a la creación y la transmisión de gráficos para evitar que DMO vacíe su contenido del primer paso antes de comenzar el segundo paso.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-127">The two-pass encoding modes require a more complex approach to graph building and streaming in order to prevent the DMO from flushing its contents from the first pass before beginning the second pass.</span></span> <span data-ttu-id="b7cfa-128">En la codificación de dos pasos, es necesario ejecutar el gráfico una vez para que DMO pueda realizar el análisis de preprocesamiento de los datos de archivo y, a continuación, rebobinar el gráfico y volver a ejecutarlo para que el DMO pueda realizar la codificación real.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-128">In two-pass encoding, it is necessary to run the graph once so the DMO can perform its preprocessing analysis of the file data, and then rewind the graph and run it again so that the DMO can do the actual encoding.</span></span>

<span data-ttu-id="b7cfa-129">Cuando el gráfico entra en un estado de ejecución para el segundo paso, el contenedor de DMO establece la marca de discontinuidad en el primer ejemplo, porque la marca de tiempo no es secuencial con la última marca de tiempo en el primer paso.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-129">When the graph goes into a run state for the second pass, the DMO Wrapper sets the DISCONTINUITY flag on the first sample, because the time stamp is not sequential with the last time stamp on the first pass.</span></span> <span data-ttu-id="b7cfa-130">Cuando DMO, que no estaba diseñado para funcionar en DirectShow de esta manera, recibe la marca de discontinuidad, realiza un vaciado y pierde los datos almacenados desde el primer paso.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-130">When the DMO, which was not designed to work in DirectShow in this way, receives the DISCONTINUITY flag, it performs a flush and loses the data stored from the first pass.</span></span> <span data-ttu-id="b7cfa-131">Para solucionar este problema, la mejor solución es probablemente escribir un filtro contenedor de DMO personalizado que no establezca la marca de discontinuidad cuando se busque el gráfico después del primer paso.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-131">To work around this issue, the best solution is probably to write a custom DMO Wrapper filter that does not set the DISCONTINUITY flag when the graph is seeked after the first pass.</span></span> <span data-ttu-id="b7cfa-132">En el ejemplo de vídeo para Windows (VfW) de este SDK se muestra cómo realizar la codificación de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-132">The Video for Windows (VfW) sample in this SDK demonstrates how to perform two-pass encoding.</span></span>

## <a name="interlaced-content"></a><span data-ttu-id="b7cfa-133">Contenido entrelazado</span><span class="sxs-lookup"><span data-stu-id="b7cfa-133">Interlaced Content</span></span>

<span data-ttu-id="b7cfa-134">El codificador WMV DMO es capaz de codificar contenido entrelazado a la vez que conserva el entrelazado, lo que resulta útil para el contenido capturado de un televisor y también puede reproducirse en un televisor.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-134">The WMV encoder DMO is able to encode interlaced content while preserving the interlacing, which is useful for content that is captured from a TV and might also be played back on a TV.</span></span> <span data-ttu-id="b7cfa-135">Sin embargo, no es posible conservar el entrelazado mediante el contenedor DMO predeterminado, ya que ese filtro no admite [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) en sus ejemplos de entrada.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-135">However, it is not possible to preserve interlacing using the default DMO Wrapper, because that filter does not support [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) on its input samples.</span></span>

<span data-ttu-id="b7cfa-136">DMO utiliza esa interfaz para obtener la configuración entrelazada de cada ejemplo que recibe.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-136">The DMO uses that interface to obtain the interlaced settings for each sample that it receives.</span></span> <span data-ttu-id="b7cfa-137">Si no se encuentra la interfaz, como es el caso del contenedor de DMO, DMO simplemente trata los ejemplos de entrada como no entrelazados.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-137">If the interface is not found, as is the case with the DMO Wrapper, the DMO simply treats the input samples as noninterlaced.</span></span> <span data-ttu-id="b7cfa-138">Hay varias alternativas para realizar la codificación entrelazada en DirectShow.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-138">To perform interlaced encoding in DirectShow, there are several alternatives.</span></span> <span data-ttu-id="b7cfa-139">El enfoque más sencillo es probablemente usar el SDK de Windows Media Format 9 series, ya sea directamente o mediante el filtro DirectShow del escritor ASF de WM, para crear un archivo ASF entrelazado.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-139">The easiest approach is probably to use the Windows Media Format 9 Series SDK either directly or using the WM ASF Writer DirectShow filter, to create an interlaced ASF file.</span></span> <span data-ttu-id="b7cfa-140">Después, puede transcodificar ese archivo en otro formato.</span><span class="sxs-lookup"><span data-stu-id="b7cfa-140">You can then transcode that file into some other format.</span></span> <span data-ttu-id="b7cfa-141">Si transcodificas en AVI, tendrá un archivo entrelazado, pero los filtros de reproducción de AVI de DirectShow estándar no lo reconocerán como tal porque no son compatibles con [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span><span class="sxs-lookup"><span data-stu-id="b7cfa-141">If you transcode into AVI, you will have an interlaced file, but the standard DirectShow AVI playback filters will not recognize it as such because they do not support [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span></span> <span data-ttu-id="b7cfa-142">Otro enfoque consiste en escribir su propio filtro de contenedor de DMO que admita la interfaz [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) .</span><span class="sxs-lookup"><span data-stu-id="b7cfa-142">Another approach is to write your own DMO Wrapper filter that supports the [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) interface.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b7cfa-143">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="b7cfa-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b7cfa-144">Trabajar con códec DMOs</span><span class="sxs-lookup"><span data-stu-id="b7cfa-144">Working with Codec DMOs</span></span>](workingwithcodecdmos.md)
</dt> </dl>

 

 
