---
description: Después de una restauración, los escritores comprueban el estado de la operación para que puedan hacer uso de los datos restaurados y tratar con errores.
ms.assetid: f9def67a-c4ea-4014-929f-51fbd10d770a
title: Información general sobre la limpieza y la finalización de la restauración
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 391e029cdb109589b42240b5482f6aba2ff43555
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104082482"
---
# <a name="overview-of-restore-clean-up-and-termination"></a><span data-ttu-id="b975d-103">Información general sobre la limpieza y la finalización de la restauración</span><span class="sxs-lookup"><span data-stu-id="b975d-103">Overview of Restore Clean up and Termination</span></span>

<span data-ttu-id="b975d-104">Después de una restauración, los escritores comprueban el estado de la operación para que puedan hacer uso de los datos restaurados y tratar con errores.</span><span class="sxs-lookup"><span data-stu-id="b975d-104">Following a restore, writers check the status of the operation so that they can make use of the restored data and deal with errors.</span></span> <span data-ttu-id="b975d-105">El solicitante debe esperar a que se complete la actividad.</span><span class="sxs-lookup"><span data-stu-id="b975d-105">The requester must wait for the completion of this activity.</span></span> <span data-ttu-id="b975d-106">Para obtener más información, vea [información general sobre el procesamiento de una restauración en VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="b975d-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="b975d-107">En la tabla siguiente se muestra la secuencia de acciones y eventos que son necesarios una vez que se realiza una operación de restauración.</span><span class="sxs-lookup"><span data-stu-id="b975d-107">The following table shows the sequence of actions and events that are required after a restore operation has taken place.</span></span>



| <span data-ttu-id="b975d-108">Acción del solicitante</span><span class="sxs-lookup"><span data-stu-id="b975d-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                              | <span data-ttu-id="b975d-109">Evento</span><span class="sxs-lookup"><span data-stu-id="b975d-109">Event</span></span>                                                           | <span data-ttu-id="b975d-110">Acción del escritor</span><span class="sxs-lookup"><span data-stu-id="b975d-110">Writer action</span></span>                                                                                                                                                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b975d-111">El solicitante indica el final de la restauración (consulte [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span><span class="sxs-lookup"><span data-stu-id="b975d-111">The requester indicates the end of the restore (see [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span></span>                                                                                                                                                                                                                                           | [<span data-ttu-id="b975d-112">*Postrestore*</span><span class="sxs-lookup"><span data-stu-id="b975d-112">*PostRestore*</span></span>](vssgloss-p.md) | <span data-ttu-id="b975d-113">El escritor realiza la limpieza posterior a la restauración y controla los errores de restauración y los archivos que se han restaurado en ubicaciones no estándar (vea [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span><span class="sxs-lookup"><span data-stu-id="b975d-113">The writer conducts post-restore cleanup, and handles restoration failures and files that have been restored to nonstandard locations (see [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span></span> |
| <span data-ttu-id="b975d-114">El solicitante espera en los escritores para controlar el evento [**Postrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) con [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="b975d-114">The requester waits on writers to handle the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event with [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="b975d-115">También debe comprobar el estado del escritor (consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span><span class="sxs-lookup"><span data-stu-id="b975d-115">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span></span> | <span data-ttu-id="b975d-116">None</span><span class="sxs-lookup"><span data-stu-id="b975d-116">None</span></span>                                                            | <span data-ttu-id="b975d-117">None</span><span class="sxs-lookup"><span data-stu-id="b975d-117">None</span></span>                                                                                                                                                                                                                                               |
| <span data-ttu-id="b975d-118">El solicitante libera la interfaz [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) .</span><span class="sxs-lookup"><span data-stu-id="b975d-118">The requester releases the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface.</span></span>                                                                                                                                                                                                                                                                                    | <span data-ttu-id="b975d-119">None</span><span class="sxs-lookup"><span data-stu-id="b975d-119">None</span></span>                                                            | <span data-ttu-id="b975d-120">None</span><span class="sxs-lookup"><span data-stu-id="b975d-120">None</span></span>                                                                                                                                                                                                                                               |



 

## <a name="requester-actions-during-cleanup-and-termination"></a><span data-ttu-id="b975d-121">Acciones del solicitante durante la limpieza y la finalización</span><span class="sxs-lookup"><span data-stu-id="b975d-121">Requester Actions during Cleanup and Termination</span></span>

<span data-ttu-id="b975d-122">En este momento, un solicitante indica el final de sus actividades de restauración de archivos generando un evento [*Postrestore*](vssgloss-p.md) mediante una llamada a [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="b975d-122">At this point, a requester indicates the end of its file restoration activities by generating a [*PostRestore*](vssgloss-p.md) event by calling [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="b975d-123">Las acciones del solicitante se limitan a esperar en los escritores, lo que puede necesitar realizar una limpieza final y controlar los errores de restauración, y liberar la interfaz [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) después de que todos los escritores hayan devuelto el control del evento [*postrestore*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="b975d-123">The requester's actions are limited to waiting on the writers, which may need to perform some final cleanup and handle restore errors, and releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface after all writers have returned from handling the [*PostRestore*](vssgloss-p.md) event.</span></span>

## <a name="writer-actions-during-cleanup-and-termination"></a><span data-ttu-id="b975d-124">Acciones del escritor durante la limpieza y la finalización</span><span class="sxs-lookup"><span data-stu-id="b975d-124">Writer Actions during Cleanup and Termination</span></span>

<span data-ttu-id="b975d-125">El evento [*Postrestore*](vssgloss-p.md) se controla mediante el método virtual [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="b975d-125">The [*PostRestore*](vssgloss-p.md) event is handled by the virtual method [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="b975d-126">La implementación predeterminada simplemente devuelve **true** sin realizar ninguna acción.</span><span class="sxs-lookup"><span data-stu-id="b975d-126">The default implementation simply returns **true** without taking any action.</span></span> <span data-ttu-id="b975d-127">Si un escritor necesita ejercer más control sobre la situación posterior a la restauración, puede invalidar este método.</span><span class="sxs-lookup"><span data-stu-id="b975d-127">If a writer needs to exercise more control of the post-restore situation, it can override this method.</span></span>

<span data-ttu-id="b975d-128">Además de cualquier limpieza normal (por ejemplo, la eliminación de archivos temporales) que puede realizar un escritor en [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), puede controlar el éxito o el fracaso de las operaciones de restauración.</span><span class="sxs-lookup"><span data-stu-id="b975d-128">In addition to any normal cleanup (such as removing temporary files) that a writer might perform in [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), it can handle the success or failure of restore operations.</span></span>

<span data-ttu-id="b975d-129">La forma en que trata los errores de restauración, los archivos restaurados en una ubicación alternativa y la necesidad de futuras restauraciones se producen por completo en la discreción del escritor.</span><span class="sxs-lookup"><span data-stu-id="b975d-129">How it handles restore errors, files restored to an alternate location, and the need for future restores are completely at the writer's discretion.</span></span> <span data-ttu-id="b975d-130">Las acciones típicas pueden incluir la comparación de archivos en ubicaciones alternativas o nuevas con archivos actualmente en uso, la combinación de datos de varios archivos o el inicio de nuevas sesiones conectadas a los nuevos archivos de datos.</span><span class="sxs-lookup"><span data-stu-id="b975d-130">Typical actions might include comparing files in alternate or new locations with files currently in use, merging data from multiple files, or starting new sessions connected to the new data files.</span></span> <span data-ttu-id="b975d-131">VSS proporciona los siguientes mecanismos para admitir este componente cada componente:</span><span class="sxs-lookup"><span data-stu-id="b975d-131">VSS provides the following mechanisms for supporting this on a component-by-component basis:</span></span>

-   <span data-ttu-id="b975d-132">Se puede encontrar el éxito o el error en la restauración de cualquier componente con [**IVssComponent:: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="b975d-132">Success or failure in restoring any component can be found with [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span></span>
-   <span data-ttu-id="b975d-133">El uso de asignaciones de ubicación alternativas en la restauración de archivos se indicará mediante [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="b975d-133">The use of alternate location mappings in restoring files will be indicated by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="b975d-134">Determinar si una restauración es incremental y necesitará más restauraciones mediante una llamada a [**IVssComponent:: GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="b975d-134">Determining if a restore is incremental and will require further restores is done by calling [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span></span> <span data-ttu-id="b975d-135">Los escritores que necesiten una restauración completa de sus datos no deberían reiniciarse hasta que este método devuelva false.</span><span class="sxs-lookup"><span data-stu-id="b975d-135">Writers that need a complete restoration of their data should not restart until this method returns false.</span></span>
-   <span data-ttu-id="b975d-136">Los escritores pueden determinar si el solicitante necesitaba restaurar archivos en una ubicación no especificada anteriormente mediante [**IVssComponent:: GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) y [**IVssComponent:: GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span><span class="sxs-lookup"><span data-stu-id="b975d-136">Writers can determine if the requester has needed to restore files to a previously unspecified location using [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span></span>

<span data-ttu-id="b975d-137">(Para obtener más información sobre la restauración de archivos en ubicaciones no predeterminadas, vea [ubicaciones de copia de seguridad y restauración no predeterminadas](non-default-backup-and-restore-locations.md)).</span><span class="sxs-lookup"><span data-stu-id="b975d-137">(For more information on restoring files to non-default locations, see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="b975d-138">Al igual que con cualquier método [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , la información devuelta por una instancia determinada se aplica a los componentes que se [*incluyen explícitamente*](vssgloss-e.md) para la copia de seguridad y cualquiera de sus elementos [*incluidos implícitamente*](vssgloss-i.md) para los subcomponentes de copia de seguridad, incluidos los [subcomponentes incluidos](working-with-selectability-for-restore-and-subcomponents.md) explícitamente para su restauración por parte del solicitante mediante [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)</span><span class="sxs-lookup"><span data-stu-id="b975d-138">As with any [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) method, the information returned by a given instance applies to those components [*explicitly included*](vssgloss-e.md) for backup and any of its [*implicitly included*](vssgloss-i.md) for backup subcomponents, including those subcomponents explicitly included for restore by the requester using [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for details).</span></span>

<span data-ttu-id="b975d-139">Dado que los escritores necesitarán acceso al documento componentes de copia de seguridad, es importante que el solicitante no libere la interfaz [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) hasta que los escritores hayan terminado de procesarse.</span><span class="sxs-lookup"><span data-stu-id="b975d-139">Because the writers will require access to the Backup Components Document, it is important that the requester not release the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface until writers have finished processing.</span></span>

 

 



