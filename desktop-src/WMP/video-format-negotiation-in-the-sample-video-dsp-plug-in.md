---
title: Negociación del formato de vídeo en el complemento DSP de vídeo de ejemplo
description: Negociación del formato de vídeo en el complemento DSP de vídeo de ejemplo
ms.assetid: 3e92ce10-2b9b-4689-a181-f56c33472fea
keywords:
- Complementos de Windows Media Player, DSP de vídeo
- complementos, DSP de vídeo
- Complementos de procesamiento de señal digital, negociación de formato de vídeo
- Complementos DSP, negociación de formato de vídeo
- Complementos de DSP de vídeo, negociación de formato
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c287a38fbfcf11f1b9d74087a91c5825b22f1243
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "104357165"
---
# <a name="video-format-negotiation-in-the-sample-video-dsp-plug-in"></a><span data-ttu-id="cce71-108">Negociación del formato de vídeo en el complemento DSP de vídeo de ejemplo</span><span class="sxs-lookup"><span data-stu-id="cce71-108">Video Format Negotiation in the Sample Video DSP Plug-in</span></span>

<span data-ttu-id="cce71-109">Antes de que Windows Media Player Inserte un complemento de DSP de vídeo en la cadena de señales, el reproductor debe determinar si el complemento puede procesar el vídeo que se está reproduciendo.</span><span class="sxs-lookup"><span data-stu-id="cce71-109">Before Windows Media Player inserts a video DSP plug-in into the signal chain, the Player must determine whether the plug-in can process the video being played.</span></span> <span data-ttu-id="cce71-110">El proceso por el que el complemento y el reproductor se comunican sobre los formatos de vídeo admitidos se denomina negociación de formato.</span><span class="sxs-lookup"><span data-stu-id="cce71-110">The process by which the plug-in and the Player communicate about supported video formats is called format negotiation.</span></span>

## <a name="providing-the-supported-input-and-output-types"></a><span data-ttu-id="cce71-111">Proporcionar los tipos de entrada y salida admitidos</span><span class="sxs-lookup"><span data-stu-id="cce71-111">Providing the Supported Input and Output Types</span></span>

<span data-ttu-id="cce71-112">Si el complemento de DSP está actuando como un objeto multimedia de DirectX (DMO), el reproductor consulta el complemento sobre los formatos admitidos mediante la realización de una secuencia de llamadas a **IMediaObject:: GetInputType** y **IMediaObject:: GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="cce71-112">If the DSP plug-in is acting as a DirectX Media Object (DMO), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMediaObject::GetInputType** and **IMediaObject::GetOutputType**.</span></span>

<span data-ttu-id="cce71-113">Si el complemento de DSP actúa como una transformación de Media Foundation (MFT), el reproductor consulta el complemento sobre los formatos admitidos realizando una secuencia de llamadas a **IMFTransform:: GetInputAvailableType** y **IMFTransform:: GetOutputAvailableType**.</span><span class="sxs-lookup"><span data-stu-id="cce71-113">If the DSP plug-in is acting as a Media Foundation Transform (MFT), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType**.</span></span>

<span data-ttu-id="cce71-114">El complemento de vídeo de ejemplo generado por el Asistente para complementos de Windows Media Player almacena la lista de formatos de vídeo compatibles como una matriz de GUID.</span><span class="sxs-lookup"><span data-stu-id="cce71-114">The sample video plug-in generated by the Windows Media Player Plug-in Wizard stores the list of supported video formats as an array of GUIDs.</span></span> <span data-ttu-id="cce71-115">El código siguiente procede del archivo main. cpp:</span><span class="sxs-lookup"><span data-stu-id="cce71-115">The following code is from the main .cpp file:</span></span>


```C++
static const GUID*    k_guidValidSubtypes[] = {
    &MEDIASUBTYPE_NV12,
    &MEDIASUBTYPE_YV12,
    &MEDIASUBTYPE_YUY2,
    &MEDIASUBTYPE_UYVY,
    &MEDIASUBTYPE_RGB32,
    &MEDIASUBTYPE_RGB24,
    &MEDIASUBTYPE RGB555,
    &MEDIASUBTYPE RGB565
};

```



<span data-ttu-id="cce71-116">El reproductor puede llamar a **IMediaObject:: GetInputType** y **IMediaObject:: GetOutputType** en cualquier orden, por lo que el código del complemento debe anticiparse.</span><span class="sxs-lookup"><span data-stu-id="cce71-116">The Player can call **IMediaObject::GetInputType** and **IMediaObject::GetOutputType** in any order, so the plug-in code must anticipate this.</span></span> <span data-ttu-id="cce71-117">De igual forma, el reproductor puede llamar a **IMFTransform:: GetInputAvailableType** y **IMFTransform:: GetOutputAvailableType** en cualquier orden.</span><span class="sxs-lookup"><span data-stu-id="cce71-117">Similary, the Player can call **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType** in any order.</span></span> <span data-ttu-id="cce71-118">Las implementaciones de ejemplo de **GetOutputType** y **GetOutputAvailableType** prueban si el tipo de entrada ya se ha definido.</span><span class="sxs-lookup"><span data-stu-id="cce71-118">The sample implementations of **GetOutputType** and **GetOutputAvailableType** test whether the input type has already been defined.</span></span> <span data-ttu-id="cce71-119">Si es así, el complemento responde que solo admite ese tipo.</span><span class="sxs-lookup"><span data-stu-id="cce71-119">If it has, the plug-in responds that it supports only that type.</span></span> <span data-ttu-id="cce71-120">De lo contrario, el complemento devuelve el tipo que corresponde al índice proporcionado, como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="cce71-120">Otherwise, the plug-in returns the type that corresponds to the supplied index, as the following code demonstrates:</span></span>


```C++
// If input type has been defined, then use that as output type.
if (GUID_NULL != m_mtInput.majortype)
{
    hr = ::MoCopyMediaType( pmt, &m_mtInput );
}
else // Otherwise use default for this plug-in.
{
    ::ZeroMemory( pmt, sizeof( DMO_MEDIA_TYPE ) );
    pmt->majortype = MEDIATYPE_Video;
    pmt->subtype = *k_guidValidSubtypes[dwTypeIndex];     
}

```



## <a name="setting-the-input-and-output-types"></a><span data-ttu-id="cce71-121">Establecer los tipos de entrada y salida</span><span class="sxs-lookup"><span data-stu-id="cce71-121">Setting the Input and Output Types</span></span>

<span data-ttu-id="cce71-122">Si el complemento DSP actúa como DMO, Windows Media Player establece el tipo de medio mediante una llamada a **IMediaObject:: SetInputType** y **IMediaObject:: SetOutputType**, pasando a cada función un puntero a una estructura **de \_ \_ tipo de medio DMO** que representa el tipo de medio solicitado.</span><span class="sxs-lookup"><span data-stu-id="cce71-122">If the DSP plug-in is acting as a DMO, Windows Media Player sets the media type by calling **IMediaObject::SetInputType** and **IMediaObject::SetOutputType**, passing to each function a pointer to a **DMO\_MEDIA\_TYPE** structure that represents the requested media type.</span></span>

<span data-ttu-id="cce71-123">Si el complemento de DSP actúa como MFT, Windows Media Player establece el tipo de medio mediante una llamada a **IMFTransform:: SetInputType** y **IMFTransform:: SetOutputType**, pasando a cada función un puntero a una interfaz **IMFMediaType** que representa el tipo de medio solicitado.</span><span class="sxs-lookup"><span data-stu-id="cce71-123">If the DSP plug-in is acting as an MFT, Windows Media Player sets the media type by calling **IMFTransform::SetInputType** and **IMFTransform::SetOutputType**, passing to each function a pointer to an **IMFMediaType** interface that represents the requested media type.</span></span>

<span data-ttu-id="cce71-124">No hay ninguna garantía de que el reproductor llame a los métodos de negociación de formato en un orden determinado, por lo que el código de complemento debe controlar cualquier caso.</span><span class="sxs-lookup"><span data-stu-id="cce71-124">There is no guarantee that the Player will call format negotiation methods in any particular order, so plug-in code must handle any case.</span></span> <span data-ttu-id="cce71-125">Por ejemplo, si el reproductor llama a **SetOutputType** antes de llamar a **SetInputType**, es un curso de acción válido para que el complemento rechace el tipo de medio de salida propuesto.</span><span class="sxs-lookup"><span data-stu-id="cce71-125">For instance, if the Player calls **SetOutputType** before calling **SetInputType**, it is a valid course of action for the plug-in to reject the proposed output media type.</span></span> <span data-ttu-id="cce71-126">El siguiente código de la implementación de ejemplo de **IMediaObject:: SetOutputType** muestra esto:</span><span class="sxs-lookup"><span data-stu-id="cce71-126">The following code from the sample implementation of **IMediaObject::SetOutputType** demonstrates this:</span></span>


```C++
if( GUID_NULL != m_mtInput.majortype )
{
    // Validate that the output media type matches our requirements 
    // and matches our input type (if set).
    hr = ValidateMediaType(pmt, &m_mtInput);
}
else
{
    hr = DMO_E_TYPE_NOT_ACCEPTED;
}

```



<span data-ttu-id="cce71-127">Las implementaciones de complementos de ejemplo de **SetInputType** y **SetOutputType** llaman a la función personalizada denominada **ValidateMediaType**.</span><span class="sxs-lookup"><span data-stu-id="cce71-127">The sample plug-in implementations of **SetInputType** and **SetOutputType** call the custom function named **ValidateMediaType**.</span></span> <span data-ttu-id="cce71-128">Esta función de complemento realiza una serie de pruebas en el tipo de medio propuesto diseñado para asegurarse de que el tipo de medio tiene el formato correcto y es compatible con el complemento.</span><span class="sxs-lookup"><span data-stu-id="cce71-128">This plug-in function performs a series of tests on the proposed media type designed to ensure that the media type is well-formed and supported by the plug-in.</span></span> <span data-ttu-id="cce71-129">**ValidateMediaType** realiza las siguientes pruebas:</span><span class="sxs-lookup"><span data-stu-id="cce71-129">**ValidateMediaType** performs the following tests:</span></span>

-   <span data-ttu-id="cce71-130">Comprueba que los miembros **majortype** y **formatType** contienen los valores correctos.</span><span class="sxs-lookup"><span data-stu-id="cce71-130">Verifies that the **majortype** and **formattype** members contain the correct values.</span></span>
-   <span data-ttu-id="cce71-131">Comprueba que el miembro del **subtipo** coincide con uno de los formatos admitidos.</span><span class="sxs-lookup"><span data-stu-id="cce71-131">Verifies that the **subtype** member matches one of the supported formats.</span></span>
-   <span data-ttu-id="cce71-132">Comprueba que la información de las estructuras **BITMAPINFOHEADER** y **VIDEOINFOHEADER** o **VIDEOINFOHEADER2** contiene valores válidos.</span><span class="sxs-lookup"><span data-stu-id="cce71-132">Verifies that the information in the **BITMAPINFOHEADER** and **VIDEOINFOHEADER** or **VIDEOINFOHEADER2** structures contain valid values.</span></span>
-   <span data-ttu-id="cce71-133">Comprueba si los tipos de medios de entrada y salida coinciden porque el complemento no convierte los formatos de entrada a salida.</span><span class="sxs-lookup"><span data-stu-id="cce71-133">Tests whether the input and output media types match because the plug-in does not convert formats from input to output.</span></span>

<span data-ttu-id="cce71-134">Si el tipo de medio propuesto pasa las pruebas de validación, se almacena en una variable miembro: **m \_ mtInput** para el tipo de medio de entrada, **m \_ mtOutput** para el tipo de medio de salida.</span><span class="sxs-lookup"><span data-stu-id="cce71-134">If the proposed media type passes the validation tests, it is stored in a member variable: **m\_mtInput** for the input media type, **m\_mtOutput** for the output media type.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cce71-135">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="cce71-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cce71-136">**Implementación de un complemento DSP de vídeo**</span><span class="sxs-lookup"><span data-stu-id="cce71-136">**Implementing a Video DSP Plug-in**</span></span>](implementing-a-video-dsp-plug-in.md)
</dt> </dl>

 

 




