---
description: Uso de la interfaz IKsControl para tener acceso a las propiedades de audio
ms.assetid: 72bf9164-96c6-4543-b858-19480b032fdb
title: Uso de la interfaz IKsControl para tener acceso a las propiedades de audio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a67639a0e51334da80b7bff88293414a58bb204c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104275010"
---
# <a name="using-the-ikscontrol-interface-to-access-audio-properties"></a><span data-ttu-id="33a40-103">Uso de la interfaz IKsControl para tener acceso a las propiedades de audio</span><span class="sxs-lookup"><span data-stu-id="33a40-103">Using the IKsControl Interface to Access Audio Properties</span></span>

<span data-ttu-id="33a40-104">En raras ocasiones, es posible que una aplicación de audio especializada tenga que usar la interfaz [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) para tener acceso a determinadas funcionalidades de hardware de un adaptador de audio que no están expuestas por la [API DEVICETOPOLOGY](devicetopology-api.md) o la [API MMDevice](mmdevice-api.md).</span><span class="sxs-lookup"><span data-stu-id="33a40-104">In rare cases, a specialized audio application might need to use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access certain hardware capabilities of an audio adapter that are not exposed by the [DeviceTopology API](devicetopology-api.md) or the [MMDevice API](mmdevice-api.md).</span></span> <span data-ttu-id="33a40-105">La interfaz **IKsControl** hace que las propiedades, los eventos y los métodos de los dispositivos de streaming de kernel (KS) estén disponibles para las aplicaciones de modo de usuario.</span><span class="sxs-lookup"><span data-stu-id="33a40-105">The **IKsControl** interface makes the properties, events, and methods of kernel-streaming (KS) devices available to user-mode applications.</span></span> <span data-ttu-id="33a40-106">El interés principal de las aplicaciones de audio son las propiedades de KS.</span><span class="sxs-lookup"><span data-stu-id="33a40-106">Of primary interest to audio applications are KS properties.</span></span> <span data-ttu-id="33a40-107">La interfaz **IKsControl** se puede usar junto con la API DeviceTopology y la API MMDevice para tener acceso a las propiedades KS de los adaptadores de audio.</span><span class="sxs-lookup"><span data-stu-id="33a40-107">The **IKsControl** interface can be used in conjunction with the DeviceTopology API and the MMDevice API to access the KS properties of audio adapters.</span></span>

<span data-ttu-id="33a40-108">La interfaz [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) está pensada principalmente para su uso por parte de proveedores de hardware que escriben aplicaciones de panel de control para administrar su hardware de audio.</span><span class="sxs-lookup"><span data-stu-id="33a40-108">The [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface is intended primarily for use by hardware vendors who write control-panel applications to manage their audio hardware.</span></span> <span data-ttu-id="33a40-109">**IKsControl** es menos útil para las aplicaciones de audio de uso general que no están vinculadas a dispositivos de hardware concretos.</span><span class="sxs-lookup"><span data-stu-id="33a40-109">**IKsControl** is less useful for general-purpose audio applications that are not tied to particular hardware devices.</span></span> <span data-ttu-id="33a40-110">La razón es que los proveedores de hardware suelen implementar mecanismos de propiedad para tener acceso a las propiedades de audio de sus dispositivos.</span><span class="sxs-lookup"><span data-stu-id="33a40-110">The reason is that hardware vendors frequently implement proprietary mechanisms to access the audio properties of their devices.</span></span> <span data-ttu-id="33a40-111">A diferencia de la API de DeviceTopology, que oculta las peculiaridades de los controladores específicos del hardware y proporciona una interfaz relativamente uniforme para el acceso a las propiedades de audio, las aplicaciones usan **IKsControl** para comunicarse directamente con los controladores.</span><span class="sxs-lookup"><span data-stu-id="33a40-111">In contrast to the DeviceTopology API, which hides hardware-specific driver quirks and provides a relatively uniform interface for accessing audio properties, applications use **IKsControl** to communicate directly with drivers.</span></span> <span data-ttu-id="33a40-112">Para obtener más información sobre **IKsControl**, consulte la documentación de DDK de Windows.</span><span class="sxs-lookup"><span data-stu-id="33a40-112">For more information about **IKsControl**, see the Windows DDK documentation.</span></span>

<span data-ttu-id="33a40-113">Como se describe en [topologías de dispositivos](device-topologies.md), una subunidad en la topología de un dispositivo de adaptador podría admitir una o varias interfaces de control específicas de la función que se muestran en la columna izquierda de la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="33a40-113">As discussed in [Device Topologies](device-topologies.md), a subunit in the topology of an adapter device might support one or more of the function-specific control interfaces shown in the left column of the following table.</span></span> <span data-ttu-id="33a40-114">Cada entrada de la columna derecha de la tabla es la propiedad KS que corresponde a la interfaz de control de la izquierda.</span><span class="sxs-lookup"><span data-stu-id="33a40-114">Each entry in the right column of the table is the KS property that corresponds to the control interface on the left.</span></span> <span data-ttu-id="33a40-115">La interfaz de control proporciona un acceso cómodo a la propiedad.</span><span class="sxs-lookup"><span data-stu-id="33a40-115">The control interface provides convenient access to the property.</span></span> <span data-ttu-id="33a40-116">La mayoría de los controladores de audio usan las propiedades KS para representar las capacidades de procesamiento específicas de la función de las subunidades (también denominadas nodos KS) en las topologías de sus adaptadores de audio.</span><span class="sxs-lookup"><span data-stu-id="33a40-116">Most audio drivers use KS properties to represent the function-specific processing capabilities of the subunits (also referred to as KS nodes) in the topologies of their audio adapters.</span></span> <span data-ttu-id="33a40-117">Para obtener más información acerca de las propiedades de KS y los nodos KS, consulte la documentación del DDK de Windows.</span><span class="sxs-lookup"><span data-stu-id="33a40-117">For more information about KS properties and KS nodes, see the Windows DDK documentation.</span></span>



| <span data-ttu-id="33a40-118">Interfaz de control</span><span class="sxs-lookup"><span data-stu-id="33a40-118">Control interface</span></span>                                          | <span data-ttu-id="33a40-119">Propiedad KS</span><span class="sxs-lookup"><span data-stu-id="33a40-119">KS property</span></span>                        |
|------------------------------------------------------------|------------------------------------|
| [<span data-ttu-id="33a40-120">**IAudioAutoGainControl**</span><span class="sxs-lookup"><span data-stu-id="33a40-120">**IAudioAutoGainControl**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioautogaincontrol)     | <span data-ttu-id="33a40-121">KSPROPERTY \_ audio \_ AGC</span><span class="sxs-lookup"><span data-stu-id="33a40-121">KSPROPERTY\_AUDIO\_AGC</span></span>             |
| [<span data-ttu-id="33a40-122">**IAudioBass**</span><span class="sxs-lookup"><span data-stu-id="33a40-122">**IAudioBass**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiobass)                           | <span data-ttu-id="33a40-123">KSPROPERTY \_ audio \_ Bass</span><span class="sxs-lookup"><span data-stu-id="33a40-123">KSPROPERTY\_AUDIO\_BASS</span></span>            |
| [<span data-ttu-id="33a40-124">**IAudioChannelConfig**</span><span class="sxs-lookup"><span data-stu-id="33a40-124">**IAudioChannelConfig**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiochannelconfig)         | <span data-ttu-id="33a40-125">\_configuración de \_ canal de audio de KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="33a40-125">KSPROPERTY\_AUDIO\_CHANNEL\_CONFIG</span></span> |
| [<span data-ttu-id="33a40-126">**IAudioInputSelector**</span><span class="sxs-lookup"><span data-stu-id="33a40-126">**IAudioInputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioinputselector)         | <span data-ttu-id="33a40-127">origen de KSPROPERTY \_ audio \_ MUX \_</span><span class="sxs-lookup"><span data-stu-id="33a40-127">KSPROPERTY\_AUDIO\_MUX\_SOURCE</span></span>     |
| [<span data-ttu-id="33a40-128">**IAudioLoudness**</span><span class="sxs-lookup"><span data-stu-id="33a40-128">**IAudioLoudness**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioloudness)                   | <span data-ttu-id="33a40-129">KSPROPERTY \_ audio \_ sonoridad</span><span class="sxs-lookup"><span data-stu-id="33a40-129">KSPROPERTY\_AUDIO\_LOUDNESS</span></span>        |
| [<span data-ttu-id="33a40-130">**IAudioMidrange**</span><span class="sxs-lookup"><span data-stu-id="33a40-130">**IAudioMidrange**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiomidrange)                   | <span data-ttu-id="33a40-131">KSPROPERTY \_ audio \_ MID</span><span class="sxs-lookup"><span data-stu-id="33a40-131">KSPROPERTY\_AUDIO\_MID</span></span>             |
| [<span data-ttu-id="33a40-132">**IAudioMute**</span><span class="sxs-lookup"><span data-stu-id="33a40-132">**IAudioMute**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiomute)                           | <span data-ttu-id="33a40-133">\_ \_ Silenciar audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="33a40-133">KSPROPERTY\_AUDIO\_MUTE</span></span>            |
| [<span data-ttu-id="33a40-134">**IAudioOutputSelector**</span><span class="sxs-lookup"><span data-stu-id="33a40-134">**IAudioOutputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiooutputselector)       | <span data-ttu-id="33a40-135">KSPROPERTY \_ audio \_ Demux \_ dest</span><span class="sxs-lookup"><span data-stu-id="33a40-135">KSPROPERTY\_AUDIO\_DEMUX\_DEST</span></span>     |
| [<span data-ttu-id="33a40-136">**IAudioPeakMeter**</span><span class="sxs-lookup"><span data-stu-id="33a40-136">**IAudioPeakMeter**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiopeakmeter)                 | <span data-ttu-id="33a40-137">\_PEAKMETER de audio KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="33a40-137">KSPROPERTY\_AUDIO\_PEAKMETER</span></span>       |
| [<span data-ttu-id="33a40-138">**IAudioTreble**</span><span class="sxs-lookup"><span data-stu-id="33a40-138">**IAudioTreble**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiotreble)                       | <span data-ttu-id="33a40-139">KSPROPERTY \_ audio \_ agudos</span><span class="sxs-lookup"><span data-stu-id="33a40-139">KSPROPERTY\_AUDIO\_TREBLE</span></span>          |
| [<span data-ttu-id="33a40-140">**IAudioVolumeLevel**</span><span class="sxs-lookup"><span data-stu-id="33a40-140">**IAudioVolumeLevel**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiovolumelevel)             | <span data-ttu-id="33a40-141">\_VOLUMELEVEL de audio KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="33a40-141">KSPROPERTY\_AUDIO\_VOLUMELEVEL</span></span>     |
| [<span data-ttu-id="33a40-142">**IDeviceSpecificProperty**</span><span class="sxs-lookup"><span data-stu-id="33a40-142">**IDeviceSpecificProperty**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicespecificproperty) | <span data-ttu-id="33a40-143">específico de KSPROPERTY \_ audio \_ dev \_</span><span class="sxs-lookup"><span data-stu-id="33a40-143">KSPROPERTY\_AUDIO\_DEV\_SPECIFIC</span></span>   |



 

<span data-ttu-id="33a40-144">Es posible que las topologías de algunos adaptadores de audio contengan subunidades que tengan propiedades KS que no aparezcan en la tabla anterior.</span><span class="sxs-lookup"><span data-stu-id="33a40-144">The topologies of some audio adapters might contain subunits that have KS properties that are not listed in the preceding table.</span></span> <span data-ttu-id="33a40-145">Por ejemplo, supongamos que una llamada al método [**IPart:: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) para una subunidad determinada recupera el valor de GUID KSNODETYPE el \_ tono.</span><span class="sxs-lookup"><span data-stu-id="33a40-145">For example, assume that a call to the [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) method for a particular subunit retrieves the GUID value KSNODETYPE\_TONE.</span></span> <span data-ttu-id="33a40-146">Este GUID de subtipo indica que la subunidad admite una o varias de las siguientes propiedades de KS:</span><span class="sxs-lookup"><span data-stu-id="33a40-146">This subtype GUID indicates that the subunit supports one or more of the following KS properties:</span></span>

-   <span data-ttu-id="33a40-147">KSPROPERTY \_ audio \_ Bass</span><span class="sxs-lookup"><span data-stu-id="33a40-147">KSPROPERTY\_AUDIO\_BASS</span></span>
-   <span data-ttu-id="33a40-148">KSPROPERTY \_ audio \_ MID</span><span class="sxs-lookup"><span data-stu-id="33a40-148">KSPROPERTY\_AUDIO\_MID</span></span>
-   <span data-ttu-id="33a40-149">KSPROPERTY \_ audio \_ agudos</span><span class="sxs-lookup"><span data-stu-id="33a40-149">KSPROPERTY\_AUDIO\_TREBLE</span></span>
-   <span data-ttu-id="33a40-150">\_aumento de \_ graves de audio de KSPROPERTY \_</span><span class="sxs-lookup"><span data-stu-id="33a40-150">KSPROPERTY\_AUDIO\_BASS\_BOOST</span></span>

<span data-ttu-id="33a40-151">Se puede tener acceso a las tres primeras propiedades de esta lista a través de las interfaces de control que aparecen en la tabla anterior, pero la \_ propiedad KSPROPERTY audio \_ Bass \_ Boost no tiene ninguna interfaz de control correspondiente en la API de DeviceTopology.</span><span class="sxs-lookup"><span data-stu-id="33a40-151">The first three properties in this list can be accessed through the control interfaces that appear in the preceding table, but the KSPROPERTY\_AUDIO\_BASS\_BOOST property has no corresponding control interface in the DeviceTopology API.</span></span> <span data-ttu-id="33a40-152">Sin embargo, una aplicación puede usar la interfaz [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) para tener acceso a esta propiedad, si la subunidad admite la propiedad.</span><span class="sxs-lookup"><span data-stu-id="33a40-152">However, an application can use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access this property, if the subunit supports the property.</span></span>

<span data-ttu-id="33a40-153">Los pasos siguientes son necesarios para tener acceso a \_ la \_ propiedad KSPROPERTY audio Bass \_ Boost de una subunidad de subtipo KSNODETYPE \_ Tone:</span><span class="sxs-lookup"><span data-stu-id="33a40-153">The following steps are required to access the KSPROPERTY\_AUDIO\_BASS\_BOOST property of a subunit of subtype KSNODETYPE\_TONE:</span></span>

1.  <span data-ttu-id="33a40-154">Llame al método [**IConnector:: GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) o [**IDeviceTopology:: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) para obtener la cadena de identificador de dispositivo que identifica el dispositivo de adaptador.</span><span class="sxs-lookup"><span data-stu-id="33a40-154">Call the [**IConnector::GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) or [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method to obtain the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="33a40-155">Esta cadena es similar a una [cadena de identificador de punto de conexión](endpoint-id-strings.md), con la salvedad de que identifica un dispositivo de adaptador en lugar de un dispositivo de extremo.</span><span class="sxs-lookup"><span data-stu-id="33a40-155">This string is similar to an [endpoint ID string](endpoint-id-strings.md), except that it identifies an adapter device instead of an endpoint device.</span></span> <span data-ttu-id="33a40-156">Para obtener más información acerca de la diferencia entre un dispositivo adaptador y un dispositivo de punto de conexión, consulte [dispositivos de punto de conexión de audio](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="33a40-156">For more information about the difference between an adapter device and an endpoint device, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>
2.  <span data-ttu-id="33a40-157">Obtenga la interfaz [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) del dispositivo adaptador llamando al método [**IMMDeviceEnumerator:: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) con la cadena de identificador de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="33a40-157">Obtain the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device by calling the [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method with the device ID string.</span></span> <span data-ttu-id="33a40-158">Esta interfaz **IMMDevice** es la misma que la interfaz descrita en la **interfaz IMMDevice**, pero representa un dispositivo adaptador en lugar de un dispositivo de extremo.</span><span class="sxs-lookup"><span data-stu-id="33a40-158">This **IMMDevice** interface is the same as the interface described in **IMMDevice Interface**, but it represents an adapter device instead of an endpoint device.</span></span>
3.  <span data-ttu-id="33a40-159">Obtenga la interfaz [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) en la subunidad llamando al método [**IMMDevice:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) con el *IID* de parámetro establecido en **REFIID** IID \_ IKsControl.</span><span class="sxs-lookup"><span data-stu-id="33a40-159">Obtain the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface on the subunit by calling the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method with parameter *iid* set to **REFIID** IID\_IKsControl.</span></span> <span data-ttu-id="33a40-160">Tenga en cuenta que las interfaces admitidas por este método de **activación** , que es para un dispositivo de adaptador, son diferentes de las interfaces admitidas por el método **Activate** para un dispositivo de extremo.</span><span class="sxs-lookup"><span data-stu-id="33a40-160">Note that the interfaces supported by this **Activate** method, which is for an adapter device, are different from the interfaces supported by the **Activate** method for an endpoint device.</span></span> <span data-ttu-id="33a40-161">En concreto, el método **Activar** para un dispositivo adaptador es compatible con **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="33a40-161">In particular, the **Activate** method for an adapter device supports **IKsControl**.</span></span>
4.  <span data-ttu-id="33a40-162">Llame al método [**IPart:: GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) para obtener el identificador local de la subunidad.</span><span class="sxs-lookup"><span data-stu-id="33a40-162">Call the [**IPart::GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) method to obtain the local ID of the subunit.</span></span>
5.  <span data-ttu-id="33a40-163">Construya una solicitud de propiedad KS.</span><span class="sxs-lookup"><span data-stu-id="33a40-163">Construct a KS property request.</span></span> <span data-ttu-id="33a40-164">El ID. de nodo KS necesario para la solicitud se encuentra en los 16 bits menos significativos del ID. local obtenido en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="33a40-164">The KS node ID required for the request is contained in the 16 least-significant bits of the local ID obtained in the previous step.</span></span>
6.  <span data-ttu-id="33a40-165">Envíe la solicitud de la propiedad KS al controlador de audio llamando al método [**IKsControl:: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) .</span><span class="sxs-lookup"><span data-stu-id="33a40-165">Send the KS property request to the audio driver by calling the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method.</span></span> <span data-ttu-id="33a40-166">Para obtener más información acerca de este método, consulte la documentación de DDK de Windows.</span><span class="sxs-lookup"><span data-stu-id="33a40-166">For more information about this method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="33a40-167">En el ejemplo de código siguiente se recupera el valor de \_ la \_ propiedad KSPROPERTY audio Bass \_ Boost de una subunidad de subtipo KSNODETYPE \_ Tone:</span><span class="sxs-lookup"><span data-stu-id="33a40-167">The following code example retrieves the value of the KSPROPERTY\_AUDIO\_BASS\_BOOST property from a subunit of subtype KSNODETYPE\_TONE:</span></span>


```C++
//-----------------------------------------------------------
// This function calls the IKsControl::Property method to get
// the value of the KSPROPERTY_AUDIO_BASS_BOOST property of
// a subunit. Parameter pPart should point to a part that is
// a subunit with a subtype GUID value of KSNODETYPE_TONE.
//-----------------------------------------------------------
#define PARTID_MASK 0x0000ffff
#define EXIT_ON_ERROR(hres)  \
              if (FAILED(hres)) { goto Exit; }
#define SAFE_RELEASE(punk)  \
              if ((punk) != NULL)  \
                { (punk)->Release(); (punk) = NULL; }

const IID IID_IKsControl = __uuidof(IKsControl);

HRESULT GetBassBoost(IMMDeviceEnumerator *pEnumerator,
                     IPart *pPart, BOOL *pbValue)
{
    HRESULT hr;
    IDeviceTopology *pTopology = NULL;
    IMMDevice *pPnpDevice = NULL;
    IKsControl *pKsControl = NULL;
    LPWSTR pwszDeviceId = NULL;

    if (pEnumerator == NULL || pPart == NULL || pbValue == NULL)
    {
        return E_INVALIDARG;
    }

    // Get the topology object for the adapter device that contains
    // the subunit represented by the IPart interface.
    hr = pPart->GetTopologyObject(&pTopology);
    EXIT_ON_ERROR(hr)

    // Get the device ID string that identifies the adapter device.
    hr = pTopology->GetDeviceId(&pwszDeviceId);
    EXIT_ON_ERROR(hr)

    // Get the IMMDevice interface of the adapter device object.
    hr = pEnumerator->GetDevice(pwszDeviceId, &pPnpDevice);
    EXIT_ON_ERROR(hr)

    // Activate an IKsControl interface on the adapter device object.
    hr = pPnpDevice->Activate(IID_IKsControl, CLSCTX_ALL, NULL, (void**)&pKsControl);
    EXIT_ON_ERROR(hr)

    // Get the local ID of the subunit (contains the KS node ID).
    UINT localId = 0;
    hr = pPart->GetLocalId(&localId);
    EXIT_ON_ERROR(hr)

    KSNODEPROPERTY_AUDIO_CHANNEL ksprop;
    ZeroMemory(&ksprop, sizeof(ksprop));
    ksprop.NodeProperty.Property.Set = KSPROPSETID_Audio;
    ksprop.NodeProperty.Property.Id = KSPROPERTY_AUDIO_BASS_BOOST;
    ksprop.NodeProperty.Property.Flags = KSPROPERTY_TYPE_GET | KSPROPERTY_TYPE_TOPOLOGY;
    ksprop.NodeProperty.NodeId = localId & PARTID_MASK;
    ksprop.Channel = 0;

    // Send the property request.to the device driver.
    BOOL bValue = FALSE;
    ULONG valueSize;
    hr = pKsControl->KsProperty(
                         &ksprop.NodeProperty.Property, sizeof(ksprop),
                         &bValue, sizeof(bValue), &valueSize);
    EXIT_ON_ERROR(hr)

    *pbValue = bValue;

Exit:
    SAFE_RELEASE(pTopology)
    SAFE_RELEASE(pPnpDevice)
    SAFE_RELEASE(pKsControl)
    CoTaskMemFree(pwszDeviceId);
    return hr;
}

```



<span data-ttu-id="33a40-168">En el ejemplo de código anterior, la función GetBassBoost toma los tres parámetros siguientes:</span><span class="sxs-lookup"><span data-stu-id="33a40-168">In the preceding code example, the GetBassBoost function takes the following three parameters:</span></span>

-   <span data-ttu-id="33a40-169">`pEnumerator` apunta a la interfaz [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) de un enumerador de punto de conexión de audio.</span><span class="sxs-lookup"><span data-stu-id="33a40-169">`pEnumerator` points to the [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) interface of an audio endpoint enumerator.</span></span>
-   <span data-ttu-id="33a40-170">`pPart` apunta a la interfaz [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) de una subunidad que tiene un subtipo de \_ tono KSNODETYPE.</span><span class="sxs-lookup"><span data-stu-id="33a40-170">`pPart` points to the [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) interface of a subunit that has a subtype of KSNODETYPE\_TONE.</span></span>
-   <span data-ttu-id="33a40-171">`pbValue` apunta a una variable **bool** en la que la función escribe el valor de propiedad.</span><span class="sxs-lookup"><span data-stu-id="33a40-171">`pbValue` points to a **BOOL** variable into which the function writes the property value.</span></span>

<span data-ttu-id="33a40-172">Un programa llama a GetBassBoost solo después de llamar a [**IPart:: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) y determina que el subtipo de la subunidad es el tono de KSNODETYPE \_ .</span><span class="sxs-lookup"><span data-stu-id="33a40-172">A program calls GetBassBoost only after it calls [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) and determines that the subtype of the subunit is KSNODETYPE\_TONE.</span></span> <span data-ttu-id="33a40-173">El valor de la propiedad es **true** si se habilita el aumento de graves.</span><span class="sxs-lookup"><span data-stu-id="33a40-173">The property value is **TRUE** if bass boost is enabled.</span></span> <span data-ttu-id="33a40-174">Es **false** si se deshabilita el aumento de graves.</span><span class="sxs-lookup"><span data-stu-id="33a40-174">It is **FALSE** if bass boost is disabled.</span></span>

<span data-ttu-id="33a40-175">Al principio de la función GetBassBoost, la llamada al método [**IPart:: GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) obtiene la interfaz [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) del dispositivo adaptador que contiene la \_ subunidad de tono KSNODETYPE.</span><span class="sxs-lookup"><span data-stu-id="33a40-175">At the beginning of the GetBassBoost function, the call to the [**IPart::GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) method obtains the [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) interface of the adapter device that contains the KSNODETYPE\_TONE subunit.</span></span> <span data-ttu-id="33a40-176">La llamada al método [**IDeviceTopology:: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) recupera la cadena de identificador de dispositivo que identifica el dispositivo de adaptador.</span><span class="sxs-lookup"><span data-stu-id="33a40-176">The [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method call retrieves the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="33a40-177">La llamada al método [**IMMDeviceEnumerator:: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) toma la cadena de identificador de dispositivo como parámetro de entrada y recupera la interfaz [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) del dispositivo adaptador.</span><span class="sxs-lookup"><span data-stu-id="33a40-177">The [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method call takes the device ID string as an input parameter, and retrieves the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device.</span></span> <span data-ttu-id="33a40-178">A continuación, la llamada al método [**IMMDevice:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) recupera la interfaz [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) de la subunidad.</span><span class="sxs-lookup"><span data-stu-id="33a40-178">Next, the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method call retrieves the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface of the subunit.</span></span> <span data-ttu-id="33a40-179">Para obtener más información acerca de la interfaz **IKsControl** , consulte la documentación de DDK de Windows.</span><span class="sxs-lookup"><span data-stu-id="33a40-179">For more information about the **IKsControl** interface, see the Windows DDK documentation.</span></span>

<span data-ttu-id="33a40-180">A continuación, en el ejemplo de código anterior se crea una estructura de [**\_ \_ canal de audio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) que describe la propiedad graves-Boost.</span><span class="sxs-lookup"><span data-stu-id="33a40-180">Next, the preceding code example creates a [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure that describes the bass-boost property.</span></span> <span data-ttu-id="33a40-181">En el ejemplo de código se pasa un puntero a la estructura al método [**IKsControl:: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) , que usa la información de la estructura para recuperar el valor de propiedad.</span><span class="sxs-lookup"><span data-stu-id="33a40-181">The code example passes a pointer to the structure to the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method, which uses the information in the structure to retrieve the property value.</span></span> <span data-ttu-id="33a40-182">Para obtener más información sobre la estructura de **\_ \_ canal de audio KSNODEPROPERTY** y el método **IKsControl:: KsProperty** , consulte la documentación de DDK de Windows.</span><span class="sxs-lookup"><span data-stu-id="33a40-182">For more information about the **KSNODEPROPERTY\_AUDIO\_CHANNEL** structure and the **IKsControl::KsProperty** method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="33a40-183">Normalmente, el hardware de audio asigna un estado de graves-Boost independiente a cada canal de una secuencia de audio.</span><span class="sxs-lookup"><span data-stu-id="33a40-183">Audio hardware typically assigns a separate bass-boost state to each channel in an audio stream.</span></span> <span data-ttu-id="33a40-184">En principio, el aumento de graves se puede habilitar para algunos canales y deshabilitarse para otros.</span><span class="sxs-lookup"><span data-stu-id="33a40-184">In principle, bass boost can be enabled for some channels and disabled for others.</span></span> <span data-ttu-id="33a40-185">La estructura de [**\_ \_ canal de audio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) contiene un miembro de **canal** que especifica el número de canal.</span><span class="sxs-lookup"><span data-stu-id="33a40-185">The [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure contains a **Channel** member that specifies the channel number.</span></span> <span data-ttu-id="33a40-186">Si una secuencia contiene *N* canales, los canales se numeran de 0 a *N*-1.</span><span class="sxs-lookup"><span data-stu-id="33a40-186">If a stream contains *N* channels, the channels are numbered from 0 to *N*— 1.</span></span> <span data-ttu-id="33a40-187">En el ejemplo de código anterior se obtiene el valor de la propiedad Bass-Boost solo para el canal 0.</span><span class="sxs-lookup"><span data-stu-id="33a40-187">The preceding code example gets the value of the bass-boost property for channel 0 only.</span></span> <span data-ttu-id="33a40-188">Esta implementación presupone implícitamente que las propiedades de graves-Boost para todos los canales se establecen de forma uniforme en el mismo estado.</span><span class="sxs-lookup"><span data-stu-id="33a40-188">This implementation implicitly assumes that the bass-boost properties for all of the channels are set uniformly to the same state.</span></span> <span data-ttu-id="33a40-189">Por lo tanto, la lectura de la propiedad graves-Boost para el canal 0 es suficiente para determinar el valor de la propiedad graves-Boost para la secuencia.</span><span class="sxs-lookup"><span data-stu-id="33a40-189">Thus, reading the bass-boost property for channel 0 is sufficient to determine the bass-boost property value for the stream.</span></span> <span data-ttu-id="33a40-190">Para ser coherente con esta suposición, una función correspondiente para establecer la propiedad de graves-Boost establecería todos los canales en el mismo valor de la propiedad Bass-Boost.</span><span class="sxs-lookup"><span data-stu-id="33a40-190">To be consistent with this assumption, a corresponding function to set the bass-boost property would set all channels to the same bass-boost property value.</span></span> <span data-ttu-id="33a40-191">Se trata de convenciones razonables, pero no todos los proveedores de hardware las siguen necesariamente.</span><span class="sxs-lookup"><span data-stu-id="33a40-191">These are reasonable conventions, but not all hardware vendors necessarily follow them.</span></span> <span data-ttu-id="33a40-192">Por ejemplo, un proveedor puede proporcionar una aplicación del panel de control que habilita el aumento de graves solo para los canales que impulsan a los hablantes de intervalos completos.</span><span class="sxs-lookup"><span data-stu-id="33a40-192">For example, a vendor might supply a control-panel application that enables bass boost only for channels that drive full-range speakers.</span></span> <span data-ttu-id="33a40-193">(Un altavoz completo puede reproducir sonidos en todo el intervalo, desde graves hasta agudos). En ese caso, el valor de propiedad recuperado por el ejemplo de código anterior podría no representar con precisión el estado de graves-Boost de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="33a40-193">(A full-range speaker is capable of playing sounds over the full range from bass to treble.) In that case, the property value retrieved by the preceding code example might not accurately represent the bass-boost state of the stream.</span></span>

<span data-ttu-id="33a40-194">Los clientes que usan las interfaces de control enumeradas en la tabla anterior pueden llamar al método [**IPart:: RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) para registrarse para recibir notificaciones cuando cambia el valor de un parámetro de control.</span><span class="sxs-lookup"><span data-stu-id="33a40-194">Clients that use the control interfaces listed in the preceding table can call the [**IPart::RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) method to register for notifications when the value of a control parameter changes.</span></span> <span data-ttu-id="33a40-195">Tenga en cuenta que la interfaz [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) no proporciona un medio similar para que los clientes se registren para las notificaciones cuando cambia el valor de una propiedad.</span><span class="sxs-lookup"><span data-stu-id="33a40-195">Note that the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface does not provide a similar means for clients to register for notifications when a property value changes.</span></span> <span data-ttu-id="33a40-196">Si **IKsControl** admitía notificaciones de cambio de propiedad, podría informar a una aplicación cuando otra aplicación cambiara un valor de propiedad.</span><span class="sxs-lookup"><span data-stu-id="33a40-196">If **IKsControl** did support property-change notifications, it could inform an application when another application changed a property value.</span></span> <span data-ttu-id="33a40-197">Sin embargo, a diferencia de los controles que se usan con más frecuencia y que se supervisan a través de notificaciones de [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) , las propiedades administradas por **IKsControl** están pensadas principalmente para su uso por parte de los proveedores de hardware, y es probable que estas propiedades solo las cambien las aplicaciones del panel de control escritas por los proveedores.</span><span class="sxs-lookup"><span data-stu-id="33a40-197">However, in contrast to the more commonly used controls that are monitored through [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) notifications, the properties managed by **IKsControl** are intended primarily for use by hardware vendors, and those properties are likely to be changed only by control-panel applications written by the vendors.</span></span> <span data-ttu-id="33a40-198">Si una aplicación debe detectar los cambios de propiedades realizados por otra aplicación, puede detectar los cambios sondeando periódicamente el valor de la propiedad a través de **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="33a40-198">If an application must detect property changes made by another application, it can detect the changes by periodically polling the property value through **IKsControl**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="33a40-199">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="33a40-199">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="33a40-200">Guía de programación</span><span class="sxs-lookup"><span data-stu-id="33a40-200">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 
