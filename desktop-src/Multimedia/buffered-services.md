---
title: Servicios almacenados en búfer
description: Servicios almacenados en búfer
ms.assetid: 4816ab05-42fc-4c22-b753-8fd153d88c27
keywords:
- e/s de archivos multimedia, servicios almacenados en búfer
- e/s de archivos, servicios almacenados en búfer
- entrada y salida (e/s), servicios almacenados en búfer
- E/s (entrada y salida), servicios almacenados en búfer
- e/s almacenada en búfer
- mmioOpen función)
- búfer de e/s interno
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d014ed765609dd43886cc7b33987f8fd5ac7e65a
ms.sourcegitcommit: 7ef31bf778e76ce4196205d4c4c632fbdc649805
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/05/2021
ms.locfileid: "104003261"
---
# <a name="buffered-services"></a><span data-ttu-id="32cf7-110">Servicios almacenados en búfer</span><span class="sxs-lookup"><span data-stu-id="32cf7-110">Buffered Services</span></span>

<span data-ttu-id="32cf7-111">La mayor parte de la sobrecarga en la e/s de archivos se produce al obtener acceso al dispositivo multimedia.</span><span class="sxs-lookup"><span data-stu-id="32cf7-111">Most of the overhead in file I/O occurs when accessing the media device.</span></span> <span data-ttu-id="32cf7-112">Si está leyendo o escribiendo muchos bloques pequeños de información, el dispositivo puede dedicar mucho tiempo a la ubicación física del medio para cada operación de lectura o escritura.</span><span class="sxs-lookup"><span data-stu-id="32cf7-112">If you are reading or writing many small blocks of information, the device can spend a lot of time moving to the physical location on the media for each read or write operation.</span></span> <span data-ttu-id="32cf7-113">En este caso, puede lograr un mejor rendimiento mediante el uso de servicios de e/s de archivos almacenados en búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-113">In this case, you can achieve better performance by using buffered file I/O services.</span></span> <span data-ttu-id="32cf7-114">Con la e/s en búfer, el administrador de e/s de archivos mantiene un búfer intermedio mayor que los bloques de información que está leyendo o escribiendo.</span><span class="sxs-lookup"><span data-stu-id="32cf7-114">With buffered I/O, the file I/O manager maintains an intermediate buffer larger than the blocks of information you are reading or writing.</span></span> <span data-ttu-id="32cf7-115">Solo tiene acceso al dispositivo cuando el búfer se debe rellenar o escribir en el disco.</span><span class="sxs-lookup"><span data-stu-id="32cf7-115">It accesses the device only when the buffer must be filled from or written to the disk.</span></span>

<span data-ttu-id="32cf7-116">Antes de configurar y usar e/s de archivos almacenados en búfer, debe decidir si desea que el administrador de e/s de archivos o la aplicación asignen el búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-116">Before you set up and use buffered file I/O, you must decide whether you want the file I/O manager or the application to allocate the buffer.</span></span> <span data-ttu-id="32cf7-117">Es más sencillo permitir que el administrador de e/s de archivos asigne el búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-117">It is simpler to let the file I/O manager allocate the buffer.</span></span> <span data-ttu-id="32cf7-118">Sin embargo, puede permitir que la aplicación asigne el búfer si desea tener acceso directo al búfer o abrir un archivo de memoria.</span><span class="sxs-lookup"><span data-stu-id="32cf7-118">However, you can let the application allocate the buffer if you want to directly access the buffer or open a memory file.</span></span> <span data-ttu-id="32cf7-119">Para obtener más información sobre el uso de archivos de memoria, vea [realizar e/s de archivos de memoria](performing-memory-file-i-o.md).</span><span class="sxs-lookup"><span data-stu-id="32cf7-119">For more information about using memory files, see [Performing Memory File I/O](performing-memory-file-i-o.md).</span></span> <span data-ttu-id="32cf7-120">Para obtener un ejemplo de acceso directo a un búfer de e/s, consulte [acceso a un búfer de e/s de archivos](accessing-a-file-i-o-buffer.md)</span><span class="sxs-lookup"><span data-stu-id="32cf7-120">For an example of directly accessing an I/O buffer, see [Accessing a File I/O Buffer](accessing-a-file-i-o-buffer.md)</span></span>

<span data-ttu-id="32cf7-121">Un búfer asignado por el administrador de e/s de archivos se denomina búfer de e/s interno.</span><span class="sxs-lookup"><span data-stu-id="32cf7-121">A buffer allocated by the file I/O manager is called an internal I/O buffer.</span></span> <span data-ttu-id="32cf7-122">Para abrir un archivo para e/s en búfer mediante un búfer interno, especifique la \_ marca ALLOCBUF MMIO al abrir el archivo con la función [**mmioOpen**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioopen) .</span><span class="sxs-lookup"><span data-stu-id="32cf7-122">To open a file for buffered I/O using an internal buffer, specify the MMIO\_ALLOCBUF flag when you open the file with the [**mmioOpen**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioopen) function.</span></span> <span data-ttu-id="32cf7-123">En la ilustración siguiente se muestra el estado inicial del búfer de e/s de archivo después de abrir un archivo para una operación de lectura almacenada en búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-123">The following illustration shows the initial state of the file I/O buffer after a file is opened for a buffered read operation.</span></span> <span data-ttu-id="32cf7-124">El almacenamiento en búfer es transparente: Lee y busca como si estuviera usando e/s no almacenada en búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-124">The buffering is transparent — you read and seek as if you were using unbuffered I/O.</span></span> <span data-ttu-id="32cf7-125">La función **mmioOpen** ha establecido PchNext y *pchEndRead* para que apunten al principio del búfer de e/s de archivo.</span><span class="sxs-lookup"><span data-stu-id="32cf7-125">The **mmioOpen** function has set pchNext and *pchEndRead* to point to the beginning of the file I/O buffer.</span></span>

![Captura de pantalla que muestra "pchEndRead" y "pchNext" que apunta al principio del búfer de e/s de archivo.](images/mmio7.gif)

<span data-ttu-id="32cf7-127">En la ilustración siguiente se muestra el estado inicial del búfer de e/s de archivo después de abrir un archivo para una operación de escritura almacenada en búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-127">The following illustration shows the initial state of the file I/O buffer after a file is opened for a buffered write operation.</span></span> <span data-ttu-id="32cf7-128">La función **mmioOpen** ha establecido **pchNext** para que apunte al principio del búfer de e/s de archivo y **pchEndWrite** para que apunten al final del búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-128">The **mmioOpen** function has set **pchNext** to point to the beginning of the file I/O buffer and **pchEndWrite** to point to the end of the buffer.</span></span>

![Captura de pantalla que muestra "pchNext" al principio del búfer de e/s de archivo y "pchEndWrite" al final.](images/mmio11.gif)

<span data-ttu-id="32cf7-130">El tamaño predeterminado del búfer de e/s interno es de 8 KB.</span><span class="sxs-lookup"><span data-stu-id="32cf7-130">The default size of the internal I/O buffer is 8K.</span></span> <span data-ttu-id="32cf7-131">Si este tamaño no es adecuado, puede usar la función [**mmioSetBuffer**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetbuffer) para cambiar el tamaño del búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-131">If this size is not adequate, you can use the [**mmioSetBuffer**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetbuffer) function to change the buffer size.</span></span> <span data-ttu-id="32cf7-132">También puede usar esta función para habilitar el almacenamiento en búfer en un archivo abierto para e/s sin almacenamiento en búfer, o para proporcionar su propio búfer para su uso como archivo de memoria.</span><span class="sxs-lookup"><span data-stu-id="32cf7-132">You can also use this function to enable buffering on a file opened for unbuffered I/O, or to supply your own buffer for use as a memory file.</span></span>

<span data-ttu-id="32cf7-133">Puede forzar el contenido de un búfer de e/s para que se escriba en el disco mediante la función [**mmioFlush**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioflush) .</span><span class="sxs-lookup"><span data-stu-id="32cf7-133">You can force the contents of an I/O buffer to be written to disk by using the [**mmioFlush**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioflush) function.</span></span> <span data-ttu-id="32cf7-134">Sin embargo, cuando se cierra un archivo mediante la función [**mmioClose**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioclose) , no es necesario llamar a **mmioFlush** para vaciar un búfer de e/s; la función **mmioClose** lo vacía automáticamente.</span><span class="sxs-lookup"><span data-stu-id="32cf7-134">However, when you close a file by using the [**mmioClose**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioclose) function, you do not have to call **mmioFlush** to flush an I/O buffer — the **mmioClose** function automatically flushes it.</span></span> <span data-ttu-id="32cf7-135">Si se queda sin espacio en disco, se puede producir un error en **mmioFlush** , incluso si las llamadas anteriores a la función [**mmioWrite**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiowrite) se realizaron correctamente.</span><span class="sxs-lookup"><span data-stu-id="32cf7-135">If you run out of disk space, **mmioFlush** could fail, even if the preceding calls to the [**mmioWrite**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiowrite) function were successful.</span></span> <span data-ttu-id="32cf7-136">Del mismo modo, **mmioClose** podría producir un error al vaciar su búfer de e/s.</span><span class="sxs-lookup"><span data-stu-id="32cf7-136">Similarly, **mmioClose** could fail when it is flushing its I/O buffer.</span></span>

<span data-ttu-id="32cf7-137">Las aplicaciones que tienen en cuenta el rendimiento, como las que transmiten datos en tiempo real desde un CD-ROM, pueden optimizar el rendimiento de e/s de archivos mediante el acceso directo al búfer de e/s.</span><span class="sxs-lookup"><span data-stu-id="32cf7-137">Applications that are performance-sensitive, such as those that stream data in real time from a CD-ROM, can optimize file I/O performance by directly accessing the I/O buffer.</span></span> <span data-ttu-id="32cf7-138">Tenga cuidado si decide hacerlo, porque omite algunas de las medidas de seguridad y la comprobación de errores que proporciona el administrador de e/s de archivos.</span><span class="sxs-lookup"><span data-stu-id="32cf7-138">You should be careful if you choose to do this, because you bypass some of the safeguards and error checking provided by the file I/O manager.</span></span>

<span data-ttu-id="32cf7-139">El administrador de e/s de archivos multimedia utiliza la estructura [**MMIOINFO**](/previous-versions//dd757322(v=vs.85)) para mantener la información de estado de un archivo abierto.</span><span class="sxs-lookup"><span data-stu-id="32cf7-139">The multimedia file I/O manager uses the [**MMIOINFO**](/previous-versions//dd757322(v=vs.85)) structure to maintain state information about an open file.</span></span> <span data-ttu-id="32cf7-140">Se usan tres miembros en esta estructura para leer y escribir el búfer de e/s: **pchNext**, **pchEndRead** y **pchEndWrite**.</span><span class="sxs-lookup"><span data-stu-id="32cf7-140">You use three members in this structure to read and write the I/O buffer: **pchNext**, **pchEndRead**, and **pchEndWrite**.</span></span> <span data-ttu-id="32cf7-141">El miembro **pchNext** apunta a la siguiente ubicación del búfer que se va a leer o escribir.</span><span class="sxs-lookup"><span data-stu-id="32cf7-141">The **pchNext** member points to the next location in the buffer to read or write.</span></span> <span data-ttu-id="32cf7-142">Debe incrementar este miembro a medida que lee y escribe el búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-142">You must increment this member as you read and write the buffer.</span></span> <span data-ttu-id="32cf7-143">El miembro **pchEndRead** identifica el último carácter válido que se puede leer en el búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-143">The **pchEndRead** member identifies the last valid character you can read from the buffer.</span></span> <span data-ttu-id="32cf7-144">Del mismo modo, este miembro identifica la última ubicación en el búfer que se puede escribir.</span><span class="sxs-lookup"><span data-stu-id="32cf7-144">Likewise, this member identifies the last location in the buffer you can write.</span></span> <span data-ttu-id="32cf7-145">Más concretamente, **pchEndRead** y **pchEndWrite** apuntan a la ubicación de memoria que sigue los últimos datos válidos en el búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-145">More precisely, both **pchEndRead** and **pchEndWrite** point to the memory location that follows the last valid data in the buffer.</span></span> <span data-ttu-id="32cf7-146">Use las funciones [**mmioGetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiogetinfo) y [**mmioSetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetinfo) para recuperar y establecer información de estado sobre el búfer de e/s de archivos.</span><span class="sxs-lookup"><span data-stu-id="32cf7-146">Use the [**mmioGetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiogetinfo) and [**mmioSetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetinfo) functions to retrieve and set state information about the file I/O buffer.</span></span> <span data-ttu-id="32cf7-147">En la ilustración siguiente se muestra el estado del búfer de e/s después de que la aplicación llame a **mmioAdvance** durante una operación de lectura.</span><span class="sxs-lookup"><span data-stu-id="32cf7-147">The following illustration shows the state of the I/O buffer after the application calls **mmioAdvance** during a read operation.</span></span> <span data-ttu-id="32cf7-148">La función **mmioAdvance** rellena el búfer y establece el puntero **pchEndRead** al final del búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-148">The **mmioAdvance** function fills the buffer and sets the **pchEndRead** pointer to the end of the buffer.</span></span>

![Captura de pantalla que muestra "pchNext" al principio del búfer de e/s de archivo y "pchEndRead" al final.](images/mmio8.gif)

<span data-ttu-id="32cf7-150">En la ilustración siguiente, la aplicación Lee del búfer de e/s en la ubicación especificada por **pchNext** y hace avanzar el puntero.</span><span class="sxs-lookup"><span data-stu-id="32cf7-150">In the following illustration, the application reads from the I/O buffer at the location specified by **pchNext**, and advances the pointer.</span></span>

![Captura de pantalla que muestra "pchNext" en medio del búfer de e/s de archivo y "pchEndRead" al final.](images/mmio9.gif)

<span data-ttu-id="32cf7-152">Del mismo modo, para una operación de escritura, la aplicación escribe en el búfer de e/s y avanza el puntero **pchNext** , como se muestra en la siguiente ilustración.</span><span class="sxs-lookup"><span data-stu-id="32cf7-152">Similarly, for a write operation, the application writes to the I/O buffer and advances the **pchNext** pointer, as shown in the following illustration.</span></span>

![Captura de pantalla que muestra "pchNext" en medio del búfer de e/s de archivo y "pchEndWrite" al final.](images/mmio12.gif)

<span data-ttu-id="32cf7-154">Una vez que la aplicación rellena el búfer, llama a **mmioAdvance** para vaciar el búfer en el disco.</span><span class="sxs-lookup"><span data-stu-id="32cf7-154">After the application fills the buffer, it calls **mmioAdvance** to flush the buffer to disk.</span></span> <span data-ttu-id="32cf7-155">La función **mmioAdvance** restablece **pchNext** para que apunte al principio del búfer, tal y como se muestra en la siguiente ilustración.</span><span class="sxs-lookup"><span data-stu-id="32cf7-155">The **mmioAdvance** function resets **pchNext** to point to the beginning of the buffer, as shown in the following illustration.</span></span>

![Captura de pantalla que muestra "pchNext" al principio del búfer de e/s de archivo, el búfer en medio de E O F y "pchEndWrite" al final del búfer.](images/mmio13.gif)

<span data-ttu-id="32cf7-157">Cuando llegue al final del búfer de e/s, debe avanzar el búfer para rellenarlo desde el disco, si está leyendo o vaciarlo en el disco, si está escribiendo.</span><span class="sxs-lookup"><span data-stu-id="32cf7-157">When you reach the end of the I/O buffer, you must advance the buffer to fill it from the disk, if you are reading, or flush it to the disk, if you are writing.</span></span> <span data-ttu-id="32cf7-158">Use la función [**mmioAdvance**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioadvance) para avanzar un búfer de e/s.</span><span class="sxs-lookup"><span data-stu-id="32cf7-158">Use the [**mmioAdvance**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioadvance) function to advance an I/O buffer.</span></span> <span data-ttu-id="32cf7-159">Para rellenar un búfer de e/s desde el disco, use **mmioAdvance** con la marca de lectura de MMIO \_ .</span><span class="sxs-lookup"><span data-stu-id="32cf7-159">To fill an I/O buffer from disk, use **mmioAdvance** with the MMIO\_READ flag.</span></span> <span data-ttu-id="32cf7-160">Si no quedan suficientes datos en el archivo para rellenar el búfer, el miembro **pchEndRead** de la estructura **MMIOINFO** apunta a la ubicación siguiente al último byte válido del búfer.</span><span class="sxs-lookup"><span data-stu-id="32cf7-160">If there is not enough data remaining in the file to fill the buffer, the **pchEndRead** member of the **MMIOINFO** structure points to the location following the last valid byte in the buffer.</span></span> <span data-ttu-id="32cf7-161">Para vaciar un búfer en el disco, establezca la \_ marca MMIO Dirty en el miembro **dwFlags** de la estructura **MMIOINFO** y, a continuación, llame a **MMIOADVANCE** con la marca de \_ escritura mmio.</span><span class="sxs-lookup"><span data-stu-id="32cf7-161">To flush a buffer to disk, set the MMIO\_DIRTY flag in the **dwFlags** member of the **MMIOINFO** structure and then call **mmioAdvance** with the MMIO\_WRITE flag.</span></span>

<span data-ttu-id="32cf7-162">Por ejemplo, durante una operación de lectura, la función **mmioAdvance** establece **pchEndRead** para que señale al final de los datos válidos en el búfer, tal como se muestra en la siguiente ilustración.</span><span class="sxs-lookup"><span data-stu-id="32cf7-162">For example, during a read operation, the **mmioAdvance** function sets **pchEndRead** to point to the end of valid data in the buffer, as shown in the following illustration.</span></span>

![Captura de pantalla que muestra "pchNext" al principio del búfer de e/s de archivo, el búfer al final de E O F y "pchEndRead" al final del búfer.](images/mmio10.gif)

<span data-ttu-id="32cf7-164">Del mismo modo, durante una operación de escritura, la aplicación llama a **mmioAdvance** para vaciar el búfer y avanzar **pchNext** hasta el final de los datos válidos en el búfer, tal y como se muestra en la siguiente ilustración.</span><span class="sxs-lookup"><span data-stu-id="32cf7-164">Similarly, during a write operation, the application calls **mmioAdvance** to flush the buffer and advance **pchNext** to the end of valid data in the buffer, as shown in the following illustration.</span></span>

![imagen de búfer de e/s de archivo](images/mmio14.gif)

 

 