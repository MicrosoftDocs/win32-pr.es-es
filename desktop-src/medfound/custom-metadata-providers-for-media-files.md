---
description: En este tema se describe cómo escribir un controlador de propiedades de Shell personalizado para un Microsoft Media Foundation origen de medios.
ms.assetid: f8cf70ff-8324-4308-8adf-a145aa351ca9
title: Proveedores de metadatos personalizados para archivos multimedia
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a2ded77492d03f7b802f6b2f9c25e1009ef97f50
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "105721345"
---
# <a name="custom-metadata-providers-for-media-files"></a><span data-ttu-id="164ac-103">Proveedores de metadatos personalizados para archivos multimedia</span><span class="sxs-lookup"><span data-stu-id="164ac-103">Custom Metadata Providers for Media Files</span></span>

<span data-ttu-id="164ac-104">En este tema se describe cómo escribir un controlador de propiedades de Shell personalizado para un Microsoft Media Foundation origen de medios.</span><span class="sxs-lookup"><span data-stu-id="164ac-104">This topic describes how to write a custom Shell property handler for a Microsoft Media Foundation media source.</span></span>

> [!Note]  
> <span data-ttu-id="164ac-105">Para obtener información general sobre los proveedores de metadatos en Media Foundation, vea [metadatos de medios](media-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="164ac-105">For background information about metadata providers in Media Foundation, see [Media Metadata](media-metadata.md).</span></span> <span data-ttu-id="164ac-106">En este tema se describen los controladores de propiedades de Shell. no describe la interfaz de metadatos de la versión 1, [**IMFMetadata**](/windows/desktop/api/mfidl/nn-mfidl-imfmetadata).</span><span class="sxs-lookup"><span data-stu-id="164ac-106">This topic discusses Shell property handlers; it does not describe the version 1 metadata interface, [**IMFMetadata**](/windows/desktop/api/mfidl/nn-mfidl-imfmetadata).</span></span>

 

<span data-ttu-id="164ac-107">Los metadatos están estrechamente relacionados con el formato del archivo.</span><span class="sxs-lookup"><span data-stu-id="164ac-107">Metadata is closely tied to the format of the file.</span></span> <span data-ttu-id="164ac-108">En Media Foundation, los formatos de archivo se representan mediante orígenes multimedia.</span><span class="sxs-lookup"><span data-stu-id="164ac-108">In Media Foundation, file formats are represented by media sources.</span></span> <span data-ttu-id="164ac-109">Si desea admitir los metadatos de un formato que no se admite de forma nativa en Media Foundation, debe implementar un origen de medios personalizado con un controlador de propiedades.</span><span class="sxs-lookup"><span data-stu-id="164ac-109">If you want to support metadata for a format that is not supported natively in Media Foundation, you must implement a custom media source with a property handler.</span></span> <span data-ttu-id="164ac-110">El controlador de propiedades permite que el sistema de propiedades de Shell Lea y escriba los metadatos de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="164ac-110">The property handler enables the Shell property system to read and write metadata efficiently.</span></span>

<span data-ttu-id="164ac-111">Un controlador de propiedades es un objeto COM que implementa las interfaces siguientes:</span><span class="sxs-lookup"><span data-stu-id="164ac-111">A property handler is a COM object that implements the following interfaces:</span></span>

-   [<span data-ttu-id="164ac-112">**IInitializeWithStream**</span><span class="sxs-lookup"><span data-stu-id="164ac-112">**IInitializeWithStream**</span></span>](/windows/win32/api/propsys/nn-propsys-iinitializewithstream)
-   [<span data-ttu-id="164ac-113">**IPropertyStore**</span><span class="sxs-lookup"><span data-stu-id="164ac-113">**IPropertyStore**</span></span>](/windows/win32/api/propsys/nn-propsys-ipropertystore)

<span data-ttu-id="164ac-114">Opcionalmente, también puede exponer la siguiente interfaz:</span><span class="sxs-lookup"><span data-stu-id="164ac-114">Optionally, it can also expose the following interface:</span></span>

-   [<span data-ttu-id="164ac-115">**IPropertyStoreCapabilities**</span><span class="sxs-lookup"><span data-stu-id="164ac-115">**IPropertyStoreCapabilities**</span></span>](/windows/win32/api/propsys/nn-propsys-ipropertystorecapabilities)

<span data-ttu-id="164ac-116">Si el sistema de propiedades de Shell necesita obtener los metadatos de un archivo, llama a [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para crear el controlador de propiedades y, a continuación, llama a los métodos de lectura y escritura adecuados en la interfaz [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) .</span><span class="sxs-lookup"><span data-stu-id="164ac-116">If the Shell property system needs to get metadata for a file, it calls [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the property handler and then calls the appropriate read and write methods on the [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) interface.</span></span>

<span data-ttu-id="164ac-117">La canalización Media Foundation usa un mecanismo ligeramente diferente, porque la canalización obtiene el controlador de propiedades directamente del origen de los medios.</span><span class="sxs-lookup"><span data-stu-id="164ac-117">The Media Foundation pipeline uses a slightly different mechanism, because the pipeline gets the property handler directly from the media source.</span></span> <span data-ttu-id="164ac-118">En lugar de llamar a [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para crear el controlador de propiedades, la canalización llama a [**IMFGetService:: GetService**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) en el origen multimedia, como se describe en el tema sobre los [proveedores de metadatos de Shell](shell-metadata-providers.md).</span><span class="sxs-lookup"><span data-stu-id="164ac-118">Instead of calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the property handler, the pipeline calls [**IMFGetService::GetService**](/windows/desktop/api/mfidl/nf-mfidl-imfgetservice-getservice) on the media source, as described in the topic [Shell Metadata Providers](shell-metadata-providers.md).</span></span>

<span data-ttu-id="164ac-119">Para crear un controlador de propiedades personalizado, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="164ac-119">To create a custom property handler, do the following:</span></span>

-   <span data-ttu-id="164ac-120">Implemente la interfaz [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) para exponer [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span><span class="sxs-lookup"><span data-stu-id="164ac-120">Implement the [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) interface to expose [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore).</span></span> <span data-ttu-id="164ac-121">El GUID del servicio es el **\_ servicio de \_ controlador \_ de propiedades MF**.</span><span class="sxs-lookup"><span data-stu-id="164ac-121">The service GUID is **MF\_PROPERTY\_HANDLER\_SERVICE**.</span></span>
-   <span data-ttu-id="164ac-122">Si el origen multimedia se va a usar de forma remota, también debe exponer la interfaz [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) a través del método **QueryInterface** del origen multimedia, además de [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice).</span><span class="sxs-lookup"><span data-stu-id="164ac-122">If the media source will be used remotely, it must also expose the [**IPropertyStore**](/windows/win32/api/propsys/nn-propsys-ipropertystore) interface through the media source's **QueryInterface** method, in addition to [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice).</span></span>
-   <span data-ttu-id="164ac-123">Para que el controlador de propiedades esté disponible para el sistema de propiedades de Shell, registre el archivo DLL del controlador de propiedades tal y como se describe en [registrar y distribuir controladores de propiedades](../properties/prophand-reg-dist.md).</span><span class="sxs-lookup"><span data-stu-id="164ac-123">To make the property handler available to the Shell property system, register the DLL for the property handler as described in [Registering and Distributing Property Handlers](../properties/prophand-reg-dist.md).</span></span>
-   <span data-ttu-id="164ac-124">El origen multimedia se registra por separado, tal y como se describe en [controladores de esquema y controladores de Byte-Stream](scheme-handlers-and-byte-stream-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="164ac-124">The media source is registered separately, as described in [Scheme Handlers and Byte-Stream Handlers](scheme-handlers-and-byte-stream-handlers.md).</span></span>

### <a name="implementation-tips"></a><span data-ttu-id="164ac-125">Sugerencias de implementación</span><span class="sxs-lookup"><span data-stu-id="164ac-125">Implementation Tips</span></span>

<span data-ttu-id="164ac-126">Para obtener una lista de las claves de propiedad de metadatos, consulte [propiedades de metadatos para archivos multimedia](metadata-properties-for-media-files.md).</span><span class="sxs-lookup"><span data-stu-id="164ac-126">For a list of metadata property keys, see [Metadata Properties for Media Files](metadata-properties-for-media-files.md).</span></span>

<span data-ttu-id="164ac-127">Los controladores de propiedades deben ser rápidos; deben proporcionar acceso de lectura y escritura eficaz a los metadatos.</span><span class="sxs-lookup"><span data-stu-id="164ac-127">Property handlers must be fast; they must provide efficient read and write access to the metadata.</span></span> <span data-ttu-id="164ac-128">(Tenga en cuenta que el shell puede recuperar metadatos de cientos de archivos). Por lo tanto, no llame a [**MFStartup**](/windows/desktop/api/mfapi/nf-mfapi-mfstartup) desde el controlador de propiedad.</span><span class="sxs-lookup"><span data-stu-id="164ac-128">(Consider that the Shell may retrieve metadata from hundreds of files.) Therefore, do not call [**MFStartup**](/windows/desktop/api/mfapi/nf-mfapi-mfstartup) from your property handler.</span></span> <span data-ttu-id="164ac-129">La función **MFStartup** introduce la latencia de inicio, ya que crea varios subprocesos de cola de trabajo y asigna memoria global.</span><span class="sxs-lookup"><span data-stu-id="164ac-129">The **MFStartup** function introduces startup latency, because it creates multiple work-queue threads and allocates global memory.</span></span>

<span data-ttu-id="164ac-130">En una implementación típica, el controlador de propiedades y el origen multimedia compartirán parte del mismo código de análisis.</span><span class="sxs-lookup"><span data-stu-id="164ac-130">In a typical implementation, the property handler and the media source will share some of the same parsing code.</span></span> <span data-ttu-id="164ac-131">Sin embargo, un origen multimedia usa llamadas asincrónicas de [**IMFByteStream**](/windows/desktop/api/mfobjects/nn-mfobjects-imfbytestream) para e/s, mientras que el controlador de propiedades utiliza la interfaz [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="164ac-131">However, a media source uses asynchronous [**IMFByteStream**](/windows/desktop/api/mfobjects/nn-mfobjects-imfbytestream) calls for I/O, whereas the property handler uses the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="164ac-132">Media Foundation proporciona un objeto auxiliar que contiene una secuencia basada en **IStream** y la expone como una secuencia **IMFByteStream** .</span><span class="sxs-lookup"><span data-stu-id="164ac-132">Media Foundation provides a helper object that wraps an **IStream**-based stream and exposes it as an **IMFByteStream** stream.</span></span> <span data-ttu-id="164ac-133">Para crear el contenedor, llame a [**MFCreateMFByteStreamOnStream**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatemfbytestreamonstream).</span><span class="sxs-lookup"><span data-stu-id="164ac-133">To create the wrapper, call [**MFCreateMFByteStreamOnStream**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatemfbytestreamonstream).</span></span>

<span data-ttu-id="164ac-134">Al actualizar los metadatos, se recomienda escribir los datos directamente en la secuencia original.</span><span class="sxs-lookup"><span data-stu-id="164ac-134">When updating metadata, it is recommended to write the data directly to the original stream.</span></span> <span data-ttu-id="164ac-135">Esta recomendación difiere del comportamiento de *copia en escritura* de la mayoría de los controladores de propiedades, en los que se modifica una copia de los datos.</span><span class="sxs-lookup"><span data-stu-id="164ac-135">This recommendation differs from the *copy-on-write* behavior of most property handlers, in which a copy of the data is modified.</span></span> <span data-ttu-id="164ac-136">Los archivos multimedia pueden ser muy grandes, por lo que la copia en escritura suele ser demasiado lenta para una implementación eficaz.</span><span class="sxs-lookup"><span data-stu-id="164ac-136">Media files can be very large, so copy-on-write is typically too slow for an efficient implementation.</span></span> <span data-ttu-id="164ac-137">Para deshabilitar la opción de copia en escritura, establezca el valor del registro **ManualSafeSave** , como se describe en [registrar y distribuir controladores de propiedades](../properties/prophand-reg-dist.md).</span><span class="sxs-lookup"><span data-stu-id="164ac-137">To disable copy-on-write, set the **ManualSafeSave** registry setting, as described in [Registering and Distributing Property Handlers](../properties/prophand-reg-dist.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="164ac-138">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="164ac-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="164ac-139">Metadatos de medios</span><span class="sxs-lookup"><span data-stu-id="164ac-139">Media Metadata</span></span>](media-metadata.md)
</dt> <dt>

[<span data-ttu-id="164ac-140">Orígenes multimedia</span><span class="sxs-lookup"><span data-stu-id="164ac-140">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="164ac-141">Escritura de un origen de medios personalizado</span><span class="sxs-lookup"><span data-stu-id="164ac-141">Writing a Custom Media Source</span></span>](writing-a-custom-media-source.md)
</dt> </dl>

 

 
