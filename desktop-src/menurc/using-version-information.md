---
title: Usar información de versión
description: En este tema se describe cómo utilizar las funciones de información de versión.
ms.assetid: 447b57c9-9e94-4a28-897e-f7b87d9cb25a
keywords:
- recursos, información de versión
- información de versión
- información del archivo de instalación
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a8785275f5aac69218989250d1c0f83e0a1ff9f
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "103790240"
---
# <a name="using-version-information"></a><span data-ttu-id="43262-106">Usar información de versión</span><span class="sxs-lookup"><span data-stu-id="43262-106">Using Version Information</span></span>

<span data-ttu-id="43262-107">Un programa de instalación normalmente tiene los siguientes objetivos:</span><span class="sxs-lookup"><span data-stu-id="43262-107">An installation program typically has the following goals:</span></span>

-   <span data-ttu-id="43262-108">Para colocar los archivos en la ubicación correcta.</span><span class="sxs-lookup"><span data-stu-id="43262-108">To place files in the correct location.</span></span>
-   <span data-ttu-id="43262-109">Para notificar al usuario si el programa de instalación está reemplazando un archivo existente por una versión que es significativamente diferente, por ejemplo, reemplazando un archivo de idioma alemán por un archivo de idioma inglés o reemplazando un archivo más reciente por un archivo más antiguo.</span><span class="sxs-lookup"><span data-stu-id="43262-109">To notify the user if the installation program is replacing an existing file with a version that is significantly different—for example, replacing a German-language file with an English-language file, or replacing a newer file with an older file.</span></span>

<span data-ttu-id="43262-110">Al escribir el programa de instalación, debe tener la siguiente información para cada archivo:</span><span class="sxs-lookup"><span data-stu-id="43262-110">When writing the installation program, you must have the following information for each file:</span></span>

-   <span data-ttu-id="43262-111">El nombre y la ubicación del archivo (denominado archivo de código fuente).</span><span class="sxs-lookup"><span data-stu-id="43262-111">The name and location of the file (referred to as the source file).</span></span>
-   <span data-ttu-id="43262-112">El nombre del archivo equivalente en el disco duro del usuario (denominado archivo de destino).</span><span class="sxs-lookup"><span data-stu-id="43262-112">The name of the equivalent file on the user's hard disk (referred to as the destination file).</span></span> <span data-ttu-id="43262-113">Este nombre suele ser el mismo que el nombre de archivo del disco de instalación.</span><span class="sxs-lookup"><span data-stu-id="43262-113">This name is usually the same as the filename on the installation disk.</span></span>
-   <span data-ttu-id="43262-114">El estado de uso compartido del archivo, es decir, si el archivo es privado para la aplicación que se está instalando o puede ser compartido por varias aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="43262-114">The sharing status of the file—that is, whether the file is private to the application being installed or could be shared by multiple applications.</span></span>

<span data-ttu-id="43262-115">El programa de instalación puede usar la función [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) para determinar dónde se debe copiar el archivo en el disco.</span><span class="sxs-lookup"><span data-stu-id="43262-115">The installation program can use the [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) function to determine where the file should be copied on the disk.</span></span> <span data-ttu-id="43262-116">Esta función también se puede usar para especificar si el archivo es privado para la aplicación o se puede compartir.</span><span class="sxs-lookup"><span data-stu-id="43262-116">This function can also be used to specify whether the file is private to the application or can be shared.</span></span> <span data-ttu-id="43262-117">Si se produce un problema al buscar el archivo, **VerFindFile** devuelve un valor de error.</span><span class="sxs-lookup"><span data-stu-id="43262-117">If a problem occurs in finding the file, **VerFindFile** returns an error value.</span></span> <span data-ttu-id="43262-118">Por ejemplo, si el sistema usa el archivo de destino, **VerFindFile** devuelve **VFF \_ FILEINUSE**.</span><span class="sxs-lookup"><span data-stu-id="43262-118">For example, if the system is using the destination file, **VerFindFile** returns **VFF\_FILEINUSE**.</span></span> <span data-ttu-id="43262-119">El programa de instalación debe notificar al usuario el problema y responder a la decisión del usuario de continuar o finalizar la instalación.</span><span class="sxs-lookup"><span data-stu-id="43262-119">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="43262-120">La función [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) copia el archivo de código fuente en un archivo temporal en el directorio especificado por [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span><span class="sxs-lookup"><span data-stu-id="43262-120">The [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) function copies the source file to a temporary file in the directory specified by [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span></span> <span data-ttu-id="43262-121">Si es necesario, **VerInstallFile** expande el archivo con las funciones de la biblioteca de descompresión de datos.</span><span class="sxs-lookup"><span data-stu-id="43262-121">If necessary, **VerInstallFile** expands the file by using the functions in the data decompression library.</span></span>

<span data-ttu-id="43262-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compara la información de versión del archivo temporal con la del archivo de destino.</span><span class="sxs-lookup"><span data-stu-id="43262-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compares the version information of the temporary file to that of the destination file.</span></span> <span data-ttu-id="43262-123">Si los dos son diferentes, **VerInstallFile** devuelve uno o varios valores de error.</span><span class="sxs-lookup"><span data-stu-id="43262-123">If the two differ, **VerInstallFile** returns one or more error values.</span></span> <span data-ttu-id="43262-124">Por ejemplo, devuelve **VIF \_ SRCOLD** si el archivo temporal es más antiguo que el archivo de destino y **VIF \_ DIFFLANG** si los archivos tienen diferentes identificadores de idioma o valores de página de códigos.</span><span class="sxs-lookup"><span data-stu-id="43262-124">For example, it returns **VIF\_SRCOLD** if the temporary file is older than the destination file and **VIF\_DIFFLANG** if the files have different language identifiers or code-page values.</span></span> <span data-ttu-id="43262-125">El programa de instalación debe notificar al usuario el problema y responder a la decisión del usuario de continuar o finalizar la instalación.</span><span class="sxs-lookup"><span data-stu-id="43262-125">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="43262-126">Algunos errores de [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) son recuperables.</span><span class="sxs-lookup"><span data-stu-id="43262-126">Some [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) errors are recoverable.</span></span> <span data-ttu-id="43262-127">Es decir, el programa de instalación puede volver a llamar a **VerInstallFile** , especificando la opción **VIFF \_ FORCEINSTALL** , para instalar el archivo independientemente del conflicto de versiones.</span><span class="sxs-lookup"><span data-stu-id="43262-127">That is, the installation program can call **VerInstallFile** again, specifying the **VIFF\_FORCEINSTALL** option, to install the file regardless of the version conflict.</span></span> <span data-ttu-id="43262-128">Si **VerInstallFile** devuelve **VIF \_ TEMPFILE** y el usuario decide no forzar la instalación, el programa de instalación debe eliminar el archivo temporal.</span><span class="sxs-lookup"><span data-stu-id="43262-128">If **VerInstallFile** returns **VIF\_TEMPFILE** and the user chooses not to force the installation, the installation program should delete the temporary file.</span></span>

<span data-ttu-id="43262-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) podría encontrar un error irrecuperable al intentar forzar la instalación, aunque el error no existía anteriormente.</span><span class="sxs-lookup"><span data-stu-id="43262-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) could encounter a nonrecoverable error when attempting to force installation, even though the error did not exist previously.</span></span> <span data-ttu-id="43262-130">Por ejemplo, el archivo podría estar bloqueado por otro usuario antes de que el programa de instalación intentara forzar la instalación.</span><span class="sxs-lookup"><span data-stu-id="43262-130">For example, the file could be locked by another user before the installation program attempted to force installation.</span></span> <span data-ttu-id="43262-131">Si un programa de instalación intenta forzar la instalación después de un error no recuperable, **VerInstallFile** produce un error.</span><span class="sxs-lookup"><span data-stu-id="43262-131">If an installation program attempts to force installation after a non-recoverable error, **VerInstallFile** fails.</span></span> <span data-ttu-id="43262-132">El programa de instalación debe contener rutinas para recuperarse de este tipo de error.</span><span class="sxs-lookup"><span data-stu-id="43262-132">The installation program must contain routines to recover from this type of error.</span></span>

<span data-ttu-id="43262-133">La solución recomendada es mostrar un cuadro de diálogo con los botones **instalar**, **omitir** e **instalar todo**.</span><span class="sxs-lookup"><span data-stu-id="43262-133">The recommended solution is to display a dialog box with the buttons **Install**, **Skip**, and **Install All**.</span></span> <span data-ttu-id="43262-134">(Otra solución es un cuadro de diálogo con los botones **sí**, **sí a todo**, **omitir** y **Cancelar**). El botón **instalar todo** debe evitar que el programa de instalación solicite al usuario errores similares al incluir la opción **VIFF \_ FORCEINSTALL** en todos los usos subsiguientes de [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span><span class="sxs-lookup"><span data-stu-id="43262-134">(Another solution is a dialog box with the buttons **Yes**, **Yes to All**, **Skip**, and **Cancel**.) The **Install All** button should prevent the installation program from prompting the user about similar errors by including the **VIFF\_FORCEINSTALL** option in all subsequent uses of [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span></span> <span data-ttu-id="43262-135">En el caso de los errores irrecuperables, se deben deshabilitar los botones **instalar** e **instalar todos** .</span><span class="sxs-lookup"><span data-stu-id="43262-135">For nonrecoverable errors, the **Install** and **Install All** buttons should be disabled.</span></span>

<span data-ttu-id="43262-136">Para mostrar un mensaje de error útil al usuario, el programa de instalación normalmente debe recuperar información de los recursos de versión de los archivos en conflicto.</span><span class="sxs-lookup"><span data-stu-id="43262-136">To display a useful error message to the user, the installation program usually must retrieve information from the version resources of the conflicting files.</span></span> <span data-ttu-id="43262-137">Hay cuatro funciones que el programa de instalación puede usar para este propósito:</span><span class="sxs-lookup"><span data-stu-id="43262-137">There are four functions the installation program can use for this purpose:</span></span>

-   [<span data-ttu-id="43262-138">**GetFileVersionInfoSize**</span><span class="sxs-lookup"><span data-stu-id="43262-138">**GetFileVersionInfoSize**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea)
-   [<span data-ttu-id="43262-139">**GetFileVersionInfo**</span><span class="sxs-lookup"><span data-stu-id="43262-139">**GetFileVersionInfo**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)
-   [<span data-ttu-id="43262-140">**VerQueryValue**</span><span class="sxs-lookup"><span data-stu-id="43262-140">**VerQueryValue**</span></span>](/windows/desktop/api/Winver/nf-winver-verqueryvaluea)
-   [<span data-ttu-id="43262-141">**VerLanguageName**</span><span class="sxs-lookup"><span data-stu-id="43262-141">**VerLanguageName**</span></span>](/windows/desktop/api/Winver/nf-winver-verlanguagenamea)

<span data-ttu-id="43262-142">[**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) devuelve el tamaño de la información de versión.</span><span class="sxs-lookup"><span data-stu-id="43262-142">[**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) returns the size of the version information.</span></span> <span data-ttu-id="43262-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) usa la información recuperada por **GetFileVersionInfoSize** para recuperar una estructura que contiene la información de versión.</span><span class="sxs-lookup"><span data-stu-id="43262-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) uses information retrieved by **GetFileVersionInfoSize** to retrieve a structure that contains the version information.</span></span> <span data-ttu-id="43262-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) recupera un miembro específico de esa estructura.</span><span class="sxs-lookup"><span data-stu-id="43262-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) retrieves a specific member from that structure.</span></span>

<span data-ttu-id="43262-145">Por ejemplo, si [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) devuelve el **error \_ VIF DIFFTYPE** , el programa de instalación debe usar las funciones [**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)y [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) en los archivos temporales y de destino para obtener el tipo general de cada archivo.</span><span class="sxs-lookup"><span data-stu-id="43262-145">For example, if [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns the **VIF\_DIFFTYPE** error, the installation program should use the [**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa), and [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) functions on the temporary and destination files to obtain the general type of each file.</span></span> <span data-ttu-id="43262-146">Si los idiomas de los archivos entran en conflicto, el programa de instalación también debe utilizar [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) para traducir el identificador de idioma binario en una representación de texto del idioma.</span><span class="sxs-lookup"><span data-stu-id="43262-146">If the languages of the files conflict, the installation program should also use [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) to translate the binary language identifier into a text representation of the language.</span></span> <span data-ttu-id="43262-147">(Por ejemplo, 0x040C se convierte en la cadena "francés").</span><span class="sxs-lookup"><span data-stu-id="43262-147">(For example, 0x040C translates to the string "French.")</span></span>

<span data-ttu-id="43262-148">Si [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) devuelve un error de archivo, como **VIF \_ ACCESSVIOLATION**, el programa de instalación debe usar la función [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) para recuperar el valor de error más reciente.</span><span class="sxs-lookup"><span data-stu-id="43262-148">If [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns a file error, such as **VIF\_ACCESSVIOLATION**, the installation program should use the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to retrieve the most recent error value.</span></span> <span data-ttu-id="43262-149">El programa debe convertir este valor en un mensaje informativo para mostrar al usuario.</span><span class="sxs-lookup"><span data-stu-id="43262-149">The program should translate this value into an informative message to display to the user.</span></span> <span data-ttu-id="43262-150">El programa no debe proporcionar el control entre las llamadas a **VerInstallFile** y **GetLastError**.</span><span class="sxs-lookup"><span data-stu-id="43262-150">The program must not yield control between the calls to **VerInstallFile** and **GetLastError**.</span></span>

 

 