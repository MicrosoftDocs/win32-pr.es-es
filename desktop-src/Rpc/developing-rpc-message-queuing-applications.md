---
title: Desarrollo de aplicaciones de RPC-Message Queue Server
description: Es necesario muy poco esfuerzo para aprovechar el transporte de MSMQ en la aplicación RPC.
ms.assetid: 1ea97df8-cdf5-43b8-88aa-9e8fa6ae845a
keywords:
- RPC llamada a procedimiento remoto, tareas, desarrollar aplicaciones de Message Queue Server
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f3e51707c0a6903200e51dd35e50e998430c8eae
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104078258"
---
# <a name="developing-rpc-message-queuing-applications"></a><span data-ttu-id="21e13-104">Desarrollo de aplicaciones de RPC-Message Queue Server</span><span class="sxs-lookup"><span data-stu-id="21e13-104">Developing RPC-Message Queuing Applications</span></span>

<span data-ttu-id="21e13-105">Es necesario muy poco esfuerzo para aprovechar el transporte de MSMQ en la aplicación RPC.</span><span class="sxs-lookup"><span data-stu-id="21e13-105">Very little effort is necessary to take advantage of the MSMQ transport in your RPC application.</span></span> <span data-ttu-id="21e13-106">En el caso de la mensajería sincrónica, solo es necesario especificar el transporte de la cola de mensajes ([**ncadg \_ MQ**](/windows/desktop/Midl/ncadg-mq)) como la secuencia de protocolos.</span><span class="sxs-lookup"><span data-stu-id="21e13-106">For synchronous messaging you need only specify the message queue transport ([**ncadg\_mq**](/windows/desktop/Midl/ncadg-mq)) as the protocol sequence.</span></span> <span data-ttu-id="21e13-107">El **Protocolo \_ MQ de ncadg** admite todas las características de datagramas estándar, excepto las llamadas de difusión.</span><span class="sxs-lookup"><span data-stu-id="21e13-107">The **ncadg\_mq** protocol supports all of the standard datagram features except broadcasting calls.</span></span> <span data-ttu-id="21e13-108">Además, tenga en cuenta que, actualmente, el transporte de cola de mensajes no admite puntos de conexión dinámicos.</span><span class="sxs-lookup"><span data-stu-id="21e13-108">Also, note that currently the message-queue transport does not support dynamic endpoints.</span></span>

<span data-ttu-id="21e13-109">Al aplicar el \[ [](/windows/desktop/Midl/message) \] atributo Message a las declaraciones de procedimiento remoto en el archivo IDL, se implementa automáticamente Message Queue Server para esas llamadas.</span><span class="sxs-lookup"><span data-stu-id="21e13-109">By applying the \[[**message**](/windows/desktop/Midl/message)\] attribute to remote procedure declarations in the IDL file, you automatically implement asynchronous-mode message queuing for those calls.</span></span> <span data-ttu-id="21e13-110">Esto permite que las aplicaciones cliente y servidor controlen muchas de las propiedades asociadas a mensajes y colas de mensajes, entre las que se incluyen:</span><span class="sxs-lookup"><span data-stu-id="21e13-110">This makes it possible for the client and server applications to control many of the properties associated with messages and message queues, including:</span></span>

-   <span data-ttu-id="21e13-111">Calidad de servicio</span><span class="sxs-lookup"><span data-stu-id="21e13-111">Quality of service</span></span>
-   <span data-ttu-id="21e13-112">Confirmación de recepción</span><span class="sxs-lookup"><span data-stu-id="21e13-112">Acknowledgment of receipt</span></span>
-   <span data-ttu-id="21e13-113">Registro en diario</span><span class="sxs-lookup"><span data-stu-id="21e13-113">Journaling</span></span>
-   <span data-ttu-id="21e13-114">Prioridad de llamada</span><span class="sxs-lookup"><span data-stu-id="21e13-114">Call priority</span></span>
-   <span data-ttu-id="21e13-115">Persistencia de la cola de procesos del servidor</span><span class="sxs-lookup"><span data-stu-id="21e13-115">Persistence of Server Process Queue</span></span>

<span data-ttu-id="21e13-116">La calidad de servicio es el esfuerzo que realizará el transporte para proporcionar la llamada al proceso de servidor.</span><span class="sxs-lookup"><span data-stu-id="21e13-116">Quality of service is the effort that the transport will make to deliver the call to the server process.</span></span> <span data-ttu-id="21e13-117">Una entrega rápida se pondrá en cola en la memoria, por lo que es bastante rápida, pero se perderá la llamada si un equipo o una conexión de red deja de funcionar en el momento equivocado.</span><span class="sxs-lookup"><span data-stu-id="21e13-117">An express delivery will be queued in memory, so it is fairly fast, but the call will be lost if a computer or network connection goes down at the wrong time.</span></span> <span data-ttu-id="21e13-118">Una entrega recuperable se publicará en un archivo de disco hasta que se entregue, por lo que no se perderá la llamada, incluso en caso de que se produzca un bloqueo del equipo.</span><span class="sxs-lookup"><span data-stu-id="21e13-118">A recoverable delivery will be posted to a disk file until it is delivered, so the call will not be lost, even in the face of a computer crash.</span></span> <span data-ttu-id="21e13-119">Esto proporciona una entrega garantizada, pero a un costo de rendimiento, ya que cada llamada se escribe en el disco.</span><span class="sxs-lookup"><span data-stu-id="21e13-119">This gives guaranteed delivery, but at a cost in performance as each call is written to disk.</span></span>

<span data-ttu-id="21e13-120">También puede indicar al transporte de MSMQ que espere la confirmación de que la llamada llegó a la cola de destino (servidor) antes de devolver.</span><span class="sxs-lookup"><span data-stu-id="21e13-120">You can also tell the MSMQ transport to wait for acknowledgment that the call reached the destination (server) queue before returning.</span></span> <span data-ttu-id="21e13-121">Al elegir esta opción, el cliente se bloquea hasta que el servidor confirma la llamada; de lo contrario, el control vuelve al cliente inmediatamente después de realizar la llamada.</span><span class="sxs-lookup"><span data-stu-id="21e13-121">Choosing this option blocks the client until the server acknowledges the call, otherwise control returns to the client immediately upon making the call.</span></span>

<span data-ttu-id="21e13-122">Mediante el uso del registro en diario, se pueden registrar llamadas en el disco.</span><span class="sxs-lookup"><span data-stu-id="21e13-122">By using journaling, calls can be logged to disk.</span></span> <span data-ttu-id="21e13-123">Si el registro en diario está activado, cada llamada se registra en el disco a medida que se transmite al próximo salto al proceso del servidor.</span><span class="sxs-lookup"><span data-stu-id="21e13-123">If journaling is turned on, each call is logged to disk as it is transmitted to the next hop on its way to the server process.</span></span>

<span data-ttu-id="21e13-124">La prioridad de llamada se puede usar junto con el \[ atributo de función de [**mensaje**](/windows/desktop/Midl/message) RPC para permitir que las \] llamadas con mayor prioridad tengan prioridad sobre las llamadas con menor prioridad, incluso si las llamadas de prioridad alta llegan más tarde.</span><span class="sxs-lookup"><span data-stu-id="21e13-124">Call priority can be used in conjunction with the RPC \[[**message**](/windows/desktop/Midl/message)\] function attribute to allow calls with higher priority to take precedence over calls with lower priority, even if the high priority calls arrive later.</span></span> <span data-ttu-id="21e13-125">La prioridad de la llamada también funcionará de manera limitada con RPC sincrónico, pero las llamadas RPC sincrónicas no se pueden apilar de la misma manera que las llamadas asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="21e13-125">Call priority will also work in a limited fashion with synchronous RPC, but synchronous RPC calls cannot stack up in the same manner as asynchronous calls.</span></span>

<span data-ttu-id="21e13-126">El proceso de cliente controla todas las propiedades anteriores mediante una llamada a [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption).</span><span class="sxs-lookup"><span data-stu-id="21e13-126">The client process controls all of the above properties by calling [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption).</span></span> <span data-ttu-id="21e13-127">Una vez establecidas, estas propiedades permanecen en vigor hasta que se cambian en otra llamada a **RpcBindingSetOption**.</span><span class="sxs-lookup"><span data-stu-id="21e13-127">Once set, these properties remain in effect until they are changed in another call to **RpcBindingSetOption**.</span></span>

<span data-ttu-id="21e13-128">El proceso de servidor RPC puede controlar la duración de su cola de recepción.</span><span class="sxs-lookup"><span data-stu-id="21e13-128">The RPC server process can control the lifetime of its receive queue.</span></span> <span data-ttu-id="21e13-129">De forma predeterminada, la cola se elimina cuando finaliza el proceso del servidor.</span><span class="sxs-lookup"><span data-stu-id="21e13-129">By default the queue is deleted when the server process exits.</span></span> <span data-ttu-id="21e13-130">Sin embargo, el proceso de servidor puede usar [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) al configurar su punto de conexión para indicar al transporte que permita que la cola continúe existiendo y acepte solicitudes de llamada incluso cuando el proceso de servidor no se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="21e13-130">However, the server process can use [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) when setting up its endpoint to tell the transport to allow the queue to continue to exist and to accept call requests even when the server process is not running.</span></span> <span data-ttu-id="21e13-131">En este caso, las llamadas se ponen en cola y se ejecutan más adelante, cuando el proceso del servidor vuelve a estar en línea.</span><span class="sxs-lookup"><span data-stu-id="21e13-131">In this case, the calls are queued up and executed later, when the server process comes back online.</span></span>

> [!Note]  
> <span data-ttu-id="21e13-132">Si utiliza llamadas asincrónicas a \[ [**mensajes**](/windows/desktop/Midl/message) \] en una interfaz, debe registrar la interfaz llamando a [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) o [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) antes de llamar a [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(ncadg \_ MQ)**.</span><span class="sxs-lookup"><span data-stu-id="21e13-132">If you are using asynchronous \[[**message**](/windows/desktop/Midl/message)\] calls in an interface, you must register the interface by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) or [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) before calling [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(ncadg\_mq)**.</span></span> <span data-ttu-id="21e13-133">Una vez que se activa la secuencia de protocolos, las llamadas que ya esperan en la cola del servidor comenzarán a leerse en la cola.</span><span class="sxs-lookup"><span data-stu-id="21e13-133">Once you turn on the protocol sequence, any calls already waiting on the queue for the server will begin to be read off the queue.</span></span> <span data-ttu-id="21e13-134">Si no se ha registrado la interfaz RPC correspondiente, se producirá un error en las llamadas.</span><span class="sxs-lookup"><span data-stu-id="21e13-134">If the corresponding RPC interface has not been registered, the calls will fail.</span></span> <span data-ttu-id="21e13-135">Esta situación puede producirse si tiene una configuración de un punto de conexión permanente para las llamadas a procedimientos remotos, se ha cerrado el servidor y los clientes han continuado enviando llamadas al servidor.</span><span class="sxs-lookup"><span data-stu-id="21e13-135">This situation can happen if you have a setup a permanent endpoint for your remote procedure calls, the server has been shut down, and clients have continued to send calls to the server.</span></span> <span data-ttu-id="21e13-136">Estas llamadas se apilarán en la cola, en espera de ser leídas una vez que el servidor vuelva a estar en línea.</span><span class="sxs-lookup"><span data-stu-id="21e13-136">These calls will be stacked up in the queue, waiting to be read once the server comes back online.</span></span>

 

<span data-ttu-id="21e13-137">Para obtener más información, vea [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)y \[ [**Message**](/windows/desktop/Midl/message) \] , [**ncadg \_ MQ**](/windows/desktop/Midl/ncadg-mq).</span><span class="sxs-lookup"><span data-stu-id="21e13-137">For more information, see [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex), and \[[**message**](/windows/desktop/Midl/message)\], [**ncadg\_mq**](/windows/desktop/Midl/ncadg-mq).</span></span>

 

 