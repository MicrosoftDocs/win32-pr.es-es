---
title: Búferes Stub-Allocated
description: En lugar de forzar una llamada DISTINCT para cada nodo del árbol o gráfico, puede dirigir el código auxiliar para calcular el tamaño de los datos y asignar y liberar memoria realizando una única llamada a la asignación de usuarios de MIDL o a la versión de \_ \_ usuario de MIDL \_ \_ .
ms.assetid: 9911649d-00e8-47d8-b512-7d9b185d1e09
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 956acf6452c1a4e7d04afcd1da263439436e3bad
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104078096"
---
# <a name="stub-allocated-buffers"></a><span data-ttu-id="12776-103">Búferes Stub-Allocated</span><span class="sxs-lookup"><span data-stu-id="12776-103">Stub-Allocated Buffers</span></span>

<span data-ttu-id="12776-104">En lugar de forzar una llamada DISTINCT para cada nodo del árbol o gráfico, puede dirigir el código auxiliar para calcular el tamaño de los datos y asignar y liberar memoria realizando una única llamada a la [ \_ \_ asignación de usuarios de MIDL](/windows/desktop/Midl/midl-user-allocate-1) o a la versión de [usuario de MIDL \_ \_ ](/windows/desktop/Midl/midl-user-free-1).</span><span class="sxs-lookup"><span data-stu-id="12776-104">Rather than forcing a distinct call for each node of the tree or graph, you can direct the stubs to compute the size of the data and to allocate and free memory by making a single call to [midl\_user\_allocate](/windows/desktop/Midl/midl-user-allocate-1) or [midl\_user\_free](/windows/desktop/Midl/midl-user-free-1).</span></span> <span data-ttu-id="12776-105">El atributo ACF **\[ allocate (todos los \_ nodos) \]** dirige el código auxiliar para asignar o liberar todos los nodos en una sola llamada a las funciones de administración de memoria proporcionadas por el usuario.</span><span class="sxs-lookup"><span data-stu-id="12776-105">The ACF attribute **\[allocate(all\_nodes)\]** directs the stubs to allocate or free all nodes in a single call to the user supplied–memory management functions.</span></span>

<span data-ttu-id="12776-106">Por ejemplo, una aplicación RPC podría usar la siguiente estructura de datos de árbol binario:</span><span class="sxs-lookup"><span data-stu-id="12776-106">For example, an RPC application might use the following binary tree data structure:</span></span>

``` syntax
/* IDL file fragment */
typedef struct _TREE_TYPE 
{
    short sNumber;
    struct _TREE_TYPE * pLeft;
    struct _TREE_TYPE * pRight;
} TREE_TYPE;

typedef TREE_TYPE * P_TREE_TYPE;
```

<span data-ttu-id="12776-107">El atributo ACF **\[ allocate (todos los \_ nodos) \]** aplicado a este tipo de datos aparece en la declaración **typedef** en el ACF como:</span><span class="sxs-lookup"><span data-stu-id="12776-107">The ACF attribute **\[allocate(all\_nodes)\]** applied to this data type appears in the **typedef** declaration in the ACF as:</span></span>

``` syntax
/* ACF file fragment */
typedef [allocate(all_nodes)] P_TREE_TYPE;
```

<span data-ttu-id="12776-108">El atributo **\[ allocate \]** solo se puede aplicar a los tipos de puntero.</span><span class="sxs-lookup"><span data-stu-id="12776-108">The **\[allocate\]** attribute can only be applied to pointer types.</span></span> <span data-ttu-id="12776-109">El atributo **\[ allocate \]** ACF es una extensión de Microsoft para DCE IDL y, como tal, no está disponible si se compila con el modificador **/OSF** de MIDL.</span><span class="sxs-lookup"><span data-stu-id="12776-109">The **\[allocate\]** ACF attribute is a Microsoft extension to DCE IDL and, as such, is not available if you compile with the MIDL **/osf** switch.</span></span> <span data-ttu-id="12776-110">Cuando se aplica la **\[ asignación (todos los \_ nodos) \]** a un tipo de puntero, el código auxiliar generado por el compilador MIDL atraviesa la estructura de datos especificada para determinar el tamaño de asignación.</span><span class="sxs-lookup"><span data-stu-id="12776-110">When **\[allocate(all\_nodes)\]** is applied to a pointer type, the stubs generated by the MIDL compiler traverse the specified data structure to determine the allocation size.</span></span> <span data-ttu-id="12776-111">Después, el código auxiliar realiza una llamada única para asignar toda la cantidad de memoria que necesita el gráfico o el árbol.</span><span class="sxs-lookup"><span data-stu-id="12776-111">The stubs then make a single call to allocate the entire amount of memory needed by the graph or tree.</span></span> <span data-ttu-id="12776-112">Una aplicación cliente puede liberar memoria de forma mucho más eficaz si realiza una única llamada a la versión **\_ \_ gratuita del usuario de MIDL**.</span><span class="sxs-lookup"><span data-stu-id="12776-112">A client application can free memory much more efficiently by making a single call to **midl\_user\_free**.</span></span> <span data-ttu-id="12776-113">Sin embargo, el rendimiento del código auxiliar del servidor suele aumentar cuando se usa la asignación de memoria de nodo por nodo, ya que el código auxiliar del servidor a menudo puede usar la memoria privada que no requiere asignaciones.</span><span class="sxs-lookup"><span data-stu-id="12776-113">However, server-stub performance is generally increased when using node-by-node memory allocation because the server stubs can often use private memory that requires no allocations.</span></span>

<span data-ttu-id="12776-114">Para obtener más información, consulte [asignación y desasignación de nodo por nodo](node-by-node-allocation-and-deallocation.md).</span><span class="sxs-lookup"><span data-stu-id="12776-114">For additional information, see [Node-by-Node Allocation and Deallocation](node-by-node-allocation-and-deallocation.md).</span></span>

 

 