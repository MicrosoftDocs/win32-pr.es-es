---
description: Determine si un sistema de archivos admite archivos dispersos mediante una llamada a la función GetVolumeInformation.
ms.assetid: a08f6bbc-c139-4396-8964-4aa63285f3f5
title: Operaciones de archivos dispersos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2c23d26fc1c52db32ca7674aec2fc487a826e9a6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105666626"
---
# <a name="sparse-file-operations"></a><span data-ttu-id="d9555-103">Operaciones de archivos dispersos</span><span class="sxs-lookup"><span data-stu-id="d9555-103">Sparse File Operations</span></span>

<span data-ttu-id="d9555-104">Para determinar si un sistema de archivos admite archivos dispersos, llame a la función [**GetVolumeInformation**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa) y examine el archivo admite la marca de bits de **\_ \_ \_ archivos dispersos** devuelta mediante el parámetro *lpFileSystemFlags* .</span><span class="sxs-lookup"><span data-stu-id="d9555-104">To determine whether a file system supports sparse files, call the [**GetVolumeInformation**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa) function and examine the **FILE\_SUPPORTS\_SPARSE\_FILES** bit flag returned through the *lpFileSystemFlags* parameter.</span></span>

<span data-ttu-id="d9555-105">La mayoría de las aplicaciones no tienen en cuenta los archivos dispersos y no crearán archivos dispersos.</span><span class="sxs-lookup"><span data-stu-id="d9555-105">Most applications are not aware of sparse files and will not create sparse files.</span></span> <span data-ttu-id="d9555-106">El hecho de que una aplicación lea un archivo disperso es transparente para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d9555-106">The fact that an application is reading a sparse file is transparent to the application.</span></span> <span data-ttu-id="d9555-107">Una aplicación que tenga en cuenta los archivos dispersos debe determinar si su conjunto de datos es adecuado para conservarse en un archivo disperso.</span><span class="sxs-lookup"><span data-stu-id="d9555-107">An application that is aware of sparse-files should determine whether its data set is suitable to be kept in a sparse file.</span></span> <span data-ttu-id="d9555-108">Una vez realizada esa determinación, la aplicación debe declarar explícitamente un archivo como disperso, mediante el uso del código de control [**\_ \_ disperso de FSCTL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_sparse) .</span><span class="sxs-lookup"><span data-stu-id="d9555-108">After that determination is made, the application must explicitly declare a file as sparse, using the [**FSCTL\_SET\_SPARSE**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_sparse) control code.</span></span>

<span data-ttu-id="d9555-109">Después de que una aplicación haya configurado un archivo para que sea disperso, la aplicación puede usar el código de control de [**datos de FSCTL \_ establecido en \_ cero \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) para establecer una región del archivo en cero.</span><span class="sxs-lookup"><span data-stu-id="d9555-109">After an application has set a file to be sparse, the application can use the [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) control code to set a region of the file to zero.</span></span> <span data-ttu-id="d9555-110">Además, la aplicación puede usar el código de control de [**\_ \_ \_ intervalos asignados de consulta FSCTL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_allocated_ranges) para acelerar las búsquedas de datos distintos de cero en el archivo disperso.</span><span class="sxs-lookup"><span data-stu-id="d9555-110">In addition, the application can use the [**FSCTL\_QUERY\_ALLOCATED\_RANGES**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_allocated_ranges) control code to speed searches for nonzero data in the sparse file.</span></span>

<span data-ttu-id="d9555-111">Cuando se realiza una operación de escritura (con una función u operación distinta de [**FSCTL \_ establecida en \_ cero \_ datos**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) cuyos datos se componen de nada pero ceros, se escribirán ceros en el disco para la longitud completa de la escritura.</span><span class="sxs-lookup"><span data-stu-id="d9555-111">When you perform a write operation (with a function or operation other than [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) whose data consists of nothing but zeros, zeros will be written to the disk for the entire length of the write.</span></span> <span data-ttu-id="d9555-112">Para que un intervalo del archivo sea cero y mantener la dispersión, use **FSCTL \_ establecer \_ \_ datos cero**.</span><span class="sxs-lookup"><span data-stu-id="d9555-112">To zero out a range of the file and maintain sparseness, use **FSCTL\_SET\_ZERO\_DATA**.</span></span>

<span data-ttu-id="d9555-113">Una aplicación compatible con la dispersión también puede establecer un archivo existente para que sea disperso.</span><span class="sxs-lookup"><span data-stu-id="d9555-113">A sparseness-aware application may also set an existing file to be sparse.</span></span> <span data-ttu-id="d9555-114">Si una aplicación establece un archivo existente para que sea disperso, debe analizar el archivo en busca de regiones que contengan ceros y usar [**FSCTL \_ establecer \_ cero \_ datos**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) para restablecer esas regiones, lo que posiblemente desasignaría algún almacenamiento de disco físico.</span><span class="sxs-lookup"><span data-stu-id="d9555-114">If an application sets an existing file to be sparse, it should then scan the file for regions which contain zeros, and use [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) to reset those regions, thereby possibly deallocating some physical disk storage.</span></span> <span data-ttu-id="d9555-115">Una aplicación actualizada al reconocimiento de archivos dispersos debe realizar esta conversión.</span><span class="sxs-lookup"><span data-stu-id="d9555-115">An application upgraded to sparse file awareness should perform this conversion.</span></span>

<span data-ttu-id="d9555-116">Cuando se realiza una operación de lectura desde una parte con ceros de un archivo disperso, es posible que el sistema operativo no se lea desde la unidad de disco duro.</span><span class="sxs-lookup"><span data-stu-id="d9555-116">When you perform a read operation from a zeroed-out portion of a sparse file, the operating system may not read from the hard disk drive.</span></span> <span data-ttu-id="d9555-117">En su lugar, el sistema reconoce que la parte del archivo que se va a leer contiene ceros y devuelve un búfer lleno de ceros sin leer realmente el disco.</span><span class="sxs-lookup"><span data-stu-id="d9555-117">Instead, the system recognizes that the portion of the file to be read contains zeros, and it returns a buffer full of zeros without actually reading from the disk.</span></span>

<span data-ttu-id="d9555-118">Como con cualquier otro archivo, el sistema puede escribir o leer datos desde cualquier posición en un archivo disperso.</span><span class="sxs-lookup"><span data-stu-id="d9555-118">As with any other file, the system can write data to or read data from any position in a sparse file.</span></span> <span data-ttu-id="d9555-119">Los datos distintos de cero que se escriben en una parte con ceros anterior del archivo pueden dar lugar a la asignación de espacio en disco.</span><span class="sxs-lookup"><span data-stu-id="d9555-119">Nonzero data being written to a previously zeroed portion of the file may result in allocation of disk space.</span></span> <span data-ttu-id="d9555-120">Los ceros que se escriben sobre datos distintos de cero (solo con [**\_ \_ \_ datos**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)de otro conjunto de FSCTL) pueden dar lugar a una desasignación de espacio en disco.</span><span class="sxs-lookup"><span data-stu-id="d9555-120">Zeros being written over nonzero data (only with [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)) may result in a deallocation of disk space.</span></span>

> [!Note]  
> <span data-ttu-id="d9555-121">Depende de la aplicación mantener la dispersión si escribe ceros con los [**\_ \_ \_ datos de FSCTL establecidos**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data).</span><span class="sxs-lookup"><span data-stu-id="d9555-121">It is up to the application to maintain sparseness by writing zeros with [**FSCTL\_SET\_ZERO\_DATA**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data).</span></span>

 

<span data-ttu-id="d9555-122">Las herramientas de desfragmentación que controlan archivos comprimidos en sistemas de archivos NTFS administrarán correctamente los archivos dispersos en volúmenes del sistema de archivos NTFS.</span><span class="sxs-lookup"><span data-stu-id="d9555-122">Defragmentation tools that handle compressed files on NTFS file systems will correctly handle sparse files on NTFS file system volumes.</span></span> <span data-ttu-id="d9555-123">Los archivos dispersos grandes y muy fragmentados pueden superar la limitación de NTFS en las extensiones de disco antes de que se use el espacio disponible.</span><span class="sxs-lookup"><span data-stu-id="d9555-123">Large and highly fragmented sparse files can exceed the NTFS limitation on disk extents before available space is used.</span></span> <span data-ttu-id="d9555-124">Para obtener más información, vea [el tema sobre cómo ampliar un archivo con el error "disco lleno", aunque el volumen tenga espacio disponible](https://support.microsoft.com/default.aspx/kb/957180).</span><span class="sxs-lookup"><span data-stu-id="d9555-124">For more information, see [Extending a File may fail with "Disk Full" Error even though Volume has Free Space](https://support.microsoft.com/default.aspx/kb/957180).</span></span>

 

 
