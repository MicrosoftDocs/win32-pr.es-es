---
title: Administración de objetos
description: En esta sección se describe el uso correcto de los tipos de objeto de la API de filtrado de Windows (WFP).
ms.assetid: 2625ef9a-0e62-4e21-ba93-047965d0d782
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc41560bb85a7e79c0262d77c0b34fe6c1d9bfd6
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "104487615"
---
# <a name="object-management"></a><span data-ttu-id="1045f-103">Administración de objetos</span><span class="sxs-lookup"><span data-stu-id="1045f-103">Object Management</span></span>

<span data-ttu-id="1045f-104">En esta sección se describe el uso correcto de los tipos de objeto de la API de filtrado de Windows (WFP).</span><span class="sxs-lookup"><span data-stu-id="1045f-104">This section covers the correct use of Windows Filtering Platform (WFP) API object types.</span></span>

## <a name="sessions"></a><span data-ttu-id="1045f-105">Sesiones</span><span class="sxs-lookup"><span data-stu-id="1045f-105">Sessions</span></span>

<span data-ttu-id="1045f-106">La API de WFP está orientada a la sesión y la mayoría de las llamadas a funciones se realizan en el contexto de una sesión.</span><span class="sxs-lookup"><span data-stu-id="1045f-106">The WFP API is session-oriented, and most function calls are made within the context of a session.</span></span> <span data-ttu-id="1045f-107">Se crea una nueva sesión de cliente mediante una llamada a [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="1045f-107">A new client session is created by calling [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="1045f-108">La sesión finaliza cuando el cliente llama a [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) o finaliza el proceso del cliente.</span><span class="sxs-lookup"><span data-stu-id="1045f-108">The session ends either when the client calls [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) or the client process terminates.</span></span> <span data-ttu-id="1045f-109">Cuando se destruye una sesión, ya sea a propósito o por el informe detallado de RPC, el motor de filtrado de base (BFE) anula primero cualquier transacción existente.</span><span class="sxs-lookup"><span data-stu-id="1045f-109">When a session is destroyed, either on purpose or by the RPC rundown, the Base Filtering Engine (BFE) first aborts any existing transaction.</span></span>

<span data-ttu-id="1045f-110">Al crear una nueva sesión, el autor de la llamada puede crear una sesión dinámica pasando la marca dinámica de la [**marca de \_ sesión \_ \_ FWPM**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) a [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="1045f-110">When creating a new session, the caller can create a dynamic session by passing the [**FWPM\_SESSION\_FLAG\_DYNAMIC**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) flag to [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="1045f-111">Los objetos agregados durante una sesión dinámica se eliminan automáticamente cuando finaliza la sesión.</span><span class="sxs-lookup"><span data-stu-id="1045f-111">Any objects added during a dynamic session are automatically deleted when the session ends.</span></span>

## <a name="transactions"></a><span data-ttu-id="1045f-112">Transacciones</span><span class="sxs-lookup"><span data-stu-id="1045f-112">Transactions</span></span>

<span data-ttu-id="1045f-113">La API de WFP es transaccional y la mayoría de las llamadas a funciones se realizan en el contexto de una transacción.</span><span class="sxs-lookup"><span data-stu-id="1045f-113">The WFP API is transactional, and most function calls are made within the context of a transaction.</span></span> <span data-ttu-id="1045f-114">Los llamadores pueden usar [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0)y [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) para controlar explícitamente las transacciones.</span><span class="sxs-lookup"><span data-stu-id="1045f-114">Callers can use [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0), and [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) to explicitly control transactions.</span></span> <span data-ttu-id="1045f-115">Sin embargo, si una llamada de función se realiza fuera de una transacción explícita, se ejecutará dentro de una transacción implícita.</span><span class="sxs-lookup"><span data-stu-id="1045f-115">However, if a function call is made outside of an explicit transaction, it will be executed within an implicit transaction.</span></span> <span data-ttu-id="1045f-116">Si una transacción está en curso, cuando una sesión finaliza, se anula automáticamente.</span><span class="sxs-lookup"><span data-stu-id="1045f-116">If a transaction is in progress, when a session terminates, it is automatically aborted.</span></span> <span data-ttu-id="1045f-117">Las transacciones implícitas nunca se anulan forzosamente.</span><span class="sxs-lookup"><span data-stu-id="1045f-117">Implicit transactions are never forcibly aborted.</span></span>

<span data-ttu-id="1045f-118">Las transacciones son de solo lectura o de lectura y escritura, y aplican una semántica rigurosamente uniforme aislada ([acid](../cossdk/acid-properties.md)) de coherencia atómica.</span><span class="sxs-lookup"><span data-stu-id="1045f-118">Transactions are either read-only or read/write and enforce rigorous Atomic Consistent Isolated Durable ([ACID](../cossdk/acid-properties.md)) semantics.</span></span>

<span data-ttu-id="1045f-119">Cada sesión de cliente solo puede tener una transacción en curso a la vez.</span><span class="sxs-lookup"><span data-stu-id="1045f-119">Each client session can have only one transaction in progress at a time.</span></span> <span data-ttu-id="1045f-120">Si el llamador intenta iniciar una segunda transacción antes de confirmar o anular la primera, BFE devuelve un error.</span><span class="sxs-lookup"><span data-stu-id="1045f-120">If the caller attempts to begin a second transaction before committing or aborting the first, BFE returns an error.</span></span>

<span data-ttu-id="1045f-121">Si se produce un error en una operación durante el transcurso de una transacción, no afecta al estado general de la transacción.</span><span class="sxs-lookup"><span data-stu-id="1045f-121">If an operation fails during the course of a transaction, it does not affect the overall state of the transaction.</span></span> <span data-ttu-id="1045f-122">Por ejemplo, supongamos que el cliente inicia una transacción y llama correctamente a [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) tres veces antes de que se produzca un error en la cuarta llamada.</span><span class="sxs-lookup"><span data-stu-id="1045f-122">For example, suppose the client begins a transaction and successfully calls [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) three times before a fourth call fails.</span></span> <span data-ttu-id="1045f-123">El cliente tiene ahora la opción de:</span><span class="sxs-lookup"><span data-stu-id="1045f-123">The client now has the option of:</span></span>

-   <span data-ttu-id="1045f-124">Anulando la transacción, en cuyo caso no se agregará ninguno de los filtros.</span><span class="sxs-lookup"><span data-stu-id="1045f-124">Aborting the transaction, in which case none of the filters will be added.</span></span>
-   <span data-ttu-id="1045f-125">Confirmación de la transacción, en cuyo caso se agregarán los tres primeros filtros.</span><span class="sxs-lookup"><span data-stu-id="1045f-125">Committing the transaction, in which case the first three filters will be added.</span></span>
-   <span data-ttu-id="1045f-126">Continuando con más operaciones, como la posibilidad de volver a intentar el [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0)con errores.</span><span class="sxs-lookup"><span data-stu-id="1045f-126">Continuing with more operations including potentially retrying the failed [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span>

<span data-ttu-id="1045f-127">Al iniciar una transacción, BFE esperará hasta que la [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) de la sesión expire para adquirir el bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1045f-127">When beginning a transaction, BFE will wait until the session's [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) expires to acquire the lock.</span></span> <span data-ttu-id="1045f-128">Si el bloqueo no se adquiere dentro de este tiempo, se producirá un error en la adquisición del bloqueo (y la llamada a [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) ).</span><span class="sxs-lookup"><span data-stu-id="1045f-128">If the lock is not acquired within this time, the lock acquisition (and the [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) call) will fail.</span></span> <span data-ttu-id="1045f-129">Esto impide que los clientes no respondan indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="1045f-129">This prevents clients from indefinitely failing to respond.</span></span> <span data-ttu-id="1045f-130">Si el cliente no especificó un tiempo de espera de bloqueo, el valor predeterminado es 15 segundos.</span><span class="sxs-lookup"><span data-stu-id="1045f-130">If the client did not specify a lock timeout, it defaults to 15 seconds.</span></span>

<span data-ttu-id="1045f-131">Cada transacción también tiene un tiempo de espera de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1045f-131">Each transaction also has a lock timeout.</span></span> <span data-ttu-id="1045f-132">Esta es la cantidad máxima de tiempo que puede poseer el bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1045f-132">This is the maximum amount of time that it can own the lock.</span></span> <span data-ttu-id="1045f-133">Si el propietario no libera el bloqueo dentro de este tiempo, la transacción se anula forzosamente, lo que hace que se libere el bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1045f-133">If the owner does not release the lock within this time, the transaction is forcibly aborted, causing the lock to be released.</span></span> <span data-ttu-id="1045f-134">No se puede configurar el tiempo de espera de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="1045f-134">The lock timeout is not configurable.</span></span> <span data-ttu-id="1045f-135">Es infinito para los llamadores en modo kernel y una hora para los llamadores en modo de usuario.</span><span class="sxs-lookup"><span data-stu-id="1045f-135">It is infinite for kernel-mode callers and one hour for user-mode callers.</span></span> <span data-ttu-id="1045f-136">Si una transacción se anula forzosamente, se producirá un error en la siguiente llamada realizada dentro de esa transacción con el método **\_ \_ TXN \_ anulado**.</span><span class="sxs-lookup"><span data-stu-id="1045f-136">If a transaction is forcibly aborted, the next call made within that transaction will fail with **FWP\_E\_TXN\_ABORTED**.</span></span>

## <a name="object-lifetimes"></a><span data-ttu-id="1045f-137">Duración de los objetos</span><span class="sxs-lookup"><span data-stu-id="1045f-137">Object Lifetimes</span></span>

<span data-ttu-id="1045f-138">Los objetos pueden tener una de las cuatro posibles duraciones:</span><span class="sxs-lookup"><span data-stu-id="1045f-138">Objects can have one of four possible lifetimes:</span></span>

-   <span data-ttu-id="1045f-139">Dinámica: un objeto es dinámico solo si se agrega mediante un identificador de sesión dinámica.</span><span class="sxs-lookup"><span data-stu-id="1045f-139">Dynamic — An object is dynamic only if it is added using a dynamic session handle.</span></span> <span data-ttu-id="1045f-140">Los objetos dinámicos se activan hasta que se eliminan o finaliza la sesión propietaria.</span><span class="sxs-lookup"><span data-stu-id="1045f-140">Dynamic objects live until they are deleted or the owning session terminates.</span></span>
-   <span data-ttu-id="1045f-141">Estático: los objetos son estáticos de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="1045f-141">Static — Objects are static by default.</span></span> <span data-ttu-id="1045f-142">Los objetos estáticos se activan hasta que se eliminan, BFE se detiene o se apaga el sistema.</span><span class="sxs-lookup"><span data-stu-id="1045f-142">Static objects live until they are deleted, BFE stops, or the system is shutdown.</span></span>
-   <span data-ttu-id="1045f-143">Persistente: los objetos persistentes se crean pasando la **marca \_ \* \_ \_ persistente** adecuada de la marca FWPM a una función **FWPM \* Add0** .</span><span class="sxs-lookup"><span data-stu-id="1045f-143">Persistent — Persistent objects are created by passing the appropriate **FWPM\_\*\_FLAG\_PERSISTENT** flag to an **Fwpm\*Add0** function.</span></span> <span data-ttu-id="1045f-144">Objetos persistentes activos hasta que se eliminan.</span><span class="sxs-lookup"><span data-stu-id="1045f-144">Persistent objects live until they are deleted.</span></span>
-   <span data-ttu-id="1045f-145">Integrado: los objetos integrados están predefinidos por BFE y no se pueden agregar ni eliminar.</span><span class="sxs-lookup"><span data-stu-id="1045f-145">Built-in — Built-in objects are predefined by BFE and cannot be added or deleted.</span></span> <span data-ttu-id="1045f-146">Siempre están activos.</span><span class="sxs-lookup"><span data-stu-id="1045f-146">They live forever.</span></span>

<span data-ttu-id="1045f-147">Los filtros de las capas de modo kernel se pueden marcar como filtros en tiempo de arranque pasando la marca correspondiente a [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span><span class="sxs-lookup"><span data-stu-id="1045f-147">Filters in kernel-mode layers can be marked as boot-time filters by passing the appropriate flag to [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span> <span data-ttu-id="1045f-148">Los filtros en tiempo de arranque se agregan al sistema cuando se inicia el controlador TCP/IP y se quitan cuando BFE finaliza la inicialización.</span><span class="sxs-lookup"><span data-stu-id="1045f-148">Boot-time filters are added to the system when the TCP/IP driver starts, and removed when BFE finishes initialization.</span></span> <span data-ttu-id="1045f-149">Los objetos persistentes se agregan cuando se inicia BFE.</span><span class="sxs-lookup"><span data-stu-id="1045f-149">Persistent objects are added when BFE starts.</span></span>

<span data-ttu-id="1045f-150">En muchos casos, es posible que un proveedor de directivas no quiera que se aplique su directiva persistente si se ha deshabilitado el proveedor.</span><span class="sxs-lookup"><span data-stu-id="1045f-150">In many cases, a policy provider may not want its persistent policy enforced if the provider has been disabled.</span></span> <span data-ttu-id="1045f-151">Al agregar un proveedor, el llamador puede especificar un nombre de servicio de Windows opcional.</span><span class="sxs-lookup"><span data-stu-id="1045f-151">When adding a provider, the caller can specify an optional Windows service name.</span></span> <span data-ttu-id="1045f-152">Al agregar objetos persistentes, el llamador puede especificar opcionalmente el proveedor que "posee" ese objeto.</span><span class="sxs-lookup"><span data-stu-id="1045f-152">When adding persistent objects, the caller can optionally specify the provider that "owns" that object.</span></span> <span data-ttu-id="1045f-153">En el inicio del servicio, BFE solo agrega objetos persistentes al sistema si no están asociados a un proveedor, o el proveedor asociado no tiene ningún nombre de servicio de Windows o el servicio de Windows asociado está establecido en Inicio automático.</span><span class="sxs-lookup"><span data-stu-id="1045f-153">At service start, BFE only adds persistent objects to the system if they are not associated with a provider, or the associated provider has no Windows service name, or the associated Windows service is set to auto-start.</span></span>

## <a name="object-associations"></a><span data-ttu-id="1045f-154">Asociaciones de objetos</span><span class="sxs-lookup"><span data-stu-id="1045f-154">Object Associations</span></span>

<span data-ttu-id="1045f-155">Algunos objetos tienen referencias a otros objetos.</span><span class="sxs-lookup"><span data-stu-id="1045f-155">Some objects have references to other objects.</span></span> <span data-ttu-id="1045f-156">Por ejemplo, un filtro siempre hace referencia a una capa y puede hacer referencia a una llamada y a un contexto de proveedor.</span><span class="sxs-lookup"><span data-stu-id="1045f-156">For example, a filter always references a layer and may reference a callout and a provider context.</span></span> <span data-ttu-id="1045f-157">Los objetos no pueden hacer referencia a objetos que pueden tener una duración más corta.</span><span class="sxs-lookup"><span data-stu-id="1045f-157">Objects cannot refer to objects that may have a shorter lifetime.</span></span> <span data-ttu-id="1045f-158">Por lo tanto, un objeto dinámico no puede hacer referencia a un objeto dinámico desde una sesión diferente.</span><span class="sxs-lookup"><span data-stu-id="1045f-158">Thus, a dynamic object cannot refer to a dynamic object from a different session.</span></span> <span data-ttu-id="1045f-159">Un objeto estático no puede hacer referencia a un objeto dinámico.</span><span class="sxs-lookup"><span data-stu-id="1045f-159">A static object cannot refer to a dynamic object.</span></span> <span data-ttu-id="1045f-160">Un objeto persistente no puede hacer referencia a un objeto dinámico, un objeto estático o un objeto persistente propiedad de un proveedor diferente.</span><span class="sxs-lookup"><span data-stu-id="1045f-160">A persistent object cannot refer to a dynamic object, a static object, or a persistent object owned by a different provider.</span></span>

<span data-ttu-id="1045f-161">No se puede eliminar un objeto hasta que se hayan eliminado todos los objetos que hacen referencia a él.</span><span class="sxs-lookup"><span data-stu-id="1045f-161">An object cannot be deleted until all objects that reference it have first been deleted.</span></span>

## <a name="luids-and-guids"></a><span data-ttu-id="1045f-162">LUID y GUID</span><span class="sxs-lookup"><span data-stu-id="1045f-162">LUIDs and GUIDs</span></span>

<span data-ttu-id="1045f-163">Todos los objetos de la API de WFP del modo de usuario (FWPM) se identifican mediante un identificador único global (**GUID**) y hacen referencia a otros objetos por sus **GUID**.</span><span class="sxs-lookup"><span data-stu-id="1045f-163">All user mode WFP API objects (FWPM) are identified by a globally unique identifier (**GUID**) and reference other objects by their **GUID** s.</span></span> <span data-ttu-id="1045f-164">El **GUID** solo debe ser único en el tipo de objeto.</span><span class="sxs-lookup"><span data-stu-id="1045f-164">The **GUID** need only be unique within the object type.</span></span> <span data-ttu-id="1045f-165">Por ejemplo, un filtro y un contexto de proveedor pueden tener el mismo **GUID**, pero no puede haber dos filtros.</span><span class="sxs-lookup"><span data-stu-id="1045f-165">For example, a filter and a provider context can have the same **GUID**, but two filters cannot.</span></span> <span data-ttu-id="1045f-166">Al agregar un nuevo objeto, los llamadores pueden asignar el **GUID** del objeto o dejarlo inicializado con ceros y dejar que BFE asigne el **GUID**.</span><span class="sxs-lookup"><span data-stu-id="1045f-166">When adding a new object, callers can assign the object's **GUID** or leave it zero-initialized and let BFE assign the **GUID**.</span></span>

<span data-ttu-id="1045f-167">Todos los objetos de la API de WFP de modo kernel (FWPS) se identifican mediante un identificador local único (**LUID**) y hacen referencia a otros objetos por su LUID.</span><span class="sxs-lookup"><span data-stu-id="1045f-167">All kernel mode WFP API objects (FWPS) are identified by a locally unique identifier (**LUID**) and reference other objects by their LUID.</span></span> <span data-ttu-id="1045f-168">El cambio del **GUID** al **LUID** permite a WFP conservar el bloque no paginado y optimizar el procesamiento en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="1045f-168">The switch from **GUID** to **LUID** enables WFP to conserve non-paged pool and optimize run-time processing.</span></span> <span data-ttu-id="1045f-169">El ancho del **LUID** depende del tipo de objeto e intervalos de una **UINT16** a un **UINT64**.</span><span class="sxs-lookup"><span data-stu-id="1045f-169">The width of the **LUID** depends on the object type and ranges from a **UINT16** to a **UINT64**.</span></span> <span data-ttu-id="1045f-170">Los **LUID** s siempre se asignan mediante BFE.</span><span class="sxs-lookup"><span data-stu-id="1045f-170">**LUID** s are always assigned by BFE.</span></span>

 

 