---
description: Negociar asignadores
ms.assetid: fe13477c-1a7b-4098-9d0f-c54783102bc9
title: Negociar asignadores
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2faa393ba9fcd8585d68947cec172d4cfca6decf
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "105686279"
---
# <a name="negotiating-allocators"></a><span data-ttu-id="bf867-103">Negociar asignadores</span><span class="sxs-lookup"><span data-stu-id="bf867-103">Negotiating Allocators</span></span>

<span data-ttu-id="bf867-104">Cuando dos patillas se conectan, necesitan un mecanismo para intercambiar datos multimedia.</span><span class="sxs-lookup"><span data-stu-id="bf867-104">When two pins connect, they need a mechanism for exchanging media data.</span></span> <span data-ttu-id="bf867-105">Este mecanismo se denomina *transporte*.</span><span class="sxs-lookup"><span data-stu-id="bf867-105">This mechanism is called the *transport*.</span></span> <span data-ttu-id="bf867-106">En general, la arquitectura de DirectShow es neutra sobre los transportes.</span><span class="sxs-lookup"><span data-stu-id="bf867-106">In general, the DirectShow architecture is neutral about transports.</span></span> <span data-ttu-id="bf867-107">Dos filtros pueden aceptar la conexión mediante cualquier transporte que admitan ambos.</span><span class="sxs-lookup"><span data-stu-id="bf867-107">Two filters can agree to connect using any transport that both support.</span></span>

<span data-ttu-id="bf867-108">El transporte más común es el transporte de *memoria local* , en el que los datos multimedia residen en la memoria principal.</span><span class="sxs-lookup"><span data-stu-id="bf867-108">The most common transport is the *local memory* transport, in which the media data resides in main memory.</span></span> <span data-ttu-id="bf867-109">Existen dos tipos de transporte de memoria local, el *modelo de inserción* y el modelo de *extracción*.</span><span class="sxs-lookup"><span data-stu-id="bf867-109">Two flavors of local memory transport exist, the *push model* and the *pull model*.</span></span> <span data-ttu-id="bf867-110">En el modelo de entrada, el filtro de origen envía datos al filtro de bajada, utilizando la interfaz [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) en el PIN de entrada del filtro de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="bf867-110">In the push model, the source filter pushes data to the downstream filter, using the [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) interface on the downstream filter's input pin.</span></span> <span data-ttu-id="bf867-111">En el modelo de extracción, el filtro de nivel inferior solicita datos del filtro de origen mediante la interfaz [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) en el PIN de salida del filtro de origen.</span><span class="sxs-lookup"><span data-stu-id="bf867-111">In the pull model, the downstream filter requests data from the source filter, using the [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) interface on the source filter's output pin.</span></span> <span data-ttu-id="bf867-112">Para obtener más información sobre estos dos modelos de flujo de datos, vea [flujo de datos en el gráfico de filtros](data-flow-in-the-filter-graph.md).</span><span class="sxs-lookup"><span data-stu-id="bf867-112">For more information on these two data-flow models, see [Data Flow in the Filter Graph](data-flow-in-the-filter-graph.md).</span></span>

<span data-ttu-id="bf867-113">En el transporte de memoria local, el objeto responsable de la asignación de búferes de memoria se denomina *asignador*.</span><span class="sxs-lookup"><span data-stu-id="bf867-113">In local memory transport, the object responsible for allocating memory buffers is called the *allocator*.</span></span> <span data-ttu-id="bf867-114">Un asignador admite la interfaz [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) .</span><span class="sxs-lookup"><span data-stu-id="bf867-114">An allocator supports the [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) interface.</span></span> <span data-ttu-id="bf867-115">Ambos PIN comparten un único asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-115">Both pins share a single allocator.</span></span> <span data-ttu-id="bf867-116">Cualquier pin puede proporcionar un asignador, pero el PIN de salida selecciona el asignador que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="bf867-116">Either pin can provide an allocator, but the output pin selects which allocator to use.</span></span>

<span data-ttu-id="bf867-117">El PIN de salida también establece las propiedades de asignador, que determinan el número de búferes que crea el asignador, el tamaño de cada búfer y la alineación de memoria.</span><span class="sxs-lookup"><span data-stu-id="bf867-117">The output pin also sets the allocator properties, which determine how many buffers are created by the allocator, the size of each buffer, and the memory alignment.</span></span> <span data-ttu-id="bf867-118">El PIN de salida podría diferir en el PIN de entrada para los requisitos de búfer.</span><span class="sxs-lookup"><span data-stu-id="bf867-118">The output pin might defer to the input pin for the buffer requirements.</span></span>

<span data-ttu-id="bf867-119">En una conexión **IMemInputPin** , la negociación de asignador funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="bf867-119">In an **IMemInputPin** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="bf867-120">Opcionalmente, el PIN de salida llama a [**IMemInputPin:: GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span><span class="sxs-lookup"><span data-stu-id="bf867-120">Optionally, the output pin calls [**IMemInputPin::GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span></span> <span data-ttu-id="bf867-121">Este método recupera los requisitos de búfer del PIN de entrada, como la alineación de memoria.</span><span class="sxs-lookup"><span data-stu-id="bf867-121">This method retrieves the input pin's buffer requirements, such as memory alignment.</span></span> <span data-ttu-id="bf867-122">En general, el PIN de salida debe respetar la solicitud del PIN de entrada, a menos que haya una buena razón para no hacerlo.</span><span class="sxs-lookup"><span data-stu-id="bf867-122">In general, the output pin should honor the input pin's request, unless there is a good reason not to.</span></span>
2.  <span data-ttu-id="bf867-123">Opcionalmente, el PIN de salida llama a [**IMemInputPin:: GetAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span><span class="sxs-lookup"><span data-stu-id="bf867-123">Optionally, the output pin calls [**IMemInputPin::GetAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span></span> <span data-ttu-id="bf867-124">Este método solicita un asignador del PIN de entrada.</span><span class="sxs-lookup"><span data-stu-id="bf867-124">This method requests an allocator from the input pin.</span></span> <span data-ttu-id="bf867-125">El PIN de entrada proporciona uno o devuelve un código de error.</span><span class="sxs-lookup"><span data-stu-id="bf867-125">The input pin provides one, or returns an error code.</span></span>
3.  <span data-ttu-id="bf867-126">El PIN de salida selecciona un asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-126">The output pin selects an allocator.</span></span> <span data-ttu-id="bf867-127">Puede usar uno proporcionado por el PIN de entrada o crear el suyo propio.</span><span class="sxs-lookup"><span data-stu-id="bf867-127">It can use one provided by the input pin, or create its own.</span></span>
4.  <span data-ttu-id="bf867-128">El PIN de salida llama a [**IMemAllocator:: SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) para establecer las propiedades de asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-128">The output pin calls [**IMemAllocator::SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) to set the allocator properties.</span></span> <span data-ttu-id="bf867-129">Sin embargo, es posible que el asignador no respete las propiedades solicitadas.</span><span class="sxs-lookup"><span data-stu-id="bf867-129">However, the allocator might not honor the requested properties.</span></span> <span data-ttu-id="bf867-130">(Por ejemplo, esto puede ocurrir si el PIN de entrada proporciona el asignador). El asignador devuelve las propiedades reales como parámetro de salida en el método **SetProperties** .</span><span class="sxs-lookup"><span data-stu-id="bf867-130">(For example, this can happen if the input pin provides the allocator.) The allocator returns the actual properties as an output parameter in the **SetProperties** method.</span></span>
5.  <span data-ttu-id="bf867-131">Outpin llama a [**IMemInputPin:: NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) para informar al pin de entrada de la selección.</span><span class="sxs-lookup"><span data-stu-id="bf867-131">The outpin calls [**IMemInputPin::NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) to inform the input pin of the selection.</span></span>
6.  <span data-ttu-id="bf867-132">El PIN de entrada debe llamar a [**IMemAllocator:: GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) para comprobar si las propiedades de asignador son aceptables.</span><span class="sxs-lookup"><span data-stu-id="bf867-132">The input pin should call [**IMemAllocator::GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) to verify whether the allocator properties are acceptable.</span></span>
7.  <span data-ttu-id="bf867-133">El PIN de salida es responsable de confirmar y confirmar el asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-133">The output pin is responsible for committing and decommitting the allocator.</span></span> <span data-ttu-id="bf867-134">Esto sucede cuando se inicia y se detiene el streaming.</span><span class="sxs-lookup"><span data-stu-id="bf867-134">This occurs when streaming starts and stops.</span></span>

<span data-ttu-id="bf867-135">En una conexión **IAsyncReader** , la negociación de asignador funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="bf867-135">In an **IAsyncReader** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="bf867-136">El PIN de entrada llama a [**IAsyncReader:: RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) en el terminal de salida.</span><span class="sxs-lookup"><span data-stu-id="bf867-136">The input pin calls [**IAsyncReader::RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) on the output pin.</span></span> <span data-ttu-id="bf867-137">El PIN de entrada especifica sus requisitos de búfer y, opcionalmente, proporciona un asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-137">The input pin specifies its buffer requirements and, optionally, provides an allocator.</span></span>
2.  <span data-ttu-id="bf867-138">El PIN de salida selecciona un asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-138">The output pin selects an allocator.</span></span> <span data-ttu-id="bf867-139">Puede usar el que proporciona el PIN de entrada, si existe, o crear uno propio.</span><span class="sxs-lookup"><span data-stu-id="bf867-139">It can use the one provided by the input pin, if any, or create its own.</span></span>
3.  <span data-ttu-id="bf867-140">El PIN de salida devuelve el asignador como un parámetro saliente en el método **RequestAllocator** .</span><span class="sxs-lookup"><span data-stu-id="bf867-140">The output pin returns the allocator as an outgoing parameter in the **RequestAllocator** method.</span></span> <span data-ttu-id="bf867-141">El PIN de entrada debe comprobar las propiedades de asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-141">The input pin should check the allocator properties.</span></span>
4.  <span data-ttu-id="bf867-142">El PIN de entrada es responsable de confirmar y confirmar el asignador.</span><span class="sxs-lookup"><span data-stu-id="bf867-142">The input pin is responsible for committing and decommitting the allocator.</span></span>
5.  <span data-ttu-id="bf867-143">En cualquier momento durante el proceso de negociación del asignador, el pin puede producir un error en la conexión.</span><span class="sxs-lookup"><span data-stu-id="bf867-143">At any time during the allocator negotiation process, either pin can fail the connection.</span></span>
6.  <span data-ttu-id="bf867-144">Si el PIN de salida usa el asignador del PIN de entrada, puede usar ese asignador solo para proporcionar muestras a ese pin de entrada.</span><span class="sxs-lookup"><span data-stu-id="bf867-144">If the output pin uses the input pin's allocator, it can use that allocator only to deliver samples to that input pin.</span></span> <span data-ttu-id="bf867-145">El filtro propietario no debe utilizar el asignador para proporcionar ejemplos a otros PIN.</span><span class="sxs-lookup"><span data-stu-id="bf867-145">The owning filter must not use the allocator to deliver samples to other pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bf867-146">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="bf867-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bf867-147">Proporcionar un asignador personalizado</span><span class="sxs-lookup"><span data-stu-id="bf867-147">Providing a Custom Allocator</span></span>](providing-a-custom-allocator.md)
</dt> </dl>

 

 



