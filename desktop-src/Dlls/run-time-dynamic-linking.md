---
description: Cuando la aplicación llama a las funciones LoadLibrary o LoadLibraryEx, el sistema intenta encontrar el archivo DLL (para obtener más información, vea Dynamic-Link el orden de búsqueda de la biblioteca).
ms.assetid: 81e237a9-3c32-46a5-88d3-c978f43dad54
title: Vinculación dinámica Run-Time
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a9e215ac83ecdc0615b8030e2e215857c67fe6e5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105666707"
---
# <a name="run-time-dynamic-linking"></a><span data-ttu-id="4249e-103">Vinculación dinámica Run-Time</span><span class="sxs-lookup"><span data-stu-id="4249e-103">Run-Time Dynamic Linking</span></span>

<span data-ttu-id="4249e-104">Cuando la aplicación llama a las funciones [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) , el sistema intenta encontrar el archivo DLL (para obtener más información, vea [orden de búsqueda de la biblioteca de vínculos dinámicos](dynamic-link-library-search-order.md)).</span><span class="sxs-lookup"><span data-stu-id="4249e-104">When the application calls the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) functions, the system attempts to locate the DLL (for details, see [Dynamic-Link Library Search Order](dynamic-link-library-search-order.md)).</span></span> <span data-ttu-id="4249e-105">Si la búsqueda se realiza correctamente, el sistema asigna el módulo DLL en el espacio de direcciones virtuales del proceso e incrementa el recuento de referencias.</span><span class="sxs-lookup"><span data-stu-id="4249e-105">If the search succeeds, the system maps the DLL module into the virtual address space of the process and increments the reference count.</span></span> <span data-ttu-id="4249e-106">Si la llamada a **LoadLibrary** o **LoadLibraryEx** especifica un archivo dll cuyo código ya está asignado en el espacio de direcciones virtuales del proceso de llamada, la función devuelve simplemente un identificador a la dll e incrementa el recuento de referencias de dll.</span><span class="sxs-lookup"><span data-stu-id="4249e-106">If the call to **LoadLibrary** or **LoadLibraryEx** specifies a DLL whose code is already mapped into the virtual address space of the calling process, the function simply returns a handle to the DLL and increments the DLL reference count.</span></span> <span data-ttu-id="4249e-107">Tenga en cuenta que dos archivos DLL que tienen el mismo nombre y extensión de archivo base, pero que se encuentran en directorios diferentes, no se consideran el mismo archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="4249e-107">Note that two DLLs that have the same base file name and extension but are found in different directories are not considered to be the same DLL.</span></span>

<span data-ttu-id="4249e-108">El sistema llama a la función de punto de entrada en el contexto del subproceso que llamó a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="4249e-108">The system calls the entry-point function in the context of the thread that called [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="4249e-109">No se llama a la función de punto de entrada si el proceso ya cargó el archivo DLL a través de una llamada a **LoadLibrary** o **LoadLibraryEx** sin una llamada correspondiente a la función [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="4249e-109">The entry-point function is not called if the DLL was already loaded by the process through a call to **LoadLibrary** or **LoadLibraryEx** with no corresponding call to the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

<span data-ttu-id="4249e-110">Si el sistema no puede encontrar el archivo DLL o si la función de punto de entrada devuelve FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) devuelve NULL.</span><span class="sxs-lookup"><span data-stu-id="4249e-110">If the system cannot find the DLL or if the entry-point function returns FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns NULL.</span></span> <span data-ttu-id="4249e-111">Si **LoadLibrary** o **LoadLibraryEx** se realiza correctamente, devuelve un identificador al módulo DLL.</span><span class="sxs-lookup"><span data-stu-id="4249e-111">If **LoadLibrary** or **LoadLibraryEx** succeeds, it returns a handle to the DLL module.</span></span> <span data-ttu-id="4249e-112">El proceso puede utilizar este identificador para identificar el archivo DLL en una llamada a la función [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)o [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) .</span><span class="sxs-lookup"><span data-stu-id="4249e-112">The process can use this handle to identify the DLL in a call to the [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) function.</span></span>

<span data-ttu-id="4249e-113">La función [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) devuelve un identificador que se usa en [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)o [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="4249e-113">The [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) function returns a handle used in [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="4249e-114">La función **GetModuleHandle** solo se realiza correctamente si el módulo DLL ya está asignado en el espacio de direcciones del proceso mediante la vinculación en tiempo de carga o mediante una llamada anterior a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="4249e-114">The **GetModuleHandle** function succeeds only if the DLL module is already mapped into the address space of the process by load-time linking or by a previous call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="4249e-115">A diferencia de **LoadLibrary** o **LoadLibraryEx**, **GetModuleHandle** no incrementa el recuento de referencias del módulo.</span><span class="sxs-lookup"><span data-stu-id="4249e-115">Unlike **LoadLibrary** or **LoadLibraryEx**, **GetModuleHandle** does not increment the module reference count.</span></span> <span data-ttu-id="4249e-116">La función [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) recupera la ruta de acceso completa del módulo asociado a un identificador devuelto por **GetModuleHandle**, **LoadLibrary** o **LoadLibraryEx**.</span><span class="sxs-lookup"><span data-stu-id="4249e-116">The [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function retrieves the full path of the module associated with a handle returned by **GetModuleHandle**, **LoadLibrary**, or **LoadLibraryEx**.</span></span>

<span data-ttu-id="4249e-117">El proceso puede utilizar [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) para obtener la dirección de una función exportada en el archivo DLL mediante un identificador de módulo DLL devuelto por [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span><span class="sxs-lookup"><span data-stu-id="4249e-117">The process can use [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) to get the address of an exported function in the DLL using a DLL module handle returned by [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span></span>

<span data-ttu-id="4249e-118">Cuando el módulo DLL ya no se necesita, el proceso puede llamar a [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) o [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="4249e-118">When the DLL module is no longer needed, the process can call [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="4249e-119">Estas funciones disminuyen el recuento de referencias del módulo y desasocian el código DLL del espacio de direcciones virtuales del proceso si el recuento de referencias es cero.</span><span class="sxs-lookup"><span data-stu-id="4249e-119">These functions decrement the module reference count and unmap the DLL code from the virtual address space of the process if the reference count is zero.</span></span>

<span data-ttu-id="4249e-120">La vinculación dinámica en tiempo de ejecución permite que el proceso continúe ejecutándose incluso si un archivo DLL no está disponible.</span><span class="sxs-lookup"><span data-stu-id="4249e-120">Run-time dynamic linking enables the process to continue running even if a DLL is not available.</span></span> <span data-ttu-id="4249e-121">Después, el proceso puede utilizar un método alternativo para lograr su objetivo.</span><span class="sxs-lookup"><span data-stu-id="4249e-121">The process can then use an alternate method to accomplish its objective.</span></span> <span data-ttu-id="4249e-122">Por ejemplo, si un proceso no encuentra un archivo DLL, puede intentar usar otro o puede notificar al usuario de un error.</span><span class="sxs-lookup"><span data-stu-id="4249e-122">For example, if a process is unable to locate one DLL, it can try to use another, or it can notify the user of an error.</span></span> <span data-ttu-id="4249e-123">Si el usuario puede proporcionar la ruta de acceso completa del archivo DLL que falta, el proceso puede utilizar esta información para cargar el archivo DLL aunque no esté en la ruta de búsqueda normal.</span><span class="sxs-lookup"><span data-stu-id="4249e-123">If the user can provide the full path of the missing DLL, the process can use this information to load the DLL even though it is not in the normal search path.</span></span> <span data-ttu-id="4249e-124">Esta situación contrasta con la vinculación en tiempo de carga, en la que el sistema simplemente finaliza el proceso si no encuentra el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="4249e-124">This situation contrasts with load-time linking, in which the system simply terminates the process if it cannot find the DLL.</span></span>

<span data-ttu-id="4249e-125">La vinculación dinámica en tiempo de ejecución puede producir problemas si el archivo DLL utiliza la función [**DllMain**](dllmain.md) para realizar la inicialización de cada subproceso de un proceso, ya que no se llama al punto de entrada para los subprocesos que existían antes de que se llame a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) .</span><span class="sxs-lookup"><span data-stu-id="4249e-125">Run-time dynamic linking can cause problems if the DLL uses the [**DllMain**](dllmain.md) function to perform initialization for each thread of a process, because the entry-point is not called for threads that existed before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) is called.</span></span> <span data-ttu-id="4249e-126">Para ver un ejemplo en el que se muestra cómo solucionar este problema, vea [usar el almacenamiento local para el subproceso en una biblioteca de Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="4249e-126">For an example showing how to deal with this problem, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="4249e-127">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="4249e-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4249e-128">Usar la vinculación dinámica en tiempo de ejecución</span><span class="sxs-lookup"><span data-stu-id="4249e-128">Using Run-time Dynamic Linking</span></span>](using-run-time-dynamic-linking.md)
</dt> </dl>

 

 
