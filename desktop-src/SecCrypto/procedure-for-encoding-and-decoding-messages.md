---
description: Detalla el procedimiento para codificar un mensaje general.
ms.assetid: 554cab0d-cfa2-46a7-80d9-f41430eb4b47
title: Procedimiento para codificar y descodificar mensajes
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49da09c2318fffd3d1c92d6012055172709609a7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105687362"
---
# <a name="procedure-for-encoding-and-decoding-messages"></a><span data-ttu-id="a4f77-103">Procedimiento para codificar y descodificar mensajes</span><span class="sxs-lookup"><span data-stu-id="a4f77-103">Procedure for Encoding and Decoding Messages</span></span>

<span data-ttu-id="a4f77-104">El procedimiento para codificar un mensaje general es el siguiente.</span><span class="sxs-lookup"><span data-stu-id="a4f77-104">The procedure for encoding a general message is as follows.</span></span>

<span data-ttu-id="a4f77-105">**Para codificar un mensaje**</span><span class="sxs-lookup"><span data-stu-id="a4f77-105">**To encode a message**</span></span>

1.  <span data-ttu-id="a4f77-106">Inicializa las estructuras de datos adecuadas para el tipo de datos deseado.</span><span class="sxs-lookup"><span data-stu-id="a4f77-106">Initialize the appropriate data structures for the desired data type.</span></span>
2.  <span data-ttu-id="a4f77-107">Llame a [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), pasando los argumentos necesarios.</span><span class="sxs-lookup"><span data-stu-id="a4f77-107">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing the necessary arguments.</span></span> <span data-ttu-id="a4f77-108">Al llamar a **CryptMsgOpenToEncode**, si los datos que se van a proporcionar a [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) ya se han codificado por mensaje, pase el identificador de objeto adecuado en *pszInnerContentObjID* (por ejemplo, "1.2.840.113549.1.7.2" para szOID \_ RSA \_ signedData).</span><span class="sxs-lookup"><span data-stu-id="a4f77-108">When calling **CryptMsgOpenToEncode**, if the data that is to be provided to [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) has already been message-encoded, pass the appropriate object identifier in *pszInnerContentObjID* (for example, "1.2.840.113549.1.7.2" for szOID\_RSA\_signedData).</span></span> <span data-ttu-id="a4f77-109">Si *pszInnerContentObjID* es **null**, se supone que el tipo de [*contenido interno*](../secgloss/i-gly.md) no se ha codificado previamente y se procesa correctamente.</span><span class="sxs-lookup"><span data-stu-id="a4f77-109">If *pszInnerContentObjID* is **NULL**, the [*inner content*](../secgloss/i-gly.md) type is assumed not to have been previously encoded and is processed appropriately.</span></span>
3.  <span data-ttu-id="a4f77-110">Llame a [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) tantas veces como sea necesario para completar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="a4f77-110">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) as many times as necessary to complete the message.</span></span> <span data-ttu-id="a4f77-111">En la última llamada, establezca el parámetro *fFinal* en **true**.</span><span class="sxs-lookup"><span data-stu-id="a4f77-111">On the last call, set the *fFinal* parameter to **TRUE**.</span></span> <span data-ttu-id="a4f77-112">(Para obtener más información, consulte **CryptMsgUpdate**).</span><span class="sxs-lookup"><span data-stu-id="a4f77-112">(For details, see **CryptMsgUpdate**).</span></span>
4.  <span data-ttu-id="a4f77-113">Llame a [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) para obtener un puntero a los parámetros deseados, como el contenido.</span><span class="sxs-lookup"><span data-stu-id="a4f77-113">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="a4f77-114">Para codificar datos simples y generales, use \_ \_ el parámetro de contenido CMSG para el *dwParamtype*.</span><span class="sxs-lookup"><span data-stu-id="a4f77-114">For encoding simple, general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype*.</span></span>
5.  <span data-ttu-id="a4f77-115">Cierre el mensaje mediante una llamada a [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="a4f77-115">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="a4f77-116">Este procedimiento da como resultado un mensaje codificado de un tipo especificado en las llamadas de función.</span><span class="sxs-lookup"><span data-stu-id="a4f77-116">This procedure results in an encoded message of a type specified in the function calls.</span></span>

<span data-ttu-id="a4f77-117">El procedimiento para descodificar un mensaje general es el siguiente.</span><span class="sxs-lookup"><span data-stu-id="a4f77-117">The procedure for decoding a general message is as follows.</span></span>

<span data-ttu-id="a4f77-118">**Para descodificar un mensaje**</span><span class="sxs-lookup"><span data-stu-id="a4f77-118">**To decode a message**</span></span>

1.  <span data-ttu-id="a4f77-119">Determine la longitud necesaria para que el búfer contenga los datos codificados mediante [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span><span class="sxs-lookup"><span data-stu-id="a4f77-119">Determine the length needed for the buffer to hold the encoded data using [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span></span>
2.  <span data-ttu-id="a4f77-120">Llame a [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), pasando los argumentos necesarios.</span><span class="sxs-lookup"><span data-stu-id="a4f77-120">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span> <span data-ttu-id="a4f77-121">Para mantener la compatibilidad con Internet Explorer versión 3,0, se proporciona el parámetro *dwMsgType* .</span><span class="sxs-lookup"><span data-stu-id="a4f77-121">To maintain compatibility with Internet Explorer version 3.0, the *dwMsgType* parameter is provided.</span></span> <span data-ttu-id="a4f77-122">Los datos firmados creados en Internet Explorer 3,0 no contienen información de encabezado.</span><span class="sxs-lookup"><span data-stu-id="a4f77-122">Signed data created in Internet Explorer 3.0 does not contain header information.</span></span> <span data-ttu-id="a4f77-123">Por lo tanto, si este mensaje se extrae de las firmas de archivo, el tipo de mensaje se debe pasar a la función.</span><span class="sxs-lookup"><span data-stu-id="a4f77-123">Therefore, if such a message is extracted from file signatures, the message type must be passed into the function.</span></span> <span data-ttu-id="a4f77-124">Si se pasa cero al parámetro *dwMsgType* , la función leerá el tipo de mensaje del encabezado del mensaje.</span><span class="sxs-lookup"><span data-stu-id="a4f77-124">If zero is passed into the *dwMsgType* parameter, the function will read the message type from the header on the message.</span></span> <span data-ttu-id="a4f77-125">Si falta el encabezado, se producirá un error en la llamada de función.</span><span class="sxs-lookup"><span data-stu-id="a4f77-125">If the header is missing, the function call will fail.</span></span> <span data-ttu-id="a4f77-126">Si se realiza correctamente, se devuelve un identificador al mensaje abierto.</span><span class="sxs-lookup"><span data-stu-id="a4f77-126">If successful, a handle to the opened message is returned.</span></span>
3.  <span data-ttu-id="a4f77-127">Llame a [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) una vez.</span><span class="sxs-lookup"><span data-stu-id="a4f77-127">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once.</span></span> <span data-ttu-id="a4f77-128">Esto hace que se realicen las acciones adecuadas en el mensaje, en función del tipo de mensaje.</span><span class="sxs-lookup"><span data-stu-id="a4f77-128">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="a4f77-129">Para el procesamiento adicional del mensaje, como el descifrado adicional o la comprobación de la firma, llame a [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), pasando la acción deseada en *dwCtrlType*.</span><span class="sxs-lookup"><span data-stu-id="a4f77-129">For additional processing of the message, such as additional decryption or signature verification, call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing the desired action in *dwCtrlType*.</span></span>
5.  <span data-ttu-id="a4f77-130">Llame a [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) para obtener un puntero a los parámetros deseados, como el contenido.</span><span class="sxs-lookup"><span data-stu-id="a4f77-130">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="a4f77-131">Para descodificar datos generales simples, use \_ \_ el parámetro de contenido CMSG para el parámetro *dwParamtype* .</span><span class="sxs-lookup"><span data-stu-id="a4f77-131">To decode simple general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype* parameter.</span></span>
6.  <span data-ttu-id="a4f77-132">Llame a [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) para cerrar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="a4f77-132">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="a4f77-133">Para obtener un ejemplo en el que se implementan estos pasos, vea [programa C de ejemplo: codificar y descodificar datos](example-c-program-encoding-and-decoding-data.md).</span><span class="sxs-lookup"><span data-stu-id="a4f77-133">For an example that implements these steps, see [Example C Program: Encoding and Decoding Data](example-c-program-encoding-and-decoding-data.md).</span></span> <span data-ttu-id="a4f77-134">Para obtener información sobre los procedimientos y un ejemplo en el que se muestra el proceso de codificación, descodificación y comprobación de la firma de un mensaje firmado, vea el [ejemplo de programa C: firma, codificación, descodificación y comprobación de un mensaje](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span><span class="sxs-lookup"><span data-stu-id="a4f77-134">For procedures and an example demonstrating the process of encoding, decoding, and verifying the signature of a signed message, see [Example C Program: Signing, Encoding, Decoding, and Verifying a Message](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span></span>

 

 
