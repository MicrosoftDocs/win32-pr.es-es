---
description: Procesamiento de datos en una DMO
ms.assetid: 715482d9-23f4-40d0-9c09-7a81e148c543
title: Procesamiento de datos en una DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea9f5d5d820dc1467c25f9d411d46a9c66935e8b
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "103906670"
---
# <a name="processing-data-in-a-dmo"></a><span data-ttu-id="f1bfd-103">Procesamiento de datos en una DMO</span><span class="sxs-lookup"><span data-stu-id="f1bfd-103">Processing Data in a DMO</span></span>

<span data-ttu-id="f1bfd-104">En esta sección se explica cómo procesar un flujo de datos mediante DMO.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-104">This section explains how to process a stream of data using a DMO.</span></span> <span data-ttu-id="f1bfd-105">Los pasos enumerados en esta sección son el comportamiento predeterminado; todos los DMOs deben admitir los métodos que se describen aquí.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-105">The steps listed in this section are the default behavior; all DMOs must support the methods described here.</span></span> <span data-ttu-id="f1bfd-106">Estos métodos usan búferes independientes para la entrada y la salida.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-106">These methods use separate buffers for input and output.</span></span> <span data-ttu-id="f1bfd-107">Algunos DMOs también admiten el procesamiento en contexto mediante un único búfer.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-107">Some DMOs also support in-place processing, using a single buffer.</span></span> <span data-ttu-id="f1bfd-108">Para obtener más información sobre el procesamiento en contexto, consulte [procesamiento en contexto](in-place-processing.md).</span><span class="sxs-lookup"><span data-stu-id="f1bfd-108">For more information about in-place processing, see [In-Place Processing](in-place-processing.md).</span></span>

<span data-ttu-id="f1bfd-109">**Asignar búferes**</span><span class="sxs-lookup"><span data-stu-id="f1bfd-109">**Allocating Buffers**</span></span>

<span data-ttu-id="f1bfd-110">El cliente es responsable de toda la asignación de búfer.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-110">The client is responsible for all buffer allocation.</span></span> <span data-ttu-id="f1bfd-111">Después de establecer los tipos de medios en DMO, consulte en DMO los requisitos de búfer de cada secuencia.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-111">After you set the media types on the DMO, query the DMO for each stream's buffer requirements.</span></span> <span data-ttu-id="f1bfd-112">Estos pueden cambiar en función del tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-112">These can change depending on the media type.</span></span> <span data-ttu-id="f1bfd-113">Para cada flujo, llame al método [**IMediaObject:: GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) o [**IMediaObject:: GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-113">For each stream, call the [**IMediaObject::GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) or [**IMediaObject::GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) method.</span></span> <span data-ttu-id="f1bfd-114">Estos métodos devuelven la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="f1bfd-114">These methods return the following information:</span></span>

-   <span data-ttu-id="f1bfd-115">Tamaño mínimo del búfer, en bytes.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-115">Minimum buffer size, in bytes.</span></span>
-   <span data-ttu-id="f1bfd-116">Requisitos de alineación, si los hay.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-116">Alignment requirements, if any.</span></span> <span data-ttu-id="f1bfd-117">Un búfer se alinea si la dirección de inicio es un múltiplo de algún entero especificado.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-117">A buffer is aligned if the start address is a multiple of some specified integer.</span></span>
-   <span data-ttu-id="f1bfd-118">La cantidad máxima de datos que DMO conservará para la búsqueda anticipada.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-118">The maximum amount of data the DMO will hold for lookahead.</span></span> <span data-ttu-id="f1bfd-119">Este número se aplica solo a los flujos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-119">This number applies only to input streams.</span></span> <span data-ttu-id="f1bfd-120">En el caso de algunos tipos de datos (por ejemplo, codificación MPEG), es posible que un DMO tenga que buscar hacia delante en la secuencia.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-120">For some kinds of data (for example, MPEG encoding), a DMO might need to look forward in the stream.</span></span> <span data-ttu-id="f1bfd-121">El valor de búsqueda anticipada indica cuántos datos de entrada necesitará DMO antes de poder generar resultados.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-121">The lookahead value indicates how much input data the DMO will require before it can produce output.</span></span>

<span data-ttu-id="f1bfd-122">El cliente debe asignar búferes que coincidan con estos requisitos.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-122">The client must allocate buffers that match these requirements.</span></span> <span data-ttu-id="f1bfd-123">Además, DMO podría tener requisitos sobre cómo el cliente empaqueta los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-123">In addition, the DMO might have requirements about how the client packages the input data.</span></span> <span data-ttu-id="f1bfd-124">Por ejemplo, DMO podría requerir que cada búfer contenga exactamente un ejemplo (o fotograma de vídeo).</span><span class="sxs-lookup"><span data-stu-id="f1bfd-124">For example, the DMO might require each buffer to contain exactly one sample (or video frame).</span></span> <span data-ttu-id="f1bfd-125">Para determinar estos requisitos, llame al método [**IMediaObject:: GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-125">To determine these requirements, call the [**IMediaObject::GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) method.</span></span> <span data-ttu-id="f1bfd-126">El método [**IMediaObject:: GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) devuelve información similar sobre un flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-126">The [**IMediaObject::GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) method returns similar information about an output stream.</span></span>

<span data-ttu-id="f1bfd-127">En el modelo de streaming predeterminado, el cliente no pasa punteros de búfer sin formato a DMO.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-127">In the default streaming model, the client does not pass raw buffer pointers to the DMO.</span></span> <span data-ttu-id="f1bfd-128">En su lugar, utiliza un objeto COM ligero que expone la interfaz [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-128">Instead, it uses a lightweight COM object that exposes the [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) interface.</span></span> <span data-ttu-id="f1bfd-129">La interfaz **IMediaBuffer** actúa como un contenedor com para un bloque de memoria.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-129">The **IMediaBuffer** interface acts as a COM wrapper for a block of memory.</span></span> <span data-ttu-id="f1bfd-130">Dado que se trata de un objeto COM, admite el recuento de referencias, lo que ayuda a garantizar que los búferes no se liberen mientras se siguen usando.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-130">Because it is a COM object, it supports reference counting, which helps to ensure that buffers are not released while still in use.</span></span>

> [!Note]  
> <span data-ttu-id="f1bfd-131">La interfaz **IMediaBuffer** sirve para una función similar a la interfaz **IMediaSample** de DirectShow.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-131">The **IMediaBuffer** interface serves a function similar to the **IMediaSample** interface in DirectShow.</span></span>

 

<span data-ttu-id="f1bfd-132">El cliente debe implementar el objeto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-132">The client must implement the **IMediaBuffer** object.</span></span> <span data-ttu-id="f1bfd-133">Para obtener más información, consulte [implementación de IMediaBuffer](implementing-imediabuffer.md).</span><span class="sxs-lookup"><span data-stu-id="f1bfd-133">For more information, see [Implementing IMediaBuffer](implementing-imediabuffer.md).</span></span>

<span data-ttu-id="f1bfd-134">**Procesar los datos**</span><span class="sxs-lookup"><span data-stu-id="f1bfd-134">**Processing the Data**</span></span>

<span data-ttu-id="f1bfd-135">Para procesar datos, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f1bfd-135">To process data, do the following:</span></span>

1.  <span data-ttu-id="f1bfd-136">Para cada flujo de entrada, rellene un búfer con datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-136">For each input stream, fill a buffer with input data.</span></span>
2.  <span data-ttu-id="f1bfd-137">Llame a [**IMediaObject::P rocessinput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) para proporcionar cada búfer.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-137">Call [**IMediaObject::ProcessInput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) to deliver each buffer.</span></span>
3.  <span data-ttu-id="f1bfd-138">Llame a [**IMediaObject::P rocessoutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) para procesar los datos.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-138">Call [**IMediaObject::ProcessOutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) to process the data.</span></span> <span data-ttu-id="f1bfd-139">Este método toma una matriz de búferes, uno para cada flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-139">This method takes an array of buffers, one for each output stream.</span></span>
4.  <span data-ttu-id="f1bfd-140">Repita el procedimiento hasta que no haya más datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-140">Repeat until there is no more input data.</span></span>

<span data-ttu-id="f1bfd-141">El método **ProcessInput** acepta la entrada de un flujo cada vez.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-141">The **ProcessInput** method accepts input for one stream at a time.</span></span> <span data-ttu-id="f1bfd-142">Normalmente, el método vuelve inmediatamente y el DMO contiene un recuento de referencias en el objeto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-142">Typically the method returns immediately, and the DMO holds a reference count on the **IMediaBuffer** object.</span></span> <span data-ttu-id="f1bfd-143">Libera el objeto después de procesar todos los datos en el búfer, o cuando la aplicación vacía DMO.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-143">It releases the object after it processes all of the data in the buffer, or when the application flushes the DMO.</span></span> <span data-ttu-id="f1bfd-144">No vuelva a usar un búfer hasta que DMO lo haya liberado.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-144">Do not re-use a buffer until the DMO has released it.</span></span> <span data-ttu-id="f1bfd-145">Para determinar si un flujo de entrada puede aceptar más datos, llame al método [**IMediaObject:: GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-145">To determine whether an input stream can accept more data, call the [**IMediaObject::GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) method.</span></span> <span data-ttu-id="f1bfd-146">Este método devuelve la marca de datos de aceptación de STATUSF de entrada de DMO \_ \_ \_ \_ si la secuencia puede aceptar más entradas.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-146">This method returns the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA flag if the stream can accept more input.</span></span>

<span data-ttu-id="f1bfd-147">El método **ProcessOutput** genera una salida para todos los flujos de salida a la vez.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-147">The **ProcessOutput** method generates output for all of the output streams at once.</span></span> <span data-ttu-id="f1bfd-148">La aplicación pasa una matriz de estructuras [**de \_ \_ \_ búfer de datos de salida de DMO**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) , una para cada flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-148">The application passes in an array of [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) structures, one for each output stream.</span></span> <span data-ttu-id="f1bfd-149">Cada estructura de la matriz tiene un puntero a un objeto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-149">Each structure in the array has a pointer to an **IMediaBuffer** object.</span></span> <span data-ttu-id="f1bfd-150">DMO escribe tantos datos de salida como pueden en los búferes.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-150">The DMO writes as much output data as it can into the buffers.</span></span> <span data-ttu-id="f1bfd-151">También establece varias marcas para notificar el estado de la operación.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-151">It also sets various flags to report the status of the operation.</span></span> <span data-ttu-id="f1bfd-152">La marca de datos de salida de DMO \_ \_ \_ BUFFERF \_ incompleta indica que DMO puede generar más resultados a partir de la entrada existente.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-152">The DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE flag indicates the DMO can produce more output from the existing input.</span></span> <span data-ttu-id="f1bfd-153">En ese caso, el cliente puede volver a llamar a **ProcessOutput** .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-153">In that case, the client can call **ProcessOutput** again.</span></span> <span data-ttu-id="f1bfd-154">De lo contrario, debe llamar a **ProcessInput** con más datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-154">Otherwise, it should call **ProcessInput** with more input data.</span></span> <span data-ttu-id="f1bfd-155">DMO nunca modifica los datos de los búferes de entrada; escribe solo en los búferes de salida.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-155">The DMO never modifies the data in the input buffers; it writes only to the output buffers.</span></span>

<span data-ttu-id="f1bfd-156">Una vez que haya entregado todos los datos a un flujo de entrada, llame al método [**IMediaObject::D iscontinuity**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-156">After you have delivered all of the data to an input stream, call the [**IMediaObject::Discontinuity**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) method.</span></span> <span data-ttu-id="f1bfd-157">DMO no acepta ninguna entrada adicional a esa secuencia hasta que se procesa la salida restante (o se vacía el DMO).</span><span class="sxs-lookup"><span data-stu-id="f1bfd-157">The DMO does not accept further input to that stream until you process the remaining output (or flush the DMO).</span></span>

<span data-ttu-id="f1bfd-158">En cualquier momento después del inicio del streaming, DMO puede recibir entradas o producir salidas, o ambas cosas.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-158">At any point after streaming begins, the DMO is able to receive input or produce output, or both.</span></span> <span data-ttu-id="f1bfd-159">Por lo tanto, **GetInputStatus** devuelve los \_ datos de aceptación de \_ STATUSF de entrada de DMO \_ \_ o **ProcessOutput** devuelve datos de salida de DMO \_ \_ \_ BUFFERF \_ incompletos.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-159">Therefore, either **GetInputStatus** returns DMO\_INPUT\_STATUSF\_ACCEPT\_DATA, or **ProcessOutput** returns DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE.</span></span> <span data-ttu-id="f1bfd-160">La aplicación mantiene los datos en el flujo probando estas marcas y llamando a **ProcessInput** o **ProcessOutput** en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-160">The application keeps data flowing by testing for these flags and calling **ProcessInput** or **ProcessOutput** accordingly.</span></span> <span data-ttu-id="f1bfd-161">Para interrumpir el flujo de datos, llame al método [**IMediaObject:: Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) .</span><span class="sxs-lookup"><span data-stu-id="f1bfd-161">To interrupt the data flow, call the [**IMediaObject::Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) method.</span></span> <span data-ttu-id="f1bfd-162">Este método hace que DMO descarte todos los búferes que contiene internamente.</span><span class="sxs-lookup"><span data-stu-id="f1bfd-162">This method causes the DMO to discard any buffers it is holding internally.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f1bfd-163">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="f1bfd-163">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f1bfd-164">Hospedar directamente un DMO</span><span class="sxs-lookup"><span data-stu-id="f1bfd-164">Directly Hosting a DMO</span></span>](directly-hosting-a-dmo.md)
</dt> <dt>

[<span data-ttu-id="f1bfd-165">Procesamiento en contexto</span><span class="sxs-lookup"><span data-stu-id="f1bfd-165">In-Place Processing</span></span>](in-place-processing.md)
</dt> </dl>

 

 



