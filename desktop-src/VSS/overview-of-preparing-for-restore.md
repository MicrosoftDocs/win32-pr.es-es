---
description: Al preparar una restauración, un solicitante usa los documentos de metadatos del escritor almacenados junto con su propio documento de componentes de copia de seguridad recuperados para determinar qué se va a restaurar y cómo.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Información general sobre la preparación para la restauración
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fa9748ff3d6602695dfde703b020e10ab05791d5eeb3957d23a1d1a4fcb82cc2
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/11/2021
ms.locfileid: "118998165"
---
# <a name="overview-of-preparing-for-restore"></a>Información general sobre la preparación para la restauración

Al preparar una restauración, un solicitante usa los documentos de metadatos del escritor almacenados junto con su propio documento de componentes de copia de seguridad recuperados para determinar qué se va a restaurar y cómo. Para obtener más información, vea [Información general sobre el procesamiento de una restauración en VSS.](overview-of-processing-a-restore-under-vss.md)

Después de seleccionar los componentes candidatos para la restauración, los escritores que se ejecutan actualmente en el sistema acceden al documento de componentes de copia de seguridad del solicitante. Los escritores usan este acceso para indicar cómo causar dificultades mínimas para ejecutar servicios debido a la restauración.

Una vez completado esto, el solicitante tiene suficiente información para determinar qué archivos se deben restaurar, así como dónde y cómo se deben restaurar. (Para obtener más información, vea [Generar un conjunto de restauración).](generating-a-restore-set.md)

En la tabla siguiente se muestra la secuencia de acciones y eventos necesarios para prepararse para una operación de restauración.



| Acción del solicitante                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Evento                                                         | Acción del escritor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recupere información del documento componentes [](vssgloss-e.md) de copia de seguridad sobre los componentes incluidos explícitamente en la operación de copia de seguridad (vea [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) Examine los documentos de metadatos del escritor recuperados para obtener detalles sobre los componentes incluidos explícitamente en la copia de seguridad y cualquier búsqueda de [*subcomponentes*](vssgloss-i.md) incluidos implícitamente. (Vea [**IVssExgvWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)).<br/> | None                                                          | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Seleccione los componentes y los conjuntos de componentes que se restaurarán (vea [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) e [**IVssBackupComponents::AddRestoreSubcomponent).**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)                                                                                                                                                                                                                                                                                                                                                                                          | None                                                          | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| El solicitante permite al escritor actualizar el documento de componentes de copia de seguridad y, opcionalmente, puede comunicar al escritor cualquier opción de restauración especial. (Vea [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)e [**IVssBackupComponents::P reRestore).**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)                                                                                                                                                                                                                                         | [*PreRestore*](vssgloss-p.md) | El escritor determina la participación en la restauración, prepara los archivos para restaurar y, opcionalmente, modifica el documento de componentes de copia de seguridad si es necesario. (Vea [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)). |
| El solicitante espera a los escritores para controlar el [**evento PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con [**IVssAsync.**](/windows/desktop/api/Vss/nn-vss-ivssasync) También debe comprobar el estado del escritor. (Vea [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).                                                                                                                                                                                                                                                                                  | None                                                          | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Acciones del solicitante durante los preparativos de restauración

Para determinar qué componentes son candidatos para la restauración, el solicitante debe hacer lo siguiente:

-   Establezca el componente y la estructura [*del conjunto de componentes*](vssgloss-c.md) que se usa para realizar la copia de seguridad.
-   Examine la capacidad de selección [*de los componentes para restaurar*](vssgloss-s.md).
-   Use las directrices de selectability (Trabajar con[selectability for Restore and Subcomponents)](working-with-selectability-for-restore-and-subcomponents.md)para elegir los componentes que se incluirán.
-   Use la información [*del conjunto de archivos*](vssgloss-f.md) de componentes para determinar qué archivos del medio de copia de seguridad deben restaurarse.

Para ello, el solicitante debe examinar los componentes incluidos [*explícitamente*](vssgloss-e.md) en el documento de componentes de copia de seguridad almacenado. Esta información de componente está disponible en función del escritor mediante [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), que devuelve instancias de la interfaz [**IVssWriterComponentsExt,**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) desde las que se puede recuperar la información del sistema de escritura y las instancias de la interfaz [**IVssComponent.**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)

Como se indicó en otra parte [(](use-of-components-by-the-requestor.md)Uso de componentes por parte del solicitante ), el documento componentes de copia de seguridad y la interfaz **IVssComponent** no contienen suficiente información para admitir la copia de seguridad. Por lo tanto, el solicitante debe examinar el documento de metadatos del escritor almacenado correspondiente mediante [**IVssExgvWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (vea [Información de identificación del escritor).](writer-metadata-document-contents.md)

[**IVssExwriterMetadata::GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts)devuelve el número de componentes que administra cada escritor. A continuación, el solicitante puede usar [**IVssExgvWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) para obtener una [**interfaz IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) para cada componente que administra un escritor.

Mediante el examen [](vssgloss-s.md) de la capacidad de selección de los componentes para las rutas de acceso lógicas y de copia de seguridad [*(vea*](vssgloss-l.md) Trabajar con selectibilidad y rutas de acceso lógicas), [](working-with-selectability-and-logical-paths.md)un solicitante puede identificar los componentes que definieron conjuntos de componentes en tiempo de copia de seguridad (componentes incluidos explícitamente) y los miembros de subcomponentes de esos conjuntos (componentes incluidos implícitamente).

Los solicitantes indican a través del documento componentes de copia de seguridad si un componente se va a restaurar explícitamente, mediante [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). La elección del método dependerá de cómo se ha creado originalmente la copia de seguridad del componente y de su [*capacidad de selección para la restauración.*](vssgloss-s.md) Estos componentes incluidos explícitamente para la restauración designan otros componentes que se incluyen implícitamente (consulte [Working with Selectability for Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) para obtener más información).

Un solicitante puede incluir explícitamente ninguno de los componentes de escritor que se están ejecutando actualmente para la restauración mediante [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). En este caso, ese escritor no recibirá ningún evento VSS durante el resto de la operación de restauración.

Si se [**usa explícitamente IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) para seleccionar un componente de un escritor que no se está ejecutando actualmente, se devuelve un error VSS \_ E OBJECT NOT \_ \_ \_ FOUND. Vea [Restauraciones sin participación del escritor](restores-without-writer-participation.md) para obtener información sobre cómo restaurar los datos de los escritores que faltan.

Para permitir que un escritor tenga información completa sobre la que actuar, las opciones de restauración específicas del escritor y la indicación de una restauración incremental se pueden enviar a los escritores mediante llamadas del solicitante a [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) e [**IVssBackupComponents::SetAdditionalRestores,**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores)respectivamente.

En este momento, un solicitante ha finalizado su preparación y genera un evento **PreRestore** mediante una llamada a [**IVssBackupComponents::P reRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), lo que permite a los escritores prepararse para la restauración real.

## <a name="writer-actions-during-restore-preparations"></a>Acciones de escritura durante los preparativos de restauración

La preparación del escritor para la operación de restauración se produce al controlar el evento [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con el método virtual [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore). La implementación predeterminada simplemente devuelve sin realizar ninguna acción. Los escritores pueden optar por invalidar la implementación predeterminada para ejercer más control mediante:

-   Invalidar métodos [*de restauración con*](vssgloss-r.md) [*destinos de restauración*](vssgloss-r.md)
-   Definición [ *de destinos dirigidos*](vssgloss-d.md)
-   Creación de mensajes de error y datos adicionales
-   Proporcionar información de marca de copia de seguridad

El controlador de eventos [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) recibe una instancia de [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), de la que puede obtener interfaces [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para los de sus componentes incluidos explícitamente en el documento componentes de copia de seguridad durante la copia de seguridad.

Información sobre los subcomponentes incluidos implícitamente en las operaciones de copia de seguridad e incluidos explícitamente en las restauraciones mediante una instancia de **IVssComponent** correspondiente al componente que definió su conjunto de componentes de copia de [*seguridad*](vssgloss-c.md).

El [**método IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) se usa para determinar si se va a restaurar un componente de copia de seguridad incluido explícitamente.

Para determinar si un subcomponente de copia de seguridad se incluyó explícitamente en la restauración, los escritores usan [**IVssComponent::GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

El sistema de escritura debe examinar [*el conjunto de archivos*](vssgloss-f.md) de cada componente y determinar si debe realizar acciones para admitir la restauración. El sistema de escritura tendrá que evaluar si desea que se sobrescriban sus archivos actuales o si requerirá la restauración en nuevas ubicaciones. Las acciones pueden incluir lo siguiente:

-   Obtener y actuar en cualquier opción específica del escritor o solicitante que rige las operaciones de restauración (vea [**IVssComponent::GetRestoreOptions)**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions)
-   Cerrar y hacer que se pueda escribir cualquier archivo abierto actualmente
-   Actualización del destino de restauración (por ejemplo, para forzar la restauración a una asignación de ubicación alternativa). Vea [**IVssComponent::SetRestoreTarget.**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget)
-   Comunicación con el solicitante a través de metadatos privados (vea [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Lo que indica que se debe restaurar un archivo mediante la remapping a través de la definición de destinos dirigidos [*(vea*](vssgloss-d.md) [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))

La instancia de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) usada será la creada por la inclusión explícita del componente en el documento de componentes de copia de seguridad durante la copia de seguridad, o bien la del componente que define el conjunto de componentes de copia de seguridad del que era miembro (vea Working [with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
