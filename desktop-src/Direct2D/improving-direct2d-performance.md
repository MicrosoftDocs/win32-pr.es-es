---
title: Mejorar el rendimiento de las aplicaciones de Direct2D
description: Describe técnicas para mejorar el rendimiento de Direct2D.
ms.assetid: e6b02925-4e75-42b0-b0c4-00f1ddb85e46
keywords:
- Direct2D, rendimiento
- Direct2D, mapas de bits
- Direct2D, uso de recursos
- Direct2D, método Flush
- Direct2D, contenido estático
- rendimiento de Direct2D
- mapas de bits para Direct2D
- Direct2D, interoperación de GDI
- Direct2D, interoperabilidad
- interoperabilidad, Direct2D
- Interfaz de dispositivo gráfico (GDI)
- GDI (Interfaz de dispositivo gráfico)
- interoperabilidad, Interfaz de dispositivo gráfico (GDI)
ms.topic: article
ms.date: 05/31/2018
ms.custom: seodec18
ms.openlocfilehash: 5a413b96e00514b64b3cf1b1ee451a84a9e9ff09
ms.sourcegitcommit: 6eb53540b8d882fd035d428567d7d1c5ec17042c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/12/2020
ms.locfileid: "104488477"
---
# <a name="improving-the-performance-of-direct2d-apps"></a><span data-ttu-id="8f4fd-116">Mejorar el rendimiento de las aplicaciones de Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-116">Improving the performance of Direct2D apps</span></span>

<span data-ttu-id="8f4fd-117">Aunque [Direct2D](./direct2d-portal.md) tiene aceleración de hardware y está pensado para un alto rendimiento, debe usar las características correctamente para maximizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-117">Although [Direct2D](./direct2d-portal.md) is hardware accelerated and is meant for high performance, you must use the features correctly to maximize throughput.</span></span> <span data-ttu-id="8f4fd-118">Las técnicas que se muestran aquí se derivan del estudio de escenarios comunes y es posible que no se apliquen a todos los escenarios de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-118">The techniques we show here are derived from studying common scenarios and might not apply to all app scenarios.</span></span> <span data-ttu-id="8f4fd-119">Por lo tanto, una comprensión minuciosa del comportamiento de la aplicación y de los objetivos de rendimiento puede ayudarle a lograr los resultados que desea.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-119">Therefore, careful understanding of app behavior and performance goals can help achieve the results that you want.</span></span>

-   [<span data-ttu-id="8f4fd-120">Uso de recursos</span><span class="sxs-lookup"><span data-stu-id="8f4fd-120">Resource usage</span></span>](#resource-usage)
    -   [<span data-ttu-id="8f4fd-121">Reutilizar recursos</span><span class="sxs-lookup"><span data-stu-id="8f4fd-121">Reuse resources</span></span>](#reuse-resources)
-   [<span data-ttu-id="8f4fd-122">Restringir el uso de Flush</span><span class="sxs-lookup"><span data-stu-id="8f4fd-122">Restrict the use of flush</span></span>](#restrict-the-use-of-flush)
-   [<span data-ttu-id="8f4fd-123">Mapas de bits</span><span class="sxs-lookup"><span data-stu-id="8f4fd-123">Bitmaps</span></span>](#create-large-bitmaps)
    -   [<span data-ttu-id="8f4fd-124">Crear mapas de bits grandes</span><span class="sxs-lookup"><span data-stu-id="8f4fd-124">Create large bitmaps</span></span>](#create-large-bitmaps)
    -   [<span data-ttu-id="8f4fd-125">Crear un Atlas de mapas de bits</span><span class="sxs-lookup"><span data-stu-id="8f4fd-125">Create an atlas of bitmaps</span></span>](#create-an-atlas-of-bitmaps)
    -   [<span data-ttu-id="8f4fd-126">Crear mapas de bits compartidos</span><span class="sxs-lookup"><span data-stu-id="8f4fd-126">Create shared bitmaps</span></span>](#create-shared-bitmaps)
    -   [<span data-ttu-id="8f4fd-127">Copiar mapas de bits</span><span class="sxs-lookup"><span data-stu-id="8f4fd-127">Copying bitmaps</span></span>](#copying-bitmaps)
-   [<span data-ttu-id="8f4fd-128">Usar un mapa de bits en mosaico en guiones</span><span class="sxs-lookup"><span data-stu-id="8f4fd-128">Use tiled bitmap over dashing</span></span>](#use-tiled-bitmap-over-dashing)
-   [<span data-ttu-id="8f4fd-129">Directrices generales para la representación de contenido estático complejo</span><span class="sxs-lookup"><span data-stu-id="8f4fd-129">General guidelines for rendering complex static content</span></span>](#general-guidelines-for-rendering-complex-static-content)
    -   [<span data-ttu-id="8f4fd-130">Almacenamiento en caché completo de escenas con un mapa de bits de color</span><span class="sxs-lookup"><span data-stu-id="8f4fd-130">Full scene caching using a color bitmap</span></span>](#full-scene-caching-using-a-color-bitmap)
    -   [<span data-ttu-id="8f4fd-131">Por almacenamiento en caché primitivo mediante un mapa de bits A8 y el método FillOpacityMask</span><span class="sxs-lookup"><span data-stu-id="8f4fd-131">Per primitive caching using an A8 bitmap and the FillOpacityMask method</span></span>](#per-primitive-caching-using-an-a8-bitmap-and-the-fillopacitymask-method)
-   [<span data-ttu-id="8f4fd-132">Almacenamiento en caché por primitivo mediante la realización de geometría</span><span class="sxs-lookup"><span data-stu-id="8f4fd-132">Per-primitive caching using geometry realizations</span></span>](#per-primitive-caching-using-geometry-realizations)
-   [<span data-ttu-id="8f4fd-133">Representación de geometría</span><span class="sxs-lookup"><span data-stu-id="8f4fd-133">Geometry rendering</span></span>](#geometry-rendering)
    -   [<span data-ttu-id="8f4fd-134">Usar una primitiva de dibujo específica sobre la geometría de dibujo</span><span class="sxs-lookup"><span data-stu-id="8f4fd-134">Use specific draw primitive over draw geometry</span></span>](#use-specific-draw-primitive-over-draw-geometry)
    -   [<span data-ttu-id="8f4fd-135">Representación de geometría estática</span><span class="sxs-lookup"><span data-stu-id="8f4fd-135">Rendering static geometry</span></span>](#rendering-static-geometry)
    -   [<span data-ttu-id="8f4fd-136">Usar un contexto de dispositivo multiproceso</span><span class="sxs-lookup"><span data-stu-id="8f4fd-136">Use a multithreaded device context</span></span>](#use-a-multithreaded-device-context)
-   [<span data-ttu-id="8f4fd-137">Dibujar texto con Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-137">Drawing text with Direct2D</span></span>](#use-a-multithreaded-device-context)
    -   [<span data-ttu-id="8f4fd-138">DrawTextLayout frente a DrawText</span><span class="sxs-lookup"><span data-stu-id="8f4fd-138">DrawTextLayout Vs. DrawText</span></span>](#drawtextlayout-vs-drawtext)
    -   [<span data-ttu-id="8f4fd-139">Elección del modo de representación de texto correcto</span><span class="sxs-lookup"><span data-stu-id="8f4fd-139">Choosing the right text rendering mode</span></span>](#choosing-the-right-text-rendering-mode)
    -   [<span data-ttu-id="8f4fd-140">Almacenamiento en caché</span><span class="sxs-lookup"><span data-stu-id="8f4fd-140">Caching</span></span>](#full-scene-caching-using-a-color-bitmap)
-   [<span data-ttu-id="8f4fd-141">Recortar una forma arbitraria</span><span class="sxs-lookup"><span data-stu-id="8f4fd-141">Clipping an arbitrary shape</span></span>](#clipping-an-arbitrary-shape)
    -   [<span data-ttu-id="8f4fd-142">PushLayer en Windows 8</span><span class="sxs-lookup"><span data-stu-id="8f4fd-142">PushLayer in Windows 8</span></span>](#pushlayer-in-windows-8)
    -   [<span data-ttu-id="8f4fd-143">Clips alineados con el eje</span><span class="sxs-lookup"><span data-stu-id="8f4fd-143">Axis-aligned clips</span></span>](#axis-aligned-clips)
-   [<span data-ttu-id="8f4fd-144">Interoperabilidad de DXGI: evitar modificadores frecuentes</span><span class="sxs-lookup"><span data-stu-id="8f4fd-144">DXGI interoperability: avoid frequent switches</span></span>](#dxgi-interoperability-avoid-frequent-switches)
-   [<span data-ttu-id="8f4fd-145">Conozca el formato de píxel</span><span class="sxs-lookup"><span data-stu-id="8f4fd-145">Know Your Pixel Format</span></span>](#know-your-pixel-format)
-   [<span data-ttu-id="8f4fd-146">Complejidad de la escena</span><span class="sxs-lookup"><span data-stu-id="8f4fd-146">Scene Complexity</span></span>](#scene-complexity)
    -   [<span data-ttu-id="8f4fd-147">Descripción de la complejidad de la escena</span><span class="sxs-lookup"><span data-stu-id="8f4fd-147">Understand Scene Complexity</span></span>](#understand-scene-complexity)
-   [<span data-ttu-id="8f4fd-148">Mejorar el rendimiento de las aplicaciones de impresión en Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-148">Improving performance for Direct2D printing apps</span></span>](#improving-performance-for-direct2d-printing-apps)
    -   [<span data-ttu-id="8f4fd-149">Establecer los valores de propiedad correctos al crear el control de impresión D2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-149">Set the right property values when you create the D2D print control</span></span>](#set-the-right-property-values-when-you-create-the-d2d-print-control)
    -   [<span data-ttu-id="8f4fd-150">Evite usar determinados patrones de dibujo de Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-150">Avoid using certain Direct2D drawing patterns</span></span>](#avoid-using-certain-direct2d-drawing-patterns)
    -   [<span data-ttu-id="8f4fd-151">Dibujar texto de forma directa y sin formato</span><span class="sxs-lookup"><span data-stu-id="8f4fd-151">Draw text in a direct and plain way</span></span>](#draw-text-in-a-direct-and-plain-way)
    -   [<span data-ttu-id="8f4fd-152">Dibujar los mapas de bits originales siempre que sea posible</span><span class="sxs-lookup"><span data-stu-id="8f4fd-152">Draw the original bitmaps when possible</span></span>](#draw-the-original-bitmaps-when-possible)
-   [<span data-ttu-id="8f4fd-153">Conclusión</span><span class="sxs-lookup"><span data-stu-id="8f4fd-153">Conclusion</span></span>](#conclusion)

## <a name="resource-usage"></a><span data-ttu-id="8f4fd-154">Uso de recursos</span><span class="sxs-lookup"><span data-stu-id="8f4fd-154">Resource usage</span></span>

<span data-ttu-id="8f4fd-155">Un recurso es una asignación de algún tipo, ya sea en la memoria de vídeo o del sistema.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-155">A resource is an allocation of some kind, either in video or system memory.</span></span> <span data-ttu-id="8f4fd-156">Los mapas de bits y los pinceles son ejemplos de recursos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-156">Bitmaps and brushes are examples of resources.</span></span>

<span data-ttu-id="8f4fd-157">En Direct2D, los recursos se pueden crear en software y hardware.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-157">In Direct2D, resources can be created both in software and hardware.</span></span> <span data-ttu-id="8f4fd-158">La creación y eliminación de recursos en el hardware son operaciones costosas porque requieren una gran sobrecarga para la comunicación con la tarjeta de vídeo.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-158">Resource creation and deletion on hardware are expensive operations because they require lots of overhead for communicating with the video card.</span></span> <span data-ttu-id="8f4fd-159">Veamos cómo Direct2D representa el contenido en un destino.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-159">Let's see how Direct2D renders content to a target.</span></span>

<span data-ttu-id="8f4fd-160">En Direct2D, todos los comandos de representación se incluyen entre una llamada a [**BeginDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) y una llamada a [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-160">In Direct2D, all the rendering commands are enclosed between a call to [**BeginDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) and a call to [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw).</span></span> <span data-ttu-id="8f4fd-161">Estas llamadas se realizan a un destino de representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-161">These calls are made to a render target.</span></span> <span data-ttu-id="8f4fd-162">Debe llamar al método **BeginDraw** antes de llamar a las operaciones de representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-162">You must call the **BeginDraw** method before you call rendering operations .</span></span> <span data-ttu-id="8f4fd-163">Después de llamar a **BeginDraw** , un contexto normalmente crea un lote de comandos de representación, pero retrasa el procesamiento de estos comandos hasta que una de estas instrucciones sea verdadera:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-163">After you call **BeginDraw** , a context typically builds up a batch of rendering commands, but delays processing of these commands until one of these statements is true:</span></span>

-   <span data-ttu-id="8f4fd-164">Error de [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-164">[**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) occurred.</span></span> <span data-ttu-id="8f4fd-165">Cuando se llama a **EndDraw** , hace que todas las operaciones de dibujo por lotes se completen y devuelva el estado de la operación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-165">When **EndDraw** is called, it causes any batched drawing operations to complete and returns the status of the operation.</span></span>
-   <span data-ttu-id="8f4fd-166">Realiza una llamada explícita a [**Flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush): el método **Flush** hace que el lote se procese y se emitan todos los comandos pendientes.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-166">You make an explicit call to [**Flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush): The **Flush** method causes the batch to be processed and all pending commands to be issued.</span></span>
-   <span data-ttu-id="8f4fd-167">El búfer que contiene los comandos de representación está lleno.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-167">The buffer holding the rendering commands is full.</span></span> <span data-ttu-id="8f4fd-168">Si este búfer se llena antes de que se cumplan las dos condiciones anteriores, los comandos de representación se vacían.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-168">If this buffer becomes full before the previous two conditions are fulfilled, the rendering commands are flushed out.</span></span>

<span data-ttu-id="8f4fd-169">Hasta que se vacíen los primitivos, Direct2D mantiene las referencias internas a los recursos correspondientes, como mapas de bits y pinceles.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-169">Until the primitives are flushed, Direct2D keeps internal references to corresponding resources like bitmaps and brushes.</span></span>

### <a name="reuse-resources"></a><span data-ttu-id="8f4fd-170">Reutilizar recursos</span><span class="sxs-lookup"><span data-stu-id="8f4fd-170">Reuse resources</span></span>

<span data-ttu-id="8f4fd-171">Como ya se mencionó, la creación y eliminación de recursos es costosa en hardware.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-171">As already mentioned, resource creation and deletion is expensive on hardware.</span></span> <span data-ttu-id="8f4fd-172">Por tanto, reutilice los recursos siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-172">So reuse resources when possible.</span></span> <span data-ttu-id="8f4fd-173">Tome el ejemplo de creación de mapas de bits en el desarrollo de juegos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-173">Take the example of bitmap creation in game development.</span></span> <span data-ttu-id="8f4fd-174">Normalmente, los mapas de bits que componen una escena en un juego se crean al mismo tiempo con todas las variaciones que son necesarias para la representación de fotogramas de fotogramas posterior.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-174">Usually, bitmaps that make up a scene in a game are all created at the same time with all the different variations that are required for later frame-to-frame rendering.</span></span> <span data-ttu-id="8f4fd-175">En el momento de la representación y rerepresentación de la escena real, estos mapas de bits se reutilizan en lugar de volver a crearlos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-175">At the time of actual scene rendering and re-rendering, these bitmaps are reused instead of re-created.</span></span>

> [!Note]  
> <span data-ttu-id="8f4fd-176">No se pueden volver a usar los recursos para la operación de cambiar el tamaño de la ventana.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-176">You can't reuse resources for the window resize operation.</span></span> <span data-ttu-id="8f4fd-177">Cuando se cambia el tamaño de una ventana, algunos recursos dependientes de la escala, como los destinos de representación compatibles y, posiblemente, algunos recursos de capa se deben volver a crear porque se debe volver a dibujar el contenido de la ventana.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-177">When a window is resized, some scale-dependent resources such as compatible render targets and possibly some layer resources must be re-created because the window content has to be redrawn.</span></span> <span data-ttu-id="8f4fd-178">Esto puede ser importante para mantener la calidad general de la escena representada.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-178">This can be important for maintaining the overall quality of the rendered scene.</span></span>

 

## <a name="restrict-the-use-of-flush"></a><span data-ttu-id="8f4fd-179">Restringir el uso de Flush</span><span class="sxs-lookup"><span data-stu-id="8f4fd-179">Restrict the use of flush</span></span>

<span data-ttu-id="8f4fd-180">Dado que el método [**Flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush) hace que se procesen los comandos de representación por lotes, se recomienda no usarlos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-180">Because the [**Flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush) method causes the batched rendering commands to be processed, we recommend that you don't use it.</span></span> <span data-ttu-id="8f4fd-181">Para los escenarios más comunes, deje la administración de recursos en Direct2D.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-181">For most common scenarios, leave resource management to Direct2D.</span></span>

## <a name="bitmaps"></a><span data-ttu-id="8f4fd-182">Mapas de bits</span><span class="sxs-lookup"><span data-stu-id="8f4fd-182">Bitmaps</span></span>

<span data-ttu-id="8f4fd-183">Como se mencionó anteriormente, la creación y eliminación de recursos son operaciones muy costosas en el hardware.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-183">As mentioned earlier, resource creation and deletion are very expensive operations in hardware.</span></span> <span data-ttu-id="8f4fd-184">Un mapa de bits es un tipo de recurso que se usa con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-184">A bitmap is a kind of resource that is used often.</span></span> <span data-ttu-id="8f4fd-185">La creación de mapas de bits en la tarjeta de vídeo es costosa.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-185">Creating bitmaps on the video card is expensive.</span></span> <span data-ttu-id="8f4fd-186">La reutilización puede ayudar a agilizar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-186">Reusing them can help make the application faster.</span></span>

### <a name="create-large-bitmaps"></a><span data-ttu-id="8f4fd-187">Crear mapas de bits grandes</span><span class="sxs-lookup"><span data-stu-id="8f4fd-187">Create large bitmaps</span></span>

<span data-ttu-id="8f4fd-188">Las tarjetas de vídeo suelen tener un tamaño mínimo de asignación de memoria.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-188">Video cards typically have a minimum memory allocation size.</span></span> <span data-ttu-id="8f4fd-189">Si se solicita una asignación menor que esta, se asigna un recurso de este tamaño mínimo y la memoria excedente se desperdicia y no está disponible para otras cosas.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-189">If an allocation is requested that is smaller than this, a resource of this minimum size is allocated and the surplus memory is wasted and unavailable for other things.</span></span> <span data-ttu-id="8f4fd-190">Si necesita muchos mapas de bits pequeños, una técnica mejor consiste en asignar un mapa de bits grande y almacenar todo el contenido del mapa de bits pequeño en este mapa de bits grande.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-190">If you need many small bitmaps, a better technique is to allocate one large bitmap and store all the small bitmap contents in this large bitmap.</span></span> <span data-ttu-id="8f4fd-191">A continuación, se pueden leer las subáreas del mapa de bits más grande donde se necesiten los mapas de bits más pequeños.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-191">Then subareas of the larger bitmap can be read where the smaller bitmaps are needed.</span></span> <span data-ttu-id="8f4fd-192">A menudo, debe incluir el relleno (píxeles negros transparentes) entre los mapas de bits pequeños para evitar cualquier interacción entre las imágenes más pequeñas durante las operaciones.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-192">Often, you should include padding (transparent black pixels) in between the small bitmaps to avoid any interaction between the smaller images during operations.</span></span> <span data-ttu-id="8f4fd-193">Esto también se conoce como *Atlas* y tiene la ventaja de reducir la sobrecarga de creación de mapas de bits y los residuos de memoria de pequeñas asignaciones de mapas de bits.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-193">This is also known as an *atlas*, and it has the benefit of reducing bitmap creation overhead and the memory waste of small bitmap allocations.</span></span> <span data-ttu-id="8f4fd-194">Le recomendamos que mantenga la mayoría de los mapas de bits en al menos 64 KB y limite el número de mapas de bits que tienen menos de 4 KB.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-194">We recommend that you keep most bitmaps to at least 64 KB and limit the number of bitmaps that are smaller than 4 KB.</span></span>

### <a name="create-an-atlas-of-bitmaps"></a><span data-ttu-id="8f4fd-195">Crear un Atlas de mapas de bits</span><span class="sxs-lookup"><span data-stu-id="8f4fd-195">Create an atlas of bitmaps</span></span>

<span data-ttu-id="8f4fd-196">Hay algunos escenarios comunes en los que un Atlas de mapas de bits puede servir muy bien.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-196">There are some common scenarios for which a bitmap atlas can serve very well.</span></span> <span data-ttu-id="8f4fd-197">Los mapas de bits pequeños se pueden almacenar en un mapa de bits grande.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-197">Small bitmaps can be stored inside a large bitmap.</span></span> <span data-ttu-id="8f4fd-198">Estos mapas de bits pequeños se pueden extraer del mapa de bits más grande cuando se necesitan especificando el rectángulo de destino.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-198">These small bitmaps can be pulled out of the larger bitmap when you need them by specifying the destination rectangle.</span></span> <span data-ttu-id="8f4fd-199">Por ejemplo, una aplicación tiene que dibujar varios iconos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-199">For example, an application has to draw multiple icons.</span></span> <span data-ttu-id="8f4fd-200">Todos los mapas de bits asociados a los iconos se pueden cargar en un mapa de bits de gran tamaño.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-200">All the bitmaps associated with the icons can be loaded into a large bitmap up front.</span></span> <span data-ttu-id="8f4fd-201">Y en el momento de la representación, se pueden recuperar del mapa de bits grande.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-201">And at rendering time, they can be retrieved from the large bitmap.</span></span>

> [!Note]  
> <span data-ttu-id="8f4fd-202">Un mapa de bits de Direct2D creado en la memoria de vídeo se limita al tamaño máximo de mapa de bits admitido por el adaptador en el que se almacena.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-202">A Direct2D bitmap created in video memory is limited to the maximum bitmap size supported by the adapter on which it is stored.</span></span> <span data-ttu-id="8f4fd-203">La creación de un mapa de bits mayor que esto podría producir un error.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-203">Creating a bitmap larger than that might result in an error.</span></span>

 

> [!Note]  
> <span data-ttu-id="8f4fd-204">A partir de Windows 8, Direct2D incluye un [efecto de Atlas](atlas.md) que puede facilitar este proceso.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-204">Starting in Windows 8, Direct2D includes an [Atlas effect](atlas.md) that can make this process easier.</span></span>

 

### <a name="create-shared-bitmaps"></a><span data-ttu-id="8f4fd-205">Crear mapas de bits compartidos</span><span class="sxs-lookup"><span data-stu-id="8f4fd-205">Create shared bitmaps</span></span>

<span data-ttu-id="8f4fd-206">La creación de mapas de bits compartidos permite a los autores de llamadas avanzados crear objetos de mapa de bits de Direct2D que están respaldados directamente por un objeto existente, ya compatibles con el destino de representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-206">Creating shared bitmaps enables advanced callers to create Direct2D bitmap objects that are backed directly by an existing object, already compatible with the render target.</span></span> <span data-ttu-id="8f4fd-207">Esto evita la creación de varias superficies y ayuda a reducir la sobrecarga de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-207">This avoids creating multiple surfaces and helps in reducing performance overhead.</span></span>

> [!Note]  
> <span data-ttu-id="8f4fd-208">Normalmente, los mapas de bits compartidos se limitan a los destinos de software o a los destinos interoperables con DXGI.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-208">Shared bitmaps are usually limited to software targets or to targets interoperable with DXGI.</span></span> <span data-ttu-id="8f4fd-209">Use los métodos [**CreateBitmapFromDxgiSurface**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromdxgisurface(idxgisurface_constd2d1_bitmap_properties1_id2d1bitmap1)), [**CreateBitmapFromWicBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1))y [**CreateSharedBitmap**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsharedbitmap) para crear mapas de bits compartidos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-209">Use the [**CreateBitmapFromDxgiSurface**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromdxgisurface(idxgisurface_constd2d1_bitmap_properties1_id2d1bitmap1)), [**CreateBitmapFromWicBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1)), and [**CreateSharedBitmap**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsharedbitmap) methods to create shared bitmaps.</span></span>

 

### <a name="copying-bitmaps"></a><span data-ttu-id="8f4fd-210">Copiar mapas de bits</span><span class="sxs-lookup"><span data-stu-id="8f4fd-210">Copying bitmaps</span></span>

<span data-ttu-id="8f4fd-211">Crear una superficie de DXGI es una operación costosa, por lo que puede reutilizar las superficies existentes cuando sea posible.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-211">Creating a DXGI surface is an expensive operation so reuse existing surfaces when you can.</span></span> <span data-ttu-id="8f4fd-212">Incluso en el software, si un mapa de bits está principalmente en el formato que desea, salvo en el caso de una pequeña parte, es mejor actualizar esa parte que para producir todo el mapa de bits y volver a crear todo.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-212">Even in software, if a bitmap is mostly in the form you want except for a small portion, it is better to update that portion than to throw the whole bitmap away and re-create everything.</span></span> <span data-ttu-id="8f4fd-213">Aunque puede usar [**CreateCompatibleRenderTarget**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) para lograr los mismos resultados, la representación suele ser una operación mucho más costosa que copiar.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-213">Although you can use [**CreateCompatibleRenderTarget**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) to achieve the same results, rendering is generally a much more expensive operation than copying.</span></span> <span data-ttu-id="8f4fd-214">Esto se debe a que, para mejorar la ubicación de la memoria caché, el hardware no almacena realmente un mapa de bits en el mismo orden de memoria al que se dirige el mapa de bits.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-214">This is because, to improve cache locality, the hardware doesn't actually store a bitmap in the same memory order that the bitmap is addressed.</span></span> <span data-ttu-id="8f4fd-215">En su lugar, el mapa de bits podría ser swizzled.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-215">Instead, the bitmap might be swizzled.</span></span> <span data-ttu-id="8f4fd-216">El permutación está oculto en la CPU, ya sea por el controlador (que es lento y se usa solo en partes inferiores), o por el administrador de memoria de la GPU.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-216">The swizzling is hidden from the CPU either by the driver (which is slow and used only on lower-end parts), or by the memory manager on the GPU.</span></span> <span data-ttu-id="8f4fd-217">Debido a las restricciones sobre cómo se escriben los datos en un destino de representación durante la representación, los destinos de representación normalmente no son swizzled o swizzled de una manera menos óptima que se puede lograr si sabe que nunca tiene que representarse en la superficie.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-217">Because of constraints on how data is written into a render target when rendering, render targets are typically either not swizzled, or swizzled in a way that is less optimal than can be achieved if you know that you never have to render to the surface.</span></span> <span data-ttu-id="8f4fd-218">Por lo tanto [](/windows/desktop/api/d2d1/nn-d2d1-id2d1bitmap) , \* se proporcionan los métodos CopyFrom para copiar los rectángulos de un origen al mapa de bits de Direct2D.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-218">Therefore, the [CopyFrom](/windows/desktop/api/d2d1/nn-d2d1-id2d1bitmap)\* methods are provided for copying rectangles from a source to the Direct2D bitmap.</span></span>

<span data-ttu-id="8f4fd-219">CopyFrom se puede usar en cualquiera de las tres formas siguientes:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-219">CopyFrom can be used in any of its three forms:</span></span>

-   [<span data-ttu-id="8f4fd-220">**CopyFromBitmap**</span><span class="sxs-lookup"><span data-stu-id="8f4fd-220">**CopyFromBitmap**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrombitmap)
-   [<span data-ttu-id="8f4fd-221">**CopyFromRenderTarget**</span><span class="sxs-lookup"><span data-stu-id="8f4fd-221">**CopyFromRenderTarget**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfromrendertarget)
-   [<span data-ttu-id="8f4fd-222">**CopyFromMemory**</span><span class="sxs-lookup"><span data-stu-id="8f4fd-222">**CopyFromMemory**</span></span>](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrommemory)

## <a name="use-tiled-bitmap-over-dashing"></a><span data-ttu-id="8f4fd-223">Usar un mapa de bits en mosaico en guiones</span><span class="sxs-lookup"><span data-stu-id="8f4fd-223">Use tiled bitmap over dashing</span></span>

<span data-ttu-id="8f4fd-224">La representación de una línea discontinua es una operación muy costosa debido a la alta calidad y la precisión del algoritmo subyacente.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-224">Rendering a dashed line is a very expensive operation because of the high quality and accuracy of the underlying algorithm.</span></span> <span data-ttu-id="8f4fd-225">Para la mayoría de los casos que no implican geometrías rectilíneas, se puede generar el mismo efecto más rápido mediante el uso de mapas de bits en mosaico.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-225">For most of the cases not involving rectilinear geometries, the same effect can be generated faster by using tiled bitmaps.</span></span>

## <a name="general-guidelines-for-rendering-complex-static-content"></a><span data-ttu-id="8f4fd-226">Directrices generales para la representación de contenido estático complejo</span><span class="sxs-lookup"><span data-stu-id="8f4fd-226">General guidelines for rendering complex static content</span></span>

<span data-ttu-id="8f4fd-227">Contenido de la memoria caché si se representa el mismo marco de contenido sobre el marco, especialmente cuando la escena es compleja.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-227">Cache content if you render the same content frame over frame, especially when the scene is complex.</span></span>

<span data-ttu-id="8f4fd-228">Hay tres técnicas de almacenamiento en caché que puede usar:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-228">There are three caching techniques that you can use:</span></span>

-   <span data-ttu-id="8f4fd-229">Almacenamiento en caché completo de escenas con un mapa de bits de color.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-229">Full scene caching using a color bitmap.</span></span>
-   <span data-ttu-id="8f4fd-230">Por almacenamiento en caché primitivo mediante un mapa de bits A8 y el método [**FillOpacityMask**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-fillopacitymask(id2d1bitmap_id2d1brush_constd2d1_rect_f_constd2d1_rect_f)) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-230">Per primitive caching using an A8 bitmap and the [**FillOpacityMask**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-fillopacitymask(id2d1bitmap_id2d1brush_constd2d1_rect_f_constd2d1_rect_f)) method.</span></span>
-   <span data-ttu-id="8f4fd-231">Almacenamiento en caché por primitivo mediante la realización de geometría.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-231">Per-primitive caching using geometry realizations.</span></span>

<span data-ttu-id="8f4fd-232">Echemos un vistazo a cada uno de ellos con más detalle.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-232">Let's look at each of these in more detail.</span></span>

### <a name="full-scene-caching-using-a-color-bitmap"></a><span data-ttu-id="8f4fd-233">Almacenamiento en caché completo de escenas con un mapa de bits de color</span><span class="sxs-lookup"><span data-stu-id="8f4fd-233">Full scene caching using a color bitmap</span></span>

<span data-ttu-id="8f4fd-234">Al representar contenido estático, en escenarios como animación, cree otro mapa de bits de color completo en lugar de escribir directamente en el mapa de bits de la pantalla.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-234">When you render static content, in scenarios like animation, create another full color bitmap instead of writing directly to the screen bitmap.</span></span> <span data-ttu-id="8f4fd-235">Guarde el destino actual, establezca el destino en el mapa de bits intermedio y represente el contenido estático.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-235">Save the current target, set target to the intermediate bitmap, and render the static content.</span></span> <span data-ttu-id="8f4fd-236">A continuación, vuelva al mapa de bits de la pantalla original y dibuje el mapa de bits intermedio en él.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-236">Then, switch back to the original screen bitmap and draw the intermediate bitmap on it.</span></span>

<span data-ttu-id="8f4fd-237">Este es un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-237">Here's an example:</span></span>


```C++
// Create a bitmap.
m_d2dContext->CreateBitmap(size, nullptr, 0,
    D2D1::BitmapProperties(
        D2D1_BITMAP_OPTIONS_TARGET,
        D2D1::PixelFormat(
            DXGI_FORMAT_B8G8R8A8_UNORM,
            D2D1_ALPHA_MODE_PREMULTIPLIED),
        dpiX, dpiY),
    &sceneBitmap);

// Preserve the pre-existing target.
ComPtr<ID2D1Image> oldTarget;
m_d2dContext->GetTarget(&oldTarget);

// Render static content to the sceneBitmap.
m_d2dContext->SetTarget(sceneBitmap.Get());
m_d2dContext->BeginDraw();
…
m_d2dContext->EndDraw();

// Render sceneBitmap to oldTarget.
m_d2dContext->SetTarget(oldTarget.Get());
m_d2dContext->DrawBitmap(sceneBitmap.Get());
```



<span data-ttu-id="8f4fd-238">En este ejemplo se usan mapas de bits intermedios para el almacenamiento en caché y se cambia el mapa de bits al que apunta el contexto de dispositivo cuando se representa.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-238">This example uses intermediate bitmaps for caching and switches the bitmap that the device context points to when it renders.</span></span> <span data-ttu-id="8f4fd-239">Esto evita la necesidad de crear un destino de representación compatible con el mismo propósito.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-239">This avoids the need to create a compatible render target for the same purpose.</span></span>

### <a name="per-primitive-caching-using-an-a8-bitmap-and-the-fillopacitymask-method"></a><span data-ttu-id="8f4fd-240">Por almacenamiento en caché primitivo mediante un mapa de bits A8 y el método FillOpacityMask</span><span class="sxs-lookup"><span data-stu-id="8f4fd-240">Per primitive caching using an A8 bitmap and the FillOpacityMask method</span></span>

<span data-ttu-id="8f4fd-241">Cuando la escena completa no es estática, pero se compone de elementos como Geometry o Text que son estáticos, puede usar una técnica de almacenamiento en caché por primitiva.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-241">When the full scene is not static, but consists of elements like geometry or text that are static, you can use a per primitive caching technique.</span></span> <span data-ttu-id="8f4fd-242">Esta técnica conserva las características de suavizado de contorno de la primitiva que se almacenan en caché y funciona con los tipos de pincel cambiantes.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-242">This technique preserves the antialiasing characteristics of the primitive being cached and works with changing brush types.</span></span> <span data-ttu-id="8f4fd-243">Utiliza un mapa de bits A8 donde A8 es un tipo de formato de píxel que representa un canal alfa con 8 bits.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-243">It uses an A8 bitmap where A8 is a kind of pixel format which represents an alpha channel with 8 bits.</span></span> <span data-ttu-id="8f4fd-244">Los mapas de bits A8 son útiles para dibujar geometría o texto como una máscara.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-244">A8 bitmaps are useful for drawing geometry/text as a mask.</span></span> <span data-ttu-id="8f4fd-245">Cuando debe manipular la opacidad del contenido estático, en lugar de manipular el contenido, puede trasladar, girar, sesgar o escalar la opacidad de la máscara.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-245">When you must manipulate the opacity of static content , instead of manipulating the content itself, you can translate, rotate, skew, or scale the opacity of the mask.</span></span>

<span data-ttu-id="8f4fd-246">Este es un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-246">Here's an example:</span></span>


```C++
// Create an opacity bitmap.
m_d2dContext->CreateBitmap(size, nullptr, 0,
    D2D1::BitmapProperties(
        D2D1_BITMAP_OPTIONS_TARGET,
        D2D1::PixelFormat(
            DXGI_FORMAT_A8_UNORM,
            D2D1_ALPHA_MODE_PREMULTIPLIED),
        dpiX, dpiY),
    &opacityBitmap);

// Preserve the pre-existing target.
ComPtr<ID2D1Image> oldTarget;
m_d2dContext->GetTarget(&oldTarget);

// Render to the opacityBitmap.
m_d2dContext->SetTarget(opacityBitmap.Get());
m_d2dContext->BeginDraw();
…
m_d2dContext->EndDraw();

// Call the FillOpacityMask method
// Note: for this call to work correctly the anti alias mode must be D2D1_ANTIALIAS_MODE_ALIASED. 
m_d2dContext->SetTarget(oldTarget.Get());
m_d2dContext->FillOpacityMask(
    opacityBitmap.Get(),
    m_contentBrush().Get(),
    D2D1_OPACITY_MASK_CONTENT_GRAPHICS);
```



## <a name="per-primitive-caching-using-geometry-realizations"></a><span data-ttu-id="8f4fd-247">Almacenamiento en caché por primitivo mediante la realización de geometría</span><span class="sxs-lookup"><span data-stu-id="8f4fd-247">Per-primitive caching using geometry realizations</span></span>

<span data-ttu-id="8f4fd-248">Otra técnica de almacenamiento en caché por primitivo, denominada Geometry conversiones, proporciona mayor flexibilidad al tratar con Geometry.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-248">Another per-primitive caching technique, called geometry realizations, provides greater flexibility when dealing with geometry.</span></span> <span data-ttu-id="8f4fd-249">Si desea dibujar repetidamente geometrías con alias o suavizado de contorno, es más rápido convertirlas en conversiones de geometría y dibujar repetidas veces las supuestos que se van a dibujar repetidamente las propias geometrías.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-249">When you want to repeatedly draw aliased or anti-aliased geometries, it is faster to convert them to geometry realizations and repeatedly draw the realizations than it is to repeatedly draw the geometries themselves.</span></span> <span data-ttu-id="8f4fd-250">Las contrataciones de geometría también utilizan normalmente menos memoria que las máscaras de opacidad (especialmente para las geometrías grandes) y son menos sensibles a los cambios de escala.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-250">Geometry realizations also generally consume less memory than opacity masks (especially for large geometries), and they are less sensitive to changes in scale.</span></span> <span data-ttu-id="8f4fd-251">Para obtener más información, vea [información general sobre la realización de geometrías](geometry-realizations-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-251">For more information, see [Geometry Realizations Overview](geometry-realizations-overview.md).</span></span>

<span data-ttu-id="8f4fd-252">Este es un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-252">Here's an example:</span></span>


```C++
    // Compute a flattening tolerance based on the scales at which the realization will be used.
    float flatteningTolerance = D2D1::ComputeFlatteningTolerance(...);

    ComPtr<ID2D1GeometryRealization> geometryRealization;

    // Create realization of the filled interior of the geometry.
    m_d2dDeviceContext1->CreateFilledGeometryRealization(
        geometry.Get(),
        flatteningTolerance,
        &geometryRealization
        );

    // In your app's rendering code, draw the geometry realization with a brush.
    m_d2dDeviceContext1->BeginDraw();
    m_d2dDeviceContext1->DrawGeometryRealization(
        geometryRealization.Get(),
        m_brush.Get()
        );
    m_d2dDeviceContext1->EndDraw();
```



## <a name="geometry-rendering"></a><span data-ttu-id="8f4fd-253">Representación de geometría</span><span class="sxs-lookup"><span data-stu-id="8f4fd-253">Geometry rendering</span></span>

### <a name="use-specific-draw-primitive-over-draw-geometry"></a><span data-ttu-id="8f4fd-254">Usar una primitiva de dibujo específica sobre la geometría de dibujo</span><span class="sxs-lookup"><span data-stu-id="8f4fd-254">Use specific draw primitive over draw geometry</span></span>

<span data-ttu-id="8f4fd-255">Usar llamadas *primitivas* Draw más específicas como [**DrawRectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawrectangle(constd2d1_rect_f__id2d1brush_float_id2d1strokestyle)) sobre llamadas [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry) genéricas.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-255">Use more specific draw *primitive* calls like [**DrawRectangle**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawrectangle(constd2d1_rect_f__id2d1brush_float_id2d1strokestyle)) over generic [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry) calls.</span></span> <span data-ttu-id="8f4fd-256">Esto se debe a que with **DrawRectangle**, la geometría ya se conoce, por lo que la representación es más rápida.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-256">This is because with **DrawRectangle**, the geometry is already known so rendering is faster.</span></span>

### <a name="rendering-static-geometry"></a><span data-ttu-id="8f4fd-257">Representación de geometría estática</span><span class="sxs-lookup"><span data-stu-id="8f4fd-257">Rendering static geometry</span></span>

<span data-ttu-id="8f4fd-258">En escenarios en los que la geometría sea estática, use las técnicas de almacenamiento en caché por primitivos explicadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-258">In scenarios where the geometry is static, use the per-primitive caching techniques explained above.</span></span> <span data-ttu-id="8f4fd-259">Las máscaras de opacidad y las supuestos de geometría pueden mejorar considerablemente la velocidad de representación de escenas que contienen geometría estática.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-259">Opacity masks and geometry realizations can greatly improve the rendering speed of scenes that contain static geometry..</span></span>

### <a name="use-a-multithreaded-device-context"></a><span data-ttu-id="8f4fd-260">Usar un contexto de dispositivo multiproceso</span><span class="sxs-lookup"><span data-stu-id="8f4fd-260">Use a multithreaded device context</span></span>

<span data-ttu-id="8f4fd-261">Las aplicaciones que esperan presentar grandes cantidades de contenido geométrico complejo deben considerar la posibilidad de especificar las [**Opciones de contexto de dispositivo D2D1 habilitar la marca de \_ \_ \_ \_ \_ \_ \_ optimizaciones multiproceso**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_device_context_options) al crear un contexto de dispositivo de [Direct2D](./direct2d-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-261">Applications that expect to render significant amounts of complex geometric content should consider specifying the [**D2D1\_DEVICE\_CONTEXT\_OPTIONS\_ENABLE\_MULTI\_THREADED\_OPTIMIZATIONS**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_device_context_options) flag when creating a [Direct2D](./direct2d-portal.md) device context.</span></span> <span data-ttu-id="8f4fd-262">Cuando se especifica esta marca, Direct2D distribuirá la representación en todos los núcleos lógicos presentes en el sistema, lo que puede reducir significativamente el tiempo de representación global.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-262">When this flag is specified, Direct2D will distribute rendering across all of the logical cores present on the system, which can significantly decrease overall rendering time.</span></span>

<span data-ttu-id="8f4fd-263">Notas:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-263">Notes:</span></span>

-   <span data-ttu-id="8f4fd-264">A partir de Windows 8.1, esta marca solo afecta a la representación de geometría de ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-264">As of Windows 8.1, this flag only affects path geometry rendering.</span></span> <span data-ttu-id="8f4fd-265">No tiene ningún impacto en las escenas que solo contienen otros tipos primitivos (como texto, mapas de bits o realización de geometría).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-265">It has no impact on scenes containing only other primitive types (such as text, bitmaps, or geometry realizations).</span></span>
-   <span data-ttu-id="8f4fd-266">Esta marca tampoco tiene ningún impacto en la representación en software (es decir, cuando se representa con un dispositivo Direct3D de ALABEo).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-266">This flag also has no impact when rendering in software (i.e. when rendering with a WARP Direct3D device).</span></span> <span data-ttu-id="8f4fd-267">Para controlar el multithreading de software, los autores de la llamada deben usar la \_ marca D3D11 crear \_ dispositivo \_ impedir las \_ \_ optimizaciones de subprocesos internas \_ al crear el dispositivo Direct3D de alabeo.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-267">To control software multithreading, callers should use the D3D11\_CREATE\_DEVICE\_PREVENT\_INTERNAL\_THREADING\_OPTIMIZATIONS flag when creating the WARP Direct3D device.</span></span>
-   <span data-ttu-id="8f4fd-268">Si se especifica este marcador, se puede aumentar el espacio de trabajo máximo durante la representación y también se puede aumentar la contención de subprocesos en aplicaciones que ya aprovechan el procesamiento multiproceso.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-268">Specifying this flag can increase peak working set during rendering and can also increase thread contention in applications that already take advantage of multithreaded processing.</span></span>

## <a name="drawing-text-with-direct2d"></a><span data-ttu-id="8f4fd-269">Dibujar texto con Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-269">Drawing text with Direct2D</span></span>

<span data-ttu-id="8f4fd-270">La funcionalidad de representación de texto de Direct2D se ofrece en dos partes.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-270">Direct2D text rendering functionality is offered in two parts.</span></span> <span data-ttu-id="8f4fd-271">La primera parte, expuesta como el método [**ID2D1RenderTarget::D rawtext**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) y [**ID2D1RenderTarget::D rawtextlayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) , permite que un llamador pase una cadena y parámetros de formato o un objeto de diseño de texto DWrite para varios formatos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-271">The first part, exposed as the [**ID2D1RenderTarget::DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) and [**ID2D1RenderTarget::DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) method, enables a caller to pass either a string and formatting parameters or a DWrite text layout object for multiple formats.</span></span> <span data-ttu-id="8f4fd-272">Debe ser adecuado para la mayoría de los llamadores.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-272">This should be suitable for most callers.</span></span> <span data-ttu-id="8f4fd-273">La segunda manera de representar texto, expuesta como el método [**ID2D1RenderTarget::D rawglyphrun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) , proporciona rasterización para los clientes que ya conocen la posición de los glifos que desean representar.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-273">The second way to render text, exposed as the [**ID2D1RenderTarget::DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) method, provides rasterization for customers who already know the position of the glyphs they want to render.</span></span> <span data-ttu-id="8f4fd-274">Las dos reglas generales siguientes pueden ayudar a mejorar el rendimiento del texto al dibujar en Direct2D.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-274">The following two general rules can help improve text performance when drawing in Direct2D.</span></span>

### <a name="drawtextlayout-vs-drawtext"></a><span data-ttu-id="8f4fd-275">DrawTextLayout frente a DrawText</span><span class="sxs-lookup"><span data-stu-id="8f4fd-275">DrawTextLayout Vs. DrawText</span></span>

<span data-ttu-id="8f4fd-276">Tanto [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) como [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) permiten a una aplicación representar fácilmente texto con formato de la API de [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-276">Both [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) and [**DrawTextLayout**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) enable an application to easily render text that is formatted by the [DirectWrite](/windows/desktop/DirectWrite/direct-write-portal) API.</span></span> <span data-ttu-id="8f4fd-277">**DrawTextLayout** dibuja un objeto [**DWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) existente en [**RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget)y **DrawText** crea un diseño de DirectWrite para el llamador, basándose en los parámetros que se pasan.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-277">**DrawTextLayout** draws an existing [**DWriteTextLayout**](/windows/desktop/api/dwrite/nn-dwrite-idwritetextlayout) object to the [**RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget), and **DrawText** constructs a DirectWrite layout for the caller, based on the parameters that are passed in.</span></span> <span data-ttu-id="8f4fd-278">Si el mismo texto se tiene que representar varias veces, use **DrawTextLayout** en lugar de **DrawText**, porque **DrawText** crea un diseño cada vez que se llama.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-278">If the same text has to be rendered multiple times, use **DrawTextLayout** instead of **DrawText**, because **DrawText** creates a layout every time that it is called.</span></span>

### <a name="choosing-the-right-text-rendering-mode"></a><span data-ttu-id="8f4fd-279">Elección del modo de representación de texto correcto</span><span class="sxs-lookup"><span data-stu-id="8f4fd-279">Choosing the right text rendering mode</span></span>

<span data-ttu-id="8f4fd-280">Establezca el modo de suavizado de contorno de texto en el modo de [**\_ \_ desalias de texto \_ \_ D2D1**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_text_antialias_mode) de forma explícita.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-280">Set the text antialias mode to [**D2D1\_TEXT\_ANTIALIAS\_MODE\_GRAYSCALE**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_text_antialias_mode) explicitly.</span></span> <span data-ttu-id="8f4fd-281">La calidad de la representación de texto de escala de grises es comparable a ClearType pero es mucho más rápida.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-281">The quality of rendering grayscale text is comparable to ClearType but is much faster.</span></span>

### <a name="caching"></a><span data-ttu-id="8f4fd-282">Almacenamiento en memoria caché</span><span class="sxs-lookup"><span data-stu-id="8f4fd-282">Caching</span></span>

<span data-ttu-id="8f4fd-283">Use la escena completa o el almacenamiento en caché de mapas de bits primitivo como con el dibujo de otros primitivos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-283">Use full scene or per primitive bitmap caching like with drawing other primitives.</span></span>

## <a name="clipping-an-arbitrary-shape"></a><span data-ttu-id="8f4fd-284">Recortar una forma arbitraria</span><span class="sxs-lookup"><span data-stu-id="8f4fd-284">Clipping an arbitrary shape</span></span>

<span data-ttu-id="8f4fd-285">En la ilustración siguiente se muestra el resultado de aplicar un clip a una imagen.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-285">The figure here shows the result of applying a clip to an image.</span></span>

![imagen que muestra un ejemplo de una imagen antes y después de un clip.](images/clip.png)

<span data-ttu-id="8f4fd-287">Puede obtener este resultado mediante el uso de capas con una máscara de geometría o el método [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) con un pincel de opacidad.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-287">You can get this result by using layers with a geometry mask or the [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) method with an opacity brush.</span></span>

<span data-ttu-id="8f4fd-288">A continuación se muestra un ejemplo en el que se usa una capa:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-288">Here's an example that uses a layer:</span></span>


```C++
// Call PushLayer() and pass in the clipping geometry.
m_d2dContext->PushLayer(
    D2D1::LayerParameters(
        boundsRect,
        geometricMask));
```



<span data-ttu-id="8f4fd-289">Este es un ejemplo que usa el método [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) :</span><span class="sxs-lookup"><span data-stu-id="8f4fd-289">Here's an example that uses the [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) method:</span></span>


```C++
// Create an opacity bitmap and render content.
m_d2dContext->CreateBitmap(size, nullptr, 0,
    D2D1::BitmapProperties(
        D2D1_BITMAP_OPTIONS_TARGET,
        D2D1::PixelFormat(
            DXGI_FORMAT_A8_UNORM,
            D2D1_ALPHA_MODE_PREMULTIPLIED),
        dpiX, dpiY),
    &opacityBitmap);

m_d2dContext->SetTarget(opacityBitmap.Get());
m_d2dContext->BeginDraw();
…
m_d2dContext->EndDraw();

// Create an opacity brush from the opacity bitmap.
m_d2dContext->CreateBitmapBrush(opacityBitmap.Get(),
    D2D1::BitmapBrushProperties(),
    D2D1::BrushProperties(),
    &bitmapBrush);

// Call the FillGeometry method and pass in the clip geometry and the opacity brush
m_d2dContext->FillGeometry( 
    clipGeometry.Get(),
    brush.Get(),
    opacityBrush.Get()); 
```



<span data-ttu-id="8f4fd-290">En este ejemplo de código, cuando se llama al método PushLayer, no se pasa una capa creada de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-290">In this code example, when you call the PushLayer method, you don't pass in an app created layer.</span></span> <span data-ttu-id="8f4fd-291">Direct2D crea una capa.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-291">Direct2D creates a layer for you.</span></span> <span data-ttu-id="8f4fd-292">Direct2D es capaz de administrar la asignación y destrucción de este recurso sin ninguna implicación de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-292">Direct2D is able to manage the allocation and destruction of this resource without any involvement from the app.</span></span> <span data-ttu-id="8f4fd-293">Esto permite a Direct2D volver a usar las capas internamente y aplicar optimizaciones de administración de recursos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-293">This allows Direct2D to reuse layers internally and apply resource management optimizations.</span></span>

<span data-ttu-id="8f4fd-294">En Windows 8 se han realizado muchas optimizaciones para el uso de capas y se recomienda intentar usar las API de capa en lugar de [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-294">In Windows 8 many optimizations have been made to the usage of layers and we recommend you try using layer APIs instead of [**FillGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) whenever possible.</span></span>

### <a name="pushlayer-in-windows-8"></a><span data-ttu-id="8f4fd-295">PushLayer en Windows 8</span><span class="sxs-lookup"><span data-stu-id="8f4fd-295">PushLayer in Windows 8</span></span>

<span data-ttu-id="8f4fd-296">La interfaz [**ID2D1DeviceContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1devicecontext) se deriva de la interfaz [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) y es la clave para mostrar el contenido de Direct2D en Windows 8. para obtener más información sobre esta interfaz, consulte [dispositivos y contextos de dispositivos](devices-and-device-contexts.md).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-296">The [**ID2D1DeviceContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1devicecontext) interface is derived from the [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) interface and is key to displaying Direct2D content in Windows 8, for more information about this interface see [Devices and Device Contexts](devices-and-device-contexts.md).</span></span> <span data-ttu-id="8f4fd-297">Con la interfaz de contexto del dispositivo, puede omitir la llamada al método [**CreateLayer**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createlayer(id2d1layer)) y, a continuación, pasar null al método [**ID2D1DeviceContext::P ushlayer**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-pushlayer(constd2d1_layer_parameters1_id2d1layer)) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-297">With the device context interface, you can skip calling the [**CreateLayer**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createlayer(id2d1layer)) method and then pass NULL to the [**ID2D1DeviceContext::PushLayer**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-pushlayer(constd2d1_layer_parameters1_id2d1layer)) method.</span></span> <span data-ttu-id="8f4fd-298">Direct2D administra automáticamente el recurso de capa y puede compartir recursos entre capas y gráficos de efectos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-298">Direct2D automatically manages the layer resource and can share resources between layers and effect graphs.</span></span>

### <a name="axis-aligned-clips"></a><span data-ttu-id="8f4fd-299">Clips alineados con el eje</span><span class="sxs-lookup"><span data-stu-id="8f4fd-299">Axis-aligned clips</span></span>

<span data-ttu-id="8f4fd-300">Si la región que se va a recortar se alinea con el eje de la superficie de dibujo, en lugar de arbitrario.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-300">If the region to be clipped is aligned to the axis of the drawing surface, instead of arbitrary.</span></span> <span data-ttu-id="8f4fd-301">Este caso es adecuado para usar un rectángulo de recorte en lugar de una capa.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-301">This case is suited for using a clip rectangle instead of a layer.</span></span> <span data-ttu-id="8f4fd-302">La ganancia de rendimiento es más para la geometría con alias que la geometría con suavizado de contorno.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-302">The performance gain is more for aliased geometry than antialiased geometry.</span></span> <span data-ttu-id="8f4fd-303">Para obtener más información sobre los clips alineados del eje, vea el tema [**PushAxisAlignedClip**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-303">For more info on axis aligned clips, see the [**PushAxisAlignedClip**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)) topic.</span></span>

## <a name="dxgi-interoperability-avoid-frequent-switches"></a><span data-ttu-id="8f4fd-304">Interoperabilidad de DXGI: evitar modificadores frecuentes</span><span class="sxs-lookup"><span data-stu-id="8f4fd-304">DXGI interoperability: avoid frequent switches</span></span>

<span data-ttu-id="8f4fd-305">Direct2D puede interoperar sin problemas con las superficies de Direct3D.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-305">Direct2D can interoperate seamlessly with Direct3D surfaces.</span></span> <span data-ttu-id="8f4fd-306">Esto es muy útil para crear aplicaciones que presentan una mezcla de contenido 2D y 3D.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-306">This is very useful for creating applications that render a mixture of 2D and 3D content.</span></span> <span data-ttu-id="8f4fd-307">Pero cada cambio entre dibujar contenido de Direct2D y Direct3D afecta al rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-307">But each switch between drawing Direct2D and Direct3D content affects performance.</span></span>

<span data-ttu-id="8f4fd-308">Al representar en una superficie de DXGI, Direct2D guarda el estado de los dispositivos de Direct3D durante su representación y lo restaura cuando se completa la representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-308">When rendering to a DXGI surface, Direct2D saves the state of the Direct3D devices while rendering and restores it when rendering is completed.</span></span> <span data-ttu-id="8f4fd-309">Cada vez que se completa un lote de representación de Direct2D, se paga el costo de esta operación de guardar y restaurar y el costo de vaciar todas las operaciones 2D y, sin embargo, el dispositivo Direct3D no se vacía.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-309">Every time that a batch of Direct2D rendering is completed, the cost of this save and restore and the cost of flushing all the 2D operations are paid, and yet, the Direct3D device is not flushed.</span></span> <span data-ttu-id="8f4fd-310">Por lo tanto, para aumentar el rendimiento, limite el número de conmutadores de representación entre Direct2D y Direct3D.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-310">Therefore, to increase performance, limit the number of rendering switches between Direct2D and Direct3D.</span></span>

## <a name="know-your-pixel-format"></a><span data-ttu-id="8f4fd-311">Conozca el formato de píxel</span><span class="sxs-lookup"><span data-stu-id="8f4fd-311">Know Your Pixel Format</span></span>

<span data-ttu-id="8f4fd-312">Al crear un destino de representación, puede usar la estructura [**de \_ \_ formato de píxel de D2D1**](/windows/desktop/api/dcommon/ns-dcommon-d2d1_pixel_format) para especificar el formato de píxel y el modo alfa utilizados por el destino de representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-312">When you create a render target, you can use the [**D2D1\_PIXEL\_FORMAT**](/windows/desktop/api/dcommon/ns-dcommon-d2d1_pixel_format) structure specify the pixel format and alpha mode used by the render target.</span></span> <span data-ttu-id="8f4fd-313">Un canal alfa forma parte del formato de píxel que especifica el valor de cobertura o la información de opacidad.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-313">An alpha channel is part of the pixel format that specifies the coverage value or opacity information.</span></span> <span data-ttu-id="8f4fd-314">Si un destino de representación no utiliza el canal alfa, debe crearse mediante el modo [**alfa D2D1 \_ \_ \_ omitir**](/windows/desktop/api/dcommon/ne-dcommon-d2d1_alpha_mode) el modo alfa.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-314">If a render target does not use the alpha channel, it should be created by using the [**D2D1\_ALPHA\_MODE\_IGNORE**](/windows/desktop/api/dcommon/ne-dcommon-d2d1_alpha_mode) alpha mode.</span></span> <span data-ttu-id="8f4fd-315">Esto revierte el tiempo dedicado a la representación de un canal alfa que no es necesario.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-315">This spares the time that is spent on rendering an alpha channel that is not needed.</span></span>

<span data-ttu-id="8f4fd-316">Para obtener más información sobre los formatos de píxeles y los modos alfa, vea [formatos de píxeles compatibles y modos alfa](supported-pixel-formats-and-alpha-modes.md).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-316">For more information about pixel formats and alpha modes, see [Supported Pixel Formats and Alpha Modes](supported-pixel-formats-and-alpha-modes.md).</span></span>

## <a name="scene-complexity"></a><span data-ttu-id="8f4fd-317">Complejidad de la escena</span><span class="sxs-lookup"><span data-stu-id="8f4fd-317">Scene Complexity</span></span>

<span data-ttu-id="8f4fd-318">Cuando se analizan las zonas activas de rendimiento en una escena que se va a representar, se sabe si la escena está limitada por el límite de velocidad de relleno o el límite de vértices puede proporcionar información útil.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-318">When you analyze performance hot spots in a scene that will be rendered, knowing whether the scene is fill-rate bound or vertex bound can provide useful information.</span></span>

-   <span data-ttu-id="8f4fd-319">Velocidad de relleno: la velocidad de relleno hace referencia al número de píxeles que una tarjeta gráfica puede representar y escribir en la memoria de vídeo por segundo.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-319">Fill Rate: Fill rate refers to the number of pixels that a graphics card can render and write to video memory per second.</span></span>
-   <span data-ttu-id="8f4fd-320">Límite de vértice: una escena está enlazada al vértice cuando contiene mucha geometría compleja.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-320">Vertex Bound: A scene is vertex bound when it contains lots of complex geometry.</span></span>

### <a name="understand-scene-complexity"></a><span data-ttu-id="8f4fd-321">Descripción de la complejidad de la escena</span><span class="sxs-lookup"><span data-stu-id="8f4fd-321">Understand Scene Complexity</span></span>

<span data-ttu-id="8f4fd-322">Puede analizar la complejidad de la escena modificando el tamaño del destino de representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-322">You can analyze your scene complexity by altering the size of the render target.</span></span> <span data-ttu-id="8f4fd-323">Si las mejoras de rendimiento están visibles para una reducción proporcional del tamaño del destino de representación, la aplicación tiene un límite de velocidad de relleno.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-323">If performance gains are visible for a proportional reduction in size of the render target, then the application is fill-rate bound.</span></span> <span data-ttu-id="8f4fd-324">De lo contrario, la complejidad de la escena es el cuello de botella del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-324">Otherwise, the scene complexity is the performance bottleneck.</span></span>

<span data-ttu-id="8f4fd-325">Cuando una escena tiene un límite de velocidad de relleno, reducir el tamaño del destino de representación puede mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-325">When a scene is fill-rate bound, reducing the size of the render target can improve the performance.</span></span> <span data-ttu-id="8f4fd-326">Esto se debe a que el número de píxeles que se va a representar se reducirá proporcionalmente con el tamaño del destino de representación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-326">This is because the number of pixels to be rendered will be reduced proportionally with the size of the render target.</span></span>

<span data-ttu-id="8f4fd-327">Cuando una escena está enlazada a vértices, reduzca la complejidad de la geometría.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-327">When a scene is vertex bound, reduce the complexity of the geometry.</span></span> <span data-ttu-id="8f4fd-328">Pero recuerde que esto se hace a costa de la calidad de la imagen.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-328">But remember that this is done at the expense of image quality.</span></span> <span data-ttu-id="8f4fd-329">Por lo tanto, se debe tomar una decisión exhaustiva sobre el compromiso entre la calidad deseada y el rendimiento necesario.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-329">Therefore, a careful tradeoff decision should be made between the desired quality and the performance that is required.</span></span>

## <a name="improving-performance-for-direct2d-printing-apps"></a><span data-ttu-id="8f4fd-330">Mejorar el rendimiento de las aplicaciones de impresión en Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-330">Improving performance for Direct2D printing apps</span></span>

<span data-ttu-id="8f4fd-331">[Direct2D](./direct2d-portal.md) ofrece compatibilidad con la impresión.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-331">[Direct2D](./direct2d-portal.md) offers compatibility with printing.</span></span> <span data-ttu-id="8f4fd-332">Puede enviar los mismos comandos de dibujo de Direct2D (en forma de listas de comandos de Direct2D) al control de impresión de Direct2D para la impresión, si no sabe a qué dispositivos está dibujando o cómo se traduce el dibujo a la impresión.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-332">You can send the same Direct2D drawing commands (in the form of Direct2D command lists) to the Direct2D print control for printing, if you don't know what devices you are drawing to, or how the drawing is translated to printing.</span></span>

<span data-ttu-id="8f4fd-333">Puede ajustar aún más el uso del control de impresión de [direct2d](./direct2d-portal.md) y los comandos de dibujo de direct2d para ofrecer resultados de impresión con un mejor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-333">You can further fine-tune their usage of the [Direct2D](./direct2d-portal.md) print control and your Direct2D drawing commands to deliver printing results with better performance.</span></span>

<span data-ttu-id="8f4fd-334">El control de impresión de [direct2d](./direct2d-portal.md) genera mensajes de depuración cuando ve un patrón de código de direct2d que conduce a una menor calidad de impresión o rendimiento (por ejemplo, los patrones de código que se enumeran más adelante en este tema) para recordarle dónde puede evitar problemas de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-334">The [Direct2D](./direct2d-portal.md) print control outputs debug messages when it sees a Direct2D code pattern that leads to lower printing quality or performance (like, code patterns listed later in this topic) to remind you where you can avoid performance problems.</span></span> <span data-ttu-id="8f4fd-335">Para ver los mensajes de depuración, debe habilitar la [capa de depuración de Direct2D](direct2ddebuglayer-portal.md) en el código.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-335">To see those debug messages, you need to enable [Direct2D Debug Layer](direct2ddebuglayer-portal.md) in your code.</span></span> <span data-ttu-id="8f4fd-336">Consulte [depuración de mensajes](direct2ddebuglayer-debugmessages.md) para obtener instrucciones para habilitar la salida de mensajes de depuración.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-336">See [Debug Messages](direct2ddebuglayer-debugmessages.md) for instructions to enable debug message output.</span></span>

### <a name="set-the-right-property-values-when-you-create-the-d2d-print-control"></a><span data-ttu-id="8f4fd-337">Establecer los valores de propiedad correctos al crear el control de impresión D2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-337">Set the right property values when you create the D2D print control</span></span>

<span data-ttu-id="8f4fd-338">Existen tres propiedades que se pueden establecer al crear el control de impresión de [Direct2D](./direct2d-portal.md) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-338">There are three properties that you can set when you create the [Direct2D](./direct2d-portal.md) print control.</span></span> <span data-ttu-id="8f4fd-339">Dos de estas propiedades afectan al modo en que el control de impresión de Direct2D controla determinados comandos de Direct2D y, a su vez, afecta al rendimiento general.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-339">Two of these properties impact how the Direct2D print control handles certain Direct2D commands and in turn impact the overall performance.</span></span>

-   <span data-ttu-id="8f4fd-340">Modo de subconjunto de fuentes: el control de impresión de [Direct2D](./direct2d-portal.md) subdefine los recursos de fuente usados en cada página antes de enviar la página que se va a imprimir.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-340">Font Subset Mode: The [Direct2D](./direct2d-portal.md) print control subsets font resources used in each page before it sends the page to be printed.</span></span> <span data-ttu-id="8f4fd-341">Este modo reduce el tamaño de los recursos de página necesarios para imprimir.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-341">This mode reduces the size of page resources needed to print.</span></span> <span data-ttu-id="8f4fd-342">En función del uso de fuentes de la página, puede elegir diferentes modos de subconjunto de fuentes para obtener el mejor rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-342">Depending on font usage on the page, you can choose different font subset modes for the best performance.</span></span>
    -   <span data-ttu-id="8f4fd-343">[**D2D1 \_ IMPRIMIR \_ el \_ modo de subconjunto de fuentes \_ \_ predeterminado**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) proporciona el mejor rendimiento de impresión en la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-343">[**D2D1\_PRINT\_FONT\_SUBSET\_MODE\_DEFAULT**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) provides the best printing performance in most cases.</span></span> <span data-ttu-id="8f4fd-344">Cuando se establece en este modo, el control de impresión de [Direct2D](./direct2d-portal.md) usa una estrategia heurística para decidir cuándo se deben subconjuntos de las fuentes.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-344">When set to this mode, the [Direct2D](./direct2d-portal.md) print control uses a heuristic strategy to decide when to subset fonts.</span></span>
    -   <span data-ttu-id="8f4fd-345">En el caso de los trabajos de impresión cortos con una o dos páginas, se recomienda [**D2D1 \_ imprimir el modo de \_ \_ subconjunto de fuentes \_ \_ EACHPAGE**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) , donde el control de impresión de [Direct2D](./direct2d-portal.md) crea e inserta recursos de fuentes en cada página y, a continuación, descarta ese subconjunto de fuentes después de imprimir la página.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-345">For short print jobs with 1 or 2 pages, we recommend [**D2D1\_PRINT\_FONT\_SUBSET\_MODE\_EACHPAGE**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode) , where the [Direct2D](./direct2d-portal.md) print control subsets and embeds font resources in each page, then discards that font subset after the page prints.</span></span> <span data-ttu-id="8f4fd-346">Esta opción garantiza que cada página se puede imprimir inmediatamente después de que se genere, pero aumenta ligeramente el tamaño de los recursos de página necesarios para la impresión (con los subconjuntos de fuentes grandes normalmente).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-346">This option makes sure each page can be printed immediately after it is generated but slightly increases size of page resources needed for printing (with usually large font subsets).</span></span>
    -   <span data-ttu-id="8f4fd-347">Para los trabajos de impresión con muchas páginas de texto y tamaños de fuente pequeños (como 100 páginas de texto que usan una sola fuente), se recomienda [**D2D1 \_ imprimir el modo de \_ \_ subconjunto de fuentes \_ \_ ninguno**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode), donde el control de impresión de [Direct2D](./direct2d-portal.md) no represente los recursos de fuente; en su lugar, envía los recursos de fuente originales junto con la página que usa la fuente por primera vez y vuelve a usar los recursos de fuente para páginas posteriores sin reenviarlos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-347">For print jobs with many pages of texts and small font sizes (like 100 pages of text that uses a single font), we recommend [**D2D1\_PRINT\_FONT\_SUBSET\_MODE\_NONE**](/windows/desktop/api/d2d1_1/ne-d2d1_1-d2d1_print_font_subset_mode), where the [Direct2D](./direct2d-portal.md) print control doesn't subset font resources at all; instead, it sends out the original font resources along with the page that first uses the font, and re-uses the font resources for later pages without resending them.</span></span>
-   <span data-ttu-id="8f4fd-348">PPP de rasterización: cuando el control de impresión de [direct2d](./direct2d-portal.md) debe rasterizar comandos de direct2d durante la conversión de DIRECT2D-XPS, usa este PPP para la rasterización.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-348">Rasterization DPI: When the [Direct2D](./direct2d-portal.md) print control needs to rasterize Direct2D commands during Direct2D-XPS conversion, it uses this DPI for rasterization.</span></span> <span data-ttu-id="8f4fd-349">En otras palabras, si la página no tiene ningún contenido rasterizado, el establecimiento de un valor de PPP no cambiará el rendimiento y la calidad.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-349">In other words, if the page doesn't have any rasterized contents, setting any DPI won't change performance and quality.</span></span> <span data-ttu-id="8f4fd-350">En función del uso de la rasterización en la página, puede elegir diferentes PPP de rasterización para el mejor equilibrio entre fidelidad y rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-350">Depending on rasterization usage on the page, you can choose different rasterization DPIs for the best balance between fidelity and performance.</span></span>
    -   <span data-ttu-id="8f4fd-351">150 es el valor predeterminado si no se especifica un valor al crear el control de impresión de [Direct2D](./direct2d-portal.md) , que es el mejor equilibrio de la calidad de impresión y el rendimiento de impresión en la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-351">150 is the default value if you don't specify a value when you create the [Direct2D](./direct2d-portal.md) print control, which is the best balance of printing quality and printing performance in most cases.</span></span>
    -   <span data-ttu-id="8f4fd-352">Los valores de PPP más altos suelen dar lugar a una mejor calidad de impresión (al igual que en los detalles conservados), pero menor rendimiento debido a los mapas de bits más grandes que genera.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-352">Higher DPI values usually result in better printing quality (as in more details preserved) but lower performance due to the larger bitmaps it generates.</span></span> <span data-ttu-id="8f4fd-353">No se recomienda ningún valor de PPP superior a 300, ya que no presentará información adicional que sea perceptible visualmente por los ojos humanos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-353">We don't recommend any DPI value greater than 300 since that won't introduce extra information visually perceivable by human eyes.</span></span>
    -   <span data-ttu-id="8f4fd-354">Los PPP inferiores pueden significar un mejor rendimiento, pero también pueden producir una calidad inferior.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-354">Lower DPI may mean better performance but may also produce lower quality.</span></span>

### <a name="avoid-using-certain-direct2d-drawing-patterns"></a><span data-ttu-id="8f4fd-355">Evite usar determinados patrones de dibujo de Direct2D</span><span class="sxs-lookup"><span data-stu-id="8f4fd-355">Avoid using certain Direct2D drawing patterns</span></span>

<span data-ttu-id="8f4fd-356">Hay diferencias entre lo que [Direct2D](./direct2d-portal.md) puede representar visualmente y lo que el subsistema de impresión puede mantener y transportar a lo largo de toda la canalización de impresión.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-356">There are differences between what [Direct2D](./direct2d-portal.md) can represent visually and what the print subsystem can maintain and transport along the whole print pipeline.</span></span> <span data-ttu-id="8f4fd-357">El control de impresión de Direct2D une estos huecos, ya sea aproximando o rasterizando primitivas de Direct2D que el subsistema de impresión no admite de forma nativa.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-357">The Direct2D print control bridges those gaps by either approximating or rasterizing Direct2D primitives that the print subsystem doesn't natively support.</span></span> <span data-ttu-id="8f4fd-358">Esta aproximación suele dar lugar a una menor fidelidad de impresión, menor rendimiento de la impresión o ambos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-358">Such approximation usually results in lower printing fidelity, lower printing performance, or both.</span></span> <span data-ttu-id="8f4fd-359">Por lo tanto, aunque un cliente puede usar los mismos patrones de dibujo para la representación de pantalla y de impresión, no es idóneo en todos los casos.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-359">Therefore, even though a customer can use the same drawing patterns for both screen and print rendering, it is not ideal in all cases.</span></span> <span data-ttu-id="8f4fd-360">Es mejor no usar modelos y primitivos de Direct2D tanto como sea posible para la ruta de impresión, o para hacer su propia rasterización en la que tenga control total sobre la calidad y el tamaño de las imágenes rasterizadas.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-360">It's best not to use such Direct2D primitives and patterns as much as possible for the print path, or to do you own rasterization where you have full control of the quality and the size of the rasterized images.</span></span>

<span data-ttu-id="8f4fd-361">A continuación se muestra una lista de los casos en los que el rendimiento y la calidad de la impresión no son ideales y es posible que desee considerar la posibilidad de variar la ruta de acceso del código para obtener un rendimiento óptimo de la impresión.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-361">The here is a list of cases where the print performance and quality won't be ideal and the you might want to consider varying the code path for optimal print performance.</span></span>

-   <span data-ttu-id="8f4fd-362">Evite usar el modo de mezcla primitivo que no sea [**D2D1 \_ primitiva \_ Blend \_ SOURCEOVER**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_primitive_blend).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-362">Avoid using primitive blend mode other than [**D2D1\_PRIMITIVE\_BLEND\_SOURCEOVER**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_primitive_blend).</span></span>
-   <span data-ttu-id="8f4fd-363">Evite el uso de modos de composición al dibujar una imagen que no sea el [**\_ origen de modo compuesto D2D1 \_ \_ \_ sobre**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_composite_mode) y el **destino de \_ modo compuesto D2D1 \_ \_ \_ sobre**.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-363">Avoid using Composition Modes when drawing an image other than [**D2D1\_COMPOSITE\_MODE\_SOURCE\_OVER**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_composite_mode) and **D2D1\_COMPOSITE\_MODE\_DESTINATION\_OVER**.</span></span>
-   <span data-ttu-id="8f4fd-364">Evite dibujar un archivo de metadatos GDI.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-364">Avoid drawing a GDI Meta File.</span></span>
-   <span data-ttu-id="8f4fd-365">Evite insertar un recurso de capa que copie el fondo de origen (llamando a [**PushLayer**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-pushlayer) con el paso [**de la \_ capa D2D1 \_ OPTIONS1 \_ Initialize \_ de \_ background**](/windows/desktop/api/d2d1_1/ns-d2d1_1-d2d1_layer_parameters1) a la **\_ capa D2D1 \_ PARAMETERS1** struct).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-365">Avoid pushing a layer resource that copies the source background (calling [**PushLayer**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-pushlayer) with passing [**D2D1\_LAYER\_OPTIONS1\_INITIALIZE\_FROM\_BACKGROUND**](/windows/desktop/api/d2d1_1/ns-d2d1_1-d2d1_layer_parameters1) to the **D2D1\_LAYER\_PARAMETERS1** struct).</span></span>
-   <span data-ttu-id="8f4fd-366">Evite crear un pincel de mapa de bits o un pincel de imagen con la \_ abrazadera del modo de extensión D2D1 \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-366">Avoid creating Bitmap Brush or Image Brush with D2D1\_EXTEND\_MODE\_CLAMP.</span></span> <span data-ttu-id="8f4fd-367">Se recomienda usar el reflejo del modo de extensión de D2D1 \_ \_ \_ si no le interesan los píxeles que se encuentran fuera de la imagen enlazada (por ejemplo, la imagen conectada al pincel se sabe que es mayor que la región de destino rellena).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-367">We recommend you use D2D1\_EXTEND\_MODE\_MIRROR if don't care about pixels outside of the image bound at all (like, the image attached to the brush is known to be larger than the filled target region).</span></span>
-   <span data-ttu-id="8f4fd-368">Evite dibujar mapas de bits con [transformaciones de perspectiva](3d-perspective-transform.md).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-368">Avoid drawing Bitmaps with [Perspective Transforms](3d-perspective-transform.md).</span></span>

### <a name="draw-text-in-a-direct-and-plain-way"></a><span data-ttu-id="8f4fd-369">Dibujar texto de forma directa y sin formato</span><span class="sxs-lookup"><span data-stu-id="8f4fd-369">Draw text in a direct and plain way</span></span>

<span data-ttu-id="8f4fd-370">Direct2D tiene varias optimizaciones al representar textos para mostrar un mejor rendimiento y/o una mejor calidad visual.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-370">Direct2D has several optimizations when rendering texts to display for better performance and/or better visual quality.</span></span> <span data-ttu-id="8f4fd-371">Pero no todas las optimizaciones mejoran el rendimiento y la calidad de la impresión, ya que la impresión en papel está normalmente en un valor de PPP mucho mayor, y la impresión no necesita incluir escenarios como la animación.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-371">But not all optimizations improve the printing performance and quality since the printing on paper is usually in a much higher DPI, and printing does not need to accommodate scenarios like animation.</span></span> <span data-ttu-id="8f4fd-372">Por lo tanto, se recomienda que dibuje directamente el texto o glifos originales y que evite cualquiera de las siguientes optimizaciones al crear la lista de comandos para imprimir.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-372">So, we recommend you draw the original text or glyphs directly and avoid any of the following optimizations when creating the command list for printing.</span></span>

-   <span data-ttu-id="8f4fd-373">Evite dibujar texto con el método [**FillOpacityMask**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-fillopacitymask) .</span><span class="sxs-lookup"><span data-stu-id="8f4fd-373">Avoid drawing text with the [**FillOpacityMask**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1commandsink-fillopacitymask) method.</span></span>
-   <span data-ttu-id="8f4fd-374">Evite dibujar texto en modo de alias.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-374">Avoid drawing text in Aliased Mode.</span></span>

### <a name="draw-the-original-bitmaps-when-possible"></a><span data-ttu-id="8f4fd-375">Dibujar los mapas de bits originales siempre que sea posible</span><span class="sxs-lookup"><span data-stu-id="8f4fd-375">Draw the original bitmaps when possible</span></span>

<span data-ttu-id="8f4fd-376">Si el mapa de bits de destino es JPEG, PNG, TIFF o JPEG-XR, puede crear un mapa de bits de WIC desde un archivo de disco o desde una secuencia en memoria, crear un mapa de bits de [direct2d](./direct2d-portal.md) a partir de ese mapa de bits de WIC mediante [**ID2D1DeviceContext:: CreateBitmapFromWicBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1))y, finalmente, pasar directamente ese mapa</span><span class="sxs-lookup"><span data-stu-id="8f4fd-376">If the target bitmap is a JPEG, PNG, TIFF, or JPEG-XR, you can create a WIC bitmap either from a disk file or from an in-memory stream, then create a [Direct2D](./direct2d-portal.md) bitmap from that WIC bitmap using [**ID2D1DeviceContext::CreateBitmapFromWicBitmap**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties1_id2d1bitmap1)), and finally directly pass that Direct2D bitmap to the Direct2D print control without further manipulation.</span></span> <span data-ttu-id="8f4fd-377">Al hacerlo, el control de impresión de Direct2D puede volver a usar la secuencia de mapa de bits, lo que suele provocar un mejor rendimiento de la impresión (omitiendo la codificación y descodificación de mapas de bits redundantes) y una mejor calidad de impresión (cuando se conservan los metadatos, como los perfiles de color, en el mapa de bits).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-377">By doing so, the Direct2D print control is able to reuse the bitmap stream, which usually leads to better printing performance (by skipping redundant bitmap encoding and decoding), and better printing quality (when metadata, such as color profiles, in the bitmap will be preserved).</span></span>

<span data-ttu-id="8f4fd-378">El dibujo del mapa de bits original proporciona las siguientes ventajas para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-378">Drawing the original bitmap provides the following benefit for applications.</span></span>

-   <span data-ttu-id="8f4fd-379">En general, la impresión de [Direct2D](./direct2d-portal.md) conserva la información original (sin pérdida o ruido) hasta el final de la canalización, especialmente cuando las aplicaciones no saben (o no quieren saber) los detalles de la canalización de impresión (por ejemplo, la impresora en la que se imprime, qué PPP es la impresora de destino, etc.).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-379">In general, [Direct2D](./direct2d-portal.md) print preserves the original information (without loss or noise) until late in the pipeline, especially when apps don't know (or do not want to know) the details of the print pipeline (like which printer it is printing to, what DPI is the target printer, and so on).</span></span>
-   <span data-ttu-id="8f4fd-380">En muchos casos, retrasar la rasterización de mapas de bits supone un mejor rendimiento (como cuando se imprime una foto de 96DPI en una impresora 600dpi).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-380">In many cases, delaying bitmap rasterization means better performance (like when printing an 96dpi photo to a 600dpi printer).</span></span>
-   <span data-ttu-id="8f4fd-381">En algunos casos, el paso de las imágenes originales es la única manera de respetar la alta fidelidad (como los perfiles de color incrustados).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-381">In certain cases, passing the original images is the only way to honor high fidelity (like embedded color profiles).</span></span>

<span data-ttu-id="8f4fd-382">Sin embargo, no puede optar por esta optimización porque:</span><span class="sxs-lookup"><span data-stu-id="8f4fd-382">However, an you can't opt in such optimization because:</span></span>

-   <span data-ttu-id="8f4fd-383">Al consultar la información de la impresora y la rasterización temprana, puede rasterizar el contenido por sí mismo con control total sobre el aspecto final del papel.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-383">By querying printer info and early rasterization, you can rasterize contents themselves with full control of the final appearance on paper.</span></span>
-   <span data-ttu-id="8f4fd-384">En algunos casos, la rasterización temprana podría mejorar realmente el rendimiento de un extremo a otro (por ejemplo, la impresión de las fotos de tamaño).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-384">In certain cases, early rasterization might actually improves an app’s end-to-end performance (like printing wallets-size photos).</span></span>
-   <span data-ttu-id="8f4fd-385">En algunos casos, el paso de los mapas de bits originales requiere un cambio significativo en la arquitectura de código existente (como las rutas de carga de retardo de imagen y de actualización de recursos que se encuentran en determinadas aplicaciones).</span><span class="sxs-lookup"><span data-stu-id="8f4fd-385">In certain cases, passing the original bitmaps require significant change of existing code architecture (like image delay loading and resource update paths found in certain applications).</span></span>

## <a name="conclusion"></a><span data-ttu-id="8f4fd-386">Conclusión</span><span class="sxs-lookup"><span data-stu-id="8f4fd-386">Conclusion</span></span>

<span data-ttu-id="8f4fd-387">Aunque Direct2D tiene aceleración de hardware y está pensado para un alto rendimiento, debe usar las características correctamente para maximizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-387">Although Direct2D is hardware accelerated and is meant for high performance, you must use the features correctly to maximize throughput.</span></span> <span data-ttu-id="8f4fd-388">Las técnicas que examinamos aquí se derivan del estudio de escenarios comunes y es posible que no se apliquen a todos los escenarios de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="8f4fd-388">The techniques we looked at here are derived from studying common scenarios and might not apply to all application scenarios.</span></span>

 

 
