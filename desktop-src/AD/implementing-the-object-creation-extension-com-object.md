---
title: Implementar el objeto COM de extensión de creación de objetos
description: Una extensión de creación de objetos es un objeto COM implementado como un servidor en proceso. Tanto las extensiones de creación de objetos principales como las secundarias deben implementar la interfaz IDsAdminNewObjExt.
ms.assetid: 0a8ed0ed-9dcb-4373-b549-7da3f3d9f641
ms.tgt_platform: multiple
keywords:
- Implementar la extensión de creación de objetos AD de objeto COM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05c1a9da94caa300c1277cf6f6030357ca9d573d
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "104077511"
---
# <a name="implementing-the-object-creation-extension-com-object"></a><span data-ttu-id="45278-105">Implementar el objeto COM de extensión de creación de objetos</span><span class="sxs-lookup"><span data-stu-id="45278-105">Implementing the Object Creation Extension COM Object</span></span>

<span data-ttu-id="45278-106">Una extensión de creación de objetos es un objeto COM implementado como un servidor en proceso.</span><span class="sxs-lookup"><span data-stu-id="45278-106">An object creation extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="45278-107">Tanto las extensiones de creación de objetos principales como las secundarias deben implementar la interfaz [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) .</span><span class="sxs-lookup"><span data-stu-id="45278-107">Both primary and secondary object creation extensions must implement the [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) interface.</span></span>

## <a name="implementing-idsadminnewobjext"></a><span data-ttu-id="45278-108">Implementación de IDsAdminNewObjExt</span><span class="sxs-lookup"><span data-stu-id="45278-108">Implementing IDsAdminNewObjExt</span></span>

<span data-ttu-id="45278-109">Cuando se crea el Asistente para creación de objetos, inicializa cada extensión de creación de objetos llamando al método [**IDsAdminNewObjExt:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) de la extensión.</span><span class="sxs-lookup"><span data-stu-id="45278-109">When the object creation wizard is created, it initializes each object creation extension by calling the extension's [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) method.</span></span> <span data-ttu-id="45278-110">El método **Initialize** proporciona la extensión con información sobre el contenedor en el que se crea el objeto, el nombre de clase del nuevo objeto e información sobre el propio asistente.</span><span class="sxs-lookup"><span data-stu-id="45278-110">The **Initialize** method supplies the extension with information about the container the object is being created in, the class name of the new object and information about the wizard itself.</span></span> <span data-ttu-id="45278-111">Si se inicia el Asistente para creación de objetos con el fin de crear un nuevo objeto a partir de un objeto existente, el parámetro *pADsCopySource* no será **null**.</span><span class="sxs-lookup"><span data-stu-id="45278-111">If the object creation wizard is started to create a new object from an existing object, the *pADsCopySource* parameter will not be **NULL**.</span></span> <span data-ttu-id="45278-112">En este caso, la extensión debe intentar obtener tantos datos del objeto que se va a copiar como sea factible.</span><span class="sxs-lookup"><span data-stu-id="45278-112">In this case, the extension should attempt to obtain as much data from the object being copied as is feasible.</span></span>

<span data-ttu-id="45278-113">Una vez inicializada la extensión, se llama al método [**IDsAdminNewObjExt:: AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) .</span><span class="sxs-lookup"><span data-stu-id="45278-113">After the extension is initialized, the [**IDsAdminNewObjExt::AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) method is called.</span></span> <span data-ttu-id="45278-114">La extensión debe agregar la página o páginas al asistente durante este método.</span><span class="sxs-lookup"><span data-stu-id="45278-114">The extension must add the page or pages to the wizard during this method.</span></span> <span data-ttu-id="45278-115">Una página del asistente se crea rellenando una estructura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) y pasando después esta estructura a la función [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="45278-115">A wizard page is created by filling in a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="45278-116">A continuación, la página se agrega al asistente mediante una llamada a la función de devolución de llamada que se pasa a **AddPages** en el parámetro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="45278-116">The page is then added to the wizard by calling the callback function that is passed to **AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="45278-117">Antes de que se muestre la página de la extensión, se llama a [**IDsAdminNewObjExt:: SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="45278-117">Before the extension page is displayed, [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) is called.</span></span> <span data-ttu-id="45278-118">Esto proporciona la extensión con un puntero de interfaz [**IADs**](/windows/desktop/api/iads/nn-iads-iads) para el objeto que se va a crear.</span><span class="sxs-lookup"><span data-stu-id="45278-118">This supplies the extension with an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer for the object being created.</span></span>

<span data-ttu-id="45278-119">Mientras se muestra la página del asistente, la página debe controlar y responder a los mensajes de notificación necesarios del asistente, como [**PSN \_ SETACTIVE**](../controls/psn-setactive.md) y [**PSN \_ WIZNEXT**](../controls/psn-wiznext.md).</span><span class="sxs-lookup"><span data-stu-id="45278-119">While the wizard page is displayed, the page should handle and respond to any necessary wizard notification messages, such as [**PSN\_SETACTIVE**](../controls/psn-setactive.md) and [**PSN\_WIZNEXT**](../controls/psn-wiznext.md).</span></span>

<span data-ttu-id="45278-120">Cuando el usuario completa todas las páginas del asistente, el asistente mostrará una página "finalizar" que proporciona un resumen de los datos especificados.</span><span class="sxs-lookup"><span data-stu-id="45278-120">When the user completes all of the wizard pages, the wizard will display a "Finish" page that provides a summary of the data entered.</span></span> <span data-ttu-id="45278-121">El asistente obtiene estos datos llamando al método [**IDsAdminNewObjExt:: GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) para cada una de las extensiones.</span><span class="sxs-lookup"><span data-stu-id="45278-121">The wizard obtains this data by calling the [**IDsAdminNewObjExt::GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) method for each of the extensions.</span></span> <span data-ttu-id="45278-122">El método **GetSummaryInfo** proporciona un **BSTR** que contiene los datos de texto que se muestran en la página "finalizar".</span><span class="sxs-lookup"><span data-stu-id="45278-122">The **GetSummaryInfo** method provides a **BSTR** that contains the text data displayed in the "Finish" page.</span></span> <span data-ttu-id="45278-123">Una extensión de creación de objetos no tiene que proporcionar datos de resumen.</span><span class="sxs-lookup"><span data-stu-id="45278-123">An object creation extension does not have to supply summary data.</span></span> <span data-ttu-id="45278-124">En este caso, **GetSummaryInfo** debe devolver **E \_ NOTIMPL**.</span><span class="sxs-lookup"><span data-stu-id="45278-124">In this case, **GetSummaryInfo** should return **E\_NOTIMPL**.</span></span> <span data-ttu-id="45278-125">Solo se llama a **GetSummaryInfo** una vez por cada extensión, no por página, por lo que si la extensión de creación de objetos agrega más de una página, la extensión debe combinar los datos de resumen en una sola cadena.</span><span class="sxs-lookup"><span data-stu-id="45278-125">**GetSummaryInfo** is only called one time for each extension, not per page, so if the object creation extension adds more than one page, the extension must combine the summary data into one string.</span></span>

<span data-ttu-id="45278-126">Cuando el usuario hace clic en el botón **Finalizar** de la página "finalizar", el asistente llama a cada uno de los métodos [**IDsAdminNewObjExt:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) de la extensión con el contexto de **\_ \_ \_ preconfirmación DSA NEWOBJ CTX** .</span><span class="sxs-lookup"><span data-stu-id="45278-126">When the user clicks the **Finish** button in the "Finish" page, the wizard calls each of the extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) methods with the **DSA\_NEWOBJ\_CTX\_PRECOMMIT** context.</span></span> <span data-ttu-id="45278-127">Cuando esto ocurre, la extensión debe escribir los datos recopilados en las propiedades adecuadas mediante el método [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) o [**IADs::P Utex**](/windows/desktop/api/iads/nf-iads-iads-putex) .</span><span class="sxs-lookup"><span data-stu-id="45278-127">When this occurs, the extension should write the gathered data into the appropriate properties using the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) or [**IADs::PutEx**](/windows/desktop/api/iads/nf-iads-iads-putex) method.</span></span> <span data-ttu-id="45278-128">La interfaz [**IADs**](/windows/desktop/api/iads/nn-iads-iads) se proporciona a la extensión en el método [**IDsAdminNewObjExt:: SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="45278-128">The [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface is provided to the extension in the [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) method.</span></span> <span data-ttu-id="45278-129">La extensión no debe confirmar las propiedades almacenadas en caché mediante una llamada a [**IADs:: SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span><span class="sxs-lookup"><span data-stu-id="45278-129">The extension should not commit the cached properties by calling [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span></span> <span data-ttu-id="45278-130">Cuando se han escrito todas las propiedades, la extensión de creación de objetos principales confirma los cambios mediante una llamada a **IADs:: SetInfo**.</span><span class="sxs-lookup"><span data-stu-id="45278-130">When all of the properties have been written, the primary object creation extension commits the changes by calling **IADs::SetInfo**.</span></span> <span data-ttu-id="45278-131">Esto se describe con más detalle a continuación.</span><span class="sxs-lookup"><span data-stu-id="45278-131">This is discussed in more detail below.</span></span>

<span data-ttu-id="45278-132">Si se produce un error, se notificará el error a la extensión y durante la operación que se produjo cuando se llama al método [**IDsAdminNewObjExt:: OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) .</span><span class="sxs-lookup"><span data-stu-id="45278-132">If an error occurs, the extension will be notified of the error and during which operation it occurred when the [**IDsAdminNewObjExt::OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) method is called.</span></span>

## <a name="implementing-a-primary-object-creation-wizard"></a><span data-ttu-id="45278-133">Implementar un asistente para crear un objeto principal</span><span class="sxs-lookup"><span data-stu-id="45278-133">Implementing a Primary Object Creation Wizard</span></span>

<span data-ttu-id="45278-134">La implementación de un asistente para crear objetos principales es idéntica a la del Asistente para crear objetos secundarios, salvo que un asistente para crear objetos principales debe realizar algunos pasos más.</span><span class="sxs-lookup"><span data-stu-id="45278-134">The implementation of a primary object creation wizard is identical to a secondary object creation wizard, except that a primary object creation wizard must perform a few more steps.</span></span>

<span data-ttu-id="45278-135">Antes de descartar la primera página, el Asistente para crear objetos debe crear el objeto de directorio temporal.</span><span class="sxs-lookup"><span data-stu-id="45278-135">Prior to the first page being dismissed, the object creation wizard must create the temporary directory object.</span></span> <span data-ttu-id="45278-136">Para ello, llame al método [**IDsAdminNewObjPrimarySite:: CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) .</span><span class="sxs-lookup"><span data-stu-id="45278-136">To do this, call the [**IDsAdminNewObjPrimarySite::CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) method.</span></span> <span data-ttu-id="45278-137">Un puntero a la interfaz [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) se obtiene llamando a [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) con **IID \_ IDsAdminNewObjPrimarySite** en la interfaz [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) que se pasa a [**IDsAdminNewObjExt:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span><span class="sxs-lookup"><span data-stu-id="45278-137">A pointer to the [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) interface is obtained by calling [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) with **IID\_IDsAdminNewObjPrimarySite** on the [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) interface that is passed to [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span></span> <span data-ttu-id="45278-138">El método **CreateNew** crea un nuevo objeto temporal y llama a [**IDsAdminNewObjExt:: SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) para cada extensión.</span><span class="sxs-lookup"><span data-stu-id="45278-138">The **CreateNew** method creates a new temporary object and calls [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) for each extension.</span></span>

<span data-ttu-id="45278-139">Cuando un asistente para crear objetos contiene más de una página, el sistema implementa una página "finalizar" que muestra un resumen de la información del objeto que se va a guardar.</span><span class="sxs-lookup"><span data-stu-id="45278-139">When an object creation wizard contains more than one page, the system implements a "Finish" page that displays a summary of the object information to be saved.</span></span> <span data-ttu-id="45278-140">Cuando se hace clic en el botón **Finalizar** de la página "finalizar", el sistema llamará a cada uno de los métodos [**IDsAdminNewObjExt:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) de la extensión de creación de objetos y, a continuación, confirmará el objeto temporal en la memoria persistente.</span><span class="sxs-lookup"><span data-stu-id="45278-140">When the **Finish** button on the "Finish" page is clicked, the system will call each of the object creation extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) method and then commit the temporary object to persistent memory.</span></span> <span data-ttu-id="45278-141">Sin embargo, si el Asistente para la creación de objetos solo contiene una página, la página tendrá los botones **Aceptar** y **Cancelar** en lugar de **atrás**, los botones **siguiente** y **Cancelar** se encuentran normalmente en un asistente y no se proporciona ninguna página "finalizar".</span><span class="sxs-lookup"><span data-stu-id="45278-141">If, however, the object creation wizard only contains one page, the page will have **OK** and **Cancel** buttons instead of the **Back**, **Next** and **Cancel** buttons normally found in a wizard and no "Finish" page is provided.</span></span> <span data-ttu-id="45278-142">Por este motivo, un asistente para extensión de creación de objetos de una sola página debe llamar a [**IDsAdminNewObjPrimarySite:: commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) para realizar las operaciones de escritura y guardado.</span><span class="sxs-lookup"><span data-stu-id="45278-142">Because of this, a single-page object creation extension wizard must call [**IDsAdminNewObjPrimarySite::Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) to perform the write and save operations.</span></span> <span data-ttu-id="45278-143">Una extensión de creación de objeto principal de una sola página debe llamar a **commit** en respuesta a la notificación [**\_ WIZFINISH de PSN**](../controls/psn-wizfinish.md) .</span><span class="sxs-lookup"><span data-stu-id="45278-143">A single-page primary object creation extension should call **Commit** in response to the [**PSN\_WIZFINISH**](../controls/psn-wizfinish.md) notification.</span></span>

<span data-ttu-id="45278-144">Dado que otras extensiones de creación de objetos pueden agregar páginas al asistente, es posible que la extensión de creación de objetos principales no sepa si hay más de una página en el asistente.</span><span class="sxs-lookup"><span data-stu-id="45278-144">Because other object creation extensions can add pages to the wizard, the primary object creation extension may not know if there is more than one page in the wizard.</span></span> <span data-ttu-id="45278-145">Esto no es un problema por dos motivos: en primer lugar, si el sistema implementa la página "Finish", la extensión de creación de objeto principal recibirá la notificación [**\_ WIZNEXT de PSN**](../controls/psn-wiznext.md) en lugar de la notificación **\_ WIZNEXT de PSN** .</span><span class="sxs-lookup"><span data-stu-id="45278-145">This is not an issue for two reasons: First, if the system implements the "Finish" page, the primary object creation extension will receive the [**PSN\_WIZNEXT**](../controls/psn-wiznext.md) notification instead of the **PSN\_WIZNEXT** notification.</span></span> <span data-ttu-id="45278-146">En segundo lugar, la [**confirmación**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) producirá un error inofensivo si el asistente contiene más de una página.</span><span class="sxs-lookup"><span data-stu-id="45278-146">Second, [**Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) will fail harmlessly if the wizard contains more than one page.</span></span>

 

 