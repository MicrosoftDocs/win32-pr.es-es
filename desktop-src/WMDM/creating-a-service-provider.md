---
title: Creación de un proveedor de servicios
description: Creación de un proveedor de servicios
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Windows Media Administrador de dispositivos, creación de proveedores de servicios
- Administrador de dispositivos, creación de proveedores de servicios
- Windows Media Administrador de dispositivos, guía de programación
- Administrador de dispositivos, guía de programación
- Guía de programación, proveedores de servicios
- Guía de programación, Administrador de dispositivos de Windows Media
- Guía de programación, crear proveedores de servicios
- Windows Media Administrador de dispositivos, proveedores de servicios
- Administrador de dispositivos, proveedores de servicios
- proveedores de servicios, crear
- crear proveedores de servicios, acerca de
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "105695622"
---
# <a name="creating-a-service-provider"></a><span data-ttu-id="05d90-114">Creación de un proveedor de servicios</span><span class="sxs-lookup"><span data-stu-id="05d90-114">Creating a Service Provider</span></span>

<span data-ttu-id="05d90-115">Un proveedor de servicios es un componente que actúa como intermediario entre una aplicación y un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="05d90-115">A service provider is component that serves as a middleman between an application and a device.</span></span> <span data-ttu-id="05d90-116">Windows Media Administrador de dispositivos enruta las solicitudes de la aplicación al proveedor de servicios, que es responsable de comunicarse con el dispositivo o realizar la acción solicitada.</span><span class="sxs-lookup"><span data-stu-id="05d90-116">Windows Media Device Manager routes requests from the application to the service provider, which is then responsible for communicating with the device or performing the requested action.</span></span> <span data-ttu-id="05d90-117">Normalmente, un proveedor de servicios se comunica con un controlador para habilitar la comunicación con el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="05d90-117">A service provider usually communicates with a driver to enable communication with the device.</span></span> <span data-ttu-id="05d90-118">Un proveedor de servicios es un componente COM que implementa las interfaces llamadas por Windows Media Administrador de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="05d90-118">A service provider is a COM component that implements the interfaces called by Windows Media Device Manager.</span></span> <span data-ttu-id="05d90-119">La interfaz raíz del objeto de proveedor de servicios es [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span><span class="sxs-lookup"><span data-stu-id="05d90-119">The root interface of the service provider object is [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span></span> <span data-ttu-id="05d90-120">Después de obtener esta interfaz, Windows Media Administrador de dispositivos puede obtener otras interfaces a través de la implementación del proveedor de servicios de varios métodos.</span><span class="sxs-lookup"><span data-stu-id="05d90-120">After obtaining this interface, Windows Media Device Manager can obtain other interfaces through the service provider's implementation of various methods.</span></span> <span data-ttu-id="05d90-121">Las interfaces que debe implementar un proveedor de servicios se enumeran en [interfaces obligatorias y opcionales](mandatory-and-optional-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="05d90-121">The interfaces that a service provider must implement are listed in [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md).</span></span> <span data-ttu-id="05d90-122">La jerarquía de interfaces se muestra en [interfaces para proveedores de servicios](interfaces-for-service-providers.md).</span><span class="sxs-lookup"><span data-stu-id="05d90-122">The hierarchy of interfaces is shown in [Interfaces for Service Providers](interfaces-for-service-providers.md).</span></span>

> [!Note]  
> <span data-ttu-id="05d90-123">No debe intentar crear un proveedor de servicios MTP; en su lugar, debe usar el proveedor de servicios MTP y los controladores proporcionados por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="05d90-123">You should not try to create an MTP service provider; instead, you should use the MTP service provider and drivers provided by Microsoft.</span></span>

 

<span data-ttu-id="05d90-124">Antes de intentar crear un proveedor de servicios, debe comprender perfectamente qué llamadas realizará una aplicación en un proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="05d90-124">Before trying to create a service provider, you should thoroughly understand what calls an application will make on a service provider.</span></span> <span data-ttu-id="05d90-125">Lea [creación de una aplicación de administrador de dispositivos de Windows Media](creating-a-windows-media-device-manager-application.md) para obtener una idea de las tareas básicas y llamadas que una aplicación realizará en un proveedor de servicios cuando intente comunicarse con un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="05d90-125">Read [Creating a Windows Media Device Manager Application](creating-a-windows-media-device-manager-application.md) to get some idea of the basic tasks and calls that an application will make on a service provider when it is attempting to communicate with a device.</span></span>

<span data-ttu-id="05d90-126">En la siguiente lista se muestran los pasos principales para desarrollar un proveedor de servicios:</span><span class="sxs-lookup"><span data-stu-id="05d90-126">The following list shows the key steps in developing a service provider:</span></span>

1.  <span data-ttu-id="05d90-127">Incluya (y, opcionalmente, compile) el encabezado y los archivos de biblioteca necesarios para el proyecto.</span><span class="sxs-lookup"><span data-stu-id="05d90-127">Include (and optionally compile) the required header and library files for your project.</span></span> <span data-ttu-id="05d90-128">Consulte las [bibliotecas y encabezados necesarios de un proveedor de servicios](required-libraries-and-headers-for-a-service-provider.md) para obtener la lista de archivos necesarios.</span><span class="sxs-lookup"><span data-stu-id="05d90-128">See [Required Libraries and Headers for a Service Provider](required-libraries-and-headers-for-a-service-provider.md) for the list of required files.</span></span>
2.  <span data-ttu-id="05d90-129">Implemente todas las demás interfaces de proveedor de servicios obligatorias u opcionales (consulte [interfaces obligatorias y opcionales](mandatory-and-optional-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="05d90-129">Implement all the other required or optional service provider interfaces (see [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md)).</span></span> <span data-ttu-id="05d90-130">Normalmente, se llamará a las interfaces en este orden:</span><span class="sxs-lookup"><span data-stu-id="05d90-130">Typically, interfaces will be called in this order:</span></span>
    -   [<span data-ttu-id="05d90-131">**IComponentAuthenticate**</span><span class="sxs-lookup"><span data-stu-id="05d90-131">**IComponentAuthenticate**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   <span data-ttu-id="05d90-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span><span class="sxs-lookup"><span data-stu-id="05d90-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span></span>
    -   [<span data-ttu-id="05d90-133">**IMDSPEnumDevice**</span><span class="sxs-lookup"><span data-stu-id="05d90-133">**IMDSPEnumDevice**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   <span data-ttu-id="05d90-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span><span class="sxs-lookup"><span data-stu-id="05d90-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span></span>
    -   [<span data-ttu-id="05d90-135">**IMDSPEnumStorage**</span><span class="sxs-lookup"><span data-stu-id="05d90-135">**IMDSPEnumStorage**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   <span data-ttu-id="05d90-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span><span class="sxs-lookup"><span data-stu-id="05d90-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span></span>
3.  <span data-ttu-id="05d90-137">Asegúrese de que el proveedor de servicios o el dispositivo instalan las claves del registro adecuadas durante la instalación.</span><span class="sxs-lookup"><span data-stu-id="05d90-137">Be sure your service provider or device installs the proper registry keys during installation.</span></span> <span data-ttu-id="05d90-138">Estas claves especifican parámetros de dispositivo, registran el proveedor de servicios como complemento y habilitan las notificaciones de Plug and Play para la llegada y eliminación de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="05d90-138">These keys specify device parameters, register the service provider as a plug-in, and enable Plug and Play notifications for device arrival and removal.</span></span> <span data-ttu-id="05d90-139">Consulte [parámetros del dispositivo](device-parameters.md), [registro del proveedor de servicios](registering-the-service-provider.md)y [habilitación de PNP para dispositivos](enabling-pnp-for-devices.md).</span><span class="sxs-lookup"><span data-stu-id="05d90-139">See [Device Parameters](device-parameters.md), [Registering the Service Provider](registering-the-service-provider.md), and [Enabling PnP for Devices](enabling-pnp-for-devices.md).</span></span>
4.  <span data-ttu-id="05d90-140">En la creación de instancias de la clase, autentique el proveedor de servicios en el constructor.</span><span class="sxs-lookup"><span data-stu-id="05d90-140">On instantiation of your class, authenticate the service provider in the constructor.</span></span> <span data-ttu-id="05d90-141">Para ello, cree una clase [CSecureChannelServer](csecurechannelserver-class.md) y establezca el certificado.</span><span class="sxs-lookup"><span data-stu-id="05d90-141">To do this, create a [CSecureChannelServer](csecurechannelserver-class.md) class and set the certificate.</span></span> <span data-ttu-id="05d90-142">Implemente la interfaz [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) y llame a los métodos de la clase CSecureChannelServer con instancias anteriores.</span><span class="sxs-lookup"><span data-stu-id="05d90-142">Implement the [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) interface and call the methods of the CSecureChannelServer class instantiated previously.</span></span> <span data-ttu-id="05d90-143">Consulte [autenticación del proveedor de servicios](authenticating-the-service-provider.md) para obtener información sobre cómo crear una instancia de la clase CSecureChannelServer e implementar los métodos IComponentAuthenticate.</span><span class="sxs-lookup"><span data-stu-id="05d90-143">See [Authenticating the Service Provider](authenticating-the-service-provider.md) to learn how to instantiate the CSecureChannelServer class and implement the IComponentAuthenticate methods.</span></span>
5.  <span data-ttu-id="05d90-144">Windows Media Administrador de dispositivos consultará a su proveedor de servicios para obtener una lista de dispositivos conectados mediante una llamada a [**IMDServiceProvider2:: CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) o [**IMDServiceProvider:: EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), en función de si el proveedor de servicios administra plug and Play dispositivos.</span><span class="sxs-lookup"><span data-stu-id="05d90-144">Windows Media Device Manager will query your service provider for a list of connected devices by calling [**IMDServiceProvider2::CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) or [**IMDServiceProvider::EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), depending on whether the service provider handles Plug and Play devices.</span></span> <span data-ttu-id="05d90-145">El proveedor de servicios debe devolver una lista de objetos [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) que representen los dispositivos conectados.</span><span class="sxs-lookup"><span data-stu-id="05d90-145">The service provider must return a list of [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) objects representing connected devices.</span></span> <span data-ttu-id="05d90-146">Consulte [enumeración de dispositivos](enumerating-devices-service-provider.md) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="05d90-146">See [Enumerating Devices](enumerating-devices-service-provider.md) for more details.</span></span>
6.  <span data-ttu-id="05d90-147">Antes de controlar cualquier llamada, compruebe que se ha establecido un canal seguro.</span><span class="sxs-lookup"><span data-stu-id="05d90-147">Before handling any call, verify that a secure channel has been established.</span></span> <span data-ttu-id="05d90-148">Llame a [**CSecureChannelServer:: fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) antes de realizar cualquier acción.</span><span class="sxs-lookup"><span data-stu-id="05d90-148">Call [**CSecureChannelServer::fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) before performing any actions.</span></span> <span data-ttu-id="05d90-149">Si se produce un error en esta llamada, se devuelve WMDM \_ E \_ NOTCERTIFIED.</span><span class="sxs-lookup"><span data-stu-id="05d90-149">If this call fails, return WMDM\_E\_NOTCERTIFIED.</span></span>
7.  <span data-ttu-id="05d90-150">Necesitará un par de certificado/clave emitido por Microsoft para poder controlar el material protegido con DRM.</span><span class="sxs-lookup"><span data-stu-id="05d90-150">You will need a certificate/key pair issued by Microsoft to be able to handle DRM-protected material.</span></span> <span data-ttu-id="05d90-151">Consulte [control del contenido protegido en el proveedor de servicios](handling-protected-content-in-the-service-provider.md) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="05d90-151">See [Handling Protected Content in the Service Provider](handling-protected-content-in-the-service-provider.md) for more information.</span></span>
8.  <span data-ttu-id="05d90-152">Para permitir que el dispositivo se sincronice automáticamente con Windows Media Player, debe cumplir los requisitos enumerados en [Habilitar la sincronización con windows media Player](enabling-synchronization-with-windows-media-player.md).</span><span class="sxs-lookup"><span data-stu-id="05d90-152">To enable your device to synchronize automatically with Windows Media Player, it must fulfill the requirements listed in [Enabling Synchronization with Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span></span>
9.  <span data-ttu-id="05d90-153">Para habilitar el dispositivo para que aparezca en el explorador de Windows, debe realizar algunos pasos especiales, que se detallan en [requisitos de los reproductores de audio portátiles que aparecen en el explorador de Windows](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span><span class="sxs-lookup"><span data-stu-id="05d90-153">To enable your device to appear in Windows Explorer, you must take a few special steps, detailed in [Requirements for Portable Audio Players to Appear in Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="05d90-154">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="05d90-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="05d90-155">**Guía de programación**</span><span class="sxs-lookup"><span data-stu-id="05d90-155">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 