---
title: Inicialización del Protocolo de autenticación
description: La conexión segura EAP se inicializa entre el cliente y el servidor de maneras similares para los clientes RAS e inalámbrico (802.1 X).
ms.assetid: 1cd5bfc9-2ba3-477c-9bbb-73578a5623c2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 856bd173ef617fb272460f874fa1d2087322c8b4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "104420622"
---
# <a name="authentication-protocol-initialization"></a><span data-ttu-id="d5699-103">Inicialización del Protocolo de autenticación</span><span class="sxs-lookup"><span data-stu-id="d5699-103">Authentication Protocol Initialization</span></span>

<span data-ttu-id="d5699-104">La conexión segura EAP se inicializa entre el cliente y el servidor de maneras similares para los clientes RAS e inalámbrico (802.1 X).</span><span class="sxs-lookup"><span data-stu-id="d5699-104">The EAP secured connection is initialized between the client and server in similar ways for RAS and wireless (802.1X) clients.</span></span>

## <a name="client"></a><span data-ttu-id="d5699-105">Remoto</span><span class="sxs-lookup"><span data-stu-id="d5699-105">Client</span></span>

<span data-ttu-id="d5699-106">Cuando el cliente intenta establecer la conexión, el servicio de autenticación obtiene la [información de identidad](obtaining-identity-information.md) del usuario.</span><span class="sxs-lookup"><span data-stu-id="d5699-106">When the client attempts to establish the connection, the authentication service obtains [identity information](obtaining-identity-information.md) for the user.</span></span> <span data-ttu-id="d5699-107">Si el valor NAMEDLG de la **\_ \_ \_ \_ invocación del ValueName EAP de Ras** está presente en el registro para este protocolo de autenticación y este valor se establece en cero, el servicio de autenticación llama a [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span><span class="sxs-lookup"><span data-stu-id="d5699-107">If the **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** value is present in the registry for this authentication protocol and this value is set to zero, the authentication service calls [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span></span> <span data-ttu-id="d5699-108">Normalmente, esta función muestra una interfaz de usuario que permite que la información de identidad sea de un tipo específico del Protocolo de autenticación; por ejemplo, un certificado o un identificador numérico.</span><span class="sxs-lookup"><span data-stu-id="d5699-108">This function typically displays a user interface that allows the identity information to be of a type specific to the authentication protocol; for example, a certificate or numeric ID.</span></span> <span data-ttu-id="d5699-109">Si **la \_ \_ \_ invocación de \_ NAMEDLG de EAP de Ras** no está presente o se establece en uno, el servicio de autenticación muestra el cuadro de diálogo de nombre de usuario estándar del sistema.</span><span class="sxs-lookup"><span data-stu-id="d5699-109">If **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** is not present, or is set to one, the authentication service displays the standard system user-name dialog.</span></span>

<span data-ttu-id="d5699-110">Una vez que el servicio de autenticación ha obtenido la información de identidad del usuario, llama a la implementación del Protocolo de autenticación de [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="d5699-110">Once the authentication service has obtained the identity information for the user, it calls the authentication protocol's implementation of [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="d5699-111">Esta llamada permite al Protocolo de autenticación asignar e inicializar un búfer de trabajo que el servicio pasa en llamadas posteriores a [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) y [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="d5699-111">This call allows the authentication protocol to allocate and initialize a work buffer that the service passes on subsequent calls to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) and [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span></span> <span data-ttu-id="d5699-112">El búfer de trabajo es opaco para el servicio y nunca tiene acceso al contenido del búfer de trabajo.</span><span class="sxs-lookup"><span data-stu-id="d5699-112">The work buffer is opaque to the service and never accesses the contents of the work buffer.</span></span> <span data-ttu-id="d5699-113">Si el protocolo de autenticación crea un búfer de trabajo distinto para cada sesión EAP, el búfer de trabajo es sesión y seguro para subprocesos.</span><span class="sxs-lookup"><span data-stu-id="d5699-113">If the authentication protocol creates a distinct work buffer for each EAP session, then the work buffer is session and thread safe.</span></span> <span data-ttu-id="d5699-114">Dado que el protocolo de autenticación asigna la memoria para el búfer de trabajo, el protocolo de autenticación también debe liberar esta memoria mediante la función [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) .</span><span class="sxs-lookup"><span data-stu-id="d5699-114">Because the authentication protocol allocates the memory for the work buffer, the authentication protocol should also free this memory using the [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) function.</span></span>

<span data-ttu-id="d5699-115">En la llamada a [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)), el servicio también pasa una estructura de [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) que contiene punteros a la información de configuración para la conexión y la información de identidad del usuario.</span><span class="sxs-lookup"><span data-stu-id="d5699-115">In the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)), the service also passes a [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure that contains pointers to the configuration information for the connection, and the identity information for the user.</span></span> <span data-ttu-id="d5699-116">El servicio siempre pasa un valor para el miembro **pszIdentity** de **\_ \_ entrada EAP de PPP**.</span><span class="sxs-lookup"><span data-stu-id="d5699-116">The service always passes in a value for the **pszIdentity** member of **PPP\_EAP\_INPUT**.</span></span> <span data-ttu-id="d5699-117">Sin embargo, el miembro **pszPassword** de [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) puede ser **null**.</span><span class="sxs-lookup"><span data-stu-id="d5699-117">However, the **pszPassword** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) may be **NULL**.</span></span>

<span data-ttu-id="d5699-118">Dentro de la estructura de [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) , el miembro **fAuthenticator** indica si se está invocando el protocolo de autenticación para autenticarse (en el cliente) o como el autenticador (en el servidor).</span><span class="sxs-lookup"><span data-stu-id="d5699-118">Within the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure, the **fAuthenticator** member indicates whether the authentication protocol is being invoked to be authenticated (on the client) or as the authenticator (on the server).</span></span>

## <a name="server"></a><span data-ttu-id="d5699-119">Servidor</span><span class="sxs-lookup"><span data-stu-id="d5699-119">Server</span></span>

<span data-ttu-id="d5699-120">En el servidor, el miembro **bInitialID** de [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) especifica el identificador que utiliza el servidor para el primer paquete EAP.</span><span class="sxs-lookup"><span data-stu-id="d5699-120">On the server, the **bInitialID** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) specifies the ID that the server uses for the first EAP packet.</span></span> <span data-ttu-id="d5699-121">El servidor incrementa este identificador para los paquetes posteriores.</span><span class="sxs-lookup"><span data-stu-id="d5699-121">The server increments this ID for subsequent packets.</span></span>

<span data-ttu-id="d5699-122">Además, en el servidor, el puntero **pUserAttributes** de [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) apunta a una matriz de atributos del tipo de [**\_ \_ atributo \_ de autenticación ras**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) .</span><span class="sxs-lookup"><span data-stu-id="d5699-122">Also on the server, the **pUserAttributes** pointer in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) points to an array of attributes of the [**RAS\_AUTH\_ATTRIBUTE\_TYPE**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) type.</span></span> <span data-ttu-id="d5699-123">Estos son los atributos del usuario que se obtuvieron del cliente.</span><span class="sxs-lookup"><span data-stu-id="d5699-123">These are attributes for the user that were obtained from the client.</span></span>

<span data-ttu-id="d5699-124">Si la llamada a [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) devuelve un valor distinto **de \_ error**, la sesión se desconecta.</span><span class="sxs-lookup"><span data-stu-id="d5699-124">If the [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) call returns any value other than **NO\_ERROR**, the session is disconnected.</span></span> <span data-ttu-id="d5699-125">El error devuelto se registra (en el servidor) o se muestra al usuario (en el cliente).</span><span class="sxs-lookup"><span data-stu-id="d5699-125">The returned error is logged (on the server), or displayed to the user (on the client).</span></span>

 

 