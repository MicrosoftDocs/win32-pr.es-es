---
title: Conjuntos de fuentes personalizadas
description: En este tema se describen varias maneras en las que puede usar fuentes personalizadas en la aplicación.
ms.assetid: 50842838-d150-df9a-f1b7-67ce5ea2bc80
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a79f1ccfcb1dadd355c5f582417aacb5041ecf8b
ms.sourcegitcommit: 89f99926f946dc6c5ea600fb7c41f6b19ceac516
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/21/2020
ms.locfileid: "104421601"
---
# <a name="custom-font-sets"></a><span data-ttu-id="22f01-103">Conjuntos de fuentes personalizadas</span><span class="sxs-lookup"><span data-stu-id="22f01-103">Custom Font Sets</span></span>

<span data-ttu-id="22f01-104">En este tema se describen varias maneras en las que puede usar fuentes personalizadas en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-104">This topic describes various ways in which you can use custom fonts in your app.</span></span>

-   [<span data-ttu-id="22f01-105">Aparición </span><span class="sxs-lookup"><span data-stu-id="22f01-105">Introduction </span></span>](#introduction)
-   [<span data-ttu-id="22f01-106">Resumen de API</span><span class="sxs-lookup"><span data-stu-id="22f01-106">Summary of APIs</span></span>](#summary-of-apis)
-   [<span data-ttu-id="22f01-107">Conceptos clave</span><span class="sxs-lookup"><span data-stu-id="22f01-107">Key concepts</span></span>](#key-concepts)
-   [<span data-ttu-id="22f01-108">Fuentes y formatos de archivo de fuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-108">Fonts and font file formats</span></span>](#fonts-and-font-file-formats)
-   [<span data-ttu-id="22f01-109">Conjuntos de fuentes y colecciones de fuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-109">Font sets and font collections</span></span>](#font-sets-and-font-collections)
-   [<span data-ttu-id="22f01-110">Escenarios comunes</span><span class="sxs-lookup"><span data-stu-id="22f01-110">Common scenarios</span></span>](#common-scenarios)
    -   [<span data-ttu-id="22f01-111">Crear un conjunto de fuentes usando fuentes arbitrarias en el sistema de archivos local</span><span class="sxs-lookup"><span data-stu-id="22f01-111">Creating a font set using arbitrary fonts in the local file system</span></span>](#creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="22f01-112">Crear un conjunto de fuentes usando fuentes conocidas en el sistema de archivos local</span><span class="sxs-lookup"><span data-stu-id="22f01-112">Creating a font set using known fonts in the local file system</span></span>](#creating-a-font-set-using-known-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="22f01-113">Crear un conjunto de fuentes personalizado mediante fuentes conocidas y remotas en la web</span><span class="sxs-lookup"><span data-stu-id="22f01-113">Creating a custom font set using known, remote fonts on the Web</span></span>](#creating-a-custom-font-set-using-known-remote-fonts-on-the-web)
    -   [<span data-ttu-id="22f01-114">Crear un conjunto de fuentes personalizado con datos de fuente cargados en la memoria</span><span class="sxs-lookup"><span data-stu-id="22f01-114">Creating a custom font set using font data loaded into memory</span></span>](#creating-a-custom-font-set-using-font-data-loaded-into-memory)
-   [<span data-ttu-id="22f01-115">Escenarios avanzados</span><span class="sxs-lookup"><span data-stu-id="22f01-115">Advanced scenarios</span></span>](#advanced-scenarios)
    -   [<span data-ttu-id="22f01-116">Combinación de conjuntos de fuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-116">Combining font sets</span></span>](#combining-font-sets)
    -   [<span data-ttu-id="22f01-117">Uso de datos de fuente WOFF o WOFF2 local </span><span class="sxs-lookup"><span data-stu-id="22f01-117">Using local WOFF or WOFF2 font data </span></span>](#using-local-woff-or-woff2-font-data)
    -   [<span data-ttu-id="22f01-118">Usar los mecanismos de fuentes remotas de DirectWrite con implementación de red de bajo nivel personalizada </span><span class="sxs-lookup"><span data-stu-id="22f01-118">Using DirectWrite remote font mechanisms with custom low-level network implementation </span></span>](#using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation)
    -   [<span data-ttu-id="22f01-119">Escenarios de compatibilidad con versiones anteriores de Windows </span><span class="sxs-lookup"><span data-stu-id="22f01-119">Supporting scenarios on earlier Windows versions </span></span>](#supporting-scenarios-on-earlier-windows-versions)

## <a name="introduction"></a><span data-ttu-id="22f01-120">Introducción</span><span class="sxs-lookup"><span data-stu-id="22f01-120">Introduction</span></span>

<span data-ttu-id="22f01-121">La mayoría de las veces, las aplicaciones usan las fuentes que se instalan localmente en el sistema.</span><span class="sxs-lookup"><span data-stu-id="22f01-121">Most of the time, apps use the fonts that are installed locally on the system.</span></span> <span data-ttu-id="22f01-122">DirectWrite proporciona acceso a estas fuentes mediante los métodos [**IDWriteFactory3:: GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) o [**IDWriteFactory:: GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) .</span><span class="sxs-lookup"><span data-stu-id="22f01-122">DirectWrite provides access to these fonts using the [**IDWriteFactory3::GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) or [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) methods.</span></span> <span data-ttu-id="22f01-123">En algunos casos, las aplicaciones también pueden querer usar fuentes que se incluyen como parte de Windows 10, pero que no están instaladas actualmente en el sistema actual.</span><span class="sxs-lookup"><span data-stu-id="22f01-123">In some cases, apps may also want to use fonts that are included as part of Windows 10 but that are not currently installed on the current system.</span></span> <span data-ttu-id="22f01-124">Se puede tener acceso a estas fuentes desde el servicio de fuentes de Windows mediante el método **GetSystemFontSet** o llamando a [**IDWriteFactory3:: GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) con includeDownloadableFonts establecido en true.</span><span class="sxs-lookup"><span data-stu-id="22f01-124">Such fonts can be accessed from the Windows font service by using the **GetSystemFontSet** method, or by calling [**IDWriteFactory3::GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) with includeDownloadableFonts set to TRUE.</span></span> 

<span data-ttu-id="22f01-125">Sin embargo, en algunos escenarios de aplicación, las aplicaciones deben usar fuentes que no están instaladas en el sistema y que el servicio de fuentes de Windows no las proporciona.</span><span class="sxs-lookup"><span data-stu-id="22f01-125">In some application scenarios, however, apps need to use fonts that are not installed in the system and are not provided by the Windows Font Service.</span></span> <span data-ttu-id="22f01-126">Estos son algunos ejemplos de estos escenarios:</span><span class="sxs-lookup"><span data-stu-id="22f01-126">The following are examples of such scenarios:</span></span>

-   <span data-ttu-id="22f01-127">Las fuentes se incrustan como recursos en un archivo binario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-127">Fonts are embedded as resources within an app binary.</span></span>
-   <span data-ttu-id="22f01-128">Los archivos de fuentes se incluyen en un paquete de la aplicación y se almacenan en el disco en la carpeta de instalación de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-128">Font files are bundled within an app package and stored on disk under the app’s installation folder.</span></span>
-   <span data-ttu-id="22f01-129">La aplicación es una herramienta de desarrollo de fuentes que necesita cargar archivos de fuentes especificados por el usuario.</span><span class="sxs-lookup"><span data-stu-id="22f01-129">The app is a font-development tool that needs to load user-specified font files.</span></span> 
-   <span data-ttu-id="22f01-130">Las fuentes se incrustan en archivos de documento que se pueden ver o editar en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-130">Fonts are embedded in document files that can be viewed or edited in the app.</span></span> 
-   <span data-ttu-id="22f01-131">La aplicación usa fuentes obtenidas de un servicio de fuentes web público.</span><span class="sxs-lookup"><span data-stu-id="22f01-131">The app uses fonts obtained from a public Web font service.</span></span> 
-   <span data-ttu-id="22f01-132">La aplicación usa datos de fuente transmitidos a través de un protocolo de red privada.</span><span class="sxs-lookup"><span data-stu-id="22f01-132">The app uses font data streamed via a private network protocol.</span></span> 

<span data-ttu-id="22f01-133">DirectWrite proporciona las API para trabajar con fuentes personalizadas en estos y otros escenarios similares.</span><span class="sxs-lookup"><span data-stu-id="22f01-133">DirectWrite provides APIs for working with custom fonts in these and other similar scenarios.</span></span> <span data-ttu-id="22f01-134">Los datos de fuentes personalizadas pueden provienen de archivos del sistema de archivos local; desde orígenes remotos basados en la nube a los que se tiene acceso mediante HTTP; o de orígenes arbitrarios después de haberse cargado en un búfer de memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-134">The custom font data might come from files in the local file system; from remote, cloud-based sources accessed using HTTP; or from arbitrary sources after having been loaded into a memory buffer.</span></span> 

> [!Note]  
> <span data-ttu-id="22f01-135">Aunque DirectWrite ha proporcionado API para trabajar con fuentes personalizadas desde Windows 7, las API más recientes se agregaron en Windows 10 y de nuevo en Windows 10 Creators Update (versión preliminar 15021 o posterior) que facilitan la implementación de varios de los escenarios mencionados.</span><span class="sxs-lookup"><span data-stu-id="22f01-135">While DirectWrite has provided APIs for working with custom fonts since Windows 7, newer APIs were added in Windows 10 and again in the Windows 10 Creators Update (preview build 15021 or later) that make it easier to implement several of the scenarios mentioned.</span></span> <span data-ttu-id="22f01-136">Este tema se centra en las API disponibles en Windows 10.</span><span class="sxs-lookup"><span data-stu-id="22f01-136">This topic focuses on APIs available in Window 10.</span></span> <span data-ttu-id="22f01-137">Para las aplicaciones que necesitan trabajar en versiones anteriores de Windows, consulte [colecciones de fuentes personalizadas (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="22f01-137">For applications that need to work on earlier Windows versions, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span> 

 

## <a name="summary-of-apis"></a><span data-ttu-id="22f01-138">Resumen de API</span><span class="sxs-lookup"><span data-stu-id="22f01-138">Summary of APIs</span></span>

<span data-ttu-id="22f01-139">Este tema se centra en la funcionalidad proporcionada por las siguientes API:</span><span class="sxs-lookup"><span data-stu-id="22f01-139">This topic focuses on functionality provided by the following APIs:</span></span> 

-   <span data-ttu-id="22f01-140">Interfaz [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset)</span><span class="sxs-lookup"><span data-stu-id="22f01-140">[**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interface</span></span>
-   <span data-ttu-id="22f01-141">Interfaz [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder)</span><span class="sxs-lookup"><span data-stu-id="22f01-141">[**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface</span></span>
-   <span data-ttu-id="22f01-142">Interfaz [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1)</span><span class="sxs-lookup"><span data-stu-id="22f01-142">[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface</span></span> 
-   <span data-ttu-id="22f01-143">Interfaz [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference)</span><span class="sxs-lookup"><span data-stu-id="22f01-143">[**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface</span></span>
-   <span data-ttu-id="22f01-144">Interfaz [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)</span><span class="sxs-lookup"><span data-stu-id="22f01-144">[**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) interface</span></span>
-   <span data-ttu-id="22f01-145">[**IDWriteFactory:: CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-145">[**IDWriteFactory::CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) method</span></span> 
-   <span data-ttu-id="22f01-146">[**IDWriteFactory:: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-146">[**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method</span></span> 
-   <span data-ttu-id="22f01-147">[**IDWriteFactory3:: CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference) (métodos)</span><span class="sxs-lookup"><span data-stu-id="22f01-147">[**IDWriteFactory3::CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference) methods</span></span> 
-   <span data-ttu-id="22f01-148">[**DWRITE \_ Estructura de la \_ propiedad Font**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property)</span><span class="sxs-lookup"><span data-stu-id="22f01-148">[**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structure</span></span> 
-   <span data-ttu-id="22f01-149">[**DWRITE \_ Enumeración de \_ \_ ID. de propiedad de fuente**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id)</span><span class="sxs-lookup"><span data-stu-id="22f01-149">[**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enumeration</span></span> 
-   <span data-ttu-id="22f01-150">Interfaz [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="22f01-150">[**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface</span></span> 
-   <span data-ttu-id="22f01-151">[**IDWriteFactory:: RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-151">[**IDWriteFactory::RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader) method</span></span> 
-   <span data-ttu-id="22f01-152">[**IDWriteFactory:: UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-152">[**IDWriteFactory::UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader) method</span></span> 
-   <span data-ttu-id="22f01-153">[**IDWriteFactory5:: CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-153">[**IDWriteFactory5::CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader) method</span></span> 
-   <span data-ttu-id="22f01-154">Interfaz [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="22f01-154">[**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader) interface</span></span> 
-   <span data-ttu-id="22f01-155">[**IDWriteFactory5:: CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-155">[**IDWriteFactory5::CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader) method</span></span> 
-   <span data-ttu-id="22f01-156">Interfaz [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="22f01-156">[**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface</span></span> 
-   <span data-ttu-id="22f01-157">Interfaz [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue)</span><span class="sxs-lookup"><span data-stu-id="22f01-157">[**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface</span></span> 
-   <span data-ttu-id="22f01-158">Interfaz [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener)</span><span class="sxs-lookup"><span data-stu-id="22f01-158">[**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface</span></span> 
-   <span data-ttu-id="22f01-159">Interfaz [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="22f01-159">[**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface</span></span> 
-   <span data-ttu-id="22f01-160">Interfaz [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="22f01-160">[**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream) interface</span></span> 
-   <span data-ttu-id="22f01-161">Interfaz [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult)</span><span class="sxs-lookup"><span data-stu-id="22f01-161">[**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) interface</span></span> 
-   <span data-ttu-id="22f01-162">[**IDWriteFactory5:: AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-162">[**IDWriteFactory5::AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype) method</span></span> 
-   <span data-ttu-id="22f01-163">[**IDWriteFactory5:: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile) (método)</span><span class="sxs-lookup"><span data-stu-id="22f01-163">[**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile) method</span></span> 

 

## <a name="key-concepts"></a><span data-ttu-id="22f01-164">Conceptos clave</span><span class="sxs-lookup"><span data-stu-id="22f01-164">Key concepts</span></span>

<span data-ttu-id="22f01-165">Para comprender las API de DirectWrite para trabajar con fuentes personalizadas, puede ser útil comprender el modelo conceptual subyacente a estas API.</span><span class="sxs-lookup"><span data-stu-id="22f01-165">To understand the DirectWrite APIs for working with custom fonts, it can be helpful to understand the conceptual model that underlies these APIs.</span></span> <span data-ttu-id="22f01-166">Aquí se describen los conceptos clave.</span><span class="sxs-lookup"><span data-stu-id="22f01-166">Key concepts will be described here.</span></span> 

<span data-ttu-id="22f01-167">Cuando DirectWrite realiza el diseño de texto real o la representación, necesita tener acceso a los datos de la fuente real.</span><span class="sxs-lookup"><span data-stu-id="22f01-167">When DirectWrite does actual text layout or rendering, it needs to access actual font data.</span></span> <span data-ttu-id="22f01-168">Un objeto de fuente de fuentes contiene datos de fuentes reales, que deben existir en el sistema local.</span><span class="sxs-lookup"><span data-stu-id="22f01-168">A font face object holds actual font data, which must exist in the local system.</span></span> <span data-ttu-id="22f01-169">Pero para otras operaciones, como la comprobación de la disponibilidad de una fuente determinada o la presentación de opciones de fuente para un usuario, todo lo que se necesita es una referencia a una fuente determinada, no los propios datos de la fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-169">But for other operations, such as checking availability of a particular font, or presenting font choices to a user, all that is needed is a reference to a particular font, not the actual font data itself.</span></span> <span data-ttu-id="22f01-170">En DirectWrite, un objeto de referencia de tipo Font contiene solo la información necesaria para buscar y crear una instancia de una fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-170">In DirectWrite, a font face reference object holds just the information needed to locate and instantiate a font.</span></span> <span data-ttu-id="22f01-171">Dado que la referencia de la fuente de fuentes no contiene datos reales, DirectWrite puede tratar las referencias de la fuente para los datos reales que se encuentran en una ubicación de red remota, así como cuando los datos reales son locales.</span><span class="sxs-lookup"><span data-stu-id="22f01-171">Because the font face reference doesn’t hold actual data, DirectWrite can deal with font face references for which actual data is in a remote network location as well as when the actual data is local.</span></span>

<span data-ttu-id="22f01-172">Un conjunto de fuentes es un conjunto de referencias de la fuente de fuentes, junto con ciertas propiedades básicas e informativas que se pueden usar para hacer referencia a la fuente o para compararla con otras fuentes, como el nombre de familia o un valor de fuente-peso.</span><span class="sxs-lookup"><span data-stu-id="22f01-172">A font set is a set of font face references, along with certain basic, informational properties that can be used in referring to the font or in comparing it to other fonts, such as the family name, or a font-weight value.</span></span> <span data-ttu-id="22f01-173">Los datos reales de las distintas fuentes pueden ser locales o bien pueden ser remotos o una mezcla.</span><span class="sxs-lookup"><span data-stu-id="22f01-173">The actual data for the various fonts may be local, or it may all be remote, or some mixture.</span></span>

<span data-ttu-id="22f01-174">Se puede utilizar un conjunto de fuentes para obtener un objeto de colección de fuentes correspondiente.</span><span class="sxs-lookup"><span data-stu-id="22f01-174">A font set can be used to obtain a corresponding font collection object.</span></span> <span data-ttu-id="22f01-175">Para obtener más información, vea conjuntos de fuentes y colecciones de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-175">See Font sets and font collections below for more details.</span></span> 

<span data-ttu-id="22f01-176">La interfaz IDWriteFontSet proporciona métodos que permiten consultar valores de propiedad como el nombre de la familia o el espesor de fuente, o las referencias de la fuente que coinciden con valores de propiedad concretos.</span><span class="sxs-lookup"><span data-stu-id="22f01-176">The IDWriteFontSet interface provides methods that allow querying for property values such as family name or font-weight, or for font face references that match particular property values.</span></span> <span data-ttu-id="22f01-177">Después de filtrar hasta una selección determinada, se puede obtener una instancia de la interfaz [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) , con métodos para descargar (si los datos de fuentes reales actualmente son remotos), para obtener el objeto [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) correspondiente que se puede usar para el diseño y la representación.</span><span class="sxs-lookup"><span data-stu-id="22f01-177">After filtering down to a particular selection, an instance of the [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface can be obtained, with methods for downloading (if the actual font data is currently remote), for obtaining the corresponding [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) object that can be used for layout and rendering.</span></span> 

<span data-ttu-id="22f01-178">La interfaz IDWriteFontFile se basa en cada tipo de fuente o referencia de fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-178">The IDWriteFontFile interface underlies each font face or font face reference.</span></span> <span data-ttu-id="22f01-179">Representa la ubicación de un archivo de fuentes y tiene dos componentes: un cargador de archivos de fuentes y una clave de archivo de fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-179">This represents the location of a font file, and has two components: a font file loader, and a font file key.</span></span> <span data-ttu-id="22f01-180">El cargador de archivos de fuentes ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) se usa para abrir un archivo si es necesario y devuelve una secuencia con los datos ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span><span class="sxs-lookup"><span data-stu-id="22f01-180">The font file loader ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) is used to open a file if needed, and returns a stream with the data ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span></span> <span data-ttu-id="22f01-181">Dependiendo del cargador, los datos pueden estar ubicados en una ruta de acceso de archivo local, una dirección URL remota o en un búfer de memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-181">Depending on the loader, the data may be located at a local file path, a remote URL, or in a memory buffer.</span></span> <span data-ttu-id="22f01-182">La clave es un valor definido por el cargador que identifica de forma única el archivo en el contexto del cargador, lo que permite al cargador buscar los datos y crear un flujo para él.</span><span class="sxs-lookup"><span data-stu-id="22f01-182">The key is a loader-defined value that uniquely identifies the file within the loader context, allowing the loader to locate the data and create a stream for it.</span></span> 

<span data-ttu-id="22f01-183">Las fuentes personalizadas se pueden agregar fácilmente a un conjunto de fuentes personalizado, que a su vez se puede usar para filtrar u organizar la información de fuente para propósitos como la creación de una interfaz de usuario del selector de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-183">Custom fonts can easily be added to a custom font set, which in turn can be used for filtering or organizing font information for purposes such as creating a font-picker user interface.</span></span> <span data-ttu-id="22f01-184">El conjunto de fuentes también puede usarse para crear una colección de fuentes para su uso en API de nivel superior como [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) y [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span><span class="sxs-lookup"><span data-stu-id="22f01-184">The font set can also be used to create a font collection for use in higher-level APIs like [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) and [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span></span> <span data-ttu-id="22f01-185">La interfaz [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) se puede usar para crear un conjunto de fuentes personalizado que incluya varias fuentes personalizadas.</span><span class="sxs-lookup"><span data-stu-id="22f01-185">The [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface can be used to create a custom font set that includes several custom fonts.</span></span> <span data-ttu-id="22f01-186">También se puede usar para crear un conjunto de fuentes personalizado que mezcla fuentes personalizadas y fuentes proporcionadas por el sistema; o que mezcla las fuentes con distintos orígenes para los datos reales: el almacenamiento local, las direcciones URL remotas y la memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-186">It can also be used to create a custom font set that mixes custom fonts and system-provided fonts; or that mixes fonts with different sources for the actual data — local storage, remote URLs, and memory.</span></span> 

<span data-ttu-id="22f01-187">Como se mencionó, una referencia de fuente puede hacer referencia a los datos de fuente de un origen remoto, pero los datos deben ser locales para obtener un objeto de fuente de fuentes que se pueda usar para el diseño y la representación.</span><span class="sxs-lookup"><span data-stu-id="22f01-187">As mentioned, a font face reference may refer to font data at a remote source, but the data must be local in order to obtain a font face object that can be used for layout and rendering.</span></span> <span data-ttu-id="22f01-188">La descarga de datos remotos se controla mediante una cola de descarga de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-188">Downloading of remote data is handled by a font download queue.</span></span> <span data-ttu-id="22f01-189">Las aplicaciones pueden usar la interfaz [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) para poner en cola las solicitudes para descargar fuentes remotas con el fin de iniciar el proceso de descarga y registrar un objeto [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) para que realice una acción cuando se complete el proceso de descarga.</span><span class="sxs-lookup"><span data-stu-id="22f01-189">Apps can use the [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface to enqueue requests to download remote fonts to initiate the download process, and to register an [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) object to take action when the download process has completed.</span></span> 

<span data-ttu-id="22f01-190">Para la mayoría de las interfaces que se describen aquí, DirectWrite proporciona implementaciones del sistema.</span><span class="sxs-lookup"><span data-stu-id="22f01-190">For most of the interfaces described here, DirectWrite provides system implementations.</span></span> <span data-ttu-id="22f01-191">La única excepción es la interfaz [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) , que una aplicación implementa para realizar acciones específicas de la aplicación cuando se han descargado localmente fuentes remotas.</span><span class="sxs-lookup"><span data-stu-id="22f01-191">The one exception is the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, which an app implements to take app-specific actions when remote fonts have been downloaded locally.</span></span> <span data-ttu-id="22f01-192">Las aplicaciones pueden tener razones para proporcionar sus propias implementaciones personalizadas para algunas otras interfaces, aunque esto solo se necesita en escenarios específicos y más avanzados.</span><span class="sxs-lookup"><span data-stu-id="22f01-192">Apps may have reason to provide their own custom implementations for certain other interfaces, though that would only be needed in specific, more advanced scenarios.</span></span> <span data-ttu-id="22f01-193">Por ejemplo, una aplicación necesitaría proporcionar una implementación personalizada de la interfaz [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) para controlar los archivos de fuente en el almacenamiento local que usan el formato de contenedor WOFF2.</span><span class="sxs-lookup"><span data-stu-id="22f01-193">For example, an app would need to provide a custom implementation of the [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface to handle font files in local storage that use the WOFF2 container format.</span></span> <span data-ttu-id="22f01-194">A continuación se proporcionan detalles adicionales.</span><span class="sxs-lookup"><span data-stu-id="22f01-194">Additional details will be provided below.</span></span> 

## <a name="fonts-and-font-file-formats"></a><span data-ttu-id="22f01-195">Fuentes y formatos de archivo de fuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-195">Fonts and font file formats</span></span>

<span data-ttu-id="22f01-196">Otro concepto clave que resulta útil comprender es la relación entre las caras de fuente individuales y los archivos de fuente que los contienen.</span><span class="sxs-lookup"><span data-stu-id="22f01-196">Another key concept that is helpful to understand is the relationship between individual font faces and font files that contain them.</span></span> <span data-ttu-id="22f01-197">La idea de un archivo de fuentes OpenType (. ttf o. otf) que contiene una sola fuente resulta familiar.</span><span class="sxs-lookup"><span data-stu-id="22f01-197">The idea of an OpenType font file (.ttf or .otf) containing a single font is familiar.</span></span> <span data-ttu-id="22f01-198">Sin embargo, el formato de fuente OpenType también permite una colección de fuentes OpenType (. TTC o. OTC), que es un único archivo que contiene varias fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-198">But the OpenType font format also allows for an OpenType Font Collection (.ttc or .otc), which is a single file that contains multiple fonts.</span></span> <span data-ttu-id="22f01-199">Los archivos de colección OpenType se suelen usar para fuentes grandes que están estrechamente relacionadas y tienen valores idénticos para determinados datos de fuente: al combinar las fuentes en un solo archivo, se pueden desduplicar los datos comunes.</span><span class="sxs-lookup"><span data-stu-id="22f01-199">OpenType Collection files are often used for large fonts that are closely related and have identical values for certain font data: by combining the fonts in a single file, the common data can be de-duplicated.</span></span> <span data-ttu-id="22f01-200">Por esta razón, una referencia de fuente o fuente de fuente debe hacer referencia no solo a un archivo de fuente (o a un origen de datos equivalente), pero también debe especificar un índice de fuente dentro de ese archivo, para el caso general en el que el archivo puede ser un archivo de colección.</span><span class="sxs-lookup"><span data-stu-id="22f01-200">For this reason, a font face or font face reference needs to refer not only to a font file (or equivalent data source), but it must also specify a font index within that file, for the general case in which the file may be a Collection file.</span></span> 

<span data-ttu-id="22f01-201">En el caso de las fuentes usadas en la web, los datos de la fuente se suelen empaquetar en ciertos formatos de contenedor, WOFF o WOFF2, que proporcionan cierta compresión de los datos de la fuente y cierto nivel de protección contra la piratería y la infracción de las licencias de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-201">For fonts used on the Web, font data is often packed into certain container formats, WOFF or WOFF2, which provide some compression of the font data and some level of protection against piracy and violation of font licenses.</span></span> <span data-ttu-id="22f01-202">Funcionalmente, un archivo WOFF o WOFF2 es equivalente a una fuente OpenType o un archivo de colección de fuentes, pero los datos se codifican en un formato diferente que requiere desempaquetar antes de que se pueda usar.</span><span class="sxs-lookup"><span data-stu-id="22f01-202">Functionally, a WOFF or WOFF2 file is equivalent to an OpenType font or Font Collection file, but the data is encoded in a different format that requires unpacking before it can be used.</span></span> 

<span data-ttu-id="22f01-203">Ciertas API de DirectWrite pueden tratar con caras de fuente individuales, mientras que otras API pueden controlar archivos que podrían incluir archivos de colección OpenType que contienen varias caras.</span><span class="sxs-lookup"><span data-stu-id="22f01-203">Certain DirectWrite APIs may deal with individual font faces, while other APIs can handle files that might include OpenType Collection files that contain multiple faces.</span></span> <span data-ttu-id="22f01-204">Del mismo modo, algunas API solo tratan los datos sin formato de OpenType, mientras que otras API pueden administrar los formatos de contenedor empaquetado, WOFF y WOFF2.</span><span class="sxs-lookup"><span data-stu-id="22f01-204">Similarly, certain APIs deal only with raw, OpenType-format data, while other APIs can handle the packed, WOFF and WOFF2 container formats.</span></span> <span data-ttu-id="22f01-205">Estos detalles se proporcionan en la siguiente discusión.</span><span class="sxs-lookup"><span data-stu-id="22f01-205">These details are provided in the discussion below.</span></span> 

## <a name="font-sets-and-font-collections"></a><span data-ttu-id="22f01-206">Conjuntos de fuentes y colecciones de fuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-206">Font sets and font collections</span></span>

<span data-ttu-id="22f01-207">Algunas aplicaciones pueden implementarse para trabajar con fuentes mediante la interfaz [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) .</span><span class="sxs-lookup"><span data-stu-id="22f01-207">Some applications may be implemented to work with fonts using the [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) interface.</span></span> <span data-ttu-id="22f01-208">Existe una correspondencia directa entre una colección de fuentes y un conjunto de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-208">There is a direct correspondence between a font collection and a font set.</span></span> <span data-ttu-id="22f01-209">Cada una de ellas puede contener las mismas fuentes, pero presentarlas con otra organización.</span><span class="sxs-lookup"><span data-stu-id="22f01-209">Each can hold the same fonts, but they present them with a different organization.</span></span> <span data-ttu-id="22f01-210">Desde cualquier colección de fuentes, se puede obtener un conjunto de fuentes correspondiente y viceversa.</span><span class="sxs-lookup"><span data-stu-id="22f01-210">From any font collection, a corresponding font set can be obtained, and vice versa.</span></span>

<span data-ttu-id="22f01-211">Cuando se trabaja con varias fuentes personalizadas, es más fácil utilizar una interfaz de generador de conjuntos de fuentes para crear un conjunto de fuentes personalizado y, a continuación, obtener una colección de fuentes una vez creado el conjunto de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-211">When working with a number of custom fonts, it is easiest to use a font set builder interface to create a custom font set, and then obtain a font collection after the font set is created.</span></span> <span data-ttu-id="22f01-212">El proceso para crear un conjunto de fuentes personalizado se describe en detalle a continuación.</span><span class="sxs-lookup"><span data-stu-id="22f01-212">The process for creating a custom font set will be described in detail below.</span></span> <span data-ttu-id="22f01-213">Para obtener una interfaz [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) a partir de un conjunto de fuentes, se usa el método [**IDWriteFactory3:: CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) .</span><span class="sxs-lookup"><span data-stu-id="22f01-213">To obtain an [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) interface from a font set, the [**IDWriteFactory3::CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) method is used.</span></span>

<span data-ttu-id="22f01-214">Si la aplicación tiene un objeto de colección y necesita obtener un conjunto de fuentes correspondiente, puede hacerlo mediante el método [**IDWriteFontCollection1:: GetFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) .</span><span class="sxs-lookup"><span data-stu-id="22f01-214">If the app has a collection object and needs to obtain a corresponding font set, this can be done using the [**IDWriteFontCollection1::GetFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) method.</span></span> 

## <a name="common-scenarios"></a><span data-ttu-id="22f01-215">Escenarios frecuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-215">Common scenarios</span></span>

<span data-ttu-id="22f01-216">En esta sección se describen algunos de los escenarios más comunes que implican conjuntos de fuentes personalizados:</span><span class="sxs-lookup"><span data-stu-id="22f01-216">This section describes some of the most common scenarios involving custom font sets:</span></span>

-   <span data-ttu-id="22f01-217">Crear un conjunto de fuentes personalizado mediante fuentes arbitrarias en las rutas de acceso del sistema de archivos local.</span><span class="sxs-lookup"><span data-stu-id="22f01-217">Creating a custom font set using arbitrary fonts at paths in the local file system.</span></span>
-   <span data-ttu-id="22f01-218">Creación de un conjunto de fuentes personalizado mediante fuentes conocidas (tal vez que se incluyen con la aplicación) que se almacenan en el sistema de archivos local.</span><span class="sxs-lookup"><span data-stu-id="22f01-218">Creating a custom font set using known fonts (perhaps bundled with the app) that are stored in the local file system.</span></span>
-   <span data-ttu-id="22f01-219">Crear un conjunto de fuentes personalizado mediante fuentes conocidas y remotas en la Web.</span><span class="sxs-lookup"><span data-stu-id="22f01-219">Creating a custom font set using known, remote fonts on the Web.</span></span>
-   <span data-ttu-id="22f01-220">Crear un conjunto de fuentes personalizado utilizando los datos de fuente cargados en la memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-220">Creating a custom font set using font data loaded into memory.</span></span>

<span data-ttu-id="22f01-221">Las implementaciones completas de estos escenarios se proporcionan en el [ejemplo de conjuntos de fuentes personalizadas de DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="22f01-221">Complete implementations for these scenarios are provided in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> <span data-ttu-id="22f01-222">En ese ejemplo también se muestra un escenario más avanzado para controlar los datos de fuente empaquetados en los formatos de contenedor WOFF o WOFF2, que se tratarán a continuación.</span><span class="sxs-lookup"><span data-stu-id="22f01-222">That sample also illustrates one more advanced scenario for handling font data packed in WOFF or WOFF2 container formats, which will be discussed below.</span></span> 

### <a name="creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system"></a><span data-ttu-id="22f01-223">Crear un conjunto de fuentes usando fuentes arbitrarias en el sistema de archivos local</span><span class="sxs-lookup"><span data-stu-id="22f01-223">Creating a font set using arbitrary fonts in the local file system</span></span>

<span data-ttu-id="22f01-224">Cuando se trabaja con un conjunto arbitrario de archivos de fuentes en el almacenamiento local, el método [**IDWriteFontSetBuilder1:: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) es conveniente ya que, en una sola llamada, puede controlar todos los rostros de fuente de un archivo de colección de fuentes OpenType, así como todas las instancias de una fuente de variable OpenType.</span><span class="sxs-lookup"><span data-stu-id="22f01-224">When dealing with an arbitrary set of font files in local storage, the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method is convenient since, in a single call, it can handle all of the font faces within an OpenType Font Collection file, as well as all instances for an OpenType variable font.</span></span> <span data-ttu-id="22f01-225">Está disponible en Windows 10 Creators Update (versión preliminar 15021 o posterior) y se recomienda siempre que esté disponible.</span><span class="sxs-lookup"><span data-stu-id="22f01-225">This is available in the Windows 10 Creators Update (preview build 15021 or later), and is recommended whenever available.</span></span> 

<span data-ttu-id="22f01-226">Para usar este método, utilice el siguiente proceso.</span><span class="sxs-lookup"><span data-stu-id="22f01-226">To use this method, use the following process.</span></span>

<dl> <span data-ttu-id="22f01-227">1. Empiece por crear la interfaz <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> :</span><span class="sxs-lookup"><span data-stu-id="22f01-227">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> interface:</span></span> 


```C++
IDWriteFactory5* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
  DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



   
2. <span data-ttu-id="22f01-228">Use el generador para obtener la <a href=""></a> interfaz [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) :</span><span class="sxs-lookup"><span data-stu-id="22f01-228">Use the factory to obtain the <a href=""></a>[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface:</span></span> 


```C++
IDWriteFontSetBuilder1* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
}  
                
```



  
3. <span data-ttu-id="22f01-229">Para cada archivo de fuente del sistema de archivos local, cree un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) que haga referencia a él:</span><span class="sxs-lookup"><span data-stu-id="22f01-229">For each font file in the local file system, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) that refers to it:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



   
4. <span data-ttu-id="22f01-230">Agregue el objeto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) al generador de conjuntos de fuentes con el método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) :</span><span class="sxs-lookup"><span data-stu-id="22f01-230">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method:</span></span> 


```C++
hr = pFontSetBuilder->AddFontFile(pFontFile); 
```

<span data-ttu-id="22f01-231">Si la ruta de acceso al archivo especificada en la llamada a [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) hace referencia a otro archivo compatible con OpenType, la llamada a [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) devolverá un error, DWRITE \_ E \_ FILEFORMAT.</span><span class="sxs-lookup"><span data-stu-id="22f01-231">If the file path specified in the call to [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) referred to something other than a supported OpenType file, then the call to [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) will return an error, DWRITE\_E\_FILEFORMAT.</span></span>

5. <span data-ttu-id="22f01-232">Una vez que se han agregado todos los archivos al generador de conjuntos de fuentes, se puede crear el conjunto de fuentes personalizado:</span><span class="sxs-lookup"><span data-stu-id="22f01-232">After all of the files have been added to the font set builder, the custom font set can be created:</span></span> 


```C++
IDWriteFontSet* pFontSet; 
hr = pFontSetBuilder->CreateFontSet(&pFontSet); 
```



   
</dl>

<span data-ttu-id="22f01-233">Si la aplicación necesita ejecutarse en versiones de Windows 10 anteriores a Windows 10 Creators Update, el método AddFontFile no estará disponible.</span><span class="sxs-lookup"><span data-stu-id="22f01-233">If the app needs to run on Windows 10 versions earlier than the Windows 10 Creators Update, then the AddFontFile method will not be available.</span></span> <span data-ttu-id="22f01-234">La disponibilidad se puede detectar mediante la creación de una interfaz [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) y el uso de QueryInterface para intentar obtener una interfaz [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) : Si esto se realiza correctamente, la interfaz [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) y el método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) también estarán disponibles.</span><span class="sxs-lookup"><span data-stu-id="22f01-234">Availability can be detected by creating an [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) interface and then using QueryInterface to try to obtain an [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface: if this succeeds, then the [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface and [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method will also be available.</span></span>

<span data-ttu-id="22f01-235">Si el método AddFontFile no está disponible, se debe usar el método [**IDWriteFontSetBuilder:: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) para agregar caras de fuente individuales.</span><span class="sxs-lookup"><span data-stu-id="22f01-235">If the AddFontFile method is not available, then the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method must be used to add individual font faces.</span></span> <span data-ttu-id="22f01-236">Para permitir archivos de colección de fuentes OpenType que contengan varias caras, el método [**IDWriteFontFile:: Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) se puede usar para determinar el número de caras incluidas en el archivo.</span><span class="sxs-lookup"><span data-stu-id="22f01-236">To allow for OpenType Font Collection files that contain multiple faces, the [**IDWriteFontFile::Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method can be used to determine the number of faces contained within the file.</span></span> <span data-ttu-id="22f01-237">El proceso es el siguiente.</span><span class="sxs-lookup"><span data-stu-id="22f01-237">The process is as follows.</span></span>

<dl> <span data-ttu-id="22f01-238">1. Empiece por crear la interfaz <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> :</span><span class="sxs-lookup"><span data-stu-id="22f01-238">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> interface:</span></span> 


```C++
IDWriteFactory3* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



  
2. <span data-ttu-id="22f01-239">Use el generador para obtener la interfaz [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) :</span><span class="sxs-lookup"><span data-stu-id="22f01-239">Use the factory to obtain the [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface:</span></span> 


```C++
IDWriteFontSetBuilder* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
} 
```



  
3. <span data-ttu-id="22f01-240">Para cada archivo de fuente, cree un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="22f01-240">For each font file, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), as above:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



<span data-ttu-id="22f01-241">En lugar de agregar el archivo directamente al generador de conjuntos de fuentes, es necesario determinar el número de caras y crear objetos [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) individuales.</span><span class="sxs-lookup"><span data-stu-id="22f01-241">Instead of adding the file directly to the font set builder, we need to determine the number of faces and create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects.</span></span>   
4. <span data-ttu-id="22f01-242">Use el método [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) para obtener el número de caras del archivo.</span><span class="sxs-lookup"><span data-stu-id="22f01-242">Use the [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method to get the number of faces in the file.</span></span> 


```C++
BOOL isSupported; 
DWRITE_FONT_FILE_TYPE fileType; 
UINT32 numberOfFonts; 
hr = pFontFile->Analyze(&isSupported, &fileType, /* face type */ nullptr, &numberOfFonts); 
```



<span data-ttu-id="22f01-243">El método [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) también establecerá los valores para los parámetros IsSupported y filetype.</span><span class="sxs-lookup"><span data-stu-id="22f01-243">The [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method will also set values for the isSupported and fileType parameters.</span></span> <span data-ttu-id="22f01-244">Si el archivo no es un formato admitido, isSupported será FALSE y se puede tomar la acción adecuada, como omitir el archivo.</span><span class="sxs-lookup"><span data-stu-id="22f01-244">If the file is not a supported format, then isSupported will be FALSE, and appropriate action, such as ignoring the file, can be taken.</span></span>   
5. <span data-ttu-id="22f01-245">Recorra el número de fuentes establecidas en el parámetro numberOfFonts.</span><span class="sxs-lookup"><span data-stu-id="22f01-245">Loop over the number of fonts set in the numberOfFonts parameter.</span></span> <span data-ttu-id="22f01-246">Dentro del bucle, cree un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) para cada par de archivo/índice y agréguelo al generador de conjuntos de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-246">Within the loop, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) for each file/index pair, and add that to the font set builder.</span></span> 


```C++
for (uint32_t fontIndex = 0; fontIndex < numberOfFonts; fontIndex++) 
{ 
  IDWriteFontFaceReference* pFontFaceReference;
  hr = pDWriteFactory->CreateFontFaceReference(pFontFile, fontIndex, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);

  if (SUCCEEDED(hr))
  {
    hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference);
  }
} 
```



  
6. <span data-ttu-id="22f01-247">Una vez que se hayan agregado todas las caras al generador de conjuntos de fuentes, cree el conjunto de fuentes personalizado, como se muestra anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-247">After all the faces have been added to the font set builder, create the custom font set, as shown above.</span></span>  
</dl>

<span data-ttu-id="22f01-248">Una aplicación se puede diseñar para que use el método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) preferido cuando se ejecuta en Windows 10 Creators Update, pero revertir para usar el método [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) cuando se ejecuta en versiones anteriores de Windows 10.</span><span class="sxs-lookup"><span data-stu-id="22f01-248">An app can be designed so that it will use the preferred [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method when running on the Windows 10 Creators Update, but fall back to use the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method when running on earlier Windows 10 versions.</span></span> <span data-ttu-id="22f01-249">Compruebe la disponibilidad de la interfaz [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) , como se describió anteriormente y, a continuación, haga una bifurcación en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="22f01-249">Test for availability of the [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface, as described above, and then branch accordingly.</span></span> <span data-ttu-id="22f01-250">Este enfoque se ilustra en el [ejemplo de conjuntos de fuentes personalizadas de DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="22f01-250">This approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="creating-a-font-set-using-known-fonts-in-the-local-file-system"></a><span data-ttu-id="22f01-251">Crear un conjunto de fuentes usando fuentes conocidas en el sistema de archivos local</span><span class="sxs-lookup"><span data-stu-id="22f01-251">Creating a font set using known fonts in the local file system</span></span>

<span data-ttu-id="22f01-252">Tal y como se mencionó anteriormente, cada referencia de fuente de un conjunto de fuentes está asociada con determinadas propiedades informativas, como el nombre de familia y el espesor de fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-252">As mentioned above, each font face reference in a font set is associated with certain informational properties, such as family name and font weight.</span></span> <span data-ttu-id="22f01-253">Cuando se agregan fuentes personalizadas a un generador de conjuntos de fuentes mediante las llamadas a la API mencionadas anteriormente, estas propiedades informativas se obtienen directamente de los datos reales de la fuente, que se leen cuando se agrega la fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-253">When custom fonts are added to a font set builder using the API calls listed above, these informational properties are obtained directly from the actual font data, which is read as the font is added.</span></span> <span data-ttu-id="22f01-254">En algunas situaciones, sin embargo, si una aplicación tiene otro origen de información sobre una fuente, es posible que desee proporcionar sus propios valores personalizados para estas propiedades.</span><span class="sxs-lookup"><span data-stu-id="22f01-254">In some situations, however, if an app has another source of information about a font, it might wish to provide its own custom values for these properties.</span></span> 

<span data-ttu-id="22f01-255">Como ejemplo de cómo podría ser útil, supongamos que una aplicación agrupa algunas fuentes que se usan para presentar determinados elementos de la interfaz de usuario dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-255">As an example of how this might be useful, suppose an app bundles some fonts that are used for presenting particular user-interface elements within the app.</span></span> <span data-ttu-id="22f01-256">En ocasiones, como en el caso de una nueva versión de la aplicación, puede que sea necesario cambiar las fuentes específicas que usa la aplicación para estos elementos.</span><span class="sxs-lookup"><span data-stu-id="22f01-256">At times, such as with a new app version, the specific fonts that the app uses for these elements may need to change.</span></span> <span data-ttu-id="22f01-257">Si la aplicación tiene referencias codificadas a fuentes específicas, el reemplazo de una fuente con otra tendrá que cambiar cada una de esas referencias.</span><span class="sxs-lookup"><span data-stu-id="22f01-257">If the app has encoded references to the specific fonts, then replacement of one font with another will require changing every one of those references.</span></span> <span data-ttu-id="22f01-258">En su lugar, si la aplicación usa propiedades personalizadas para asignar alias funcionales en función del tipo de elemento o texto que se va a representar, asigna cada alias a una fuente específica en un lugar y, a continuación, usa los alias en todos los contextos donde se crean y manipulan las fuentes, y después reemplaza una fuente por otra, solo es necesario cambiar el único lugar en el que se</span><span class="sxs-lookup"><span data-stu-id="22f01-258">Instead, if the app uses custom properties to assign functional aliases based on the type of element or text being rendered, maps each alias to a specific font in one place and then uses the aliases in all the contexts where fonts are created and manipulated, then replacing one font with another requires only changing the one place where the alias is mapped to a specific font.</span></span> 

<span data-ttu-id="22f01-259">Se pueden asignar valores personalizados para propiedades informativas cuando se llama al método [**IDWriteFontSetBuilder:: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) .</span><span class="sxs-lookup"><span data-stu-id="22f01-259">Custom values for informational properties can be assigned when the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method is called.</span></span> <span data-ttu-id="22f01-260">El método para hacerlo es el siguiente: se puede usar en cualquier versión de Windows 10.</span><span class="sxs-lookup"><span data-stu-id="22f01-260">The method for doing this is as follows; this can be used on any Windows 10 version.</span></span> 

<span data-ttu-id="22f01-261">Como se mostró anteriormente, empiece por obtener las interfaces [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) y [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) .</span><span class="sxs-lookup"><span data-stu-id="22f01-261">As shown above, start by obtaining the [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) and [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interfaces.</span></span> <span data-ttu-id="22f01-262">Para cada fuente personalizada que se va a agregar, cree un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-262">For each custom font face to be added, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), as shown above.</span></span> <span data-ttu-id="22f01-263">Antes de que se agregue al generador de conjuntos de fuentes (dentro del bucle en el paso 5, mostrado anteriormente), la aplicación define los valores de propiedad personalizados que se usarán.</span><span class="sxs-lookup"><span data-stu-id="22f01-263">Before this is added to the font set builder (within the loop in step 5, shown above), however, the app defines the custom property values to be used.</span></span> 

<span data-ttu-id="22f01-264">Un conjunto de valores de propiedad personalizados se define mediante una matriz de estructuras de [**\_ \_ propiedades de fuente DWRITE**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) .</span><span class="sxs-lookup"><span data-stu-id="22f01-264">A set of custom property values is defined using an array of [**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structures.</span></span> <span data-ttu-id="22f01-265">Cada uno de ellos identifica una propiedad determinada de la enumeración de identificador de la [**\_ propiedad de fuente \_ \_ DWRITE**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) y el valor de propiedad correspondiente que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="22f01-265">Each of these identifies a particular property from the [**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enum, and the corresponding property value that is to be used.</span></span>  

<span data-ttu-id="22f01-266">Tenga en cuenta que todos los valores de propiedad se asignan como cadenas.</span><span class="sxs-lookup"><span data-stu-id="22f01-266">Note that all property values are assigned as strings.</span></span> <span data-ttu-id="22f01-267">Si posteriormente se pueden mostrar a los usuarios, se pueden establecer valores alternativos para una propiedad determinada para distintos idiomas, pero esto no es necesario.</span><span class="sxs-lookup"><span data-stu-id="22f01-267">If these may later be displayed to users, then alternate values for a given property for different languages may be set, but this is not required.</span></span> <span data-ttu-id="22f01-268">Tenga en cuenta también que si la aplicación establece cualquier valor de propiedad personalizada, solo se usarán en el conjunto de fuentes los valores especificados. DirectWrite no derivará ningún valor directamente de la fuente para las propiedades informativas usadas en un conjunto de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-268">Also note that if any custom property values are set by the app, then only those values that are specified will be used within the Font set; DirectWrite will not derive any values directly from the font for informational properties used in a font set.</span></span> 

<span data-ttu-id="22f01-269">En el ejemplo siguiente se definen los valores personalizados para tres propiedades informativas: nombre de familia, nombre completo y espesor de fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-269">The following example defines custom values for three informational properties: family name, full name, and font weight.</span></span> 


```C++
DWRITE_FONT_PROPERTY props[] = 
{ 
  { DWRITE_FONT_PROPERTY_ID_FAMILY_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_FULL_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_WEIGHT, L"400", nullptr } 
}; 
               
            
```



<span data-ttu-id="22f01-270">Después de definir la matriz deseada de valores de propiedad para una fuente, realice una llamada a AddFontFaceRefence, pasando la matriz de propiedades, así como la referencia de la fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-270">After defining the desired array of property values for a font, make a call to AddFontFaceRefence, passing the property array as well as the font face reference.</span></span> 


```C++
hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference, props, ARRAYSIZE(props)); 
```



 

<span data-ttu-id="22f01-271">Una vez que se han agregado todos los rostros de fuente personalizados al generador de conjuntos de fuentes, junto con sus propiedades personalizadas, cree el conjunto de fuentes personalizado, como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-271">Once all custom font faces have been added to the font set builder, along with their custom properties, create the custom font set, as shown above.</span></span> 

### <a name="creating-a-custom-font-set-using-known-remote-fonts-on-the-web"></a><span data-ttu-id="22f01-272">Crear un conjunto de fuentes personalizado mediante fuentes conocidas y remotas en la web</span><span class="sxs-lookup"><span data-stu-id="22f01-272">Creating a custom font set using known, remote fonts on the Web</span></span>

<span data-ttu-id="22f01-273">Las propiedades personalizadas son importantes para trabajar con fuentes remotas.</span><span class="sxs-lookup"><span data-stu-id="22f01-273">Custom properties are important for working with remote fonts.</span></span> <span data-ttu-id="22f01-274">Cada referencia de fuente debe tener algunas propiedades informativas para caracterizar la fuente y diferenciarla de otras fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-274">Each font face reference must have some informational properties to characterize the font and distinguish it from other fonts.</span></span> <span data-ttu-id="22f01-275">Dado que los datos de fuente para fuentes remotas no son locales, DirectWrite no puede derivar propiedades directamente de los datos de fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-275">Since the font data for remote fonts is not local, DirectWrite cannot derive properties directly from the font data.</span></span> <span data-ttu-id="22f01-276">Por lo tanto, las propiedades se deben proporcionar explícitamente al agregar una fuente remota al generador de conjuntos de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-276">Hence, properties must be provided explicitly when adding a remote font to the font set builder.</span></span>

<span data-ttu-id="22f01-277">La secuencia de llamadas API para agregar fuentes remotas a un conjunto de fuentes es similar a la secuencia descrita para el escenario anterior.</span><span class="sxs-lookup"><span data-stu-id="22f01-277">The sequence of API calls for adding remote fonts to a font set is similar to the sequence described for the previous scenario.</span></span> <span data-ttu-id="22f01-278">Dado que los datos de fuente son remotos, sin embargo, las operaciones que se realizan para leer los datos de la fuente real serán diferentes a cuando se trabaja con archivos en el almacenamiento local.</span><span class="sxs-lookup"><span data-stu-id="22f01-278">Since the font data is remote, however, the operations involved for reading the actual font data will be different than when working with files in local storage.</span></span> <span data-ttu-id="22f01-279">En esta situación, se ha agregado una nueva interfaz de nivel inferior, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), a Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="22f01-279">For this situation, a new lower-level interface, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), has been added in the Windows 10 Creators Update.</span></span> 

<span data-ttu-id="22f01-280">Para usar el cargador de archivos de fuentes remotos, primero se debe registrar con un generador de DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="22f01-280">To use the remote font file loader, it must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="22f01-281">El cargador deberá ser mantenido por la aplicación mientras se utilicen las fuentes asociadas a él.</span><span class="sxs-lookup"><span data-stu-id="22f01-281">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="22f01-282">Una vez que las fuentes ya no estén en uso y, en algún momento antes de que se destruya el generador, se debe anular el registro del cargador.</span><span class="sxs-lookup"><span data-stu-id="22f01-282">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="22f01-283">Esto puede hacerse en el destructor de la clase que posee el objeto Loader.</span><span class="sxs-lookup"><span data-stu-id="22f01-283">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="22f01-284">Estos pasos se mostrarán a continuación.</span><span class="sxs-lookup"><span data-stu-id="22f01-284">These steps will be shown below.</span></span> 

<span data-ttu-id="22f01-285">El método para crear un conjunto de fuentes personalizado mediante fuentes remotas es el siguiente: Esto requiere Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="22f01-285">The method for creating a custom font set using remote fonts is as follows; this requires the Windows 10 Creators Update.</span></span>  

<dl> <span data-ttu-id="22f01-286">1. Cree una interfaz IDWriteFactory5, como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-286">1. Create an IDWriteFactory5 interface, as shown above.</span></span>   
<span data-ttu-id="22f01-287">2. Cree una interfaz <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> , como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-287">2. Create an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> interface, as shown above.</span></span>   
<span data-ttu-id="22f01-288">3. Use el generador para obtener un <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span><span class="sxs-lookup"><span data-stu-id="22f01-288">3. Use the factory to obtain an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span></span> 


```C++
IDWriteRemoteFontFileLoader* pRemoteFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateHttpFontFileLoader( 
        /* referrerURL */ nullptr, 
        /* extraHeaders */ nullptr, 
        &pRemoteFontFileLoader 
    ); 
} 
```



<span data-ttu-id="22f01-289">Esto devuelve una implementación proporcionada por el sistema de la interfaz del cargador de archivos de fuentes remotos que puede controlar las interacciones HTTP para descargar datos de fuentes en nombre de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-289">This returns a system-provided implementation of the remote font file loader interface that is able to handle HTTP interactions for downloading font data on behalf of the app.</span></span> <span data-ttu-id="22f01-290">Se puede especificar una dirección URL de referencia o encabezados adicionales si es necesario para el servicio de fuente o los servicios que son el origen de las fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-290">A referrer URL or extra headers can be specified if required by the font service or services that are the source for the fonts.</span></span>    

> [!IMPORTANT]
> <span data-ttu-id="22f01-291">Nota de seguridad: cuando se realiza un intento de capturar una fuente remota, existe la posibilidad de que un atacante suplante el servidor previsto al que se llamará.</span><span class="sxs-lookup"><span data-stu-id="22f01-291">Security note: When an attempt is made to fetch a remote font, the potential exists for an attacker to spoof the intended server that will be called.</span></span> <span data-ttu-id="22f01-292">En ese caso, las direcciones URL de destino y de referencia y los detalles del encabezado se divulgarán al atacante.</span><span class="sxs-lookup"><span data-stu-id="22f01-292">In that case, the target and referrer URLs and header details would be disclosed to the attacker.</span></span> <span data-ttu-id="22f01-293">Los desarrolladores de aplicaciones son responsables de mitigar este riesgo.</span><span class="sxs-lookup"><span data-stu-id="22f01-293">App developers are responsible for mitigating this risk.</span></span> <span data-ttu-id="22f01-294">Se recomienda el uso del protocolo HTTPS en lugar de HTTP.</span><span class="sxs-lookup"><span data-stu-id="22f01-294">Use of the HTTPS protocol, rather than HTTP, is recommended.</span></span> 

 

<span data-ttu-id="22f01-295">Se puede usar un cargador de archivos de fuente remoto único para varias fuentes, aunque se pueden usar diferentes cargadores Si se obtienen fuentes de varios servicios que tienen requisitos diferentes para la URL de referencia o encabezados adicionales.</span><span class="sxs-lookup"><span data-stu-id="22f01-295">A single remote font file loader can be used for multiple fonts, though different loaders can be used if fonts are obtained from multiple services that have different requirements for referrer URL or extra headers.</span></span>   
4. <span data-ttu-id="22f01-296">Registre el cargador de archivos de fuentes remotos con el generador.</span><span class="sxs-lookup"><span data-stu-id="22f01-296">Register the remote font file loader with the factory.</span></span> 


```C++
 if (SUCCEEDED(hr)) 
 { 
     hr = pDWriteFactory->RegisterFontFileLoader(pRemoteFontFileLoader); 
 } 
```



<span data-ttu-id="22f01-297">Desde este punto, los pasos para crear el conjunto de fuentes personalizado son similares a los descritos para los archivos de fuentes locales conocidos, con dos excepciones importantes.</span><span class="sxs-lookup"><span data-stu-id="22f01-297">From this point, the steps for creating the custom font set are similar to those described for known, local font files, with two important exceptions.</span></span> <span data-ttu-id="22f01-298">En primer lugar, el objeto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) se crea con la interfaz del cargador de archivos de fuentes remoto en lugar de usar el generador.</span><span class="sxs-lookup"><span data-stu-id="22f01-298">First, the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is created using the remote font file loader interface rather than using the factory.</span></span> <span data-ttu-id="22f01-299">En segundo lugar, no se puede usar el método Analyze, ya que los datos de fuente no son locales.</span><span class="sxs-lookup"><span data-stu-id="22f01-299">Second, the Analyze method cannot be used since the font data is not local.</span></span> <span data-ttu-id="22f01-300">En su lugar, la aplicación debe saber si el archivo de fuente remoto es un archivo de colección de fuentes OpenType y, en ese caso, debe saber cuál de las fuentes de la colección usará y el índice de cada uno.</span><span class="sxs-lookup"><span data-stu-id="22f01-300">Instead, the app must know whether the remote font file is an OpenType Font Collection file, and if so, then it must know which of the fonts within the collection it will use, and the index for each.</span></span> <span data-ttu-id="22f01-301">Por lo tanto, los pasos restantes son los siguientes.</span><span class="sxs-lookup"><span data-stu-id="22f01-301">Hence, the remaining steps are as follows.</span></span>   
5. <span data-ttu-id="22f01-302">Para cada archivo de fuente remota, utilice la interfaz del cargador de archivos de fuentes remotos para crear un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), especificando la dirección URL necesaria para obtener acceso al archivo de fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-302">For each remote font file, use the remote font file loader interface to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), specifying the URL required to access the font file.</span></span> 


```C++
 IDWriteFontFile* pFontFile; 
 hr = pRemoteFontFileLoader->CreateFontFileReferenceFromUrl( 
     pDWriteFactory, 
     /* baseUrl */ L"https://github.com/", 
     /* fontFileUrl */ L"winjs/winjs/blob/master/src/fonts/Symbols.ttf?raw=true", 
     &pFontFile 
 ); 
```



<span data-ttu-id="22f01-303">Tenga en cuenta que se puede especificar la dirección URL completa en el parámetro fontFileUrl, o bien se puede dividir en partes base y relativas.</span><span class="sxs-lookup"><span data-stu-id="22f01-303">Note that the complete URL can be specified in the fontFileUrl parameter, or it can be split into base and relative portions.</span></span> <span data-ttu-id="22f01-304">Si se especifica una dirección URL base, la concatenación de los valores baseUrl y fontFileUrl debe proporcionar la dirección URL completa; DirectWrite no proporcionará ningún delimitador adicional.</span><span class="sxs-lookup"><span data-stu-id="22f01-304">If a base URL is specified, then the concatenation of the baseUrl and fontFileUrl values must provide the complete URL — DirectWrite will not supply any additional delimiter.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="22f01-305">Seguridad y rendimiento NOTA: cuando se realiza un intento de capturar una fuente remota, no hay ninguna garantía de que Windows reciba una respuesta del servidor.</span><span class="sxs-lookup"><span data-stu-id="22f01-305">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="22f01-306">En algunos casos, un servidor puede responder con un error de archivo no encontrado para una dirección URL relativa no válida, pero dejar de responder si recibe varias solicitudes no válidas.</span><span class="sxs-lookup"><span data-stu-id="22f01-306">In some cases, a server may respond with a file-not-found error for an invalid relative URL, but stop responding if it receives multiple invalid requests.</span></span> <span data-ttu-id="22f01-307">Si el servidor no responde, se agotará el tiempo de espera de Windows, aunque esto puede tardar varios minutos si se inician varias capturas.</span><span class="sxs-lookup"><span data-stu-id="22f01-307">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple fetches are initiated.</span></span> <span data-ttu-id="22f01-308">Debe hacer lo que pueda para asegurarse de que las direcciones URL serán válidas cuando se realicen las llamadas.</span><span class="sxs-lookup"><span data-stu-id="22f01-308">You should do what you can to ensure that URLs will be valid when calls are made.</span></span> 

 

<span data-ttu-id="22f01-309">Además, tenga en cuenta que la dirección URL puede apuntar a un archivo de fuente OpenType sin formato (. ttf,. OTF,. TTC,. OTC), pero también puede apuntar a fuentes de un archivo contenedor WOFF o WOFF2.</span><span class="sxs-lookup"><span data-stu-id="22f01-309">Also note that the URL can point to a raw OpenType font file (.ttf, .otf, .ttc, .otc), but it can also point to fonts in a WOFF or WOFF2 container file.</span></span> <span data-ttu-id="22f01-310">Si se hace referencia a un archivo WOFF o WOFF2, la implementación de DirectWrite del cargador de archivos de fuente remoto desempaquetará automáticamente los datos de fuente del archivo contenedor.</span><span class="sxs-lookup"><span data-stu-id="22f01-310">If a WOFF or WOFF2 file is referenced, then the DirectWrite implementation of the remote font file loader will automatically unpack the font data from the container file.</span></span>   
6. <span data-ttu-id="22f01-311">Cree un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference)para cada índice de fuente del archivo de fuentes remoto que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="22f01-311">For each font face index within the remote font file that is to be used, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span></span> 


```C++
 IDWriteFontFaceReference* pFontFaceReference; 
 hr = pDWriteFactory->CreateFontFaceReference(pFontFile, /* faceIndex */ 0, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);
```



  
7. <span data-ttu-id="22f01-312">Defina las propiedades personalizadas para el tipo de fuente, como se muestra anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-312">Define custom properties for the font face, as shown above.</span></span>   
8. <span data-ttu-id="22f01-313">Agregue la referencia de fuente junto con propiedades personalizadas al generador de conjuntos de fuentes, como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-313">Add the font face reference along with custom properties to the font set builder, as shown above.</span></span>   
9. <span data-ttu-id="22f01-314">Una vez que se hayan agregado todas las fuentes al generador de conjuntos de fuentes, cree el conjunto de fuentes, como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-314">After all fonts have been added to the font set builder, create the font set, as shown above.</span></span>   
10. <span data-ttu-id="22f01-315">En algún momento en el que ya no se usarán las fuentes remotas, anule el registro del cargador de archivos de fuentes remotos.</span><span class="sxs-lookup"><span data-stu-id="22f01-315">At some point when the remote fonts will no longer be used, unregister the remote font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pRemoteFontFileLoader); 
```



  
</dl>

<span data-ttu-id="22f01-316">Una vez que se crea un conjunto de fuentes personalizadas con fuentes remotas personalizadas, el conjunto de fuentes contiene referencias y propiedades informativas para las fuentes remotas, pero los datos reales siguen siendo remotos.</span><span class="sxs-lookup"><span data-stu-id="22f01-316">Once a custom font set with custom remote fonts is created, the font set contains references and informational properties for the remote fonts, but the actual data is still remote.</span></span> <span data-ttu-id="22f01-317">La compatibilidad con DirectWrite para fuentes remotas permite mantener una referencia de fuente de fuentes en el conjunto de fuentes y seleccionar una fuente para su uso en el diseño y la representación, pero no se descargan los datos reales hasta que haya una necesidad real de utilizarlos, como cuando se realiza el diseño de texto.</span><span class="sxs-lookup"><span data-stu-id="22f01-317">DirectWrite support for remote fonts allows a font face reference to be maintained in the font set, and for a font to be selected for use in layout and rendering, but that the actual data is not downloaded until there is an actual need to use it, such as when text layout will be performed.</span></span>  

<span data-ttu-id="22f01-318">Una aplicación puede adoptar un enfoque inicial solicitando que DirectWrite Descargue los datos de la fuente y, a continuación, esperando la confirmación de una descarga correcta antes de que se inicie cualquier procesamiento con la fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-318">An app can take an up-front approach by requesting that DirectWrite download the font data and then waiting for confirmation of a successful download before any processing with the font is begun.</span></span> <span data-ttu-id="22f01-319">Pero una descarga de red implica cierta latencia de duración imprevisible y el éxito también es incierto.</span><span class="sxs-lookup"><span data-stu-id="22f01-319">But a network download implies some latency of unpredictable duration, and success is also uncertain.</span></span> <span data-ttu-id="22f01-320">Por esta razón, normalmente será mejor adoptar un enfoque diferente, lo que permite que el diseño y la representación se realicen inicialmente con fuentes alternativas o de reserva que ya son locales, al tiempo que se solicita la descarga de la fuente remota deseada en paralelo y, a continuación, se actualizan los resultados una vez que se ha descargado la fuente deseada.</span><span class="sxs-lookup"><span data-stu-id="22f01-320">For this reason, it will usually be better to take a different approach, allowing layout and rendering to be done initially using alternate or fallback fonts that are already local, while requesting download of the desired, remote font in parallel, and then updating the results once the desired font has been downloaded.</span></span> 

<span data-ttu-id="22f01-321">Para solicitar que se descargue toda la fuente antes de su uso, se puede usar el método [**IDWriteFontFaceReference:: EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) .</span><span class="sxs-lookup"><span data-stu-id="22f01-321">To request that the entire font be downloaded before it gets used, the [**IDWriteFontFaceReference::EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) method can be used.</span></span> <span data-ttu-id="22f01-322">Si la fuente es muy grande, solo puede ser necesaria una parte de los datos para procesar cadenas determinadas.</span><span class="sxs-lookup"><span data-stu-id="22f01-322">If the font is very large, only a portion of the data may be needed for processing particular strings.</span></span> <span data-ttu-id="22f01-323">DirectWrite proporciona métodos adicionales que se pueden usar para solicitar partes de los datos de fuentes necesarios para el contenido determinado, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) y [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span><span class="sxs-lookup"><span data-stu-id="22f01-323">DirectWrite provides additional methods that can be used to request portions of the font data needed for particular content, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) and [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span></span>  

<span data-ttu-id="22f01-324">Supongamos que el enfoque que se va a realizar en la aplicación es permitir que el procesamiento se realice inicialmente usando fuentes locales, alternativas o de reserva.</span><span class="sxs-lookup"><span data-stu-id="22f01-324">Suppose the approach to be taken in the app is to allow processing to be done initially using local, alternate or fallback fonts.</span></span> <span data-ttu-id="22f01-325">El método IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) se puede usar para identificar fuentes de reserva locales y también pone en cola automáticamente una solicitud para descargar la fuente preferida.</span><span class="sxs-lookup"><span data-stu-id="22f01-325">The IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) method can be used to identify local fallback fonts, and it will also automatically enqueue a request to download the preferred font.</span></span> <span data-ttu-id="22f01-326">Además, si se usa [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) y parte o todo el texto del diseño está formateado mediante una referencia de fuente remota, DirectWrite usará automáticamente el método **MapCharacters** para obtener las fuentes de reserva locales y poner en cola una solicitud para descargar los datos de fuentes remotas.</span><span class="sxs-lookup"><span data-stu-id="22f01-326">Also, if [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) is used and some or all of the text in the layout is formatted using a remote font reference, then DirectWrite will automatically use the **MapCharacters** method to get local fallback fonts and to enqueue a request to download the remote font data.</span></span> 

<span data-ttu-id="22f01-327">DirectWrite mantiene una cola de descarga de fuentes para cada generador y las solicitudes realizadas con los métodos mencionados anteriormente se agregan a esa cola.</span><span class="sxs-lookup"><span data-stu-id="22f01-327">DirectWrite maintains a font download queue for each factory, and the requests made using the methods mentioned above get added to that queue.</span></span> <span data-ttu-id="22f01-328">La cola de descarga de fuentes se puede obtener mediante el método [**IDWriteFactory3:: GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) .</span><span class="sxs-lookup"><span data-stu-id="22f01-328">The font download queue can be obtained using the [**IDWriteFactory3::GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) method.</span></span> 

<span data-ttu-id="22f01-329">Si se realiza una solicitud de descarga pero los datos de la fuente ya son locales, se producirá una operación no operativa: no se agregará nada a la cola de descarga.</span><span class="sxs-lookup"><span data-stu-id="22f01-329">If a download request is made but the font data is already local, this will result in a no-op: Nothing will be added to the download queue.</span></span> <span data-ttu-id="22f01-330">Una aplicación puede comprobar si la cola está vacía o si hay solicitudes de descarga pendientes llamando al método [**IDWriteFontDownloadQueue:: IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) .</span><span class="sxs-lookup"><span data-stu-id="22f01-330">An app can check whether the queue is empty or there are pending download requests by calling the [**IDWriteFontDownloadQueue::IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) method.</span></span> 

<span data-ttu-id="22f01-331">Una vez agregadas las solicitudes de fuentes remotas a la cola, se debe iniciar el proceso de descarga.</span><span class="sxs-lookup"><span data-stu-id="22f01-331">After remote font requests have been added to the queue, the download process must be initiated.</span></span> <span data-ttu-id="22f01-332">Cuando se usan fuentes remotas en [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), la descarga se inicia automáticamente cuando la aplicación llama a los métodos **IDWriteTextLayout** que fuerzan las operaciones de diseño o representación, como los métodos GetLineMetrics o Draw.</span><span class="sxs-lookup"><span data-stu-id="22f01-332">When remote fonts are used in [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), the download will be initiated automatically when the app calls **IDWriteTextLayout** methods that force layout or rendering operations, such as the GetLineMetrics or Draw methods.</span></span> <span data-ttu-id="22f01-333">En otros escenarios, la aplicación debe iniciar la descarga directamente llamando a [**IDWriteFontDownloadQueue:: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span><span class="sxs-lookup"><span data-stu-id="22f01-333">In other scenarios, the app must initiate the download directly by calling [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span></span>  

<span data-ttu-id="22f01-334">Una vez completada la descarga, la aplicación puede tomar las medidas adecuadas: continuar con las operaciones pendientes o repetir las operaciones que se realizaron inicialmente con fuentes de reserva.</span><span class="sxs-lookup"><span data-stu-id="22f01-334">When a download is completed, it will be up to the app to take appropriate actions — proceeding with pending operations, or repeating operations that were done initially with fallback fonts.</span></span> <span data-ttu-id="22f01-335">(Si se usa el diseño de texto de DirectWrite, se puede usar [**IDWriteTextLayout3:: InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) para borrar los resultados temporales calculados mediante fuentes de reserva). Para que la aplicación reciba una notificación cuando se complete el proceso de descarga y tome las medidas oportunas, la aplicación debe proporcionar una implementación de la interfaz [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) y pasarla a la llamada a BeginDownload.</span><span class="sxs-lookup"><span data-stu-id="22f01-335">(If DirectWrite’s text layout is being used, then [**IDWriteTextLayout3::InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) can be used to clear the temporary results computed using fallback fonts.) In order for the app to be notified when the download process has completed and to take appropriate actions, the app must provide an implementation of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, and pass this into the BeginDownload call.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="22f01-336">Seguridad y rendimiento NOTA: cuando se realiza un intento de capturar una fuente remota, no hay ninguna garantía de que Windows reciba una respuesta del servidor.</span><span class="sxs-lookup"><span data-stu-id="22f01-336">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="22f01-337">Si el servidor no responde, se agotará el tiempo de espera de Windows, aunque esto puede tardar varios minutos si se capturan varias fuentes remotas pero se produce un error.</span><span class="sxs-lookup"><span data-stu-id="22f01-337">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple remote fonts are being fetched but failing.</span></span> <span data-ttu-id="22f01-338">La llamada a BeginDownload se devolverá inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="22f01-338">The BeginDownload call will return immediately.</span></span> <span data-ttu-id="22f01-339">Las aplicaciones no deben bloquear la interfaz de usuario mientras esperan a que se llame a [**IDWriteFontDownloadListener::D ownloadcompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) .</span><span class="sxs-lookup"><span data-stu-id="22f01-339">Apps should not block UI while waiting for [**IDWriteFontDownloadListener::DownloadCompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) to be called.</span></span> 

 

<span data-ttu-id="22f01-340">Las implementaciones de ejemplo de estas interacciones con la cola de descarga de fuentes de DirectWrite y la interfaz [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) se pueden visualizar en el [ejemplo de conjuntos de fuentes personalizadas](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/)de directwrite y también en el ejemplo de [fuentes descargables de directwrite](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span><span class="sxs-lookup"><span data-stu-id="22f01-340">Sample implementations of these interactions with DirectWrite’s font download queue and of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface can be seen in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/), and also in the [DirectWrite Downloadable Fonts sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span></span> 

### <a name="creating-a-custom-font-set-using-font-data-loaded-into-memory"></a><span data-ttu-id="22f01-341">Crear un conjunto de fuentes personalizado con datos de fuente cargados en la memoria</span><span class="sxs-lookup"><span data-stu-id="22f01-341">Creating a custom font set using font data loaded into memory</span></span>

<span data-ttu-id="22f01-342">Del mismo modo que las operaciones de bajo nivel para leer los datos de un archivo de fuente son diferentes para los archivos de un disco local en lugar de los archivos remotos en la web, también se cumple lo mismo con los datos de fuente cargados en un búfer de memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-342">Just as the low-level operations for reading data from a font file are different for files on a local disk versus remote files on the Web, the same is also true for font data loaded into a memory buffer.</span></span> <span data-ttu-id="22f01-343">Se ha agregado una nueva interfaz de bajo nivel para controlar los datos de fuentes en memoria en Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span><span class="sxs-lookup"><span data-stu-id="22f01-343">A new low-level interface for handling in-memory font data has been added in the Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span></span> 

<span data-ttu-id="22f01-344">Al igual que con un cargador de archivos de fuentes remoto, primero se debe registrar un cargador de archivos de fuentes en memoria con un generador de DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="22f01-344">As with a remote font file loader, an in-memory font file loader must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="22f01-345">El cargador deberá ser mantenido por la aplicación mientras se utilicen las fuentes asociadas a él.</span><span class="sxs-lookup"><span data-stu-id="22f01-345">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="22f01-346">Una vez que las fuentes ya no estén en uso y, en algún momento antes de que se destruya el generador, se debe anular el registro del cargador.</span><span class="sxs-lookup"><span data-stu-id="22f01-346">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="22f01-347">Esto puede hacerse en el destructor de la clase que posee el objeto Loader.</span><span class="sxs-lookup"><span data-stu-id="22f01-347">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="22f01-348">Estos pasos se mostrarán a continuación.</span><span class="sxs-lookup"><span data-stu-id="22f01-348">These steps will be shown below.</span></span> 

<span data-ttu-id="22f01-349">Si la aplicación tiene información independiente sobre los rostros de fuente representados por los datos, puede Agregar referencias de rostro de fuente individuales a un generador de conjuntos de fuentes con propiedades personalizadas especificadas.</span><span class="sxs-lookup"><span data-stu-id="22f01-349">If the app has separate information about the font faces represented by the data, it can add individual font face references to a font set builder with custom properties specified.</span></span> <span data-ttu-id="22f01-350">Sin embargo, dado que los datos de fuente están en la memoria local, esto no es necesario; DirectWrite podrá leer los datos directamente para derivar los valores de propiedad.</span><span class="sxs-lookup"><span data-stu-id="22f01-350">Since the font data is in local memory, however, this is not required; DirectWrite will be able to read the data directly to derive the property values.</span></span> 

<span data-ttu-id="22f01-351">DirectWrite supone que los datos de la fuente están en formato OpenType sin formato, equivalente a un archivo OpenType (. ttf,. OTF,. TTC,. OTC), pero en memoria en lugar de en disco.</span><span class="sxs-lookup"><span data-stu-id="22f01-351">DirectWrite assumes the font data is in raw, OpenType format, equivalent to an OpenType file (.ttf, .otf, .ttc, .otc), but in memory rather than on disk.</span></span> <span data-ttu-id="22f01-352">Los datos no pueden estar en un formato de contenedor WOFF o WOFF2.</span><span class="sxs-lookup"><span data-stu-id="22f01-352">The data cannot be in a WOFF or WOFF2 container format.</span></span> <span data-ttu-id="22f01-353">Los datos pueden representar una colección de fuentes OpenType.</span><span class="sxs-lookup"><span data-stu-id="22f01-353">The data can represent an OpenType Font Collection.</span></span> <span data-ttu-id="22f01-354">Si no se utilizan propiedades personalizadas, el método [**IDWriteFontSetBuilder1:: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) se puede usar para agregar todos los rostros de fuente de los datos en una sola llamada.</span><span class="sxs-lookup"><span data-stu-id="22f01-354">If custom properties are not being used, then the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method can be used to add all font faces in the data in a single call.</span></span> 

<span data-ttu-id="22f01-355">Una consideración importante para el escenario en memoria es la duración de los datos.</span><span class="sxs-lookup"><span data-stu-id="22f01-355">An important consideration for the in-memory scenario is the lifetime of the data.</span></span> <span data-ttu-id="22f01-356">Si se proporciona un puntero al búfer en DirectWrite sin una indicación clara de que hay un propietario, DirectWrite realizará una copia de los datos en un nuevo búfer de memoria que será de su propiedad.</span><span class="sxs-lookup"><span data-stu-id="22f01-356">If a pointer to the buffer is provided to DirectWrite without a clear indication that there is an owner, then DirectWrite will make a copy of the data into a new memory buffer that it will own.</span></span> <span data-ttu-id="22f01-357">Para evitar la copia de datos y la asignación de memoria adicional, la aplicación puede pasar un objeto de propietario de datos que implementa IUnknown y que posee el búfer de memoria que contiene los datos de la fuente.</span><span class="sxs-lookup"><span data-stu-id="22f01-357">To avoid copying of data and additional memory allocation, the app can pass a data-owner object that implements IUnknown, and that owns the memory buffer containing the font data.</span></span> <span data-ttu-id="22f01-358">Mediante la implementación de esta interfaz, DirectWrite puede Agregar al recuento de referencias del objeto, lo que garantiza la duración de los datos de propiedad.</span><span class="sxs-lookup"><span data-stu-id="22f01-358">By implementing this interface, DirectWrite can add to the ref count of the object, thereby ensuring the lifetime of the owned data.</span></span> 

<span data-ttu-id="22f01-359">El método para crear un conjunto de fuentes personalizado mediante datos de fuentes en memoria es el siguiente: Esto requiere Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="22f01-359">The method for creating a custom font set using in-memory font data is as follows; this requires the Windows 10 Creators Update.</span></span> <span data-ttu-id="22f01-360">Esto supondrá un objeto de propietario de datos implementado por la aplicación, que implementa IUnknown y que también tiene métodos que devuelven un puntero al búfer de memoria y el tamaño del búfer.</span><span class="sxs-lookup"><span data-stu-id="22f01-360">This will assume an app-implemented data-owner object, that implements IUnknown and also has methods that return a pointer to the memory buffer and the size of the buffer.</span></span> 

<dl> <span data-ttu-id="22f01-361">1. Cree una interfaz IDWriteFactory5, como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-361">1. Create an IDWriteFactory5 interface, as shown above.</span></span>  
<span data-ttu-id="22f01-362">2. Cree una interfaz [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) , como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-362">2. Create an [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface, as shown above.</span></span>  
<span data-ttu-id="22f01-363">3. Use el generador para obtener un IDWriteInMemoryFontFileLoader.</span><span class="sxs-lookup"><span data-stu-id="22f01-363">3. Use the factory to obtain an IDWriteInMemoryFontFileLoader.</span></span> 


```C++
 IDWriteInMemoryFontFileLoader* pInMemoryFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateInMemoryFontFileLoader(&pInMemoryFontFileLoader); 
}
```



<span data-ttu-id="22f01-364">Esto devuelve una implementación proporcionada por el sistema de la interfaz del cargador de archivos de fuentes en memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-364">This returns a system-provided implementation of the in-memory font file loader interface.</span></span>   
4. <span data-ttu-id="22f01-365">Registre el cargador de archivos de fuentes en memoria con el generador.</span><span class="sxs-lookup"><span data-stu-id="22f01-365">Register the in-memory font file loader with the factory.</span></span> 


```C++
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->RegisterFontFileLoader(pInMemoryFontFileLoader); 
}
```



   
5. <span data-ttu-id="22f01-366">Para cada archivo de fuente en memoria, use el cargador de archivos de fuentes en memoria para crear un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span><span class="sxs-lookup"><span data-stu-id="22f01-366">For each in-memory font file, use the in-memory font file loader to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span></span> 


```C++
IDWriteFontFile* pFontFile; 
hr = pInMemoryFontFileLoader->CreateInMemoryFontFileReference( 
    pDWriteFactory, 
    pFontDataOwner->fontData /* returns void* */, 
    pFontDataOwner->fontDataSize /* returns UINT32 */, 
    pFontDataOwner /* ownerObject, owns the memory with font data and implements IUknown */, 
    &pFontFile 
); 
```



   
6. <span data-ttu-id="22f01-367">Agregue el objeto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) al generador de conjuntos de fuentes con el método [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) , como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-367">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method, as shown above.</span></span>  <span data-ttu-id="22f01-368">En cambio, si es necesario, la aplicación puede crear objetos [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) individuales basados en **IDWriteFontFile**, definir opcionalmente las propiedades personalizadas de cada referencia de fuente y, a continuación, agregar la referencia de la fuente con las propiedades personalizadas al conjunto de fuentes mediante el método [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) , como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-368">If there is a need, the app can instead create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects based on the **IDWriteFontFile**, optionally define custom properties for each font face reference, and then add the font face reference with custom properties to the font set using the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method, as shown above.</span></span>   
7. <span data-ttu-id="22f01-369">Una vez que se hayan agregado todas las fuentes al generador de conjuntos de fuentes, cree el conjunto de fuentes personalizado, como se muestra anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-369">After all fonts have been added to the font set builder, create the custom font set, as shown above.</span></span>   
8. <span data-ttu-id="22f01-370">En algún momento en el que ya no se usarán las fuentes en memoria, anule el registro del cargador de archivos de fuentes en memoria.</span><span class="sxs-lookup"><span data-stu-id="22f01-370">At some point when the in-memory fonts will no longer be used, unregister the in-memory font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pInMemoryFontFileLoader);
```



  
</dl>

 

## <a name="advanced-scenarios"></a><span data-ttu-id="22f01-371">Escenarios avanzados</span><span class="sxs-lookup"><span data-stu-id="22f01-371">Advanced scenarios</span></span>

<span data-ttu-id="22f01-372">Algunas aplicaciones pueden tener requisitos especiales que requieren un procesamiento más avanzado del descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-372">Some apps may have special requirements that require more advanced processing than is described above.</span></span> 

### <a name="combining-font-sets"></a><span data-ttu-id="22f01-373">Combinación de conjuntos de fuentes</span><span class="sxs-lookup"><span data-stu-id="22f01-373">Combining font sets</span></span>

<span data-ttu-id="22f01-374">Es posible que algunas aplicaciones necesiten crear un conjunto de fuentes que incluya una combinación de elementos de otros conjuntos de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-374">Some apps may need to create a font set that comprises some combination of items from other font sets.</span></span> <span data-ttu-id="22f01-375">Por ejemplo, es posible que una aplicación desee crear un conjunto de fuentes que combine todas las fuentes instaladas en el sistema con una selección de fuentes personalizadas, o que combine las fuentes instaladas que coincidan con ciertos criterios con otras fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-375">For example, an app may want to create a font set that combines all the fonts installed on the system with a selection of custom fonts, or that combines installed fonts matching certain criteria with other fonts.</span></span> <span data-ttu-id="22f01-376">DirectWrite tiene API para admitir la manipulación y la combinación de conjuntos de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-376">DirectWrite has APIs to support manipulation and combining of font sets.</span></span> 

<span data-ttu-id="22f01-377">Para combinar dos o más conjuntos de fuentes, el método [**IDWriteFontSetBuilder:: AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) agrega todas las fuentes del conjunto de fuentes dado que se van a agregar a un generador de conjuntos de fuentes en una sola llamada.</span><span class="sxs-lookup"><span data-stu-id="22f01-377">To combine two or more font sets, the [**IDWriteFontSetBuilder::AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) method adds all of the fonts in given font set to be added to a font set builder in a single call.</span></span> <span data-ttu-id="22f01-378">Si solo se desean ciertas fuentes de un conjunto de fuentes existente en el nuevo conjunto de fuentes, el método [**IDWriteFontSet:: GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) se puede usar para derivar un nuevo objeto de conjunto de fuentes que se ha filtrado para incluir solo las fuentes que coinciden con las propiedades especificadas.</span><span class="sxs-lookup"><span data-stu-id="22f01-378">If only certain fonts from an existing font set are wanted in the new font set, the [**IDWriteFontSet::GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) method can be used to derive a new font set object that has been filtered to include only fonts matching specified properties.</span></span> <span data-ttu-id="22f01-379">Estos métodos proporcionan una manera sencilla de crear un conjunto de fuentes personalizado combinando fuentes a partir de dos o más conjuntos de fuentes existentes</span><span class="sxs-lookup"><span data-stu-id="22f01-379">These methods provide an easy way to create a custom font set combining fonts from two or more existing font sets</span></span> 

### <a name="using-local-woff-or-woff2-font-data"></a><span data-ttu-id="22f01-380">Uso de datos de fuente WOFF o WOFF2 local</span><span class="sxs-lookup"><span data-stu-id="22f01-380">Using local WOFF or WOFF2 font data</span></span>

<span data-ttu-id="22f01-381">Si una aplicación tiene archivos de fuentes en el sistema de archivos local o en un búfer de memoria, pero usan los formatos de contenedor WOFF o WOFF2, DirectWrite (Windows 10 Creator Update o posterior) proporciona un método para desempaquetar el formato del contenedor, [**IDWriteFactory5:: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), que devuelve una [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span><span class="sxs-lookup"><span data-stu-id="22f01-381">If an app has font files in the local file system or in a memory buffer, but they use the WOFF or WOFF2 container formats, DirectWrite (Windows 10 Creator Update or later) provides a method for unpacking the container format, [**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), which returns an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span></span> 

<span data-ttu-id="22f01-382">Sin embargo, la aplicación necesitará una manera de obtener el [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) en un objeto de cargador de archivos de fuentes.</span><span class="sxs-lookup"><span data-stu-id="22f01-382">However, the app will need a way to get the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) into a font file loader object.</span></span> <span data-ttu-id="22f01-383">Una manera de hacerlo es crear una implementación de [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) personalizada que incluya la secuencia.</span><span class="sxs-lookup"><span data-stu-id="22f01-383">One way to do this is to create a custom [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) implementation that wraps the stream.</span></span> <span data-ttu-id="22f01-384">Al igual que con otros cargadores de archivos de fuentes, se debe registrar antes de usar y anular el registro antes de que el generador salga del ámbito.</span><span class="sxs-lookup"><span data-stu-id="22f01-384">As with other font file loaders, this must be registered before use, and unregistered before the factory goes out of scope.</span></span>  

<span data-ttu-id="22f01-385">Si el cargador personalizado también se va a usar con archivos de fuente sin procesar (no empaquetados), la aplicación también debe proporcionar una implementación personalizada de la interfaz [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) para administrar esos archivos.</span><span class="sxs-lookup"><span data-stu-id="22f01-385">If the custom loader will also be used with raw (not packed) font files, then the app would also need to provide a custom implementation of the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface for handling those files.</span></span> <span data-ttu-id="22f01-386">Sin embargo, hay maneras más fáciles de usar las API descritas anteriormente para administrar archivos de fuentes sin procesar.</span><span class="sxs-lookup"><span data-stu-id="22f01-386">There are easier ways that use APIs discussed above for handling raw font files, however.</span></span> <span data-ttu-id="22f01-387">La necesidad de una implementación de secuencia personalizada podría evitarse mediante rutas de acceso de código independientes para los archivos de fuente empaquetados frente a los archivos de fuentes sin formato.</span><span class="sxs-lookup"><span data-stu-id="22f01-387">The need for a custom stream implementation could be avoided by using separate code paths for packed font files versus raw font files.</span></span> 

<span data-ttu-id="22f01-388">Después de crear un objeto cargador de archivos de fuentes personalizado, los datos del archivo de fuentes empaquetados se agregan al cargador mediante medios específicos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="22f01-388">After a custom font file loader object is created, the packed font file data is added to the loader by app-specific means.</span></span> <span data-ttu-id="22f01-389">El cargador puede controlar varios archivos de fuente, cada uno de los cuales se identifica mediante una clave definida por la aplicación que es opaca para DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="22f01-389">The loader can handle multiple font files, each of which is identified using an app-defined key that is opaque to DirectWrite.</span></span> <span data-ttu-id="22f01-390">Una vez que se ha agregado un archivo de fuente empaquetado al cargador, se usa el método [**IDWriteFactory:: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) para obtener un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) basado en ese cargador para los datos de fuente identificados por una clave determinada.</span><span class="sxs-lookup"><span data-stu-id="22f01-390">After a packed font file has been added to the loader, the [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method is used to obtain an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) based on that loader for the font data identified by a given key.</span></span>  

<span data-ttu-id="22f01-391">El desempaquetado real de los datos de fuente se puede realizar a medida que se agregan fuentes al cargador, pero también se pueden controlar en el método [**IDWriteFontFileLoader:: CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) , al que DirectWrite llamará cuando necesite leer los datos de la fuente por primera vez.</span><span class="sxs-lookup"><span data-stu-id="22f01-391">The actual unpacking of the font data can be done as fonts are added to the loader, but can also be handled in the [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) method, which DirectWrite will call when it first needs to read the font data.</span></span> 

<span data-ttu-id="22f01-392">Después de crear un objeto IDWriteFontFile, los pasos restantes para agregar las fuentes a un conjunto de fuentes personalizado serán como se describió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="22f01-392">After an IDWriteFontFile object has been created, remaining steps for adding the fonts to a custom font set will be as described above.</span></span> 

<span data-ttu-id="22f01-393">Una implementación que usa este enfoque se ilustra en el [ejemplo de conjuntos de fuentes personalizadas de DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="22f01-393">An implementation using this approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation"></a><span data-ttu-id="22f01-394">Usar los mecanismos de fuentes remotas de DirectWrite con implementación de red de bajo nivel personalizada</span><span class="sxs-lookup"><span data-stu-id="22f01-394">Using DirectWrite remote font mechanisms with custom low-level network implementation</span></span>

<span data-ttu-id="22f01-395">Los mecanismos de DirectWrite para administrar fuentes remotas se pueden dividir en mecanismos de nivel superior, con conjuntos de fuentes que incluyen referencias de fuentes de fuentes para fuentes remotas, comprobando la localidad de los datos de fuentes y administrando la cola para las solicitudes de descarga de fuentes, y los mecanismos de nivel inferior que controlan la descarga real.</span><span class="sxs-lookup"><span data-stu-id="22f01-395">The DirectWrite mechanisms for handling remote fonts can be divided into higher-level mechanisms — having font sets that include font face references for remote fonts, checking locality of the font data, and managing the queue for font download requests — and the lower-level mechanisms that handle actual download.</span></span> <span data-ttu-id="22f01-396">Es posible que algunas aplicaciones deseen usar los mecanismos de fuentes remotas de nivel superior, pero también requieren interacciones de red personalizadas, como la comunicación con servidores que usan protocolos distintos de HTTP.</span><span class="sxs-lookup"><span data-stu-id="22f01-396">Some apps may want to utilize the higher-level remote font mechanisms, but also require custom network interactions, such as communicating with servers using protocols other than HTTP.</span></span> 

<span data-ttu-id="22f01-397">En esta situación, una aplicación tendrá que crear una implementación personalizada de la interfaz [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) que interactúe con otras interfaces de nivel inferior de las maneras necesarias.</span><span class="sxs-lookup"><span data-stu-id="22f01-397">For this situation, an app will need to create a custom implementation of the [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface that interacts with other lower-level interfaces in the required ways.</span></span> <span data-ttu-id="22f01-398">La aplicación también tendrá que proporcionar implementaciones personalizadas de estas interfaces de nivel inferior: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)y [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span><span class="sxs-lookup"><span data-stu-id="22f01-398">The app will also need to provide custom implementations of these lower-level interfaces: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream), and [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span></span> <span data-ttu-id="22f01-399">Estas tres interfaces tienen métodos de devolución de llamada a los que DirectWrite llamará durante las operaciones de descarga.</span><span class="sxs-lookup"><span data-stu-id="22f01-399">These three interfaces have callback methods that DirectWrite will call during download operations.</span></span> 

<span data-ttu-id="22f01-400">Cuando se llama a [**IDWriteFontDownloadQueue:: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) , DirectWrite realizará consultas en el cargador del archivo de fuentes remoto sobre la localidad de los datos y solicitará la secuencia remota.</span><span class="sxs-lookup"><span data-stu-id="22f01-400">When [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) is called, DirectWrite will make queries to the remote font file loader about locality of the data, and will request the remote stream.</span></span> <span data-ttu-id="22f01-401">Si los datos no son locales, llamará al método BeginDownload de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="22f01-401">If data is not local, then it will call the stream’s BeginDownload method.</span></span> <span data-ttu-id="22f01-402">La implementación de la secuencia no debe bloquearse en esa llamada, pero debe devolver inmediatamente, devolviendo un objeto [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) que proporciona el identificador de espera que DirectWrite usará para esperar en la operación de descarga asincrónica.</span><span class="sxs-lookup"><span data-stu-id="22f01-402">The stream implementation should not block on that call, but should immediately return, passing back an [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) object that provides the wait handle DirectWrite will use to wait on the asynchronous download operation.</span></span> <span data-ttu-id="22f01-403">La implementación de secuencia personalizada es responsable de controlar la comunicación remota.</span><span class="sxs-lookup"><span data-stu-id="22f01-403">The custom stream implementation is responsible for handling the remote communication.</span></span> <span data-ttu-id="22f01-404">Cuando se ha producido el evento de finalización, DirectWrite llamará a [**IDWriteAsyncResult:: GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) para determinar el resultado de la operación.</span><span class="sxs-lookup"><span data-stu-id="22f01-404">When the completion event has occurred, then DirectWrite will call [**IDWriteAsyncResult::GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) to determine the result of the operation.</span></span> <span data-ttu-id="22f01-405">Si el resultado es correcto, se espera que las llamadas posteriores a ReadFragment a la secuencia de los intervalos descargados se realicen correctamente.</span><span class="sxs-lookup"><span data-stu-id="22f01-405">If the result is successful, then it’s expected that subsequent ReadFragment calls to the stream for the downloaded ranges will succeed.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="22f01-406">Seguridad/Nota de rendimiento: cuando se realiza un intento de obtener una fuente remota, existe la posibilidad de que un atacante suplante el servidor previsto al que se está llamando o que el servidor no responda.</span><span class="sxs-lookup"><span data-stu-id="22f01-406">Security / performance note: When an attempt is made to fetch a remote font, the potential exists in general for an attacker to spoof the intended server being called, or that the server may not respond.</span></span> <span data-ttu-id="22f01-407">Si va a implementar interacciones de red personalizadas, puede tener un mayor control sobre las mitigaciones que cuando se trabaja con servidores de terceros.</span><span class="sxs-lookup"><span data-stu-id="22f01-407">If you are implementing custom network interactions, you may have greater control over mitigations than when dealing with third-party servers.</span></span> <span data-ttu-id="22f01-408">Sin embargo, depende de usted tener en cuenta las mitigaciones adecuadas para evitar la divulgación de información o la denegación de servicio.</span><span class="sxs-lookup"><span data-stu-id="22f01-408">However, it is up to you to consider appropriate mitigations to avoid information disclosure or denial of service.</span></span> <span data-ttu-id="22f01-409">Se recomiendan protocolos seguros, como HTTPS.</span><span class="sxs-lookup"><span data-stu-id="22f01-409">Secure protocols such as HTTPS are recommended.</span></span> <span data-ttu-id="22f01-410">Además, debe compilar en algún tiempo de espera para que el controlador de eventos devuelto a DirectWrite se establezca finalmente.</span><span class="sxs-lookup"><span data-stu-id="22f01-410">Also, you should build in some timeout so that the event handle returned to DirectWrite does eventually get set.</span></span> 

 

### <a name="supporting-scenarios-on-earlier-windows-versions"></a><span data-ttu-id="22f01-411">Escenarios de compatibilidad con versiones anteriores de Windows</span><span class="sxs-lookup"><span data-stu-id="22f01-411">Supporting scenarios on earlier Windows versions</span></span>

<span data-ttu-id="22f01-412">Los escenarios que se han descrito pueden admitirse en DirectWrite en versiones anteriores de Windows, pero necesitarían una implementación más personalizada en la parte de la aplicación con las API más limitadas que estaban disponibles antes de Windows 10.</span><span class="sxs-lookup"><span data-stu-id="22f01-412">The scenarios that have been described can be supported in DirectWrite on earlier versions of Windows, but would require much more custom implementation on the part of the app using the more limited APIs that were available prior to Windows 10.</span></span> <span data-ttu-id="22f01-413">Para obtener más información, vea [colecciones de fuentes personalizadas (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="22f01-413">For more information, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span>

 

 