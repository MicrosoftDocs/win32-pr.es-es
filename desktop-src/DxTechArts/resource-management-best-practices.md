---
title: Procedimientos recomendados para la administración de recursos
description: En este artículo se describen los procedimientos recomendados para trabajar con los recursos en general, cómo se comportan los recursos administrados y no administrados, y se proporciona información detallada sobre cómo los controladores y el tiempo de ejecución suelen controlar los recursos.
ms.assetid: 265ae0b2-f268-a4a4-551e-9d3dae886517
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 27cdadb8cee3cb57f4208657054784937ecd1ea2
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104359214"
---
# <a name="resource-management-best-practices"></a><span data-ttu-id="aa690-103">Procedimientos recomendados para la administración de recursos</span><span class="sxs-lookup"><span data-stu-id="aa690-103">Resource Management Best Practices</span></span>

<span data-ttu-id="aa690-104">Las texturas administradas, también conocidas como administración automática de texturas, están disponibles en DirectX desde la versión 6, con varias revisiones y mejoras realizadas en las versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="aa690-104">Managed textures, also known as automatic texture management, have been available in DirectX since version 6, with several revisions and enhancements made in subsequent releases.</span></span> <span data-ttu-id="aa690-105">A partir del lanzamiento de la API de Direct3D 9, la administración automática de recursos incluye compatibilidad con texturas, búferes de vértices y búferes de índice, todo ello con una interfaz compartida coherente.</span><span class="sxs-lookup"><span data-stu-id="aa690-105">As of the release of the Direct3D 9 API, the automatic resource management includes support for textures, vertex buffers, and index buffers, all with a consistent shared interface.</span></span> <span data-ttu-id="aa690-106">Con el administrador de recursos de Direct3D, las aplicaciones pueden simplificar en gran medida el control de las situaciones de dispositivos perdidos y pueden basarse en el sistema para controlar una cantidad razonable de sobrecompromiso de recursos de memoria de vídeo.</span><span class="sxs-lookup"><span data-stu-id="aa690-106">By using the Direct3D resource manager, applications can greatly simplify the handling of lost-device situations and can rely on the system to handle a reasonable amount of over-commitment of video memory resources.</span></span>

<span data-ttu-id="aa690-107">A veces, los desarrolladores tienen dificultades para usar recursos administrados, en parte debido a la naturaleza abstracta del sistema.</span><span class="sxs-lookup"><span data-stu-id="aa690-107">Developers sometimes have difficulties using managed resources, in part due to the abstract nature of the system.</span></span> <span data-ttu-id="aa690-108">Aunque muchos escenarios comunes para los recursos son una buena opción para los recursos administrados, algunos casos funcionan mejor cuando se usan recursos no administrados.</span><span class="sxs-lookup"><span data-stu-id="aa690-108">While many common scenarios for resources are a good fit for managed resources, some cases perform better when using unmanaged resources.</span></span> <span data-ttu-id="aa690-109">En este artículo se describen los procedimientos recomendados para trabajar con los recursos en general, cómo se comportan los recursos administrados y no administrados, y se proporciona información detallada sobre cómo los controladores y el tiempo de ejecución suelen controlar los recursos.</span><span class="sxs-lookup"><span data-stu-id="aa690-109">This article discusses best practices for dealing with resources generally, how managed and unmanaged resources behave, and provides some detail on how resources are typically handled by the runtime and drivers.</span></span>

<span data-ttu-id="aa690-110">En este artículo se tratan estos conceptos:</span><span class="sxs-lookup"><span data-stu-id="aa690-110">This article covers these concepts:</span></span>

-   [<span data-ttu-id="aa690-111">Memoria de vídeo</span><span class="sxs-lookup"><span data-stu-id="aa690-111">Video Memory</span></span>](#video-memory)
-   [<span data-ttu-id="aa690-112">Recursos administrados</span><span class="sxs-lookup"><span data-stu-id="aa690-112">Managed Resources</span></span>](#managed-resources)
-   [<span data-ttu-id="aa690-113">Recursos administrados por controladores</span><span class="sxs-lookup"><span data-stu-id="aa690-113">Driver-Managed Resources</span></span>](#driver-managed-resources)
-   [<span data-ttu-id="aa690-114">Recursos predeterminados</span><span class="sxs-lookup"><span data-stu-id="aa690-114">Default Resources</span></span>](#default-resources)
    -   [<span data-ttu-id="aa690-115">Usar recursos administrados y predeterminados</span><span class="sxs-lookup"><span data-stu-id="aa690-115">Using Both Managed and Default Resources</span></span>](#using-both-managed-and-default-resources)
    -   [<span data-ttu-id="aa690-116">Recursos predeterminados dinámicos</span><span class="sxs-lookup"><span data-stu-id="aa690-116">Dynamic Default Resources</span></span>](#dynamic-default-resources)
-   [<span data-ttu-id="aa690-117">Recursos de memoria del sistema</span><span class="sxs-lookup"><span data-stu-id="aa690-117">System Memory Resources</span></span>](#system-memory-resources)
-   [<span data-ttu-id="aa690-118">Recomendaciones generales</span><span class="sxs-lookup"><span data-stu-id="aa690-118">General Recommendations</span></span>](#general-recommendations)
-   [<span data-ttu-id="aa690-119">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="aa690-119">Related topics</span></span>](#related-topics)

## <a name="video-memory"></a><span data-ttu-id="aa690-120">Memoria de vídeo</span><span class="sxs-lookup"><span data-stu-id="aa690-120">Video Memory</span></span>

<span data-ttu-id="aa690-121">Para que el sistema de vídeo haga uso de un recurso, debe encontrarse en memoria que sea accesible para la GPU.</span><span class="sxs-lookup"><span data-stu-id="aa690-121">For the video system to make use of a resource, it must be located in memory that is accessible to the GPU.</span></span> <span data-ttu-id="aa690-122">La memoria de vídeo local proporciona el mejor rendimiento para la GPU y ciertos recursos (como destinos de representación y búferes de profundidad y estarcido) deben encontrarse en la memoria de vídeo local.</span><span class="sxs-lookup"><span data-stu-id="aa690-122">Local video memory provides the best performance for the GPU, and certain resources (such as render targets and depth/stencil buffers) must be located in local video memory.</span></span> <span data-ttu-id="aa690-123">Con la llegada de AGP, la GPU también puede tener acceso a una parte de la memoria del sistema directamente.</span><span class="sxs-lookup"><span data-stu-id="aa690-123">With the advent of AGP, the GPU can also access a portion of the system memory directly.</span></span> <span data-ttu-id="aa690-124">Este área de memoria, conocida como la abertura AGP, se conoce como memoria de vídeo no local y no está disponible para otros fines.</span><span class="sxs-lookup"><span data-stu-id="aa690-124">This memory area, known as the AGP aperture, is referred to as non-local video memory and is not available for other purposes.</span></span> <span data-ttu-id="aa690-125">La CPU puede leer y escribir en la memoria de vídeo no local, que normalmente no tiene acceso de alto rendimiento a la memoria de vídeo local y, por tanto, es ideal para su uso como un recurso de memoria compartida.</span><span class="sxs-lookup"><span data-stu-id="aa690-125">Non-local video memory can be read from and written to by the CPU, which typically has no high-performance access to local video memory, and is thus ideal for use as a shared memory resource.</span></span> <span data-ttu-id="aa690-126">Una cuestión clave que hay que recordar sobre la memoria AGP es que, al igual que la memoria de vídeo local, se invalida en situaciones de dispositivo perdido y se deben restaurar los recursos persistentes que se encuentran allí.</span><span class="sxs-lookup"><span data-stu-id="aa690-126">A key thing to remember about AGP memory is that it, like local video memory, is invalidated in lost-device situations, and persistent assets located there must be restored.</span></span>

<span data-ttu-id="aa690-127">**Figura 1. Relación de la GPU, la CPU, la RAM de vídeo y la RAM del sistema**</span><span class="sxs-lookup"><span data-stu-id="aa690-127">**Figure 1. Relationship of the GPU, CPU, video RAM, and system RAM**</span></span>

![relación de la GPU, la CPU, la RAM de vídeo y la RAM del sistema](images/managingresources1.gif)

<span data-ttu-id="aa690-129">Algunas soluciones de vídeo integradas hacen uso de una arquitectura de memoria unificada (UMA), donde la memoria principal es direccionable por todos los componentes de los sistemas.</span><span class="sxs-lookup"><span data-stu-id="aa690-129">Some integrated video solutions make use of a unified memory architecture (UMA), where main memory is addressable by all components of the systems.</span></span> <span data-ttu-id="aa690-130">Direct3D admite la UMA sin necesidad de realizar ningún cambio en la aplicación, con las mismas sugerencias que para las configuraciones de memoria de vídeo local.</span><span class="sxs-lookup"><span data-stu-id="aa690-130">Direct3D supports UMA without requiring any change to the application, utilizing the same hints as for local video memory configurations.</span></span> <span data-ttu-id="aa690-131">En estos sistemas, los recursos siempre se encuentran en la memoria del sistema y el controlador es responsable de garantizar que los recursos funcionen de forma muy similar a como lo hacen en una arquitectura más tradicional, al mismo tiempo que se aprovechan las propiedades del UMA y cualquier comportamiento específico de la implementación de hardware.</span><span class="sxs-lookup"><span data-stu-id="aa690-131">For such systems, resources are always located in system memory, and the driver is responsible for ensuring that resources work much like they do in a more traditional architecture while taking advantage of UMA's properties and any specific behavior of the hardware implementation.</span></span>

<span data-ttu-id="aa690-132">**Figura 2. GPU y CPU tienen el mismo acceso a la memoria RAM del sistema en una arquitectura de memoria unificada**</span><span class="sxs-lookup"><span data-stu-id="aa690-132">**Figure 2. GPU and CPU have equal access to system RAM in a unified memory architecture**</span></span>

![GPU y CPU tienen el mismo acceso a la memoria RAM del sistema en una arquitectura de memoria unificada](images/managingresources2.gif)

## <a name="managed-resources"></a><span data-ttu-id="aa690-134">Recursos administrados</span><span class="sxs-lookup"><span data-stu-id="aa690-134">Managed Resources</span></span>

<span data-ttu-id="aa690-135">La mayoría de los recursos debe crearse como recursos administrados en el grupo \_ administrado.</span><span class="sxs-lookup"><span data-stu-id="aa690-135">The majority of your resources should be created as managed resources in POOL\_MANAGED.</span></span> <span data-ttu-id="aa690-136">Todos los recursos se crearán en la memoria del sistema y, a continuación, se copiarán según sea necesario en la memoria de vídeo.</span><span class="sxs-lookup"><span data-stu-id="aa690-136">All your resources will be created in system memory and then copied as needed into video memory.</span></span> <span data-ttu-id="aa690-137">Las situaciones de dispositivo perdido se administrarán automáticamente desde la copia de la memoria del sistema.</span><span class="sxs-lookup"><span data-stu-id="aa690-137">Lost-device situations will be handled automatically from the system memory copy.</span></span> <span data-ttu-id="aa690-138">Puesto que no es necesario que todos los recursos administrados quepan en la memoria de vídeo de una sola vez, puede sobrecargar la memoria en la que todo el espacio de trabajo de memoria de vídeo es el que se requiere para representar en cualquier fotograma determinado.</span><span class="sxs-lookup"><span data-stu-id="aa690-138">Since not all managed resources are required to fit into video memory all at once, you can over-commit memory where a smaller video memory working set of resources is all that is required to render in any given frame.</span></span> <span data-ttu-id="aa690-139">Tenga en cuenta que es probable que la mayoría de la memoria del sistema de almacenamiento de respaldo se desproteja en el disco a lo largo del tiempo, por lo que la operación de restablecimiento puede ser lenta debido a la necesidad de volver a paginar los datos para restaurar la memoria de vídeo perdida.</span><span class="sxs-lookup"><span data-stu-id="aa690-139">Note that it is likely that the majority of this backing-store system memory will be paged out to disk over time, which is why the Reset operation can be slow due to the need to page this data back in to restore the lost video memory.</span></span>

<span data-ttu-id="aa690-140">El tiempo de ejecución mantiene una marca de tiempo para la última vez que se utiliza un recurso y, cuando se produce un error en la asignación de memoria de vídeo para cargar un recurso administrado necesario, libera los recursos según esta marca de tiempo de forma LRU.</span><span class="sxs-lookup"><span data-stu-id="aa690-140">The runtime keeps a timestamp for the last time a resource is used, and when a video memory allocation fails for loading a needed managed resource, it will release resources based on this timestamp in a LRU fashion.</span></span> <span data-ttu-id="aa690-141">El uso de [**SetPriority**](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3dresource9-setpriority) tiene prioridad sobre la marca de tiempo, por lo que los recursos usados más comúnmente deben establecerse en un valor de prioridad más alto.</span><span class="sxs-lookup"><span data-stu-id="aa690-141">Usage of [**SetPriority**](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3dresource9-setpriority) takes precedence over the timestamp, so more commonly used resources should be set to a higher priority value.</span></span> <span data-ttu-id="aa690-142">Direct3D 9,0 tiene información limitada sobre la memoria de vídeo administrada por el controlador, por lo que el tiempo de ejecución puede necesitar expulsar varios recursos para crear una región lo suficientemente grande como para que la asignación se realice correctamente.</span><span class="sxs-lookup"><span data-stu-id="aa690-142">Direct3D 9.0 has limited information about the video memory managed by the driver, so the runtime may need to evict several resources to create a large enough region for the allocation to succeed.</span></span> <span data-ttu-id="aa690-143">Las prioridades adecuadas pueden ayudar a eliminar situaciones en las que algo se expulsa y, a continuación, se vuelven a necesitar poco después.</span><span class="sxs-lookup"><span data-stu-id="aa690-143">Proper priorities can help eliminate situations where something gets evicted and then is required again shortly thereafter.</span></span> <span data-ttu-id="aa690-144">La aplicación también puede llamar a [**EvictManagedResources**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-evictmanagedresources) para forzar la eliminación de todos los recursos administrados.</span><span class="sxs-lookup"><span data-stu-id="aa690-144">The application can also call [**EvictManagedResources**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-evictmanagedresources) to force all the managed resources to be removed.</span></span> <span data-ttu-id="aa690-145">De nuevo, esto puede ser una operación que requiere mucho tiempo para volver a cargar todos los recursos necesarios para el siguiente fotograma, pero es muy útil para las transiciones de nivel en las que el espacio de trabajo cambia significativamente y para quitar la fragmentación de la memoria de vídeo.</span><span class="sxs-lookup"><span data-stu-id="aa690-145">Again, this can be a time-consuming operation to reload all the resources required for the next frame, but is very useful for level transitions where the working set changes significantly and for removing video memory fragmentation.</span></span>

<span data-ttu-id="aa690-146">También se mantiene un recuento de fotogramas para permitir que el motor en tiempo de ejecución detecte si el recurso que acaba de retirar se usó antes del fotograma actual, lo que implica una situación de hiperpaginación en la que se usan más recursos en un solo fotograma que en la memoria de vídeo.</span><span class="sxs-lookup"><span data-stu-id="aa690-146">A frame count is also kept to allow the runtime to detect if the resource it just chose to evict was used early the current frame, which implies a thrashing situation where more resources are in use in a single frame than will fit into video memory.</span></span> <span data-ttu-id="aa690-147">Esto desencadena la Directiva de reemplazo para cambiar a un modo de MRU en lugar de LRU para el resto del fotograma, ya que esto tiende a realizarse ligeramente mejor en esas condiciones.</span><span class="sxs-lookup"><span data-stu-id="aa690-147">This triggers the replacement policy to switch to a MRU fashion rather than LRU for the remainder of the frame as this tends to perform slightly better under such conditions.</span></span> <span data-ttu-id="aa690-148">Este comportamiento de hiperpaginación afectará significativamente al rendimiento de la representación.</span><span class="sxs-lookup"><span data-stu-id="aa690-148">Such thrashing behavior will significantly impact the rendering performance.</span></span> <span data-ttu-id="aa690-149">Tenga en cuenta que la noción del marco actual está ligada a [**EndScene**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-endscene), por lo que cualquier aplicación que use recursos administrados debe realizar llamadas regulares a este método.</span><span class="sxs-lookup"><span data-stu-id="aa690-149">Note that the notion of current frame is tied to [**EndScene**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-endscene), so any application making use of managed resources needs to make regular calls to this method.</span></span>

<span data-ttu-id="aa690-150">Los desarrolladores que deseen encontrar más información sobre cómo se comportan los recursos administrados en su aplicación pueden usar la consulta de eventos de RESOURCEMANAGER a través de la interfaz [**IDirect3DQuery9**](/windows/desktop/api/d3d9helper/nn-d3d9helper-idirect3dquery9) .</span><span class="sxs-lookup"><span data-stu-id="aa690-150">Developers looking to find more information about how managed resources are behaving in their application can make use of the RESOURCEMANAGER event query via the [**IDirect3DQuery9**](/windows/desktop/api/d3d9helper/nn-d3d9helper-idirect3dquery9) interface.</span></span> <span data-ttu-id="aa690-151">Esto solo funciona cuando se usan los tiempos de ejecución de depuración, por lo que la aplicación no puede depender de esta información, pero proporciona detalles profundos sobre los recursos administrados por el tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="aa690-151">This only works when using the debug runtimes, so this information cannot be depended upon by the application, but it provides deep detail on the resources managed by the runtime.</span></span>

<span data-ttu-id="aa690-152">A la hora de comprender cómo funciona el administrador de recursos puede ayudarle a optimizar y depurar las aplicaciones, es importante no asociar la aplicación a los detalles de implementación del motor en tiempo de ejecución o los controladores actuales.</span><span class="sxs-lookup"><span data-stu-id="aa690-152">While understanding how the resource manager works can help when tuning and debugging your applications, it is important to not tie your application too tightly to the implementation details of the current runtime or drivers.</span></span> <span data-ttu-id="aa690-153">Las revisiones del controlador o los cambios en el hardware pueden cambiar significativamente el comportamiento, y las versiones futuras de Direct3D tendrán una administración de recursos muy mejorada y sofisticada.</span><span class="sxs-lookup"><span data-stu-id="aa690-153">Revisions of the driver or changes in hardware can significantly change the behavior, and future versions of Direct3D will have significantly improved and sophisticated resource management.</span></span>

## <a name="driver-managed-resources"></a><span data-ttu-id="aa690-154">Recursos de Driver-Managed</span><span class="sxs-lookup"><span data-stu-id="aa690-154">Driver-Managed Resources</span></span>

<span data-ttu-id="aa690-155">Los controladores de Direct3D son gratuitos para implementar la funcionalidad de texturas administradas de controladores, indicada por D3DCAPS2 \_ CANMANAGERESOURCE, que permite que el controlador controle la administración de recursos en lugar del tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="aa690-155">Direct3D drivers are free to implement the driver managed textures capability, indicated by D3DCAPS2\_CANMANAGERESOURCE, which allows the driver to handle the resource management instead of the runtime.</span></span> <span data-ttu-id="aa690-156">En el caso del controlador (poco frecuente) que implementa esta característica, el comportamiento exacto del administrador de recursos del controlador puede variar considerablemente y debe ponerse en contacto con el proveedor del controlador para obtener más detalles sobre cómo funciona para su implementación.</span><span class="sxs-lookup"><span data-stu-id="aa690-156">For the (rare) driver that implements this feature, the exact behavior of the driver's resource manager can vary widely, and you should contact the driver's vendor for details on how this works for their implementation.</span></span> <span data-ttu-id="aa690-157">Como alternativa, puede asegurarse de que el administrador en tiempo de ejecución siempre se usa en su lugar mediante la especificación de D3DCREATE \_ deshabilitar la \_ \_ Administración de controladores al crear el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="aa690-157">Alternatively, you can ensure that the runtime manager is always used instead by specifying D3DCREATE\_DISABLE\_DRIVER\_MANAGEMENT when creating the device.</span></span>

## <a name="default-resources"></a><span data-ttu-id="aa690-158">Recursos predeterminados</span><span class="sxs-lookup"><span data-stu-id="aa690-158">Default Resources</span></span>

<span data-ttu-id="aa690-159">Aunque los recursos administrados son sencillos, eficientes y fáciles de usar, hay ocasiones en las que es preferible usar la memoria de vídeo directamente o incluso se requiere.</span><span class="sxs-lookup"><span data-stu-id="aa690-159">While managed resources are simple, efficient, and easy to use, there are times when using video memory directly is preferred or even required.</span></span> <span data-ttu-id="aa690-160">Estos recursos se crean en la \_ categoría predeterminado del grupo.</span><span class="sxs-lookup"><span data-stu-id="aa690-160">Such resources are created in the POOL\_DEFAULT category.</span></span> <span data-ttu-id="aa690-161">El uso de estos recursos produce complicaciones adicionales para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="aa690-161">Making use of such resources does cause additional complications for your application.</span></span> <span data-ttu-id="aa690-162">El código es necesario para hacer frente a la situación de dispositivo perdido para todos los \_ recursos predeterminados de grupo y se deben tener en cuenta las consideraciones de rendimiento cuando se copian datos en ellas.</span><span class="sxs-lookup"><span data-stu-id="aa690-162">Code is required to cope with the lost-device situation for all the POOL\_DEFAULT resources, and performance considerations must be taken into account when copying data into them.</span></span> <span data-ttu-id="aa690-163">Si no se especifica USAGE \_ WRITEONLY o se hace que un destino de representación se pueda bloquear, también se pueden imponer penalizaciones de rendimiento graves.</span><span class="sxs-lookup"><span data-stu-id="aa690-163">Failure to specify USAGE\_WRITEONLY or making a render target lockable can also impose serious performance penalties.</span></span>

<span data-ttu-id="aa690-164">Llamar al **bloqueo** en un \_ recurso predeterminado de grupo es más probable que la GPU se detenga en lugar de trabajar con un \_ recurso administrado de grupo, a menos que se usen ciertas marcas de sugerencia.</span><span class="sxs-lookup"><span data-stu-id="aa690-164">Calling **Lock** on a POOL\_DEFAULT resource is more likely to cause the GPU to stall than working with a POOL\_MANAGED resource, unless using certain hint flags.</span></span> <span data-ttu-id="aa690-165">Dependiendo de la ubicación del recurso, el puntero devuelto podría ser a un búfer de memoria temporal del sistema o puede ser un puntero directamente a la memoria AGP.</span><span class="sxs-lookup"><span data-stu-id="aa690-165">Depending on the location of the resource, the pointer returned could be to a temporary system memory buffer, or it can be a pointer directly into AGP memory.</span></span> <span data-ttu-id="aa690-166">Si es un búfer de memoria temporal del sistema, los datos deberán transferirse a la memoria de vídeo después de la llamada de **desbloqueo** .</span><span class="sxs-lookup"><span data-stu-id="aa690-166">If it is a temporary system memory buffer, data will need to be transferred to the video memory after the **Unlock** call.</span></span> <span data-ttu-id="aa690-167">Si el recurso de vídeo no es de solo escritura, los datos deberán transferirse al búfer temporal durante el **bloqueo**.</span><span class="sxs-lookup"><span data-stu-id="aa690-167">If the video resource is not write-only, data will have to be transferred into the temporary buffer during the **Lock**.</span></span> <span data-ttu-id="aa690-168">Si se trata de un área de memoria AGP, se evitan las copias temporales, pero el comportamiento de la memoria caché necesario puede dar lugar a un rendimiento lento.</span><span class="sxs-lookup"><span data-stu-id="aa690-168">If it is an AGP memory area, temporary copies are avoided but the cache behavior required can result in slow performance.</span></span>

<span data-ttu-id="aa690-169">Se debe tener cuidado para escribir una línea de datos de la memoria caché completa en cualquier puntero a la memoria de abertura AGP para evitar la penalización del barrido de escritura, que induce un ciclo de lectura y escritura, y se prefiere el acceso secuencial del área de memoria.</span><span class="sxs-lookup"><span data-stu-id="aa690-169">Care should be taken to write a full cache line of data into any pointer to AGP aperture memory to avoid the penalty of write-combing, which induces a read-write cycle, and sequential access of the memory area is preferred.</span></span> <span data-ttu-id="aa690-170">Si la aplicación necesita realizar un acceso aleatorio a los datos durante la creación y no desea usar un recurso administrado para el búfer, debe trabajar con una copia de la memoria del sistema en su lugar.</span><span class="sxs-lookup"><span data-stu-id="aa690-170">If your application needs to make random access to data during creation, and you do not wish to make use of a managed resource for the buffer, you should work with a system memory copy instead.</span></span> <span data-ttu-id="aa690-171">Una vez creados los datos, puede transmitir el resultado a la memoria de recursos bloqueados para evitar el pago de una penalización alta para la operación de combinación de escritura en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="aa690-171">Once the data has been created, you can then stream the result into the locked resource memory to avoid paying a high penalty for the cache write-combining operation.</span></span>

<span data-ttu-id="aa690-172">La \_ marca Lock NOOVERWRITE se puede usar para anexar datos de una manera eficaz para algunos recursos, pero idealmente, se pueden evitar varias llamadas de **bloqueo** y **desbloqueo** al mismo recurso.</span><span class="sxs-lookup"><span data-stu-id="aa690-172">The LOCK\_NOOVERWRITE flag can be used to append data in an efficient manner for some resources, but ideally, multiple **Lock** and **Unlock** calls to the same resource can be avoided.</span></span> <span data-ttu-id="aa690-173">Es importante hacer un uso correcto de las distintas marcas de bloqueo para obtener un rendimiento óptimo, como es el uso de un patrón de acceso a datos que se puede almacenar en caché al rellenar la memoria bloqueada.</span><span class="sxs-lookup"><span data-stu-id="aa690-173">Making proper use of the various lock flags is important to optimal performance, as is using a cache-friendly pattern of data access when filling locked memory.</span></span>

### <a name="using-both-managed-and-default-resources"></a><span data-ttu-id="aa690-174">Usar recursos administrados y predeterminados</span><span class="sxs-lookup"><span data-stu-id="aa690-174">Using Both Managed and Default Resources</span></span>

<span data-ttu-id="aa690-175">La combinación de asignaciones de recursos predeterminados administrados y AGRUPAdos \_ puede provocar la fragmentación de la memoria de vídeo y confundir la vista del tiempo de ejecución de la memoria de vídeo disponible para los recursos administrados.</span><span class="sxs-lookup"><span data-stu-id="aa690-175">Mixing allocations of managed and POOL\_DEFAULT resources can cause video memory fragmentation and confuse the runtime's view of the video memory available for managed resources.</span></span> <span data-ttu-id="aa690-176">Idealmente, debe crear todos los \_ recursos predeterminados de grupo antes de usar los \_ recursos administrados de grupo o hacer uso de la llamada [**EvictManagedResources**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-evictmanagedresources) antes de asignar recursos no administrados.</span><span class="sxs-lookup"><span data-stu-id="aa690-176">Ideally, you should create all POOL\_DEFAULT resources before making use of POOL\_MANAGED resources or make use of the [**EvictManagedResources**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-evictmanagedresources) call before allocating unmanaged resources.</span></span> <span data-ttu-id="aa690-177">Recuerde que todas las asignaciones realizadas desde el \_ valor predeterminado del grupo que residen en la memoria de vídeo ocupan la memoria para la vida del recurso que no está disponible para su uso por parte del administrador de recursos o para cualquier otro propósito.</span><span class="sxs-lookup"><span data-stu-id="aa690-177">Remember that all allocations made from POOL\_DEFAULT that reside in video memory tie up memory for the life that resource that is unavailable for use by the resource manager or for any other purpose.</span></span>

<span data-ttu-id="aa690-178">Tenga en cuenta que, a diferencia de las versiones anteriores de Direct3D, el tiempo de ejecución de la versión 9 expulsa automáticamente algunos recursos administrados antes de generar una asignación de recursos no administrada con errores para la falta de memoria de vídeo, pero esto puede crear una fragmentación adicional e incluso forzar un recurso en una ubicación poco óptima (por ejemplo, tener una textura estática en la memoria de vídeo</span><span class="sxs-lookup"><span data-stu-id="aa690-178">Note that unlike previous versions of Direct3D, the version 9 runtime automatically evicts some managed resources before giving up on a failed unmanaged resource allocation for a lack of video memory, but this can potentially create additional fragmentation and even force a resource into a sub-optimal location (for example, having a static texture in non-local video memory).</span></span> <span data-ttu-id="aa690-179">De nuevo, es mejor asignar todos los recursos no administrados necesarios por adelantado y antes de usar los recursos administrados.</span><span class="sxs-lookup"><span data-stu-id="aa690-179">Again, it is best to allocate all required unmanaged resources up front and before using any managed resources.</span></span>

### <a name="dynamic-default-resources"></a><span data-ttu-id="aa690-180">Recursos predeterminados dinámicos</span><span class="sxs-lookup"><span data-stu-id="aa690-180">Dynamic Default Resources</span></span>

<span data-ttu-id="aa690-181">Los datos que se generan y se actualizan con una frecuencia alta no necesitan el almacenamiento de copia de seguridad, ya que toda la información se volverá a crear al restaurar el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="aa690-181">Data that is generated and updated at a high frequency has no need for the backing-store since all the information will be re-created when restoring the device.</span></span> <span data-ttu-id="aa690-182">Normalmente, estos datos se crean mejor en \_ el grupo de forma predeterminada, especificando la \_ sugerencia dinámica Usage, de modo que el controlador pueda tomar decisiones de optimización al colocar el recurso, sabiendo que se actualizará con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="aa690-182">Such data is typically best created in POOL\_DEFAULT, specifying the USAGE\_DYNAMIC hint, so that the driver can make optimization decisions when placing the resource, knowing that it will be updated often.</span></span> <span data-ttu-id="aa690-183">Normalmente, esto significa poner el recurso en memoria de vídeo no local y, por lo tanto, suele ser mucho más lento para que la GPU tenga acceso a la memoria de vídeo local.</span><span class="sxs-lookup"><span data-stu-id="aa690-183">This typically means putting the resource into non-local video memory, and thus, it is usually much slower for the GPU to access than local video memory.</span></span> <span data-ttu-id="aa690-184">En el caso de las arquitecturas UMA, el controlador puede elegir una ubicación determinada para que los recursos dinámicos optimicen el acceso de escritura de la CPU.</span><span class="sxs-lookup"><span data-stu-id="aa690-184">For UMA architectures, the driver might choose a particular placement for dynamic resources to optimize for CPU write access.</span></span>

<span data-ttu-id="aa690-185">Este uso es típico para las soluciones de la división de software y los sistemas de partículas basados en CPU que rellenan los búferes de vértices/índices, y la \_ marca de descartar bloqueo garantizará que no se creen paradas en los casos en los que el recurso todavía esté en uso desde el fotograma anterior.</span><span class="sxs-lookup"><span data-stu-id="aa690-185">This usage is typical for software skinning solutions and CPU-based particle systems filling out vertex/index buffers, and the LOCK\_DISCARD flag will ensure that stalls are not created in cases where the resource is still in use from the previous frame.</span></span> <span data-ttu-id="aa690-186">En este caso, el uso de un recurso administrado actualizaría un búfer de memoria del sistema, que luego se copiaría en la memoria de vídeo y, a continuación, se usaría solo para un marco o dos antes de ser reemplazado.</span><span class="sxs-lookup"><span data-stu-id="aa690-186">Using a managed resource in this case would update a system memory buffer, which would then be copied to video memory, and then used for only a frame or two before being replaced.</span></span> <span data-ttu-id="aa690-187">En sistemas con memoria de vídeo no local, la copia adicional se elimina mediante el uso correcto de este patrón dinámico.</span><span class="sxs-lookup"><span data-stu-id="aa690-187">For systems with non-local video memory, the extra copy is eliminated by proper use of this dynamic pattern.</span></span>

<span data-ttu-id="aa690-188">Las texturas estándar no se pueden bloquear y solo se pueden actualizar a través de [**UpdateSurface**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatesurface) o [**UpdateTexture**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatetexture).</span><span class="sxs-lookup"><span data-stu-id="aa690-188">Standard textures cannot be locked, and can only be updated via [**UpdateSurface**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatesurface) or [**UpdateTexture**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatetexture).</span></span> <span data-ttu-id="aa690-189">Algunos sistemas admiten texturas dinámicas, que se pueden bloquear y usan el \_ patrón de descartar bloqueo, pero se debe comprobar un bit de funcionalidad (D3DCAPS2 \_ DYNAMICTEXTURES) antes de usar dichos recursos.</span><span class="sxs-lookup"><span data-stu-id="aa690-189">Some systems support dynamic textures, which can be locked, and use the LOCK\_DISCARD pattern, but a capabilities bit (D3DCAPS2\_DYNAMICTEXTURES) must be checked before making use of such resources.</span></span> <span data-ttu-id="aa690-190">En el caso de las texturas muy dinámicas (vídeo o procedimiento), la aplicación podría crear recursos coincidentes \_ predeterminados y SYSTEMMEM del grupo \_ y controlar las actualizaciones de la memoria de vídeo mediante **UpdateTexture**.</span><span class="sxs-lookup"><span data-stu-id="aa690-190">For highly dynamic textures (video or procedural), your application could create matching POOL\_DEFAULT and POOL\_SYSTEMMEM resources and handle video-memory updates by using **UpdateTexture**.</span></span> <span data-ttu-id="aa690-191">En el caso de las actualizaciones parciales y muy frecuentes, el paradigma **UpdateTexture** es probablemente la mejor opción.</span><span class="sxs-lookup"><span data-stu-id="aa690-191">For highly frequent and partial updates, the **UpdateTexture** paradigm is likely the better choice.</span></span>

<span data-ttu-id="aa690-192">Como es útil para los recursos dinámicos, tenga cuidado al diseñar sistemas que se basen en gran medida en el envío dinámico.</span><span class="sxs-lookup"><span data-stu-id="aa690-192">As useful as dynamic resources can be, be careful when designing systems that rely heavily on dynamic submission.</span></span> <span data-ttu-id="aa690-193">Los recursos estáticos deben colocarse en \_ un grupo administrado para garantizar un uso correcto de la memoria de vídeo local y para hacer un uso más eficaz del ancho de banda de la memoria y del bus limitado.</span><span class="sxs-lookup"><span data-stu-id="aa690-193">Static resources should be placed into POOL\_MANAGED to ensure both good utilization of local video memory, and to make more efficient use of limited bus and main memory bandwidth.</span></span> <span data-ttu-id="aa690-194">En el caso de los recursos que son semiestáticos, es posible que el costo de una carga ocasional en la memoria de vídeo local sea mucho menor que el tráfico de bus constante generado haciéndolos dinámicos.</span><span class="sxs-lookup"><span data-stu-id="aa690-194">For resources that are semi-static, you may find that the cost of an occasional upload to local video memory is much less than the constant bus traffic generated by making them dynamic.</span></span>

## <a name="system-memory-resources"></a><span data-ttu-id="aa690-195">Recursos de memoria del sistema</span><span class="sxs-lookup"><span data-stu-id="aa690-195">System Memory Resources</span></span>

<span data-ttu-id="aa690-196">Los recursos también se pueden crear en el grupo \_ SYSTEMMEM.</span><span class="sxs-lookup"><span data-stu-id="aa690-196">Resources can also be created in POOL\_SYSTEMMEM.</span></span> <span data-ttu-id="aa690-197">Aunque la canalización de gráficos no puede usarlos, se pueden usar como orígenes para actualizar \_ los recursos predeterminados del grupo mediante [**UpdateSurface**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatesurface) o [**UpdateTexture**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatetexture).</span><span class="sxs-lookup"><span data-stu-id="aa690-197">While they cannot be used by the graphics pipeline, they can be used as sources for updating POOL\_DEFAULT resources by using [**UpdateSurface**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatesurface) or [**UpdateTexture**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-updatetexture).</span></span> <span data-ttu-id="aa690-198">Su comportamiento de bloqueo es sencillo, aunque se pueden producir paradas si están en uso por uno de los métodos mencionados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="aa690-198">Their locking behavior is simple, although stalls might occur if they are in use by one of the previously mentioned methods.</span></span>

<span data-ttu-id="aa690-199">Aunque residen en la memoria del sistema, los recursos de SYSTEMMEM de grupo \_ se limitan a los mismos formatos y capacidades (como el tamaño máximo) que admite el controlador de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="aa690-199">Though they reside in system memory, POOL\_SYSTEMMEM resources are limited to the same formats and capabilities (such as maximum size) supported by the device driver.</span></span> <span data-ttu-id="aa690-200">El \_ tipo de recurso Scratch de grupo es otra forma de recurso de memoria del sistema que puede usar todos los formatos y capacidades admitidos por el tiempo de ejecución, pero el dispositivo no puede tener acceso a él.</span><span class="sxs-lookup"><span data-stu-id="aa690-200">The POOL\_SCRATCH resource type is another form of system memory resource that can utilize all formats and capabilities supported by the runtime, but cannot be accessed by the device.</span></span> <span data-ttu-id="aa690-201">Los recursos de memoria temporal están pensados principalmente para su uso por parte de las herramientas de contenido.</span><span class="sxs-lookup"><span data-stu-id="aa690-201">Scratch resources are intended primarily for use by content tools.</span></span>

<span data-ttu-id="aa690-202">**Figura 3. Recursos de memoria en RAM de vídeo, abertura AGP y RAM del sistema**</span><span class="sxs-lookup"><span data-stu-id="aa690-202">**Figure 3. Memory resources in video RAM, AGP aperture, and system RAM**</span></span>

![recursos de memoria en RAM de vídeo, abertura AGP y RAM del sistema](images/managingresources3.gif)

## <a name="general-recommendations"></a><span data-ttu-id="aa690-204">Recomendaciones generales</span><span class="sxs-lookup"><span data-stu-id="aa690-204">General Recommendations</span></span>

<span data-ttu-id="aa690-205">Obtener los detalles de la implementación técnica de la correcta administración de recursos será una forma larga de lograr los objetivos de rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="aa690-205">Getting the technical implementation details of resource management correct will go a long way toward achieving your performance goals for your application.</span></span> <span data-ttu-id="aa690-206">La planeación de la presentación de los recursos en Direct3D y el diseño arquitectónico en torno a la obtención de los datos de manera oportuna es una tarea más complicada.</span><span class="sxs-lookup"><span data-stu-id="aa690-206">Planning how the resources are presented to Direct3D and the architectural design around getting the data loaded in a timely fashion is a more complicated task.</span></span> <span data-ttu-id="aa690-207">Recomendamos una serie de prácticas recomendadas al tomar estas decisiones para su aplicación:</span><span class="sxs-lookup"><span data-stu-id="aa690-207">We recommend a number of best practices when making these decisions for your application:</span></span>

-   <span data-ttu-id="aa690-208">Procese previamente todos los recursos.</span><span class="sxs-lookup"><span data-stu-id="aa690-208">Pre-process all your resources.</span></span> <span data-ttu-id="aa690-209">La dependencia de la mejora de la conversión y la optimización en tiempo de carga para los recursos resulta útil durante el desarrollo, pero esto supone una gran carga de rendimiento en los equipos de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="aa690-209">Relying on expensive load-time conversion and optimization for your resources is convenient during development, but doing so puts a great performance burden on your users' computers.</span></span> <span data-ttu-id="aa690-210">Los recursos preprocesados son más rápidos de cargar, más rápidos de usar y ofrecen la opción de realizar un trabajo sin conexión sofisticado.</span><span class="sxs-lookup"><span data-stu-id="aa690-210">Pre-processed resources are faster to load, faster to use, and give you the option of doing sophisticated off-line work.</span></span>
-   <span data-ttu-id="aa690-211">Evite crear muchos recursos por fotograma.</span><span class="sxs-lookup"><span data-stu-id="aa690-211">Avoid creating many resources per frame.</span></span> <span data-ttu-id="aa690-212">Las interacciones del controlador necesarias pueden serializar la CPU y la GPU, y las operaciones implicadas son pesadas, ya que a menudo requieren transiciones del kernel.</span><span class="sxs-lookup"><span data-stu-id="aa690-212">The driver interactions required can serialize the CPU and GPU, and the operations involved are heavy-weight, as they often require kernel transitions.</span></span> <span data-ttu-id="aa690-213">Distribuir la creación en varios marcos o reutilizar recursos sin crearlos o liberarlos.</span><span class="sxs-lookup"><span data-stu-id="aa690-213">Spread out creation over several frames or reuse resources without creating/releasing them.</span></span> <span data-ttu-id="aa690-214">Idealmente, debe esperar varias tramas antes de bloquear o liberar los recursos que se usaron recientemente para su presentación.</span><span class="sxs-lookup"><span data-stu-id="aa690-214">Ideally, you should wait several frames before locking or releasing resources that were recently used to render.</span></span>
-   <span data-ttu-id="aa690-215">Al final del marco, asegúrese de desenlazar todos los canales de recursos (es decir, los orígenes de flujo, las fases de textura y los índices actuales).</span><span class="sxs-lookup"><span data-stu-id="aa690-215">At the end of the frame, be sure to unbind all resource channels (that is, stream sources, texture stages, and current indices).</span></span> <span data-ttu-id="aa690-216">De este modo, se asegurará de que las referencias pendientes a los recursos se quitan antes de que el administrador de recursos Mantenga los recursos residentes que realmente ya no están en uso.</span><span class="sxs-lookup"><span data-stu-id="aa690-216">Doing so will ensure that dangling references to resources are removed before they cause the resource manager to keep resources resident that are actually no longer in use.</span></span>
-   <span data-ttu-id="aa690-217">En el caso de las texturas, use formatos comprimidos (por ejemplo, DXTn) con mapas MIP y considere la posibilidad de usar un Atlas de textura.</span><span class="sxs-lookup"><span data-stu-id="aa690-217">For textures, use compressed formats (for example, DXTn) with mip-maps, and consider making use of a texture atlas.</span></span> <span data-ttu-id="aa690-218">Esto reduce en gran medida los requisitos de ancho de banda y pueden reducir el tamaño total de los recursos, por lo que son más eficientes.</span><span class="sxs-lookup"><span data-stu-id="aa690-218">These greatly reduce bandwidth requirements, and they can reduce the overall size of the resources, thus making them more efficient.</span></span>
-   <span data-ttu-id="aa690-219">En el caso de Geometry, haga uso de la geometría indizada como ayuda para comprimir los recursos de búfer de vértices y el hardware de vídeo moderno está muy optimizado en torno a la reutilización de vértices.</span><span class="sxs-lookup"><span data-stu-id="aa690-219">For geometry, make use of indexed geometry as this helps compress vertex buffer resources, and modern video hardware is heavily optimized around reuse of vertices.</span></span> <span data-ttu-id="aa690-220">Mediante el uso de sombreadores de vértices programables, puede comprimir la información de vértices y expandirla durante el procesamiento de vértices.</span><span class="sxs-lookup"><span data-stu-id="aa690-220">By making use of programmable vertex shaders, you can compress the vertex information and expand it during the vertex processing.</span></span> <span data-ttu-id="aa690-221">De nuevo, esto ayuda a reducir los requisitos de ancho de banda y facilita los recursos de búfer de vértices.</span><span class="sxs-lookup"><span data-stu-id="aa690-221">Again, this helps reduce bandwidth requirements and makes vertex buffer resources more efficient.</span></span>
-   <span data-ttu-id="aa690-222">Evite la optimización de la administración de recursos.</span><span class="sxs-lookup"><span data-stu-id="aa690-222">Avoid over-optimizing your resource management.</span></span> <span data-ttu-id="aa690-223">Las revisiones futuras de los controladores, el hardware y el sistema operativo pueden causar problemas de compatibilidad si la aplicación se ajusta demasiado a una combinación especialmente.</span><span class="sxs-lookup"><span data-stu-id="aa690-223">Future revisions of drivers, hardware, and the operating system can potentially cause compatibility problems if the application is tuned too heavily to a particularly combination.</span></span> <span data-ttu-id="aa690-224">Dado que la mayoría de las aplicaciones están enlazadas a la CPU, la administración basada en CPU es costosa, por lo general, genera más problemas de rendimiento de los que resuelve.</span><span class="sxs-lookup"><span data-stu-id="aa690-224">Since most applications are CPU-bound, expensive CPU-based management generally causes more performance issues than it solves.</span></span>

## <a name="related-topics"></a><span data-ttu-id="aa690-225">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="aa690-225">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="aa690-226">Administración de recursos</span><span class="sxs-lookup"><span data-stu-id="aa690-226">Managing Resources</span></span>](/windows/desktop/direct3d9/managing-resources)
</dt> <dt>

[<span data-ttu-id="aa690-227">Dispositivos perdidos</span><span class="sxs-lookup"><span data-stu-id="aa690-227">Lost Devices</span></span>](/windows/desktop/direct3d9/lost-devices)
</dt> <dt>

[<span data-ttu-id="aa690-228">Optimizaciones de rendimiento</span><span class="sxs-lookup"><span data-stu-id="aa690-228">Performance Optimizations</span></span>](/windows/desktop/direct3d9/performance-optimizations)
</dt> <dt>

[<span data-ttu-id="aa690-229">Recursos de textura comprimidos</span><span class="sxs-lookup"><span data-stu-id="aa690-229">Compressed Texture Resources</span></span>](/windows/desktop/direct3d9/compressed-texture-resources)
</dt> <dt>

[<span data-ttu-id="aa690-230">Consultas</span><span class="sxs-lookup"><span data-stu-id="aa690-230">Queries</span></span>](/windows/desktop/direct3d9/queries)
</dt> <dt>

[<span data-ttu-id="aa690-231">**D3DUSAGE**</span><span class="sxs-lookup"><span data-stu-id="aa690-231">**D3DUSAGE**</span></span>](/windows/desktop/direct3d9/d3dusage)
</dt> <dt>

[<span data-ttu-id="aa690-232">**D3DPOOL**</span><span class="sxs-lookup"><span data-stu-id="aa690-232">**D3DPOOL**</span></span>](/windows/desktop/direct3d9/d3dpool)
</dt> <dt>

[<span data-ttu-id="aa690-233">D3DCREATE</span><span class="sxs-lookup"><span data-stu-id="aa690-233">D3DCREATE</span></span>](/windows/desktop/direct3d9/d3dcreate)
</dt> </dl>

 

 