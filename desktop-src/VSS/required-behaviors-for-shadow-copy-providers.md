---
description: Un proveedor de instantáneas debe cumplir las directrices para garantizar la compatibilidad del solicitante.
ms.assetid: 49baeb89-1dc9-45c2-a532-071085a8e52f
title: Comportamientos necesarios para los proveedores de instantáneas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f451dea7154a313cd64a3a46fbcc3b5fe663ec12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696977"
---
# <a name="required-behaviors-for-shadow-copy-providers"></a><span data-ttu-id="0098d-103">Comportamientos necesarios para los proveedores de instantáneas</span><span class="sxs-lookup"><span data-stu-id="0098d-103">Required Behaviors for Shadow Copy Providers</span></span>

<span data-ttu-id="0098d-104">Un proveedor de instantáneas debe cumplir las directrices para garantizar la compatibilidad del solicitante.</span><span class="sxs-lookup"><span data-stu-id="0098d-104">A shadow copy provider must conform to guidelines to ensure requester compatibility.</span></span> <span data-ttu-id="0098d-105">En tiempo de ejecución, una aplicación de copia de seguridad o cualquier otro solicitante que use instantáneas debe funcionar correctamente sin tener que conocer los detalles de implementación de un proveedor concreto.</span><span class="sxs-lookup"><span data-stu-id="0098d-105">At runtime, a backup application or any other requester that uses shadow copies must function correctly without any knowledge of specific provider implementation details.</span></span>

## <a name="automagic-resource-management"></a><span data-ttu-id="0098d-106">Administración de recursos automagic</span><span class="sxs-lookup"><span data-stu-id="0098d-106">Automagic Resource Management</span></span>

<span data-ttu-id="0098d-107">Debe ser posible que el solicitante simplemente agregue un volumen a un conjunto de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="0098d-107">It must be possible for the requester to simply add a volume to a shadow copy set.</span></span> <span data-ttu-id="0098d-108">El solicitante puede especificar atributos de instantáneas, como **VSS \_ volsnap \_ ATTR \_ transportable**, la **\_ diferencia de \_ atributo \_ volsnap de VSS** de VSS o el **\_ \_ \_ Plex de atributo volsnap de VSS** en el contexto de la [**\_ \_ instantánea \_ de VSS**](/windows/desktop/api/Vss/ne-vss-vss_snapshot_context).</span><span class="sxs-lookup"><span data-stu-id="0098d-108">The requester can specify shadow copy attributes such as **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, **VSS\_VOLSNAP\_ATTR\_DIFFERENTIAL**, and/or **VSS\_VOLSNAP\_ATTR\_PLEX** in the [**\_VSS\_SNAPSHOT\_CONTEXT**](/windows/desktop/api/Vss/ne-vss-vss_snapshot_context).</span></span> <span data-ttu-id="0098d-109">El proveedor debe cumplir esos atributos.</span><span class="sxs-lookup"><span data-stu-id="0098d-109">The provider must honor those attributes.</span></span> <span data-ttu-id="0098d-110">Si no puede respetar esos atributos, debe indicar que no se admite el conjunto de instantáneas estableciendo \* *PbIsSupported* en [**IVssHardwareSnapshotProvider:: AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) en **false**.</span><span class="sxs-lookup"><span data-stu-id="0098d-110">If it cannot honor those attributes, then it should indicate that the shadow copy set is unsupported by setting the \**pbIsSupported* in [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to **FALSE**.</span></span>

<span data-ttu-id="0098d-111">El proveedor no debe aceptar nunca que admita una instantánea que no pueda crear.</span><span class="sxs-lookup"><span data-stu-id="0098d-111">The provider must never agree to support a shadow copy that it cannot create.</span></span> <span data-ttu-id="0098d-112">Si el solicitante no especifica un atributo complejo o diferencial, el proveedor debe incluir la lógica automágica para asignar el espacio del subsistema de la instantánea y crear la instantánea con el método más apropiado.</span><span class="sxs-lookup"><span data-stu-id="0098d-112">If the requester does not specify a plex or differential attribute, the provider must include automagic logic for allocating subsystem space for the shadow copy and create the shadow copy using the most appropriate method.</span></span> <span data-ttu-id="0098d-113">El proveedor de hardware no debe incluir una API específica del proveedor para administrar las propiedades de instantánea necesarias.</span><span class="sxs-lookup"><span data-stu-id="0098d-113">The hardware provider must not include a provider-specific API for managing required shadow copy properties.</span></span>

## <a name="created-shadow-copy-volumes-are-read-only-and-hidden"></a><span data-ttu-id="0098d-114">Los volúmenes de instantáneas creados están Read-Only y ocultos</span><span class="sxs-lookup"><span data-stu-id="0098d-114">Created Shadow Copy Volumes Are Read-Only and Hidden</span></span>

<span data-ttu-id="0098d-115">VSS establece marcas en cada LUN afectado de modo que los volúmenes de instantáneas resultantes estén ocultos y sean de solo lectura cuando se detecten en un equipo con Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="0098d-115">VSS sets flags on each affected LUN such that the resulting shadow copy volumes will be hidden and read-only when detected by a computer running Windows Server 2003.</span></span> <span data-ttu-id="0098d-116">Las letras de unidad y las carpetas montadas no se asignan automáticamente.</span><span class="sxs-lookup"><span data-stu-id="0098d-116">Drive letters and mounted folders are not automatically assigned.</span></span> <span data-ttu-id="0098d-117">VSS mantiene estas marcas a lo largo del ciclo de vida de una instantánea.</span><span class="sxs-lookup"><span data-stu-id="0098d-117">VSS maintains these flags throughout the life cycle of a shadow copy.</span></span>

## <a name="hardware-shadow-copy-luns-must-be-readwrite"></a><span data-ttu-id="0098d-118">Los LUN de instantáneas de hardware deben ser de lectura/escritura</span><span class="sxs-lookup"><span data-stu-id="0098d-118">Hardware Shadow Copy LUNs Must Be Read/Write</span></span>

<span data-ttu-id="0098d-119">VSS admite instantáneas de hardware solo cuando el LUN subyacente se asigna como lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="0098d-119">VSS supports hardware shadow copies only where the underlying LUN is mapped as read/write.</span></span> <span data-ttu-id="0098d-120">Esto debe hacerse antes de crear la instantánea; no se puede hacer después del hecho.</span><span class="sxs-lookup"><span data-stu-id="0098d-120">This must be done before the shadow copy is created; it cannot be done after the fact.</span></span> <span data-ttu-id="0098d-121">Los proveedores de hardware no deben modificar estas marcas.</span><span class="sxs-lookup"><span data-stu-id="0098d-121">Hardware providers should not modify these flags.</span></span> <span data-ttu-id="0098d-122">Para obtener más información sobre cómo usa VSS estas marcas, vea [el proceso de creación de instantáneas](the-shadow-copy-creation-process.md).</span><span class="sxs-lookup"><span data-stu-id="0098d-122">For more information about how VSS uses these flags, see [The Shadow Copy Creation Process](the-shadow-copy-creation-process.md).</span></span>

## <a name="auto-import-hardware-shadow-copies-are-not-supported-on-windows-cluster-service"></a><span data-ttu-id="0098d-123">No se admite la importación automática de instantáneas de hardware en el servicio de Cluster Server de Windows</span><span class="sxs-lookup"><span data-stu-id="0098d-123">Auto-Import Hardware Shadow Copies Are Not Supported on Windows Cluster Service</span></span>

<span data-ttu-id="0098d-124">Windows Servicio de clúster no puede alojar LUN con firmas duplicadas y diseño de particiones.</span><span class="sxs-lookup"><span data-stu-id="0098d-124">Windows Cluster service cannot accommodate LUNs with duplicate signatures and partition layout.</span></span> <span data-ttu-id="0098d-125">Los LUN de instantánea deben transportarse a un host fuera del clúster.</span><span class="sxs-lookup"><span data-stu-id="0098d-125">The shadow copy LUNs must be transported to a host outside the cluster.</span></span> <span data-ttu-id="0098d-126">Para obtener más información, consulte [recuperación rápida mediante el uso de volúmenes de instantáneas transportables](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="0098d-126">For more information, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

## <a name="shadow-copies-that-contain-dynamic-disks-must-be-transported-to-a-different-host"></a><span data-ttu-id="0098d-127">Las instantáneas que contienen discos dinámicos deben transportarse a un host diferente</span><span class="sxs-lookup"><span data-stu-id="0098d-127">Shadow Copies That Contain Dynamic Disks Must Be Transported to a Different Host</span></span>

<span data-ttu-id="0098d-128">**Antes de Windows Server 2008:** La compatibilidad nativa con los discos dinámicos no puede alojar LUN con firmas duplicadas y contenido de base de datos de configuración.</span><span class="sxs-lookup"><span data-stu-id="0098d-128">**Prior to Windows Server 2008:** The native support for dynamic disks cannot accommodate LUNs with duplicate signatures and configuration database contents.</span></span> <span data-ttu-id="0098d-129">Los LUN de instantánea deben transportarse a un host diferente.</span><span class="sxs-lookup"><span data-stu-id="0098d-129">The shadow copy LUNs must be transported to a different host.</span></span> <span data-ttu-id="0098d-130">VSS lo exige al no permitir la importación automática de instantáneas de discos dinámicos.</span><span class="sxs-lookup"><span data-stu-id="0098d-130">VSS enforces this by not allowing auto-import shadow copies of dynamic disks.</span></span> <span data-ttu-id="0098d-131">Un solicitante no debe importar una instantánea transportable de nuevo en el mismo host.</span><span class="sxs-lookup"><span data-stu-id="0098d-131">A requester should not import a transportable shadow copy back to the same host.</span></span>

<span data-ttu-id="0098d-132">**A partir de Windows Server 2008:** Esta limitación se ha quitado.</span><span class="sxs-lookup"><span data-stu-id="0098d-132">**Beginning with Windows Server 2008:** This limitation is removed.</span></span>

## <a name="providers-are-out-of-process"></a><span data-ttu-id="0098d-133">Los proveedores están fuera de proceso</span><span class="sxs-lookup"><span data-stu-id="0098d-133">Providers Are Out-of-Process</span></span>

<span data-ttu-id="0098d-134">Todos los proveedores deben implementarse como componentes COM fuera de proceso.</span><span class="sxs-lookup"><span data-stu-id="0098d-134">All providers must be implemented as out-of-process COM components.</span></span>

## <a name="time-critical-operations"></a><span data-ttu-id="0098d-135">Operaciones de Time-Critical</span><span class="sxs-lookup"><span data-stu-id="0098d-135">Time-Critical Operations</span></span>

<span data-ttu-id="0098d-136">Las operaciones largas, como la sincronización de complejos, deben iniciarse en [**IVssHardwareSnapshotProvider:: BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot).</span><span class="sxs-lookup"><span data-stu-id="0098d-136">Long operations, such as syncing plexes, should be initiated in [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot).</span></span> <span data-ttu-id="0098d-137">Esta función debe iniciar el trabajo de preparación asincrónica y volver rápidamente.</span><span class="sxs-lookup"><span data-stu-id="0098d-137">This function should start the asynchronous preparation work and return quickly.</span></span> <span data-ttu-id="0098d-138">[**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) actúa como una función "Rendezvous": el proveedor puede esperar sincrónicamente en este método para completar el trabajo de preparación Iniciado por **BeginPrepareSnapshot**.</span><span class="sxs-lookup"><span data-stu-id="0098d-138">[**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) serves as a "rendezvous" function—the provider can wait synchronously in this method for the completion of the preparation work that was started by **BeginPrepareSnapshot**.</span></span>

<span data-ttu-id="0098d-139">Los proveedores no deben agregar retrasos en [**IVssProviderCreateSnapshotSet::P recommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**IVssProviderCreateSnapshotSet:: CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)o [**IVssProviderCreateSnapshotSet::P ostcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) cuando las aplicaciones se inmovilizan durante estas llamadas.</span><span class="sxs-lookup"><span data-stu-id="0098d-139">Providers must not add delays in [**IVssProviderCreateSnapshotSet::PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**IVssProviderCreateSnapshotSet::CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), or [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) as applications are frozen during these calls.</span></span> <span data-ttu-id="0098d-140">**CommitSnapshots** debe volver en segundos, ya que se llama a este método durante la ventana de vaciado y retención, y el soporte del kernel de VSS cancelará el vaciado y se conservará si la versión no se recibe en 10 segundos, lo que haría que VSS produjera un error en el proceso de creación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="0098d-140">**CommitSnapshots** should return within seconds, because this is called during the Flush and Hold window, and VSS Kernel Support will cancel the Flush and Hold if the release is not received within 10 seconds, which would cause VSS to fail the shadow copy creation process.</span></span> <span data-ttu-id="0098d-141">Si el proveedor tarda más de unos segundos en completar esta llamada, hay una alta probabilidad de que se produzca un error en la creación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="0098d-141">If the provider takes more than a few seconds to complete this call, there is a high probability that the shadow copy creation will fail.</span></span>

## <a name="careful-io-during-commitsnapshots"></a><span data-ttu-id="0098d-142">E/s cuidadosa durante CommitSnapshots</span><span class="sxs-lookup"><span data-stu-id="0098d-142">Careful I/O During CommitSnapshots</span></span>

<span data-ttu-id="0098d-143">Los proveedores de hardware no deben tener que realizar ninguna e/s en los volúmenes implicados en la instantánea durante la [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots).</span><span class="sxs-lookup"><span data-stu-id="0098d-143">Hardware providers should not need to do any I/O to the volumes involved in the shadow copy during [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots).</span></span> <span data-ttu-id="0098d-144">Si se requiere una e/s, los proveedores no deben iniciar ninguna e/s en un volumen original mientras se controla el método **CommitSnapshots** .</span><span class="sxs-lookup"><span data-stu-id="0098d-144">If any I/O is required, providers must not initiate any I/O to an original volume while handling the **CommitSnapshots** method.</span></span>

<span data-ttu-id="0098d-145">Durante [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), los controladores de soporte del kernel de VSS bloquean la e/s en los volúmenes originales en los que se están realizando instantáneas.</span><span class="sxs-lookup"><span data-stu-id="0098d-145">During [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS Kernel Support drivers block I/O to the original volumes that are being shadow copied.</span></span> <span data-ttu-id="0098d-146">Si el proveedor usa e/s sincrónica para un volumen que está en el conjunto de instantáneas, se bloqueará la e/s y se producirá un interbloqueo del proceso de confirmación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="0098d-146">If the provider uses synchronous I/O to a volume which is in the shadow copy set, then that I/O will be blocked and the shadow copy commit process will be deadlocked.</span></span> <span data-ttu-id="0098d-147">El proveedor no debe llamar a ninguna API de Win32 durante **CommitSnapshots** , ya que tendrá una gran probabilidad de producir e/s y un interbloqueo.</span><span class="sxs-lookup"><span data-stu-id="0098d-147">The provider should not call any Win32 APIs during **CommitSnapshots** as they will have a high probability of causing I/O and a deadlock.</span></span> <span data-ttu-id="0098d-148">El tiempo de espera de compatibilidad del kernel de VSS interrumpirá este interbloqueo después de 10 segundos, pero esto hará que se produzca un error en la creación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="0098d-148">The VSS Kernel Support timeout will break this deadlock after 10 seconds, but this will cause the shadow copy creation to fail.</span></span>

<span data-ttu-id="0098d-149">Si se debe intentar e/s, se debe realizar de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="0098d-149">If I/O must be attempted, it must be performed asynchronously.</span></span> <span data-ttu-id="0098d-150">La e/s no se completará hasta que se hayan devuelto todos los proveedores de sus métodos [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) .</span><span class="sxs-lookup"><span data-stu-id="0098d-150">The I/O will not complete until after all providers have returned from their [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) methods.</span></span> <span data-ttu-id="0098d-151">En general, es mejor realizar estas operaciones en la llamada a [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) .</span><span class="sxs-lookup"><span data-stu-id="0098d-151">In general, it is better to perform such operations in the [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) call.</span></span>

## <a name="readwrite-shadow-copy-luns"></a><span data-ttu-id="0098d-152">LUN de lectura/escritura de instantáneas</span><span class="sxs-lookup"><span data-stu-id="0098d-152">Read/Write Shadow Copy LUNs</span></span>

<span data-ttu-id="0098d-153">En esta versión, VSS solo admite LUN de lectura/escritura, aunque los volúmenes se expongan como de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="0098d-153">In this version, VSS supports only read/write shadow copy LUNs even if the volumes are exposed as read-only.</span></span> <span data-ttu-id="0098d-154">La razón es que el sistema necesita cambiar estructuras de datos en el disco, como:</span><span class="sxs-lookup"><span data-stu-id="0098d-154">The reason is that the system needs to change on-disk data structures such as:</span></span>

-   <span data-ttu-id="0098d-155">Firma de disco, que cambia durante el proceso de instantáneas</span><span class="sxs-lookup"><span data-stu-id="0098d-155">Disk signature, which changes during the shadow copy process</span></span>
-   <span data-ttu-id="0098d-156">Las estructuras de datos relacionadas con las particiones, incluidas las que indican que la partición es de solo lectura, está oculta, una instantánea y no deben tener asignada una letra de unidad.</span><span class="sxs-lookup"><span data-stu-id="0098d-156">Partition-related data structures, including those indicating the partition is read-only, hidden, a shadow copy, and should not be assigned a drive letter.</span></span>

## <a name="unique-page-83-information"></a><span data-ttu-id="0098d-157">Página única 83 información</span><span class="sxs-lookup"><span data-stu-id="0098d-157">Unique Page 83 Information</span></span>

<span data-ttu-id="0098d-158">Tanto el LUN original como el LUN de instantánea recién creado deben tener al menos un identificador de almacenamiento único en la página 83 datos.</span><span class="sxs-lookup"><span data-stu-id="0098d-158">Both the original LUN and the newly created shadow copy LUN must have at least one unique storage identifier in the page 83 data.</span></span> <span data-ttu-id="0098d-159">Al menos un identificador de almacenamiento \_ con un tipo de 1, 2, 3 u 8, y una asociación de 0 debe ser única en el LUN original y el LUN de instantánea recién creado.</span><span class="sxs-lookup"><span data-stu-id="0098d-159">At least one STORAGE\_IDENTIFIER with a type of 1, 2, 3, or 8, and an association of 0 must be unique on the original LUN and the newly created shadow copy LUN.</span></span>

 

 



