---
description: Especificación operativa de DirectX video Acceleration IAMVideoAccelerator
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: Especificación operativa de DirectX video Acceleration IAMVideoAccelerator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "103997653"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a>Especificación operativa de DirectX video Acceleration IAMVideoAccelerator

El mecanismo preciso de operación es el siguiente:

1.  Cada perfil de modo restringido definido en este documento tiene un GUID de DirectX VA asociado, que puede ser compatible con [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) y [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) de un PIN de entrada de nivel inferior y que se enumeran en [**IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).
2.  Del mismo modo, cada tipo de protocolo de cifrado para su uso con DirectX VA tendrá un GUID de tipo de protocolo de cifrado asociado que puede ser compatible con las [**IPin**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) :: QueryAccept y [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) de un PIN de entrada de nivel inferior y que se enumeran en **IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**. No se puede enviar el GUID de "no cifrado" de DXVA sin \_ cifrado en esta lista, ya que la compatibilidad con ella es obligatoria y, por tanto, implícita.
3.  Después de llamar a [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) para intentar una conexión con el PIN de entrada de nivel inferior, el decodificador [**IAMVideoAcceleratorNotify:: GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) devolverá un puntero a una estructura de datos de DXVA \_ ConnectMode que contenga la información del modo de conexión para la conexión. [**IAMVideoAccelerator:: GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) se llamará con \* pdwNumTypesCompBuffers = 16 y devolverá información de búfer comprimido en función de la Convención de que el número de tipo de cada búfer (tal y como se define en la sección 3,4 de la especificación de de DirectX va) se puede usar directamente como índice de base cero en la matriz de estructuras de datos de **AMVACompBufferInfo** que se devuelve. Esto requiere que para todos los tipos de búfer que no se vayan a usar (incluido el tipo de búfer 0, dado que no hay ningún uso definido de ese tipo de búfer), el controlador de aceleradores proporcionará estructuras de datos AMVACompBufferInfo con alguna forma de valores de parámetro "ficticios" (como dwNumCompBuffers = 0, dwWidthToCreate = 0, dwHeightToCreate = 0 y dwBytesToAllocate = 0).
4.  Las indicaciones de la función DXVA y los búferes de datos asociados se envían mediante [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute). La función DXVA se indica en el parámetro dwFunction de la llamada. Las únicas funciones de DXVA que son relevantes para la inicialización son DXVA \_ ConfigQueryOrReplyFunc y DXVA \_ EncryptProtocolFunc.
    -   Si dwFunction contiene un valor de DXVA \_ ConfigQueryOrReplyFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de configuración, el puntero lpPrivateOutputData para recibir información del acelerador apuntará a un área donde se puede colocar una estructura de datos de configuración alternativa o duplicada, el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero. El valor HRESULT devuelto contiene la \_ indicación s OK o s \_ false, o bien, \_ FAIL o e \_ INVALIDARG o algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del Protocolo (por ejemplo, un parámetro de configuración no válido). Todas las llamadas a **IAMVideoAccelerator:: Execute** para todos los usos de DXVA \_ ConfigQueryOrReplyFunc deben preceder a todas las demás llamadas a **IAMVideoAccelerator:: Execute**.
    -   Si dwFunction contiene un DXVA \_ EncryptProtocolFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de protocolo de cifrado que comience por DXVA \_ EncryptProtocolHeader, el puntero lpPrivateOutputData para recibir información del acelerador debe apuntar a un área en la que se puedan colocar los datos que se van a devolver (por ejemplo, un certificado) por el protocolo de cifrado (que comenzará con DXVA \_ EncryptProtocolHeader), el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero. El HRESULT devuelto contiene los valores \_ correctos, siempre que el protocolo de cifrado funcione con normalidad y contenga el error e e \_ \_ INVALIDARG o algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del protocolo.

        Después de la inicialización de la operación del modo anterior, la operación real del descodificador continúa como sigue:

5.  Se llamará a **IAMVideoAccelerator:: BeginFrame** antes de enviar cualquier bDXVA \_ FUNC con parámetros de búfer comprimidos que produzcan escrituras en una superficie de destino sin comprimir. El propósito de [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) en DirectX es asociar superficies de destino con valores de índice y notificar al controlador de aceleradores de vídeo de la intención de iniciar la escritura de una superficie para que el controlador pueda responder con una indicación de si la superficie está lista para sobrescribirse. La estructura **AMVABeginFrameInfo** pasada en **IAMVideoAccelerator:: BeginFrame** debe contener un puntero pInputData al parámetro de una sola palabra wBeginPictureIndex que coincida con el índice de fotogramas que se pasa a **IAMVideoAccelerator:: BeginFrame** (y dwSizeInputData debe ser 2). Este es el índice que se va a usar en un búfer comprimido para que el comando se escriba en la superficie (por ejemplo, para usarse como wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex). Cada llamada a **IAMVideoAccelerator:: BeginFrame** se emparejará con una llamada correspondiente a [**IAMVideoAccelerator:: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) tal y como se describe a continuación. Por ejemplo, si una imagen comprimida se va a descodificar y, a continuación, alfa se combina mediante la combinación de búfer a búfer de front-end con una imagen gráfica, habrá una llamada a **IAMVideoAccelerator:: BeginFrame** antes de descodificar la imagen comprimida en una superficie especificada en wDecodedPictureIndex. después, una llamada a **IAMVideoAccelerator:: EndFrame** después de pasar todos los búferes comprimidos que se usan para descodificar la imagen, una segunda llamada a **IAMVideoAccelerator:: BeginFrame** anterior a la combinación de comandos de mezcla alfa del origen de gráficos con la imagen descodificada en una superficie especificada en wBlendedDestinationIndex y, a continuación, una segunda llamada a **IAMVideoAccelerator:: EndFrame** después de la operación de combinación El puntero pOutputData en AMVABeginFrameInfo debe ser **null** (y dwSizeOutputData debe ser "0"). El valor HRESULT devuelto por **IAMVideoAccelerator:: BeginFrame** debe ser:
    -   \_Es correcto si la superficie sin comprimir está disponible y lista para su uso.
    -   E \_ pendiente si la superficie sin comprimir todavía no está disponible para su uso, pero estará disponible pronto (si la superficie sin comprimir se lee para su presentación y la lectura o visualización de la superficie aún no se ha completado).
    -   \_Se produce un error en INVALIDARG o en e/s \_ si se detecta un error de protocolo o de formato de datos (como un valor incorrecto de dwSizeInputData o una pOutputData que no es **null** ).
6.  Las indicaciones de la función DXVA y los búferes de datos asociados se envían mediante **IAMVideoAccelerator:: Execute**. \_Se puede indicar más de un valor FUNC de bDXVA en la misma llamada a [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute). Los \_ valores FUNC de bDXVA se empaquetarán en el parámetro dwFunction de la llamada, con el primer comando de función en las ocho MSBs, el siguiente comando de los ocho bits siguientes, etc., con los bits restantes rellenados con ceros. El valor 0xFF para bDXVA \_ FUNC indica que la función bDXVA \_ se extiende a dos o cuatro bytes. Si el segundo byte también es 0xFF, indica que bDXVA \_ FUNC se extiende a cuatro bytes. Si los cuatro bits superiores del tercer byte son 0xF o 0X0, esto indica que bDXVA \_ FUNC contiene un DXVA \_ CONFIGQUERYORREPLYFUNC o DXVA \_ EncryptProtocolFunc. Los comandos de varios bytes no deben indicar continuación más allá del final de dwFunction. El descodificador debe prestar atención para asegurarse de que no existan dependencias secuenciales entre diferentes \_ valores de FUNC bDXVA especificados en la misma llamada a **IAMVideoAccelerator:: ejecute** y que todas las condiciones de carrera posibles (por ejemplo, entre la descodificación de imágenes y la combinación de subimagens, entre la carga de la subimagen y la combinación de subimagens, etc.) se impidan mediante las llamadas adecuadas a **IAMVideoAccelerator:: BeginFrame** y [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) antes de las llamadas posteriores a **IAMVideoAccelerator:: Execute**.
    -   Si dwFunction contiene un valor de DXVA \_ ConfigQueryOrReplyFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de configuración, el puntero lpPrivateOutputData para recibir información del acelerador apuntará a un área donde se puede colocar una estructura de datos de configuración alternativa o duplicada, el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero. El valor HRESULT devuelto contiene la \_ indicación s OK o s \_ false en respuesta a la consulta, o bien, INVALIDARG o e primario \_ \_ algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del Protocolo (por ejemplo, invalid.configun parámetro). Todas las llamadas a **IAMVideoAccelerator:: Execute** para todos los usos de DXVA \_ ConfigQueryOrReplyFunc deben preceder a todas las demás llamadas a **IAMVideoAccelerator:: Execute**.
    -   Si dwFunction contiene un DXVA \_ EncryptProtocolFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de protocolo de cifrado que comience por DXVA \_ EncryptProtocolHeader, el puntero lpPrivateOutputData para recibir información del acelerador debe apuntar a un área en la que se puedan colocar los datos que se van a devolver (por ejemplo, un certificado) por el protocolo de cifrado (que comenzará con DXVA \_ EncryptProtocolHeader), el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero. El HRESULT devuelto contiene los valores \_ correctos, siempre que el protocolo de cifrado funcione con normalidad y contenga el error e e \_ \_ INVALIDARG o algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del protocolo.
    -   Si dwFunction no contiene un DXVA \_ ConfigQueryOrReplyFunc o DXVA \_ EncryptProtocolFunc, el puntero lpPrivateInputData para pasar datos al acelerador debe apuntar a una lista de descripciones de búfer. Las primeras cuatro entradas de la estructura de la lista de descripciones de búfer para cada búfer (dwTypeIndex, dwBufferIndex, dwDataOffset y dwDataSize) serán iguales a las de la estructura de datos AMVABUFFERINFO del mismo búfer. Si bDXVA \_ FUNC es igual a "1" se especifica en dwFunction y bPicReadbackRequests es "1", el puntero lpPrivateOutputData para recibir información del acelerador apuntará a un área de la memoria persistente (por ejemplo, un montón) que se rellenará con los datos de adaptativo macrobloque de la lectura de la tecla de aceleración (no se garantiza que estos datos estén presentes hasta que **IAMVideoAccelerator:: QueryRenderStatus** para escribir en el mismo búfer de parámetros de imagen indica que es \_ correcto, tal y como se describe en el De lo contrario, el puntero lpPrivateOutputData para recibir información del acelerador debe apuntar a un único valor DWORD para que se establezca en uno de los siguientes valores de indicación (especialmente útil para informar de errores de fragmentada en una operación VLD fuera del host).

        | Value | Descripción                                     |
        |-------|-------------------------------------------------|
        | 0     | Ejecución correcta.                                   |
        | 1     | Problema leve en el formato de datos detectado.       |
        | 2     | Se encontró un problema importante en el formato de datos. |
        | 3     | Se encontró un problema grave en el formato de datos.      |
        | 4     | Otro problema grave detectado.               |

        

         

        Si se indica cualquier tipo de problema "grave", el descodificador de software debe dejar de funcionar con las funciones, a menos que se pueda realizar una acción correctiva. Los datos devueltos del acelerador no serán leídos por el host hasta que se haya completado la representación del búfer de la imagen, como se puede probar mediante [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus). El valor HRESULT devuelto contiene los valores \_ correctos siempre que la operación de interfaz funcione con normalidad y puede devolver e \_ FAIL o e \_ INVALIDARG o algún otro valor HRESULT de indicación de error en caso de que se produzca un problema grave.

7.  El búfer de parámetros de descodificación de imágenes debe estar entre los primeros búferes enviados para la descodificación de cada imagen al usar [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) con bDXVA \_ FUNC igual a "1", y todos los búferes para descodificar una imagen de un fragmentada se enviarán antes que los búferes para descodificar imágenes posteriores. Si se envía un búfer de comandos de control de adaptativo macrobloque, se enviará un búfer de datos de diferencia residual correspondiente (que contiene los datos para el mismo macrobloques) con la misma llamada **IAMVideoAccelerator:: Execute** .
8.  Se debe llamar a [**IAMVideoAccelerator:: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) una vez que se han enviado todos los búferes comprimidos que provocarán la creación del contenido de salida en una superficie sin comprimir especificada (resultado de las operaciones especificadas para WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex o wPicResampleDestPicIndex). La finalidad de esta llamada a **IAMVideoAccelerator:: EndFrame** es notificar al hardware del acelerador de vídeo que se han enviado todos los datos necesarios para la operación especificada. El puntero a los datos que se van a enviar de nivel inferior a través de **IAMVideoAccelerator:: EndFrame** debe apuntar a una sola palabra wEndPictureIndex que contenga el índice del marco que está finalizando. Este parámetro debe coincidir con el valor wBeginPictureIndex especificado en la llamada anterior a [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) antes del envío de los búferes comprimidos pertinentes. Después de una llamada a **IAMVideoAccelerator:: EndFrame**, la superficie sin comprimir con el índice wEndPictureIndex no se encontrará en WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex o wPicResampleDestPicIndex de la imagen hasta que se emita otra llamada a **IAMVideoAccelerator:: BeginFrame** para anunciar que esto ocurrirá y se \_ devuelva un resultado correcto. Sin embargo, ese índice de superficie de destino puede aparecer en comandos de acceso de lectura posteriores, como wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex o bRefPicSelect \[ i \] . El HRESULT devuelto por **IAMVideoAccelerator:: EndFrame** debe ser \_ correcto a menos que haya algún tipo de error de protocolo o de formato de datos, en cuyo caso puede ser e \_ e \_ INVALIDARG o cualquier otra indicación de error.
9.  En el caso de la descodificación basada en campos (por ejemplo, en MPEG-2 bitstreams), no habrá una asignación uno a uno de las imágenes funcionales en fragmentada a superficies sin comprimir en la interfaz de aceleradores. Al descodificar imágenes de campo en un fragmentada de MPEG-2, habrá dos "imágenes" descodificadas para generar una superficie sin comprimir de salida completa. En la definición de la interfaz de DirectX VA, cada fotograma corresponde a cada uso de wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex. Por lo tanto, se requieren dos pares de llamadas a **IAMVideoAccelerator:: BeginFrame** y **IAMVideoAccelerator:: EndFrame** para la descodificación de imágenes de campo en superficies sin comprimir de salida.
10. Una llamada a [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) con dwFlags igual a cero, que tiene lugar después de una llamada a **IAMVideoAccelerator:: EndFrame** con un wEndPictureIndex determinado y comprueba el estado de un búfer que se envió que contenía el WEndPictureIndex en WDecodedPictureIndex, WDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex devolverá una \_ indicación S OK si todas las operaciones para escribir los datos en la superficie sin comprimir se han completado y devolverán E \_ pendientes si la operación no se ha completado todavía. \_Se produce un error \_ en e INVALIDARG, o bien se puede devolver cualquier otra indicación de error en caso de que se produzca un error de protocolo.

## <a name="related-topics"></a>Temas relacionados

<dl> <dt>

[Asignación de aceleración de vídeo de DirectX a IAMVideoAccelerator](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



