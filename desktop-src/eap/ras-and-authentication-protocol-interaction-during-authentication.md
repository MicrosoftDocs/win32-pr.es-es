---
title: Interacción del Protocolo de punto de acceso y autenticación durante la autenticación
description: La función RasEapMakeMessage controla la mayoría de la interacción entre el protocolo de autenticación y el punto de acceso (AP).
ms.assetid: edc128e0-3104-4df9-80f4-b2aebcfe1087
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e486e3a10e323f28bc2f6fef4c131acfc095b48
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/19/2020
ms.locfileid: "104077592"
---
# <a name="access-point-and-authentication-protocol-interaction-during-authentication"></a><span data-ttu-id="aad25-103">Interacción del Protocolo de punto de acceso y autenticación durante la autenticación</span><span class="sxs-lookup"><span data-stu-id="aad25-103">Access Point and Authentication Protocol Interaction During Authentication</span></span>

<span data-ttu-id="aad25-104">La función [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) controla la mayoría de la interacción entre el protocolo de autenticación y el punto de acceso (AP).</span><span class="sxs-lookup"><span data-stu-id="aad25-104">The [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) function controls the majority of the interaction between the authentication protocol and the Access Point (AP).</span></span> <span data-ttu-id="aad25-105">**RasEapMakeMessage** procesa los paquetes EAP entrantes y crea paquetes EAP para la transmisión al equipo remoto del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="aad25-105">**RasEapMakeMessage** processes incoming EAP packets and creates EAP packets for transmission to the remote peer.</span></span> <span data-ttu-id="aad25-106">También procesa eventos como los tiempos de espera y la finalización de la autenticación.</span><span class="sxs-lookup"><span data-stu-id="aad25-106">It also processes events such as time outs and authentication completion.</span></span>

<span data-ttu-id="aad25-107">Si se recibe un mensaje desde el elemento remoto del mismo nivel, el servicio de autenticación de AP llama a [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), pasando un puntero al mensaje recibido en el parámetro *pReceivePacket* .</span><span class="sxs-lookup"><span data-stu-id="aad25-107">If a message is received from the remote peer, the AP authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), passing a pointer to the received message in the *pReceivePacket* parameter.</span></span>

<span data-ttu-id="aad25-108">Si el servicio llama a [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) con *PReceivePacket* establecido en **null**, el AP inicia el cuadro de diálogo con el protocolo de autenticación o solicita que el protocolo vuelva a enviar el último paquete.</span><span class="sxs-lookup"><span data-stu-id="aad25-108">If the service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with *pReceivePacket* set to **NULL**, the AP is either initiating the dialog with the authentication protocol, or requesting that the protocol resend the last packet.</span></span> <span data-ttu-id="aad25-109">El protocolo de autenticación debe determinar qué acción está llevando a cabo el servicio en función de su estado y del contexto del mensaje.</span><span class="sxs-lookup"><span data-stu-id="aad25-109">The authentication protocol should determine which action the service is taking based on its state and from the message context.</span></span>

<span data-ttu-id="aad25-110">En la devolución de [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), el valor del miembro de **acción** de la estructura de [**\_ \_ salida EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) indica qué acción toma el servicio de autenticación.</span><span class="sxs-lookup"><span data-stu-id="aad25-110">On return from [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), the value of the **Action** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure indicates what action, if any, the authentication service takes.</span></span> <span data-ttu-id="aad25-111">El miembro de **acción** toma valores del tipo enumerado de la [**\_ \_ acción EAP de PPP**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) .</span><span class="sxs-lookup"><span data-stu-id="aad25-111">The **Action** member takes values from the [**PPP\_EAP\_ACTION**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) enumerated type.</span></span>

<span data-ttu-id="aad25-112">Si **Action** es **EAPACTION \_ send**, **EAPACTION \_ SendAndDone**, **EAPACTION \_ SendWithTimeout** o **EAPACTION \_ SendWithTimeoutInteractive**, el servicio transmite el paquete al que apunta el parámetro *pSendPacket* al elemento remoto del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="aad25-112">If **Action** is **EAPACTION\_Send**, **EAPACTION\_SendAndDone**, **EAPACTION\_SendWithTimeout**, or **EAPACTION\_SendWithTimeoutInteractive**, the service transmits the packet that is pointed to by the *pSendPacket* parameter to the remote peer.</span></span>

<span data-ttu-id="aad25-113">El valor de **\_ SendWithTimeout de EAPACTION** permite un tiempo de espera, después del cual el servicio de autenticación asume que se perdió el vínculo y desconecta la sesión.</span><span class="sxs-lookup"><span data-stu-id="aad25-113">The **EAPACTION\_SendWithTimeout** value allows for a time out, after which time the authentication service assumes the link was lost, and disconnects the session.</span></span>

<span data-ttu-id="aad25-114">El valor de **EAPACTION \_ SendWithTimeoutInteractive** permite una cantidad infinita de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="aad25-114">The **EAPACTION\_SendWithTimeoutInteractive** value allows an infinite amount of time out to occur.</span></span> <span data-ttu-id="aad25-115">El autenticador debe utilizar este valor cuando se espera la entrada del usuario en el cliente.</span><span class="sxs-lookup"><span data-stu-id="aad25-115">The authenticator should use this value when expecting user input on the client.</span></span> <span data-ttu-id="aad25-116">Este tiempo de espera permite al usuario realizar una cantidad de tiempo no especificada para completar la entrada necesaria.</span><span class="sxs-lookup"><span data-stu-id="aad25-116">This time out allows the user an unspecified amount of time to complete the required input.</span></span>

<span data-ttu-id="aad25-117">Si **Action** es **EAPACTION \_ SendWithTimeout** o **EAPACTION \_ SendWithTimeoutInteractive**, el protocolo de autenticación debe establecer el miembro **dwIdExpected** de la estructura de [**\_ \_ salida EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) en el identificador del siguiente paquete que se espera del elemento remoto del mismo nivel.</span><span class="sxs-lookup"><span data-stu-id="aad25-117">If **Action** is **EAPACTION\_SendWithTimeout** or **EAPACTION\_SendWithTimeoutInteractive**, the authentication protocol should set the **dwIdExpected** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure to the identifier of the next packet that is expected from the remote peer.</span></span> <span data-ttu-id="aad25-118">Independientemente de si el siguiente paquete recibido del mismo nivel coincide con este valor, el servicio de autenticación pasa el paquete al Protocolo de autenticación en una llamada subsiguiente a [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="aad25-118">Regardless of whether the next packet received from the peer matches this value, the authentication service passes the packet to the authentication protocol in a subsequent call to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span></span> <span data-ttu-id="aad25-119">El protocolo de autenticación puede descartar el paquete de forma silenciosa simplemente devolviendo un **paquete de error \_ PPP \_ no válido \_**.</span><span class="sxs-lookup"><span data-stu-id="aad25-119">The authentication protocol may silently discard the packet by simply returning **ERROR\_PPP\_INVALID\_PACKET**.</span></span> <span data-ttu-id="aad25-120">Si no se recibe un paquete con el identificador esperado en el período de tiempo de espera configurado, el servicio de autenticación todavía llama a **RasEapMakeMessage**.</span><span class="sxs-lookup"><span data-stu-id="aad25-120">If a packet with the expected identifier is not received within the configured time-out period, the authentication service still calls **RasEapMakeMessage**.</span></span> <span data-ttu-id="aad25-121">En este caso, la llamada se realiza con el parámetro *pReceivePacket* establecido en **null** para indicar que el paquete anterior debe volver a enviarse.</span><span class="sxs-lookup"><span data-stu-id="aad25-121">In this case, the call is made with the *pReceivePacket* parameter set to **NULL**, to indicate that the previous packet needs to be sent again.</span></span>

<span data-ttu-id="aad25-122">Si el miembro de **acción** es **EAPACTION \_ Done** o **EAPACTION \_ SendAndDone**, el servicio de autenticación examina el miembro **dwAuthResultCode** de la [**\_ \_ salida EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="aad25-122">If the **Action** member is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the authentication service examines the **dwAuthResultCode** member of [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="aad25-123">Si **dwAuthResultCode** NO es un \_ error, la autenticación se realizó correctamente.</span><span class="sxs-lookup"><span data-stu-id="aad25-123">If **dwAuthResultCode** is NO\_ERROR, the authentication succeeded.</span></span> <span data-ttu-id="aad25-124">Si **dwAuthResultCode** es un valor distinto de \_ error, se produjo un error en la autenticación.</span><span class="sxs-lookup"><span data-stu-id="aad25-124">If **dwAuthResultCode** is a value other than NO\_ERROR, the authentication failed.</span></span> <span data-ttu-id="aad25-125">El código de error devuelto para el caso de error debe proviene de Raserror. h, Mprerror. h o Winerror. h.</span><span class="sxs-lookup"><span data-stu-id="aad25-125">The error code returned for the failure case should come from Raserror.h, Mprerror.h, or Winerror.h.</span></span> <span data-ttu-id="aad25-126">Los códigos de retorno posibles incluyen, entre otros, lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="aad25-126">Possible return codes include, but are not limited to, the following:</span></span>

-   <span data-ttu-id="aad25-127">ERROR \_ sin \_ permiso de marcado \_</span><span class="sxs-lookup"><span data-stu-id="aad25-127">ERROR\_NO\_DIALIN\_PERMISSION</span></span>
-   <span data-ttu-id="aad25-128">ERROR \_ passwd \_ expiró</span><span class="sxs-lookup"><span data-stu-id="aad25-128">ERROR\_PASSWD\_EXPIRED</span></span>
-   <span data-ttu-id="aad25-129">cuenta de ERROR \_ \_ deshabilitada</span><span class="sxs-lookup"><span data-stu-id="aad25-129">ERROR\_ACCT\_DISABLED</span></span>
-   <span data-ttu-id="aad25-130">ERROR \_ de \_ horas de inicio de sesión restringidas \_</span><span class="sxs-lookup"><span data-stu-id="aad25-130">ERROR\_RESTRICTED\_LOGON\_HOURS</span></span>
-   <span data-ttu-id="aad25-131">ERROR de \_ autenticación \_ interna</span><span class="sxs-lookup"><span data-stu-id="aad25-131">ERROR\_AUTH\_INTERNAL</span></span>

<span data-ttu-id="aad25-132">En el caso en el que la **acción** es **EAPACTION \_ Done** o **EAPACTION \_ SendAndDone**, el miembro **pUserAttributes** debe apuntar a atributos que invalidan los atributos del mismo tipo que se pasaron al servidor en la llamada a [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="aad25-132">In the case where **Action** is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the **pUserAttributes** member should point to attributes that override attributes of the same type that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span>

<span data-ttu-id="aad25-133">El protocolo de autenticación en el servidor puede solicitar que el servicio de autenticación invoque el proveedor de autenticación actual devolviendo **EAPACTION \_ Authenticate** en el miembro de **acción** en la [**\_ \_ salida EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="aad25-133">The authentication protocol on the server can request that the authentication service invoke the current authentication provider by returning **EAPACTION\_Authenticate** in the **Action** member in [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="aad25-134">En este caso, el puntero **pUserAttributes** de **\_ \_ salida EAP de PPP** solo apunta a los atributos generados por el protocolo de autenticación en el servidor.</span><span class="sxs-lookup"><span data-stu-id="aad25-134">In this case, the **pUserAttributes** pointer in **PPP\_EAP\_OUTPUT** points only to attributes that were generated by the authentication protocol on the server.</span></span> <span data-ttu-id="aad25-135">No incluye ninguno de los atributos que se pasaron al servidor en la llamada a [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="aad25-135">It does not include any of the attributes that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="aad25-136">El proveedor de autenticación no requiere estos atributos iniciales, ya que las credenciales de autenticación se encuentran dentro del propio mensaje EAP, no en un atributo RADIUS independiente.</span><span class="sxs-lookup"><span data-stu-id="aad25-136">The authentication provider does not require these initial attributes because the authentication credentials are inside the EAP message itself, not in a separate RADIUS attribute.</span></span> <span data-ttu-id="aad25-137">Cuando el servicio de autenticación responde a la acción de **\_ autenticación EAPACTION** , **pUserAttributes** en [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), apunta a todos los atributos generados durante la autenticación.</span><span class="sxs-lookup"><span data-stu-id="aad25-137">When the authentication service responds to the **EAPACTION\_Authenticate** action, **pUserAttributes** in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), points to all attributes generated during authentication.</span></span> <span data-ttu-id="aad25-138">Estos atributos se devuelven al Protocolo de autenticación en el cliente.</span><span class="sxs-lookup"><span data-stu-id="aad25-138">These attributes are returned to the authentication protocol on the client.</span></span>

<span data-ttu-id="aad25-139">Si el protocolo de autenticación usa **EAPACTION \_ Authenticate**, el proveedor de autenticación realiza una autenticación PAP o MD5-CHAP.</span><span class="sxs-lookup"><span data-stu-id="aad25-139">If the authentication protocol uses **EAPACTION\_Authenticate**, the authentication provider performs either PAP or MD5-CHAP.</span></span> <span data-ttu-id="aad25-140">Este método de autenticación solo se puede usar con clientes de Windows.</span><span class="sxs-lookup"><span data-stu-id="aad25-140">This authentication method can be used only with Windows clients.</span></span>

<span data-ttu-id="aad25-141">Si el protocolo de autenticación autentica al usuario sin depender de un proveedor de autenticación, no es necesario que el protocolo establezca la **acción** en **EAPACTION \_ Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="aad25-141">If the authentication protocol authenticates the user without relying on an authentication provider, there is no need for the protocol to ever set **Action** to **EAPACTION\_Authenticate**.</span></span> <span data-ttu-id="aad25-142">Un ejemplo de este caso es EAP-Transport Layer Security (TLS).</span><span class="sxs-lookup"><span data-stu-id="aad25-142">An example of this case is EAP-Transport Layer Security (TLS).</span></span>

<span data-ttu-id="aad25-143">El paquete EAP Success es un paquete no confirmado.</span><span class="sxs-lookup"><span data-stu-id="aad25-143">The EAP success packet is a non-acknowledged packet.</span></span> <span data-ttu-id="aad25-144">Por lo tanto, puede perderse y no reenviarse por el servidor.</span><span class="sxs-lookup"><span data-stu-id="aad25-144">Therefore, it can be lost and not resent by the server.</span></span> <span data-ttu-id="aad25-145">Si el servicio de autenticación en el cliente recibe un paquete NCP (Protocolo de control de red), el servicio de autenticación del lado servidor continúa como si la autenticación se realizara correctamente.</span><span class="sxs-lookup"><span data-stu-id="aad25-145">If the authentication service on the client receives a Network Control Protocol (NCP) packet, the server-side authentication service proceeds as though the authentication was successful.</span></span> <span data-ttu-id="aad25-146">Esto se debe a que el servidor ha pasado a la fase NCP de PPP.</span><span class="sxs-lookup"><span data-stu-id="aad25-146">This is because the server has moved on to the NCP phase of PPP.</span></span> <span data-ttu-id="aad25-147">En consecuencia, el servicio de autenticación llama a [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) con el miembro **fSuccessPacketReceived** de la estructura de [**\_ \_ entrada EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) establecida en **true**.</span><span class="sxs-lookup"><span data-stu-id="aad25-147">Accordingly, the authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with the **fSuccessPacketReceived** member of the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure set to **TRUE**.</span></span>

<span data-ttu-id="aad25-148">Durante el transcurso de la sesión de autenticación, es posible que el protocolo de autenticación requiera interacción directa con el usuario en el cliente.</span><span class="sxs-lookup"><span data-stu-id="aad25-148">During the course of the authentication session, the authentication protocol may require interaction directly with the user on the client.</span></span> <span data-ttu-id="aad25-149">El proveedor del Protocolo de autenticación puede proporcionar una interfaz de usuario interactiva para este fin.</span><span class="sxs-lookup"><span data-stu-id="aad25-149">The authentication protocol vendor can provide an interactive user interface for this purpose.</span></span> <span data-ttu-id="aad25-150">El protocolo de autenticación puede solicitar que el servicio muestre la interfaz de usuario interactiva estableciendo los miembros **fInvokeInteractiveUI**, **pUIContextData** y **dwSizeOfUIContextData** en la estructura de [**\_ \_ salida EAP de PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) .</span><span class="sxs-lookup"><span data-stu-id="aad25-150">The authentication protocol can request that the service display the interactive UI by setting the **fInvokeInteractiveUI**, **pUIContextData**, and **dwSizeOfUIContextData** members in the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure.</span></span> <span data-ttu-id="aad25-151">Para obtener más información sobre el uso de una interfaz de usuario interactiva, consulte [Interactive User Interface](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="aad25-151">For more information on using an interactive UI, see [Interactive User Interface](interactive-user-interface.md).</span></span>

<span data-ttu-id="aad25-152">El protocolo de autenticación debe mostrar una interfaz de usuario solo a través del mecanismo descrito en [interfaz de usuario interactiva](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="aad25-152">The authentication protocol should display a user interface only through the mechanism described under [Interactive User Interface](interactive-user-interface.md).</span></span> <span data-ttu-id="aad25-153">Si el propio protocolo de autenticación muestra la interfaz de usuario, el subproceso PPP se bloquea hasta que se descarta la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="aad25-153">If the authentication protocol itself displays the user interface, the PPP thread blocks until the user interface is dismissed.</span></span>

<span data-ttu-id="aad25-154">Si durante el proceso de autenticación, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) devuelve cualquier valor distinto **de \_ error** o **error en el \_ \_ \_ paquete ppp no válido**, la sesión se desconecta y el error se registra (en el servidor) o se muestra al usuario (en el cliente).</span><span class="sxs-lookup"><span data-stu-id="aad25-154">If during the authentication process, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) returns any value other than **NO\_ERROR** or **ERROR\_PPP\_INVALID\_PACKET**, the session is disconnected and the error is logged (on the server) or displayed to the user (on the client).</span></span>

 

 