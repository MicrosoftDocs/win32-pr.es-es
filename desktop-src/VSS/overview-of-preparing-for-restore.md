---
description: Al preparar una restauración, un solicitante usa los documentos de metadatos del escritor almacenados junto con su propio documento de componentes de copia de seguridad recuperados para determinar lo que se va a restaurar y cómo.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Información general de la preparación para la restauración
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8b1bc3e429da5be9872e8345fe6da32a5340005
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696989"
---
# <a name="overview-of-preparing-for-restore"></a>Información general de la preparación para la restauración

Al preparar una restauración, un solicitante usa los documentos de metadatos del escritor almacenados junto con su propio documento de componentes de copia de seguridad recuperados para determinar lo que se va a restaurar y cómo. Para obtener más información, vea [información general sobre el procesamiento de una restauración en VSS](overview-of-processing-a-restore-under-vss.md).

Después de la selección de componentes de candidato de restauración, los escritores que se ejecutan actualmente en el sistema acceden al documento de componentes de copia de seguridad del solicitante. Los escritores utilizan este acceso para indicar cómo se debe producir la dificultad mínima para ejecutar servicios debido a la restauración.

Una vez completado, el solicitante tiene información suficiente para determinar qué archivos se deben restaurar, así como dónde y cómo se deben restaurar. (Para obtener más información, vea [generar un conjunto de restauración](generating-a-restore-set.md)).

En la tabla siguiente se muestra la secuencia de acciones y eventos necesarios para preparar una operación de restauración.



| Acción del solicitante                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Evento                                                         | Acción del escritor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recupere información del documento de componentes de copia de seguridad sobre los componentes [*incluidos explícitamente*](vssgloss-e.md) en la operación de copia de seguridad (vea [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) examinar los documentos de metadatos del escritor recuperados para obtener detalles sobre esos componentes incluidos explícitamente en la copia de seguridad, así como cualquier subcomponente [*incluido implícitamente*](vssgloss-i.md) . (Consulte [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)).<br/> | None                                                          | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Seleccione los componentes y los conjuntos de componentes que se van a restaurar (consulte [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) y [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)).                                                                                                                                                                                                                                                                                                                                                                                          | None                                                          | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| El solicitante permite al escritor actualizar el documento de componentes de copia de seguridad y, opcionalmente, puede comunicar las opciones de restauración especiales al escritor. (Consulte [**IVssBackupComponents:: SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)y [**IVssBackupComponents::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)).                                                                                                                                                                                                                                         | [*Prerestauración*](vssgloss-p.md) | El escritor determina la participación en la restauración, prepara los archivos que se van a restaurar y, opcionalmente, modifica el documento de componentes de copia de seguridad si es necesario. (Vea [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent:: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)). |
| El solicitante espera en los escritores para controlar el evento de [**prerestauración**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync). También debe comprobar el estado del escritor. (Consulte [**ivssbackupcomponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).                                                                                                                                                                                                                                                                                  | None                                                          | None                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Acciones del solicitante durante los preparativos de restauración

Para determinar qué componentes son candidatos para la restauración, el solicitante debe hacer lo siguiente:

-   Establezca el componente y la estructura del [*conjunto de componentes*](vssgloss-c.md) que se usa para realizar la copia de seguridad.
-   Examine la [*selección de*](vssgloss-s.md)los componentes para la restauración.
-   Utilice las instrucciones de selección ([trabajar con la selección para restaurar y subcomponentes](working-with-selectability-for-restore-and-subcomponents.md)) para elegir los componentes que se van a incluir.
-   Use la información del [*conjunto de archivos*](vssgloss-f.md) de componentes para determinar qué archivos del medio de copia de seguridad deben restaurarse.

Para ello, el solicitante debe examinar los componentes [*incluidos explícitamente*](vssgloss-e.md) en el documento componentes de copia de seguridad almacenados. Esta información de componente está disponible en un escritor por escritor mediante [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), que devuelve instancias de la interfaz [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , desde la que se pueden recuperar la información del escritor y las instancias de la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .

Como se indicó en otra parte (el [uso de los componentes por parte del solicitante](use-of-components-by-the-requestor.md)), el documento componentes de copia de seguridad y la interfaz **IVssComponent** no contienen información suficiente para admitir la copia de seguridad. Por lo tanto, el solicitante debe examinar el documento de metadatos del escritor almacenado correspondiente mediante [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (consulte la [información de identificación del escritor](writer-metadata-document-contents.md)).

[**IVssExamineWriterMetadata:: GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts)devuelve el número de componentes que administra cada escritor. Después, el solicitante puede usar [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) para obtener una interfaz [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) para cada componente que un escritor administra.

Mediante el examen de la capacidad de selección de los componentes para las rutas de acceso [*lógicas*](vssgloss-l.md) y [*de copia de seguridad*](vssgloss-s.md) (vea [trabajar con las rutas de acceso lógicas y de selección](working-with-selectability-and-logical-paths.md)), un solicitante puede identificar los componentes que definieron conjuntos de componentes de tiempo de copia de seguridad (componentes incluidos explícitamente) y los miembros de subcomponentes de esos conjuntos (componentes incluidos implícitamente).

Los solicitantes indican a través del documento componentes de copia de seguridad si un componente se va a restaurar explícitamente, mediante [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**Ivssbackupcomponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). La elección del método dependerá de cómo se haya realizado originalmente la copia de seguridad del componente y su posibilidad [*de seleccionar la restauración*](vssgloss-s.md). Estos componentes incluidos explícitamente para la restauración designan otros componentes que se incluyen de forma implícita (vea [trabajar con la selección para restaurar y subcomponentes](working-with-selectability-for-restore-and-subcomponents.md) para obtener más detalles).

Un solicitante puede incluir explícitamente ninguno de los componentes de un escritor que se está ejecutando actualmente para la restauración mediante [**ivssbackupcomponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). En este caso, ese escritor no recibirá ningún evento VSS para el resto de la operación de restauración.

Mediante el uso de [**ivssbackupcomponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**Ivssbackupcomponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) para seleccionar un componente de un escritor que no se está ejecutando actualmente, se devuelve un \_ error de \_ objeto E \_ no \_ encontrado de VSS. Consulte [restauraciones sin participación del escritor](restores-without-writer-participation.md) para obtener información sobre cómo restaurar los datos de escritores que faltan.

Para permitir que un escritor tenga información completa sobre la que actuar, las opciones de restauración específicas del escritor y la indicación de una restauración incremental se pueden enviar a los escritores mediante llamadas de solicitante a [**ivssbackupcomponents:: SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) y [**IVssBackupComponents:: SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), respectivamente.

En este momento, un solicitante ha finalizado su preparación y genera un evento de **prerestauración** mediante una llamada a [**IVssBackupComponents::P**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore)volver a restaurar, lo que permite a los escritores prepararse para la restauración real.

## <a name="writer-actions-during-restore-preparations"></a>Acciones del escritor durante la preparación de la restauración

La preparación del escritor para la operación de restauración se produce al controlar el evento [**Prerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con el método virtual [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore). La implementación predeterminada simplemente devuelve sin realizar ninguna acción. Los escritores pueden optar por invalidar la implementación predeterminada para ejercer más control:

-   Reemplazar [*métodos de restauración*](vssgloss-r.md) con [*destinos de restauración*](vssgloss-r.md)
-   Definición de [ *destinos dirigidos*](vssgloss-d.md)
-   Crear mensajes de error y datos adicionales
-   Proporcionar información de marca de copia de seguridad

El controlador de eventos [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) recibe una instancia de [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), de la que puede obtener interfaces [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para los componentes de sus componentes incluidos explícitamente en el documento componentes de copia de seguridad durante la copia de seguridad.

Información sobre los subcomponentes incluidos implícitamente en las operaciones de copia de seguridad y que se incluyen explícitamente en las restauraciones mediante una instancia de **IVssComponent** correspondiente al componente que definió su [*conjunto de componentes*](vssgloss-c.md)de copia de seguridad.

El método [**IVssComponent:: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) se usa para determinar si se va a restaurar un componente de copia de seguridad incluido explícitamente.

Para determinar si un subcomponente de copia de seguridad se incluyó explícitamente en la restauración, los escritores usan [**IVssComponent:: GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

El escritor debe examinar el [*conjunto de archivos*](vssgloss-f.md) de cada componente y determinar si es necesario realizar acciones para admitir la restauración. El escritor tendrá que evaluar si desea sobrescribir los archivos actuales, o bien, si necesita restauración en nuevas ubicaciones. Las acciones pueden incluir lo siguiente:

-   Obtener y actuar sobre las opciones específicas del escritor o del solicitante que rigen las operaciones de restauración (vea [**IVssComponent:: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))
-   Cerrar y permitir la escritura en todos los archivos abiertos actualmente
-   Actualizar el destino de restauración (por ejemplo, para forzar la restauración en una asignación de ubicación alternativa). Vea [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).
-   Comunicación con el solicitante a través de metadatos privados (consulte [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Que indica que se debe restaurar un archivo reasignando a través de la definición de [*destinos dirigidos*](vssgloss-d.md) (vea [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))

La instancia de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) utilizada será la que creará la inclusión explícita del componente en el documento componentes de copia de seguridad durante la copia de seguridad, o en el componente que define el conjunto de componentes de copia de seguridad del que era miembro (vea [trabajar con la selección para restaurar y subcomponentes](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
