---
title: Sacar partido de High-Definition movimiento del mouse
description: Este artículo se centra en la mejor manera de optimizar el rendimiento de la entrada de mouse de alta definición en un juego como un dispositivo de presentación de primera persona.
ms.assetid: 0138a248-e8e0-a392-564e-7a9229b94b56
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7ebe2abd9487d95b8fe12aa3c6938e21d72d8e2f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104421096"
---
# <a name="taking-advantage-of-high-definition-mouse-movement"></a><span data-ttu-id="4bcd3-103">Sacar partido de High-Definition movimiento del mouse</span><span class="sxs-lookup"><span data-stu-id="4bcd3-103">Taking Advantage of High-Definition Mouse Movement</span></span>

<span data-ttu-id="4bcd3-104">Un mouse de equipo estándar devuelve datos a 400 puntos por pulgada (PPP), mientras que un mouse de alta definición genera datos a 800 ppp o superior.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-104">A standard computer mouse returns data at 400 dots per inch (DPI), whereas a high-definition mouse generates data at 800 DPI or greater.</span></span> <span data-ttu-id="4bcd3-105">Esto hace que la entrada de un mouse de alta definición sea mucho más precisa que la del mouse estándar.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-105">This makes input from a high-definition mouse much more precise than that from a standard mouse.</span></span> <span data-ttu-id="4bcd3-106">Sin embargo, los datos de alta definición no se pueden obtener a través de los mensajes de MOUSEMOVE estándar de WM \_ .</span><span class="sxs-lookup"><span data-stu-id="4bcd3-106">However, high-definition data cannot be obtained through the standard WM\_MOUSEMOVE messages.</span></span> <span data-ttu-id="4bcd3-107">En general, los juegos se beneficiarán de los dispositivos de mouse de alta definición, pero los juegos que obtienen datos de mouse con solo WM \_ MOUSEMOVE no podrán tener acceso a la resolución completa y sin filtrar del mouse.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-107">In general, games will benefit from high-definition mouse devices but games that obtain mouse data using just WM\_MOUSEMOVE won't be able to access the full, unfiltered resolution of the mouse.</span></span>

<span data-ttu-id="4bcd3-108">Varias empresas están fabricando dispositivos de mouse de alta definición, como Microsoft y Logitech.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-108">A number of companies are manufacturing high-definition mouse devices, such as Microsoft and Logitech.</span></span> <span data-ttu-id="4bcd3-109">Con la creciente popularidad de los dispositivos de mouse de alta resolución, es importante que los desarrolladores sepan cómo usar la información generada por estos dispositivos de forma óptima.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-109">With the increasing popularity of high-resolution mouse devices, it is important that developers understand how to use the information generated by these devices optimally.</span></span> <span data-ttu-id="4bcd3-110">Este artículo se centra en la mejor manera de optimizar el rendimiento de la entrada de mouse de alta definición en un juego como un dispositivo de presentación de primera persona.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-110">This article focuses on the best way to optimize the performance of high-definition mouse input in a game like a first-person shooter.</span></span>

## <a name="retrieving-mouse-movement-data"></a><span data-ttu-id="4bcd3-111">Recuperar datos de movimiento del mouse</span><span class="sxs-lookup"><span data-stu-id="4bcd3-111">Retrieving Mouse Movement Data</span></span>

<span data-ttu-id="4bcd3-112">Estos son los tres métodos principales para recuperar los datos del mouse:</span><span class="sxs-lookup"><span data-stu-id="4bcd3-112">Here are the three primary methods to retrieve mouse data:</span></span>

-   [<span data-ttu-id="4bcd3-113">MOUSEMOVE de WM \_</span><span class="sxs-lookup"><span data-stu-id="4bcd3-113">WM\_MOUSEMOVE</span></span>](/windows)
-   [<span data-ttu-id="4bcd3-114">entrada de WM \_</span><span class="sxs-lookup"><span data-stu-id="4bcd3-114">WM\_INPUT</span></span>](/windows)
-   [<span data-ttu-id="4bcd3-115">DirectInput</span><span class="sxs-lookup"><span data-stu-id="4bcd3-115">DirectInput</span></span>](#directinput)

<span data-ttu-id="4bcd3-116">Existen ventajas y desventajas de cada método, en función de cómo se usarán los datos.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-116">There are advantages and disadvantages to each method, depending on how the data will be used.</span></span>

### <a name="wm_mousemove"></a><span data-ttu-id="4bcd3-117">MOUSEMOVE de WM \_</span><span class="sxs-lookup"><span data-stu-id="4bcd3-117">WM\_MOUSEMOVE</span></span>

<span data-ttu-id="4bcd3-118">El método más sencillo de leer los datos de movimiento del mouse es a través de \_ los mensajes de WM MOUSEMOVE.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-118">The simplest method of reading mouse movement data is through WM\_MOUSEMOVE messages.</span></span> <span data-ttu-id="4bcd3-119">El siguiente es un ejemplo de cómo leer los datos de movimiento del mouse desde el mensaje de MOUSEMOVE de WM \_ :</span><span class="sxs-lookup"><span data-stu-id="4bcd3-119">The following is an example of how to read mouse movement data from the WM\_MOUSEMOVE message:</span></span>

```cpp
case WM_MOUSEMOVE:
{
    int xPosAbsolute = GET_X_PARAM(lParam); 
    int yPosAbsolute = GET_Y_PARAM(lParam);
    // ...
    break;
}
```

<span data-ttu-id="4bcd3-120">El principal inconveniente de los datos de WM \_ MOUSEMOVE es que se limita a la resolución de pantalla.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-120">The primary disadvantage to data from WM\_MOUSEMOVE is that it is limited to the screen resolution.</span></span> <span data-ttu-id="4bcd3-121">Esto significa que si mueve el mouse ligeramente, pero no suficiente para que el puntero se mueva al siguiente píxel, no se genera ningún mensaje de la MOUSEMOVE de WM \_ .</span><span class="sxs-lookup"><span data-stu-id="4bcd3-121">This means that if you move the mouse slightly — but not enough to cause the pointer to move to the next pixel — then no WM\_MOUSEMOVE message is generated.</span></span> <span data-ttu-id="4bcd3-122">Por lo tanto, el uso de este método para leer el movimiento del mouse anula las ventajas de la entrada de alta definición.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-122">So, using this method to read mouse movement negates the benefits of high-definition input.</span></span>

<span data-ttu-id="4bcd3-123">Sin embargo, la ventaja de WM \_ MOUSEMOVE es que Windows aplica la aceleración del puntero (también conocida como Ballistics) a los datos del mouse sin procesar, lo que hace que el puntero del mouse se comporte como esperan los clientes.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-123">The advantage to WM\_MOUSEMOVE, however, is that Windows applies pointer acceleration (also known as ballistics) to the raw mouse data, which makes the mouse pointer behave as customers expect.</span></span> <span data-ttu-id="4bcd3-124">Esto hace que WM \_ MOUSEMOVE sea la opción preferida para el control de puntero (a través de la entrada de WM \_ o DirectInput), ya que resulta en un comportamiento más natural para los usuarios.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-124">This makes WM\_MOUSEMOVE the preferred option for pointer control (over WM\_INPUT or DirectInput), since it results in more natural behavior for users.</span></span> <span data-ttu-id="4bcd3-125">Aunque WM \_ MOUSEMOVE es idóneo para mover punteros del mouse, no es tan bueno para mover una cámara de primera persona, ya que se perderá la precisión de alta definición.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-125">While WM\_MOUSEMOVE is ideal for moving mouse pointers, it is not so good for moving a first-person camera, since the high-definition precision will be lost.</span></span>

<span data-ttu-id="4bcd3-126">Para obtener más información sobre WM \_ MouseMove, consulte [**WM \_ MouseMove**](/windows/desktop/inputdev/wm-mousemove).</span><span class="sxs-lookup"><span data-stu-id="4bcd3-126">For more info about WM\_MOUSEMOVE, see [**WM\_MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove).</span></span>

### <a name="wm_input"></a><span data-ttu-id="4bcd3-127">entrada de WM \_</span><span class="sxs-lookup"><span data-stu-id="4bcd3-127">WM\_INPUT</span></span>

<span data-ttu-id="4bcd3-128">El segundo método para obtener los datos del mouse es leer \_ los mensajes de entrada de WM.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-128">The second method of obtaining mouse data is to read WM\_INPUT messages.</span></span> <span data-ttu-id="4bcd3-129">El procesamiento de \_ mensajes de entrada de WM es más complicado que \_ el procesamiento de mensajes de WM MOUSEMOVE, pero \_ los mensajes de entrada de WM se leen directamente desde la pila dispositivo de interfaz humana (HID) y reflejan los resultados de alta definición.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-129">Processing WM\_INPUT messages is more complicated than processing WM\_MOUSEMOVE messages, but WM\_INPUT messages are read directly from the Human Interface Device (HID) stack and reflect high-definition results.</span></span>

<span data-ttu-id="4bcd3-130">Para leer los datos de movimiento del mouse desde el mensaje de entrada de WM \_ , primero se debe registrar el dispositivo; el código siguiente proporciona un ejemplo de esto:</span><span class="sxs-lookup"><span data-stu-id="4bcd3-130">To read mouse movement data from the WM\_INPUT message, the device must first be registered; the following code provides an example of this:</span></span>

```cpp
// you can #include <hidusage.h> for these defines
#ifndef HID_USAGE_PAGE_GENERIC
#define HID_USAGE_PAGE_GENERIC         ((USHORT) 0x01)
#endif
#ifndef HID_USAGE_GENERIC_MOUSE
#define HID_USAGE_GENERIC_MOUSE        ((USHORT) 0x02)
#endif

RAWINPUTDEVICE Rid[1];
Rid[0].usUsagePage = HID_USAGE_PAGE_GENERIC; 
Rid[0].usUsage = HID_USAGE_GENERIC_MOUSE; 
Rid[0].dwFlags = RIDEV_INPUTSINK;   
Rid[0].hwndTarget = hWnd;
RegisterRawInputDevices(Rid, 1, sizeof(Rid[0]));
```

<span data-ttu-id="4bcd3-131">El código siguiente controla \_ los mensajes de entrada de WM en el controlador que winproc de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="4bcd3-131">The following code handles WM\_INPUT messages in the application's WinProc handler:</span></span>

```cpp
case WM_INPUT: 
{
    UINT dwSize = sizeof(RAWINPUT);
    static BYTE lpb[sizeof(RAWINPUT)];

    GetRawInputData((HRAWINPUT)lParam, RID_INPUT, lpb, &dwSize, sizeof(RAWINPUTHEADER));

    RAWINPUT* raw = (RAWINPUT*)lpb;

    if (raw->header.dwType == RIM_TYPEMOUSE) 
    {
        int xPosRelative = raw->data.mouse.lLastX;
        int yPosRelative = raw->data.mouse.lLastY;
    } 
    break;
}
```

<span data-ttu-id="4bcd3-132">La ventaja de usar la \_ entrada de WM es que el juego recibe datos sin procesar del mouse en el nivel más bajo posible.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-132">The advantage to using WM\_INPUT is that your game receives raw data from the mouse at the lowest level possible.</span></span>

<span data-ttu-id="4bcd3-133">La desventaja es que la \_ entrada de WM no tiene ningún Ballistics aplicado a sus datos, por lo que si desea controlar un cursor con estos datos, se requerirá un esfuerzo adicional para que el cursor se comporte como en Windows.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-133">The disadvantage is that WM\_INPUT has no ballistics applied to its data, so if you want to drive a cursor with this data, extra effort will be required to make the cursor behave like it does in Windows.</span></span> <span data-ttu-id="4bcd3-134">Para obtener más información acerca de cómo aplicar el puntero Ballistics, vea [Pointer Ballistics for Windows XP](https://www.microsoft.com/whdc/archive/pointer-bal.mspx).</span><span class="sxs-lookup"><span data-stu-id="4bcd3-134">For more information about applying pointer ballistics, see [Pointer Ballistics for Windows XP](https://www.microsoft.com/whdc/archive/pointer-bal.mspx).</span></span>

<span data-ttu-id="4bcd3-135">Para obtener más información sobre la entrada de WM \_ , consulte [acerca de la entrada sin formato](/windows/desktop/inputdev/about-raw-input).</span><span class="sxs-lookup"><span data-stu-id="4bcd3-135">For more info about WM\_INPUT, see [About Raw Input](/windows/desktop/inputdev/about-raw-input).</span></span>

### <a name="directinput"></a><span data-ttu-id="4bcd3-136">DirectInput</span><span class="sxs-lookup"><span data-stu-id="4bcd3-136">DirectInput</span></span>

<span data-ttu-id="4bcd3-137">[DirectInput](/windows-hardware/drivers/hid/directinput) es un conjunto de llamadas API que abstrae los dispositivos de entrada en el sistema.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-137">[DirectInput](/windows-hardware/drivers/hid/directinput) is a set of API calls that abstracts input devices on the system.</span></span> <span data-ttu-id="4bcd3-138">Internamente, DirectInput crea un segundo subproceso para leer los datos de entrada de WM \_ y el uso de las API de DirectInput agregará más sobrecarga que simplemente leer directamente la entrada de WM \_ .</span><span class="sxs-lookup"><span data-stu-id="4bcd3-138">Internally, DirectInput creates a second thread to read WM\_INPUT data, and using the DirectInput APIs will add more overhead than simply reading WM\_INPUT directly.</span></span> <span data-ttu-id="4bcd3-139">DirectInput solo es útil para leer datos de los joysticks de DirectInput; sin embargo, si solo necesita admitir la controladora Xbox 360 para Windows, use [XInput](/windows/desktop/xinput/xinput-game-controller-apis-portal) en su lugar.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-139">DirectInput is only useful for reading data from DirectInput joysticks; however, if you only need to support the Xbox 360 controller for Windows, use [XInput](/windows/desktop/xinput/xinput-game-controller-apis-portal) instead.</span></span> <span data-ttu-id="4bcd3-140">En general, el uso de DirectInput no ofrece ninguna ventaja cuando se leen datos desde dispositivos de mouse o teclado, y no se recomienda el uso de DirectInput en estos escenarios.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-140">Overall, using DirectInput offers no advantages when reading data from mouse or keyboard devices, and the use of DirectInput in these scenarios is discouraged.</span></span>

<span data-ttu-id="4bcd3-141">Compare la complejidad del uso de [DirectInput](/windows-hardware/drivers/hid/directinput), que se muestra en el código siguiente, con los métodos descritos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-141">Compare the complexity of using [DirectInput](/windows-hardware/drivers/hid/directinput), shown in the following code, to the methods previously described.</span></span> <span data-ttu-id="4bcd3-142">Se necesita el siguiente conjunto de llamadas para crear un mouse de DirectInput:</span><span class="sxs-lookup"><span data-stu-id="4bcd3-142">The following set of calls are needed to create a DirectInput mouse:</span></span>

```cpp
LPDIRECTINPUT8 pDI;
LPDIRECTINPUTDEVICE8 pMouse;

hr = DirectInput8Create(GetModuleHandle(NULL), DIRECTINPUT_VERSION, IID_IDirectInput8, (VOID**)&pDI, NULL);
if(FAILED(hr))
    return hr;

hr = pDI->CreateDevice(GUID_SysMouse, &pMouse, NULL);
if(FAILED(hr))
    return hr;

hr = pMouse->SetDataFormat(&c_dfDIMouse2);
if(FAILED(hr))
    return hr;

hr = pMouse->SetCooperativeLevel(hWnd, DISCL_NONEXCLUSIVE | DISCL_FOREGROUND);
if(FAILED(hr))
    return hr;

if(!bImmediate)
{
    DIPROPDWORD dipdw;
    dipdw.diph.dwSize       = sizeof(DIPROPDWORD);
    dipdw.diph.dwHeaderSize = sizeof(DIPROPHEADER);
    dipdw.diph.dwObj        = 0;
    dipdw.diph.dwHow        = DIPH_DEVICE;
    dipdw.dwData            = 16; // Arbitrary buffer size

    if(FAILED(hr = pMouse->SetProperty(DIPROP_BUFFERSIZE, &dipdw.diph)))
        return hr;
}

pMouse->Acquire();
```

<span data-ttu-id="4bcd3-143">Y, a continuación, el dispositivo de mouse de DirectInput puede leerse en cada fotograma:</span><span class="sxs-lookup"><span data-stu-id="4bcd3-143">And then the DirectInput mouse device can be read each frame:</span></span>

```cpp
DIMOUSESTATE2 dims2; 
ZeroMemory(&dims2, sizeof(dims2));

hr = pMouse->GetDeviceState(sizeof(DIMOUSESTATE2), &dims2);
if(FAILED(hr)) 
{
    hr = pMouse->Acquire();
    while(hr == DIERR_INPUTLOST) 
        hr = pMouse->Acquire();

    return S_OK; 
}

int xPosRelative = dims2.lX;
int yPosRelative = dims2.lY;
```

## <a name="summary"></a><span data-ttu-id="4bcd3-144">Resumen</span><span class="sxs-lookup"><span data-stu-id="4bcd3-144">Summary</span></span>

<span data-ttu-id="4bcd3-145">En general, el mejor método para recibir datos de movimiento del mouse de alta definición es la entrada de WM \_ .</span><span class="sxs-lookup"><span data-stu-id="4bcd3-145">Overall, the best method to receive high-definition mouse movement data is WM\_INPUT.</span></span> <span data-ttu-id="4bcd3-146">Si los usuarios solo mueven un puntero del mouse, considere la posibilidad de usar WM \_ MOUSEMOVE para evitar tener que realizar Ballistics de puntero.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-146">If your users are just moving a mouse pointer, then consider using WM\_MOUSEMOVE to avoid needing to perform pointer ballistics.</span></span> <span data-ttu-id="4bcd3-147">Ambos mensajes de ventana funcionarán bien incluso si el mouse no es un mouse de alta definición.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-147">Both of these window messages will work well even if the mouse isn't a high-definition mouse.</span></span> <span data-ttu-id="4bcd3-148">Al admitir alta definición, los juegos de Windows pueden ofrecer un control más preciso a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="4bcd3-148">By supporting high definition, Windows games can offer more precise control to users.</span></span>