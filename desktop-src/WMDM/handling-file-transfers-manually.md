---
title: Controlar las transferencias de archivos manualmente
description: Controlar las transferencias de archivos manualmente
ms.assetid: ff94191b-a0f2-4118-996c-d040f214fb9b
keywords:
- Windows Media Administrador de dispositivos, transferencias de archivos manuales
- Administrador de dispositivos, transferencias de archivos manuales
- Guía de programación, transferencias de archivos manuales
- aplicaciones de escritorio, transferencias de archivos manuales
- crear aplicaciones de Windows Media Administrador de dispositivos, transferencias de archivos manuales
- transferencias de archivos manuales
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a2bf12404e8cd83b6f0c0e4f1c8ec8b0b7bda205
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792855"
---
# <a name="handling-file-transfers-manually"></a><span data-ttu-id="fbd19-109">Controlar las transferencias de archivos manualmente</span><span class="sxs-lookup"><span data-stu-id="fbd19-109">Handling File Transfers Manually</span></span>

<span data-ttu-id="fbd19-110">La aplicación puede implementar la interfaz [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) para administrar parte del proceso de lectura o escritura.</span><span class="sxs-lookup"><span data-stu-id="fbd19-110">Your application can implement the [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) interface to manage part of the reading or writing process.</span></span> <span data-ttu-id="fbd19-111">En un dispositivo de lectura, la implementación permite a la aplicación recibir bloques de datos sin procesar de un archivo de dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-111">On a read from device, the implementation enables the application to receive blocks of raw data from a device file.</span></span> <span data-ttu-id="fbd19-112">En una escritura en el dispositivo, permite que la aplicación envíe bloques de datos sin procesar a un archivo en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-112">On a write to device, it enables the application to send blocks of raw data to a file on the device.</span></span>

<span data-ttu-id="fbd19-113">En las operaciones de lectura y escritura, el método [**IWMDMOperation:: TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) pasa los datos entre el equipo y el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-113">In both read and write operations, the [**IWMDMOperation::TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) method passes the data between the computer and the device.</span></span> <span data-ttu-id="fbd19-114">Para conocer la dirección de la transferencia de datos, la aplicación debe establecer una marca cuando Windows Media Administrador de dispositivos llama a [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) o [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span><span class="sxs-lookup"><span data-stu-id="fbd19-114">To know the direction of the data transfer, your application must set a flag when Windows Media Device Manager calls [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) or [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span></span> <span data-ttu-id="fbd19-115">Cuando se llama al método [**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) , la aplicación debe restablecer esta marca.</span><span class="sxs-lookup"><span data-stu-id="fbd19-115">When the [**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) method is called, the application should reset this flag.</span></span>

> [!Note]  
> <span data-ttu-id="fbd19-116">Si el proveedor de servicios y el dispositivo implementan correctamente [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), primero llamará al método [IWMDMOperation3:: TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) de la aplicación, si se implementa.</span><span class="sxs-lookup"><span data-stu-id="fbd19-116">If the service provider and device properly implement [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), it will first call the application's [IWMDMOperation3::TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) method, if implemented.</span></span> <span data-ttu-id="fbd19-117">Este método es una manera más eficaz de transferir datos.</span><span class="sxs-lookup"><span data-stu-id="fbd19-117">This method is a more efficient way of transferring data.</span></span> <span data-ttu-id="fbd19-118">**TransferObjectDataOnClearChannel** se controla de la misma manera que **TransferObjectData**, salvo que los datos nunca se cifran y no tienen valores Mac para comprobar.</span><span class="sxs-lookup"><span data-stu-id="fbd19-118">**TransferObjectDataOnClearChannel** is handled the same way as **TransferObjectData**, except that the data is never encrypted and has no MAC values to verify.</span></span>

 

<span data-ttu-id="fbd19-119">En las secciones siguientes se describe el proceso de lectura y escritura, cuando la aplicación implementa **IWMDMOperation**.</span><span class="sxs-lookup"><span data-stu-id="fbd19-119">The following sections describe both the reading and the writing process, when your application implements **IWMDMOperation**.</span></span>

<span data-ttu-id="fbd19-120">**Leer desde un dispositivo**</span><span class="sxs-lookup"><span data-stu-id="fbd19-120">**Reading from a device**</span></span>

<span data-ttu-id="fbd19-121">Al leer un archivo desde un dispositivo, Windows Media Administrador de dispositivos llama a los siguientes métodos **IWMDMOperation** en orden:</span><span class="sxs-lookup"><span data-stu-id="fbd19-121">When reading a file from a device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="fbd19-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Se llama para notificar a la aplicación que se está iniciando una lectura desde el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Called to notify the application that a read from device is beginning.</span></span>
-   <span data-ttu-id="fbd19-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Se llama una o varias veces.</span><span class="sxs-lookup"><span data-stu-id="fbd19-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="fbd19-124">El procesamiento de datos se describe en los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="fbd19-124">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="fbd19-125">**TransferObjectData** recibe un búfer, *pdata*, de tamaño *pdwSize* bytes, rellenado con datos y un equipo Mac para comprobar los datos entrantes.</span><span class="sxs-lookup"><span data-stu-id="fbd19-125">**TransferObjectData** receives a buffer, *pData*, of size *pdwSize* bytes, filled with data, and a MAC to verify the incoming data.</span></span>
    2.  <span data-ttu-id="fbd19-126">La aplicación comprueba los parámetros entrantes con el equipo MAC de datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="fbd19-126">The application verifies the incoming parameters with the incoming data MAC.</span></span>
    3.  <span data-ttu-id="fbd19-127">La aplicación descifra y Lee todos los datos de *pdata* como sea posible, y modifica el valor devuelto de *pdwSize* para indicar el número de bytes que se leyeron realmente.</span><span class="sxs-lookup"><span data-stu-id="fbd19-127">The application decrypts and reads as much of the data in *pData* as it can, and modifies the returned value of *pdwSize* to indicate how many bytes were actually read.</span></span>
    4.  <span data-ttu-id="fbd19-128">La aplicación descifra los datos mediante [**CSecureChannelClient::D ecryptparam**](/previous-versions/bb231586(v=vs.85))y los almacena o los usa, según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="fbd19-128">The application decrypts the data, using [**CSecureChannelClient::DecryptParam**](/previous-versions/bb231586(v=vs.85)), and stores it or uses it, as needed.</span></span>
    5.  <span data-ttu-id="fbd19-129">**TransferObjectData** devuelve S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="fbd19-129">**TransferObjectData** returns S\_OK.</span></span>
    6.  <span data-ttu-id="fbd19-130">Windows Media Administrador de dispositivos sigue llamando a **TransferObjectData** hasta que la aplicación haya leído todos los datos del archivo o la aplicación devuelva el \_ usuario de WMDM e \_ \_ cancelado para cancelar la operación (en cuyo caso se cancela la lectura y Windows Media administrador de dispositivos llama a **End**).</span><span class="sxs-lookup"><span data-stu-id="fbd19-130">Windows Media Device Manager continues to call **TransferObjectData** until the application has read all the data from the file, or the application returns WMDM\_E\_USER\_CANCELLED to cancel the operation (in which case the read is canceled, and Windows Media Device Manager calls **End**).</span></span>
-   <span data-ttu-id="fbd19-131">[**Fin**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) de Se llama para notificar a la aplicación que está finalizando una lectura desde el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-131">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify the application that a read from device is ending.</span></span>

<span data-ttu-id="fbd19-132">**Escribir en un dispositivo**</span><span class="sxs-lookup"><span data-stu-id="fbd19-132">**Writing to a device**</span></span>

<span data-ttu-id="fbd19-133">Al escribir un archivo en el dispositivo, Windows Media Administrador de dispositivos llama a los siguientes métodos **IWMDMOperation** en orden:</span><span class="sxs-lookup"><span data-stu-id="fbd19-133">When writing a file to the device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="fbd19-134">[**GetObjectName**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Se llama para permitir que la aplicación especifique un nombre para el nuevo almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="fbd19-134">[**GetObjectName**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Called to allow the application to specify a name for the new storage.</span></span> <span data-ttu-id="fbd19-135">Solo se llama a este método si la aplicación no especificó un nombre en el método de **inserción** .</span><span class="sxs-lookup"><span data-stu-id="fbd19-135">This method is only called if the application did not specify a name in the **Insert** method.</span></span>
-   <span data-ttu-id="fbd19-136">[**GetObjectAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Se llama para permitir que la aplicación especifique atributos para el nuevo almacenamiento en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-136">[**GetObjectAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Called to allow the application to specify attributes for the new storage on the device.</span></span>
-   <span data-ttu-id="fbd19-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Se llama para notificar que se está iniciando una escritura en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Called to notify that that a write to device is beginning.</span></span>
-   <span data-ttu-id="fbd19-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Se llama para recuperar el tamaño total del objeto que se está escribiendo en el dispositivo, para habilitar la optimización de la transferencia y también para proporcionar a Windows Media Administrador de dispositivos la oportunidad de cancelar la transferencia si el archivo es demasiado grande para el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fbd19-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Called to retrieve the total size of the object being written to the device, to enable optimization of the transfer, and also to give Windows Media Device Manager an opportunity to cancel the transfer if the file is too large for the device.</span></span>
-   <span data-ttu-id="fbd19-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Se llama una o varias veces.</span><span class="sxs-lookup"><span data-stu-id="fbd19-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="fbd19-140">El procesamiento de datos se describe en los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="fbd19-140">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="fbd19-141">**TransferObjectData** recibe un puntero a un búfer de tamaño *pdwSize* bytes.</span><span class="sxs-lookup"><span data-stu-id="fbd19-141">**TransferObjectData** receives a pointer to a buffer of size *pdwSize* bytes.</span></span>
    2.  <span data-ttu-id="fbd19-142">La aplicación obtiene un bloque de datos que se envía al dispositivo, normalmente mediante la lectura de datos de un archivo y rellena el búfer recibido con un máximo de *pdwSize* bytes.</span><span class="sxs-lookup"><span data-stu-id="fbd19-142">The application gets a block of data to send to the device, usually by reading data from a file, and fills the received buffer with up to *pdwSize* bytes.</span></span> <span data-ttu-id="fbd19-143">Debe modificar *pdwSize* (si es necesario) para reflejar el número de bytes que se agregaron al búfer.</span><span class="sxs-lookup"><span data-stu-id="fbd19-143">It should modify *pdwSize* (if necessary) to reflect how many bytes were added to the buffer.</span></span>
    3.  <span data-ttu-id="fbd19-144">La aplicación crea un equipo MAC con todos los parámetros de método.</span><span class="sxs-lookup"><span data-stu-id="fbd19-144">The application creates a MAC of all the method parameters.</span></span>
    4.  <span data-ttu-id="fbd19-145">La aplicación cifra los datos en el búfer mediante [**CSecureChannelClient:: EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="fbd19-145">The application encrypts the data in the buffer, using [**CSecureChannelClient::EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span></span>
    5.  <span data-ttu-id="fbd19-146">**TransferObjectData** devuelve S \_ OK para indicar que hay más datos o s \_ false para indicar que no hay más datos.</span><span class="sxs-lookup"><span data-stu-id="fbd19-146">**TransferObjectData** returns S\_OK to indicate that there is more data, or S\_FALSE to indicate that there is no more data.</span></span> <span data-ttu-id="fbd19-147">Si la aplicación devuelve el \_ usuario de WMDM e \_ \_ cancelado, la operación de escritura se cancela y Windows Media administrador de dispositivos llamará a **End**.</span><span class="sxs-lookup"><span data-stu-id="fbd19-147">If the application returns WMDM\_E\_USER\_CANCELLED, the write operation is canceled and Windows Media Device Manager will call **End**.</span></span>
    6.  <span data-ttu-id="fbd19-148">Windows Media Administrador de dispositivos sigue llamando a **TransferObjectData** siempre y cuando la aplicación devuelva el valor \_ correcto.</span><span class="sxs-lookup"><span data-stu-id="fbd19-148">Windows Media Device Manager continues to call **TransferObjectData** as long as the application returns S\_OK.</span></span>
-   <span data-ttu-id="fbd19-149">[**Fin**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) de Se llama para notificar que una escritura en el dispositivo está finalizando.</span><span class="sxs-lookup"><span data-stu-id="fbd19-149">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify that a write to device is ending.</span></span>

<span data-ttu-id="fbd19-150">Para obtener un ejemplo de código, vea [cifrado y descifrado](encryption-and-decryption.md).</span><span class="sxs-lookup"><span data-stu-id="fbd19-150">For a code example, see [Encryption and Decryption](encryption-and-decryption.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="fbd19-151">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="fbd19-151">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fbd19-152">**Crear una aplicación de Windows Media Administrador de dispositivos**</span><span class="sxs-lookup"><span data-stu-id="fbd19-152">**Creating a Windows Media Device Manager Application**</span></span>](creating-a-windows-media-device-manager-application.md)
</dt> </dl>

 

 