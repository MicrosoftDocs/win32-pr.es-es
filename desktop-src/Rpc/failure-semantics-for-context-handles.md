---
title: Semántica de errores para los identificadores de contexto
description: En este tema se describe la semántica de errores para los identificadores de contexto.
ms.assetid: fcf28519-39ad-4823-bc27-f3502e4d540c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c4528b3f5160b92a4e6f10dbcf877e9fec59f81b
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "104075785"
---
# <a name="failure-semantics-for-context-handles"></a><span data-ttu-id="8da5d-103">Semántica de errores para los identificadores de contexto</span><span class="sxs-lookup"><span data-stu-id="8da5d-103">Failure Semantics for Context Handles</span></span>

<span data-ttu-id="8da5d-104">En este tema se describe la semántica de errores para los identificadores de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-104">This topic discusses failure semantics for context handles.</span></span>

## <a name="failure-semantics-when-closing-the-context-handle-fails"></a><span data-ttu-id="8da5d-105">Se produce un error en la semántica de errores al cerrar el identificador de contexto</span><span class="sxs-lookup"><span data-stu-id="8da5d-105">Failure Semantics when Closing the Context Handle Fails</span></span>

<span data-ttu-id="8da5d-106">Imagine que una aplicación cliente está intentando cerrar un identificador de contexto abierto en el servidor sin cerrar el proceso de cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-106">Imagine a client application is attempting to close a context handle it opened on the server, without shutting down the client process.</span></span> <span data-ttu-id="8da5d-107">Además, supongamos que se produce un error en la llamada al servidor para cerrar el identificador de contexto (por ejemplo, el cliente no tiene memoria suficiente).</span><span class="sxs-lookup"><span data-stu-id="8da5d-107">Also, assume the call to the server to close the context handle fails (for example, the client is out of memory).</span></span> <span data-ttu-id="8da5d-108">La manera adecuada de controlar esta situación es llamar a la función [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) .</span><span class="sxs-lookup"><span data-stu-id="8da5d-108">The proper way to handle this situation is to call the [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) function.</span></span> <span data-ttu-id="8da5d-109">En tal caso, el cliente limpia su lado del identificador de contexto y abortively cierra la conexión al servidor.</span><span class="sxs-lookup"><span data-stu-id="8da5d-109">In such a case the client cleans up its side of the context handle, and abortively closes the connection to the server.</span></span> <span data-ttu-id="8da5d-110">Dado que la conexión es realmente un grupo de conexiones (vea [RPC y la red](rpc-and-the-network.md)), que se cuenta con una referencia para cada identificador de enlace o contexto abierto, la destrucción del identificador de contexto mediante una llamada a la función **RpcSsDestroyClientContext** no destruye realmente la conexión.</span><span class="sxs-lookup"><span data-stu-id="8da5d-110">Since the connection is really a connection pool (see [RPC and the Network](rpc-and-the-network.md)), which is reference-counted with one reference for each opened binding or context handle, destroying the context handle by calling the **RpcSsDestroyClientContext** function does not actually destroy the connection.</span></span> <span data-ttu-id="8da5d-111">En su lugar, disminuye el recuento de referencias del grupo de conexiones.</span><span class="sxs-lookup"><span data-stu-id="8da5d-111">Rather, it decrements the reference count for the connection pool.</span></span> <span data-ttu-id="8da5d-112">En el caso de las conexiones del grupo que se van a cerrar, el cliente debe cerrar todos los identificadores de enlace y los identificadores de contexto para ese servidor desde el proceso del cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-112">For connections in the pool to be closed, the client needs to close all binding handles and context handles to that server from the client process.</span></span> <span data-ttu-id="8da5d-113">A continuación, se cierran todas las conexiones del grupo y se inicia el mecanismo de ejecución del servidor y se limpia.</span><span class="sxs-lookup"><span data-stu-id="8da5d-113">Then all connections in the pool are closed, and the server run-down mechanism is initiated and cleans up.</span></span>

## <a name="failure-semantics-during-change-of-state-of-the-context-handle"></a><span data-ttu-id="8da5d-114">Semántica de errores durante el cambio de estado del identificador de contexto</span><span class="sxs-lookup"><span data-stu-id="8da5d-114">Failure Semantics During Change of State of the Context Handle</span></span>

<span data-ttu-id="8da5d-115">La información de esta sección se refiere a Windows XP y plataformas posteriores.</span><span class="sxs-lookup"><span data-stu-id="8da5d-115">The information in this section refers to Windows XP and later platforms.</span></span>

<span data-ttu-id="8da5d-116">Los identificadores de contexto son simplemente parámetros para una función.</span><span class="sxs-lookup"><span data-stu-id="8da5d-116">Context handles are simply parameters to a function.</span></span> <span data-ttu-id="8da5d-117">Todos los cambios en el estado de un identificador de contexto se producen cuando se calculan las referencias de los parámetros o se anula su serialización.</span><span class="sxs-lookup"><span data-stu-id="8da5d-117">All changes in the state of a context handle happen when parameters are marshaled or unmarshaled.</span></span> <span data-ttu-id="8da5d-118">Por ejemplo, si un cliente abre un identificador de contexto (lo cambia de **null** a un **valor** distinto de NULL), el tiempo de ejecución de RPC no abre realmente la parte de RPC del identificador hasta que se calculan las referencias de los argumentos para enviarlos al cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-118">For example, if a client opens a context handle (changes it from **NULL** to non-**NULL**), the RPC run-time does not actually open the RPC portion of the handle until the arguments are marshaled for sending to the client.</span></span> <span data-ttu-id="8da5d-119">Los errores se pueden producir durante el tiempo provisional.</span><span class="sxs-lookup"><span data-stu-id="8da5d-119">Failures can occur during the interim.</span></span> <span data-ttu-id="8da5d-120">Debido a una serie de condiciones de red o de recursos insuficientes posibles, se podría producir un error en la transmisión del paquete al cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-120">Due to a variety of possible network or low resource conditions, transmission of the packet to the client could fail.</span></span> <span data-ttu-id="8da5d-121">O la rutina del servidor puede producir una excepción al intentar cambiar un identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-121">Or the server routine may throw an exception while attempting to change a context handle.</span></span> <span data-ttu-id="8da5d-122">En estas situaciones de error, el cliente y el servidor pueden obtener vistas incoherentes del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-122">In these or other failure situations, the client and server may get inconsistent views of the context handle.</span></span> <span data-ttu-id="8da5d-123">En esta sección se explica la regla para el estado del identificador de contexto y la responsabilidad del código de cliente y servidor durante varias condiciones de error.</span><span class="sxs-lookup"><span data-stu-id="8da5d-123">This section explains the rule for the state of the context handle, and the responsibility of client and server code during various failure conditions.</span></span>

-   <span data-ttu-id="8da5d-124">Llega un identificador de contexto **nulo** , pero la rutina de servidor encuentra un error y produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="8da5d-124">A **NULL** context handle arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="8da5d-125">Es responsabilidad de la rutina del servidor limpiar cualquier estado relacionado con el identificador de contexto que haya creado.</span><span class="sxs-lookup"><span data-stu-id="8da5d-125">It is the responsibility of the server routine to clean up any context handle–related state it may have created.</span></span> <span data-ttu-id="8da5d-126">El tiempo de ejecución de RPC limpia su estado.</span><span class="sxs-lookup"><span data-stu-id="8da5d-126">The RPC run time cleans up its state.</span></span>

-   <span data-ttu-id="8da5d-127">Los identificadores de contexto que no son **null** llegan, pero la rutina de servidor encuentra un error y produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="8da5d-127">A non-**NULL** context handles arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="8da5d-128">Si la rutina de servidor cerró el identificador de contexto, el cliente no lo sabrá, ya que la llamada no se realizará correctamente. el uso adicional del identificador de contexto producirá un error de falta de coincidencia de contexto de RPC \_ X \_ SS \_ \_ en el cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-128">If the server routine closed the context handle, the client will not know about it, since the call will not succeed; further use of the context handle will result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span> <span data-ttu-id="8da5d-129">Si la rutina del servidor no modifica el identificador de contexto, el cliente todavía puede usarlo.</span><span class="sxs-lookup"><span data-stu-id="8da5d-129">If the server routine does not modify the context handle, the client can still use it.</span></span> <span data-ttu-id="8da5d-130">Si la rutina del servidor cambia la información almacenada en el contexto del servidor, las nuevas llamadas del cliente usarán esa información.</span><span class="sxs-lookup"><span data-stu-id="8da5d-130">If the server routine changes the information stored in the server context, new calls from the client will use that information.</span></span>

-   <span data-ttu-id="8da5d-131">Llega un identificador de contexto que no **es null** y la rutina de servidor cierra el identificador, pero se ha producido un error en el cálculo de referencias después del identificador de contexto, o bien el procesamiento después del cálculo de referencias.</span><span class="sxs-lookup"><span data-stu-id="8da5d-131">A non-**NULL** context handle arrives, and the server routine closes the handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="8da5d-132">El identificador de contexto está cerrado y otras llamadas realizadas por este cliente con este identificador de contexto provocan \_ un \_ error de falta de coincidencia de contexto de RPC X SS \_ \_ en el cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-132">The context handle is closed, and further calls by this client using this context handle result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span>

-   <span data-ttu-id="8da5d-133">Llega un identificador de contexto **nulo** y el servidor crea su contexto para este identificador, pero se ha producido un error en el cálculo de referencias después del identificador de contexto o el procesamiento después del cálculo de referencias.</span><span class="sxs-lookup"><span data-stu-id="8da5d-133">A **NULL** context handle arrives, and the server creates its context for this handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="8da5d-134">En este caso, el tiempo de ejecución de RPC invoca el estado de ejecución para este identificador de contexto y limpia el estado de RPC para este identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-134">In this case, the RPC run time invokes the run down for this context handle, and cleans up the RPC state for this context handle.</span></span> <span data-ttu-id="8da5d-135">El identificador de contexto no se creará en el lado cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-135">The context handle will not be created on the client side.</span></span>

-   <span data-ttu-id="8da5d-136">Llega un identificador de contexto que no **es null** y el servidor no cambia el identificador de contexto, o bien cambia la información almacenada en el contexto del servidor y se produce un error en el cálculo de referencias después de calcular las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-136">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails after the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-137">Las nuevas llamadas del cliente usarán el identificador de contexto que tenga el servidor.</span><span class="sxs-lookup"><span data-stu-id="8da5d-137">New calls from the client will use the context handle that the server has.</span></span>

-   <span data-ttu-id="8da5d-138">Llega un identificador de contexto **nulo** y el servidor no lo establece en un valor distinto de **null**, pero se produce un error en la llamada antes de que se calculen las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-138">A **NULL** context handle arrives, and the server does not set it to anything other than **NULL**, but the call fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-139">En este caso, no se crea ningún identificador de contexto en el cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-139">In this case, no context handle is created on the client.</span></span>

-   <span data-ttu-id="8da5d-140">Llega un identificador de contexto que no **es null** y el servidor lo establece en **null**, pero se produce un error en el cálculo de referencias antes de que se calculen las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-140">A non-**NULL** context handle arrives, and the server sets it to **NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-141">En este caso, el identificador de contexto permanece cerrado en el servidor y el cliente obtiene errores de falta de coincidencia de contexto de RPC \_ X \_ SS \_ \_ al intentar usar el identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-141">In this case, the context handle remains closed on the server, and the client gets RPC\_X\_SS\_CONTEXT\_MISMATCH errors when it tries to use the context handle.</span></span>

-   <span data-ttu-id="8da5d-142">Un identificador de contexto **nulo** llega al servidor y el servidor lo establece en un valor distinto de **null**, pero se produce un error en el cálculo de referencias antes de que se calculen las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-142">A **NULL** context handle arrives on the server, and the server sets it to non-**NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-143">Se debe invocar la ejecución del identificador de contexto para que el servidor pueda realizar la limpieza, y no se creará ningún identificador de contexto en el cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-143">The context handle run down is to be invoked so that the server can clean up, and no context handle will be created on the client.</span></span>

-   <span data-ttu-id="8da5d-144">Llega un identificador de contexto que no **es null** y el servidor no cambia el identificador de contexto, o bien cambia la información almacenada en el contexto del servidor, y se produce un error en el cálculo de referencias antes de que se calculen las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-144">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-145">Las nuevas llamadas del cliente usarán el estado en el servidor.</span><span class="sxs-lookup"><span data-stu-id="8da5d-145">New calls from the client will use the state on the server.</span></span>

-   <span data-ttu-id="8da5d-146">Un identificador de contexto se declara como un valor devuelto y la rutina del servidor devuelve **null** para el identificador de contexto y se produce un error en el cálculo de referencias antes de que se calculen las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-146">A context handle is declared as a return value, and the server routine returns **NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-147">En este caso, no se crea ningún contexto nuevo en el cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-147">In this case, no new context is created on the client.</span></span>

-   <span data-ttu-id="8da5d-148">Un identificador de contexto se declara como un valor devuelto y la rutina del servidor devuelve un valor distinto de **null** para el identificador de contexto y se produce un error en el cálculo de referencias antes de que se calculen las referencias del identificador de contexto.</span><span class="sxs-lookup"><span data-stu-id="8da5d-148">A context handle is declared as a return value, and the server routine returns non-**NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="8da5d-149">El tiempo de ejecución de RPC llama a la rutina de ejecución del identificador de contexto para darle la oportunidad de limpiar y no se crea ningún contexto nuevo en el cliente.</span><span class="sxs-lookup"><span data-stu-id="8da5d-149">The RPC run time calls the context handle run-down routine to give it a chance to clean up, and no new context is created on the client.</span></span>

 

 




