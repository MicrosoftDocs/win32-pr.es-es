---
description: En Windows 7, las API de plataforma de alto nivel que usan las API de audio principales, como las API de Media Foundation, DirectSound y Wave, implementan la característica de enrutamiento de flujo mediante la administración del cambio de secuencia desde un dispositivo existente a un nuevo punto de conexión de audio predeterminado.
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: Notificaciones relevantes para el enrutamiento de flujos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef3d253ce2ec5d6e3bef025a33233a9d377ca44b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104153134"
---
# <a name="relevant-notifications-for-stream-routing"></a><span data-ttu-id="8c089-103">Notificaciones relevantes para el enrutamiento de flujos</span><span class="sxs-lookup"><span data-stu-id="8c089-103">Relevant Notifications for Stream Routing</span></span>

<span data-ttu-id="8c089-104">En Windows 7, las API de plataforma de alto nivel que usan las API de audio principales, como las API de Media Foundation, DirectSound y Wave, implementan la característica de enrutamiento de flujo mediante la administración del cambio de secuencia desde un dispositivo existente a un nuevo punto de conexión de audio predeterminado.</span><span class="sxs-lookup"><span data-stu-id="8c089-104">In Windows 7, high-level platform APIs that use Core Audio APIs, such as Media Foundation, DirectSound, and Wave APIs, implement the stream routing feature by handling stream switching from an existing device to a new default audio endpoint.</span></span> <span data-ttu-id="8c089-105">Las aplicaciones multimedia que usan estas API usan el comportamiento de enrutamiento de flujo sin modificaciones en el origen.</span><span class="sxs-lookup"><span data-stu-id="8c089-105">Media applications that use these APIs use the stream routing behavior without any modifications to the source.</span></span> <span data-ttu-id="8c089-106">Los clientes de WASAPI directos pueden usar las notificaciones enviadas por componentes de audio principales e implementar la característica de enrutamiento de flujo.</span><span class="sxs-lookup"><span data-stu-id="8c089-106">Direct WASAPI clients can use the notifications sent by Core Audio components and implement the stream routing feature.</span></span>

<span data-ttu-id="8c089-107">Para implementar la característica de enrutamiento de secuencias, un cliente debe escuchar dos tipos de eventos: notificaciones de cambio de dispositivo y notificaciones de desconexión de sesión.</span><span class="sxs-lookup"><span data-stu-id="8c089-107">To implement the stream routing feature, a client must listen for two types of events: device change notifications and session disconnect notifications.</span></span> <span data-ttu-id="8c089-108">En la implementación proporcionada por las API de alto nivel, estos eventos se envían para los puntos de conexión de dispositivo predeterminados creados mediante una llamada a [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="8c089-108">In the implementation provided by the high-level APIs, these events are sent for default device endpoints created by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="8c089-109">Para obtener más información, consulte [obtención del punto de conexión del dispositivo para el enrutamiento de transmisiones](getting-the-default-device-endpoint-for-stream-routing.md).</span><span class="sxs-lookup"><span data-stu-id="8c089-109">For more information, see [Getting the Device Endpoint for Stream Routing](getting-the-default-device-endpoint-for-stream-routing.md).</span></span>

<span data-ttu-id="8c089-110">El componente Core Audio MMDeviceAPI entrega devoluciones de llamada de notificación cuando se agregan, quitan o modifican dispositivos de audio.</span><span class="sxs-lookup"><span data-stu-id="8c089-110">The Core Audio component MMDeviceAPI delivers notification callbacks when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="8c089-111">Los cambios de formato y sesión de audio se informan como eventos a través de WASAPI.</span><span class="sxs-lookup"><span data-stu-id="8c089-111">The format and audio session changes are reported as events through WASAPI.</span></span>

## <a name="device-change-notifications"></a><span data-ttu-id="8c089-112">Notificaciones de cambio de dispositivo</span><span class="sxs-lookup"><span data-stu-id="8c089-112">Device Change Notifications</span></span>

<span data-ttu-id="8c089-113">MMDeviceAPI genera eventos cuando se agregan, quitan o modifican dispositivos de audio.</span><span class="sxs-lookup"><span data-stu-id="8c089-113">MMDeviceAPI raises events when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="8c089-114">Si el cliente va a proporcionar la funcionalidad de enrutamiento de secuencias, debe implementar la interfaz [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) y registrar su implementación con MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="8c089-114">If the client is to provide stream routing functionality, it must implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface and register its implementation with MMDeviceAPI.</span></span>

<span data-ttu-id="8c089-115">Para obtener notificaciones de cambios de dispositivo, el cliente debe realizar las siguientes tareas:</span><span class="sxs-lookup"><span data-stu-id="8c089-115">To get device change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="8c089-116">Implemente la interfaz [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) para controlar las notificaciones de cambio de dispositivo enviadas por MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="8c089-116">Implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface to handle device change notifications sent by MMDeviceAPI.</span></span>
-   <span data-ttu-id="8c089-117">Registre la implementación de [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) con MMDeviceAPI llamando al método [**IMMDeviceEnumerator:: RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) .</span><span class="sxs-lookup"><span data-stu-id="8c089-117">Register the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) implementation with MMDeviceAPI by calling the [**IMMDeviceEnumerator::RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) method.</span></span>

<span data-ttu-id="8c089-118">Una vez registrada la implementación del cliente de estas interfaces, el cliente recibe notificaciones en forma de devoluciones de llamada a través de los métodos de estas interfaces.</span><span class="sxs-lookup"><span data-stu-id="8c089-118">After the client's implementation of these interfaces is registered, the client receives notifications in the form of callbacks through the methods of these interfaces.</span></span> <span data-ttu-id="8c089-119">MMDeviceAPI llama a los métodos [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) cuando genera eventos de nivel de extremo (cambios de estado del punto de conexión, nuevas llegadas del punto de conexión, eliminaciones del punto de conexión, cambios de punto de conexión predeterminados y cambios en las propiedades del punto de conexión).</span><span class="sxs-lookup"><span data-stu-id="8c089-119">[**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) methods are called by MMDeviceAPI when it raises endpoint-level events (endpoint state changes, new endpoint arrivals, endpoint deletions, default endpoint changes, and endpoint property changes).</span></span>

<span data-ttu-id="8c089-120">Si el cliente desea proporcionar enrutamiento de flujo para el dispositivo predeterminado, el cliente debe implementar el comportamiento de cambio del dispositivo cuando recibe la notificación a través de la devolución de llamada [**IMMNotificationClient:: OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) .</span><span class="sxs-lookup"><span data-stu-id="8c089-120">If the client wants to provide stream routing for the default device, the client must implement the device change behavior when it receives the notification through the [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) callback.</span></span>

## <a name="audio-session-change-notifications"></a><span data-ttu-id="8c089-121">Notificaciones de cambio de sesión de audio</span><span class="sxs-lookup"><span data-stu-id="8c089-121">Audio Session Change Notifications</span></span>

<span data-ttu-id="8c089-122">Los cambios en la sesión de audio y los cambios de formato se muestran como eventos de sesión de audio a través de WASAPI.</span><span class="sxs-lookup"><span data-stu-id="8c089-122">Audio session changes and format changes are reported as audio session events through WASAPI.</span></span> <span data-ttu-id="8c089-123">Un cliente de WASAPI implementa la interfaz [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) y registra la implementación con WASAPI.</span><span class="sxs-lookup"><span data-stu-id="8c089-123">A WASAPI client implements the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the implementation with WASAPI.</span></span>

<span data-ttu-id="8c089-124">Para obtener las notificaciones de cambio de la sesión de audio, el cliente debe realizar las siguientes tareas:</span><span class="sxs-lookup"><span data-stu-id="8c089-124">To get audio session change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="8c089-125">Implemente la interfaz [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) para controlar las notificaciones de cambio de formato enviadas por WASAPI.</span><span class="sxs-lookup"><span data-stu-id="8c089-125">Implement the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface to handle format change notifications sent by WASAPI.</span></span>
-   <span data-ttu-id="8c089-126">Registre la implementación de [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) con WASAPI llamando al método [**IAudioSessionControl:: RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) .</span><span class="sxs-lookup"><span data-stu-id="8c089-126">Register the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) implementation with WASAPI by calling the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method.</span></span>

<span data-ttu-id="8c089-127">WASAPI llama a los métodos [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) cuando se producen cambios en la sesión de audio.</span><span class="sxs-lookup"><span data-stu-id="8c089-127">[**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) methods are called by WASAPI when audio session changes occur.</span></span> <span data-ttu-id="8c089-128">Estos eventos se generan cuando se cambia el nombre para mostrar de la sesión, la ruta de acceso del icono, el volumen, el parámetro de agrupación o el estado.</span><span class="sxs-lookup"><span data-stu-id="8c089-128">These events are raised when the session's display name, icon path, volume, grouping parameter, or state changes.</span></span>

<span data-ttu-id="8c089-129">Para implementar la característica de enrutamiento de secuencias, el cliente debe esperar la notificación de desconexión de sesión.</span><span class="sxs-lookup"><span data-stu-id="8c089-129">To implement the stream routing feature, the client must wait for the session-disconnect notification.</span></span> <span data-ttu-id="8c089-130">Cuando se desconecta una sesión de audio o se cambia el formato de un dispositivo, WASAPI envía las notificaciones de cliente en forma de devoluciones de llamada a través de [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span><span class="sxs-lookup"><span data-stu-id="8c089-130">When an audio session is disconnected or a device's format is changed, WASAPI sends the client notifications in the form of callbacks through [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span></span> <span data-ttu-id="8c089-131">Con la notificación de desconexión, WASAPI también envía un valor que indica por qué se desconectó la sesión.</span><span class="sxs-lookup"><span data-stu-id="8c089-131">With the disconnection notification, WASAPI also sends a value that indicates why the session was disconnected.</span></span> <span data-ttu-id="8c089-132">Esto puede ocurrir por varios motivos, como el dispositivo se quitó, el servidor se detuvo, etc.</span><span class="sxs-lookup"><span data-stu-id="8c089-132">This can occur for several reasons, such as the device was removed, the server stopped, and so on.</span></span> <span data-ttu-id="8c089-133">Para obtener una lista completa de motivos, vea la enumeración **AudioSessionDisconnectReason** definida en AudioPolicy. h.</span><span class="sxs-lookup"><span data-stu-id="8c089-133">For the complete list of reasons, see the **AudioSessionDisconnectReason** enumeration defined in AudioPolicy.h.</span></span> <span data-ttu-id="8c089-134">Si el dispositivo predeterminado cambia, el cliente debe esperar las notificaciones (si aún no se han recibido) que están acompañadas de un valor de **DisconnectReasonDeviceRemoval** .</span><span class="sxs-lookup"><span data-stu-id="8c089-134">If the default device changes, the client must wait for the notifications (if they have not already been received) that are accompanied with a **DisconnectReasonDeviceRemoval** value.</span></span> <span data-ttu-id="8c089-135">En respuesta a estas notificaciones, es posible que el cliente vuelva a abrir la secuencia en el nuevo dispositivo predeterminado.</span><span class="sxs-lookup"><span data-stu-id="8c089-135">In response to such notifications, the client might reopen the stream on the new default device.</span></span>

<span data-ttu-id="8c089-136">Dado que todas estas operaciones son asincrónicas, no se puede predecir el orden en el que la aplicación recibe notificaciones.</span><span class="sxs-lookup"><span data-stu-id="8c089-136">Because all of these operations are asychronous, the order in which the application receives notifications cannnot be predicted.</span></span> <span data-ttu-id="8c089-137">Sin embargo, normalmente, la aplicación recibe el valor **AudioSessionDisconnect** antes de la notificación de cambio de dispositivo predeterminada.</span><span class="sxs-lookup"><span data-stu-id="8c089-137">However, typically, the application receives **AudioSessionDisconnect** value before the default device change notification.</span></span>

### <a name="format-change-notifications"></a><span data-ttu-id="8c089-138">Notificaciones de cambio de formato</span><span class="sxs-lookup"><span data-stu-id="8c089-138">Format Change Notifications</span></span>

<span data-ttu-id="8c089-139">Los cambios de formato de audio se producen cuando cambia el formato de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="8c089-139">Audio format changes occur when the format of the stream changes.</span></span> <span data-ttu-id="8c089-140">Esto puede ocurrir cuando el usuario selecciona un nuevo formato en el panel de control de **sonido** o el nuevo dispositivo predeterminado admite un nuevo formato (por ejemplo, HDMI o ciertas interfaces de audio profesional con un ajuste de velocidad de muestra manual).</span><span class="sxs-lookup"><span data-stu-id="8c089-140">This can occur when the user selects a new format in the **Sound** control panel or the new default device supports a new format (for example, HDMI or certain professional audio interfaces with a manual sample-rate adjustment).</span></span> <span data-ttu-id="8c089-141">Para notificar al cliente sobre estos tipos de cambios de formato, WASAPI envía una notificación de sesión por la implementación registrada de [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) con un motivo de desconexión de **DisconnectReasonFormatChanged**.</span><span class="sxs-lookup"><span data-stu-id="8c089-141">To notify the client about these types of format changes, WASAPI sends a session notification by the registered implementation of [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) with a disconnect reason of **DisconnectReasonFormatChanged**.</span></span> <span data-ttu-id="8c089-142">El cliente puede controlar la notificación si vuelve a abrir la secuencia en el nuevo formato.</span><span class="sxs-lookup"><span data-stu-id="8c089-142">The client can handle the notification by reopening the stream in the new format.</span></span>

## <a name="related-topics"></a><span data-ttu-id="8c089-143">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="8c089-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8c089-144">Acerca de la API de MMDevice</span><span class="sxs-lookup"><span data-stu-id="8c089-144">About MMDevice API</span></span>](mmdevice-api.md)
</dt> <dt>

[<span data-ttu-id="8c089-145">Acerca de WASAPI</span><span class="sxs-lookup"><span data-stu-id="8c089-145">About WASAPI</span></span>](wasapi.md)
</dt> <dt>

[<span data-ttu-id="8c089-146">Enrutamiento de flujos</span><span class="sxs-lookup"><span data-stu-id="8c089-146">Stream Routing</span></span>](stream-routing.md)
</dt> </dl>

 

 



