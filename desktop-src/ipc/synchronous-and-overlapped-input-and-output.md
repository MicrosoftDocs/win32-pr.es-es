---
description: E/s de canalización sincrónica y e/s de canalización asincrónica. Las funciones ReadFile, WriteFile, TransactNamedPipe y ConnectNamedPipe pueden realizar operaciones de entrada y salida en una canalización de forma sincrónica o asincrónica.
ms.assetid: 5ab9bb7f-1f99-4041-bba8-2863f34dbcaf
title: E/s de canalización sincrónica y superpuesta
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3becfb19dfe5fa49d4121246a576fb3200226b1a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105697709"
---
# <a name="synchronous-and-overlapped-pipe-io"></a><span data-ttu-id="fb9f3-104">E/s de canalización sincrónica y superpuesta</span><span class="sxs-lookup"><span data-stu-id="fb9f3-104">Synchronous and Overlapped Pipe I/O</span></span>

<span data-ttu-id="fb9f3-105">Las funciones [**readfile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)y [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) pueden realizar operaciones de entrada y salida en una canalización de forma sincrónica o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-105">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions can perform input and output operations on a pipe either synchronously or asynchronously.</span></span> <span data-ttu-id="fb9f3-106">Cuando una función se ejecuta sincrónicamente, no devuelve ningún resultado hasta que se completa la operación que está realizando.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-106">When a function runs synchronously, it does not return until the operation it is performing is completed.</span></span> <span data-ttu-id="fb9f3-107">Esto significa que la ejecución del subproceso que realiza la llamada puede bloquearse durante un período indefinido mientras espera a que se complete una operación que consume mucho tiempo.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-107">This means that the execution of the calling thread can be blocked for an indefinite period while it waits for a time-consuming operation to be completed.</span></span> <span data-ttu-id="fb9f3-108">Cuando una función se ejecuta de forma asincrónica, se devuelve inmediatamente, incluso si no se ha completado la operación.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-108">When a function runs asynchronously, it returns immediately, even if the operation has not been completed.</span></span> <span data-ttu-id="fb9f3-109">Esto permite que una operación que consume mucho tiempo se ejecute en segundo plano, mientras que el subproceso que realiza la llamada puede realizar otras tareas de forma gratuita.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-109">This enables a time-consuming operation to be executed in the background while the calling thread is free to perform other tasks.</span></span>

<span data-ttu-id="fb9f3-110">El uso de e/s asincrónica permite que un servidor de canalización use un bucle que realice los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="fb9f3-110">Using asynchronous I/O enables a pipe server to use a loop that performs the following steps:</span></span>

1.  <span data-ttu-id="fb9f3-111">Especifique varios objetos de evento en una llamada a la función wait y espere a que uno de los objetos se establezca en el estado señalado.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-111">Specify multiple event objects in a call to the wait function, and wait for one of the objects to be set to the signaled state.</span></span>
2.  <span data-ttu-id="fb9f3-112">Use el valor devuelto de la función wait para determinar qué operación superpuesta ha finalizado.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-112">Use the wait function's return value to determine which overlapped operation has finished.</span></span>
3.  <span data-ttu-id="fb9f3-113">Realice las tareas necesarias para limpiar la operación completada e iniciar la siguiente operación para ese identificador de canalización.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-113">Perform the tasks necessary to clean up the completed operation and initiate the next operation for that pipe handle.</span></span> <span data-ttu-id="fb9f3-114">Esto puede implicar el inicio de otra operación superpuesta para el mismo identificador de canalización.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-114">This can involve starting another overlapped operation for the same pipe handle.</span></span>

<span data-ttu-id="fb9f3-115">Las operaciones superpuestas permiten que una canalización Lea y escriba datos simultáneamente, y que un solo subproceso realice operaciones de e/s simultáneas en varios identificadores de canalización.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-115">Overlapped operations make it possible for one pipe to read and write data simultaneously and for a single thread to perform simultaneous I/O operations on multiple pipe handles.</span></span> <span data-ttu-id="fb9f3-116">Esto permite que un servidor de canalización de un solo subproceso controle de forma eficaz las comunicaciones con varios clientes de canalización.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-116">This enables a single-threaded pipe server to handle communications with multiple pipe clients efficiently.</span></span> <span data-ttu-id="fb9f3-117">Para obtener un ejemplo, vea [servidor de canalización con nombre mediante e/s superpuesta](named-pipe-server-using-overlapped-i-o.md).</span><span class="sxs-lookup"><span data-stu-id="fb9f3-117">For an example, see [Named Pipe Server Using Overlapped I/O](named-pipe-server-using-overlapped-i-o.md).</span></span>

<span data-ttu-id="fb9f3-118">Para que un servidor de canalización use operaciones sincrónicas para comunicarse con más de un cliente, debe crear un subproceso independiente para cada cliente de canalización, de modo que se puedan ejecutar uno o más subprocesos mientras otros subprocesos están esperando.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-118">For a pipe server to use synchronous operations to communicate with more than one client, it must create a separate thread for each pipe client so that one or more threads can run while other threads are waiting.</span></span> <span data-ttu-id="fb9f3-119">Para obtener un ejemplo de un servidor de canalización multiproceso que usa operaciones sincrónicas, vea [servidor de canalización multiproceso](multithreaded-pipe-server.md).</span><span class="sxs-lookup"><span data-stu-id="fb9f3-119">For an example of a multithreaded pipe server that uses synchronous operations, see [Multithreaded Pipe Server](multithreaded-pipe-server.md).</span></span>

## <a name="enabling-asynchronous-operation"></a><span data-ttu-id="fb9f3-120">Habilitar la operación asincrónica</span><span class="sxs-lookup"><span data-stu-id="fb9f3-120">Enabling Asynchronous Operation</span></span>

<span data-ttu-id="fb9f3-121">Las funciones [**readfile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)y [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) solo se pueden realizar de forma asincrónica si se habilita el modo superpuesto para el identificador de canalización especificado y se especifica un puntero válido a una estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="fb9f3-121">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions can be performed asynchronously only if you enable overlapped mode for the specified pipe handle and specify a valid pointer to an [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="fb9f3-122">Si el puntero **SUPERpuesto** es **null**, el valor devuelto de la función puede indicar incorrectamente que se ha completado la operación.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-122">If the **OVERLAPPED** pointer is **NULL**, the function return value can incorrectly indicate that the operation has been completed.</span></span> <span data-ttu-id="fb9f3-123">Por lo tanto, se recomienda encarecidamente que, si crea un identificador con la marca de archivo \_ \_ superpuesto y desee el comportamiento asincrónico, siempre debe especificar una estructura **superpuesta** válida.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-123">Therefore, it is strongly recommended that if you create a handle with FILE\_FLAG\_OVERLAPPED and want asynchronous behavior, you should always specify a valid **OVERLAPPED** structure.</span></span>

<span data-ttu-id="fb9f3-124">El miembro **hEvent** de la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) especificada debe contener un identificador para un objeto de evento de restablecimiento manual.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-124">The **hEvent** member of the specified [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure must contain a handle to a manual-reset event object.</span></span> <span data-ttu-id="fb9f3-125">Se trata de un objeto de sincronización creado por la función [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa) .</span><span class="sxs-lookup"><span data-stu-id="fb9f3-125">This is a synchronization object created by the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa) function.</span></span> <span data-ttu-id="fb9f3-126">El subproceso que inicia la operación superpuesta utiliza el objeto de evento para determinar cuándo ha finalizado la operación.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-126">The thread that initiates the overlapped operation uses the event object to determine when the operation has finished.</span></span> <span data-ttu-id="fb9f3-127">No debe utilizar el controlador de canalización para la sincronización al realizar operaciones simultáneas en el mismo identificador porque no hay ninguna manera de saber la finalización de la operación que provocó la señalización del identificador de canalización.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-127">You should not use the pipe handle for synchronization when performing simultaneous operations on the same handle because there is no way of knowing which operation's completion caused the pipe handle to be signaled.</span></span> <span data-ttu-id="fb9f3-128">La única técnica confiable para realizar operaciones simultáneas en el mismo identificador de canalización es usar una estructura **superpuesta** independiente con su propio objeto de evento para cada operación.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-128">The only reliable technique for performing simultaneous operations on the same pipe handle is to use a separate **OVERLAPPED** structure with its own event object for each operation.</span></span> <span data-ttu-id="fb9f3-129">Para obtener más información acerca de los objetos de evento, consulte [Synchronization](/windows/desktop/Sync/synchronization).</span><span class="sxs-lookup"><span data-stu-id="fb9f3-129">For more information about event objects, see [Synchronization](/windows/desktop/Sync/synchronization).</span></span>

<span data-ttu-id="fb9f3-130">Además, se puede recibir una notificación cuando se complete una operación superpuesta mediante las funciones [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) o [**GetQueuedCompletionStatusEx**](/windows/desktop/FileIO/getqueuedcompletionstatusex-func) .</span><span class="sxs-lookup"><span data-stu-id="fb9f3-130">Also, you can be notified when an overlapped operation completes by using the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) or [**GetQueuedCompletionStatusEx**](/windows/desktop/FileIO/getqueuedcompletionstatusex-func) functions.</span></span> <span data-ttu-id="fb9f3-131">En este caso, no es necesario asignar el evento de restablecimiento manual en la estructura [**superpuesta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) y la finalización se produce en el identificador de canalización de la misma manera que una operación de lectura o escritura asincrónica.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-131">In this case, you do not need to assign the manual-reset event in the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure, and the completion happens against the pipe handle in the same way as an asynchronous read or write operation.</span></span> <span data-ttu-id="fb9f3-132">Para obtener más información, vea [puertos de finalización de e/s](/windows/desktop/FileIO/i-o-completion-ports).</span><span class="sxs-lookup"><span data-stu-id="fb9f3-132">For more information, see [I/O Completion Ports](/windows/desktop/FileIO/i-o-completion-ports).</span></span>

<span data-ttu-id="fb9f3-133">Cuando se realizan operaciones [**readfile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)y [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) de forma asincrónica, se produce uno de los siguientes casos:</span><span class="sxs-lookup"><span data-stu-id="fb9f3-133">When [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) operations are performed asynchronously, one of the following occurs:</span></span>

-   <span data-ttu-id="fb9f3-134">Si la operación se completa cuando la función devuelve, el valor devuelto indica si la operación se ha realizado correctamente o no.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-134">If the operation is complete when the function returns, the return value indicates the success or failure of the operation.</span></span> <span data-ttu-id="fb9f3-135">Si se produce un error, el valor devuelto es cero y la función [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) devuelve algo distinto del error de \_ e/s \_ pendiente.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-135">If an error occurs, the return value is zero and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns something other than ERROR\_IO\_PENDING.</span></span>
-   <span data-ttu-id="fb9f3-136">Si la operación no ha finalizado cuando la función devuelve, el valor devuelto es cero y [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) devuelve el error de \_ e/s \_ pendiente.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-136">If the operation has not finished when the function returns, the return value is zero and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) returns ERROR\_IO\_PENDING.</span></span> <span data-ttu-id="fb9f3-137">En este caso, el subproceso de llamada debe esperar hasta que la operación haya finalizado.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-137">In this case, the calling thread must wait until the operation has finished.</span></span> <span data-ttu-id="fb9f3-138">A continuación, el subproceso que realiza la llamada debe llamar a la función [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) para determinar los resultados.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-138">The calling thread must then call the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function to determine the results.</span></span>

## <a name="using-completion-routines"></a><span data-ttu-id="fb9f3-139">Usar rutinas de finalización</span><span class="sxs-lookup"><span data-stu-id="fb9f3-139">Using Completion Routines</span></span>

<span data-ttu-id="fb9f3-140">Las funciones [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) y [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) proporcionan otra forma de e/s superpuestas.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-140">The [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) functions provide another form of overlapped I/O.</span></span> <span data-ttu-id="fb9f3-141">A diferencia de las funciones [**readfile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) y [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) superpuestas, que utilizan un objeto de evento para indicar la finalización, las funciones extendidas especifican una *rutina de finalización*.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-141">Unlike the overlapped [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) functions, which use an event object to signal completion, the extended functions specify a *completion routine*.</span></span> <span data-ttu-id="fb9f3-142">Una rutina de finalización es una función que se pone en cola para su ejecución cuando finaliza la operación de lectura o escritura.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-142">A completion routine is a function that is queued for execution when the read or write operation is finished.</span></span> <span data-ttu-id="fb9f3-143">La rutina de finalización no se ejecuta hasta que el subproceso que llamó a **ReadFileEx** y **WriteFileEx** inicia una operación de *espera de alerta* mediante una llamada a una de las funciones de [espera de alerta](/windows/desktop/Sync/wait-functions) con el parámetro *fAlertable* establecido en **true**.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-143">The completion routine is not executed until the thread that called **ReadFileEx** and **WriteFileEx** starts an *alertable wait operation* by calling one of the [alertable wait functions](/windows/desktop/Sync/wait-functions) with the *fAlertable* parameter set to **TRUE**.</span></span> <span data-ttu-id="fb9f3-144">En una operación de espera de alerta, las funciones también devuelven cuando una rutina de finalización **ReadFileEx** o **WriteFileEx** se pone en cola para su ejecución.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-144">In an alertable wait operation, the functions also return when a **ReadFileEx** or **WriteFileEx** completion routine is queued for execution.</span></span> <span data-ttu-id="fb9f3-145">Un servidor de canalización puede utilizar las funciones extendidas para realizar una secuencia de operaciones de lectura y escritura para cada cliente que se conecta a ella.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-145">A pipe server can use the extended functions to perform a sequence of read and write operations for each client that connects to it.</span></span> <span data-ttu-id="fb9f3-146">Cada operación de lectura o escritura de la secuencia especifica una rutina de finalización y cada rutina de finalización inicia el siguiente paso de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="fb9f3-146">Each read or write operation in the sequence specifies a completion routine, and each completion routine initiates the next step in the sequence.</span></span> <span data-ttu-id="fb9f3-147">Para obtener un ejemplo, vea [servidor de canalización con nombre mediante rutinas de finalización](named-pipe-server-using-completion-routines.md).</span><span class="sxs-lookup"><span data-stu-id="fb9f3-147">For an example, see [Named Pipe Server Using Completion Routines](named-pipe-server-using-completion-routines.md).</span></span>

 

 
