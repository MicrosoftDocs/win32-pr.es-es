---
description: Compartir datos entre secuencias
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: Compartir datos entre secuencias
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495233"
---
# <a name="sharing-data-between-streams"></a><span data-ttu-id="cd1e4-103">Compartir datos entre secuencias</span><span class="sxs-lookup"><span data-stu-id="cd1e4-103">Sharing Data Between Streams</span></span>

> [!Note]  
> <span data-ttu-id="cd1e4-104">Estas API están en desuso.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-104">These APIs are deprecated.</span></span> <span data-ttu-id="cd1e4-105">Las aplicaciones deben usar el filtro de [**enganche de ejemplo**](sample-grabber-filter.md) o implementar un filtro personalizado para obtener datos de un gráfico de filtros de DirectShow.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-105">Applications should use the [**Sample Grabber**](sample-grabber-filter.md) filter or implement a custom filter to get data from a DirectShow filter graph.</span></span>

 

<span data-ttu-id="cd1e4-106">El procesamiento de datos multimedia normalmente requiere una gran cantidad de recursos del sistema; por lo tanto, debe evitar copiar los datos siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-106">Processing multimedia data typically requires a great deal of system resources; therefore, you should avoid copying data whenever possible.</span></span> <span data-ttu-id="cd1e4-107">La arquitectura de streaming admite ejemplos de secuencias compartidas, un mecanismo que mueve datos de un flujo a otro sin copiarlos.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-107">The streaming architecture supports shared stream samples, a mechanism that moves data from one stream to another without copying it.</span></span> <span data-ttu-id="cd1e4-108">Este búfer permite el transporte eficaz de datos entre dos flujos aunque el flujo de destino no admita específicamente el formato de datos subyacente.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-108">This buffer enables the efficient transportation of data between two streams even if the destination stream doesn't specifically support the underlying data format.</span></span>

<span data-ttu-id="cd1e4-109">Por ejemplo, suponga que tiene una secuencia multimedia con tres flujos de datos: vídeo y audio, y marca de tiempo de datos URL para que coincida con el contenido de vídeo.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-109">For example, assume that you have a multimedia stream with three data streams: video and audio, and URL data time-stamped to match the video content.</span></span> <span data-ttu-id="cd1e4-110">Quiere escribir una aplicación que agregue un aviso de propiedad intelectual en cada fotograma de vídeo y escriba los datos en otra secuencia para el almacenamiento, pero la aplicación no entiende ningún formato de datos, excepto el flujo de vídeo.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-110">You want to write an application that adds a copyright notice on every video frame and writes the data to another stream for storage, but your application doesn't understand any data formats except the video stream.</span></span> <span data-ttu-id="cd1e4-111">En el flujo de vídeo, se crea un ejemplo asociado a la superficie DirectDraw deseada.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-111">For the video stream, you create a sample attached to the desired DirectDraw surface.</span></span> <span data-ttu-id="cd1e4-112">Después, puede crear un flujo de salida llamando al método [**IDirectDrawMediaStream:: CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) con ese puntero a la misma superficie o [**IMediaStream:: CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span><span class="sxs-lookup"><span data-stu-id="cd1e4-112">You can then create an output stream by calling either the [**IDirectDrawMediaStream::CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) method with that pointer to the same surface, or [**IMediaStream::CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span></span> <span data-ttu-id="cd1e4-113">En ambos casos, los flujos de entrada y salida comparten la superficie DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-113">In both cases, the input and output streams share the DirectDraw surface.</span></span> <span data-ttu-id="cd1e4-114">Dado que entiende el formato de vídeo, puede tener acceso a esta superficie según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-114">Because you understand the video format, you can access this surface as needed.</span></span>

<span data-ttu-id="cd1e4-115">Para recuperar los otros punteros de secuencia de origen (audio y URL), enumere el flujo de contenedor de origen y los punteros a las secuencias de no vídeo.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-115">To retrieve the other source stream pointers (audio and URL), enumerate the source container stream and grab pointers to the nonvideo streams.</span></span> <span data-ttu-id="cd1e4-116">Cada uno de estos flujos de origen tiene un flujo de salida asociado en el contenedor de flujos de salida.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-116">Each of these source streams has an associated output stream in the output stream container.</span></span> <span data-ttu-id="cd1e4-117">Recupere estos punteros de salida llamando al método [**IMultiMediaStream:: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) en el contenedor de salida con cada uno de los punteros de flujo de origen.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-117">Retrieve these output pointers by calling the [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) method on the output container with each of the source stream pointers.</span></span> <span data-ttu-id="cd1e4-118">En los pasos siguientes se describe este proceso.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-118">The following steps describe this process.</span></span>

1.  <span data-ttu-id="cd1e4-119">Llame a [**IMultiMediaStream:: EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) para recuperar un puntero a una secuencia de origen.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-119">Call [**IMultiMediaStream::EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) to retrieve a pointer to a source stream.</span></span> <span data-ttu-id="cd1e4-120">Asegúrese de que no es el flujo de vídeo, ya que la aplicación ya entiende su formato.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-120">Make sure that it's not the video stream, because your application already understands its format.</span></span>
2.  <span data-ttu-id="cd1e4-121">Llame a [**IMultiMediaStream:: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) en la secuencia de contenedor de salida con el puntero del paso 1.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-121">Call [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) on the output container stream with the pointer from step 1.</span></span> <span data-ttu-id="cd1e4-122">Esto devuelve un puntero al flujo de salida deseado.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-122">This returns a pointer to the desired output stream.</span></span>
3.  <span data-ttu-id="cd1e4-123">Llame a [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) en el flujo de origen.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-123">Call [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) on the source stream.</span></span>
4.  <span data-ttu-id="cd1e4-124">Llame a [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) en el flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-124">Call [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) on the output stream.</span></span>
5.  <span data-ttu-id="cd1e4-125">Llame a [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) en el flujo de origen para leer los datos.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-125">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the source stream to read the data.</span></span>
6.  <span data-ttu-id="cd1e4-126">Llame a [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) en el flujo de salida para escribir los datos.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-126">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the output stream to write the data.</span></span>

<span data-ttu-id="cd1e4-127">Repita estos pasos para cada flujo cuyo formato no admita.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-127">Repeat these steps for each stream whose format you don't support.</span></span> <span data-ttu-id="cd1e4-128">Cuando ambos ejemplos terminen de actualizarse, el flujo de salida tendrá todos los datos de la secuencia de origen y se hará.</span><span class="sxs-lookup"><span data-stu-id="cd1e4-128">When both samples finish updating, the output stream has all data from the source stream and you are done.</span></span>

 

 



