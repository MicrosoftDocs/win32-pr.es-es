---
description: Dado que el script de instalación se puede ejecutar fuera de la sesión de instalación en la que se escribió, puede que la sesión ya no exista durante la ejecución del script de instalación.
ms.assetid: 13174c5d-c810-4b5d-9d1e-60ed30b8c44d
title: Obtener información de contexto para las acciones personalizadas de ejecución aplazada
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a13cd956509a5b8a4c92e0a53bfa455154a59bcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811287"
---
# <a name="obtaining-context-information-for-deferred-execution-custom-actions"></a><span data-ttu-id="af26f-103">Obtener información de contexto para las acciones personalizadas de ejecución aplazada</span><span class="sxs-lookup"><span data-stu-id="af26f-103">Obtaining Context Information for Deferred Execution Custom Actions</span></span>

<span data-ttu-id="af26f-104">Dado que el script de instalación se puede ejecutar fuera de la sesión de instalación en la que se escribió, puede que la sesión ya no exista durante la ejecución del script de instalación.</span><span class="sxs-lookup"><span data-stu-id="af26f-104">Because installation script can be executed outside of the installation session in which it was written, the session may no longer exist during execution of the installation script.</span></span> <span data-ttu-id="af26f-105">En este caso, el identificador de sesión original y las propiedades que se establecen durante la secuencia de instalación no están disponibles para una acción personalizada de ejecución aplazada.</span><span class="sxs-lookup"><span data-stu-id="af26f-105">In this case, the original session handle and properties set during the installation sequence are not available to a deferred execution custom action.</span></span> <span data-ttu-id="af26f-106">Cualquier función que requiera un identificador de sesión está restringida a algunos métodos que pueden recuperar información de contexto, o bien las propiedades que son necesarias durante la ejecución del script deben escribirse en el script de instalación.</span><span class="sxs-lookup"><span data-stu-id="af26f-106">Any functions that require a session handle are restricted to a few methods that can retrieve context information, or else properties that are needed during script execution must be written into the installation script.</span></span> <span data-ttu-id="af26f-107">Por ejemplo, las acciones personalizadas diferidas que llaman a las bibliotecas de vínculos dinámicos (dll) pasan un identificador que solo se puede usar para obtener una cantidad de información muy limitada.</span><span class="sxs-lookup"><span data-stu-id="af26f-107">For example, deferred custom actions that call dynamic-link libraries (DLLs) pass a handle which can only be used to obtain a very limited amount of information.</span></span> <span data-ttu-id="af26f-108">Se puede tener acceso a las funciones que no requieren un identificador de sesión desde una acción personalizada diferida.</span><span class="sxs-lookup"><span data-stu-id="af26f-108">Functions that do not require a session handle can be accessed from a deferred custom action.</span></span>

<span data-ttu-id="af26f-109">Las acciones personalizadas de ejecución aplazada se restringen a llamar solo a las siguientes funciones que requieren un identificador.</span><span class="sxs-lookup"><span data-stu-id="af26f-109">Deferred execution custom actions are restricted to calling only the following functions requiring a handle.</span></span>



| <span data-ttu-id="af26f-110">Función</span><span class="sxs-lookup"><span data-stu-id="af26f-110">Function</span></span>                                       | <span data-ttu-id="af26f-111">Descripción</span><span class="sxs-lookup"><span data-stu-id="af26f-111">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="af26f-112">**MsiGetProperty**</span><span class="sxs-lookup"><span data-stu-id="af26f-112">**MsiGetProperty**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya)       | <span data-ttu-id="af26f-113">Admite un conjunto limitado de propiedades cuando se usa con [acciones personalizadas de ejecución aplazada](deferred-execution-custom-actions.md): la propiedad CustomActionData, la propiedad [**ProductCode**](productcode.md) y la propiedad [**UserSID**](usersid.md) . [Commit Custom Actions](commit-custom-actions.md) no puede usar la función [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) para obtener la propiedad [**ProductCode**](productcode.md) .</span><span class="sxs-lookup"><span data-stu-id="af26f-113">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData property, [**ProductCode**](productcode.md) property, and [**UserSID**](usersid.md) property.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) function to obtain the [**ProductCode**](productcode.md) property.</span></span> <span data-ttu-id="af26f-114">Commit Custom Actions puede usar la propiedad CustomActionData para obtener el código de producto.</span><span class="sxs-lookup"><span data-stu-id="af26f-114">Commit custom actions can use the CustomActionData property to obtain the product code.</span></span><br/> |
| [<span data-ttu-id="af26f-115">**MsiFormatRecord**</span><span class="sxs-lookup"><span data-stu-id="af26f-115">**MsiFormatRecord**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda)     | <span data-ttu-id="af26f-116">Admite un conjunto limitado de propiedades cuando se usa con [las acciones personalizadas de ejecución aplazada](deferred-execution-custom-actions.md): las propiedades CustomActionData y ProductCode.</span><span class="sxs-lookup"><span data-stu-id="af26f-116">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData and ProductCode properties.</span></span>                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="af26f-117">**MsiGetMode**</span><span class="sxs-lookup"><span data-stu-id="af26f-117">**MsiGetMode**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)               | <span data-ttu-id="af26f-118">Cuando se llama desde acciones personalizadas de [ejecución aplazada](deferred-execution-custom-actions.md), [Confirmar acciones personalizadas](commit-custom-actions.md)o [revertir acciones personalizadas](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) devuelve true o false cuando se solicita para comprobar los parámetros de modo MSIRUNMODE \_ programado, MSIRUNMODE \_ commit o MSIRUNMODE \_ ROLLBACK.</span><span class="sxs-lookup"><span data-stu-id="af26f-118">When called from [deferred execution custom actions](deferred-execution-custom-actions.md), [commit custom actions](commit-custom-actions.md), or [rollback custom actions](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) returns True or False when requested to check the mode parameters MSIRUNMODE\_SCHEDULED, MSIRUNMODE\_COMMIT, or MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="af26f-119">Las solicitudes para comprobar cualquier otro parámetro de modo de ejecución de una acción personalizada aplazada, commit o ROLLBACK devuelven false.</span><span class="sxs-lookup"><span data-stu-id="af26f-119">Requests to check any other run mode parameters from a deferred, commit, or rollback custom action returns False.</span></span><br/>                       |
| [<span data-ttu-id="af26f-120">**MsiGetLanguage**</span><span class="sxs-lookup"><span data-stu-id="af26f-120">**MsiGetLanguage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage)       | <span data-ttu-id="af26f-121">IDENTIFICADOR de idioma numérico del producto actual. [Commit Custom Actions](commit-custom-actions.md) no puede usar la función [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) .</span><span class="sxs-lookup"><span data-stu-id="af26f-121">The numeric language ID for the current product.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) function.</span></span> <span data-ttu-id="af26f-122">Commit Custom Actions puede usar la propiedad CustomActionData para obtener el identificador de idioma numérico.</span><span class="sxs-lookup"><span data-stu-id="af26f-122">Commit custom actions can use the CustomActionData property to get the numeric language ID.</span></span><br/>                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="af26f-123">**MsiProcessMessage**</span><span class="sxs-lookup"><span data-stu-id="af26f-123">**MsiProcessMessage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) | <span data-ttu-id="af26f-124">Procesa los mensajes de error o de progreso de la acción personalizada.</span><span class="sxs-lookup"><span data-stu-id="af26f-124">Processes error or progress messages from the custom action.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="af26f-125">Una acción personalizada escrita en JScript o VBScript requiere el objeto de [**sesión**](session-object.md) de instalación.</span><span class="sxs-lookup"><span data-stu-id="af26f-125">A custom action that is written in JScript or VBScript requires the install [**Session**](session-object.md) object.</span></span> <span data-ttu-id="af26f-126">Este es el objeto de **sesión** de tipo y el instalador lo adjunta al script con el nombre "session".</span><span class="sxs-lookup"><span data-stu-id="af26f-126">This is of the type **Session Object** and the installer attaches it to the script with the name "Session".</span></span> <span data-ttu-id="af26f-127">Dado que es posible que el objeto de **sesión** no exista durante la reversión de la instalación, una acción personalizada diferida escrita en el script debe usar uno de los siguientes métodos o propiedades del objeto de **sesión** para recuperar su contexto.</span><span class="sxs-lookup"><span data-stu-id="af26f-127">Because the **Session** object may not exist during an installation rollback, a deferred custom action written in script must use one of the following methods or properties of the **Session** object to retrieve its context.</span></span>



| <span data-ttu-id="af26f-128">Nombre</span><span class="sxs-lookup"><span data-stu-id="af26f-128">Name</span></span>                                                           | <span data-ttu-id="af26f-129">Descripción</span><span class="sxs-lookup"><span data-stu-id="af26f-129">Description</span></span>                                                                                                                        |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="af26f-130">**Propiedad Mode**</span><span class="sxs-lookup"><span data-stu-id="af26f-130">**Mode Property**</span></span>](session-mode.md)                          | <span data-ttu-id="af26f-131">Devuelve true solo para MSIRUNMODE \_ programado.</span><span class="sxs-lookup"><span data-stu-id="af26f-131">Returns True for MSIRUNMODE\_SCHEDULED only.</span></span>                                                                                       |
| [<span data-ttu-id="af26f-132">**Property (propiedad, objeto Session)**</span><span class="sxs-lookup"><span data-stu-id="af26f-132">**Property Property (Session Object)**</span></span>](session-session.md)  | <span data-ttu-id="af26f-133">Devuelve la propiedad CustomActionData, la propiedad [**ProductCode**](productcode.md) o la propiedad [**UserSID**](usersid.md) .</span><span class="sxs-lookup"><span data-stu-id="af26f-133">Returns the CustomActionData property, [**ProductCode**](productcode.md) property, or [**UserSID**](usersid.md) property.</span></span>        |
| [<span data-ttu-id="af26f-134">**Propiedad Language (objeto Session)**</span><span class="sxs-lookup"><span data-stu-id="af26f-134">**Language Property (Session Object)**</span></span>](session-language.md) | <span data-ttu-id="af26f-135">Devuelve el identificador de idioma numérico de la sesión de instalación.</span><span class="sxs-lookup"><span data-stu-id="af26f-135">Returns numeric language ID of the installation session.</span></span>                                                                           |
| [<span data-ttu-id="af26f-136">**Message (método)**</span><span class="sxs-lookup"><span data-stu-id="af26f-136">**Message Method**</span></span>](session-message.md)                      | <span data-ttu-id="af26f-137">Se llama para controlar los errores y el progreso.</span><span class="sxs-lookup"><span data-stu-id="af26f-137">Called to handle errors and progress.</span></span>                                                                                              |
| [<span data-ttu-id="af26f-138">**Propiedad Installer**</span><span class="sxs-lookup"><span data-stu-id="af26f-138">**Installer Property**</span></span>](session-installer.md)                | <span data-ttu-id="af26f-139">Devuelve el objeto primario, que se usa para las funciones que no son de sesión, como el acceso al registro y la administración de la configuración del instalador.</span><span class="sxs-lookup"><span data-stu-id="af26f-139">Returns the parent object, which is used for non-session functions such as registry access and installer configuration management.</span></span> |



 

<span data-ttu-id="af26f-140">Los valores de propiedad que se establecen en el momento en que se procesa la secuencia de instalación en el script pueden no estar disponibles en el momento de la ejecución del script.</span><span class="sxs-lookup"><span data-stu-id="af26f-140">Property values that are set at the time the installation sequence is processed into script may be unavailable at the time of script execution.</span></span> <span data-ttu-id="af26f-141">Solo el siguiente conjunto limitado de propiedades siempre es accesible para las acciones personalizadas durante la ejecución del script.</span><span class="sxs-lookup"><span data-stu-id="af26f-141">Only the following limited set of properties is always accessible to custom actions during script execution.</span></span>



| <span data-ttu-id="af26f-142">Nombre de propiedad</span><span class="sxs-lookup"><span data-stu-id="af26f-142">Property name</span></span>                      | <span data-ttu-id="af26f-143">Descripción</span><span class="sxs-lookup"><span data-stu-id="af26f-143">Description</span></span>                                                                                                                                                                                                     |
|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="af26f-144">CustomActionData</span><span class="sxs-lookup"><span data-stu-id="af26f-144">CustomActionData</span></span>                   | <span data-ttu-id="af26f-145">Valor en el momento, la acción personalizada se procesa en la tabla de secuencia.</span><span class="sxs-lookup"><span data-stu-id="af26f-145">Value at time custom action is processed in sequence table.</span></span> <span data-ttu-id="af26f-146">La propiedad CustomActionData solo está disponible para las acciones personalizadas de ejecución aplazada.</span><span class="sxs-lookup"><span data-stu-id="af26f-146">The CustomActionData property is only available to deferred execution custom actions.</span></span> <span data-ttu-id="af26f-147">Las acciones personalizadas inmediatas no tienen acceso a esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="af26f-147">Immediate custom actions do not have access to this property.</span></span> |
| [<span data-ttu-id="af26f-148">**ProductCode**</span><span class="sxs-lookup"><span data-stu-id="af26f-148">**ProductCode**</span></span>](productcode.md) | <span data-ttu-id="af26f-149">Código único del producto, una cadena [GUID](guid.md) .</span><span class="sxs-lookup"><span data-stu-id="af26f-149">Unique code for the product, a [GUID](guid.md) string.</span></span>                                                                                                                                                         |
| [<span data-ttu-id="af26f-150">**UserSID**</span><span class="sxs-lookup"><span data-stu-id="af26f-150">**UserSID**</span></span>](usersid.md)         | <span data-ttu-id="af26f-151">Establecido por el instalador en el identificador de seguridad (SID) del usuario.</span><span class="sxs-lookup"><span data-stu-id="af26f-151">Set by the installer to the user's security identifier (SID).</span></span>                                                                                                                                                   |



 

<span data-ttu-id="af26f-152">Si la acción personalizada de ejecución aplazada requiere otros datos de propiedad, los valores deben almacenarse en el script de instalación.</span><span class="sxs-lookup"><span data-stu-id="af26f-152">If other property data is required by the deferred execution custom action, then their values must be stored in the installation script.</span></span> <span data-ttu-id="af26f-153">Esto puede hacerse mediante una segunda acción personalizada.</span><span class="sxs-lookup"><span data-stu-id="af26f-153">This can be done by using a second custom action.</span></span>

<span data-ttu-id="af26f-154">**Para escribir el valor de una propiedad en el script de instalación para su uso durante una acción personalizada de ejecución aplazada**</span><span class="sxs-lookup"><span data-stu-id="af26f-154">**To write the value of a property into the installation script for use during a deferred execution custom action**</span></span>

1.  <span data-ttu-id="af26f-155">Inserte una pequeña acción personalizada en la secuencia de instalación que establece la propiedad de interés para una propiedad que tiene el mismo nombre que la acción personalizada de ejecución aplazada.</span><span class="sxs-lookup"><span data-stu-id="af26f-155">Insert a small custom action into the installation sequence that sets the property of interest to a property having the same name as the deferred execution custom action.</span></span> <span data-ttu-id="af26f-156">Por ejemplo, si la clave principal de la acción personalizada de ejecución aplazada es "OnAction", establezca una propiedad denominada "OnAction" en la propiedad X que necesita recuperar.</span><span class="sxs-lookup"><span data-stu-id="af26f-156">For example, if the primary key for the deferred execution custom action is "MyAction" set a property named "MyAction" to the property X which you need to retrieve.</span></span> <span data-ttu-id="af26f-157">Debe establecer la propiedad "OnAction" en la secuencia de instalación antes de la acción personalizada "OnAction".</span><span class="sxs-lookup"><span data-stu-id="af26f-157">You must set the "MyAction" property in the installation sequence before the "MyAction" custom action.</span></span> <span data-ttu-id="af26f-158">Aunque cualquier tipo de acción personalizada puede establecer los datos de contexto, el método más sencillo consiste en usar una acción personalizada de asignación de propiedades (por ejemplo, el [tipo de acción personalizada 51](custom-action-type-51.md)).</span><span class="sxs-lookup"><span data-stu-id="af26f-158">Although any type of custom action can set the context data, the simplest method is to use a property assignment custom action (for example [Custom Action Type 51](custom-action-type-51.md)).</span></span>
2.  <span data-ttu-id="af26f-159">En el momento en que se procesa la secuencia de instalación, el instalador escribe el valor de la propiedad X en el script de ejecución como el valor de la propiedad CustomActionData.</span><span class="sxs-lookup"><span data-stu-id="af26f-159">At the time when the installation sequence is processed, the installer will write the value of property X into the execution script as the value of the property CustomActionData.</span></span>

## <a name="related-topics"></a><span data-ttu-id="af26f-160">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="af26f-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="af26f-161">Acerca de las propiedades</span><span class="sxs-lookup"><span data-stu-id="af26f-161">About Properties</span></span>](about-properties.md)
</dt> <dt>

[<span data-ttu-id="af26f-162">Utilizar propiedades</span><span class="sxs-lookup"><span data-stu-id="af26f-162">Using Properties</span></span>](using-properties.md)
</dt> <dt>

[<span data-ttu-id="af26f-163">Referencia de propiedades</span><span class="sxs-lookup"><span data-stu-id="af26f-163">Property Reference</span></span>](property-reference.md)
</dt> </dl>

 

 




