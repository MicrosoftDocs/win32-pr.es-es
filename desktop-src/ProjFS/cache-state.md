---
title: Estado de caché en la raíz de virtualización
description: Describe los distintos Estados de la memoria caché que puede tener un archivo o directorio administrado por el proveedor.
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/22/2020
ms.locfileid: "104420122"
---
# <a name="cache-state-in-the-virtualization-root"></a><span data-ttu-id="d878c-103">Estado de caché en la raíz de virtualización</span><span class="sxs-lookup"><span data-stu-id="d878c-103">Cache State In the Virtualization Root</span></span>

<span data-ttu-id="d878c-104">El proveedor usa el sistema de archivos local bajo la raíz de virtualización como una caché de los elementos que administra.</span><span class="sxs-lookup"><span data-stu-id="d878c-104">The provider uses the local file system under the virtualization root as a cache of the items that it manages.</span></span>  <span data-ttu-id="d878c-105">Un elemento (archivo o directorio) puede estar en uno de seis Estados en el sistema de archivos local:</span><span class="sxs-lookup"><span data-stu-id="d878c-105">An item (file or directory) can be in one of six states on the local file system:</span></span>

* <span data-ttu-id="d878c-106">Las máquinas</span><span class="sxs-lookup"><span data-stu-id="d878c-106">Virtual</span></span>

  <span data-ttu-id="d878c-107">El elemento no existe localmente en el disco.</span><span class="sxs-lookup"><span data-stu-id="d878c-107">The item does not exist locally on disk.</span></span>  <span data-ttu-id="d878c-108">Se proyecta, es decir, sintetizado, durante las enumeraciones de su directorio principal.</span><span class="sxs-lookup"><span data-stu-id="d878c-108">It is projected, i.e. synthesized, during enumerations of its parent directory.</span></span>  <span data-ttu-id="d878c-109">Los elementos virtuales se combinan con los elementos que puedan existir en el disco para presentar todo el contenido del directorio principal.</span><span class="sxs-lookup"><span data-stu-id="d878c-109">Virtual items are merged with any items that may exist on disk to present the full contents of the parent directory.</span></span>

* <span data-ttu-id="d878c-110">Marcador de posición</span><span class="sxs-lookup"><span data-stu-id="d878c-110">Placeholder</span></span>

  <span data-ttu-id="d878c-111">En el caso de los archivos: el contenido del archivo (flujo de datos principal) no está presente en el disco.</span><span class="sxs-lookup"><span data-stu-id="d878c-111">For files: The file's content (primary data stream) is not present on the disk.</span></span>  <span data-ttu-id="d878c-112">Los metadatos del archivo (nombre, tamaño, marcas de tiempo, atributos, etc.) se almacenan en caché en el disco.</span><span class="sxs-lookup"><span data-stu-id="d878c-112">The file’s metadata (name, size, timestamps, attributes, etc.) is cached on the disk.</span></span>
  
  <span data-ttu-id="d878c-113">En el caso de los directorios: algunos o todos los descendientes inmediatos del directorio (los archivos y directorios del directorio) no están presentes en el disco, es decir, siguen siendo virtuales.</span><span class="sxs-lookup"><span data-stu-id="d878c-113">For directories: Some or all of the directory’s immediate descendants (the files and directories in the directory) are not present on the disk, i.e. they are still virtual.</span></span>  <span data-ttu-id="d878c-114">Los metadatos del directorio (nombre, marcas de tiempo, atributos, etc.) se almacenan en caché en el disco.</span><span class="sxs-lookup"><span data-stu-id="d878c-114">The directory’s metadata (name, timestamps, attributes, etc.) is cached on the disk.</span></span>

* <span data-ttu-id="d878c-115">Marcador de posición hidratado</span><span class="sxs-lookup"><span data-stu-id="d878c-115">Hydrated placeholder</span></span>

  <span data-ttu-id="d878c-116">En el caso de los archivos: el contenido y los metadatos del archivo se han almacenado en caché en el disco.</span><span class="sxs-lookup"><span data-stu-id="d878c-116">For files: The file’s content and metadata have been cached to the disk.</span></span>  <span data-ttu-id="d878c-117">También se conoce como "archivo parcial".</span><span class="sxs-lookup"><span data-stu-id="d878c-117">Also referred to as a "partial file".</span></span>
  
  <span data-ttu-id="d878c-118">En el caso de los directorios: un directorio que se creó en el disco como un marcador de posición nunca se convierte en un directorio de marcador de posición hidratado.</span><span class="sxs-lookup"><span data-stu-id="d878c-118">For directories: A directory that was created on disk as a placeholder never becomes a hydrated placeholder directory.</span></span>  <span data-ttu-id="d878c-119">Esto permite al proveedor agregar o quitar elementos del directorio de su memoria auxiliar y hacer que dichos cambios se reflejen en la caché local.</span><span class="sxs-lookup"><span data-stu-id="d878c-119">This allows the provider to add or remove items from the directory in its backing store and have those changes be reflected in the local cache.</span></span>

* <span data-ttu-id="d878c-120">Marcador de posición Dirty (hidratado o no)</span><span class="sxs-lookup"><span data-stu-id="d878c-120">Dirty placeholder (hydrated or not)</span></span>

  <span data-ttu-id="d878c-121">Los metadatos del elemento se han modificado localmente y ya no son una caché de su estado en el almacén del proveedor.</span><span class="sxs-lookup"><span data-stu-id="d878c-121">The item's metadata has been locally modified and is no longer a cache of its state in the provider's store.</span></span> <span data-ttu-id="d878c-122">Tenga en cuenta que la creación o eliminación de un archivo o un directorio en un directorio de marcadores de posición hace que ese directorio de marcadores de posición se convierta en sucio.</span><span class="sxs-lookup"><span data-stu-id="d878c-122">Note that creating or deleting a file or directory under a placeholder directory causes that placeholder directory to become dirty.</span></span>

* <span data-ttu-id="d878c-123">Archivo/directorio completo</span><span class="sxs-lookup"><span data-stu-id="d878c-123">Full file/directory</span></span>

  <span data-ttu-id="d878c-124">En el caso de los archivos: se ha modificado el contenido del archivo (flujo de datos principal).</span><span class="sxs-lookup"><span data-stu-id="d878c-124">For files: The file's content (primary data stream) has been modified.</span></span>  <span data-ttu-id="d878c-125">El archivo ya no es una memoria caché de su estado en el almacén del proveedor.</span><span class="sxs-lookup"><span data-stu-id="d878c-125">The file is no longer a cache of its state in the provider's store.</span></span>  <span data-ttu-id="d878c-126">Los archivos que se han creado en el sistema de archivos local (es decir, que no existen en el almacén del proveedor) también se consideran archivos completos.</span><span class="sxs-lookup"><span data-stu-id="d878c-126">Files that have been created on the local file system (i.e. that do not exist in the provider's store at all) are also considered to be full files.</span></span>
  
  <span data-ttu-id="d878c-127">En el caso de los directorios: los directorios que se han creado en el sistema de archivos local (es decir, que no existen en el almacén del proveedor en absoluto) se consideran directorios completos.</span><span class="sxs-lookup"><span data-stu-id="d878c-127">For directories: Directories that have been created on the local file system (i.e. that do not exist in the provider's store at all) are considered to be full directories.</span></span>  <span data-ttu-id="d878c-128">Un directorio que se creó en el disco como un marcador de posición nunca se convierte en un directorio completo.</span><span class="sxs-lookup"><span data-stu-id="d878c-128">A directory that was created on disk as a placeholder never becomes a full directory.</span></span>
  
* <span data-ttu-id="d878c-129">Exclusión</span><span class="sxs-lookup"><span data-stu-id="d878c-129">Tombstone</span></span>

  <span data-ttu-id="d878c-130">Marcador de posición oculto especial que representa un elemento que se ha eliminado del sistema de archivos local.</span><span class="sxs-lookup"><span data-stu-id="d878c-130">A special hidden placeholder that represents an item that has been deleted from the local file system.</span></span>  <span data-ttu-id="d878c-131">Cuando se enumera un directorio ProjFS combina el conjunto de elementos locales (marcadores de posición, archivos completos, etc.) con el conjunto de elementos proyectados virtuales.</span><span class="sxs-lookup"><span data-stu-id="d878c-131">When a directory is enumerated ProjFS merges the set of local items (placeholders, full files, etc.) with the set of virtual projected items.</span></span>  <span data-ttu-id="d878c-132">Si un elemento aparece en los conjuntos locales y proyectados, el elemento local tiene prioridad.</span><span class="sxs-lookup"><span data-stu-id="d878c-132">If an item appears in both the local and projected sets, the local item takes precedence.</span></span>  <span data-ttu-id="d878c-133">Si un archivo no existe en el sistema de archivos local, no hay ningún estado local, por lo que aparecería en la enumeración.</span><span class="sxs-lookup"><span data-stu-id="d878c-133">If a file does not exist in the local file system there is no local state, so it would appear in the enumeration.</span></span>  <span data-ttu-id="d878c-134">Sin embargo, si ese elemento se hubiera eliminado, si aparece en la enumeración sería inesperado.</span><span class="sxs-lookup"><span data-stu-id="d878c-134">However if that item had been deleted, having it appear in the enumeration would be unexpected.</span></span>  <span data-ttu-id="d878c-135">Reemplazar un elemento eliminado con un objeto de desecho produce los siguientes efectos:</span><span class="sxs-lookup"><span data-stu-id="d878c-135">Replacing a deleted item with a tombstone results in the following effects:</span></span>

  * <span data-ttu-id="d878c-136">Enumeraciones para no revelar el elemento.</span><span class="sxs-lookup"><span data-stu-id="d878c-136">Enumerations to not reveal the item.</span></span>
  * <span data-ttu-id="d878c-137">Se abre un archivo que espera que el elemento exista, por ejemplo, "archivo no encontrado".</span><span class="sxs-lookup"><span data-stu-id="d878c-137">File opens that expect the item to exist fail with e.g. "file not found".</span></span>
  * <span data-ttu-id="d878c-138">El archivo crea que esperará que se realice correctamente solo si el elemento no existe correctamente; ProjFS quita el elemento de desecho como parte de la operación.</span><span class="sxs-lookup"><span data-stu-id="d878c-138">File creates that expect to succeed only if the item does not exist succeed; ProjFS removes the tombstone as part of the operation.</span></span>

<span data-ttu-id="d878c-139">Para ilustrar los Estados anteriores, tenga en cuenta la siguiente secuencia, dado un proveedor ProjFS que tiene un único archivo "foo.txt" ubicado en la raíz de virtualización C:\root.</span><span class="sxs-lookup"><span data-stu-id="d878c-139">To illustrate the above states, consider the following sequence, given a ProjFS provider that has a single file "foo.txt" located in the virtualization root C:\root.</span></span>

1. <span data-ttu-id="d878c-140">Una aplicación enumera C:\root.</span><span class="sxs-lookup"><span data-stu-id="d878c-140">An app enumerates C:\root.</span></span>  <span data-ttu-id="d878c-141">Ve el archivo virtual "foo.txt".</span><span class="sxs-lookup"><span data-stu-id="d878c-141">It sees the virtual file "foo.txt".</span></span>  <span data-ttu-id="d878c-142">Puesto que no se ha tenido acceso al archivo, el archivo no existe en el disco.</span><span class="sxs-lookup"><span data-stu-id="d878c-142">Since the file has not yet been accessed, the file does not exist on disk.</span></span>
1. <span data-ttu-id="d878c-143">La aplicación abre un identificador para C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="d878c-143">The app opens a handle to C:\root\foo.txt.</span></span>  <span data-ttu-id="d878c-144">ProjFS indica al proveedor que cree un marcador de posición para él.</span><span class="sxs-lookup"><span data-stu-id="d878c-144">ProjFS tells the provider to create a placeholder for it.</span></span>
1. <span data-ttu-id="d878c-145">La aplicación lee el contenido del archivo.</span><span class="sxs-lookup"><span data-stu-id="d878c-145">The app reads the content of the file.</span></span>  <span data-ttu-id="d878c-146">El proveedor proporciona el contenido del archivo a ProjFS y se almacena en caché para C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="d878c-146">The provider provides the file content to ProjFS and it is cached to C:\root\foo.txt.</span></span>  <span data-ttu-id="d878c-147">El archivo es ahora un marcador de posición hidratado.</span><span class="sxs-lookup"><span data-stu-id="d878c-147">The file is now a hydrated placeholder.</span></span>
1. <span data-ttu-id="d878c-148">La aplicación actualiza la marca de tiempo de la última modificación.</span><span class="sxs-lookup"><span data-stu-id="d878c-148">The app updates the Last Modified timestamp.</span></span>  <span data-ttu-id="d878c-149">El archivo es ahora un marcador de posición de modificado.</span><span class="sxs-lookup"><span data-stu-id="d878c-149">The file is now a dirty hydrated placeholder.</span></span>
1. <span data-ttu-id="d878c-150">La aplicación abre un identificador para el acceso de escritura al archivo.</span><span class="sxs-lookup"><span data-stu-id="d878c-150">The app opens a handle for write access to the file.</span></span>  <span data-ttu-id="d878c-151">C:\root\foo.txt es ahora un archivo completo.</span><span class="sxs-lookup"><span data-stu-id="d878c-151">C:\root\foo.txt is now a full file.</span></span>
1. <span data-ttu-id="d878c-152">La aplicación elimina C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="d878c-152">The app deletes C:\root\foo.txt.</span></span>  <span data-ttu-id="d878c-153">ProjFS reemplaza el archivo por un marcadores de exclusión.</span><span class="sxs-lookup"><span data-stu-id="d878c-153">ProjFS replaces the file with a tombstone.</span></span>  <span data-ttu-id="d878c-154">Ahora, cuando la aplicación Enumere C:\root, no verá foo.txt.</span><span class="sxs-lookup"><span data-stu-id="d878c-154">Now when the app enumerates C:\root it does not see foo.txt.</span></span>  <span data-ttu-id="d878c-155">Si intenta abrir el archivo, se produce un error al abrir con ERROR_FILE_NOT_FOUND.</span><span class="sxs-lookup"><span data-stu-id="d878c-155">If it tries to open the file, the open fails with ERROR_FILE_NOT_FOUND.</span></span>
