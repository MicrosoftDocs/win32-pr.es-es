---
description: En este tema se describe el contenido de vídeo&\# 8211; capacidades de protección que puede proporcionar un controlador de gráficos.
ms.assetid: 3FDB4908-C75D-4AE0-B32E-93F840E4F30A
title: GPU-Based Content Protection con vídeo de D3D11
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78097492d375d50688f2472f5d2de99cc21f8594
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104080310"
---
# <a name="gpu-based-content-protection-with-d3d11-video"></a><span data-ttu-id="db265-103">GPU-Based Content Protection con vídeo de D3D11</span><span class="sxs-lookup"><span data-stu-id="db265-103">GPU-Based Content Protection with D3D11 Video</span></span>

<span data-ttu-id="db265-104">En este tema se describe el contenido de vídeo: capacidades de protección que puede proporcionar un controlador de gráficos.</span><span class="sxs-lookup"><span data-stu-id="db265-104">This topic describes video content–protection capabilities that a graphics driver can provide.</span></span>

-   [<span data-ttu-id="db265-105">Introducción</span><span class="sxs-lookup"><span data-stu-id="db265-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="db265-106">Información general sobre el proceso de descodificación</span><span class="sxs-lookup"><span data-stu-id="db265-106">Overview of the Decoding Process</span></span>](#overview-of-the-decoding-process)
-   [<span data-ttu-id="db265-107">Cifrado de búferes de vídeo comprimidos para el descodificador</span><span class="sxs-lookup"><span data-stu-id="db265-107">Encrypting Compressed Video Buffers for the Decoder</span></span>](#encrypting-compressed-video-buffers-for-the-decoder)
    -   [<span data-ttu-id="db265-108">1. consultar las capacidades Content Protection del controlador</span><span class="sxs-lookup"><span data-stu-id="db265-108">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
    -   [<span data-ttu-id="db265-109">2. configurar el canal autenticado</span><span class="sxs-lookup"><span data-stu-id="db265-109">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
    -   [<span data-ttu-id="db265-110">3. configurar la sesión criptográfica</span><span class="sxs-lookup"><span data-stu-id="db265-110">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
    -   [<span data-ttu-id="db265-111">4. asociar el descodificador a la sesión criptográfica</span><span class="sxs-lookup"><span data-stu-id="db265-111">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)
-   [<span data-ttu-id="db265-112">Envío de comandos de canal autenticado</span><span class="sxs-lookup"><span data-stu-id="db265-112">Sending Authenticated Channel Commands</span></span>](#sending-authenticated-channel-commands)
-   [<span data-ttu-id="db265-113">Envío de consultas de canales autenticadas</span><span class="sxs-lookup"><span data-stu-id="db265-113">Sending Authenticated Channel Queries</span></span>](#sending-authenticated-channel-queries)
-   [<span data-ttu-id="db265-114">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="db265-114">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="db265-115">Introducción</span><span class="sxs-lookup"><span data-stu-id="db265-115">Introduction</span></span>

<span data-ttu-id="db265-116">En el diagrama siguiente se muestra una vista simplificada de cómo se recorre el contenido de vídeo protegido a través de la canalización.</span><span class="sxs-lookup"><span data-stu-id="db265-116">The following diagram shows a simplified view of how protected video content travels through the pipeline to be rendered.</span></span>

![diagrama que muestra el contenido de vídeo protegido.](images/d3d9video01.png)

> [!Note]
>
> <span data-ttu-id="db265-118">La [ruta de acceso a los medios protegidos](protected-media-path.md) (PMP) no se muestra en este diagrama.</span><span class="sxs-lookup"><span data-stu-id="db265-118">The [Protected Media Path](protected-media-path.md) (PMP) is not depicted in this diagram.</span></span> <span data-ttu-id="db265-119">El flujo de datos que se muestra aquí puede aparecer dentro de un proceso de PMP o dentro de un proceso de aplicación.</span><span class="sxs-lookup"><span data-stu-id="db265-119">The data flow that is shown here might occur within a PMP process, or within an application process.</span></span>

 

<span data-ttu-id="db265-120">El descodificador recibe datos de vídeo cifrados y comprimidos de un origen externo.</span><span class="sxs-lookup"><span data-stu-id="db265-120">The decoder receives encrypted, compressed video data from an external source.</span></span> <span data-ttu-id="db265-121">También se supone que el descodificador recibe también una clave criptográfica para descifrar estos datos.</span><span class="sxs-lookup"><span data-stu-id="db265-121">It is assumed also the decoder also receives a cryptographic key to decrypt this data.</span></span> <span data-ttu-id="db265-122">En este tema no se describe el intercambio de claves entre el origen y el descodificador de vídeo, pero el PMP define un posible mecanismo.</span><span class="sxs-lookup"><span data-stu-id="db265-122">This topic does not describe the key exchange between the video source and decoder, but the PMP defines one possible mechanism.</span></span> <span data-ttu-id="db265-123">La GPU no está implicada en esta fase.</span><span class="sxs-lookup"><span data-stu-id="db265-123">The GPU is not involved at this stage.</span></span>

<span data-ttu-id="db265-124">Para la descodificación acelerada por hardware, el descodificador de software pasa el contenido de vídeo comprimido a la GPU.</span><span class="sxs-lookup"><span data-stu-id="db265-124">For hardware-accelerated decoding, the software decoder passes compressed video content to the GPU.</span></span> <span data-ttu-id="db265-125">Para proteger este contenido, el descodificador vuelve a cifrar los datos, normalmente mediante AES-CTR, antes de pasarlos al Acelerador de hardware.</span><span class="sxs-lookup"><span data-stu-id="db265-125">To protect this content, the decoder re-encrypts the data, typically using AES-CTR, before passing it to the hardware accelerator.</span></span> <span data-ttu-id="db265-126">Se define un mecanismo de intercambio de claves entre el descodificador y el controlador de gráficos.</span><span class="sxs-lookup"><span data-stu-id="db265-126">A key-exchange mechanism is defined between the decoder and the graphics driver.</span></span>

<span data-ttu-id="db265-127">Los fotogramas de vídeo descodificados se almacenan en la memoria de vídeo, por lo general, sin cifrar.</span><span class="sxs-lookup"><span data-stu-id="db265-127">Decoded video frames are stored in video memory, generally in the clear.</span></span> <span data-ttu-id="db265-128">En este momento, los fotogramas se procesan y se presentan.</span><span class="sxs-lookup"><span data-stu-id="db265-128">At this point, the frames are processed and then presented.</span></span> <span data-ttu-id="db265-129">Hay dos opciones principales para la presentación.</span><span class="sxs-lookup"><span data-stu-id="db265-129">There are two main options for presentation.</span></span>

-   <span data-ttu-id="db265-130">Cuando se usa la API de D3D9, se pueden presentar fotogramas mediante una superposición de hardware.</span><span class="sxs-lookup"><span data-stu-id="db265-130">When using the D3D9 API, frames can be presented using a hardware overlay.</span></span> <span data-ttu-id="db265-131">El hardware no es compatible con D3D11.</span><span class="sxs-lookup"><span data-stu-id="db265-131">Hardware overly is not supported in D3D11.</span></span> <span data-ttu-id="db265-132">Para obtener más información, consulte [compatibilidad con la superposición de hardware](hardware-overlay-support.md).</span><span class="sxs-lookup"><span data-stu-id="db265-132">For more information, see [Hardware Overlay Support](hardware-overlay-support.md).</span></span>
-   <span data-ttu-id="db265-133">Los fotogramas se pueden presentar mediante la ventana de escritorio administrar (DWM) mediante una superficie compartida.</span><span class="sxs-lookup"><span data-stu-id="db265-133">Frames can be presented by the Desktop Window Manage (DWM) using a shared surface.</span></span>

<span data-ttu-id="db265-134">El último paso es mostrar el fotograma en el monitor, que puede requerir protección de vínculos entre la tarjeta gráfica y el dispositivo de pantalla.</span><span class="sxs-lookup"><span data-stu-id="db265-134">The last step is to display the frame on the monitor, which may require link protection between the graphics card and the display device.</span></span> <span data-ttu-id="db265-135">Un ejemplo de protección de vínculos es High-Bandwidth Content Protection digital (HDCP).</span><span class="sxs-lookup"><span data-stu-id="db265-135">An example of link protection is High-Bandwidth Digital Content Protection (HDCP).</span></span> <span data-ttu-id="db265-136">La protección de vínculos se configura mediante el [Administrador de protección de salida](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="db265-136">Link protection is configured using [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="db265-137">En este tema no se describe OPM; para obtener más información, consulte [uso del administrador de protección de salida](using-output-protection-manager.md).</span><span class="sxs-lookup"><span data-stu-id="db265-137">This topic does not describe OPM; for more information, see [Using Output Protection Manager](using-output-protection-manager.md).</span></span>

## <a name="overview-of-the-decoding-process"></a><span data-ttu-id="db265-138">Información general sobre el proceso de descodificación</span><span class="sxs-lookup"><span data-stu-id="db265-138">Overview of the Decoding Process</span></span>

<span data-ttu-id="db265-139">Durante la descodificación acelerada por hardware, el descodificador de software debe pasar datos de vídeo comprimidos a la tarjeta gráfica.</span><span class="sxs-lookup"><span data-stu-id="db265-139">During hardware-accelerated decoding, the software decoder must pass compressed video data to the graphics card.</span></span> <span data-ttu-id="db265-140">En el caso de contenido premium, estos datos normalmente se deben cifrar mediante el cifrado de clave simétrica antes de enviarlos a la GPU.</span><span class="sxs-lookup"><span data-stu-id="db265-140">For premium content, this data typically must be encrypted, using symmetric-key encryption, before it is sent to the GPU.</span></span>

<span data-ttu-id="db265-141">Para cifrar el vídeo para la descodificación, el descodificador de software utiliza las siguientes interfaces:</span><span class="sxs-lookup"><span data-stu-id="db265-141">To encrypt the video for decoding, the software decoder uses the following interfaces:</span></span>

-   <span data-ttu-id="db265-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span><span class="sxs-lookup"><span data-stu-id="db265-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span></span> <span data-ttu-id="db265-143">Representa el dispositivo descodificador, también denominado Acelerador.</span><span class="sxs-lookup"><span data-stu-id="db265-143">Represents the decoder device, also called the accelerator.</span></span>
-   <span data-ttu-id="db265-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span><span class="sxs-lookup"><span data-stu-id="db265-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span></span> <span data-ttu-id="db265-145">Representa una sesión de cifrado, que proporciona la clave de cifrado.</span><span class="sxs-lookup"><span data-stu-id="db265-145">Represents a cryptographic session, which provides the encryption key.</span></span>
-   <span data-ttu-id="db265-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="db265-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span></span> <span data-ttu-id="db265-147">Representa un canal autenticado, que permite al descodificador de software asociar la sesión de cifrado con el descodificador.</span><span class="sxs-lookup"><span data-stu-id="db265-147">Represents an authenticated channel, which enables the software decoder to associate the cryptographic session with the decoder.</span></span>

![diagrama que muestra las interfaces de descodificación de Direct3D9.](images/d3d9video02.png)

<span data-ttu-id="db265-149">Todas estas interfaces se obtienen del dispositivo Direct3D 11, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="db265-149">All of these interfaces are obtained from the Direct3D11 device, as follows:</span></span>



| <span data-ttu-id="db265-150">Interfaz</span><span class="sxs-lookup"><span data-stu-id="db265-150">Interface</span></span>                                                        | <span data-ttu-id="db265-151">Creación</span><span class="sxs-lookup"><span data-stu-id="db265-151">Creation</span></span>                                                                                                                                                |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="db265-152">**ID3D11VideoDecoder**</span><span class="sxs-lookup"><span data-stu-id="db265-152">**ID3D11VideoDecoder**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder)                 | <span data-ttu-id="db265-153">Llame a [**ID3D11VideoDevice:: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span><span class="sxs-lookup"><span data-stu-id="db265-153">Call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span></span> <span data-ttu-id="db265-154">El tipo de descodificador se identifica mediante un GUID de perfil.</span><span class="sxs-lookup"><span data-stu-id="db265-154">The decoder type is identified by a profile GUID.</span></span> |
| [<span data-ttu-id="db265-155">**ID3D11CryptoSession**</span><span class="sxs-lookup"><span data-stu-id="db265-155">**ID3D11CryptoSession**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession)               | <span data-ttu-id="db265-156">Llame a [**ID3D11VideoDevice:: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span><span class="sxs-lookup"><span data-stu-id="db265-156">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span></span>                                                           |
| [<span data-ttu-id="db265-157">**ID3D11AuthenticatedChannel**</span><span class="sxs-lookup"><span data-stu-id="db265-157">**ID3D11AuthenticatedChannel**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) | <span data-ttu-id="db265-158">Llame a [**ID3D11VideoDevice:: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="db265-158">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span></span>                                             |



 

> [!Note]  
> <span data-ttu-id="db265-159">Para obtener un puntero a la interfaz [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) , llame a [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) en la interfaz [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="db265-159">To get a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface, call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>

 

<span data-ttu-id="db265-160">El canal autenticado proporciona un canal de comunicación de confianza entre el descodificador de software y el controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-160">The authenticated channel provides a trusted communication channel between the software decoder and the driver.</span></span> <span data-ttu-id="db265-161">El canal de comunicación funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="db265-161">The communication channel works as follows:</span></span>

-   <span data-ttu-id="db265-162">El controlador proporciona una cadena de certificados X. 509 cuyo certificado raíz está firmado por Microsoft.</span><span class="sxs-lookup"><span data-stu-id="db265-162">The driver provides an X.509 certificate chain whose root certificate is signed by Microsoft.</span></span>
-   <span data-ttu-id="db265-163">El certificado contiene una clave pública RSA para el controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-163">The certificate contains an RSA public key for the driver.</span></span>
-   <span data-ttu-id="db265-164">El descodificador de software usa la clave pública para enviar al controlador una clave de sesión AES de 128 bits.</span><span class="sxs-lookup"><span data-stu-id="db265-164">The software decoder uses the public key to send the driver a 128-bit AES session key.</span></span>
-   <span data-ttu-id="db265-165">El descodificador de software envía consultas y comandos al canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-165">The software decoder sends queries and commands to the authenticated channel.</span></span>
-   <span data-ttu-id="db265-166">La clave de sesión se usa para calcular códigos de autenticación de mensajes (Mac) para las consultas y los comandos.</span><span class="sxs-lookup"><span data-stu-id="db265-166">The session key is used to compute message authentication codes (MACs) for the queries and commands.</span></span> <span data-ttu-id="db265-167">El controlador utiliza los equipos Mac para comprobar la integridad de los datos de consulta y comando, y el descodificador de software los usa para comprobar la integridad de los datos de respuesta del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-167">The driver uses the MACs to verify the integrity of the query/command data, and the software decoder uses them to verify the integrity of the response data from the driver.</span></span>

## <a name="encrypting-compressed-video-buffers-for-the-decoder"></a><span data-ttu-id="db265-168">Cifrado de búferes de vídeo comprimidos para el descodificador</span><span class="sxs-lookup"><span data-stu-id="db265-168">Encrypting Compressed Video Buffers for the Decoder</span></span>

<span data-ttu-id="db265-169">A continuación se muestra una introducción de alto nivel del proceso de cifrado y descodificación:</span><span class="sxs-lookup"><span data-stu-id="db265-169">Here is a high-level overview of the encryption and decoding process:</span></span>

1.  <span data-ttu-id="db265-170">El descodificador de software recibe un flujo de datos cifrados del origen de vídeo.</span><span class="sxs-lookup"><span data-stu-id="db265-170">The software decoder receives a stream of encrypted data from the video source.</span></span> <span data-ttu-id="db265-171">El descodificador descifra esta secuencia.</span><span class="sxs-lookup"><span data-stu-id="db265-171">The decoder decrypts this stream.</span></span>
2.  <span data-ttu-id="db265-172">El descodificador de software negocia una clave de sesión con la sesión criptográfica.</span><span class="sxs-lookup"><span data-stu-id="db265-172">The software decoder negotiates a session key with the cryptographic session.</span></span>
3.  <span data-ttu-id="db265-173">El descodificador de software usa el canal autenticado para asociar la sesión de cifrado con el dispositivo descodificador.</span><span class="sxs-lookup"><span data-stu-id="db265-173">The software decoder uses the authenticated channel to associate the cryptographic session with the decoder device.</span></span>
4.  <span data-ttu-id="db265-174">El descodificador de software coloca los datos comprimidos en los búferes que obtiene del dispositivo descodificador (acelerador).</span><span class="sxs-lookup"><span data-stu-id="db265-174">The software decoder puts compressed data in buffers that it gets from the decoder device (accelerator).</span></span> <span data-ttu-id="db265-175">Para el contenido protegido, el codificador de software cifra los datos que se colocan en los búferes con la clave de sesión para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="db265-175">For protected content, the software encoder encrypts the data that is puts into the buffers, using the session key for the encryption.</span></span>
    > [!Note]  
    > <span data-ttu-id="db265-176">Algunos controladores usan una clave de contenido, en lugar de la clave de sesión, para el cifrado.</span><span class="sxs-lookup"><span data-stu-id="db265-176">Some drivers use a content key, instead of the session key, for encryption.</span></span> <span data-ttu-id="db265-177">La clave de contenido podría cambiar de un marco a otro.</span><span class="sxs-lookup"><span data-stu-id="db265-177">The content key could change from one frame to the next.</span></span>

     

5.  <span data-ttu-id="db265-178">El descodificador envía los búferes comprimidos cifrados al acelerador.</span><span class="sxs-lookup"><span data-stu-id="db265-178">The decoder submits the encrypted compressed buffers to the accelerator.</span></span> <span data-ttu-id="db265-179">En el caso de AES-CTR, el descodificador también pasa el vector de inicialización.</span><span class="sxs-lookup"><span data-stu-id="db265-179">For AES-CTR, the decoder also passes the initialization vector.</span></span> <span data-ttu-id="db265-180">Si se usa una clave de contenido, el descodificador pasa la clave de contenido, cifrada mediante la clave de sesión.</span><span class="sxs-lookup"><span data-stu-id="db265-180">If a content key is used, the decoder passes the content key, encrypted using the session key.</span></span>

<span data-ttu-id="db265-181">Direct3D 11 tiene compatibilidad estándar con AES-CTR de 128 bits, pero está diseñado para extenderse a tipos de cifrado adicionales.</span><span class="sxs-lookup"><span data-stu-id="db265-181">Direct3D11 has standard support for 128-bit AES-CTR, but is designed to extend to additional encryption types.</span></span>

<span data-ttu-id="db265-182">Las cinco secciones siguientes proporcionan pasos más detallados.</span><span class="sxs-lookup"><span data-stu-id="db265-182">The next five sections give more detailed steps.</span></span>

-   [<span data-ttu-id="db265-183">1. consultar las capacidades Content Protection del controlador</span><span class="sxs-lookup"><span data-stu-id="db265-183">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
-   [<span data-ttu-id="db265-184">2. configurar el canal autenticado</span><span class="sxs-lookup"><span data-stu-id="db265-184">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
-   [<span data-ttu-id="db265-185">3. configurar la sesión criptográfica</span><span class="sxs-lookup"><span data-stu-id="db265-185">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
-   [<span data-ttu-id="db265-186">4. asociar el descodificador a la sesión criptográfica</span><span class="sxs-lookup"><span data-stu-id="db265-186">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)

### <a name="1-query-the-content-protection-capabilities-of-the-driver"></a><span data-ttu-id="db265-187">1. consultar las capacidades Content Protection del controlador</span><span class="sxs-lookup"><span data-stu-id="db265-187">1. Query the Content Protection Capabilities of the Driver</span></span>

<span data-ttu-id="db265-188">Antes de intentar aplicar el cifrado, obtenga las capacidades de protección de contenido del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-188">Before attempting to apply encryption, get the content protection capabilities of the driver.</span></span>

1.  <span data-ttu-id="db265-189">Obtiene un puntero a la interfaz ID3D11Device.</span><span class="sxs-lookup"><span data-stu-id="db265-189">Get a pointer to the ID3D11Device interface.</span></span>
2.  <span data-ttu-id="db265-190">Llame a [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) para la interfaz [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="db265-190">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
3.  <span data-ttu-id="db265-191">Llame a [**ID3D11VideoDevice:: GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span><span class="sxs-lookup"><span data-stu-id="db265-191">Call [**ID3D11VideoDevice::GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span></span> <span data-ttu-id="db265-192">Este método rellena una estructura de [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) con las funcionalidades de protección de contenido del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-192">This method fills in a [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) structure with the driver’s content protection capabilities.</span></span>

<span data-ttu-id="db265-193">En concreto, busque las siguientes funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="db265-193">In particular, look for the following capabilities:</span></span>

-   <span data-ttu-id="db265-194">Si el miembro **caps** contiene la marca **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** o **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** , el controlador puede realizar el cifrado.</span><span class="sxs-lookup"><span data-stu-id="db265-194">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** or **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** flag, the driver can perform encryption.</span></span>
-   <span data-ttu-id="db265-195">Si el miembro **caps** contiene la marca **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** , el controlador utiliza una clave de contenido independiente para el descifrado.</span><span class="sxs-lookup"><span data-stu-id="db265-195">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** flag, the driver uses a separate content key for decryption.</span></span>
-   <span data-ttu-id="db265-196">Llame a [**ID3D11VideoDevice:: CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) para determinar qué tipos de intercambios de clave admite el controlador para generar la clave de sesión.</span><span class="sxs-lookup"><span data-stu-id="db265-196">Call [**ID3D11VideoDevice::CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) to determine which types of key exchanges the driver supports for generating the session key.</span></span>

<span data-ttu-id="db265-197">Las funcionalidades adicionales se indican en el miembro **Cap** .</span><span class="sxs-lookup"><span data-stu-id="db265-197">Additional capabilities are indicated in the **Caps** member.</span></span>

### <a name="2-configure-the-authenticated-channel"></a><span data-ttu-id="db265-198">2. configurar el canal autenticado</span><span class="sxs-lookup"><span data-stu-id="db265-198">2. Configure the Authenticated Channel</span></span>

<span data-ttu-id="db265-199">El siguiente paso consiste en configurar el canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-199">The next step is to configure the authenticated channel.</span></span>

1.  <span data-ttu-id="db265-200">Llame a [**ID3D11VideoDevice:: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) para crear el canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-200">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) to create the authenticated channel.</span></span> <span data-ttu-id="db265-201">Para el parámetro *ChannelType* , especifique un tipo de canal que coincida con las capacidades del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-201">For the *ChannelType* parameter, specify a channel type that matches the capabilities of the driver.</span></span>
    -   <span data-ttu-id="db265-202">El tipo de canal **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** corresponde a **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span><span class="sxs-lookup"><span data-stu-id="db265-202">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span></span>
    -   <span data-ttu-id="db265-203">El tipo de canal **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** corresponde a **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span><span class="sxs-lookup"><span data-stu-id="db265-203">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span></span>

    <span data-ttu-id="db265-204">El método **CreateAuthenticatedChannel** devuelve un puntero a la interfaz [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="db265-204">The **CreateAuthenticatedChannel** method returns a pointer to the [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) interface.</span></span>
2.  <span data-ttu-id="db265-205">Llame a [**ID3D11AuthenticatedChannel:: GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) para obtener el tamaño del certificado X. 509 del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-205">Call [**ID3D11AuthenticatedChannel::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="db265-206">Asigne un búfer del tamaño requerido.</span><span class="sxs-lookup"><span data-stu-id="db265-206">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="db265-207">Llame a [**ID3D11AuthenticatedChannel:: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) para obtener el certificado.</span><span class="sxs-lookup"><span data-stu-id="db265-207">Call [**ID3D11AuthenticatedChannel::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) to get the certificate.</span></span> <span data-ttu-id="db265-208">El método copia el certificado en el búfer que se asignó en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="db265-208">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="db265-209">Compruebe que el certificado del controlador está firmado por Microsoft y que no se ha revocado.</span><span class="sxs-lookup"><span data-stu-id="db265-209">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="db265-210">Obtiene la clave pública del certificado.</span><span class="sxs-lookup"><span data-stu-id="db265-210">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="db265-211">Generar una clave de sesión RSA aleatoria.</span><span class="sxs-lookup"><span data-stu-id="db265-211">Generate a random RSA session key.</span></span> <span data-ttu-id="db265-212">Esta clave de sesión se usa para firmar los datos que se envían al canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-212">This session key is used to sign data that is sent to the authenticated channel.</span></span> <span data-ttu-id="db265-213">Cifre la clave de sesión mediante la clave pública del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-213">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="db265-214">Llame a [**ID3D11VideoContext:: NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) para enviar la clave de sesión cifrada al controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-214">Call [**ID3D11VideoContext::NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="db265-215">Inicialice el canal seguro como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="db265-215">Initialize the secure channel as follows:</span></span>
    1.  <span data-ttu-id="db265-216">Rellene una estructura de [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) como se describe en la documentación de.</span><span class="sxs-lookup"><span data-stu-id="db265-216">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) structure as described in the documentation.</span></span>
    2.  <span data-ttu-id="db265-217">Envíe el comando [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) llamando a [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) tal y como se describe en la sección [envío de comandos de canal autenticado](#sending-authenticated-channel-commands).</span><span class="sxs-lookup"><span data-stu-id="db265-217">Send the [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) command by calling [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) as described in the section [Sending Authenticated Channel Commands](#sending-authenticated-channel-commands).</span></span> <span data-ttu-id="db265-218">Este comando contiene los números de secuencia inicial para los comandos y las consultas que se envían al canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-218">This command contains the starting sequence numbers for the commands and queries that are sent to the authenticated channel.</span></span>
9.  <span data-ttu-id="db265-219">Compruebe el tipo de canal mediante el envío de una [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) consulta al canal autenticado, como se describe en la sección [envío de consultas de canal autenticado](#sending-authenticated-channel-queries).</span><span class="sxs-lookup"><span data-stu-id="db265-219">Verify the channel type by sending a [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) query to the authenticated channel, as described in the section [Sending Authenticated Channel Queries](#sending-authenticated-channel-queries).</span></span> <span data-ttu-id="db265-220">Compruebe que el tipo de canal coincide con lo que especificó en el método [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="db265-220">Check that the channel type matches what you specified in the [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) method.</span></span>

### <a name="3-configure-the-cryptographic-session"></a><span data-ttu-id="db265-221">3. configurar la sesión criptográfica</span><span class="sxs-lookup"><span data-stu-id="db265-221">3. Configure the Cryptographic Session</span></span>

<span data-ttu-id="db265-222">A continuación, configure la sesión criptográfica y establezca la clave de sesión.</span><span class="sxs-lookup"><span data-stu-id="db265-222">Next, configure the cryptographic session and establish the session key.</span></span>

1.  <span data-ttu-id="db265-223">Llame a [**ID3D11VideoDevice:: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) para crear la sesión criptográfica.</span><span class="sxs-lookup"><span data-stu-id="db265-223">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) to create the cryptographic session.</span></span> <span data-ttu-id="db265-224">Este método devuelve un puntero a la interfaz [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) .</span><span class="sxs-lookup"><span data-stu-id="db265-224">This method returns a pointer to the [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) interface.</span></span>
2.  <span data-ttu-id="db265-225">Llame a [**ID3D11CryptoSession:: GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) para obtener el tamaño del certificado X. 509 del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-225">Call [**ID3D11CryptoSession::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="db265-226">Asigne un búfer del tamaño requerido.</span><span class="sxs-lookup"><span data-stu-id="db265-226">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="db265-227">Llame a [**ID3D11CryptoSession:: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) para obtener el certificado.</span><span class="sxs-lookup"><span data-stu-id="db265-227">Call [**ID3D11CryptoSession::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) to get the certificate.</span></span> <span data-ttu-id="db265-228">El método copia el certificado en el búfer que se asignó en el paso anterior.</span><span class="sxs-lookup"><span data-stu-id="db265-228">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="db265-229">Compruebe que el certificado del controlador está firmado por Microsoft y que no se ha revocado.</span><span class="sxs-lookup"><span data-stu-id="db265-229">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="db265-230">Obtiene la clave pública del certificado.</span><span class="sxs-lookup"><span data-stu-id="db265-230">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="db265-231">Generar una clave de sesión RSA aleatoria.</span><span class="sxs-lookup"><span data-stu-id="db265-231">Generate a random RSA session key.</span></span> <span data-ttu-id="db265-232">Se trata de una clave de sesión independiente de la clave de sesión del canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-232">This is a separate session key from the authenticated channel session key.</span></span> <span data-ttu-id="db265-233">Cifre la clave de sesión mediante la clave pública del controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-233">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="db265-234">Llame a [**ID3D11VideoContext:: NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) para enviar la clave de sesión cifrada al controlador.</span><span class="sxs-lookup"><span data-stu-id="db265-234">Call [**ID3D11VideoContext::NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="db265-235">Si las capacidades de protección de contenido incluyen **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, cree una clave de contenido RSA aleatoria.</span><span class="sxs-lookup"><span data-stu-id="db265-235">If the content protection capabilities include **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, create a random RSA content key.</span></span> <span data-ttu-id="db265-236">Se usará más adelante en el proceso de descodificación.</span><span class="sxs-lookup"><span data-stu-id="db265-236">This will be used later in the decoding process.</span></span>

### <a name="4-associate-the-decoder-with-the-cryptographic-session"></a><span data-ttu-id="db265-237">4. asociar el descodificador a la sesión criptográfica</span><span class="sxs-lookup"><span data-stu-id="db265-237">4. Associate the decoder with the Cryptographic Session</span></span>

<span data-ttu-id="db265-238">A continuación, asocie el dispositivo descodificador con el dispositivo Direct3D 11 y la sesión de cifrado, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="db265-238">Next, associate the decoder device with the Direct3D11 device and the cryptographic session, as follows:</span></span>

1.  <span data-ttu-id="db265-239">Obtener un identificador para el dispositivo Direct3D 11 mediante el envío de una consulta [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) al canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-239">Get a handle to the Direct3D11 device, by sending a [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) query to the authenticated channel.</span></span>
2.  <span data-ttu-id="db265-240">Rellene una estructura de [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) con la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="db265-240">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) structure with the following information:</span></span>
    -   <span data-ttu-id="db265-241">Establezca el miembro **DecodeHandle** en el identificador devuelto de [**ID3D11VideoDecoder:: GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span><span class="sxs-lookup"><span data-stu-id="db265-241">Set the **DecodeHandle** member to the handle returned from [**ID3D11VideoDecoder::GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span></span>
    -   <span data-ttu-id="db265-242">Establezca el miembro **CryptoSessionHandle** en el identificador devuelto de [**ID3D11CryptoSession:: GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span><span class="sxs-lookup"><span data-stu-id="db265-242">Set the **CryptoSessionHandle** member to the handle returned from [**ID3D11CryptoSession::GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span></span>
    -   <span data-ttu-id="db265-243">Establezca el miembro **DeviceHandle** en el identificador de dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="db265-243">Set the **DeviceHandle** member to the Direct3D11 device handle.</span></span>
3.  <span data-ttu-id="db265-244">Llame a [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) para enviar un comando [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) al canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-244">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) to send a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) command to the authenticated channel.</span></span>

<span data-ttu-id="db265-245">En el diagrama siguiente se muestra el intercambio de identificadores:</span><span class="sxs-lookup"><span data-stu-id="db265-245">The following diagram illustrates the exchange of handles:</span></span>

![diagrama que muestra cómo el descodificador de DXVA está asociado a la sesión criptográfica.](images/d3d9video03.png)

<span data-ttu-id="db265-247">Ahora, el descodificador de software puede usar la clave de sesión criptográfica para cifrar los búferes de vídeo comprimidos.</span><span class="sxs-lookup"><span data-stu-id="db265-247">The software decoder can now use the cryptographic session key to encrypt the compressed video buffers.</span></span> <span data-ttu-id="db265-248">Cada búfer comprimido tendrá su propio vector de inicialización (IV) especificado en el miembro **PIV** de la estructura [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) .</span><span class="sxs-lookup"><span data-stu-id="db265-248">Each compressed buffer will have its own initialization vector (IV) specified in the **pIV** member of the [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) structure.</span></span>

## <a name="sending-authenticated-channel-commands"></a><span data-ttu-id="db265-249">Envío de comandos de canal autenticado</span><span class="sxs-lookup"><span data-stu-id="db265-249">Sending Authenticated Channel Commands</span></span>

<span data-ttu-id="db265-250">Se define un conjunto de comandos para configurar el canal autenticado y establecer varias protecciones de contenido.</span><span class="sxs-lookup"><span data-stu-id="db265-250">A set of commands are defined for configuring the authenticated channel and setting various content protections.</span></span> <span data-ttu-id="db265-251">Para obtener una lista de comandos, vea [comandos Content Protection](content-protection-commands.md).</span><span class="sxs-lookup"><span data-stu-id="db265-251">For a list of commands, see [Content Protection Commands](content-protection-commands.md).</span></span>

<span data-ttu-id="db265-252">Para enviar un comando al canal autenticado, realice los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="db265-252">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="db265-253">Rellene la estructura de datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="db265-253">Fill in the input data structure.</span></span> <span data-ttu-id="db265-254">Esta estructura de datos siempre es una estructura de [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) seguido de campos adicionales.</span><span class="sxs-lookup"><span data-stu-id="db265-254">This data structure is always a [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) structure followed by additional fields.</span></span> <span data-ttu-id="db265-255">Rellene la estructura **D3D11_AUTHENTICATED_CONFIGURE_INPUT** como se muestra en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="db265-255">Fill in the **D3D11_AUTHENTICATED_CONFIGURE_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="db265-256">Miembro</span><span class="sxs-lookup"><span data-stu-id="db265-256">Member</span></span></th>
    <th><span data-ttu-id="db265-257">Descripción</span><span class="sxs-lookup"><span data-stu-id="db265-257">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="db265-258"><strong>omac</strong></span><span class="sxs-lookup"><span data-stu-id="db265-258"><strong>omac</strong></span></span></td>
    <td><span data-ttu-id="db265-259">Omitir este campo por ahora.</span><span class="sxs-lookup"><span data-stu-id="db265-259">Skip this field for now.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="db265-260"><strong>ConfigureType</strong></span><span class="sxs-lookup"><span data-stu-id="db265-260"><strong>ConfigureType</strong></span></span></td>
    <td><span data-ttu-id="db265-261">GUID que identifica el comando.</span><span class="sxs-lookup"><span data-stu-id="db265-261">GUID that identifies the command.</span></span> <span data-ttu-id="db265-262">Para obtener una lista de comandos, vea <a href="content-protection-commands.md">comandos Content Protection</a>.</span><span class="sxs-lookup"><span data-stu-id="db265-262">For a list of commands, see <a href="content-protection-commands.md">Content Protection Commands</a>.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="db265-263"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="db265-263"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="db265-264">Identificador del canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-264">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="db265-265"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="db265-265"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="db265-266">El número de secuencia global.</span><span class="sxs-lookup"><span data-stu-id="db265-266">The sequence number.</span></span> <span data-ttu-id="db265-267">El primer número de secuencia se especifica mediante el envío de un comando <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="db265-267">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="db265-268">Cada vez que envíe otro comando, incremente este número en 1.</span><span class="sxs-lookup"><span data-stu-id="db265-268">Each time you send another command, increment this number by 1.</span></span> <span data-ttu-id="db265-269">El número de secuencia se protege contra los ataques de reproducción.</span><span class="sxs-lookup"><span data-stu-id="db265-269">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="db265-270">Se usan dos números de secuencia independientes, uno para los comandos y otro para las consultas.</span><span class="sxs-lookup"><span data-stu-id="db265-270">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="db265-271">Calcule la etiqueta OMAC para el bloque de datos que aparece después del miembro **OMAC** de la estructura de entrada.</span><span class="sxs-lookup"><span data-stu-id="db265-271">Calculate the OMAC tag for the block of data that appears after the **omac** member of the input structure.</span></span> <span data-ttu-id="db265-272">A continuación, copie este valor de etiqueta en el miembro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="db265-272">Then copy this tag value into the **omac** member.</span></span>
3.  <span data-ttu-id="db265-273">Llame a [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="db265-273">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span></span>
4.  <span data-ttu-id="db265-274">El controlador coloca el resultado del comando en la estructura [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) .</span><span class="sxs-lookup"><span data-stu-id="db265-274">The driver places the output from the command in the [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) structure.</span></span>
5.  <span data-ttu-id="db265-275">Calcule la etiqueta OMAC para el bloque de datos que aparece después del miembro **OMAC** de la estructura de salida.</span><span class="sxs-lookup"><span data-stu-id="db265-275">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="db265-276">Compárelo con el valor del miembro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="db265-276">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="db265-277">Se produce un error si no coinciden.</span><span class="sxs-lookup"><span data-stu-id="db265-277">Fail if they do not match.</span></span>
6.  <span data-ttu-id="db265-278">Compare los valores de los miembros **ConfigureType**, **hChannel** y **SequenceNumber** en la estructura de salida con los valores de esos miembros.</span><span class="sxs-lookup"><span data-stu-id="db265-278">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="db265-279">Se produce un error si no coinciden.</span><span class="sxs-lookup"><span data-stu-id="db265-279">Fail if they do not match.</span></span>
7.  <span data-ttu-id="db265-280">Incremente el número de secuencia para el siguiente comando.</span><span class="sxs-lookup"><span data-stu-id="db265-280">Increment the sequence number for the next command.</span></span>

## <a name="sending-authenticated-channel-queries"></a><span data-ttu-id="db265-281">Envío de consultas de canales autenticadas</span><span class="sxs-lookup"><span data-stu-id="db265-281">Sending Authenticated Channel Queries</span></span>

<span data-ttu-id="db265-282">Se define un conjunto de consultas para recuperar información sobre el canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-282">A set of queries are defined for retrieving information about the authenticated channel.</span></span> <span data-ttu-id="db265-283">Para obtener una lista de consultas, vea [consultas de Content Protection](content-protection-queries.md).</span><span class="sxs-lookup"><span data-stu-id="db265-283">For a list of queries, see [Content Protection Queries](content-protection-queries.md).</span></span>

<span data-ttu-id="db265-284">Para enviar un comando al canal autenticado, realice los pasos siguientes.</span><span class="sxs-lookup"><span data-stu-id="db265-284">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="db265-285">Rellene la estructura de datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="db265-285">Fill in the input data structure.</span></span> <span data-ttu-id="db265-286">Esta estructura de datos siempre es una estructura de [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) , posiblemente seguida de campos adicionales.</span><span class="sxs-lookup"><span data-stu-id="db265-286">This data structure is always a [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) structure, possibly followed by additional fields.</span></span> <span data-ttu-id="db265-287">Rellene la estructura **D3D11_AUTHENTICATED_QUERY_INPUT** como se muestra en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="db265-287">Fill in the **D3D11_AUTHENTICATED_QUERY_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="db265-288">Miembro</span><span class="sxs-lookup"><span data-stu-id="db265-288">Member</span></span></th>
    <th><span data-ttu-id="db265-289">Descripción</span><span class="sxs-lookup"><span data-stu-id="db265-289">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="db265-290"><strong>QueryType</strong></span><span class="sxs-lookup"><span data-stu-id="db265-290"><strong>QueryType</strong></span></span></td>
    <td><span data-ttu-id="db265-291">GUID que identifica la consulta.</span><span class="sxs-lookup"><span data-stu-id="db265-291">GUID that identifies the query.</span></span> <span data-ttu-id="db265-292">Para obtener una lista de consultas, vea <a href="content-protection-queries.md">consultas de Content Protection</a>.</span><span class="sxs-lookup"><span data-stu-id="db265-292">For a list of queries, see <a href="content-protection-queries.md">Content Protection Queries</a>.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="db265-293"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="db265-293"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="db265-294">Identificador del canal autenticado.</span><span class="sxs-lookup"><span data-stu-id="db265-294">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="db265-295"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="db265-295"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="db265-296">El número de secuencia global.</span><span class="sxs-lookup"><span data-stu-id="db265-296">The sequence number.</span></span> <span data-ttu-id="db265-297">El primer número de secuencia se especifica mediante el envío de un comando <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="db265-297">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="db265-298">Cada vez que envíe otra consulta, incremente este número en 1.</span><span class="sxs-lookup"><span data-stu-id="db265-298">Each time you send another query, increment this number by 1.</span></span> <span data-ttu-id="db265-299">El número de secuencia se protege contra los ataques de reproducción.</span><span class="sxs-lookup"><span data-stu-id="db265-299">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="db265-300">Se usan dos números de secuencia independientes, uno para los comandos y otro para las consultas.</span><span class="sxs-lookup"><span data-stu-id="db265-300">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="db265-301">Llame a [**ID3D11VideoContext:: QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="db265-301">Call [**ID3D11VideoContext::QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span></span>
3.  <span data-ttu-id="db265-302">El controlador coloca el resultado de la consulta en una estructura de [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) .</span><span class="sxs-lookup"><span data-stu-id="db265-302">The driver places the output from the query in a [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) structure.</span></span> <span data-ttu-id="db265-303">Esta estructura va seguida de campos adicionales, en función del tipo de consulta.</span><span class="sxs-lookup"><span data-stu-id="db265-303">This structure is followed by additional fields, depending on the query type.</span></span>
4.  <span data-ttu-id="db265-304">Calcule la etiqueta OMAC para el bloque de datos que aparece después del miembro **OMAC** de la estructura de salida.</span><span class="sxs-lookup"><span data-stu-id="db265-304">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="db265-305">Compárelo con el valor del miembro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="db265-305">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="db265-306">Se produce un error si no coinciden.</span><span class="sxs-lookup"><span data-stu-id="db265-306">Fail if they do not match.</span></span>
5.  <span data-ttu-id="db265-307">Compare los valores de los miembros **ConfigureType**, **hChannel** y **SequenceNumber** en la estructura de salida con los valores de esos miembros.</span><span class="sxs-lookup"><span data-stu-id="db265-307">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="db265-308">Se produce un error si no coinciden.</span><span class="sxs-lookup"><span data-stu-id="db265-308">Fail if they do not match.</span></span>
6.  <span data-ttu-id="db265-309">Incremente el número de secuencia de la siguiente consulta.</span><span class="sxs-lookup"><span data-stu-id="db265-309">Increment the sequence number for the next query.</span></span>

## <a name="related-topics"></a><span data-ttu-id="db265-310">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="db265-310">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="db265-311">API de vídeo de Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="db265-311">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> </dl>

 

 
