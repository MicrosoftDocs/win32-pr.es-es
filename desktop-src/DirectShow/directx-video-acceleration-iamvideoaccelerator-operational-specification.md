---
description: Especificación operativa de DirectX video Acceleration IAMVideoAccelerator
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: Especificación operativa de DirectX video Acceleration IAMVideoAccelerator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "103997653"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="d9890-103">Especificación operativa de DirectX video Acceleration IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="d9890-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="d9890-104">El mecanismo preciso de operación es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="d9890-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="d9890-105">Cada perfil de modo restringido definido en este documento tiene un GUID de DirectX VA asociado, que puede ser compatible con [**IPin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) y [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) de un PIN de entrada de nivel inferior y que se enumeran en [**IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span><span class="sxs-lookup"><span data-stu-id="d9890-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="d9890-106">Del mismo modo, cada tipo de protocolo de cifrado para su uso con DirectX VA tendrá un GUID de tipo de protocolo de cifrado asociado que puede ser compatible con las [**IPin**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) :: QueryAccept y [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) de un PIN de entrada de nivel inferior y que se enumeran en **IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**.</span><span class="sxs-lookup"><span data-stu-id="d9890-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="d9890-107">No se puede enviar el GUID de "no cifrado" de DXVA sin \_ cifrado en esta lista, ya que la compatibilidad con ella es obligatoria y, por tanto, implícita.</span><span class="sxs-lookup"><span data-stu-id="d9890-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="d9890-108">Después de llamar a [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) para intentar una conexión con el PIN de entrada de nivel inferior, el decodificador [**IAMVideoAcceleratorNotify:: GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) devolverá un puntero a una estructura de datos de DXVA \_ ConnectMode que contenga la información del modo de conexión para la conexión.</span><span class="sxs-lookup"><span data-stu-id="d9890-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="d9890-109">[**IAMVideoAccelerator:: GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) se llamará con \* pdwNumTypesCompBuffers = 16 y devolverá información de búfer comprimido en función de la Convención de que el número de tipo de cada búfer (tal y como se define en la sección 3,4 de la especificación de de DirectX va) se puede usar directamente como índice de base cero en la matriz de estructuras de datos de **AMVACompBufferInfo** que se devuelve.</span><span class="sxs-lookup"><span data-stu-id="d9890-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="d9890-110">Esto requiere que para todos los tipos de búfer que no se vayan a usar (incluido el tipo de búfer 0, dado que no hay ningún uso definido de ese tipo de búfer), el controlador de aceleradores proporcionará estructuras de datos AMVACompBufferInfo con alguna forma de valores de parámetro "ficticios" (como dwNumCompBuffers = 0, dwWidthToCreate = 0, dwHeightToCreate = 0 y dwBytesToAllocate = 0).</span><span class="sxs-lookup"><span data-stu-id="d9890-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="d9890-111">Las indicaciones de la función DXVA y los búferes de datos asociados se envían mediante [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="d9890-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="d9890-112">La función DXVA se indica en el parámetro dwFunction de la llamada.</span><span class="sxs-lookup"><span data-stu-id="d9890-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="d9890-113">Las únicas funciones de DXVA que son relevantes para la inicialización son DXVA \_ ConfigQueryOrReplyFunc y DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="d9890-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="d9890-114">Si dwFunction contiene un valor de DXVA \_ ConfigQueryOrReplyFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de configuración, el puntero lpPrivateOutputData para recibir información del acelerador apuntará a un área donde se puede colocar una estructura de datos de configuración alternativa o duplicada, el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero.</span><span class="sxs-lookup"><span data-stu-id="d9890-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="d9890-115">El valor HRESULT devuelto contiene la \_ indicación s OK o s \_ false, o bien, \_ FAIL o e \_ INVALIDARG o algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del Protocolo (por ejemplo, un parámetro de configuración no válido).</span><span class="sxs-lookup"><span data-stu-id="d9890-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="d9890-116">Todas las llamadas a **IAMVideoAccelerator:: Execute** para todos los usos de DXVA \_ ConfigQueryOrReplyFunc deben preceder a todas las demás llamadas a **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="d9890-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="d9890-117">Si dwFunction contiene un DXVA \_ EncryptProtocolFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de protocolo de cifrado que comience por DXVA \_ EncryptProtocolHeader, el puntero lpPrivateOutputData para recibir información del acelerador debe apuntar a un área en la que se puedan colocar los datos que se van a devolver (por ejemplo, un certificado) por el protocolo de cifrado (que comenzará con DXVA \_ EncryptProtocolHeader), el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero.</span><span class="sxs-lookup"><span data-stu-id="d9890-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="d9890-118">El HRESULT devuelto contiene los valores \_ correctos, siempre que el protocolo de cifrado funcione con normalidad y contenga el error e e \_ \_ INVALIDARG o algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del protocolo.</span><span class="sxs-lookup"><span data-stu-id="d9890-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="d9890-119">Después de la inicialización de la operación del modo anterior, la operación real del descodificador continúa como sigue:</span><span class="sxs-lookup"><span data-stu-id="d9890-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="d9890-120">Se llamará a **IAMVideoAccelerator:: BeginFrame** antes de enviar cualquier bDXVA \_ FUNC con parámetros de búfer comprimidos que produzcan escrituras en una superficie de destino sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="d9890-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="d9890-121">El propósito de [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) en DirectX es asociar superficies de destino con valores de índice y notificar al controlador de aceleradores de vídeo de la intención de iniciar la escritura de una superficie para que el controlador pueda responder con una indicación de si la superficie está lista para sobrescribirse.</span><span class="sxs-lookup"><span data-stu-id="d9890-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="d9890-122">La estructura **AMVABeginFrameInfo** pasada en **IAMVideoAccelerator:: BeginFrame** debe contener un puntero pInputData al parámetro de una sola palabra wBeginPictureIndex que coincida con el índice de fotogramas que se pasa a **IAMVideoAccelerator:: BeginFrame** (y dwSizeInputData debe ser 2).</span><span class="sxs-lookup"><span data-stu-id="d9890-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="d9890-123">Este es el índice que se va a usar en un búfer comprimido para que el comando se escriba en la superficie (por ejemplo, para usarse como wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="d9890-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="d9890-124">Cada llamada a **IAMVideoAccelerator:: BeginFrame** se emparejará con una llamada correspondiente a [**IAMVideoAccelerator:: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) tal y como se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="d9890-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="d9890-125">Por ejemplo, si una imagen comprimida se va a descodificar y, a continuación, alfa se combina mediante la combinación de búfer a búfer de front-end con una imagen gráfica, habrá una llamada a **IAMVideoAccelerator:: BeginFrame** antes de descodificar la imagen comprimida en una superficie especificada en wDecodedPictureIndex. después, una llamada a **IAMVideoAccelerator:: EndFrame** después de pasar todos los búferes comprimidos que se usan para descodificar la imagen, una segunda llamada a **IAMVideoAccelerator:: BeginFrame** anterior a la combinación de comandos de mezcla alfa del origen de gráficos con la imagen descodificada en una superficie especificada en wBlendedDestinationIndex y, a continuación, una segunda llamada a **IAMVideoAccelerator:: EndFrame** después de la operación de combinación El puntero pOutputData en AMVABeginFrameInfo debe ser **null** (y dwSizeOutputData debe ser "0").</span><span class="sxs-lookup"><span data-stu-id="d9890-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="d9890-126">El valor HRESULT devuelto por **IAMVideoAccelerator:: BeginFrame** debe ser:</span><span class="sxs-lookup"><span data-stu-id="d9890-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="d9890-127">\_Es correcto si la superficie sin comprimir está disponible y lista para su uso.</span><span class="sxs-lookup"><span data-stu-id="d9890-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="d9890-128">E \_ pendiente si la superficie sin comprimir todavía no está disponible para su uso, pero estará disponible pronto (si la superficie sin comprimir se lee para su presentación y la lectura o visualización de la superficie aún no se ha completado).</span><span class="sxs-lookup"><span data-stu-id="d9890-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="d9890-129">\_Se produce un error en INVALIDARG o en e/s \_ si se detecta un error de protocolo o de formato de datos (como un valor incorrecto de dwSizeInputData o una pOutputData que no es **null** ).</span><span class="sxs-lookup"><span data-stu-id="d9890-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="d9890-130">Las indicaciones de la función DXVA y los búferes de datos asociados se envían mediante **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="d9890-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="d9890-131">\_Se puede indicar más de un valor FUNC de bDXVA en la misma llamada a [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="d9890-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="d9890-132">Los \_ valores FUNC de bDXVA se empaquetarán en el parámetro dwFunction de la llamada, con el primer comando de función en las ocho MSBs, el siguiente comando de los ocho bits siguientes, etc., con los bits restantes rellenados con ceros.</span><span class="sxs-lookup"><span data-stu-id="d9890-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="d9890-133">El valor 0xFF para bDXVA \_ FUNC indica que la función bDXVA \_ se extiende a dos o cuatro bytes.</span><span class="sxs-lookup"><span data-stu-id="d9890-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="d9890-134">Si el segundo byte también es 0xFF, indica que bDXVA \_ FUNC se extiende a cuatro bytes.</span><span class="sxs-lookup"><span data-stu-id="d9890-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="d9890-135">Si los cuatro bits superiores del tercer byte son 0xF o 0X0, esto indica que bDXVA \_ FUNC contiene un DXVA \_ CONFIGQUERYORREPLYFUNC o DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="d9890-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="d9890-136">Los comandos de varios bytes no deben indicar continuación más allá del final de dwFunction.</span><span class="sxs-lookup"><span data-stu-id="d9890-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="d9890-137">El descodificador debe prestar atención para asegurarse de que no existan dependencias secuenciales entre diferentes \_ valores de FUNC bDXVA especificados en la misma llamada a **IAMVideoAccelerator:: ejecute** y que todas las condiciones de carrera posibles (por ejemplo, entre la descodificación de imágenes y la combinación de subimagens, entre la carga de la subimagen y la combinación de subimagens, etc.) se impidan mediante las llamadas adecuadas a **IAMVideoAccelerator:: BeginFrame** y [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) antes de las llamadas posteriores a **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="d9890-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="d9890-138">Si dwFunction contiene un valor de DXVA \_ ConfigQueryOrReplyFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de configuración, el puntero lpPrivateOutputData para recibir información del acelerador apuntará a un área donde se puede colocar una estructura de datos de configuración alternativa o duplicada, el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero.</span><span class="sxs-lookup"><span data-stu-id="d9890-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="d9890-139">El valor HRESULT devuelto contiene la \_ indicación s OK o s \_ false en respuesta a la consulta, o bien, INVALIDARG o e primario \_ \_ algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del Protocolo (por ejemplo, invalid.configun parámetro).</span><span class="sxs-lookup"><span data-stu-id="d9890-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="d9890-140">Todas las llamadas a **IAMVideoAccelerator:: Execute** para todos los usos de DXVA \_ ConfigQueryOrReplyFunc deben preceder a todas las demás llamadas a **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="d9890-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="d9890-141">Si dwFunction contiene un DXVA \_ EncryptProtocolFunc, el puntero lpPrivateInputData para pasar datos al acelerador en esta llamada debe apuntar a una estructura de datos de protocolo de cifrado que comience por DXVA \_ EncryptProtocolHeader, el puntero lpPrivateOutputData para recibir información del acelerador debe apuntar a un área en la que se puedan colocar los datos que se van a devolver (por ejemplo, un certificado) por el protocolo de cifrado (que comenzará con DXVA \_ EncryptProtocolHeader), el puntero pamvaBufferInfo para una matriz de AMVABUFFERINFO debe ser **null** y dwNumBuffers debe ser cero.</span><span class="sxs-lookup"><span data-stu-id="d9890-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="d9890-142">El HRESULT devuelto contiene los valores \_ correctos, siempre que el protocolo de cifrado funcione con normalidad y contenga el error e e \_ \_ INVALIDARG o algún otro HRESULT de indicación de error en caso de que se produzca un problema grave en la ejecución del protocolo.</span><span class="sxs-lookup"><span data-stu-id="d9890-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="d9890-143">Si dwFunction no contiene un DXVA \_ ConfigQueryOrReplyFunc o DXVA \_ EncryptProtocolFunc, el puntero lpPrivateInputData para pasar datos al acelerador debe apuntar a una lista de descripciones de búfer.</span><span class="sxs-lookup"><span data-stu-id="d9890-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="d9890-144">Las primeras cuatro entradas de la estructura de la lista de descripciones de búfer para cada búfer (dwTypeIndex, dwBufferIndex, dwDataOffset y dwDataSize) serán iguales a las de la estructura de datos AMVABUFFERINFO del mismo búfer.</span><span class="sxs-lookup"><span data-stu-id="d9890-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="d9890-145">Si bDXVA \_ FUNC es igual a "1" se especifica en dwFunction y bPicReadbackRequests es "1", el puntero lpPrivateOutputData para recibir información del acelerador apuntará a un área de la memoria persistente (por ejemplo, un montón) que se rellenará con los datos de adaptativo macrobloque de la lectura de la tecla de aceleración (no se garantiza que estos datos estén presentes hasta que **IAMVideoAccelerator:: QueryRenderStatus** para escribir en el mismo búfer de parámetros de imagen indica que es \_ correcto, tal y como se describe en el</span><span class="sxs-lookup"><span data-stu-id="d9890-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="d9890-146">De lo contrario, el puntero lpPrivateOutputData para recibir información del acelerador debe apuntar a un único valor DWORD para que se establezca en uno de los siguientes valores de indicación (especialmente útil para informar de errores de fragmentada en una operación VLD fuera del host).</span><span class="sxs-lookup"><span data-stu-id="d9890-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="d9890-147">Value</span><span class="sxs-lookup"><span data-stu-id="d9890-147">Value</span></span> | <span data-ttu-id="d9890-148">Descripción</span><span class="sxs-lookup"><span data-stu-id="d9890-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="d9890-149">0</span><span class="sxs-lookup"><span data-stu-id="d9890-149">0</span></span>     | <span data-ttu-id="d9890-150">Ejecución correcta.</span><span class="sxs-lookup"><span data-stu-id="d9890-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="d9890-151">1</span><span class="sxs-lookup"><span data-stu-id="d9890-151">1</span></span>     | <span data-ttu-id="d9890-152">Problema leve en el formato de datos detectado.</span><span class="sxs-lookup"><span data-stu-id="d9890-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="d9890-153">2</span><span class="sxs-lookup"><span data-stu-id="d9890-153">2</span></span>     | <span data-ttu-id="d9890-154">Se encontró un problema importante en el formato de datos.</span><span class="sxs-lookup"><span data-stu-id="d9890-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="d9890-155">3</span><span class="sxs-lookup"><span data-stu-id="d9890-155">3</span></span>     | <span data-ttu-id="d9890-156">Se encontró un problema grave en el formato de datos.</span><span class="sxs-lookup"><span data-stu-id="d9890-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="d9890-157">4</span><span class="sxs-lookup"><span data-stu-id="d9890-157">4</span></span>     | <span data-ttu-id="d9890-158">Otro problema grave detectado.</span><span class="sxs-lookup"><span data-stu-id="d9890-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="d9890-159">Si se indica cualquier tipo de problema "grave", el descodificador de software debe dejar de funcionar con las funciones, a menos que se pueda realizar una acción correctiva.</span><span class="sxs-lookup"><span data-stu-id="d9890-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="d9890-160">Los datos devueltos del acelerador no serán leídos por el host hasta que se haya completado la representación del búfer de la imagen, como se puede probar mediante [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span><span class="sxs-lookup"><span data-stu-id="d9890-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="d9890-161">El valor HRESULT devuelto contiene los valores \_ correctos siempre que la operación de interfaz funcione con normalidad y puede devolver e \_ FAIL o e \_ INVALIDARG o algún otro valor HRESULT de indicación de error en caso de que se produzca un problema grave.</span><span class="sxs-lookup"><span data-stu-id="d9890-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="d9890-162">El búfer de parámetros de descodificación de imágenes debe estar entre los primeros búferes enviados para la descodificación de cada imagen al usar [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) con bDXVA \_ FUNC igual a "1", y todos los búferes para descodificar una imagen de un fragmentada se enviarán antes que los búferes para descodificar imágenes posteriores.</span><span class="sxs-lookup"><span data-stu-id="d9890-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="d9890-163">Si se envía un búfer de comandos de control de adaptativo macrobloque, se enviará un búfer de datos de diferencia residual correspondiente (que contiene los datos para el mismo macrobloques) con la misma llamada **IAMVideoAccelerator:: Execute** .</span><span class="sxs-lookup"><span data-stu-id="d9890-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="d9890-164">Se debe llamar a [**IAMVideoAccelerator:: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) una vez que se han enviado todos los búferes comprimidos que provocarán la creación del contenido de salida en una superficie sin comprimir especificada (resultado de las operaciones especificadas para WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex o wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="d9890-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="d9890-165">La finalidad de esta llamada a **IAMVideoAccelerator:: EndFrame** es notificar al hardware del acelerador de vídeo que se han enviado todos los datos necesarios para la operación especificada.</span><span class="sxs-lookup"><span data-stu-id="d9890-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="d9890-166">El puntero a los datos que se van a enviar de nivel inferior a través de **IAMVideoAccelerator:: EndFrame** debe apuntar a una sola palabra wEndPictureIndex que contenga el índice del marco que está finalizando.</span><span class="sxs-lookup"><span data-stu-id="d9890-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="d9890-167">Este parámetro debe coincidir con el valor wBeginPictureIndex especificado en la llamada anterior a [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) antes del envío de los búferes comprimidos pertinentes.</span><span class="sxs-lookup"><span data-stu-id="d9890-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="d9890-168">Después de una llamada a **IAMVideoAccelerator:: EndFrame**, la superficie sin comprimir con el índice wEndPictureIndex no se encontrará en WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex o wPicResampleDestPicIndex de la imagen hasta que se emita otra llamada a **IAMVideoAccelerator:: BeginFrame** para anunciar que esto ocurrirá y se \_ devuelva un resultado correcto.</span><span class="sxs-lookup"><span data-stu-id="d9890-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="d9890-169">Sin embargo, ese índice de superficie de destino puede aparecer en comandos de acceso de lectura posteriores, como wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex o bRefPicSelect \[ i \] .</span><span class="sxs-lookup"><span data-stu-id="d9890-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="d9890-170">El HRESULT devuelto por **IAMVideoAccelerator:: EndFrame** debe ser \_ correcto a menos que haya algún tipo de error de protocolo o de formato de datos, en cuyo caso puede ser e \_ e \_ INVALIDARG o cualquier otra indicación de error.</span><span class="sxs-lookup"><span data-stu-id="d9890-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="d9890-171">En el caso de la descodificación basada en campos (por ejemplo, en MPEG-2 bitstreams), no habrá una asignación uno a uno de las imágenes funcionales en fragmentada a superficies sin comprimir en la interfaz de aceleradores.</span><span class="sxs-lookup"><span data-stu-id="d9890-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="d9890-172">Al descodificar imágenes de campo en un fragmentada de MPEG-2, habrá dos "imágenes" descodificadas para generar una superficie sin comprimir de salida completa.</span><span class="sxs-lookup"><span data-stu-id="d9890-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="d9890-173">En la definición de la interfaz de DirectX VA, cada fotograma corresponde a cada uso de wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex.</span><span class="sxs-lookup"><span data-stu-id="d9890-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="d9890-174">Por lo tanto, se requieren dos pares de llamadas a **IAMVideoAccelerator:: BeginFrame** y **IAMVideoAccelerator:: EndFrame** para la descodificación de imágenes de campo en superficies sin comprimir de salida.</span><span class="sxs-lookup"><span data-stu-id="d9890-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="d9890-175">Una llamada a [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) con dwFlags igual a cero, que tiene lugar después de una llamada a **IAMVideoAccelerator:: EndFrame** con un wEndPictureIndex determinado y comprueba el estado de un búfer que se envió que contenía el WEndPictureIndex en WDecodedPictureIndex, WDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex devolverá una \_ indicación S OK si todas las operaciones para escribir los datos en la superficie sin comprimir se han completado y devolverán E \_ pendientes si la operación no se ha completado todavía.</span><span class="sxs-lookup"><span data-stu-id="d9890-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="d9890-176">\_Se produce un error \_ en e INVALIDARG, o bien se puede devolver cualquier otra indicación de error en caso de que se produzca un error de protocolo.</span><span class="sxs-lookup"><span data-stu-id="d9890-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d9890-177">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d9890-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d9890-178">Asignación de aceleración de vídeo de DirectX a IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="d9890-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



