---
description: Muestra la relación entre los parámetros de función que apuntan a estructuras o matrices y sus datos inicializados.
ms.assetid: 89caf4d3-727f-472b-9a09-e81b4ff4d127
title: Procedimiento para firmar datos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba289928ab39c690e1c44bdbf65c77c18b7edab3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105687593"
---
# <a name="procedure-for-signing-data"></a><span data-ttu-id="485e9-103">Procedimiento para firmar datos</span><span class="sxs-lookup"><span data-stu-id="485e9-103">Procedure for Signing Data</span></span>

<span data-ttu-id="485e9-104">Una sola función, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), realiza todas las tareas enumeradas en [crear un mensaje firmado](creating-a-signed-message.md).</span><span class="sxs-lookup"><span data-stu-id="485e9-104">A single function, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), performs all of the tasks listed in [Creating a Signed Message](creating-a-signed-message.md).</span></span> <span data-ttu-id="485e9-105">Sin embargo, todavía es necesario inicializar las estructuras y otros datos.</span><span class="sxs-lookup"><span data-stu-id="485e9-105">However, initialization of structures and other data is still necessary.</span></span> <span data-ttu-id="485e9-106">En la ilustración siguiente se muestra la relación entre los parámetros de función que apuntan a estructuras o matrices y sus datos inicializados.</span><span class="sxs-lookup"><span data-stu-id="485e9-106">The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data.</span></span> <span data-ttu-id="485e9-107">En la ilustración solo se muestran los parámetros de función y los miembros de estructura que se derivan de otras estructuras o funciones.</span><span class="sxs-lookup"><span data-stu-id="485e9-107">The illustration shows only the function parameters and structure members that are derived from other structures or functions.</span></span> <span data-ttu-id="485e9-108">El resto de los parámetros son inicializaciones sencillas.</span><span class="sxs-lookup"><span data-stu-id="485e9-108">The rest of the parameters are straightforward initializations.</span></span>

![asignación de inicialización para una llamada a cryptsignmessage](images/crypsign.png)

<span data-ttu-id="485e9-110">**Para firmar datos mediante CryptSignMessage**</span><span class="sxs-lookup"><span data-stu-id="485e9-110">**To sign data using CryptSignMessage**</span></span>

1.  <span data-ttu-id="485e9-111">Obtiene un puntero a los datos que se van a firmar.</span><span class="sxs-lookup"><span data-stu-id="485e9-111">Get a pointer to the data that is to be signed.</span></span>
2.  <span data-ttu-id="485e9-112">Asigne el puntero a los datos para indizar cero de una matriz "datos que se van a firmar".</span><span class="sxs-lookup"><span data-stu-id="485e9-112">Assign the pointer to the data to index zero of a "data to be signed" array.</span></span>
3.  <span data-ttu-id="485e9-113">Obtiene un identificador para el proveedor de servicios criptográficos.</span><span class="sxs-lookup"><span data-stu-id="485e9-113">Get a handle to the cryptographic provider.</span></span>
4.  <span data-ttu-id="485e9-114">Abra un [*almacén de certificados*](../secgloss/c-gly.md) que contenga el certificado del firmante.</span><span class="sxs-lookup"><span data-stu-id="485e9-114">Open a [*certificate store*](../secgloss/c-gly.md) that contains the signer's certificate.</span></span>
5.  <span data-ttu-id="485e9-115">Obtenga una dirección para el certificado del firmante.</span><span class="sxs-lookup"><span data-stu-id="485e9-115">Get an address to the signer's certificate.</span></span>
6.  <span data-ttu-id="485e9-116">Asigne la dirección del certificado al índice cero de la matriz *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="485e9-116">Assign the address of the certificate to the zero index of the *MsgCert* array.</span></span>
7.  <span data-ttu-id="485e9-117">Asigne las direcciones de cualquier otro certificado que se va a incluir con el mensaje en la matriz *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="485e9-117">Assign the addresses of any other certificates to be included with the message to the *MsgCert* array.</span></span>
8.  <span data-ttu-id="485e9-118">Inicialice la estructura del [**\_ \_ identificador del algoritmo de cifrado**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) , inicializando el miembro **pszObjId** con el algoritmo hash deseado y los demás miembros según corresponda.</span><span class="sxs-lookup"><span data-stu-id="485e9-118">Initialize the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, initializing the **pszObjId** member to the desired hash algorithm and the other members as appropriate.</span></span>
9.  <span data-ttu-id="485e9-119">Inicialice el [**\_ mensaje de signo de \_ \_ cifrado**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) para la estructura, inicializando el miembro **pSigningCert** con la dirección del certificado del firmante, el miembro de la matriz **MsgCert** en la dirección de los certificados del firmante y otros, el miembro **HashAlgorithm** en la dirección de la estructura del [**identificador del \_ algoritmo \_ de cifrado**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) y los demás miembros según corresponda.</span><span class="sxs-lookup"><span data-stu-id="485e9-119">Initialize the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure, initializing the **pSigningCert** member to the address of the signer's certificate, the **MsgCert** array member to the address of the signer's and other's certificates, the **HashAlgorithm** member to the address of the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, and the other members as appropriate.</span></span>
10. <span data-ttu-id="485e9-120">Llame a la función [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) , pasando [**el \_ \_ mensaje de \_ signo de cifrado**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) para el parámetro *pSignPara* , la dirección de la matriz de "datos que se van a firmar" para el parámetro *rgpbToBeSigned* , una dirección para el parámetro de salida *pbSignedBlob* y los valores para los demás parámetros, según corresponda.</span><span class="sxs-lookup"><span data-stu-id="485e9-120">Call the [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) function, passing the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure for the *pSignPara* parameter, the address of the "data to be signed" array for the *rgpbToBeSigned* parameter, an address for the *pbSignedBlob* output parameter, and values for the other parameters as appropriate.</span></span>

 

 
