---
description: Un bloqueo oportunista (también denominado bloqueo oportunista) es un bloqueo colocado por un cliente en un archivo que reside en un servidor.
ms.assetid: b4c2f5f0-a29b-4598-a49b-da99e93d2991
title: Bloqueos oportunistas
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: faec833caae05bff247a7a3655885b1a967f3435
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103810448"
---
# <a name="opportunistic-locks"></a><span data-ttu-id="5e343-103">Bloqueos oportunistas</span><span class="sxs-lookup"><span data-stu-id="5e343-103">Opportunistic Locks</span></span>

<span data-ttu-id="5e343-104">Un bloqueo oportunista (también denominado bloqueo oportunista) es un bloqueo colocado por un cliente en un archivo que reside en un servidor.</span><span class="sxs-lookup"><span data-stu-id="5e343-104">An opportunistic lock (also called an oplock) is a lock placed by a client on a file residing on a server.</span></span> <span data-ttu-id="5e343-105">En la mayoría de los casos, un cliente solicita un bloqueo oportunista para que pueda almacenar en caché los datos localmente, lo que reduce el tráfico de red y mejora el tiempo de respuesta aparente.</span><span class="sxs-lookup"><span data-stu-id="5e343-105">In most cases, a client requests an opportunistic lock so it can cache data locally, thus reducing network traffic and improving apparent response time.</span></span> <span data-ttu-id="5e343-106">Los redirectores de red usan los bloqueos oportunistas en los clientes con servidores remotos, así como con las aplicaciones cliente en servidores locales.</span><span class="sxs-lookup"><span data-stu-id="5e343-106">Opportunistic locks are used by network redirectors on clients with remote servers, as well as by client applications on local servers.</span></span>

<span data-ttu-id="5e343-107">Los bloqueos oportunistas coordinan el almacenamiento en caché de datos y la coherencia entre clientes y servidores y entre varios clientes.</span><span class="sxs-lookup"><span data-stu-id="5e343-107">Opportunistic locks coordinate data caching and coherency between clients and servers and among multiple clients.</span></span> <span data-ttu-id="5e343-108">Los datos coherentes son los datos que son iguales en la red.</span><span class="sxs-lookup"><span data-stu-id="5e343-108">Data that is coherent is data that is the same across the network.</span></span> <span data-ttu-id="5e343-109">En otras palabras, si los datos son coherentes, se sincronizan los datos del servidor y de todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="5e343-109">In other words, if data is coherent, data on the server and all the clients is synchronized.</span></span>

<span data-ttu-id="5e343-110">Los bloqueos oportunistas no son comandos del cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="5e343-110">Opportunistic locks are not commands by the client to the server.</span></span> <span data-ttu-id="5e343-111">Son solicitudes del cliente al servidor.</span><span class="sxs-lookup"><span data-stu-id="5e343-111">They are requests from the client to the server.</span></span> <span data-ttu-id="5e343-112">Desde el punto de vista del cliente, son oportunistas.</span><span class="sxs-lookup"><span data-stu-id="5e343-112">From the point of view of the client, they are opportunistic.</span></span> <span data-ttu-id="5e343-113">En otras palabras, el servidor concede estos bloqueos siempre que otros factores hagan posibles los bloqueos.</span><span class="sxs-lookup"><span data-stu-id="5e343-113">In other words, the server grants such locks whenever other factors make the locks possible.</span></span>

<span data-ttu-id="5e343-114">Cuando una aplicación local solicita acceso a un archivo remoto, la implementación de bloqueos oportunistas es transparente para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="5e343-114">When a local application requests access to a remote file, the implementation of opportunistic locks is transparent to the application.</span></span> <span data-ttu-id="5e343-115">El redirector de red y el servidor implicaban abrir y cerrar automáticamente los bloqueos oportunistas.</span><span class="sxs-lookup"><span data-stu-id="5e343-115">The network redirector and the server involved open and close the opportunistic locks automatically.</span></span> <span data-ttu-id="5e343-116">Sin embargo, los bloqueos oportunistas también se pueden usar cuando una aplicación local solicita acceso a un archivo local y se debe delegar el acceso a otras aplicaciones y procesos para evitar daños en el archivo.</span><span class="sxs-lookup"><span data-stu-id="5e343-116">However, opportunistic locks can also be used when a local application requests access to a local file, and access by other applications and processes must be delegated to prevent corruption of the file.</span></span> <span data-ttu-id="5e343-117">En este caso, la aplicación local solicita directamente un bloqueo oportunista desde el sistema de archivos local y almacena el archivo en caché localmente.</span><span class="sxs-lookup"><span data-stu-id="5e343-117">In this case, the local application directly requests an opportunistic lock from the local file system and caches the file locally.</span></span> <span data-ttu-id="5e343-118">Cuando se usa de esta manera, el bloqueo oportunista es realmente un semáforo administrado por el servidor local y se usa principalmente con fines de coherencia de datos en la notificación de acceso a archivos y archivos.</span><span class="sxs-lookup"><span data-stu-id="5e343-118">When used in this way, the opportunistic lock is effectively a semaphore managed by the local server, and is mainly used for the purposes of data coherency in the file and file access notification.</span></span>

<span data-ttu-id="5e343-119">Antes de usar bloqueos oportunistas en la aplicación, debe estar familiarizado con los modos de acceso y uso compartido de archivos descritos en [creación y apertura de archivos](creating-and-opening-files.md).</span><span class="sxs-lookup"><span data-stu-id="5e343-119">Before using opportunistic locks in your application, you should be familiar with the file access and sharing modes described in [Creating and Opening Files](creating-and-opening-files.md).</span></span>

<span data-ttu-id="5e343-120">El número máximo de bloqueos oportunistas simultáneos que se pueden crear solo está limitado por la cantidad de memoria disponible.</span><span class="sxs-lookup"><span data-stu-id="5e343-120">The maximum number of concurrent opportunistic locks that you can create is limited only by the amount of available memory.</span></span>

<span data-ttu-id="5e343-121">Las aplicaciones locales no deben intentar solicitar bloqueos oportunistas desde servidores remotos.</span><span class="sxs-lookup"><span data-stu-id="5e343-121">Local applications should not attempt to request opportunistic locks from remote servers.</span></span> <span data-ttu-id="5e343-122">[**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) devolverá un error si se realiza un intento para hacerlo.</span><span class="sxs-lookup"><span data-stu-id="5e343-122">An error will be returned by [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) if an attempt is made to do this.</span></span>

<span data-ttu-id="5e343-123">Los bloqueos oportunistas son de uso muy limitado para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="5e343-123">Opportunistic locks are of very limited use for applications.</span></span> <span data-ttu-id="5e343-124">El único uso práctico es probar un redirector de red o un controlador de bloqueo oportunista del servidor.</span><span class="sxs-lookup"><span data-stu-id="5e343-124">The only practical use is to test a network redirector or a server opportunistic lock handler.</span></span> <span data-ttu-id="5e343-125">Normalmente, los sistemas de archivos implementan la compatibilidad con bloqueos oportunistas.</span><span class="sxs-lookup"><span data-stu-id="5e343-125">Typically, file systems implement support for opportunistic locks.</span></span> <span data-ttu-id="5e343-126">Las aplicaciones suelen dejar la administración de bloqueos oportunistas en los controladores del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="5e343-126">Applications generally leave opportunistic lock management to the file system drivers.</span></span> <span data-ttu-id="5e343-127">Cualquier persona que implemente un sistema de archivos debe usar el [Kit del sistema de archivos instalables (IFS)](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span><span class="sxs-lookup"><span data-stu-id="5e343-127">Anyone implementing a file system should use the [Installable File System (IFS) Kit](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span></span> <span data-ttu-id="5e343-128">Cualquier persona que desarrolle un controlador de dispositivo que no sea un sistema de archivos instalable debe usar el [Kit de controladores de Windows (WDK)](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="5e343-128">Anyone developing a device driver other than an installable file system should use the [Windows Driver Kit (WDK)](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="5e343-129">Los bloqueos oportunistas y las operaciones asociadas son un superconjunto de la parte del bloqueo oportunista del Protocolo de sistema de archivos de Internet común (CIFS), un borrador de Internet.</span><span class="sxs-lookup"><span data-stu-id="5e343-129">Opportunistic locks and the associated operations are a superset of the opportunistic lock portion of the Common Internet File System (CIFS) protocol, an Internet Draft.</span></span> <span data-ttu-id="5e343-130">El protocolo CIFS es una versión mejorada del Protocolo de bloque de mensajes del servidor (SMB).</span><span class="sxs-lookup"><span data-stu-id="5e343-130">The CIFS protocol is an enhanced version of the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="5e343-131">Para obtener más información, vea [información general sobre el protocolo SMB de Microsoft y el protocolo CIFS](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5e343-131">For more information, see [Microsoft SMB Protocol and CIFS Protocol Overview](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span></span> <span data-ttu-id="5e343-132">El borrador de Internet de CIFS identifica explícitamente que una implementación de CIFS puede implementar bloqueos oportunistas mediante la negación de concesión.</span><span class="sxs-lookup"><span data-stu-id="5e343-132">The CIFS Internet Draft explicitly identifies that a CIFS implementation may implement opportunistic locks by refusing to grant them.</span></span>

<span data-ttu-id="5e343-133">En los temas siguientes se identifican los bloqueos oportunistas.</span><span class="sxs-lookup"><span data-stu-id="5e343-133">The following topics identify opportunistic locks.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="5e343-134">En esta sección</span><span class="sxs-lookup"><span data-stu-id="5e343-134">In this section</span></span>



| <span data-ttu-id="5e343-135">Tema</span><span class="sxs-lookup"><span data-stu-id="5e343-135">Topic</span></span>                                                                                                               | <span data-ttu-id="5e343-136">Descripción</span><span class="sxs-lookup"><span data-stu-id="5e343-136">Description</span></span>                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="5e343-137">Almacenamiento en caché local</span><span class="sxs-lookup"><span data-stu-id="5e343-137">Local Caching</span></span>](local-caching.md)<br/>                                                                       | <span data-ttu-id="5e343-138">El *almacenamiento en caché local* de los datos es una técnica que se usa para agilizar el acceso a la red a los archivos de datos.</span><span class="sxs-lookup"><span data-stu-id="5e343-138">*Local caching* of data is a technique used to speed network access to data files.</span></span> <span data-ttu-id="5e343-139">Implica almacenar datos en caché en los clientes en lugar de en servidores cuando sea posible.</span><span class="sxs-lookup"><span data-stu-id="5e343-139">It involves caching data on clients rather than on servers when possible.</span></span><br/>                                                                                                                           |
| [<span data-ttu-id="5e343-140">Coherencia de datos</span><span class="sxs-lookup"><span data-stu-id="5e343-140">Data Coherency</span></span>](data-coherency.md)<br/>                                                                     | <span data-ttu-id="5e343-141">Si los datos son coherentes, se sincronizan los datos del servidor y de todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="5e343-141">If data is coherent, data on the server and all the clients is synchronized.</span></span> <span data-ttu-id="5e343-142">Un tipo de sistema de software que proporciona la coherencia de datos es un sistema de control de revisiones (RCS).</span><span class="sxs-lookup"><span data-stu-id="5e343-142">One type of software system that provides data coherency is a revision control system (RCS).</span></span><br/>                                                                                                              |
| [<span data-ttu-id="5e343-143">Cómo solicitar un bloqueo oportunista</span><span class="sxs-lookup"><span data-stu-id="5e343-143">How to Request an Opportunistic Lock</span></span>](how-to-request-an-opportunistic-lock.md)<br/>                         | <span data-ttu-id="5e343-144">Los bloqueos oportunistas se solicitan abriendo primero un archivo con permisos y marcas adecuadas para la aplicación que abre el archivo.</span><span class="sxs-lookup"><span data-stu-id="5e343-144">Opportunistic locks are requested by first opening a file with permissions and flags appropriate to the application opening the file.</span></span> <span data-ttu-id="5e343-145">Todos los archivos para los que se solicitarán bloqueos oportunistas se deben abrir para una operación superpuesta (asincrónica).</span><span class="sxs-lookup"><span data-stu-id="5e343-145">All files for which opportunistic locks will be requested must be opened for overlapped (asynchronous) operation.</span></span><br/>                                |
| [<span data-ttu-id="5e343-146">Respuesta del servidor para abrir solicitudes en archivos bloqueados</span><span class="sxs-lookup"><span data-stu-id="5e343-146">Server Response to Open Requests on Locked Files</span></span>](server-response-to-open-requests-on-locked-files.md)<br/> | <span data-ttu-id="5e343-147">Puede minimizar el impacto que tiene la aplicación en otros clientes y el impacto que tienen en la aplicación al conceder tantos recursos compartidos como sea posible, solicitar el nivel de acceso mínimo necesario y usar el menos bloqueo oportunista intrusivo adecuado para su aplicación.</span><span class="sxs-lookup"><span data-stu-id="5e343-147">You can minimize the impact your application has on other clients and the impact they have on your application by granting as much sharing as possible, requesting the minimum access level necessary, and using the least intrusive opportunistic lock suitable for your application.</span></span><br/> |
| [<span data-ttu-id="5e343-148">Tipos de bloqueos oportunistas</span><span class="sxs-lookup"><span data-stu-id="5e343-148">Types of Opportunistic Locks</span></span>](types-of-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="5e343-149">Describe los bloqueos oportunistas de nivel 1, nivel 2, Batch y Filter.</span><span class="sxs-lookup"><span data-stu-id="5e343-149">Describes level 1, level 2, batch, and filter opportunistic locks.</span></span><br/>                                                                                                                                                                                                                     |
| [<span data-ttu-id="5e343-150">Interrumpir bloqueos oportunistas</span><span class="sxs-lookup"><span data-stu-id="5e343-150">Breaking Opportunistic Locks</span></span>](breaking-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="5e343-151">Interrumpir un bloqueo oportunista es el proceso de degradar el bloqueo que un cliente tiene en un archivo para que otro cliente pueda abrir el archivo, con o sin un bloqueo oportunista.</span><span class="sxs-lookup"><span data-stu-id="5e343-151">Breaking an opportunistic lock is the process of degrading the lock that one client has on a file so that another client can open the file, with or without an opportunistic lock.</span></span><br/>                                                                                                     |
| [<span data-ttu-id="5e343-152">Ejemplos de bloqueos oportunistas</span><span class="sxs-lookup"><span data-stu-id="5e343-152">Opportunistic Lock Examples</span></span>](opportunistic-lock-examples.md)<br/>                                           | <span data-ttu-id="5e343-153">Diagramas de vistas de tráfico de red para un bloqueo oportunista de nivel 1, un bloqueo oportunista de lotes y un bloqueo oportunista de filtro.</span><span class="sxs-lookup"><span data-stu-id="5e343-153">Diagrams of network-traffic views for a level 1 opportunistic lock, a batch opportunistic lock, and a filter opportunistic lock.</span></span><br/>                                                                                                                                                       |
| [<span data-ttu-id="5e343-154">Operaciones de bloqueo oportunista</span><span class="sxs-lookup"><span data-stu-id="5e343-154">Opportunistic Lock Operations</span></span>](opportunistic-lock-operations.md)<br/>                                       | <span data-ttu-id="5e343-155">Si una aplicación solicita bloqueos oportunistas, todos los archivos para los que solicita bloqueos deben abrirse para la entrada y salida superpuestas (asincrónicas) mediante la función [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) con la marca de la **marca de archivo \_ \_ superpuesta** .</span><span class="sxs-lookup"><span data-stu-id="5e343-155">If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span><br/>                                   |



 

<span data-ttu-id="5e343-156">Para obtener más información sobre los bloqueos oportunistas, consulte el documento de borrador de Internet de CIFS.</span><span class="sxs-lookup"><span data-stu-id="5e343-156">For additional information about opportunistic locks, see the CIFS Internet Draft document.</span></span> <span data-ttu-id="5e343-157">Las discrepancias entre este tema y el borrador de Internet de CIFS actual deben resolverse en favor del borrador de Internet de CIFS.</span><span class="sxs-lookup"><span data-stu-id="5e343-157">Any discrepancies between this topic and the current CIFS Internet Draft should be resolved in favor of the CIFS Internet Draft.</span></span>

 

