---
description: Un archivo DLL puede especificar opcionalmente una función de punto de entrada.
ms.assetid: ec035fc6-0a6f-4e52-a4cc-8d7a25a94366
title: Dynamic-Link biblioteca Entry-Point función
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b62bff557bfa2aa792b420e8fe1856bbe0726921
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "103811480"
---
# <a name="dynamic-link-library-entry-point-function"></a><span data-ttu-id="adf33-103">Dynamic-Link biblioteca Entry-Point función</span><span class="sxs-lookup"><span data-stu-id="adf33-103">Dynamic-Link Library Entry-Point Function</span></span>

<span data-ttu-id="adf33-104">Un archivo DLL puede especificar opcionalmente una función de punto de entrada.</span><span class="sxs-lookup"><span data-stu-id="adf33-104">A DLL can optionally specify an entry-point function.</span></span> <span data-ttu-id="adf33-105">Si está presente, el sistema llama a la función de punto de entrada cada vez que un proceso o subproceso carga o descarga el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="adf33-105">If present, the system calls the entry-point function whenever a process or thread loads or unloads the DLL.</span></span> <span data-ttu-id="adf33-106">Se puede usar para realizar tareas sencillas de inicialización y limpieza.</span><span class="sxs-lookup"><span data-stu-id="adf33-106">It can be used to perform simple initialization and cleanup tasks.</span></span> <span data-ttu-id="adf33-107">Por ejemplo, puede configurar el almacenamiento local de subprocesos cuando se crea un nuevo subproceso y limpiarlo cuando se termina el subproceso.</span><span class="sxs-lookup"><span data-stu-id="adf33-107">For example, it can set up thread local storage when a new thread is created, and clean it up when the thread is terminated.</span></span>

<span data-ttu-id="adf33-108">Si va a vincular el archivo DLL con la biblioteca en tiempo de ejecución de C, puede proporcionar una función de punto de entrada y permitirle proporcionar una función de inicialización independiente.</span><span class="sxs-lookup"><span data-stu-id="adf33-108">If you are linking your DLL with the C run-time library, it may provide an entry-point function for you, and allow you to provide a separate initialization function.</span></span> <span data-ttu-id="adf33-109">Consulte la documentación de la biblioteca en tiempo de ejecución para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="adf33-109">Check the documentation for your run-time library for more information.</span></span>

<span data-ttu-id="adf33-110">Si proporciona su propio punto de entrada, vea la función [**DllMain**](dllmain.md) .</span><span class="sxs-lookup"><span data-stu-id="adf33-110">If you are providing your own entry-point, see the [**DllMain**](dllmain.md) function.</span></span> <span data-ttu-id="adf33-111">El nombre **DllMain** es un marcador de posición para una función definida por el usuario.</span><span class="sxs-lookup"><span data-stu-id="adf33-111">The name **DllMain** is a placeholder for a user-defined function.</span></span> <span data-ttu-id="adf33-112">Debe especificar el nombre real que utilizará al compilar el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="adf33-112">You must specify the actual name you use when you build your DLL.</span></span> <span data-ttu-id="adf33-113">Para obtener más información, consulte la documentación que se incluye con las herramientas de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="adf33-113">For more information, see the documentation included with your development tools.</span></span>

## <a name="calling-the-entry-point-function"></a><span data-ttu-id="adf33-114">Llamar a la función Entry-Point</span><span class="sxs-lookup"><span data-stu-id="adf33-114">Calling the Entry-Point Function</span></span>

<span data-ttu-id="adf33-115">El sistema llama a la función de punto de entrada cuando se produce cualquiera de los siguientes eventos:</span><span class="sxs-lookup"><span data-stu-id="adf33-115">The system calls the entry-point function whenever any one of the following events occurs:</span></span>

-   <span data-ttu-id="adf33-116">Un proceso carga el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="adf33-116">A process loads the DLL.</span></span> <span data-ttu-id="adf33-117">Para los procesos que usan la vinculación dinámica en tiempo de carga, el archivo DLL se carga durante la inicialización del proceso.</span><span class="sxs-lookup"><span data-stu-id="adf33-117">For processes using load-time dynamic linking, the DLL is loaded during process initialization.</span></span> <span data-ttu-id="adf33-118">Para los procesos que usan la vinculación en tiempo de ejecución, el archivo DLL se carga antes de que se devuelva [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) .</span><span class="sxs-lookup"><span data-stu-id="adf33-118">For processes using run-time linking, the DLL is loaded before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns.</span></span>
-   <span data-ttu-id="adf33-119">Un proceso descarga el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="adf33-119">A process unloads the DLL.</span></span> <span data-ttu-id="adf33-120">El archivo DLL se descarga cuando finaliza el proceso o llama a la función [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) y el recuento de referencias se convierte en cero.</span><span class="sxs-lookup"><span data-stu-id="adf33-120">The DLL is unloaded when the process terminates or calls the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function and the reference count becomes zero.</span></span> <span data-ttu-id="adf33-121">Si el proceso finaliza como resultado de la función [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess) o [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) , el sistema no llama a la función de punto de entrada del archivo dll.</span><span class="sxs-lookup"><span data-stu-id="adf33-121">If the process terminates as a result of the [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess) or [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) function, the system does not call the DLL entry-point function.</span></span>
-   <span data-ttu-id="adf33-122">Se crea un nuevo subproceso en un proceso que ha cargado el archivo DLL.</span><span class="sxs-lookup"><span data-stu-id="adf33-122">A new thread is created in a process that has loaded the DLL.</span></span> <span data-ttu-id="adf33-123">Puede usar la función [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) para deshabilitar la notificación cuando se crean subprocesos.</span><span class="sxs-lookup"><span data-stu-id="adf33-123">You can use the [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) function to disable notification when threads are created.</span></span>
-   <span data-ttu-id="adf33-124">Un subproceso de un proceso que ha cargado el archivo DLL finaliza con normalidad, sin usar [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) o [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="adf33-124">A thread of a process that has loaded the DLL terminates normally, not using [**TerminateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminatethread) or [**TerminateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="adf33-125">Cuando un proceso descarga el archivo DLL, solo se llama una vez a la función de punto de entrada para todo el proceso, en lugar de una vez por cada subproceso existente del proceso.</span><span class="sxs-lookup"><span data-stu-id="adf33-125">When a process unloads the DLL, the entry-point function is called only once for the entire process, rather than once for each existing thread of the process.</span></span> <span data-ttu-id="adf33-126">Puede usar [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) para deshabilitar la notificación cuando finalicen los subprocesos.</span><span class="sxs-lookup"><span data-stu-id="adf33-126">You can use [**DisableThreadLibraryCalls**](/windows/win32/api/libloaderapi/nf-libloaderapi-disablethreadlibrarycalls) to disable notification when threads are terminated.</span></span>

<span data-ttu-id="adf33-127">Solo un subproceso a la vez puede llamar a la función de punto de entrada.</span><span class="sxs-lookup"><span data-stu-id="adf33-127">Only one thread at a time can call the entry-point function.</span></span>

<span data-ttu-id="adf33-128">El sistema llama a la función de punto de entrada en el contexto del proceso o subproceso que provocó la llamada a la función.</span><span class="sxs-lookup"><span data-stu-id="adf33-128">The system calls the entry-point function in the context of the process or thread that caused the function to be called.</span></span> <span data-ttu-id="adf33-129">Esto permite a un archivo DLL utilizar su función de punto de entrada para asignar memoria en el espacio de direcciones virtuales del proceso de llamada o para abrir identificadores accesibles para el proceso.</span><span class="sxs-lookup"><span data-stu-id="adf33-129">This allows a DLL to use its entry-point function for allocating memory in the virtual address space of the calling process or to open handles accessible to the process.</span></span> <span data-ttu-id="adf33-130">La función de punto de entrada también puede asignar memoria que es privada para un nuevo subproceso mediante el almacenamiento local de subprocesos (TLS).</span><span class="sxs-lookup"><span data-stu-id="adf33-130">The entry-point function can also allocate memory that is private to a new thread by using thread local storage (TLS).</span></span> <span data-ttu-id="adf33-131">Para obtener más información sobre el almacenamiento local de subprocesos, vea [almacenamiento local para el subproceso](/windows/desktop/ProcThread/thread-local-storage).</span><span class="sxs-lookup"><span data-stu-id="adf33-131">For more information about thread local storage, see [Thread Local Storage](/windows/desktop/ProcThread/thread-local-storage).</span></span>

## <a name="entry-point-function-definition"></a><span data-ttu-id="adf33-132">Definición de la función Entry-Point</span><span class="sxs-lookup"><span data-stu-id="adf33-132">Entry-Point Function Definition</span></span>

<span data-ttu-id="adf33-133">La función de punto de entrada de DLL se debe declarar con la Convención de llamada de llamada estándar.</span><span class="sxs-lookup"><span data-stu-id="adf33-133">The DLL entry-point function must be declared with the standard-call calling convention.</span></span> <span data-ttu-id="adf33-134">Si el punto de entrada de DLL no se ha declarado correctamente, no se cargará el archivo DLL y el sistema mostrará un mensaje que indica que el punto de entrada de DLL debe declararse con WINAPI.</span><span class="sxs-lookup"><span data-stu-id="adf33-134">If the DLL entry point is not declared correctly, the DLL is not loaded, and the system displays a message indicating that the DLL entry point must be declared with WINAPI.</span></span>

<span data-ttu-id="adf33-135">En el cuerpo de la función, puede controlar cualquier combinación de los siguientes escenarios en los que se ha llamado al punto de entrada de la DLL:</span><span class="sxs-lookup"><span data-stu-id="adf33-135">In the body of the function, you may handle any combination of the following scenarios in which the DLL entry point has been called:</span></span>

-   <span data-ttu-id="adf33-136">Un proceso carga el archivo DLL **( \_ \_ adjuntar el proceso dll**).</span><span class="sxs-lookup"><span data-stu-id="adf33-136">A process loads the DLL (**DLL\_PROCESS\_ATTACH**).</span></span>
-   <span data-ttu-id="adf33-137">El proceso actual crea un nuevo subproceso **( \_ \_ Asociación de subprocesos dll**).</span><span class="sxs-lookup"><span data-stu-id="adf33-137">The current process creates a new thread (**DLL\_THREAD\_ATTACH**).</span></span>
-   <span data-ttu-id="adf33-138">Un subproceso se cierra normalmente (la **\_ \_ desasociación de subprocesos dll**).</span><span class="sxs-lookup"><span data-stu-id="adf33-138">A thread exits normally (**DLL\_THREAD\_DETACH**).</span></span>
-   <span data-ttu-id="adf33-139">Un proceso descarga el archivo DLL (**\_ \_ desasociar el proceso dll**).</span><span class="sxs-lookup"><span data-stu-id="adf33-139">A process unloads the DLL (**DLL\_PROCESS\_DETACH**).</span></span>

<span data-ttu-id="adf33-140">La función de punto de entrada debe realizar solo tareas de inicialización simples.</span><span class="sxs-lookup"><span data-stu-id="adf33-140">The entry-point function should perform only simple initialization tasks.</span></span> <span data-ttu-id="adf33-141">No debe llamar a la función [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) (o a una función que llama a estas funciones), ya que esto puede crear bucles de dependencia en el orden de carga de dll.</span><span class="sxs-lookup"><span data-stu-id="adf33-141">It must not call the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) function (or a function that calls these functions), because this may create dependency loops in the DLL load order.</span></span> <span data-ttu-id="adf33-142">Esto puede dar lugar a que se utilice un archivo DLL antes de que el sistema ejecute su código de inicialización.</span><span class="sxs-lookup"><span data-stu-id="adf33-142">This can result in a DLL being used before the system has executed its initialization code.</span></span> <span data-ttu-id="adf33-143">Del mismo modo, la función de punto de entrada no debe llamar a la función [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) (o una función que llame a **FreeLibrary**) durante la terminación del proceso, ya que esto puede dar lugar a que se use un archivo dll después de que el sistema haya ejecutado su código de finalización.</span><span class="sxs-lookup"><span data-stu-id="adf33-143">Similarly, the entry-point function must not call the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function (or a function that calls **FreeLibrary**) during process termination, because this can result in a DLL being used after the system has executed its termination code.</span></span>

<span data-ttu-id="adf33-144">Dado que se garantiza la carga de Kernel32.dll en el espacio de direcciones de proceso cuando se llama a la función de punto de entrada, al llamar a funciones en Kernel32.dll no se usa el archivo DLL antes de que se haya ejecutado el código de inicialización.</span><span class="sxs-lookup"><span data-stu-id="adf33-144">Because Kernel32.dll is guaranteed to be loaded in the process address space when the entry-point function is called, calling functions in Kernel32.dll does not result in the DLL being used before its initialization code has been executed.</span></span> <span data-ttu-id="adf33-145">Por lo tanto, la función de punto de entrada puede crear [objetos de sincronización](/windows/desktop/Sync/synchronization-objects) , como secciones críticas y exclusiones mutuas, y usar TLS, ya que estas funciones se encuentran en Kernel32.dll.</span><span class="sxs-lookup"><span data-stu-id="adf33-145">Therefore, the entry-point function can create [synchronization objects](/windows/desktop/Sync/synchronization-objects) such as critical sections and mutexes, and use TLS, because these functions are located in Kernel32.dll.</span></span> <span data-ttu-id="adf33-146">No es seguro llamar a las funciones del registro, por ejemplo, porque se encuentran en Advapi32.dll.</span><span class="sxs-lookup"><span data-stu-id="adf33-146">It is not safe to call the registry functions, for example, because they are located in Advapi32.dll.</span></span>

<span data-ttu-id="adf33-147">Llamar a otras funciones puede provocar problemas difíciles de diagnosticar.</span><span class="sxs-lookup"><span data-stu-id="adf33-147">Calling other functions may result in problems that are difficult to diagnose.</span></span> <span data-ttu-id="adf33-148">Por ejemplo, llamar a funciones de usuario, Shell y COM puede producir errores de infracción de acceso, ya que algunas funciones de sus archivos dll llaman a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) para cargar otros componentes del sistema.</span><span class="sxs-lookup"><span data-stu-id="adf33-148">For example, calling User, Shell, and COM functions can cause access violation errors, because some functions in their DLLs call [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) to load other system components.</span></span> <span data-ttu-id="adf33-149">Por el contrario, llamar a esas funciones durante la terminación puede provocar errores de infracción de acceso porque es posible que el componente correspondiente ya se haya descargado o no inicializado.</span><span class="sxs-lookup"><span data-stu-id="adf33-149">Conversely, calling those functions during termination can cause access violation errors because the corresponding component may already have been unloaded or uninitialized.</span></span>

<span data-ttu-id="adf33-150">En el ejemplo siguiente se muestra cómo estructurar la función de punto de entrada de DLL.</span><span class="sxs-lookup"><span data-stu-id="adf33-150">The following example demonstrates how to structure the DLL entry-point function.</span></span>

``` syntax
BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,  // handle to DLL module
    DWORD fdwReason,     // reason for calling function
    LPVOID lpReserved )  // reserved
{
    // Perform actions based on the reason for calling.
    switch( fdwReason ) 
    { 
        case DLL_PROCESS_ATTACH:
         // Initialize once for each new process.
         // Return FALSE to fail DLL load.
            break;

        case DLL_THREAD_ATTACH:
         // Do thread-specific initialization.
            break;

        case DLL_THREAD_DETACH:
         // Do thread-specific cleanup.
            break;

        case DLL_PROCESS_DETACH:
         // Perform any necessary cleanup.
            break;
    }
    return TRUE;  // Successful DLL_PROCESS_ATTACH.
}
```

## <a name="entry-point-function-return-value"></a><span data-ttu-id="adf33-151">Entry-Point valor devuelto de la función</span><span class="sxs-lookup"><span data-stu-id="adf33-151">Entry-Point Function Return Value</span></span>

<span data-ttu-id="adf33-152">Cuando se llama a una función de punto de entrada de DLL porque se está cargando un proceso, la función devuelve **true** para indicar que la operación se ha realizado correctamente.</span><span class="sxs-lookup"><span data-stu-id="adf33-152">When a DLL entry-point function is called because a process is loading, the function returns **TRUE** to indicate success.</span></span> <span data-ttu-id="adf33-153">En el caso de los procesos que usan la vinculación de tiempo de carga, un valor devuelto de **false** hace que se produzca un error en la inicialización del proceso y el proceso finalice.</span><span class="sxs-lookup"><span data-stu-id="adf33-153">For processes using load-time linking, a return value of **FALSE** causes the process initialization to fail and the process terminates.</span></span> <span data-ttu-id="adf33-154">Para los procesos que usan la vinculación en tiempo de ejecución, un valor devuelto de FALSE hace que la función [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) devuelva **null**, lo que indica un error.</span><span class="sxs-lookup"><span data-stu-id="adf33-154">For processes using run-time linking, a return value of FALSE causes the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) function to return **NULL**, indicating failure.</span></span> <span data-ttu-id="adf33-155">(El sistema llama inmediatamente a la función de punto de entrada con la **\_ \_ desasociación del proceso de dll** y descarga el archivo dll). El valor devuelto de la función de punto de entrada no se tiene en cuenta cuando se llama a la función por cualquier otro motivo.</span><span class="sxs-lookup"><span data-stu-id="adf33-155">(The system immediately calls your entry-point function with **DLL\_PROCESS\_DETACH** and unloads the DLL.) The return value of the entry-point function is disregarded when the function is called for any other reason.</span></span>

 

 
