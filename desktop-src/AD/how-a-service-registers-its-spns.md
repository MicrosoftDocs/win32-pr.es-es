---
title: Cómo un servicio registra sus SPN
description: Para que un cliente pueda utilizar un SPN para autenticar una instancia de un servicio, el SPN debe estar registrado en la cuenta de usuario o de equipo que la instancia de servicio usará para iniciar sesión.
ms.assetid: 39712c1f-3a9a-4c98-a1cb-879ab0b4cb63
ms.tgt_platform: multiple
keywords:
- Cómo un servicio registra sus SPN AD
- nombre de entidad de seguridad de servicio AD, cómo un servicio registra sus SPN
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74410be3a024fc6accd1d8394e2ba8335be9f550
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "103903115"
---
# <a name="how-a-service-registers-its-spns"></a><span data-ttu-id="4e92c-105">Cómo un servicio registra sus SPN</span><span class="sxs-lookup"><span data-stu-id="4e92c-105">How a Service Registers its SPNs</span></span>

<span data-ttu-id="4e92c-106">Para que un cliente pueda utilizar un SPN para autenticar una instancia de un servicio, el SPN debe estar registrado en la cuenta de usuario o de equipo que la instancia de servicio usará para iniciar sesión.</span><span class="sxs-lookup"><span data-stu-id="4e92c-106">Before a client can use an SPN to authenticate an instance of a service, the SPN must be registered on the user or computer account that the service instance will use to log on.</span></span> <span data-ttu-id="4e92c-107">Normalmente, el registro de SPN se realiza mediante un programa de instalación de servicio que se ejecuta con privilegios de administrador de dominio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-107">Typically, SPN registration is done by a service installation program running with domain administrator privileges.</span></span>

<span data-ttu-id="4e92c-108">El instalador del servicio que instala una instancia de servicio en un equipo host normalmente realiza el procedimiento siguiente.</span><span class="sxs-lookup"><span data-stu-id="4e92c-108">The service installer that installs a service instance on a host computer typically performs the following procedure.</span></span>

<span data-ttu-id="4e92c-109">**Para registrar los SPN para una instancia de servicio**</span><span class="sxs-lookup"><span data-stu-id="4e92c-109">**To register SPNs for a service instance**</span></span>

1.  <span data-ttu-id="4e92c-110">Llame a la función [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) para crear uno o varios SPN únicos para la instancia de servicio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-110">Call the [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) function to create one or more unique SPNs for the service instance.</span></span> <span data-ttu-id="4e92c-111">Para obtener más información, vea [formatos de nombre para SPN únicos](name-formats-for-unique-spns.md).</span><span class="sxs-lookup"><span data-stu-id="4e92c-111">For more information, see [Name Formats for Unique SPNs](name-formats-for-unique-spns.md).</span></span>
2.  <span data-ttu-id="4e92c-112">Llame a la función [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) para registrar los nombres en la cuenta de inicio de sesión del servicio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-112">Call the [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) function to register the names on the service's logon account.</span></span>

<span data-ttu-id="4e92c-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registra los SPN como una propiedad de un usuario o un objeto de cuenta de equipo en el directorio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-113">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) registers SPNs as a property of a user or computer account object in the directory.</span></span> <span data-ttu-id="4e92c-114">los objetos de **usuario** y **equipo** tienen un atributo **ServicePrincipalName** , que es un atributo de varios valores para almacenar todos los SPN asociados a una cuenta de usuario o de equipo.</span><span class="sxs-lookup"><span data-stu-id="4e92c-114">**user** and **computer** objects have a **servicePrincipalName** attribute, which is a multi-valued attribute for storing all the SPNs associated with a user or computer account.</span></span> <span data-ttu-id="4e92c-115">Si el servicio se ejecuta bajo una cuenta de usuario, los SPN se almacenan en el atributo **ServicePrincipalName** de esa cuenta.</span><span class="sxs-lookup"><span data-stu-id="4e92c-115">If the service runs under a user account, the SPNs are stored in the **servicePrincipalName** attribute of that account.</span></span> <span data-ttu-id="4e92c-116">Si el servicio se ejecuta en la cuenta LocalSystem, los SPN se almacenan en el atributo **ServicePrincipalName** de la cuenta del equipo host del servicio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-116">If the service runs in the LocalSystem account, the SPNs are stored in the **servicePrincipalName** attribute of the account of the service's host computer.</span></span> <span data-ttu-id="4e92c-117">El autor de la llamada **DsWriteAccountSpn** debe especificar el nombre distintivo del objeto de cuenta en el que se almacenan los SPN.</span><span class="sxs-lookup"><span data-stu-id="4e92c-117">The **DsWriteAccountSpn** caller must specify the distinguished name of the account object under which the SPNs are stored.</span></span>

<span data-ttu-id="4e92c-118">Para asegurarse de que los SPN registrados están seguros, el atributo **ServicePrincipalName** no se puede escribir directamente; solo se puede escribir llamando a [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="4e92c-118">To ensure that registered SPNs are secure, the **servicePrincipalName** attribute cannot be written directly; it can only be written by calling [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span> <span data-ttu-id="4e92c-119">El autor de la llamada debe tener acceso de escritura al atributo **ServicePrincipalName** de la cuenta de destino.</span><span class="sxs-lookup"><span data-stu-id="4e92c-119">The caller must have write-access to the **servicePrincipalName** attribute of the target account.</span></span> <span data-ttu-id="4e92c-120">Normalmente, el acceso de escritura solo se concede de forma predeterminada a los administradores de dominio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-120">Typically, write access is granted by default only to domain administrators.</span></span> <span data-ttu-id="4e92c-121">Sin embargo, hay un caso especial en el que el sistema permite que un servicio que se ejecuta con la cuenta LocalSystem registre sus propios SPN en la cuenta de equipo del host del servicio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-121">However, there is a special case in which the system allows a service running under the LocalSystem account to register its own SPNs on the computer account of the service's host.</span></span> <span data-ttu-id="4e92c-122">En este caso, el SPN que se está escribiendo debe tener el formato " <service class> / <host> " y " &lt; host &gt; " debe ser el nombre DNS del equipo local.</span><span class="sxs-lookup"><span data-stu-id="4e92c-122">In this case, the SPN being written must have the form "<service class>/<host>" and "&lt;host&gt;" must be the DNS name of the local computer.</span></span>

<span data-ttu-id="4e92c-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) también puede quitar SPN de una cuenta.</span><span class="sxs-lookup"><span data-stu-id="4e92c-123">[**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) can also remove SPNs from an account.</span></span> <span data-ttu-id="4e92c-124">Un parámetro de operación indica si los SPN se van a agregar a la cuenta, se han quitado de la cuenta o se han utilizado para reemplazar completamente todos los SPN actuales de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="4e92c-124">An operation parameter indicates whether the SPNs are to be added to the account, removed from the account, or used to completely replace all current SPNs for the account.</span></span> <span data-ttu-id="4e92c-125">Cuando se desinstala una instancia de servicio, quite los SPN registrados para esa instancia.</span><span class="sxs-lookup"><span data-stu-id="4e92c-125">When a service instance is uninstalled, remove any SPNs registered for that instance.</span></span>

<span data-ttu-id="4e92c-126">Para obtener más información y un ejemplo de código que registre o anule el registro de los SPN de un servicio, consulte [registrar los SPN para un servicio](registering-the-spns-for-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="4e92c-126">For more information and a code example that registers or unregisters a service's SPNs, see [Registering the SPNs for a Service](registering-the-spns-for-a-service.md).</span></span>

<span data-ttu-id="4e92c-127">Los servicios basados en host que usan el formato SPN simple " <service class> / <host> " tienen la opción de usar la función [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) , que crea y registra los SPN para una instancia de servicio.</span><span class="sxs-lookup"><span data-stu-id="4e92c-127">Host-based services that use the simple SPN format "<service class>/<host>", have the option of using the [**DsServerRegisterSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) function, which both creates and registers SPNs for a service instance.</span></span> <span data-ttu-id="4e92c-128">**DsServerRegisterSpn** es una función auxiliar que llama a [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) y [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span><span class="sxs-lookup"><span data-stu-id="4e92c-128">**DsServerRegisterSpn** is a helper function that calls [**DsGetSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) and [**DsWriteAccountSpn**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).</span></span>

<span data-ttu-id="4e92c-129">Para obtener más información, consulte [cuentas de inicio de sesión de servicio](service-logon-accounts.md).</span><span class="sxs-lookup"><span data-stu-id="4e92c-129">For more information, see [Service Logon Accounts](service-logon-accounts.md).</span></span>

 

 




