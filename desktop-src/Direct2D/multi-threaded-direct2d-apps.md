---
title: Aplicaciones Direct2D multiproceso
description: Describe los procedimientos recomendados para crear aplicaciones de Direct2D multiproceso.
ms.assetid: FDD770D4-817F-44D9-86C4-15DD04D214AE
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6be979b867edd6d36583959c4a595dbd507ca94f
ms.sourcegitcommit: c3243ec4ada05b7faf9d563853cb667ecef825e8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/03/2020
ms.locfileid: "103797242"
---
# <a name="multithreaded-direct2d-apps"></a><span data-ttu-id="6479c-103">Aplicaciones Direct2D multiproceso</span><span class="sxs-lookup"><span data-stu-id="6479c-103">Multithreaded Direct2D Apps</span></span>

<span data-ttu-id="6479c-104">Si desarrolla aplicaciones de [direct2d](./direct2d-portal.md) , puede que necesite acceder a los recursos de direct2d desde más de un subproceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-104">If you develop [Direct2D](./direct2d-portal.md) apps, you may need to access Direct2D resources from more than one thread.</span></span> <span data-ttu-id="6479c-105">En otros casos, puede que desee usar multithreading para obtener un mejor rendimiento o una mejor capacidad de respuesta (como usar un subproceso para la presentación en pantalla y un subproceso independiente para la representación sin conexión).</span><span class="sxs-lookup"><span data-stu-id="6479c-105">In other cases, you may want to use multi-threading to get better performance or better responsiveness (like using one thread for screen display and a separate thread for offline rendering).</span></span>

<span data-ttu-id="6479c-106">En este tema se describen los procedimientos recomendados para desarrollar aplicaciones de [Direct2D](./direct2d-portal.md) multiproceso con poca o ninguna representación de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) .</span><span class="sxs-lookup"><span data-stu-id="6479c-106">This topic describes the best practices for developing multithreaded [Direct2D](./direct2d-portal.md) apps with little to no [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) rendering.</span></span> <span data-ttu-id="6479c-107">Puede ser difícil realizar un seguimiento de los defectos de software causados por problemas de simultaneidad y resulta útil planear la Directiva de multithreading y seguir las prácticas recomendadas que se describen aquí.</span><span class="sxs-lookup"><span data-stu-id="6479c-107">Software defects caused by concurrency issues can be difficult to track down, and it is helpful to plan your multithreading policy and to follow the best practices described here.</span></span>

> [!Note]  
> <span data-ttu-id="6479c-108">Si tiene acceso a dos recursos de [direct2d](./direct2d-portal.md) creados a partir de dos generadores de direct2d de un solo subproceso, no se producirán conflictos de acceso, siempre que los dispositivos [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) subyacentes y los contextos de dispositivo sean también distintos.</span><span class="sxs-lookup"><span data-stu-id="6479c-108">If you access two [Direct2D](./direct2d-portal.md) resources created from two different single threaded Direct2D factories it doesn't cause access conflicts as long as the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) devices and device contexts are also distinct.</span></span> <span data-ttu-id="6479c-109">Al hablar sobre el "acceso a los recursos de Direct2D" en este artículo, en realidad se entiende el acceso a los recursos de Direct2D creados desde el mismo dispositivo Direct2D, a menos que se indique lo contrario.</span><span class="sxs-lookup"><span data-stu-id="6479c-109">When talking about "accessing Direct2D resources" in this article, it really means "accessing Direct2D resources created from the same Direct2D Device" unless stated otherwise.</span></span>

## <a name="developing-thread-safe-apps-that-call-only-direct2d-apis"></a><span data-ttu-id="6479c-110">Desarrollo de aplicaciones Thread-Safe que solo llaman a las API de Direct2D</span><span class="sxs-lookup"><span data-stu-id="6479c-110">Developing Thread-Safe Apps that Call Only Direct2D APIs</span></span>

<span data-ttu-id="6479c-111">Puede crear una instancia del generador de [Direct2D](./direct2d-portal.md) multiproceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-111">You can create a multithreaded [Direct2D](./direct2d-portal.md) factory instance.</span></span> <span data-ttu-id="6479c-112">Puede usar y compartir un generador multiproceso y todos sus recursos de más de un subproceso, pero los accesos a esos recursos (a través de llamadas de Direct2D) se serializan mediante Direct2D, por lo que no se producen conflictos de acceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-112">You can use and share a multithreaded factory and all its resources from more than one thread, but accesses to those resources (via Direct2D calls) are serialized by Direct2D, so no access conflicts occur.</span></span> <span data-ttu-id="6479c-113">Si la aplicación solo llama a las API de Direct2D, Direct2D realiza automáticamente esta protección en un nivel granular con una sobrecarga mínima.</span><span class="sxs-lookup"><span data-stu-id="6479c-113">If your app calls only Direct2D APIs, such protection is automatically done by Direct2D in a granular level with minimum overhead.</span></span> <span data-ttu-id="6479c-114">Aquí se muestra el código para crear un generador multiproceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-114">The code to create a multithreaded factory here.</span></span>

```cpp
ID2D1Factory* m_D2DFactory;

// Create a Direct2D factory.
HRESULT hr = D2D1CreateFactory(
    D2D1_FACTORY_TYPE_MULTI_THREADED,
    &m_D2DFactory
);
```

<span data-ttu-id="6479c-115">En la imagen siguiente se muestra cómo [Direct2D](./direct2d-portal.md) serializa dos subprocesos que realizan llamadas solo mediante la API de direct2d.</span><span class="sxs-lookup"><span data-stu-id="6479c-115">The image here shows how [Direct2D](./direct2d-portal.md) serializes two threads that make calls using only the Direct2D API.</span></span>

![diagrama de dos subprocesos serializados.](images/multi-thread.png)

## <a name="developing-thread-safe-direct2d-apps-with-minimal-direct3d-or-dxgi-calls"></a><span data-ttu-id="6479c-117">Desarrollo de aplicaciones Thread-Safe Direct2D con llamadas de Direct3D o DXGI mínimas</span><span class="sxs-lookup"><span data-stu-id="6479c-117">Developing Thread-Safe Direct2D Apps with minimal Direct3D or DXGI Calls</span></span>

<span data-ttu-id="6479c-118">Es más de lo frecuente que una aplicación de [Direct2D](./direct2d-portal.md) también realiza algunas llamadas de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI.</span><span class="sxs-lookup"><span data-stu-id="6479c-118">It is more than often that a [Direct2D](./direct2d-portal.md) app also makes some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span> <span data-ttu-id="6479c-119">Por ejemplo, un subproceso de presentación se dibujará en Direct2D y, a continuación, se presentará mediante una [**cadena de intercambio de DXGI**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span><span class="sxs-lookup"><span data-stu-id="6479c-119">For example, a display thread will draw in Direct2D then present using a [**DXGI swap chain**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span></span>

<span data-ttu-id="6479c-120">En este caso, garantizar la seguridad para subprocesos es más complicada: algunas llamadas a [Direct2D](./direct2d-portal.md) acceden indirectamente a los recursos de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) subyacentes, a los que otro subproceso llama a la vez a Direct3D o DXGI.</span><span class="sxs-lookup"><span data-stu-id="6479c-120">In this case, assuring thread-safety is more complicated: some [Direct2D](./direct2d-portal.md) calls indirectly access the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resources, which might be simultaneously accessed by another thread which calls Direct3D or DXGI.</span></span> <span data-ttu-id="6479c-121">Dado que esas llamadas de Direct3D o DXGI están fuera del reconocimiento y el control de Direct2d, tiene que crear un generador de Direct2D multiproceso, pero debe hacer MOR para evitar conflictos de acceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-121">Since those Direct3D or DXGI calls are out of Direct2D’s awareness and control, you need to create a multithreaded Direct2D factory, but you must do mor to avoid access conflicts.</span></span>

<span data-ttu-id="6479c-122">En el diagrama siguiente se muestra un conflicto de acceso a los recursos de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) debido a que el subproceso T0 tiene acceso indirectamente a un recurso a través de una llamada de [Direct2D](./direct2d-portal.md) y T2 accediendo al mismo recurso directamente a través de una llamada de Direct3D o DXGI.</span><span class="sxs-lookup"><span data-stu-id="6479c-122">The diagram here shows a [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resource access conflict due to thread T0 accessing a resource indirectly via a [Direct2D](./direct2d-portal.md) call and T2 accessing the same resource directly via a Direct3D or DXGI call.</span></span>

> [!Note]  
> <span data-ttu-id="6479c-123">La protección de subprocesos que [Direct2D](./direct2d-portal.md) proporciona (el bloqueo azul de esta imagen) no ayuda en este caso.</span><span class="sxs-lookup"><span data-stu-id="6479c-123">The thread protection that [Direct2D](./direct2d-portal.md) provides (the blue lock in this image) doesn't help in this case.</span></span>

 

![diagrama de la protección de subprocesos.](images/multi-thread2.png)

<span data-ttu-id="6479c-125">Para evitar el conflicto de acceso a los recursos aquí, se recomienda adquirir explícitamente el bloqueo que [Direct2D](./direct2d-portal.md) usa para la sincronización de acceso interno y aplicar ese bloqueo cuando un subproceso necesite realizar llamadas de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI que puedan provocar conflictos de acceso, como se muestra aquí.</span><span class="sxs-lookup"><span data-stu-id="6479c-125">To avoid resource access conflict here, we recommend you explicitly acquire the lock that [Direct2D](./direct2d-portal.md) uses for internal access synchronization, and apply that lock when a thread needs to make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls that might cause access conflict as shown here.</span></span> <span data-ttu-id="6479c-126">En concreto, debe tener especial cuidado con el código que usa excepciones o un sistema de salida en tiempo de compilación basado en códigos de retorno HRESULT.</span><span class="sxs-lookup"><span data-stu-id="6479c-126">In particular, you should take special care with code that uses exceptions or an early out system based on HRESULT return codes.</span></span> <span data-ttu-id="6479c-127">Por esta razón, se recomienda usar un patrón RAII (adquisición de recursos) para llamar a los métodos [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) y [**leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) .</span><span class="sxs-lookup"><span data-stu-id="6479c-127">For this reason, we recommend you use an RAII (Resource Acquisition Is Initialization) pattern to call the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods.</span></span>

> [!Note]  
> <span data-ttu-id="6479c-128">Es importante que empareje las llamadas a los métodos [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) y [**leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) ; de lo contrario, la aplicación puede bloquearse.</span><span class="sxs-lookup"><span data-stu-id="6479c-128">It is important that you pair up calls to the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, otherwise your app can deadlock.</span></span>

 

<span data-ttu-id="6479c-129">En el código siguiente se muestra un ejemplo de Cuándo se deben bloquear y, a continuación, y desbloquearse en torno a llamadas de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI.</span><span class="sxs-lookup"><span data-stu-id="6479c-129">The code here shows an example of when to lock and then and unlock around [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span>


```C++
void MyApp::DrawFromThread2()
{
    // We are accessing Direct3D resources directly without Direct2D's knowledge, so we
    // must manually acquire and apply the Direct2D factory lock.
    ID2D1Multithread* m_D2DMultithread;
    m_D2DFactory->QueryInterface(IID_PPV_ARGS(&m_D2DMultithread));
    m_D2DMultithread->Enter();
    
    // Now it is safe to make Direct3D/DXGI calls, such as IDXGISwapChain::Present
    MakeDirect3DCalls();

    // It is absolutely critical that the factory lock be released upon
    // exiting this function, or else any consequent Direct2D calls will be blocked.
    m_D2DMultithread->Leave();
}
```



> [!Note]  
> <span data-ttu-id="6479c-130">Algunas llamadas de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI (especialmente [**IDXGISwapChain::P reenviados**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)) pueden adquirir bloqueos y/o desencadenadores de devoluciones de llamada en el código de la función o el método que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="6479c-130">Some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls (notably [**IDXGISwapChain::Present**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)) may acquire locks and/or trigger callbacks into the code of the calling function or method.</span></span> <span data-ttu-id="6479c-131">Debe tener en cuenta esto y asegurarse de que este comportamiento no provoque interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="6479c-131">You should be aware of this and make sure that such behavior doesn't cause deadlocks.</span></span> <span data-ttu-id="6479c-132">Para obtener más información, vea el tema [información general sobre DXGI](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) .</span><span class="sxs-lookup"><span data-stu-id="6479c-132">For more info, see the [DXGI Overview](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) topic.</span></span>

 

![diagrama de bloqueo de subprocesos de direct2d y Direct3D.](images/multi-thread3.png)

<span data-ttu-id="6479c-134">Cuando se usan los métodos [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) y [**leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) , las llamadas están protegidas por el [Direct2D](./direct2d-portal.md) automático y el bloqueo explícito, por lo que la aplicación no alcanza el conflicto de acceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-134">When you use the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, the calls are protected by the automatic [Direct2D](./direct2d-portal.md) and the explicit lock, so the app doesn't hit access conflict.</span></span>

<span data-ttu-id="6479c-135">Hay otros enfoques para solucionar este problema.</span><span class="sxs-lookup"><span data-stu-id="6479c-135">There are other approaches to work around this issue.</span></span> <span data-ttu-id="6479c-136">Sin embargo, se recomienda que proteja explícitamente las llamadas de [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI con el bloqueo de [Direct2D](./direct2d-portal.md) porque normalmente proporciona un mejor rendimiento, ya que protege la simultaneidad en un nivel mucho más preciso y con una sobrecarga menor en direct2d Cover.</span><span class="sxs-lookup"><span data-stu-id="6479c-136">However, we recommend you explicitly guard [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls with the [Direct2D](./direct2d-portal.md) lock because it usually provides better performance as it protects concurrency at a much finer level and with lower overhead under Direct2D’s cover.</span></span>

## <a name="ensuring-atomicity-of-stateful-operations"></a><span data-ttu-id="6479c-137">Garantizar la atomicidad de las operaciones con estado</span><span class="sxs-lookup"><span data-stu-id="6479c-137">Ensuring Atomicity of Stateful Operations</span></span>

<span data-ttu-id="6479c-138">Aunque las características de seguridad para subprocesos de [DirectX](/previous-versions//ee663301(v=vs.85)) pueden ayudar a garantizar que no se realicen dos llamadas de API individuales simultáneamente, también debe asegurarse de que los subprocesos que realizan llamadas API con estado no interfieren entre sí.</span><span class="sxs-lookup"><span data-stu-id="6479c-138">While thread-safety features of [DirectX](/previous-versions//ee663301(v=vs.85)) can help ensure that no two individual API calls are made concurrently, you must also ensure that threads that make stateful API calls don't interfere with each other.</span></span> <span data-ttu-id="6479c-139">A continuación se muestra un ejemplo:</span><span class="sxs-lookup"><span data-stu-id="6479c-139">Here is an example.</span></span>

1.  <span data-ttu-id="6479c-140">Hay dos líneas de texto que se van a representar en la pantalla (por subproceso 0) y fuera de la pantalla (por subproceso 1): la línea \# 1 es "a es mayor" y \# la línea 2 es "a B", que se dibujarán con un pincel negro sólido.</span><span class="sxs-lookup"><span data-stu-id="6479c-140">There are two lines of text that you want to render to both on-screen (by Thread 0) and off-screen (by Thread 1): Line \#1 is "A is greater" and Line \#2 is "than B", both of which will be drawn using a solid black brush.</span></span>
2.  <span data-ttu-id="6479c-141">El subproceso 1 dibuja la primera línea de texto.</span><span class="sxs-lookup"><span data-stu-id="6479c-141">Thread 1 draws the first line of text.</span></span>
3.  <span data-ttu-id="6479c-142">El subproceso 0 reacciona a una entrada del usuario, actualiza las líneas de texto a "B es menor" y "a", respectivamente, y cambia el color del pincel a rojo sólido para su propio dibujo;</span><span class="sxs-lookup"><span data-stu-id="6479c-142">Thread 0 reacts to a user input, updates both text lines to "B is smaller" and "than A" respectively, and changed the brush color to solid red for its own drawing;</span></span>
4.  <span data-ttu-id="6479c-143">El subproceso 1 continúa dibujando la segunda línea de texto, que ahora es "a", con el pincel de color rojo;</span><span class="sxs-lookup"><span data-stu-id="6479c-143">Thread 1 continues drawing the second line of text, which is now "than A", with the red color brush;</span></span>
5.  <span data-ttu-id="6479c-144">Por último, obtenemos dos líneas de texto en el destino de dibujo fuera de la pantalla: "A es mayor" en negro y "a" en rojo.</span><span class="sxs-lookup"><span data-stu-id="6479c-144">Finally, we get two lines of text on the off-screen drawing target: "A is greater" in black and "than A" in red.</span></span>

![diagrama de subprocesos de pantalla en y sin conexión.](images/multi-thread4.png)

<span data-ttu-id="6479c-146">En la fila superior, el subproceso 0 dibuja con las cadenas de texto actuales y el pincel negro actual.</span><span class="sxs-lookup"><span data-stu-id="6479c-146">In the top row, Thread 0 draws with current text strings and the current black brush.</span></span> <span data-ttu-id="6479c-147">El subproceso 1 solo finaliza el dibujo fuera de la pantalla en la mitad superior.</span><span class="sxs-lookup"><span data-stu-id="6479c-147">Thread 1 only finishes off-screen drawing on the top half.</span></span>

<span data-ttu-id="6479c-148">En la fila central, el subproceso 0 responde a la interacción del usuario, actualiza las cadenas de texto y el pincel y, a continuación, actualiza la pantalla.</span><span class="sxs-lookup"><span data-stu-id="6479c-148">In the middle row, Thread 0 responds to user interaction, updates the text strings and the brush, then refreshes the screen.</span></span> <span data-ttu-id="6479c-149">En este momento, el subproceso 1 está bloqueado.</span><span class="sxs-lookup"><span data-stu-id="6479c-149">At this point, Thread 1 is blocked.</span></span> <span data-ttu-id="6479c-150">En la fila inferior, la representación fuera de la pantalla final después del subproceso 1 reanuda el dibujo de la mitad inferior con un pincel modificado y una cadena de texto alterada.</span><span class="sxs-lookup"><span data-stu-id="6479c-150">In the bottom row, the final off-screen rendering after Thread 1 resumes drawing the bottom half with an altered brush and an altered text string.</span></span>

<span data-ttu-id="6479c-151">Para solucionar este problema, se recomienda tener un contexto independiente para cada subproceso, de modo que:</span><span class="sxs-lookup"><span data-stu-id="6479c-151">To address this issue, we recommend you have a separate context for each thread, so that:</span></span>

-   <span data-ttu-id="6479c-152">Debe crear una copia del contexto de dispositivo para que los recursos mutables (es decir, los recursos que pueden variar durante la presentación o la impresión, como el contenido de texto o el pincel de color sólido en el ejemplo) no cambien al presentar.</span><span class="sxs-lookup"><span data-stu-id="6479c-152">You should create a copy of the device context so that mutable resources (i.e. resources that may vary during display or printing, such as text contents or the solid color brush in the example) don't change when you render.</span></span> <span data-ttu-id="6479c-153">En este ejemplo, debe mantener una copia de esas dos líneas de texto y el pincel de color antes de dibujar.</span><span class="sxs-lookup"><span data-stu-id="6479c-153">In this sample, you should maintain a copy of those two lines of texts and the color brush before you draw.</span></span> <span data-ttu-id="6479c-154">Al hacerlo, garantiza que cada subproceso tiene contenido completo y coherente para dibujar y presentar.</span><span class="sxs-lookup"><span data-stu-id="6479c-154">By doing so, you guarantee each thread has complete and consistent content to draw and present.</span></span>
-   <span data-ttu-id="6479c-155">Debe compartir recursos de gran peso (como mapas de bits y gráficos de efectos complejos) que se inicializan una vez y, después, no se modifican en los subprocesos para aumentar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="6479c-155">You should share heavy-weight resources (like bitmaps and complex effect graphs) that are initialized once and then never modified across threads to increase performance.</span></span>
-   <span data-ttu-id="6479c-156">Puede compartir recursos ligeros (como los pinceles de color sólido y formatos de texto) que se inicializan una vez y, después, no se modifican a través de subprocesos o no</span><span class="sxs-lookup"><span data-stu-id="6479c-156">You can either share light-weight resources (like solid color brushes and text formats) that are initialized once and then never modified across threads or not</span></span>

## <a name="summary"></a><span data-ttu-id="6479c-157">Resumen</span><span class="sxs-lookup"><span data-stu-id="6479c-157">Summary</span></span>

<span data-ttu-id="6479c-158">Al desarrollar aplicaciones de [direct2d](./direct2d-portal.md) multiproceso, debe crear un generador de direct2d multiproceso y, a continuación, derivar todos los recursos de direct2d de ese generador.</span><span class="sxs-lookup"><span data-stu-id="6479c-158">When you develop multithreaded [Direct2D](./direct2d-portal.md) apps, you must create a multithreaded Direct2D factory then derive all Direct2D resources from that factory.</span></span> <span data-ttu-id="6479c-159">Si un subproceso realiza llamadas [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o dxgi, también debe adquirir explícitamente el bloqueo de Direct2D para proteger esas llamadas de Direct3D o dxgi.</span><span class="sxs-lookup"><span data-stu-id="6479c-159">If a thread will make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls, you also must explicitly acquire then apply the Direct2D lock to guard those Direct3D or DXGI calls.</span></span> <span data-ttu-id="6479c-160">Además, debe garantizar la integridad del contexto al tener una copia de los recursos mutables para cada subproceso.</span><span class="sxs-lookup"><span data-stu-id="6479c-160">Moreover, you must ensure context integrity by having a copy of mutable resources for each thread.</span></span>
