---
description: El mecanismo de destino dirigido permite a los escritores reasignar archivos en el momento de la restauración.
ms.assetid: c0b4ab26-2bb6-4b0f-b837-01057983b49b
title: Trabajar con destinos dirigidos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd2e15ec873b87030a2d01be69d2c3e5f95a193
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104082134"
---
# <a name="working-with-directed-targets"></a><span data-ttu-id="a103a-103">Trabajar con destinos dirigidos</span><span class="sxs-lookup"><span data-stu-id="a103a-103">Working with Directed Targets</span></span>

<span data-ttu-id="a103a-104">El mecanismo de [*destino dirigido*](vssgloss-d.md) permite a los escritores reasignar archivos en el momento de la restauración.</span><span class="sxs-lookup"><span data-stu-id="a103a-104">The [*directed target*](vssgloss-d.md) mechanism allows writers to remap files at restore time.</span></span> <span data-ttu-id="a103a-105">Esto permite a los escritores hacer lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="a103a-105">This allows writers to do the following:</span></span>

-   <span data-ttu-id="a103a-106">Especifique las nuevas ubicaciones de destino (análogas a la variable [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)) del solicitante.</span><span class="sxs-lookup"><span data-stu-id="a103a-106">Specify new target locations (analogous to a requester's [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span></span>
-   <span data-ttu-id="a103a-107">Recupere espacio en disco restaurando solo las partes necesarias de un archivo en el disco, especialmente cuando se realizó una copia de seguridad de un archivo mediante el mecanismo de [*archivos parciales*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="a103a-107">Reclaim disk space by restoring only needed parts of a file to disk, particularly when a file was backed up using the [*partial file*](vssgloss-p.md) mechanism.</span></span>
-   <span data-ttu-id="a103a-108">Cambie el formato de archivo para satisfacer las necesidades actuales.</span><span class="sxs-lookup"><span data-stu-id="a103a-108">Change the file format to meet current needs.</span></span>

<span data-ttu-id="a103a-109">Cualquier archivo que se va a usar con una operación de destino dirigida debe tener un [*destino de restauración*](vssgloss-r.md) de VSS \_ RT \_ dirigido.</span><span class="sxs-lookup"><span data-stu-id="a103a-109">Any file to be used with a directed target operation must have a [*restore target*](vssgloss-r.md) of VSS\_RT\_DIRECTED.</span></span>

<span data-ttu-id="a103a-110">Una vez que se ha establecido que un solicitante puede admitir una operación de destino dirigida, un escritor (mientras se controla el evento de [**prerestauración**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) usa [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) para la instancia de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondiente al componente que administra el archivo (o el componente que define el conjunto de componentes que contiene el archivo) para definir cómo se va a reasignar el archivo en la restauración.</span><span class="sxs-lookup"><span data-stu-id="a103a-110">Once it has been established that a requester can support a directed target operation, a writer (while handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event) uses the [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file) to define how the file is to be remapped on restore.</span></span>

<span data-ttu-id="a103a-111">En el uso de [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), los escritores especifican el nombre de archivo y la ruta de acceso utilizados para realizar una copia de seguridad del archivo, el nombre de archivo y la ruta de acceso de su destino de restauración (estos valores pueden ser los mismos que el nombre de archivo y la ruta de acceso originales) y los intervalos de archivos de origen y de destino.</span><span class="sxs-lookup"><span data-stu-id="a103a-111">In using [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), writers specify the file name and path used to back up the file, the file name and path of its restore destination (these values can be the same as the original file name and path), and source and destination file ranges.</span></span>

<span data-ttu-id="a103a-112">Al igual que con las operaciones de archivo parcial, las listas de intervalos son pares de desplazamientos en el archivo del que se va a hacer una copia de seguridad (en bytes) y la longitud de la sección que se va a restaurar (en bytes), el desplazamiento y la longitud que se separan con dos puntosy cada par separado por una coma: \*Offset1 \***:**_length1 (_\*</span><span class="sxs-lookup"><span data-stu-id="a103a-112">As with partial file operations, range lists are pairs of offsets into the file to be backed up (in bytes) and the length of the section to be restored (in bytes), the offset and length being separated by a colon, and each pair separated by a comma: *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span> <span data-ttu-id="a103a-113">Cada valor es un entero de 64 bits en formato hexadecimal o decimal.</span><span class="sxs-lookup"><span data-stu-id="a103a-113">Each value is a 64-bit integer in either hexadecimal or decimal format.</span></span>

<span data-ttu-id="a103a-114">Si un escritor necesita usar el mecanismo de destino dirigido para que el solicitante restaure un archivo en una nueva ubicación, habría llamado a [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) con el nombre de archivo y la ruta de acceso originales, y el nuevo nombre de archivo y ruta de acceso, y especificar los intervalos de destino de origen con un desplazamiento de cero y una longitud igual a la del tamaño de archivo completo.</span><span class="sxs-lookup"><span data-stu-id="a103a-114">If a writer needs to use the directed target mechanism to have the requester restore a file to a new location, it would have called [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) with the original file name and path and the new file name and path, and specify source destination ranges with a zero offset and a length equal to that of the entire file size.</span></span>

<span data-ttu-id="a103a-115">Por ejemplo, si un escritor necesita tener un archivo 200 000, C: \\ WriterData \\ index. dat, restaurado como c: \\ WriterData \\ OldIndex. dat, la cadena de rango de origen y de destino sería "**0:204880**".</span><span class="sxs-lookup"><span data-stu-id="a103a-115">For instance, if a writer needs to have a 200K file, C:\\WriterData\\Index.dat, restored as C:\\WriterData\\OldIndex.dat, the source and destination range string would be "**0:204880**."</span></span>

<span data-ttu-id="a103a-116">Para reasignar un archivo grande de copia de seguridad parcial, el solicitante usaría el intervalo de origen usado para hacer una copia de seguridad del archivo y un intervalo de destino que reducirá el tamaño del archivo.</span><span class="sxs-lookup"><span data-stu-id="a103a-116">To remap a large, partially backed-up file, the requester would use the source range used to back up the file and a destination range that will reduce the file size.</span></span> <span data-ttu-id="a103a-117">La información del intervalo de origen se puede obtener mediante [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) para la instancia de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondiente al componente que administra el archivo (o el componente que define el conjunto de componentes que contiene el archivo).</span><span class="sxs-lookup"><span data-stu-id="a103a-117">The source range information can be obtained by using [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="a103a-118">Si el archivo de copia de seguridad parcial era inicialmente un archivo grande cuyo encabezado, bytes 64-512, contiene un recuento de registros y otra información actualizada con frecuencia, y cuyos datos más recientes se encuentran en los últimos 65536 bytes del archivo (bytes 0x1239E8577A a 0x1239E7577A, un escritor podría especificar una lista de intervalos de origen como la cadena "**64:448, 0x1239E8577A: 65536**".</span><span class="sxs-lookup"><span data-stu-id="a103a-118">If the partially backed-up file was initially a large file whose header, bytes 64-512, contains a records count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A, a writer could specify a source range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="a103a-119">Si el escritor desea reasignar el archivo restaurado para que contenga solo el encabezado y los datos más recientes, la lista de intervalos podría ser la cadena "**0:488488:65536**".</span><span class="sxs-lookup"><span data-stu-id="a103a-119">If the writer wanted to remap the restored file to contain only the header and most recent data, the range list could be the string "**0:488,488:65536**."</span></span>

<span data-ttu-id="a103a-120">Antes de realizar realmente una operación de restauración, un solicitante debe comprobar si algún archivo requiere compatibilidad con destino dirigido.</span><span class="sxs-lookup"><span data-stu-id="a103a-120">Prior to actually performing a restore operation, a requester should check to see if any files require directed target support.</span></span>

<span data-ttu-id="a103a-121">Para ello, el solicitante primero recorre en iteración los escritores con componentes almacenados en su documento de componentes de copia de seguridad mediante [**IVssBackupComponents:: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) y [**Ivssbackupcomponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="a103a-121">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="a103a-122">A continuación, se usa la interfaz [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) para devolver instancias de la interfaz [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , que proporciona los métodos [**IVssWriterComponentsExt:: getComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) y [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) que permiten al solicitante obtener instancias de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="a103a-122">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provides [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) methods that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="a103a-123">Esto permite a un solicitante obtener candidatos de destino dirigidos mediante [**IVssComponent:: GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) y [**IVssComponent:: GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) para la instancia de [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) correspondiente al componente que administra el archivo (o el componente que define el conjunto de componentes que contiene el archivo).</span><span class="sxs-lookup"><span data-stu-id="a103a-123">This allows a requester to obtain directed target candidates by using [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

 

 
