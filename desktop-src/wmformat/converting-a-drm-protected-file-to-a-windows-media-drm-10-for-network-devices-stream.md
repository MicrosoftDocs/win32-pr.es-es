---
title: Convertir un archivo de DRM-Protected en un flujo de Windows Media DRM 10 para dispositivos de red
description: Convertir un archivo de DRM-Protected en un flujo de Windows Media DRM 10 para dispositivos de red
ms.assetid: 11aa0cfd-6d87-4ec4-82d8-db2507402911
keywords:
- Windows Media Format SDK, convertir archivos protegidos con DRM
- SDK de Windows Media Format, archivos protegidos con DRM
- Advanced Systems Format (ASF), convertir archivos protegidos con DRM
- ASF (formato de sistemas avanzados), conversión de archivos protegidos con DRM
- Advanced Systems Format (ASF), archivos protegidos con DRM
- ASF (formato de sistemas avanzados), archivos protegidos con DRM
- Administración de derechos digitales (DRM), convertir archivos protegidos con DRM
- DRM (administración de derechos digitales), convertir archivos protegidos con DRM
- Administración de derechos digitales (DRM), archivos protegidos con DRM
- DRM (administración de derechos digitales), archivos protegidos con DRM
- Windows Media Format SDK, Windows Media DRM 10 para dispositivos de red
- Windows Media Format SDK, DRM 10 para dispositivos de red
- Advanced Systems Format (ASF), Windows Media DRM 10 para dispositivos de red
- ASF (formato de sistemas avanzados), Windows Media DRM 10 para dispositivos de red
- Advanced Systems Format (ASF), DRM 10 para dispositivos de red
- ASF (formato de sistemas avanzados), DRM 10 para dispositivos de red
- Administración de derechos digitales (DRM), Windows Media DRM 10 para dispositivos de red
- DRM (administración de derechos digitales), Windows Media DRM 10 para dispositivos de red
- Administración de derechos digitales (DRM), DRM 10 para dispositivos de red
- DRM (administración de derechos digitales), DRM 10 para dispositivos de red
- Windows Media DRM 10 para dispositivos de red, conversión de archivos protegidos con DRM
- DRM 10 para dispositivos de red, conversión de archivos protegidos con DRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 644c1b4f7ede688434fbb1dde11b7051c6f644a5
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/19/2020
ms.locfileid: "103788841"
---
# <a name="converting-a-drm-protected-file-to-a-windows-media-drm-10-for-network-devices-stream"></a><span data-ttu-id="898f1-125">Convertir un archivo de DRM-Protected en un flujo de Windows Media DRM 10 para dispositivos de red</span><span class="sxs-lookup"><span data-stu-id="898f1-125">Converting a DRM-Protected File to a Windows Media DRM 10 for Network Devices Stream</span></span>

<span data-ttu-id="898f1-126">Una vez registrado y validado un dispositivo, puede empezar a procesar los mensajes de solicitud de licencia desde él.</span><span class="sxs-lookup"><span data-stu-id="898f1-126">After a device is registered and validated, you can begin processing license request messages from it.</span></span> <span data-ttu-id="898f1-127">Los dispositivos envían los mensajes de solicitud de licencia cuando se necesita una acción de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="898f1-127">License request messages are sent by devices when action from the application is needed.</span></span> <span data-ttu-id="898f1-128">La única acción admitida actualmente es "Play", que es una solicitud de datos seguros para la reproducción.</span><span class="sxs-lookup"><span data-stu-id="898f1-128">The only action currently supported is "Play", which is a request for secure data for playback.</span></span>

<span data-ttu-id="898f1-129">Cuando reciba un mensaje de solicitud de licencia, debe realizar los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="898f1-129">When you receive a license request message, you should perform the following steps:</span></span>

1.  <span data-ttu-id="898f1-130">Analice el mensaje de solicitud de licencia llamando al método [**IWMDRMMessageParser::P arselicenserequestmsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) .</span><span class="sxs-lookup"><span data-stu-id="898f1-130">Parse the license request message by calling the [**IWMDRMMessageParser::ParseLicenseRequestMsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) method.</span></span>
2.  <span data-ttu-id="898f1-131">Obtenga la interfaz [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) para el dispositivo llamando al método [**IWMDeviceRegistration:: GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) , pasando el certificado y el número de serie obtenidos en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="898f1-131">Get the [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) interface for the device by calling the [**IWMDeviceRegistration::GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) method, passing in the certificate and serial number obtained in step 1.</span></span>
3.  <span data-ttu-id="898f1-132">Compruebe que el dispositivo está listo para recibir datos seguros:</span><span class="sxs-lookup"><span data-stu-id="898f1-132">Verify that the device is ready to receive secure data:</span></span>
    -   <span data-ttu-id="898f1-133">Llame a [**IWMRegisteredDevice:: IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) para comprobar que el dispositivo se ha aprobado.</span><span class="sxs-lookup"><span data-stu-id="898f1-133">Call [**IWMRegisteredDevice::IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) to verify that the device has been approved.</span></span> <span data-ttu-id="898f1-134">La aprobación siempre debe basarse en las preferencias del usuario.</span><span class="sxs-lookup"><span data-stu-id="898f1-134">Approval should always be based on user preference.</span></span>
    -   <span data-ttu-id="898f1-135">Llame a [**IWMRegisteredDevice:: IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) para comprobar que el dispositivo se ha validado en las últimas 48 horas.</span><span class="sxs-lookup"><span data-stu-id="898f1-135">Call [**IWMRegisteredDevice::IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) to verify that the device has been validated within the last 48 hours.</span></span> <span data-ttu-id="898f1-136">Si el dispositivo no es válido, debe realizar la detección de proximidad.</span><span class="sxs-lookup"><span data-stu-id="898f1-136">If the device is not valid, you need to perform proximity detection.</span></span> <span data-ttu-id="898f1-137">Para obtener más información, vea [realizar la detección de proximidad](performing-proximity-detection.md).</span><span class="sxs-lookup"><span data-stu-id="898f1-137">For more information, see [Performing Proximity Detection](performing-proximity-detection.md).</span></span>
    -   <span data-ttu-id="898f1-138">Llame a [**IWMRegisteredDevice:: IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) para comprobar que el dispositivo se ha abierto.</span><span class="sxs-lookup"><span data-stu-id="898f1-138">Call [**IWMRegisteredDevice::IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) to verify that the device has been opened.</span></span> <span data-ttu-id="898f1-139">Si el dispositivo no está abierto, puede abrirlo llamando a [**IWMRegisteredDevice:: Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span><span class="sxs-lookup"><span data-stu-id="898f1-139">If the device is not open, you can open it by calling [**IWMRegisteredDevice::Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span></span> <span data-ttu-id="898f1-140">Solo puede tener 10 dispositivos abiertos en el equipo a la vez.</span><span class="sxs-lookup"><span data-stu-id="898f1-140">You can only have 10 devices open on the computer at a time.</span></span> <span data-ttu-id="898f1-141">Es posible que tenga que cerrar otro dispositivo antes de poder abrir el para el que está procesando la solicitud.</span><span class="sxs-lookup"><span data-stu-id="898f1-141">It is possible that you may need to close another device before you can open the one for which you are processing the request.</span></span> <span data-ttu-id="898f1-142">Para cerrar un dispositivo, llame al método [**IWMRegisteredDevice:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) .</span><span class="sxs-lookup"><span data-stu-id="898f1-142">To close a device, call the [**IWMRegisteredDevice::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) method.</span></span>
4.  <span data-ttu-id="898f1-143">Cree una instancia del objeto del transcifrador DRM mediante una llamada a la función [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="898f1-143">Create an instance of the DRM transcryptor object by calling the [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) function.</span></span>
5.  <span data-ttu-id="898f1-144">Llame al método [**IWMDRMTranscryptor:: Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) para inicializar el transcifrador.</span><span class="sxs-lookup"><span data-stu-id="898f1-144">Call the [**IWMDRMTranscryptor::Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) method to initialize the transcryptor.</span></span> <span data-ttu-id="898f1-145">Este método toma un puntero a la implementación de la interfaz [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) , que usa para enviar mensajes de estado.</span><span class="sxs-lookup"><span data-stu-id="898f1-145">This method takes a pointer to your implementation of the [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) interface, which it uses to deliver status messages.</span></span> <span data-ttu-id="898f1-146">Este método también devuelve un mensaje de solicitud de licencia que se debe enviar al dispositivo antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="898f1-146">This method also returns a license request message that must be sent to the device before continuing.</span></span>
6.  <span data-ttu-id="898f1-147">Cuando el método [**IWMStatusCallback:: en status**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) de la aplicación recibe el \_ mensaje de estado del transcifrador WMT \_ , llame al método [**IWMDRMTranscryptor:: Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) para buscar la posición de inicio adecuada en el archivo.</span><span class="sxs-lookup"><span data-stu-id="898f1-147">When your application's [**IWMStatusCallback::OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) method receives the WMT\_TRANSCRYPTOR\_INIT status message, call the [**IWMDRMTranscryptor::Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) method to seek to the appropriate start position in the file.</span></span> <span data-ttu-id="898f1-148">Para comenzar al principio del archivo, debe llamar a **Seek** con el tiempo 0.</span><span class="sxs-lookup"><span data-stu-id="898f1-148">To start at the beginning of the file, you must call **Seek** with time 0.</span></span>
7.  <span data-ttu-id="898f1-149">El transcifrador envía un \_ \_ mensaje de búsqueda de descifrado WMT cuando está listo para entregar datos del archivo en el nuevo tiempo de presentación.</span><span class="sxs-lookup"><span data-stu-id="898f1-149">The transcryptor sends a WMT\_TRANSCRYPTOR\_SEEKED message when it is ready to deliver data from the file at the new presentation time.</span></span> <span data-ttu-id="898f1-150">Realice llamadas repetidas al método [**IWMDRMTranscryptor:: Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) para obtener fragmentos convertidos de datos multimedia.</span><span class="sxs-lookup"><span data-stu-id="898f1-150">Make repeated calls to the [**IWMDRMTranscryptor::Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) method to get converted chunks of media data.</span></span> <span data-ttu-id="898f1-151">Cada llamada es asincrónica y no se completa hasta que \_ se recibe un mensaje de lectura del TRANScifrado WMT \_ .</span><span class="sxs-lookup"><span data-stu-id="898f1-151">Each call is asynchronous and is not complete until a WMT\_TRANSCRYPTOR\_READ message is received.</span></span> <span data-ttu-id="898f1-152">Cuando reciba el mensaje, puede enviar los datos al dispositivo receptor.</span><span class="sxs-lookup"><span data-stu-id="898f1-152">When you receive the message, you can send the data to the receiving device.</span></span>
8.  <span data-ttu-id="898f1-153">Cuando recibe un mensaje de \_ lectura del TRANScifrador WMT \_ con el parámetro *HR* establecido en \_ EOF de \_ transcifrador NS, se ha \_ leído todo el archivo.</span><span class="sxs-lookup"><span data-stu-id="898f1-153">When you receive a WMT\_TRANSCRYPTOR\_READ message with the *hr* parameter set to NS\_S\_TRANSCRYPTOR\_EOF, the entire file has been read.</span></span> <span data-ttu-id="898f1-154">En este punto, llame al método [**IWMDRMTranscryptor:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) para cerrar el archivo y liberar recursos.</span><span class="sxs-lookup"><span data-stu-id="898f1-154">At this point, call the [**IWMDRMTranscryptor::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) method to close the file and free resources.</span></span>
9.  <span data-ttu-id="898f1-155">Cuando \_ se recibe el mensaje de TRANScifrador WMT \_ , puede liberar la interfaz [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="898f1-155">When the WMT\_TRANSCRYPTOR\_CLOSED message is received, you can release the [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) interface.</span></span>

> [!Note]  
> <span data-ttu-id="898f1-156">DRM no es compatible con la versión basada en x64 de este SDK.</span><span class="sxs-lookup"><span data-stu-id="898f1-156">DRM is not supported by the x64-based version of this SDK.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="898f1-157">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="898f1-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="898f1-158">**Usar el protocolo DRM 10 de Windows Media para dispositivos de red**</span><span class="sxs-lookup"><span data-stu-id="898f1-158">**Using the Windows Media DRM 10 for Network Devices Protocol**</span></span>](using-the-windows-media-drm-10-for-network-devices-protocol.md)
</dt> </dl>

 

 




