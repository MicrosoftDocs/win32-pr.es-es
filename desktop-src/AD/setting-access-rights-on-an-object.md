---
title: Establecer derechos de acceso en un objeto
description: En este tema se describe cómo crear una ACE para un derecho de acceso y establecer esa ACE en la DACL de un objeto.
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Establecer derechos de acceso en un objeto AD
- Objetos AD, establecer derechos de acceso en un objeto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2bcf54de381dab2af1dab4ea44654fb0a5682f06
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "104487395"
---
# <a name="setting-access-rights-on-an-object"></a>Establecer derechos de acceso en un objeto

Cuando se usan los objetos COM ADSI [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (descriptor de seguridad), [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACL y SACL) y [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) para agregar una ACE a una ACL, se están realizando cambios en la propiedad **nTSecurityDescriptor** del objeto especificado en la caché de propiedades. Esto significa que se debe llamar a los métodos put en los objetos que contienen la nueva ACE y el método [**IADs. SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) para escribir el descriptor de seguridad actualizado en el directorio desde la memoria caché de propiedades.

Para obtener más información y un ejemplo de código que establece una ACE en un objeto de Active Directory Domain Services, vea el [código de ejemplo para establecer una ACE en un objeto de directorio](example-code-for-setting-an-ace-on-a-directory-object.md).

Utilice el siguiente proceso general para crear una ACE para un derecho de acceso y establecer esa ACE en la DACL de un objeto.

1.  Obtiene un puntero de interfaz [**IADs**](/windows/desktop/api/iads/nn-iads-iads) al objeto.
2.  Use el método [**IADs. Get**](/windows/desktop/api/iads/nf-iads-iads-get) para obtener el descriptor de seguridad del objeto. El nombre de la propiedad que contiene el descriptor de seguridad es **nTSecurityDescriptor**. La propiedad se devolverá como una [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) que contiene un puntero [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (el miembro **VT** es el **\_ envío de VT**). Llame a **QueryInterface** en ese puntero **IDispatch** para obtener una interfaz [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) para usar los métodos de esa interfaz para tener acceso a la ACL del descriptor de seguridad.
3.  Use la propiedad [**IADsSecurityDescriptor. DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para obtener la DACL. El método devuelve un puntero [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . Llame a **QueryInterface** en ese puntero **IDispatch** para obtener una interfaz [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) para usar los métodos de esa interfaz para tener acceso a las ACE individuales de la ACL.
4.  Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) para crear el objeto com ADSI para la nueva ACE y obtener un puntero de interfaz [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) a ese objeto. Tenga en cuenta que el identificador de clase es CLSID \_ AccessControlEntry.
5.  Establezca las propiedades de la ACE mediante los métodos [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) :

    1.  Use [**IADsAccessControlEntry::p de \_ confianza UT**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para establecer el administrador de confianza al que se aplica esta ACE. El administrador de confianza es un usuario, un grupo u otra entidad de seguridad. La aplicación debe usar el valor de la propiedad correspondiente del objeto de usuario o grupo del administrador de confianza al que desea aplicar la ACE. El administrador de confianza se especifica como **BSTR** y puede adoptar los siguientes formatos:
        -   Cuenta de dominio (el nombre de inicio de sesión usado en una versión anterior de Windows NT) de la forma " <domain> \\ <user account> ", donde " &lt; dominio &gt; " es el nombre del dominio de Windows NT que contiene el usuario y " &lt; cuenta &gt; de usuario" es la propiedad **samAccountName** del usuario especificado. Por ejemplo: "fabrikam \\ juanpérez".
        -   Entidad de seguridad conocida que representa las identidades especiales definidas por el sistema de seguridad de Windows NT, como todos los usuarios, sistema local, propio de la entidad de seguridad, usuario autenticado, propietario del creador, etc. Los objetos que representan las entidades de seguridad conocidas se almacenan en el contenedor de entidades de seguridad conocidas bajo el contenedor de configuración. Por ejemplo, Inicio de sesión anónimo.
        -   Grupo integrado que representa los grupos de usuarios integrados definidos por el sistema de seguridad de Windows NT. Tiene el formato "Builtin", \\ <group name> donde " &lt; nombre de grupo &gt; " es el nombre del grupo de usuarios integrado. Los objetos que representan los grupos integrados se almacenan en el contenedor Builtin debajo del contenedor de dominio. Por ejemplo, "Builtin \\ Administrators".
        -   SID (formato de cadena) del usuario especificado, que es la propiedad **objectSid** del usuario especificado. Puede convertir al formato de cadena mediante la función [**ConvertSidToStringSid**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) de la API de seguridad de Win32. Por ejemplo: "S-1-5-32-548".
    2.  Use la propiedad [**IADsAccessControlEntry. AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para establecer la máscara que especifica el derecho de acceso. La enumeración [**ADS \_ Rights \_ enum**](/windows/win32/api/iads/ne-iads-ads_rights_enum) especifica los derechos de acceso que se pueden establecer en un objeto de directorio.
    3.  Use la propiedad [**IADsAccessControlEntry. AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar si se permiten o deniegan los derechos de acceso establecidos por **AccessMask**. En el caso de los derechos estándar, puede ser **ADS \_ ACETYPE \_ acceso \_ permitido** o **ADS \_ ACETYPE \_ acceso \_ denegado**. Para los derechos específicos de objetos (derechos que se aplican a una parte específica de un objeto o a un tipo específico de objeto), use **ADS \_ ACETYPE \_ Access \_ allowed \_ Object** o **ADS \_ ACETYPE \_ Access \_ deniedd \_ Object**. La enumeración de [**\_ \_ enumeración ADS ACETYPE**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) especifica los tipos de acceso que se pueden establecer en una ACE.
    4.  Use la propiedad [**IADsAccessControlEntry. AceFlags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar si otros contenedores u objetos situados debajo del objeto especificado pueden heredar la ACE. La enumeración de [**\_ \_ enumeración ADS ACEFLAG**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) especifica los marcadores de herencia que se pueden establecer en una ACE.
    5.  Use la propiedad [**IADsAccessControlEntry. Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar si el derecho se aplica a una parte específica del objeto, a un tipo de objeto heredado o a ambos.
    6.  Si **Flags** se establece en **ADS \_ Flag Type (tipo de \_ objeto \_ \_**), establezca la propiedad [**IADsAccessControlEntry. OBJECTTYPE**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) o especifique una cadena que contenga el GUID de la clase de objeto (para **ADS \_ right \_ DS \_ Create \_ Child** o **ADS \_ right \_ DS \_ Delete \_ Child**), propiedad, conjunto de propiedades, escritura validada o derecho extendido al que se aplica la ACE. El GUID debe especificarse como una cadena del formulario generado por la función [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) en la biblioteca com.
    7.  Si **Flags** se establece en la **\_ marca ADS \_ \_ \_ tipo \_ de objeto heredado**, establezca la propiedad [**IADsAccessControlEntry. InheritedObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar una cadena que contenga el GUID de la clase de objeto heredada a la que se aplica la ACE. El GUID debe especificarse como una cadena del formulario generado por la función [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) en la biblioteca com.

6.  Use el método **QueryInterface** en el objeto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) para obtener un puntero [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . El método [**IADsAccessControlList. AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) requiere un puntero de interfaz **IDISPATCH** a la ACE.
7.  Use [**IADsAccessControlList. AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) para agregar la nueva ACE a la DACL. Tenga en cuenta que el orden de las ACE dentro de la ACL puede afectar a la evaluación del acceso al objeto. El acceso correcto al objeto puede requerir que cree una nueva ACL, que agregue las ACE de la ACL existente en el orden correcto a la nueva ACL y que, a continuación, reemplace la ACL existente en el descriptor de seguridad por la nueva ACL. Para obtener más información, vea [orden de las ACE en una DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).
8.  Use la propiedad [**IADsSecurityDescriptor. DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para escribir la DACL que contiene la nueva ACE en el descriptor de seguridad. Para obtener más información acerca de las DACL, vea [DACL NULL y DACL vacías](null-dacls-and-empty-dacls.md).
9.  Use el método [**IADs. put**](/windows/desktop/api/iads/nf-iads-iads-put) para escribir el descriptor de seguridad en la propiedad **nTSecurityDescriptor** del objeto en la caché de propiedades.
10. Utilice el método [**IADs. SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) para actualizar la propiedad en el objeto en el directorio.

 

 