---
description: Algunos codificadores de Windows Media y Media Foundation en el nivel de canalización admiten los modos de codificación de dos pasos.
ms.assetid: 3fd5baff-142f-453e-bb97-b355ee6678fc
title: Cómo crear una topología para Two-Pass la codificación de Windows Media
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c813b9a3c31fafaa3efbea83180c997bc46079d
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "104003349"
---
# <a name="how-to-create-a-topology-for-two-pass-windows-media-encoding"></a><span data-ttu-id="cdc61-103">Cómo crear una topología para Two-Pass la codificación de Windows Media</span><span class="sxs-lookup"><span data-stu-id="cdc61-103">How to Create a Topology for Two-Pass Windows Media Encoding</span></span>

<span data-ttu-id="cdc61-104">Algunos codificadores de Windows Media y Media Foundation en el nivel de canalización admiten los modos de codificación de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="cdc61-104">Two-pass encoding modes are supported by certain Windows Media encoders and Media Foundation at the pipeline layer.</span></span> <span data-ttu-id="cdc61-105">La aplicación debe configurar y configurar la topología de codificación similar a la de la codificación de un solo paso, pero en el modo de codificación de dos pasos, la aplicación debe ejecutar dos veces la sesión de codificación.</span><span class="sxs-lookup"><span data-stu-id="cdc61-105">The application must configure and set up the encoding topology similar to that in single-pass encoding but in the 2-pass encoding mode, the application must run the encoding session twice.</span></span> <span data-ttu-id="cdc61-106">En el primer paso, el codificador recopila información sobre el contenido de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="cdc61-106">On the first pass, the encoder gathers information about the content of the stream.</span></span> <span data-ttu-id="cdc61-107">En el segundo paso, con la información recopilada en el primer paso, se genera el archivo de salida final.</span><span class="sxs-lookup"><span data-stu-id="cdc61-107">On the second pass, by using the information gathered on the first pass, the final output file is generated.</span></span> <span data-ttu-id="cdc61-108">Al procesar dos veces los ejemplos de la secuencia, la codificación de dos pasos optimiza el proceso de codificación y genera archivos codificados de mayor calidad.</span><span class="sxs-lookup"><span data-stu-id="cdc61-108">By processing the samples for the stream twice, two-pass encoding optimizes the encoding process and produces higher quality encoded files.</span></span> <span data-ttu-id="cdc61-109">Los modos de codificación de dos pasos no se pueden usar en secuencias en directo.</span><span class="sxs-lookup"><span data-stu-id="cdc61-109">Two-pass encoding modes cannot be used on live streams.</span></span>

<span data-ttu-id="cdc61-110">Media Foundation admite los siguientes modos de codificación de dos pasos:</span><span class="sxs-lookup"><span data-stu-id="cdc61-110">Media Foundation supports the following two-pass encoding modes:</span></span>

-   [<span data-ttu-id="cdc61-111">Codificación de velocidad de bits variable sin restricciones</span><span class="sxs-lookup"><span data-stu-id="cdc61-111">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)
-   [<span data-ttu-id="cdc61-112">Codificación de velocidad de bits variable máxima limitada</span><span class="sxs-lookup"><span data-stu-id="cdc61-112">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md)

<span data-ttu-id="cdc61-113">La creación de una topología de codificación para la codificación de dos pasos es similar a la de los modos de paso único.</span><span class="sxs-lookup"><span data-stu-id="cdc61-113">Building an encoding topology for two-pass encoding is similar to single pass modes.</span></span> <span data-ttu-id="cdc61-114">En la lista siguiente se muestran las diferencias clave.</span><span class="sxs-lookup"><span data-stu-id="cdc61-114">The following list shows the key differences.</span></span>

-   <span data-ttu-id="cdc61-115">La configuración del codificador debe incluir la propiedad [**MFPKEY \_ PASSESUSED**](mfpkey-passesusedproperty.md) establecida en 2 y la propiedad [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) en Variant \_ true.</span><span class="sxs-lookup"><span data-stu-id="cdc61-115">Encoder configuration must include the [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md) property that is set to 2 and the [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) property to VARIANT\_TRUE.</span></span> <span data-ttu-id="cdc61-116">Esto filtra las capacidades del codificador para los modos de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="cdc61-116">This filters the encoder’s capabilities to two-pass modes.</span></span> <span data-ttu-id="cdc61-117">Si usa objetos de activación, pase estas propiedades a [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) o [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span><span class="sxs-lookup"><span data-stu-id="cdc61-117">If you are using activation objects, pass these properties to [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) or [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span></span>
-   <span data-ttu-id="cdc61-118">En el primer paso, utilice un receptor de medios ficticios en el nodo de salida, ya que los ejemplos que se generan en este paso no se agregan al archivo final.</span><span class="sxs-lookup"><span data-stu-id="cdc61-118">For the first pass, use a dummy media sink in the output node because the samples that are generated in this pass are not added to the final file.</span></span>
-   <span data-ttu-id="cdc61-119">En el segundo paso, realice una consulta al codificador para las propiedades posteriores a la codificación y reemplace el nodo del receptor multimedia ficticio por el receptor de medios ASF con estas propiedades establecidas.</span><span class="sxs-lookup"><span data-stu-id="cdc61-119">For the second pass, query the encoder for the required post-encoding properties and replace the dummy media sink node with the ASF media sink with these properties set.</span></span>

<span data-ttu-id="cdc61-120">Para obtener más información acerca de cómo configurar una topología de codificación, vea [Tutorial: codificación de Windows Media de un solo paso](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="cdc61-120">For more information about setting up an encoding topology see, [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>

<span data-ttu-id="cdc61-121">En el procedimiento siguiente se resumen los pasos para codificar el contenido de Windows Media en un contenedor ASF mediante un modo de codificación de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="cdc61-121">The following procedure summarizes the steps for encoding Windows Media content in an ASF container by using a two-pass encoding mode.</span></span>

1.  <span data-ttu-id="cdc61-122">Cree un origen de medios para el especificado mediante el solucionador de origen.</span><span class="sxs-lookup"><span data-stu-id="cdc61-122">Create a media source for the specified by using the source resolver.</span></span>
2.  <span data-ttu-id="cdc61-123">Enumerar las secuencias en el origen de medios.</span><span class="sxs-lookup"><span data-stu-id="cdc61-123">Enumerate the streams in the media source.</span></span>
3.  <span data-ttu-id="cdc61-124">Cree el receptor de medios ASF y agregue receptores de secuencia en función de las secuencias del origen de medios que deban codificarse.</span><span class="sxs-lookup"><span data-stu-id="cdc61-124">Create the ASF media sink and add stream sinks depending on the streams in the media source that need to be encoded.</span></span>
4.  <span data-ttu-id="cdc61-125">Cree el receptor de medios.</span><span class="sxs-lookup"><span data-stu-id="cdc61-125">Create the media sink.</span></span>
5.  <span data-ttu-id="cdc61-126">Cree los codificadores de Windows Media para las secuencias en el archivo de salida.</span><span class="sxs-lookup"><span data-stu-id="cdc61-126">Create the Windows Media encoders for the streams in the output file.</span></span>
6.  <span data-ttu-id="cdc61-127">Configure los codificadores con las propiedades de codificación de dos pasos.</span><span class="sxs-lookup"><span data-stu-id="cdc61-127">Configure the encoders with the 2-pass encoding properties.</span></span>
7.  <span data-ttu-id="cdc61-128">Cree una topología de codificación parcial conectando el origen, los codificadores y el receptor de medios.</span><span class="sxs-lookup"><span data-stu-id="cdc61-128">Build a partial encoding topology by connecting the source, encoders, and the media sink.</span></span>
8.  <span data-ttu-id="cdc61-129">Cree una instancia de la sesión multimedia y establezca la topología en la sesión multimedia.</span><span class="sxs-lookup"><span data-stu-id="cdc61-129">Instantiate the Media Session and set the topology on the Media Session.</span></span>
9.  <span data-ttu-id="cdc61-130">Ejecute el primer paso de codificación controlando la sesión multimedia y obteniendo todos los eventos pertinentes de la sesión multimedia.</span><span class="sxs-lookup"><span data-stu-id="cdc61-130">Run the first encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
10. <span data-ttu-id="cdc61-131">Cierre y cierre la sesión de codificación.</span><span class="sxs-lookup"><span data-stu-id="cdc61-131">Close and shutdown the encoding session.</span></span>
11. <span data-ttu-id="cdc61-132">Consulte las siguientes propiedades en el codificador según el tipo de codificación:</span><span class="sxs-lookup"><span data-stu-id="cdc61-132">Query the encoder for the following properties depending on the type of encoding:</span></span> 

    | <span data-ttu-id="cdc61-133">Tipo de codificación</span><span class="sxs-lookup"><span data-stu-id="cdc61-133">Encoding type</span></span>                                                                                        | <span data-ttu-id="cdc61-134">Nombre de propiedad</span><span class="sxs-lookup"><span data-stu-id="cdc61-134">Property name</span></span>                                                                                                                                                                                                                                                                                                                                                     |
    |------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | [<span data-ttu-id="cdc61-135">Codificación de velocidad de bits variable sin restricciones</span><span class="sxs-lookup"><span data-stu-id="cdc61-135">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)       | [<span data-ttu-id="cdc61-136">**MFPKEY \_ PASSESUSED**</span><span class="sxs-lookup"><span data-stu-id="cdc61-136">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="cdc61-137">**MFPKEY \_ VBRENABLED**</span><span class="sxs-lookup"><span data-stu-id="cdc61-137">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="cdc61-138">**MFPKEY \_ BAVG**</span><span class="sxs-lookup"><span data-stu-id="cdc61-138">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="cdc61-139">**MFPKEY \_ RAVG**</span><span class="sxs-lookup"><span data-stu-id="cdc61-139">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/>                                                                                                               |
    | [<span data-ttu-id="cdc61-140">Codificación de velocidad de bits variable máxima limitada</span><span class="sxs-lookup"><span data-stu-id="cdc61-140">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md) | [<span data-ttu-id="cdc61-141">**MFPKEY \_ PASSESUSED**</span><span class="sxs-lookup"><span data-stu-id="cdc61-141">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="cdc61-142">**MFPKEY \_ VBRENABLED**</span><span class="sxs-lookup"><span data-stu-id="cdc61-142">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="cdc61-143">**MFPKEY \_ BAVG**</span><span class="sxs-lookup"><span data-stu-id="cdc61-143">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="cdc61-144">**MFPKEY \_ RAVG**</span><span class="sxs-lookup"><span data-stu-id="cdc61-144">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/> [<span data-ttu-id="cdc61-145">**MFPKEY \_ Bmax**</span><span class="sxs-lookup"><span data-stu-id="cdc61-145">**MFPKEY\_BMAX**</span></span>](mfpkey-bmaxproperty.md)<br/> [<span data-ttu-id="cdc61-146">**MFPKEY \_ RMAX**</span><span class="sxs-lookup"><span data-stu-id="cdc61-146">**MFPKEY\_RMAX**</span></span>](mfpkey-rmaxproperty.md)<br/> |

    

     

12. <span data-ttu-id="cdc61-147">Cree el receptor de archivos ASF y agregue los receptores de secuencias necesarios en función de las secuencias que desee incluir en el archivo de salida final.</span><span class="sxs-lookup"><span data-stu-id="cdc61-147">Create the ASF file sink and add the required stream sinks depending on the streams you want to include in the final output file.</span></span>
13. <span data-ttu-id="cdc61-148">Establezca las propiedades del codificador recuperadas en el paso 11 en el receptor de archivos.</span><span class="sxs-lookup"><span data-stu-id="cdc61-148">Set the encoder properties retrieved in step 11 on the file sink.</span></span>
14. <span data-ttu-id="cdc61-149">Reemplace el receptor de medios del nodo de salida por el receptor de archivos recién creado.</span><span class="sxs-lookup"><span data-stu-id="cdc61-149">Replace the media sink in the output node with the newly created file sink.</span></span>
15. <span data-ttu-id="cdc61-150">Cree una instancia de la sesión multimedia y establezca la topología actualizada en la sesión multimedia.</span><span class="sxs-lookup"><span data-stu-id="cdc61-150">Instantiate the Media Session and set the updated topology on the Media Session.</span></span>
16. <span data-ttu-id="cdc61-151">Ejecute el paso de segunda codificación controlando la sesión multimedia y obteniendo todos los eventos pertinentes de la sesión multimedia.</span><span class="sxs-lookup"><span data-stu-id="cdc61-151">Run second encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
17. <span data-ttu-id="cdc61-152">Espere a que el evento [MEEndOfPresentation](meendofpresentation.md) de la sesión multimedia y en el controlador de eventos obtenga los valores de propiedad de codificación del codificador y establézcalo en el receptor de archivos.</span><span class="sxs-lookup"><span data-stu-id="cdc61-152">Wait for the [MEEndOfPresentation](meendofpresentation.md) event from the Media Session and in the event handler get the encoding property values from the encoder and set them on the file sink.</span></span> <span data-ttu-id="cdc61-153">Para obtener más información, vea "actualizar las propiedades de codificación en el receptor de archivos" en [Tutorial: codificación de Windows Media de un solo paso](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="cdc61-153">For more information, see "Update Encoding Properties in the File Sink" in [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>
18. <span data-ttu-id="cdc61-154">Cierre y cierre la sesión de codificación.</span><span class="sxs-lookup"><span data-stu-id="cdc61-154">Close and shutdown the encoding session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cdc61-155">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="cdc61-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cdc61-156">Componentes ASF de capa de canalización</span><span class="sxs-lookup"><span data-stu-id="cdc61-156">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> </dl>

 

 




