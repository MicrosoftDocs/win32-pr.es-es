---
description: En este tema se identifican varias estrategias de control de errores que se deben tener en cuenta al desarrollar componentes para COM+.
ms.assetid: 1ae5875b-8085-44f2-9071-c2a5d7543ac1
title: Estrategias para controlar errores en COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ca64546683fa45ac8df3bcb47534d8de482798
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696110"
---
# <a name="strategies-for-handling-errors-in-com"></a><span data-ttu-id="d215d-103">Estrategias para controlar errores en COM+</span><span class="sxs-lookup"><span data-stu-id="d215d-103">Strategies for Handling Errors in COM+</span></span>

<span data-ttu-id="d215d-104">En este tema se identifican varias estrategias de control de errores que se deben tener en cuenta al desarrollar componentes para COM+.</span><span class="sxs-lookup"><span data-stu-id="d215d-104">This topic identifies several error-handling strategies to keep in mind as you develop components for COM+.</span></span>

-   <span data-ttu-id="d215d-105">**Devuelve un valor HRESULT para todos los métodos de todas las interfaces de componentes.**</span><span class="sxs-lookup"><span data-stu-id="d215d-105">**Return an HRESULT value for all methods in all component interfaces.**</span></span>  <span data-ttu-id="d215d-106">COM+ usa valores **HRESULT** para informar de los errores que se produzcan al realizar llamadas a funciones o llamadas a métodos de interfaz.</span><span class="sxs-lookup"><span data-stu-id="d215d-106">COM+ uses **HRESULT** values to report on any errors in making function calls or interface method calls.</span></span> <span data-ttu-id="d215d-107">Un **valor HRESULT** indica si un método tuvo éxito o no, e identifica la instalación asociada al error, como RPC, Win32 o ITF para los errores específicos de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="d215d-107">An **HRESULT** indicates whether a method succeeded or failed and identifies the facility associated with the error, such as RPC, WIN32, or ITF for interface-specific errors.</span></span> <span data-ttu-id="d215d-108">Además, las API del sistema proporcionan una búsqueda de un **valor HRESULT** a una cadena que describe la condición de error.</span><span class="sxs-lookup"><span data-stu-id="d215d-108">Also, system APIs provide a lookup from an **HRESULT** to a string that describes the error condition.</span></span> <span data-ttu-id="d215d-109">El uso de métodos que devuelven valores **HRESULT** es fundamental para los componentes bien escritos y son esenciales para el proceso de depuración.</span><span class="sxs-lookup"><span data-stu-id="d215d-109">Using methods that return **HRESULT** values are fundamental to well-written components and are essential to the debugging process.</span></span> <span data-ttu-id="d215d-110">Microsoft Visual Basic define automáticamente cada método con un **HRESULT** como un valor devuelto.</span><span class="sxs-lookup"><span data-stu-id="d215d-110">Microsoft Visual Basic automatically defines each method with an **HRESULT** as a return.</span></span> <span data-ttu-id="d215d-111">En Microsoft Visual C++, debe devolver explícitamente un **valor HRESULT**.</span><span class="sxs-lookup"><span data-stu-id="d215d-111">In Microsoft Visual C++, you must explicitly return an **HRESULT**.</span></span> <span data-ttu-id="d215d-112">Para obtener información adicional sobre los valores HRESULT, vea [estructura de los códigos de error com](/windows/desktop/com/structure-of-com-error-codes).</span><span class="sxs-lookup"><span data-stu-id="d215d-112">For additional information on HRESULTs, see [Structure of COM Error Codes](/windows/desktop/com/structure-of-com-error-codes).</span></span>
-   <span data-ttu-id="d215d-113">**Inicie el objeto de colección ErrorInfo por cualquier medio que proporcione la herramienta de desarrollo.**</span><span class="sxs-lookup"><span data-stu-id="d215d-113">**Initiate the ErrorInfo collection object by whatever means your development tool provides.**</span></span> <span data-ttu-id="d215d-114">Los objetos de colección [**errorInfo**](errorinfo.md) se suelen denominar excepciones com porque permiten que un objeto pase (o produzca) información de error enriquecida a su llamador, incluso a través de límites de apartamento.</span><span class="sxs-lookup"><span data-stu-id="d215d-114">[**ErrorInfo**](errorinfo.md) collection objects are often called COM exceptions because they allow an object to pass (or throw) rich error information to its caller, even across apartment boundaries.</span></span> <span data-ttu-id="d215d-115">El valor de este objeto de error genérico es que complementa un HRESULT y extiende el tipo de información de error que se puede devolver a un llamador.</span><span class="sxs-lookup"><span data-stu-id="d215d-115">The value of this generic error object is that it supplements an HRESULT, extending the type of error information that you can return to a caller.</span></span> <span data-ttu-id="d215d-116">Cada objeto de colección **errorInfo** devuelve una descripción contextual, el origen del error y el identificador de interfaz del método que originó el error.</span><span class="sxs-lookup"><span data-stu-id="d215d-116">Each **ErrorInfo** collection object returns a contextual description, the source of the error, and the interface identifier of the method that originated the error.</span></span> <span data-ttu-id="d215d-117">También puede incluir punteros a una entrada en un archivo de ayuda.</span><span class="sxs-lookup"><span data-stu-id="d215d-117">You can also include pointers to an entry in a help file.</span></span> <span data-ttu-id="d215d-118">Automation proporciona tres interfaces para administrar el objeto de error.</span><span class="sxs-lookup"><span data-stu-id="d215d-118">Automation provides three interfaces to manage the error object.</span></span> <span data-ttu-id="d215d-119">El componente debe implementar la interfaz de automatización de **ISupportErrorInfo** para anunciar su compatibilidad con la colección **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="d215d-119">Your component must implement the **ISupportErrorInfo** Automation interface to advertise its support for the **ErrorInfo** collection.</span></span> <span data-ttu-id="d215d-120">Cuando se produce un error, el componente usa la interfaz de automatización **ICreateErrorInfo** para inicializar un objeto de error.</span><span class="sxs-lookup"><span data-stu-id="d215d-120">When an error occurs, the component uses the **ICreateErrorInfo** Automation interface to initialize an error object.</span></span> <span data-ttu-id="d215d-121">Una vez que el llamador inspecciona el valor HRESULT y detecta que se produjo un error en la llamada al método, consulta el objeto para ver si es compatible con la colección **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="d215d-121">After the caller inspects the HRESULT and finds that the method call failed, it queries the object to see whether it supports the **ErrorInfo** collection.</span></span> <span data-ttu-id="d215d-122">Si lo hace, el llamador utiliza la interfaz de automatización de **IErrorInfo** para recuperar la información de error.</span><span class="sxs-lookup"><span data-stu-id="d215d-122">If it does, the caller uses the **IErrorInfo** Automation interface to retrieve the error information.</span></span> <span data-ttu-id="d215d-123">Visual Basic los programadores tienen acceso sencillo al objeto de colección **errorInfo** , que se expone a través del objeto Err.</span><span class="sxs-lookup"><span data-stu-id="d215d-123">Visual Basic programmers have easy access to the **ErrorInfo** collection object, which is exposed through the Err object.</span></span> <span data-ttu-id="d215d-124">Puede generar errores con la función raise raise y detectar errores con la instrucción **on error** .</span><span class="sxs-lookup"><span data-stu-id="d215d-124">You can raise errors with the Err Raise function and catch errors with the **On Error** statement.</span></span> <span data-ttu-id="d215d-125">La Visual Basic capa en tiempo de ejecución se encarga de la asignación.</span><span class="sxs-lookup"><span data-stu-id="d215d-125">The Visual Basic run-time layer takes care of the mapping for you.</span></span> <span data-ttu-id="d215d-126">Si usa la compatibilidad con el compilador COM Visual C++, puede utilizar \_ la \_ clase de error de generación com \_ para notificar un error y la \_ clase de \_ error com para recuperar la información de error.</span><span class="sxs-lookup"><span data-stu-id="d215d-126">If you are using the Visual C++ COM compiler support, you can use the \_com\_raise\_error class to report an error and the \_com\_error class to retrieve error information.</span></span> <span data-ttu-id="d215d-127">COM+ no propagará las excepciones de C++ tradicionales como información extendida de **IErrorInfo** .</span><span class="sxs-lookup"><span data-stu-id="d215d-127">COM+ will not propagate traditional C++ exceptions as extended **IErrorInfo** information.</span></span> <span data-ttu-id="d215d-128">Para obtener más información sobre el objeto de colección **errorInfo** , vea el tema sobre el control de errores en la guía de automatización.</span><span class="sxs-lookup"><span data-stu-id="d215d-128">For additional information on the **ErrorInfo** collection object, see "Error Handling" in the Automation guide.</span></span>
    > [!Note]  
    > <span data-ttu-id="d215d-129">COM requiere que todos los objetos de colección [**errorInfo**](errorinfo.md) calculen las referencias por valor, lo que implica que los componentes que implementan la interfaz de automatización **IErrorInfo** también deben implementar y admitir la interfaz [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) .</span><span class="sxs-lookup"><span data-stu-id="d215d-129">COM requires that all [**ErrorInfo**](errorinfo.md) collection objects marshal by value, implying that components that implement the **IErrorInfo** Automation interface must also implement and support the [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) interface.</span></span> <span data-ttu-id="d215d-130">La implementación de la interfaz **IMarshal** debe admitir la serialización por valor para el componente.</span><span class="sxs-lookup"><span data-stu-id="d215d-130">The **IMarshal** interface implementation must support marshal by value for the component.</span></span>

     

-   <span data-ttu-id="d215d-131">**Usar transacciones para administrar errores de recursos compartidos.**</span><span class="sxs-lookup"><span data-stu-id="d215d-131">**Use transactions to manage shared resource failures.**</span></span> <span data-ttu-id="d215d-132">Las transacciones automáticas pueden reducir de forma significativa la cantidad de código de control de errores que se debe escribir al usar administradores de recursos administrados por el estado.</span><span class="sxs-lookup"><span data-stu-id="d215d-132">Automatic transactions can significantly reduce the amount of error-handling code you must write when using state-managed resource managers.</span></span> <span data-ttu-id="d215d-133">Sin embargo, las transacciones no eliminan por completo la necesidad de control de errores.</span><span class="sxs-lookup"><span data-stu-id="d215d-133">However, transactions do not eliminate the need for error handling altogether.</span></span> <span data-ttu-id="d215d-134">Todavía tiene que devolver códigos de error de los métodos de interfaz y comprobar los códigos de error dentro del llamador para evitar realizar un trabajo innecesario para una transacción desactivada.</span><span class="sxs-lookup"><span data-stu-id="d215d-134">You still need to return error codes from your interface methods and check those error codes within the caller to avoid doing unnecessary work for a doomed transaction.</span></span> <span data-ttu-id="d215d-135">Para obtener información adicional sobre cómo combinar el control de errores con el procesamiento de transacciones, consulte [acelerar las transacciones notificando el objeto raíz](speeding-transactions-by-notifying-the-root-object.md).</span><span class="sxs-lookup"><span data-stu-id="d215d-135">For additional information about combining error handling with transaction processing, see [Speeding Transactions by Notifying the Root Object](speeding-transactions-by-notifying-the-root-object.md).</span></span>
-   <span data-ttu-id="d215d-136">**Generar errores explícitamente.**</span><span class="sxs-lookup"><span data-stu-id="d215d-136">**Raise errors explicitly.**</span></span> <span data-ttu-id="d215d-137">Evite permitir que la información de error deje un objeto a menos que el objeto genere explícitamente el error.</span><span class="sxs-lookup"><span data-stu-id="d215d-137">Avoid letting error information leave an object unless the object explicitly raises the error.</span></span> <span data-ttu-id="d215d-138">Detectar todos los errores generados por la herramienta y controlarlos en el código de componente.</span><span class="sxs-lookup"><span data-stu-id="d215d-138">Catch all tool-generated errors and handle them in your component code.</span></span> <span data-ttu-id="d215d-139">Como mínimo, incluya un controlador estándar para informar de errores inesperados de una manera coherente.</span><span class="sxs-lookup"><span data-stu-id="d215d-139">At the very least, include a standard handler to report unexpected errors in a consistent manner.</span></span>
-   <span data-ttu-id="d215d-140">**Use el \_ intervalo de errores de instalación ITF para informar de errores específicos de la interfaz.**</span><span class="sxs-lookup"><span data-stu-id="d215d-140">**Use the FACILITY\_ITF range of errors to report interface-specific errors.**</span></span> <span data-ttu-id="d215d-141">Los errores específicos de la interfaz deben estar en el \_ intervalo de errores de instalación ITF, entre 0x0200 y 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="d215d-141">Interface-specific errors should be in the FACILITY\_ITF range of errors, between 0x0200 and 0xFFFF.</span></span> <span data-ttu-id="d215d-142">Puede definir un código de error personalizado en Visual Basic como un desplazamiento desde vbObjectError.</span><span class="sxs-lookup"><span data-stu-id="d215d-142">You can define a custom error code in Visual Basic as an offset from vbObjectError.</span></span> <span data-ttu-id="d215d-143">Use la \_ macro make HRESULT en C++ para introducir un código de error específico de la interfaz, tal como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d215d-143">Use the MAKE\_HRESULT macro in C++ to introduce an interface-specific error code, as shown in the following example:</span></span>

    ``` syntax
    const HRESULT ERROR_NUMBER = MAKE_HRESULT (SEVERITY_ERROR, FACILITY_ITF, 10);
    ```

## <a name="related-topics"></a><span data-ttu-id="d215d-144">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="d215d-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d215d-145">Aislamiento de errores y Directiva FailFast</span><span class="sxs-lookup"><span data-stu-id="d215d-145">Fault Isolation and Failfast Policy</span></span>](fault-isolation-and-failfast-policy.md)
</dt> <dt>

[<span data-ttu-id="d215d-146">Buscar el origen de un error</span><span class="sxs-lookup"><span data-stu-id="d215d-146">Finding the Source of an Error</span></span>](finding-the-source-of-an-error.md)
</dt> <dt>

[<span data-ttu-id="d215d-147">Cómo modifica COM+ los valores devueltos</span><span class="sxs-lookup"><span data-stu-id="d215d-147">How COM+ Modifies Return Values</span></span>](how-com--modifies-return-values.md)
</dt> <dt>

[<span data-ttu-id="d215d-148">Interpretar códigos de error</span><span class="sxs-lookup"><span data-stu-id="d215d-148">Interpreting Error Codes</span></span>](interpreting-error-codes.md)
</dt> <dt>

[<span data-ttu-id="d215d-149">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="d215d-149">Troubleshooting</span></span>](troubleshooting.md)
</dt> </dl>

 

 
