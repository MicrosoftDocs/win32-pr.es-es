---
description: Al crear sus propios ensamblados en paralelo, siga las directrices para crear ensamblados en paralelo y crear cualquier DLL que se incluirá en el ensamblado de acuerdo con las instrucciones de creación de un archivo DLL para un ensamblado en paralelo.
ms.assetid: 0e98bbcd-7e23-4a33-b0fa-1f936d0ef96b
title: Crear almacenamiento de estado para ensamblados en paralelo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eee388cf680ee3a186a225ca7e3bde8b6eae625d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "103814771"
---
# <a name="authoring-state-storage-for-side-by-side-assemblies"></a><span data-ttu-id="9936a-103">Crear almacenamiento de estado para ensamblados en paralelo</span><span class="sxs-lookup"><span data-stu-id="9936a-103">Authoring State Storage for Side-by-side Assemblies</span></span>

<span data-ttu-id="9936a-104">Al crear sus propios ensamblados en paralelo, siga las [directrices para crear ensamblados en paralelo](guidelines-for-creating-side-by-side-assemblies.md) y crear cualquier dll que se incluirá en el ensamblado de acuerdo con las instrucciones de [creación de un archivo DLL para un ensamblado en paralelo](authoring-a-dll-for-a-side-by-side-assembly.md).</span><span class="sxs-lookup"><span data-stu-id="9936a-104">When creating your own side-by-side assemblies, follow the [Guidelines for Creating Side-by-side Assemblies](guidelines-for-creating-side-by-side-assemblies.md) and author any DLL to be included in the assembly according to the guidelines in [Authoring a DLL for a Side-by-Side Assembly](authoring-a-dll-for-a-side-by-side-assembly.md).</span></span>

<span data-ttu-id="9936a-105">Siga las instrucciones siguientes para el almacenamiento del estado:</span><span class="sxs-lookup"><span data-stu-id="9936a-105">Adhere to the following guidelines for the storage of the state:</span></span>

-   <span data-ttu-id="9936a-106">Almacenamiento del estado de diseño para que sea compatible con versiones anteriores y posteriores.</span><span class="sxs-lookup"><span data-stu-id="9936a-106">Design state storage to be forward and backward compatible.</span></span> <span data-ttu-id="9936a-107">Espere que las versiones se usen en cualquier orden: por ejemplo, V1, V3 y V2.</span><span class="sxs-lookup"><span data-stu-id="9936a-107">Expect the versions to be used in any order: for example, v1, then v3, then v2.</span></span>
-   <span data-ttu-id="9936a-108">Inicialice y establezca la configuración predeterminada para el ensamblado en el código de ensamblado.</span><span class="sxs-lookup"><span data-stu-id="9936a-108">Initialize and set the default settings for the assembly in the assembly code.</span></span> <span data-ttu-id="9936a-109">No guarde los valores predeterminados en el registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-109">Do not save the defaults settings in the registry.</span></span>
-   <span data-ttu-id="9936a-110">La configuración del registro se debe escribir en una versión individual para aislar varias versiones de ensamblado que se pueden ejecutar al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="9936a-110">Registry settings must be written on an individual-version basis to isolate multiple assembly versions that may be run at the same time.</span></span> <span data-ttu-id="9936a-111">Diseñe el ensamblado en paralelo para almacenar y controlar correctamente el estado del ensamblado durante escenarios de uso compartido en paralelo.</span><span class="sxs-lookup"><span data-stu-id="9936a-111">Design your side-by-side assembly to correctly store and handle the state of the assembly during side-by-side sharing scenarios.</span></span>
-   <span data-ttu-id="9936a-112">Normalmente, los ensamblados almacenan información de estado en las claves del registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-112">Assemblies commonly store state information in registry keys.</span></span> <span data-ttu-id="9936a-113">Cree un conjunto de archivos de encabezado y funciones auxiliares para proporcionar una manera sencilla de crear una versión de las claves del registro que contenga el estado del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="9936a-113">Author a set of header files and helper functions to provide an easy way to version registry keys containing the assembly state.</span></span>
-   <span data-ttu-id="9936a-114">Cualquier información de estado de ensamblado guardada en el registro debe estar aislada de otras versiones del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="9936a-114">Any assembly state information saved in the registry must be isolated from other versions of the assembly.</span></span> <span data-ttu-id="9936a-115">La configuración de estado almacenada en el registro se debe guardar en secciones de versión individuales del registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-115">State settings stored in the registry must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="9936a-116">Esto es necesario en las partes HKLM y HKCU del registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-116">This is required in both the HKLM and HKCU parts of the registry.</span></span> <span data-ttu-id="9936a-117">Por ejemplo, almacene la configuración de estado de HKCU para la versión de ensamblado XXXX en la siguiente clave del registro:</span><span class="sxs-lookup"><span data-stu-id="9936a-117">For example, store HKCU state settings for assembly version XXXX under the following registry key:</span></span>

    <span data-ttu-id="9936a-118">**HKCU** \\ **MyCompany** \\ **Componente** \\ **VersionXXXX**</span><span class="sxs-lookup"><span data-stu-id="9936a-118">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXXX**</span></span>

-   <span data-ttu-id="9936a-119">Cualquier información de estado almacenada en el registro por ensamblados compartidos se debe guardar en secciones de versión individuales del registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-119">Any state information stored in the registry by shared assemblies must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="9936a-120">Por ejemplo, una configuración de estado denominada EnableSuperCoolFeature podría tener un valor **true** o **false**.</span><span class="sxs-lookup"><span data-stu-id="9936a-120">For example, a state setting called EnableSuperCoolFeature might have a value of **TRUE** or **FALSE**.</span></span> <span data-ttu-id="9936a-121">Almacene el valor de un [*ensamblado en paralelo compartido*](s-sbscs-gly.md) como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="9936a-121">Store the value for a [*shared side-by-side assembly*](s-sbscs-gly.md) as follows:</span></span>

    <span data-ttu-id="9936a-122">**HKEY \_ CurrentUser** \\ **software** \\ **MyCompany** \\  \\ **versión de 01.01** \\ **EnableSuperCoolFeature = true**</span><span class="sxs-lookup"><span data-stu-id="9936a-122">**HKEY\_CurrentUser**\\**Software**\\**MyCompany**\\**MyComponent**\\**Version01.01**\\**EnableSuperCoolFeature = TRUE**</span></span>

-   <span data-ttu-id="9936a-123">Cualquier información de estado almacenada en el registro por ensamblados privados debe guardarse en secciones de aplicación individuales del registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-123">Any state information stored in the registry by private assemblies must be saved in individual application sections of the registry.</span></span> <span data-ttu-id="9936a-124">Esto aísla la configuración de estado del ensamblado en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9936a-124">This isolates the assembly's state settings to the application.</span></span> <span data-ttu-id="9936a-125">Puede utilizar la función [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) para configurar una raíz virtual.</span><span class="sxs-lookup"><span data-stu-id="9936a-125">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="9936a-126">Por ejemplo, si la versión de ensamblado XXYY es un ensamblado privado de "SomeApplication", una llamada a **GetModuleFileName** devuelve "SomeApplication" y cualquier configuración de estado privado para el ensamblado se debe escribir en la clave siguiente:</span><span class="sxs-lookup"><span data-stu-id="9936a-126">For example, if assembly version XXYY is a private assembly of "SomeApplication," a call to **GetModuleFileName** returns "SomeApplication" and any private state settings for the assembly should be written under the following key:</span></span>

    <span data-ttu-id="9936a-127">**HKCU** \\ **MyCompany** \\ **Componente** \\ **VersionXXYY** \\ **SomeApplication**</span><span class="sxs-lookup"><span data-stu-id="9936a-127">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXYY**\\**SomeApplication**</span></span>

-   <span data-ttu-id="9936a-128">Realice la configuración de estado compartido almacenada en el registro de forma privada en el contexto de ensamblado que ejecuta.</span><span class="sxs-lookup"><span data-stu-id="9936a-128">Make shared state settings stored in the registry private to the assembly context that runs.</span></span> <span data-ttu-id="9936a-129">Puede utilizar la función [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) para configurar una raíz virtual.</span><span class="sxs-lookup"><span data-stu-id="9936a-129">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="9936a-130">Esto se debe hacer para las ramas HKLM y HKCU.</span><span class="sxs-lookup"><span data-stu-id="9936a-130">This should be done for HKLM and HKCU branches.</span></span>
-   <span data-ttu-id="9936a-131">Idealmente, debe adoptar un modelo de persistencia en el que la aplicación conserve el estado y no modifique el registro.</span><span class="sxs-lookup"><span data-stu-id="9936a-131">Ideally, you should adopt a persistence model in which the application persists the state and does not alter the registry.</span></span> <span data-ttu-id="9936a-132">No es necesario que una aplicación toque directamente las entradas del registro del componente.</span><span class="sxs-lookup"><span data-stu-id="9936a-132">An application should not need to directly touch the component's registry entries.</span></span> <span data-ttu-id="9936a-133">En su lugar, el ensamblado debe ofrecer funciones de API que guardan o restauran configuraciones que son compatibles en paralelo.</span><span class="sxs-lookup"><span data-stu-id="9936a-133">Instead, the assembly should offer API functions that save or restore settings that are side-by-side compatible.</span></span>
-   <span data-ttu-id="9936a-134">Los ensamblados pueden guardar la configuración de estado en almacenes fuera del registro para permitir que el ensamblado interactúe con el estado global.</span><span class="sxs-lookup"><span data-stu-id="9936a-134">Assemblies may save state settings in stores outside the registry to enable the assembly to interact with the global state.</span></span> <span data-ttu-id="9936a-135">Los ensamblados simultáneos pueden usar los siguientes almacenes compatibles en paralelo:</span><span class="sxs-lookup"><span data-stu-id="9936a-135">Side-by-side assemblies may use the following side-by-side compatible stores:</span></span>
    -   <span data-ttu-id="9936a-136">Un almacén protegido (*pstore*)</span><span class="sxs-lookup"><span data-stu-id="9936a-136">A protected store (*pstore*)</span></span>
    -   <span data-ttu-id="9936a-137">Una caché WinInet</span><span class="sxs-lookup"><span data-stu-id="9936a-137">A WinInet cache</span></span>
    -   <span data-ttu-id="9936a-138">Un Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="9936a-138">A Microsoft SQL Server</span></span>

 

 
