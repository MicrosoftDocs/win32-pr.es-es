---
description: La función WSAAccept permite a una aplicación obtener información del llamador como el identificador del autor de la llamada y la calidad del servicio antes de decidir si aceptar una solicitud de conexión entrante.
ms.assetid: 65883556-6890-4d0a-8c7f-c4ff68642caf
title: Configuración y desmontaje de la conexión
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9c4ac1f32524d097e11825f8104eb41fee3c528
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696390"
---
# <a name="connection-setup-and-teardown"></a><span data-ttu-id="81327-103">Configuración y desmontaje de la conexión</span><span class="sxs-lookup"><span data-stu-id="81327-103">Connection Setup and Teardown</span></span>

<span data-ttu-id="81327-104">La función [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) permite a una aplicación obtener información del llamador como el identificador del autor de la llamada y la calidad del servicio antes de decidir si aceptar una solicitud de conexión entrante.</span><span class="sxs-lookup"><span data-stu-id="81327-104">The [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) function lets an application obtain caller information such as caller identifier and Quality of Service before deciding whether to accept an incoming connection request.</span></span> <span data-ttu-id="81327-105">Esto se hace con una devolución de llamada a una función de condición proporcionada por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="81327-105">This is done with a callback to an application-supplied condition function.</span></span>

<span data-ttu-id="81327-106">Los datos de usuario a usuario especificados por los parámetros de la función [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) y la función de condición de [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) se pueden transferir al mismo nivel durante el establecimiento de la conexión, siempre que el proveedor de servicios admita esta característica.</span><span class="sxs-lookup"><span data-stu-id="81327-106">User-to-user data specified by parameters in the [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function and the condition function of [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) can be transferred to the peer during connection establishment, provided this feature is supported by the service provider.</span></span>

<span data-ttu-id="81327-107">También es posible (para los protocolos que lo admiten) intercambiar datos de usuario entre los extremos en el momento de la destrucción de la conexión.</span><span class="sxs-lookup"><span data-stu-id="81327-107">It is also possible (for protocols that support this) to exchange user data between the endpoints at connection teardown time.</span></span> <span data-ttu-id="81327-108">El final que inicia el montaje puede llamar a la función [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) para indicar que no se van a enviar más datos e iniciar la secuencia de destrucción de la conexión.</span><span class="sxs-lookup"><span data-stu-id="81327-108">The end that initiates the teardown can call the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function to indicate that no more data be sent and to initiate the connection teardown sequence.</span></span> <span data-ttu-id="81327-109">Para determinados protocolos, parte del montaje es la entrega de datos de desconexión del iniciador de desmontaje.</span><span class="sxs-lookup"><span data-stu-id="81327-109">For certain protocols, part of teardown is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="81327-110">Después de recibir el aviso de que el extremo remoto ha iniciado la desmontaje (normalmente mediante la indicación FD de \_ cierre), se puede llamar a la función [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) para recibir los datos de desconexión, si los hay.</span><span class="sxs-lookup"><span data-stu-id="81327-110">After receiving notice that the remote end has initiated teardown (typically by the FD\_CLOSE indication), the [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) function can be called to receive the disconnect data, if any.</span></span>

<span data-ttu-id="81327-111">Para ilustrar cómo se pueden usar los datos de desconexión, considere el siguiente escenario.</span><span class="sxs-lookup"><span data-stu-id="81327-111">To illustrate how disconnect data can be used, consider the following scenario.</span></span> <span data-ttu-id="81327-112">La mitad del cliente de una aplicación cliente/servidor es responsable de finalizar una conexión de socket.</span><span class="sxs-lookup"><span data-stu-id="81327-112">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="81327-113">Coincidentes con la terminación, proporciona (mediante Disconnect Data) el número total de transacciones que ha procesado con el servidor.</span><span class="sxs-lookup"><span data-stu-id="81327-113">Coincident with the termination, it provides (using disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="81327-114">A su vez, el servidor responde con el total acumulado de transacciones que ha procesado con todos los clientes.</span><span class="sxs-lookup"><span data-stu-id="81327-114">The server in turn responds with the cumulative total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="81327-115">La secuencia de llamadas e indicaciones podría producirse de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="81327-115">The sequence of calls and indications might occur as follows:</span></span>

| <span data-ttu-id="81327-116">En el cliente</span><span class="sxs-lookup"><span data-stu-id="81327-116">Client side</span></span>                                                                                                              | <span data-ttu-id="81327-117">En el servidor</span><span class="sxs-lookup"><span data-stu-id="81327-117">Server side</span></span>                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="81327-118">(1) invoque [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) para concluir la sesión y proporcionar el total de la transacción.</span><span class="sxs-lookup"><span data-stu-id="81327-118">(1) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to conclude session and supply transaction total.</span></span>            |                                                                                                                                                                                                                               |
|                                                                                                                          | <span data-ttu-id="81327-119">(2) obtener FD \_ Close, [**recibir**](/windows/desktop/api/winsock/nf-winsock-recv) con un valor devuelto de cero o [WSAEDISCON](windows-sockets-error-codes-2.md) error devuelto por [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) que indica un cierre correcto en curso.</span><span class="sxs-lookup"><span data-stu-id="81327-119">(2) Get FD\_CLOSE, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) with a return value of zero, or [WSAEDISCON](windows-sockets-error-codes-2.md) error return from [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indicating graceful shutdown in progress.</span></span> |
|                                                                                                                          | <span data-ttu-id="81327-120">(3) invocación de [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) para obtener el total de la transacción del cliente.</span><span class="sxs-lookup"><span data-stu-id="81327-120">(3) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to get client's transaction total.</span></span>                                                                                                                                |
|                                                                                                                          | <span data-ttu-id="81327-121">(4) calcular el total general acumulado de todas las transacciones.</span><span class="sxs-lookup"><span data-stu-id="81327-121">(4) Compute cumulative grand total of all transactions.</span></span>                                                                                                                                                                       |
|                                                                                                                          | <span data-ttu-id="81327-122">(5) invoque [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) para transmitir el total general.</span><span class="sxs-lookup"><span data-stu-id="81327-122">(5) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to transmit grand total.</span></span>                                                                                                                                          |
| <span data-ttu-id="81327-123">(6) recibir la \_ indicación de cierre FD.</span><span class="sxs-lookup"><span data-stu-id="81327-123">(6) Receive FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="81327-124">(5A) invocación de [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="81327-124">(5a) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                                                                                                                             |
| <span data-ttu-id="81327-125">(7) invoque [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) para recibir y almacenar el total general de transacciones acumulativas.</span><span class="sxs-lookup"><span data-stu-id="81327-125">(7) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                                                                                                               |
| <span data-ttu-id="81327-126">(8) invocación de [ **closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span><span class="sxs-lookup"><span data-stu-id="81327-126">(8) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span></span>                                                                          |                                                                                                                                                                                                                               |



 

<span data-ttu-id="81327-127">Tenga en cuenta que el paso (5A) debe seguir el paso (5), pero no tiene relación de tiempo con el paso (6), (7) o (8).</span><span class="sxs-lookup"><span data-stu-id="81327-127">Note that step (5a) must follow step (5), but has no timing relationship with step (6), (7), or (8).</span></span>

 

 



