---
description: Paso 3.
ms.assetid: b2b5dafc-d38d-4ec3-a390-55229495b4f9
title: Paso 3. Compatibilidad con la negociación de tipos de medios
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eb3ff8539d0d7de2c9b7300ddb90ad86ca471710
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "103914126"
---
# <a name="step-3-support-media-type-negotiation"></a><span data-ttu-id="8483a-104">Paso 3.</span><span class="sxs-lookup"><span data-stu-id="8483a-104">Step 3.</span></span> <span data-ttu-id="8483a-105">Compatibilidad con la negociación de tipos de medios</span><span class="sxs-lookup"><span data-stu-id="8483a-105">Support Media Type Negotiation</span></span>

<span data-ttu-id="8483a-106">Este es el paso 3 del tutorial de [escritura de filtros de transformación](writing-transform-filters.md).</span><span class="sxs-lookup"><span data-stu-id="8483a-106">This is step 3 of the tutorial [Writing Transform Filters](writing-transform-filters.md).</span></span>

<span data-ttu-id="8483a-107">Cuando dos patillas se conectan, deben aceptar un tipo de medio para la conexión.</span><span class="sxs-lookup"><span data-stu-id="8483a-107">When two pins connect, they must agree on a media type for the connection.</span></span> <span data-ttu-id="8483a-108">El tipo de medio describe el formato de los datos.</span><span class="sxs-lookup"><span data-stu-id="8483a-108">The media type describes the format of the data.</span></span> <span data-ttu-id="8483a-109">Sin el tipo de medio, un filtro podría proporcionar un tipo de datos, solo para que otro filtro lo trate como algo más.</span><span class="sxs-lookup"><span data-stu-id="8483a-109">Without the media type, a filter might deliver one kind of data, only to have another filter treat it as something else.</span></span>

<span data-ttu-id="8483a-110">El mecanismo básico para negociar tipos de medios es el método [**IPin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) .</span><span class="sxs-lookup"><span data-stu-id="8483a-110">The basic mechanism for negotiating media types is the [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) method.</span></span> <span data-ttu-id="8483a-111">El PIN de salida llama a este método en el PIN de entrada con un tipo de medio propuesto.</span><span class="sxs-lookup"><span data-stu-id="8483a-111">The output pin calls this method on the input pin with a proposed media type.</span></span> <span data-ttu-id="8483a-112">El PIN de entrada acepta la conexión o la rechaza.</span><span class="sxs-lookup"><span data-stu-id="8483a-112">The input pin accepts the connection or rejects it.</span></span> <span data-ttu-id="8483a-113">Si rechaza la conexión, el PIN de salida puede intentar otro tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="8483a-113">If it rejects the connection, the output pin can try another media type.</span></span> <span data-ttu-id="8483a-114">Si no se encuentra ningún tipo adecuado, se produce un error en la conexión.</span><span class="sxs-lookup"><span data-stu-id="8483a-114">If no suitable types are found, the connection fails.</span></span> <span data-ttu-id="8483a-115">Opcionalmente, el PIN de entrada puede anunciar una lista de tipos que prefiere, a través del método [**IPin:: EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) .</span><span class="sxs-lookup"><span data-stu-id="8483a-115">Optionally, the input pin can advertise a list of types that it prefers, through the [**IPin::EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) method.</span></span> <span data-ttu-id="8483a-116">El PIN de salida puede utilizar esta lista cuando propone tipos de medios, aunque no es necesario.</span><span class="sxs-lookup"><span data-stu-id="8483a-116">The output pin can use this list when it proposes media types, although it does not have to.</span></span>

<span data-ttu-id="8483a-117">La clase **CTransformFilter** implementa un marco general para este proceso, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="8483a-117">The **CTransformFilter** class implements a general framework for this process, as follows:</span></span>

-   <span data-ttu-id="8483a-118">El PIN de entrada no tiene tipos de medios preferidos.</span><span class="sxs-lookup"><span data-stu-id="8483a-118">The input pin has no preferred media types.</span></span> <span data-ttu-id="8483a-119">Se basa completamente en el filtro de nivel superior para proponer el tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="8483a-119">It relies entirely on the upstream filter to propose the media type.</span></span> <span data-ttu-id="8483a-120">En el caso de los datos de vídeo, esto tiene sentido, ya que el tipo de medio incluye el tamaño de la imagen y la velocidad de fotogramas.</span><span class="sxs-lookup"><span data-stu-id="8483a-120">For video data, this makes sense, because the media type includes the image size and the frame rate.</span></span> <span data-ttu-id="8483a-121">Normalmente, esa información debe proporcionarse mediante un filtro de origen o un filtro de analizador de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="8483a-121">Typically, that information must be supplied by an upstream source filter or parser filter.</span></span> <span data-ttu-id="8483a-122">En el caso de los datos de audio, el conjunto de formatos posibles es más pequeño, por lo que puede ser práctico que el PIN de entrada ofrezca algunos tipos preferidos.</span><span class="sxs-lookup"><span data-stu-id="8483a-122">In the case of audio data, the set of possible formats is smaller, so it may be practical for the input pin to offer some preferred types.</span></span> <span data-ttu-id="8483a-123">En ese caso, invalide [**CBasePin:: GetMediaType**](cbasepin-getmediatype.md) en el PIN de entrada.</span><span class="sxs-lookup"><span data-stu-id="8483a-123">In that case, override [**CBasePin::GetMediaType**](cbasepin-getmediatype.md) on the input pin.</span></span>
-   <span data-ttu-id="8483a-124">Cuando el filtro de nivel superior propone un tipo de medio, el PIN de entrada llama al método [**CTransformFilter:: CheckInputType**](ctransformfilter-checkinputtype.md) , que acepta o rechaza el tipo.</span><span class="sxs-lookup"><span data-stu-id="8483a-124">When the upstream filter proposes a media type, the input pin calls the [**CTransformFilter::CheckInputType**](ctransformfilter-checkinputtype.md) method, which accepts or rejects the type.</span></span>
-   <span data-ttu-id="8483a-125">El PIN de salida no se conectará a menos que el PIN de entrada se conecte primero.</span><span class="sxs-lookup"><span data-stu-id="8483a-125">The output pin will not connect unless the input pin is connected first.</span></span> <span data-ttu-id="8483a-126">Este comportamiento es habitual para los filtros de transformación.</span><span class="sxs-lookup"><span data-stu-id="8483a-126">This behavior is typical for transform filters.</span></span> <span data-ttu-id="8483a-127">En la mayoría de los casos, el filtro debe determinar el tipo de entrada antes de que pueda establecer el tipo de salida.</span><span class="sxs-lookup"><span data-stu-id="8483a-127">In most cases, the filter must determine the input type before it can set the output type.</span></span>
-   <span data-ttu-id="8483a-128">Cuando el PIN de salida se conecta, tiene una lista de tipos de medios que se propone al filtro de bajada.</span><span class="sxs-lookup"><span data-stu-id="8483a-128">When the output pin does connect, it has a list of media types that it proposes to the downstream filter.</span></span> <span data-ttu-id="8483a-129">Llama al método [**CTransformFilter:: GetMediaType**](ctransformfilter-getmediatype.md) para generar esta lista.</span><span class="sxs-lookup"><span data-stu-id="8483a-129">It calls the [**CTransformFilter::GetMediaType**](ctransformfilter-getmediatype.md) method to generate this list.</span></span> <span data-ttu-id="8483a-130">El PIN de salida también probará los tipos de medios que propone el filtro de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="8483a-130">The output pin will also try any media types that the downstream filter proposes.</span></span>
-   <span data-ttu-id="8483a-131">Para comprobar si un tipo de salida determinado es compatible con el tipo de entrada, el PIN de salida llama al método [**CTransformFilter:: CheckTransform**](ctransformfilter-checktransform.md) .</span><span class="sxs-lookup"><span data-stu-id="8483a-131">To check whether a particular output type is compatible with the input type, the output pin calls the [**CTransformFilter::CheckTransform**](ctransformfilter-checktransform.md) method.</span></span>

<span data-ttu-id="8483a-132">Los tres métodos **CTransformFilter** enumerados anteriormente son métodos virtuales puros, por lo que la clase derivada debe implementarlos.</span><span class="sxs-lookup"><span data-stu-id="8483a-132">The three **CTransformFilter** methods listed previously are pure virtual methods, so your derived class must implement them.</span></span> <span data-ttu-id="8483a-133">Ninguno de estos métodos pertenece a una interfaz COM; simplemente forman parte de la implementación proporcionada por las clases base.</span><span class="sxs-lookup"><span data-stu-id="8483a-133">None of these methods belongs to a COM interface; they are simply part of the implementation provided by the base classes.</span></span>

<span data-ttu-id="8483a-134">En las secciones siguientes se describe cada método con más detalle:</span><span class="sxs-lookup"><span data-stu-id="8483a-134">The following sections describe each method in more detail:</span></span>

-   [<span data-ttu-id="8483a-135">Paso 3A. Implementar el método CheckInputType</span><span class="sxs-lookup"><span data-stu-id="8483a-135">Step 3A. Implement the CheckInputType Method</span></span>](step-3a--implement-the-checkinputtype-method.md)
-   [<span data-ttu-id="8483a-136">Paso 3B. Implementar el método GetMediaType</span><span class="sxs-lookup"><span data-stu-id="8483a-136">Step 3B. Implement the GetMediaType Method</span></span>](step-3b--implement-the-getmediatype-method.md)
-   [<span data-ttu-id="8483a-137">Paso 3C. Implementar el método CheckTransform</span><span class="sxs-lookup"><span data-stu-id="8483a-137">Step 3C. Implement the CheckTransform Method</span></span>](step-3c--implement-the-checktransform-method.md)

## <a name="related-topics"></a><span data-ttu-id="8483a-138">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="8483a-138">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8483a-139">Cómo se conectan los filtros</span><span class="sxs-lookup"><span data-stu-id="8483a-139">How Filters Connect</span></span>](how-filters-connect.md)
</dt> <dt>

[<span data-ttu-id="8483a-140">Escribir filtros de DirectShow</span><span class="sxs-lookup"><span data-stu-id="8483a-140">Writing DirectShow Filters</span></span>](writing-directshow-filters.md)
</dt> </dl>

 

 



