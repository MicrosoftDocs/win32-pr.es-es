---
description: 'En este tema se describen tres temas interrelacionados: entorno protegido, puerta de enlace de interoperabilidad multimedia y revocación y renovación.'
ms.assetid: e88806ae-0041-4b4a-a8df-69718a651e82
title: Ruta de acceso a medios protegidos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7304edadf1623d41bc2f1f5c6b2b4cda2dd5f598
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/03/2021
ms.locfileid: "104557749"
---
# <a name="protected-media-path"></a><span data-ttu-id="63d0e-103">Ruta de acceso a medios protegidos</span><span class="sxs-lookup"><span data-stu-id="63d0e-103">Protected Media Path</span></span>

<span data-ttu-id="63d0e-104">En este tema se describen tres temas interrelacionados: entorno protegido, puerta de enlace de interoperabilidad multimedia y revocación y renovación.</span><span class="sxs-lookup"><span data-stu-id="63d0e-104">This topic discusses three interrelated topics: protected environment, media interoperability gateway, and revocation and renewal.</span></span>

-   <span data-ttu-id="63d0e-105">Un entorno protegido (PE) es un conjunto de tecnologías que permite que el contenido protegido fluya desde y hasta a través de Windows Vista de manera protegida.</span><span class="sxs-lookup"><span data-stu-id="63d0e-105">A protected environment (PE) is a set of technologies that enables protected content to flow from and through Windows Vista in a protected fashion.</span></span> <span data-ttu-id="63d0e-106">Todos los componentes de dentro de un entorno protegido son de confianza y el proceso está protegido contra la manipulación.</span><span class="sxs-lookup"><span data-stu-id="63d0e-106">All components inside a protected environment are trusted and the process is protected against tampering.</span></span>
-   <span data-ttu-id="63d0e-107">La ruta de acceso a medios protegidos (PMP) es un archivo ejecutable que se ejecuta en un entorno protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-107">The protected media path (PMP) is an executable that runs in a protected environment.</span></span>
-   <span data-ttu-id="63d0e-108">Si un componente de confianza en el PE se pone en peligro, después del proceso de vencimiento, se revocará.</span><span class="sxs-lookup"><span data-stu-id="63d0e-108">If a trusted component in the PE becomes compromised, after due process it will be revoked.</span></span> <span data-ttu-id="63d0e-109">Sin embargo, Microsoft proporciona un mecanismo de renovación para instalar una versión de confianza más reciente del componente cuando está disponible.</span><span class="sxs-lookup"><span data-stu-id="63d0e-109">However, Microsoft provides a renewal mechanism to install a newer trusted version of the component when one becomes available.</span></span>

<span data-ttu-id="63d0e-110">Para obtener información acerca de los componentes multimedia protegidos de la firma de código, consulte las notas del producto [firma de código para componentes multimedia protegidos en Windows Vista](/windows-hardware/test/hlk/).</span><span class="sxs-lookup"><span data-stu-id="63d0e-110">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/).</span></span>

<span data-ttu-id="63d0e-111">Este tema contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="63d0e-111">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="63d0e-112">Entorno protegido</span><span class="sxs-lookup"><span data-stu-id="63d0e-112">Protected Environment</span></span>](#protected-environment)
-   [<span data-ttu-id="63d0e-113">Diseño del entorno protegido</span><span class="sxs-lookup"><span data-stu-id="63d0e-113">Design of the Protected Environment</span></span>](#design-of-the-protected-environment)
-   [<span data-ttu-id="63d0e-114">Ruta de acceso a medios protegidos</span><span class="sxs-lookup"><span data-stu-id="63d0e-114">Protected Media Path</span></span>](#protected-media-path)
    -   [<span data-ttu-id="63d0e-115">Entidades de confianza de entrada</span><span class="sxs-lookup"><span data-stu-id="63d0e-115">Input Trust Authorities</span></span>](#input-trust-authorities)
    -   [<span data-ttu-id="63d0e-116">Entidades de confianza de salida</span><span class="sxs-lookup"><span data-stu-id="63d0e-116">Output Trust Authorities</span></span>](#output-trust-authorities)
    -   [<span data-ttu-id="63d0e-117">Objetos de Directiva</span><span class="sxs-lookup"><span data-stu-id="63d0e-117">Policy Objects</span></span>](#policy-objects)
    -   [<span data-ttu-id="63d0e-118">Crear objetos en el PMP</span><span class="sxs-lookup"><span data-stu-id="63d0e-118">Creating Objects in the PMP</span></span>](#creating-objects-in-the-pmp)
-   [<span data-ttu-id="63d0e-119">Información general sobre la negociación de directivas</span><span class="sxs-lookup"><span data-stu-id="63d0e-119">Overview of Policy Negotiation</span></span>](#overview-of-policy-negotiation)
-   [<span data-ttu-id="63d0e-120">Revocación y renovación</span><span class="sxs-lookup"><span data-stu-id="63d0e-120">Revocation and Renewal</span></span>](#revocation-and-renewal)
-   [<span data-ttu-id="63d0e-121">Protección de vínculo de salida</span><span class="sxs-lookup"><span data-stu-id="63d0e-121">Output Link Protection</span></span>](#output-link-protection)
-   [<span data-ttu-id="63d0e-122">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="63d0e-122">Related topics</span></span>](#related-topics)

## <a name="protected-environment"></a><span data-ttu-id="63d0e-123">Entorno protegido</span><span class="sxs-lookup"><span data-stu-id="63d0e-123">Protected Environment</span></span>

<span data-ttu-id="63d0e-124">La protección de contenido abarca varias tecnologías, cada una de las cuales intenta asegurarse de que el contenido no se puede usar de forma que sea incoherente con el intento del propietario o del proveedor de contenido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-124">Content protection encompasses multiple technologies, each of which attempts to ensure that content cannot be used in a way that is inconsistent with the intent of the content owner or provider.</span></span> <span data-ttu-id="63d0e-125">Estas tecnologías incluyen la protección contra copia, la protección de vínculos, el acceso condicional y la administración de derechos digitales (DRM).</span><span class="sxs-lookup"><span data-stu-id="63d0e-125">These technologies include copy protection, link protection, conditional access, and digital rights management (DRM).</span></span> <span data-ttu-id="63d0e-126">La base de cada es una relación de confianza: el acceso al contenido solo se concede a los componentes de software que se adhieren a los términos de uso asignados a ese contenido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-126">The foundation of each is trust: Access to the content is granted only to software components that adhere to the terms of use assigned to that content.</span></span>

<span data-ttu-id="63d0e-127">Para minimizar las amenazas contra contenido protegido, Windows Vista y el software Media Foundation permiten que el código de confianza se ejecute en un entorno protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-127">To minimize threats against protected content, Windows Vista and Media Foundation Software enable trusted code to run in a protected environment.</span></span> <span data-ttu-id="63d0e-128">Un PE es un conjunto de componentes, directrices y herramientas diseñados para aumentar la protección contra la piratería de contenido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-128">A PE is a set of components, guidelines, and tools designed to increase protection against content piracy.</span></span>

<span data-ttu-id="63d0e-129">Antes de examinar el PE más detenidamente, es importante comprender las amenazas que está diseñada para minimizar.</span><span class="sxs-lookup"><span data-stu-id="63d0e-129">Before examining the PE more closely, it is important to understand the threats it is designed to minimize.</span></span> <span data-ttu-id="63d0e-130">Supongamos que está ejecutando una aplicación multimedia en un proceso de modo de usuario.</span><span class="sxs-lookup"><span data-stu-id="63d0e-130">Suppose you are running a media application in a user-mode process.</span></span> <span data-ttu-id="63d0e-131">La aplicación está vinculada a las diversas bibliotecas de vínculos dinámicos (dll) que contienen complementos multimedia, como descodificadores.</span><span class="sxs-lookup"><span data-stu-id="63d0e-131">The application is linked to the various dynamic link libraries (DLLs) that contain media plug-ins, such as decoders.</span></span> <span data-ttu-id="63d0e-132">Otros procesos también se ejecutan en modo de usuario y se cargan varios controladores en el kernel.</span><span class="sxs-lookup"><span data-stu-id="63d0e-132">Other processes are also running in user mode, and various drivers are loaded in the kernel.</span></span> <span data-ttu-id="63d0e-133">Si no se implementa ningún mecanismo de confianza, existen las siguientes amenazas:</span><span class="sxs-lookup"><span data-stu-id="63d0e-133">If no trust mechanism is in place, the following threats exist:</span></span>

-   <span data-ttu-id="63d0e-134">La aplicación puede tener acceso a los medios protegidos directamente o a piratear la memoria de proceso.</span><span class="sxs-lookup"><span data-stu-id="63d0e-134">The application can access protected media directly or hack the process memory.</span></span>
-   <span data-ttu-id="63d0e-135">Los complementos pueden tener acceso al contenido directamente o atacar la memoria del proceso.</span><span class="sxs-lookup"><span data-stu-id="63d0e-135">Plug-ins can access the content directly or hack the process memory.</span></span>
-   <span data-ttu-id="63d0e-136">Otros procesos pueden atacar la memoria del proceso multimedia directamente o mediante la inserción de código.</span><span class="sxs-lookup"><span data-stu-id="63d0e-136">Other processes can hack the media process memory either directly or by injecting code.</span></span>
-   <span data-ttu-id="63d0e-137">Los controladores de kernel pueden atacar la memoria de proceso multimedia.</span><span class="sxs-lookup"><span data-stu-id="63d0e-137">Kernel drivers can hack the media process memory.</span></span>
-   <span data-ttu-id="63d0e-138">El contenido se puede enviar fuera del sistema a través de un medio desprotegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-138">Content might be sent outside the system over an unprotected medium.</span></span> <span data-ttu-id="63d0e-139">(La protección de vínculos está diseñada para mitigar esta amenaza).</span><span class="sxs-lookup"><span data-stu-id="63d0e-139">(Link protection is designed to mitigate against this threat.)</span></span>

## <a name="design-of-the-protected-environment"></a><span data-ttu-id="63d0e-140">Diseño del entorno protegido</span><span class="sxs-lookup"><span data-stu-id="63d0e-140">Design of the Protected Environment</span></span>

<span data-ttu-id="63d0e-141">Un entorno protegido se ejecuta en un proceso protegido independiente de la aplicación multimedia.</span><span class="sxs-lookup"><span data-stu-id="63d0e-141">A protected environment runs in a separate protected process from the media application.</span></span> <span data-ttu-id="63d0e-142">La característica de proceso protegido de Windows Vista impide que otros procesos tengan acceso al proceso protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-142">The protected process feature of Windows Vista stops other processes from accessing the protected process.</span></span>

<span data-ttu-id="63d0e-143">Cuando se crea un proceso protegido, los componentes principales del kernel identifican los componentes y complementos que no son de confianza para que el entorno protegido pueda negar su carga.</span><span class="sxs-lookup"><span data-stu-id="63d0e-143">When a protected process is created, core kernel components identify untrusted components and plug-ins so that the protected environment can refuse to load them.</span></span> <span data-ttu-id="63d0e-144">Un componente de confianza es aquél que Microsoft ha firmado correctamente.</span><span class="sxs-lookup"><span data-stu-id="63d0e-144">A trusted component is one that has been appropriately signed by Microsoft.</span></span> <span data-ttu-id="63d0e-145">El kernel también realiza el seguimiento de los módulos que se cargan en él, lo que permite que el entorno protegido detenga la reproducción del contenido protegido si se carga un módulo que no es de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-145">The kernel also tracks modules that load into it, enabling the protected environment to stop playback of protected content if an untrusted module is loaded.</span></span> <span data-ttu-id="63d0e-146">Antes de cargar un componente de kernel, el kernel comprueba para determinar si es de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-146">Before a kernel component is loaded, the kernel checks to determine whether it is trusted.</span></span> <span data-ttu-id="63d0e-147">Si no es así, los componentes de confianza que ya están en el PE rechazan el contenido protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-147">If it is not, trusted components already in the PE refuse to process protected content.</span></span> <span data-ttu-id="63d0e-148">Para habilitar esto, los componentes de PE realizan periódicamente un protocolo de enlace protegido criptográficamente con el kernel.</span><span class="sxs-lookup"><span data-stu-id="63d0e-148">To enable this, PE components periodically perform a cryptographically-protected handshake with the kernel.</span></span> <span data-ttu-id="63d0e-149">Si hay un componente de modo kernel que no es de confianza, se produce un error en el protocolo de enlace y indica al PE que hay un componente que no es de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-149">If an untrusted kernel mode component is present, the handshake fails and indicates to the PE that an untrusted component exists.</span></span>

<span data-ttu-id="63d0e-150">Si un componente de confianza se pone en peligro, se puede revocar después del proceso de vencimiento.</span><span class="sxs-lookup"><span data-stu-id="63d0e-150">If a trusted component becomes compromised, after due process it can be revoked.</span></span> <span data-ttu-id="63d0e-151">Microsoft proporciona un mecanismo de renovación para instalar una versión de confianza más reciente cuando esté disponible.</span><span class="sxs-lookup"><span data-stu-id="63d0e-151">Microsoft provides a renewal mechanism to install a newer trusted version when available.</span></span>

## <a name="protected-media-path"></a><span data-ttu-id="63d0e-152">Ruta de acceso a medios protegidos</span><span class="sxs-lookup"><span data-stu-id="63d0e-152">Protected Media Path</span></span>

<span data-ttu-id="63d0e-153">La ruta de acceso a medios protegidos (PMP) es el ejecutable principal de PE para Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="63d0e-153">The protected media path (PMP) is the primary PE executable for Media Foundation.</span></span> <span data-ttu-id="63d0e-154">El PMP es extensible, de modo que se pueden admitir mecanismos de protección de contenido de terceros.</span><span class="sxs-lookup"><span data-stu-id="63d0e-154">The PMP is extensible, so that third-party content protection mechanisms can be supported.</span></span>

<span data-ttu-id="63d0e-155">El PMP acepta contenido protegido y directivas asociadas de cualquier origen de Media Foundation mediante cualquier sistema de protección de contenido, incluidos los que proporcionan terceros.</span><span class="sxs-lookup"><span data-stu-id="63d0e-155">The PMP accepts protected content and associated policies from any Media Foundation source using any content protection system, including those provided by third parties.</span></span> <span data-ttu-id="63d0e-156">Envía contenido a cualquier receptor de Media Foundation, siempre y cuando el receptor cumpla las directivas especificadas por el origen.</span><span class="sxs-lookup"><span data-stu-id="63d0e-156">It sends content to any Media Foundation sink, as long as the sink complies with the policies specified by the source.</span></span> <span data-ttu-id="63d0e-157">También admite transformaciones entre el origen y el receptor, incluidas las transformaciones de terceros, siempre y cuando sean de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-157">It also supports transforms between the source and the sink, including third-party transforms, as long as they are trusted.</span></span>

<span data-ttu-id="63d0e-158">El PMP se ejecuta en un proceso protegido aislado de la aplicación multimedia.</span><span class="sxs-lookup"><span data-stu-id="63d0e-158">The PMP runs in a protected process isolated from the media application.</span></span> <span data-ttu-id="63d0e-159">La aplicación solo tiene la capacidad de intercambiar mensajes de comando y control con el PMP, pero no tiene acceso al contenido después de pasarlo a la PMP.</span><span class="sxs-lookup"><span data-stu-id="63d0e-159">The application only has the ability to exchange command and control messages with the PMP, but does not have access to content after it is passed to the PMP.</span></span> <span data-ttu-id="63d0e-160">En el siguiente diagrama se muestra este proceso.</span><span class="sxs-lookup"><span data-stu-id="63d0e-160">The following diagram illustrates this process.</span></span>

![diagrama de la ruta de acceso a los medios protegidos](images/pmp04.png)

<span data-ttu-id="63d0e-162">Los cuadros sombreados representan componentes que pueden ser proporcionados por terceros.</span><span class="sxs-lookup"><span data-stu-id="63d0e-162">Shaded boxes represent components that might be provided by third parties.</span></span> <span data-ttu-id="63d0e-163">Todos los componentes creados en el proceso protegido deben estar firmados y son de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-163">All components created inside the protected process must be signed and trusted.</span></span>

<span data-ttu-id="63d0e-164">La aplicación crea una instancia de la sesión multimedia dentro del proceso protegido y recibe un puntero a una sesión multimedia del proxy, que calcula las referencias de los punteros de interfaz en el límite del proceso.</span><span class="sxs-lookup"><span data-stu-id="63d0e-164">The application creates an instance of the Media Session inside the protected process and receives a pointer to a proxy Media Session, which marshals interface pointers across the process boundary.</span></span>

<span data-ttu-id="63d0e-165">El origen de medios se puede crear en el proceso de la aplicación, como se muestra aquí, o dentro del proceso protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-165">The media source can be created either within the application process, as shown here, or inside the protected process.</span></span> <span data-ttu-id="63d0e-166">Si el origen de medios se crea dentro del proceso de la aplicación, el origen crea un proxy para sí mismo en el proceso protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-166">If the media source is created inside the application process, the source creates a proxy for itself in the protected process.</span></span>

<span data-ttu-id="63d0e-167">Todos los demás componentes de canalización, como descodificadores y receptores de medios, se crean en el proceso protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-167">All other pipeline components, such as decoders and media sinks, are created in the protected process.</span></span> <span data-ttu-id="63d0e-168">Si estos objetos exponen cualquier interfaz personalizada para las aplicaciones, deben proporcionar un proxy o código auxiliar DCOM para calcular las referencias de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="63d0e-168">If these objects expose any custom interfaces for applications, they must provide a DCOM proxy/stub to marshal the interface.</span></span>

<span data-ttu-id="63d0e-169">Para aplicar la Directiva en el contenido protegido a medida que fluye a través de la canalización, el PMP usa tres tipos de componentes: entidades de confianza de entrada (ITAs), entidades de confianza de salida (OTAs) y objetos de directiva.</span><span class="sxs-lookup"><span data-stu-id="63d0e-169">To enforce policy on protected content as it flows through the pipeline, the PMP uses three types of components: input trust authorities (ITAs), output trust authorities (OTAs), and policy objects.</span></span> <span data-ttu-id="63d0e-170">Estos componentes funcionan juntos para conceder o restringir derechos para usar el contenido, y para especificar las protecciones del vínculo que se deben emplear al reproducir contenido, como Content Protection digital de ancho de banda alto (HDCP).</span><span class="sxs-lookup"><span data-stu-id="63d0e-170">These components work together to grant or restrict rights to use content, and to specify the link protections that must be employed when playing content, such as High-bandwidth Digital Content Protection (HDCP).</span></span>

### <a name="input-trust-authorities"></a><span data-ttu-id="63d0e-171">Entidades de confianza de entrada</span><span class="sxs-lookup"><span data-stu-id="63d0e-171">Input Trust Authorities</span></span>

<span data-ttu-id="63d0e-172">Un origen de medios de confianza crea una ITA y realiza varias funciones:</span><span class="sxs-lookup"><span data-stu-id="63d0e-172">An ITA is created by a trusted media source, and performs several functions:</span></span>

-   <span data-ttu-id="63d0e-173">Especifica los derechos para usar el contenido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-173">Specifies rights to use content.</span></span> <span data-ttu-id="63d0e-174">Los derechos pueden incluir el derecho a reproducir contenido, transferirlo a un dispositivo, etc.</span><span class="sxs-lookup"><span data-stu-id="63d0e-174">Rights can include the right to play content, transfer it to a device, and so on.</span></span> <span data-ttu-id="63d0e-175">Define una lista ordenada de sistemas de protección de salida aprobados y las directivas de salida correspondientes para cada sistema.</span><span class="sxs-lookup"><span data-stu-id="63d0e-175">It defines an ordered list of approved output protection systems and the corresponding output policies for each system.</span></span> <span data-ttu-id="63d0e-176">La ITA almacena esta información en un objeto de directiva.</span><span class="sxs-lookup"><span data-stu-id="63d0e-176">The ITA stores this information in a policy object.</span></span>
-   <span data-ttu-id="63d0e-177">Proporciona el descifrador necesario para descifrar el contenido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-177">Provides the decryptor needed to decrypt the content.</span></span>
-   <span data-ttu-id="63d0e-178">Establece la confianza con el módulo kernel en el entorno protegido para asegurarse de que la ITA se ejecuta dentro de un entorno de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-178">Establishes trust with the kernel module in the protected environment, to ensure that the ITA is running inside a trusted environment.</span></span>

<span data-ttu-id="63d0e-179">Una ITA está asociada a un flujo individual que contiene contenido protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-179">An ITA is associated with an individual stream containing protected content.</span></span> <span data-ttu-id="63d0e-180">Un flujo solo puede tener una ITA y una instancia de ITA solo se puede asociar a una secuencia.</span><span class="sxs-lookup"><span data-stu-id="63d0e-180">A stream can have only one ITA, and an instance of an ITA can be associated with only one stream.</span></span>

### <a name="output-trust-authorities"></a><span data-ttu-id="63d0e-181">Entidades de confianza de salida</span><span class="sxs-lookup"><span data-stu-id="63d0e-181">Output Trust Authorities</span></span>

<span data-ttu-id="63d0e-182">Un OTA está asociado a una salida de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-182">An OTA is associated with a trusted output.</span></span> <span data-ttu-id="63d0e-183">La OTA expone una acción que la salida de confianza puede realizar en el contenido, como reproducir o copiar.</span><span class="sxs-lookup"><span data-stu-id="63d0e-183">The OTA exposes an action that the trusted output can perform on the content, such as playback or copying.</span></span> <span data-ttu-id="63d0e-184">Su rol es aplicar uno o varios sistemas de protección de salida requeridos por la ITA.</span><span class="sxs-lookup"><span data-stu-id="63d0e-184">Its role is to enforce one or more output protection systems that are required by the ITA.</span></span> <span data-ttu-id="63d0e-185">La OTA consulta el objeto de directiva proporcionado por ITA para determinar qué sistema de protección debe aplicar.</span><span class="sxs-lookup"><span data-stu-id="63d0e-185">The OTA queries the policy object provided by ITA to determine which protection system it must enforce.</span></span>

### <a name="policy-objects"></a><span data-ttu-id="63d0e-186">Objetos de Directiva</span><span class="sxs-lookup"><span data-stu-id="63d0e-186">Policy Objects</span></span>

<span data-ttu-id="63d0e-187">Un objeto de directiva encapsula los requisitos de protección de contenido de una ITA.</span><span class="sxs-lookup"><span data-stu-id="63d0e-187">A policy object encapsulates the content protection requirements of an ITA.</span></span> <span data-ttu-id="63d0e-188">Lo usa el motor de directivas para negociar la compatibilidad de la protección de contenido con una OTA.</span><span class="sxs-lookup"><span data-stu-id="63d0e-188">It is used by the policy engine to negotiate content protection support with an OTA.</span></span> <span data-ttu-id="63d0e-189">OTAs los objetos de directiva de consulta para determinar los sistemas de protección que deben aplicar en cada salida del contenido actual.</span><span class="sxs-lookup"><span data-stu-id="63d0e-189">OTAs query policy objects to determine what protection systems they must enforce on each output of the current content.</span></span>

### <a name="creating-objects-in-the-pmp"></a><span data-ttu-id="63d0e-190">Crear objetos en el PMP</span><span class="sxs-lookup"><span data-stu-id="63d0e-190">Creating Objects in the PMP</span></span>

<span data-ttu-id="63d0e-191">Para crear un objeto en la ruta de acceso a medios protegidos (PMP), [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) llama a [**IMFPMPHostApp:: ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), con el formato **IStream** de entrada especificado de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="63d0e-191">To create an object in the protected media path (PMP), the [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) calls [**IMFPMPHostApp::ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), with the specified input **IStream** formatted in the following way:</span></span>

``` syntax
Format: (All DWORD values are serialized in little-endian order)
[GUID (content protection system guid, obtained from Windows.Media.Protection.MediaProtectionSystemId)]
[DWORD (track count, use the actual track count even if all tracks are encrypted using the same data, note that zero is invalid)]
[DWORD (next track ID, use -1 if all remaining tracks are encrypted using the same data)]
[DWORD (next track's binary data size)]
[BYTE* (next track's binary data)]
{ Repeat from "next track ID" above for each stream }
```

## <a name="overview-of-policy-negotiation"></a><span data-ttu-id="63d0e-192">Información general sobre la negociación de directivas</span><span class="sxs-lookup"><span data-stu-id="63d0e-192">Overview of Policy Negotiation</span></span>

<span data-ttu-id="63d0e-193">Hay tres requisitos fundamentales que deben cumplirse antes de que se pueda procesar el contenido protegido en el PMP.</span><span class="sxs-lookup"><span data-stu-id="63d0e-193">There are three fundamental requirements that must be met before protected content can be processed in the PMP.</span></span> <span data-ttu-id="63d0e-194">En primer lugar, solo se debe enviar contenido protegido a salidas de confianza.</span><span class="sxs-lookup"><span data-stu-id="63d0e-194">First, protected content must be sent only to trusted outputs.</span></span> <span data-ttu-id="63d0e-195">En segundo lugar, solo se deben aplicar las acciones permitidas a un flujo.</span><span class="sxs-lookup"><span data-stu-id="63d0e-195">Second, only permitted actions must be applied to a stream.</span></span> <span data-ttu-id="63d0e-196">En tercer lugar, solo se deben usar los sistemas de protección de salida aprobados para reproducir un flujo.</span><span class="sxs-lookup"><span data-stu-id="63d0e-196">Third, only approved output protection systems must be used to play a stream.</span></span> <span data-ttu-id="63d0e-197">El motor de directivas coordina entre ITAs y OTAs para asegurarse de que se cumplen estos requisitos.</span><span class="sxs-lookup"><span data-stu-id="63d0e-197">The policy engine coordinates between ITAs and OTAs to ensure that these requirements are met.</span></span>

<span data-ttu-id="63d0e-198">La forma más fácil de entender el proceso es recorrer un ejemplo simplificado que identifica los pasos necesarios para reproducir contenido de formato de sistema avanzado (ASF) protegido por Rights Management digital (WMDRM) de Windows Media.</span><span class="sxs-lookup"><span data-stu-id="63d0e-198">The easiest way to understand process is to walk through a simplified example that identifies the steps necessary to play Advanced System Format (ASF) content protected by Windows Media Digital Rights Management (WMDRM).</span></span>

<span data-ttu-id="63d0e-199">Cuando un usuario inicia una aplicación de reproducción y abre un archivo ASF que tiene una secuencia de audio protegida y una secuencia de vídeo protegida, se deben realizar los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="63d0e-199">When a user launches a player application and opens an ASF file that has a protected audio stream and a protected video stream, the following steps must be performed:</span></span>

1.  <span data-ttu-id="63d0e-200">La aplicación crea el origen de medios ASF y la sesión de la ruta de acceso a medios protegidos (PMP).</span><span class="sxs-lookup"><span data-stu-id="63d0e-200">The application creates the ASF media source and the protected media path (PMP) session.</span></span> <span data-ttu-id="63d0e-201">Media Foundation crea un proceso de PMP.</span><span class="sxs-lookup"><span data-stu-id="63d0e-201">Media Foundation creates a PMP process.</span></span>
2.  <span data-ttu-id="63d0e-202">La aplicación crea una topología parcial que contiene un nodo de origen de audio conectado al representador de audio y un nodo de origen de vídeo conectado al representador de vídeo mejorado (EVR).</span><span class="sxs-lookup"><span data-stu-id="63d0e-202">The application creates a partial topology that contains an audio source node connected to the audio renderer, and a video source node connected to the enhanced video renderer (EVR).</span></span> <span data-ttu-id="63d0e-203">En el caso de los representadores, la aplicación no crea directamente el representador.</span><span class="sxs-lookup"><span data-stu-id="63d0e-203">For the renderers, the application does not directly create the renderer.</span></span> <span data-ttu-id="63d0e-204">En su lugar, la aplicación crea en el proceso sin protección un objeto conocido como *objeto de activación*.</span><span class="sxs-lookup"><span data-stu-id="63d0e-204">Instead, the application creates in the unprotected process an object known as an *activation object*.</span></span> <span data-ttu-id="63d0e-205">El PMP usa el objeto de activación para crear los representadores en el proceso protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-205">The PMP uses the activation object to create the renderers in the protected process.</span></span> <span data-ttu-id="63d0e-206">(Para obtener más información sobre los objetos de activación, vea [objetos de activación](activation-objects.md)).</span><span class="sxs-lookup"><span data-stu-id="63d0e-206">(For more information about activation objects, see [Activation Objects](activation-objects.md).)</span></span>
3.  <span data-ttu-id="63d0e-207">La aplicación establece la topología parcial en la sesión de PMP.</span><span class="sxs-lookup"><span data-stu-id="63d0e-207">The application sets the partial topology on the PMP session.</span></span>
4.  <span data-ttu-id="63d0e-208">La sesión de PMP serializa la topología y la pasa al host de PMP en el proceso protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-208">The PMP session serializes the topology and passes it to the PMP host in the protected process.</span></span> <span data-ttu-id="63d0e-209">El host de PMP envía la topología al motor de directivas.</span><span class="sxs-lookup"><span data-stu-id="63d0e-209">The PMP host sends the topology to the policy engine.</span></span>
5.  <span data-ttu-id="63d0e-210">El cargador de topología llama a [**IMFInputTrustAuthority:: GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) en el itas e inserta los descifradores en la topología inmediatamente inferior de los nodos de origen correspondientes.</span><span class="sxs-lookup"><span data-stu-id="63d0e-210">The topology loader calls [**IMFInputTrustAuthority::GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) on the ITAs and inserts the decrypters into the topology immediately downstream of the corresponding source nodes.</span></span>
6.  <span data-ttu-id="63d0e-211">El cargador de topología inserta los descodificadores de audio y vídeo de nivel inferior de los nodos de Decrypter.</span><span class="sxs-lookup"><span data-stu-id="63d0e-211">The topology loader inserts the audio and video decoders downstream of the decrypter nodes.</span></span>
7.  <span data-ttu-id="63d0e-212">El motor de directivas examina los nodos insertados para determinar si alguno implementa la interfaz [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) .</span><span class="sxs-lookup"><span data-stu-id="63d0e-212">The policy engine scans the inserted nodes to determine whether any implement the [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) interface.</span></span> <span data-ttu-id="63d0e-213">Los EVR y el representador de audio implementan **IMFTrustedOutput**, ya que envían datos fuera de la PMP.</span><span class="sxs-lookup"><span data-stu-id="63d0e-213">The EVR and the audio renderer both implement **IMFTrustedOutput**, because they send data outside the PMP.</span></span>
8.  <span data-ttu-id="63d0e-214">Cada ITA confirma que se ejecuta dentro de un proceso protegido mediante la realización de un protocolo de enlace criptográfico con un módulo de kernel de entorno protegido.</span><span class="sxs-lookup"><span data-stu-id="63d0e-214">Each ITA confirms that it is running inside a protected process by performing a cryptographic handshake with a protected environment kernel module.</span></span>
9.  <span data-ttu-id="63d0e-215">Para cada flujo, el motor de directivas negocia la Directiva obteniendo un objeto de directiva de la ITA y pasándolo a la OTA.</span><span class="sxs-lookup"><span data-stu-id="63d0e-215">For each stream, the policy engine negotiates policy by getting a policy object from the ITA and passing it to the OTA.</span></span> <span data-ttu-id="63d0e-216">La OTA proporciona una lista de los sistemas de protección que admite y el objeto de directiva indica qué sistemas de protección deben aplicarse, junto con la configuración correcta.</span><span class="sxs-lookup"><span data-stu-id="63d0e-216">The OTA provides a list of the protection systems that it supports, and the policy object indicates which protection systems must be applied, along with the correct settings.</span></span> <span data-ttu-id="63d0e-217">Después, la OTA aplica esta configuración.</span><span class="sxs-lookup"><span data-stu-id="63d0e-217">The OTA then applies these settings.</span></span> <span data-ttu-id="63d0e-218">Si no puede hacerlo, el contenido se bloquea.</span><span class="sxs-lookup"><span data-stu-id="63d0e-218">If it cannot do so, the content is blocked.</span></span>

## <a name="revocation-and-renewal"></a><span data-ttu-id="63d0e-219">Revocación y renovación</span><span class="sxs-lookup"><span data-stu-id="63d0e-219">Revocation and Renewal</span></span>

<span data-ttu-id="63d0e-220">Un componente de confianza se puede revocar si se pone en peligro o se detecta que infringe los contratos de licencia en los que se confía inicialmente.</span><span class="sxs-lookup"><span data-stu-id="63d0e-220">A trusted component can be revoked if it becomes compromised or is discovered to be violating the license agreements under which it was initially trusted.</span></span> <span data-ttu-id="63d0e-221">Existe un mecanismo de renovación para instalar una versión más reciente y de mayor confianza del componente.</span><span class="sxs-lookup"><span data-stu-id="63d0e-221">A renewal mechanism exists to install a newer, more trusted version of the component.</span></span>

<span data-ttu-id="63d0e-222">Los componentes de confianza se firman con un certificado criptográfico.</span><span class="sxs-lookup"><span data-stu-id="63d0e-222">Trusted components are signed using a cryptographic certificate.</span></span> <span data-ttu-id="63d0e-223">Microsoft publica una lista de revocación global (GRL) que identifica los componentes que se han revocado.</span><span class="sxs-lookup"><span data-stu-id="63d0e-223">Microsoft publishes a global revocation list (GRL) which identifies components that have been revoked.</span></span> <span data-ttu-id="63d0e-224">El GRL está firmado digitalmente para garantizar su autenticidad.</span><span class="sxs-lookup"><span data-stu-id="63d0e-224">The GRL is digitally signed to ensure its authenticity.</span></span> <span data-ttu-id="63d0e-225">Los propietarios de contenido pueden garantizar, a través del mecanismo de la Directiva, que la versión actual del GRL está presente en el equipo del usuario.</span><span class="sxs-lookup"><span data-stu-id="63d0e-225">Content owners can ensure, through the policy mechanism, that the current version of the GRL is present on the user's computer.</span></span>

## <a name="output-link-protection"></a><span data-ttu-id="63d0e-226">Protección de vínculo de salida</span><span class="sxs-lookup"><span data-stu-id="63d0e-226">Output Link Protection</span></span>

<span data-ttu-id="63d0e-227">Cuando se ve el contenido de vídeo Premium, los fotogramas descifrados descomprimidos viajan a través de un conector físico al dispositivo de pantalla.</span><span class="sxs-lookup"><span data-stu-id="63d0e-227">When premium video content is viewed, the decrypted, uncompressed frames travel across a physical connector to the display device.</span></span> <span data-ttu-id="63d0e-228">Los proveedores de contenido pueden requerir que los fotogramas de vídeo estén protegidos en este punto, a medida que viajan por el conector físico.</span><span class="sxs-lookup"><span data-stu-id="63d0e-228">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span> <span data-ttu-id="63d0e-229">Existen varios mecanismos de protección para este propósito, como High-Bandwidth Digital Content Protection (HDCP) y DisplayPort Content Protection (DPCP).</span><span class="sxs-lookup"><span data-stu-id="63d0e-229">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP).</span></span> <span data-ttu-id="63d0e-230">La transmisión por video con la transmisión por vídeo se aplica a estas protecciones mediante el [Administrador de protección de salida](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="63d0e-230">The video OTA enforces these protections by using the [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="63d0e-231">El administrador de protección de salida envía comandos al controlador de gráficos y el controlador de gráficos exige cualquier mecanismo de protección de vínculos que requiera la Directiva.</span><span class="sxs-lookup"><span data-stu-id="63d0e-231">The Output Protection Manager sends commands to the graphics driver, and the graphics driver enforces whatever link protection mechanisms are required by the policy.</span></span>

![un diagrama que muestra la relación entre el vídeo OTA y OPM.](images/pmp05.png)

## <a name="related-topics"></a><span data-ttu-id="63d0e-233">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="63d0e-233">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="63d0e-234">Acerca de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="63d0e-234">About Media Foundation</span></span>](about-the-media-foundation-sdk.md)
</dt> <dt>

[<span data-ttu-id="63d0e-235">Arquitectura de Media Foundation</span><span class="sxs-lookup"><span data-stu-id="63d0e-235">Media Foundation Architecture</span></span>](media-foundation-architecture.md)
</dt> <dt>

[<span data-ttu-id="63d0e-236">Content Protection basados en GPU</span><span class="sxs-lookup"><span data-stu-id="63d0e-236">GPU-Based Content Protection</span></span>](gpu-based-content-protection.md)
</dt> <dt>

[<span data-ttu-id="63d0e-237">Administrador de protección de salida</span><span class="sxs-lookup"><span data-stu-id="63d0e-237">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> <dt>

[<span data-ttu-id="63d0e-238">Sesión de medios de PMP</span><span class="sxs-lookup"><span data-stu-id="63d0e-238">PMP Media Session</span></span>](pmp-media-session.md)
</dt> </dl>

 

 
