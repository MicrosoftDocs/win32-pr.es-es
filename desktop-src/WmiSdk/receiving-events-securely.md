---
description: Los consumidores temporales y permanentes tienen distintos métodos para proteger la entrega de eventos.
ms.assetid: cd02e5db-f9e2-438b-9632-0a1387a6d4e3
ms.tgt_platform: multiple
title: Recepción segura de eventos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f27d156213553ee17a346d780cbea0ff82beca83
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105667867"
---
# <a name="receiving-events-securely"></a><span data-ttu-id="4b244-103">Recepción segura de eventos</span><span class="sxs-lookup"><span data-stu-id="4b244-103">Receiving Events Securely</span></span>

<span data-ttu-id="4b244-104">Los consumidores temporales y permanentes tienen distintos métodos para proteger la entrega de eventos.</span><span class="sxs-lookup"><span data-stu-id="4b244-104">Temporary and permanent consumers have different methods of securing event delivery.</span></span>

<span data-ttu-id="4b244-105">En este tema se describen las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="4b244-105">The following sections are discussed in this topic:</span></span>

-   [<span data-ttu-id="4b244-106">Protección de consumidores temporales</span><span class="sxs-lookup"><span data-stu-id="4b244-106">Securing Temporary Consumers</span></span>](#securing-temporary-consumers)
-   [<span data-ttu-id="4b244-107">Protección de consumidores permanentes</span><span class="sxs-lookup"><span data-stu-id="4b244-107">Securing Permanent Consumers</span></span>](#securing-permanent-consumers)
-   [<span data-ttu-id="4b244-108">Protección de la suscripción permanente</span><span class="sxs-lookup"><span data-stu-id="4b244-108">Securing the Permanent Subscription</span></span>](#securing-the-permanent-subscription)
-   [<span data-ttu-id="4b244-109">Establecimiento de un Administrator-Only SD</span><span class="sxs-lookup"><span data-stu-id="4b244-109">Setting an Administrator-Only SD</span></span>](#setting-an-administrator-only-sd)
-   [<span data-ttu-id="4b244-110">Suplantar la identidad del proveedor de eventos</span><span class="sxs-lookup"><span data-stu-id="4b244-110">Impersonating the Event Provider Identity</span></span>](#impersonating-the-event-provider-identity)
-   [<span data-ttu-id="4b244-111">SID y suscripciones permanentes</span><span class="sxs-lookup"><span data-stu-id="4b244-111">SIDs and Permanent Subscriptions</span></span>](#sids-and-permanent-subscriptions)
-   [<span data-ttu-id="4b244-112">Crear suscripciones permanentes mediante cuentas de dominio</span><span class="sxs-lookup"><span data-stu-id="4b244-112">Creating Permanent Subscriptions Using Domain Accounts</span></span>](#creating-permanent-subscriptions-using-domain-accounts)
-   [<span data-ttu-id="4b244-113">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="4b244-113">Related topics</span></span>](#related-topics)

## <a name="securing-temporary-consumers"></a><span data-ttu-id="4b244-114">Protección de consumidores temporales</span><span class="sxs-lookup"><span data-stu-id="4b244-114">Securing Temporary Consumers</span></span>

<span data-ttu-id="4b244-115">Un [*consumidor temporal*](gloss-t.md) se ejecuta hasta que se reinicia el sistema o se detiene WMI, pero no se puede iniciar si se produce un evento específico.</span><span class="sxs-lookup"><span data-stu-id="4b244-115">A [*temporary consumers*](gloss-t.md) runs until the system is rebooted or WMI is stopped but cannot be started if a specific event is raised.</span></span> <span data-ttu-id="4b244-116">Por ejemplo, una llamada a [**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) crea un consumidor temporal.</span><span class="sxs-lookup"><span data-stu-id="4b244-116">For example, a call to [**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) creates a temporary consumer.</span></span>

<span data-ttu-id="4b244-117">Las llamadas [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) o [**IWbemServices:: ExecNotificationQuery**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-execnotificationquery) crean consumidores de eventos temporales.</span><span class="sxs-lookup"><span data-stu-id="4b244-117">The calls [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) or [**IWbemServices::ExecNotificationQuery**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-execnotificationquery) create temporary event consumers.</span></span> <span data-ttu-id="4b244-118">Los consumidores temporales no pueden controlar quién proporciona eventos al [*receptor*](gloss-s.md) de eventos que crean.</span><span class="sxs-lookup"><span data-stu-id="4b244-118">Temporary consumers cannot control who provides events to the event [*sink*](gloss-s.md) they create.</span></span>

<span data-ttu-id="4b244-119">Las llamadas a métodos [**ExecNotificationQuery**](swbemservices-execnotificationquery.md) se pueden realizar sincrónicamente, de forma [*semisincrónica*](gloss-s.md)o asincrónica.</span><span class="sxs-lookup"><span data-stu-id="4b244-119">Calls to [**ExecNotificationQuery**](swbemservices-execnotificationquery.md) methods can be made synchronously, [*semisynchronously*](gloss-s.md), or asynchronously.</span></span> <span data-ttu-id="4b244-120">Por ejemplo, [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) es un método sincrónico que se puede llamar sincrónicamente, en función de cómo se establezca el parámetro *iflags* .</span><span class="sxs-lookup"><span data-stu-id="4b244-120">For example, [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) is a synchronous method that can be called semisynchronously, depending on how the *iflags* parameter is set.</span></span> <span data-ttu-id="4b244-121">[**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) es una llamada asincrónica.</span><span class="sxs-lookup"><span data-stu-id="4b244-121">[**SWbemServices.ExecNotificationQueryAsync**](swbemservices-execnotificationqueryasync.md) is an asynchronous call.</span></span>

<span data-ttu-id="4b244-122">Tenga en cuenta que la devolución de llamada al receptor para las versiones asincrónicas de estas llamadas podría no devolverse en el mismo nivel de autenticación que la llamada realizada por el script.</span><span class="sxs-lookup"><span data-stu-id="4b244-122">Be aware that the callback to the sink for the asynchronous versions of these calls might not be returned at the same authentication level as the call the script made.</span></span> <span data-ttu-id="4b244-123">Por lo tanto, se recomienda usar semisincrónico en lugar de llamadas asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="4b244-123">Therefore, it is recommended that you use semisynchronous instead of asynchronous calls.</span></span> <span data-ttu-id="4b244-124">Si necesita una comunicación asincrónica, consulte [llamar a un método](calling-a-method.md) y [establecer la seguridad en una llamada asincrónica](setting-security-on-an-asynchronous-call.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-124">If you require asynchronous communication, see [Calling a Method](calling-a-method.md) and [Setting Security on an Asynchronous Call](setting-security-on-an-asynchronous-call.md).</span></span>

<span data-ttu-id="4b244-125">Los suscriptores de scripting no pueden comprobar los derechos de acceso de un proveedor de eventos para proporcionar eventos al receptor creado por el script.</span><span class="sxs-lookup"><span data-stu-id="4b244-125">Scripting subscribers cannot check the access rights of an event provider to provide events to the sink created by the script.</span></span> <span data-ttu-id="4b244-126">Por lo tanto, se recomienda que las llamadas a [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) utilicen la forma semisincrónica de la llamada y usen la configuración de seguridad específica.</span><span class="sxs-lookup"><span data-stu-id="4b244-126">Therefore, it is recommended that calls to [**SWbemServices.ExecNotificationQuery**](swbemservices-execnotificationquery.md) use the semisynchronous form of the call and use specific security settings.</span></span> <span data-ttu-id="4b244-127">Para obtener más información, vea [crear una llamada semisincrónica con VBScript](making-a-semisynchronous-call-with-vbscript.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-127">For more information, see [Making a Semisynchronous Call with VBScript](making-a-semisynchronous-call-with-vbscript.md).</span></span>

## <a name="securing-permanent-consumers"></a><span data-ttu-id="4b244-128">Protección de consumidores permanentes</span><span class="sxs-lookup"><span data-stu-id="4b244-128">Securing Permanent Consumers</span></span>

<span data-ttu-id="4b244-129">Un [*consumidor permanente*](gloss-p.md) tiene una suscripción permanente a los eventos de un proveedor de eventos que se conservarán después de que se reinicie el sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="4b244-129">A [*permanent consumers*](gloss-p.md) has a permanent subscription to events from an event provider that will persist after the operating system is restarted.</span></span> <span data-ttu-id="4b244-130">Un proveedor de eventos que admite consumidores permanentes es un [*proveedor de consumidores de eventos*](gloss-e.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-130">An event provider that supports permanent consumers is a [*event consumer provider*](gloss-e.md).</span></span> <span data-ttu-id="4b244-131">Si el proveedor de eventos no se está ejecutando cuando se produce un evento, WMI inicia el proveedor cuando necesita proporcionar eventos.</span><span class="sxs-lookup"><span data-stu-id="4b244-131">If the event provider is not running when an event occurs, then WMI starts the provider when it needs to deliver events.</span></span> <span data-ttu-id="4b244-132">WMI identifica a qué proveedor de consumidores deben entregarse los eventos, en función de la instancia de [**\_ \_ EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) , que asocia la instancia del proveedor de consumidores [**\_ \_ Win32Provider**](--win32provider.md) a una [*clase de consumidor lógica*](gloss-l.md) definida por el proveedor del consumidor.</span><span class="sxs-lookup"><span data-stu-id="4b244-132">WMI identifies which consumer provider the events should be delivered to, based on the [**\_\_EventConsumerProviderRegistration**](--eventconsumerproviderregistration.md) instance, which associates the consumer provider [**\_\_Win32Provider**](--win32provider.md) instance with a [*logical consumer class*](gloss-l.md) defined by the consumer provider.</span></span> <span data-ttu-id="4b244-133">Para obtener más información sobre el rol de los proveedores de consumidores, consulte [escribir un proveedor de consumidor de eventos](writing-an-event-consumer-provider.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-133">For more information about the role of consumer providers, see [Writing an Event Consumer Provider](writing-an-event-consumer-provider.md).</span></span>

<span data-ttu-id="4b244-134">Los consumidores permanentes pueden controlar quién les envía eventos y los proveedores de eventos pueden controlar quién accede a sus eventos.</span><span class="sxs-lookup"><span data-stu-id="4b244-134">Permanent consumers can control who sends them events and event providers can control who accesses their events.</span></span>

<span data-ttu-id="4b244-135">Las aplicaciones y los scripts de cliente crean instancias de la clase de consumidor lógico como parte de una suscripción.</span><span class="sxs-lookup"><span data-stu-id="4b244-135">Client scripts and applications create instances of the logical consumer class as part of a subscription.</span></span> <span data-ttu-id="4b244-136">La clase de consumidor lógico define la información que contiene el evento, lo que el cliente puede hacer con el evento y cómo se entrega el evento.</span><span class="sxs-lookup"><span data-stu-id="4b244-136">The logical consumer class defines what information the event contains, what the client can do with the event, and how the event is delivered.</span></span>

<span data-ttu-id="4b244-137">Las [clases de consumidor estándar](standard-consumer-classes.md) de WMI proporcionan ejemplos del rol de las clases de consumidor lógico.</span><span class="sxs-lookup"><span data-stu-id="4b244-137">The WMI [Standard Consumer Classes](standard-consumer-classes.md) provide examples of the role of logical consumer classes.</span></span> <span data-ttu-id="4b244-138">Para obtener más información, consulte [supervisión y respuesta a eventos con consumidores estándar](monitoring-and-responding-to-events-with-standard-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-138">For more information, see [Monitoring and Responding to Events with Standard Consumers](monitoring-and-responding-to-events-with-standard-consumers.md).</span></span>

## <a name="securing-the-permanent-subscription"></a><span data-ttu-id="4b244-139">Protección de la suscripción permanente</span><span class="sxs-lookup"><span data-stu-id="4b244-139">Securing the Permanent Subscription</span></span>

<span data-ttu-id="4b244-140">Las suscripciones permanentes tienen mayor potencial para causar problemas de seguridad en WMI y, por tanto, tienen los siguientes requisitos de seguridad:</span><span class="sxs-lookup"><span data-stu-id="4b244-140">Permanent subscriptions have greater potential to cause security problems in WMI and therefore have the following security requirements:</span></span>

-   <span data-ttu-id="4b244-141">La instancia de consumidor lógico, las instancias de [**\_ \_ EventFilter**](--eventfilter.md)y [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md) deben tener el mismo identificador de seguridad (SID) individual en la propiedad **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="4b244-141">The logical consumer instance, the [**\_\_EventFilter**](--eventfilter.md), and the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) instances must have the same individual security identifier (SID) in the **CreatorSID** property.</span></span> <span data-ttu-id="4b244-142">Para obtener más información, vea [mantener el mismo SID en todas las instancias de una suscripción permanente](#sids-and-permanent-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="4b244-142">For more information, see [Keeping the same SID in all instances of a permanent subscription](#sids-and-permanent-subscriptions).</span></span>
-   <span data-ttu-id="4b244-143">La cuenta que crea la suscripción debe ser una cuenta de dominio con privilegios de administrador local o la cuenta de grupo de administradores local.</span><span class="sxs-lookup"><span data-stu-id="4b244-143">The account that creates the subscription must be either a domain account with local administrator privileges or the local Administrators group account.</span></span> <span data-ttu-id="4b244-144">El uso del SID del grupo administradores permite que la suscripción siga funcionando en el equipo local, aunque esté desconectada de la red.</span><span class="sxs-lookup"><span data-stu-id="4b244-144">Using the Administrators group SID allows the subscription to continue to work on the local computer, even if it is disconnected from the network.</span></span> <span data-ttu-id="4b244-145">El uso de una cuenta de dominio permite la identificación exacta del usuario.</span><span class="sxs-lookup"><span data-stu-id="4b244-145">Using a domain account allows exact identification of the user.</span></span>

    <span data-ttu-id="4b244-146">Sin embargo, si el equipo no está conectado y la cuenta de creación es una cuenta de dominio, se produce un error en el consumidor porque WMI no puede comprobar la identidad de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="4b244-146">However, if the computer is not connected and the creating account is a domain account, the consumer fails because WMI cannot verify the identity of the account.</span></span> <span data-ttu-id="4b244-147">Para evitar errores de suscripción si el equipo está desconectado de la red, use el SID del grupo de administradores para una suscripción.</span><span class="sxs-lookup"><span data-stu-id="4b244-147">To avoid subscription failure if the computer is disconnected from the network, use the Administrators group SID for a subscription.</span></span> <span data-ttu-id="4b244-148">En este caso, debe asegurarse de que la cuenta LocalSystem puede tener acceso a los datos de pertenencia a grupos en el dominio.</span><span class="sxs-lookup"><span data-stu-id="4b244-148">In this case, you should ensure that the LocalSystem account can access group membership data on the domain.</span></span> <span data-ttu-id="4b244-149">Algunos proveedores de consumidores de eventos tienen requisitos de seguridad especialmente elevados, ya que una suscripción no autorizada puede provocar un gran daño.</span><span class="sxs-lookup"><span data-stu-id="4b244-149">Some event consumer providers have particularly high security requirements, since a rogue subscription can cause great damage.</span></span> <span data-ttu-id="4b244-150">Algunos ejemplos son los consumidores estándar, [**ActiveScriptEventConsumer**](activescripteventconsumer.md) y [**CommandLineEventConsumer**](commandlineeventconsumer.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-150">Examples are the standard consumers, [**ActiveScriptEventConsumer**](activescripteventconsumer.md) and [**CommandLineEventConsumer**](commandlineeventconsumer.md).</span></span>

-   <span data-ttu-id="4b244-151">Puede configurar la suscripción permanente para que solo acepte eventos de identidades específicas del proveedor de eventos.</span><span class="sxs-lookup"><span data-stu-id="4b244-151">You can configure the permanent subscription to only accept events from specific event provider identities.</span></span> <span data-ttu-id="4b244-152">Establezca el descriptor de seguridad en la propiedad **EventAccess** de la instancia de [**\_ \_ EventFilter**](--eventfilter.md) en las identidades del proveedor de eventos.</span><span class="sxs-lookup"><span data-stu-id="4b244-152">Set the security descriptor in the **EventAccess** property of the [**\_\_EventFilter**](--eventfilter.md) instance to the event provider identities.</span></span> <span data-ttu-id="4b244-153">WMI compara la identidad del proveedor de eventos con el descriptor de seguridad para determinar si el proveedor tiene acceso de **\_ \_ publicación derecho de WBEM** .</span><span class="sxs-lookup"><span data-stu-id="4b244-153">WMI compares the identity of the event provider to the security descriptor to determine if the provider has **WBEM\_RIGHT\_PUBLISH** access.</span></span> <span data-ttu-id="4b244-154">Para obtener más información, vea [constantes de seguridad de WMI](wmi-security-constants.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-154">For more information, see [WMI Security Constants](wmi-security-constants.md).</span></span>

    <span data-ttu-id="4b244-155">Si el filtro permite el acceso a la identidad del proveedor de eventos, también confiará en el evento.</span><span class="sxs-lookup"><span data-stu-id="4b244-155">If the filter allows access to the event provider identity, then it also trusts the event.</span></span> <span data-ttu-id="4b244-156">Esto permite al consumidor que recibió el evento generar un evento delegado.</span><span class="sxs-lookup"><span data-stu-id="4b244-156">This allows the consumer that received the event to raise a delegated event.</span></span>

    <span data-ttu-id="4b244-157">**Nota:**  El valor predeterminado para el descriptor de seguridad en **EventAccess** es **null**, lo que permite el acceso a todos.</span><span class="sxs-lookup"><span data-stu-id="4b244-157">**Note**  The default for the security descriptor in **EventAccess** is **NULL**, which allows access to everyone.</span></span> <span data-ttu-id="4b244-158">Se recomienda limitar el acceso en la instancia de suscripción de [**\_ \_ EventFilter**](--eventfilter.md) para mejorar la seguridad de los eventos.</span><span class="sxs-lookup"><span data-stu-id="4b244-158">Limiting access in the subscription instance of [**\_\_EventFilter**](--eventfilter.md) is recommended for better event security.</span></span>

## <a name="setting-an-administrator-only-sd"></a><span data-ttu-id="4b244-159">Establecimiento de un Administrator-Only SD</span><span class="sxs-lookup"><span data-stu-id="4b244-159">Setting an Administrator-Only SD</span></span>

<span data-ttu-id="4b244-160">En el siguiente ejemplo de código de C++ se crea un descriptor de seguridad solo de administrador en la instancia de [**\_ \_ EventFilter**](--eventfilter.md) .</span><span class="sxs-lookup"><span data-stu-id="4b244-160">The following C++ code example creates an administrator-only security descriptor on the [**\_\_EventFilter**](--eventfilter.md) instance.</span></span> <span data-ttu-id="4b244-161">En este ejemplo se crea el descriptor de seguridad mediante el [lenguaje de definición de descriptores de seguridad](/windows/desktop/SecAuthZ/security-descriptor-definition-language) (SDDL).</span><span class="sxs-lookup"><span data-stu-id="4b244-161">This example creates the security descriptor using [Security Descriptor Definition Language](/windows/desktop/SecAuthZ/security-descriptor-definition-language) (SDDL).</span></span> <span data-ttu-id="4b244-162">Para obtener más información sobre WBEM, consulte **\_ el \_** apartado sobre [constantes de seguridad WMI](wmi-security-constants.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-162">For more information about **WBEM\_RIGHT\_SUBSCRIBE**, see [WMI Security Constants](wmi-security-constants.md).</span></span>


```C++
// Create SD that allows only administrators 
//    to send events to this filter. 
// The SDDL settings are O:BAG:BAD:(A;;0x80;;;BA)
// Set the EventAccess property in the 
//    IWbemClassObject of the __EventFilter instance. 
   long lMask = WBEM_RIGHT_PUBLISH;
     WCHAR wBuf[MAX_PATH];
     _ltow( lMask, wBuf, 16 );
 
HRESULT hRes = pEventFilterInstance->Put( L"EventAccess", 0,
    &_variant_t( L"O:BAG:BAD:(A;;0x80;;;BA)" ), NULL );
```



<span data-ttu-id="4b244-163">El ejemplo de código anterior requiere las siguientes instrucciones de referencia e \# inclusión.</span><span class="sxs-lookup"><span data-stu-id="4b244-163">The previous code example requires the following reference and \#include statements.</span></span>


```C++
#define _WIN32_DCOM
#include <wbemidl.h>
#include <comdef.h>

#pragma comment(lib, "wbemuuid.lib")
```



## <a name="impersonating-the-event-provider-identity"></a><span data-ttu-id="4b244-164">Suplantar la identidad del proveedor de eventos</span><span class="sxs-lookup"><span data-stu-id="4b244-164">Impersonating the Event Provider Identity</span></span>

<span data-ttu-id="4b244-165">Un consumidor permanente puede necesitar suplantar al proveedor de eventos para procesar el evento.</span><span class="sxs-lookup"><span data-stu-id="4b244-165">A permanent consumer may need to impersonate the event provider to process the event.</span></span> <span data-ttu-id="4b244-166">Los consumidores permanentes solo pueden suplantar al proveedor de eventos cuando se cumplan las condiciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="4b244-166">Permanent consumers can only impersonate the event provider when the following conditions exist:</span></span>

-   <span data-ttu-id="4b244-167">La instancia de [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md) tiene la propiedad **MaintainSecurityContext** establecida en **true**.</span><span class="sxs-lookup"><span data-stu-id="4b244-167">The instance of [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) has the **MaintainSecurityContext** property set to **True**.</span></span>
-   <span data-ttu-id="4b244-168">Un evento se entrega en el mismo contexto de seguridad en el que se encontraba el proveedor cuando generó el evento.</span><span class="sxs-lookup"><span data-stu-id="4b244-168">An event is delivered in the same security context that the provider was in when it generated the event.</span></span> <span data-ttu-id="4b244-169">Solo un consumidor implementado como un archivo DLL, un consumidor en proceso, puede recibir eventos en el contexto de seguridad del proveedor.</span><span class="sxs-lookup"><span data-stu-id="4b244-169">Only a consumer implemented as a DLL, an in-process consumer, can receive events in the security context of the provider.</span></span> <span data-ttu-id="4b244-170">Para obtener más información sobre la seguridad de los proveedores y consumidores en proceso, vea [hospedaje y seguridad de proveedores](provider-hosting-and-security.md).</span><span class="sxs-lookup"><span data-stu-id="4b244-170">For more information about security of in-process providers and consumers, see [Provider Hosting and Security](provider-hosting-and-security.md).</span></span>
-   <span data-ttu-id="4b244-171">El proveedor de eventos se está ejecutando en un proceso que permite la suplantación.</span><span class="sxs-lookup"><span data-stu-id="4b244-171">The event provider is running in a process that allows impersonation.</span></span>

<span data-ttu-id="4b244-172">La cuenta que ejecuta el proceso de consumidor debe tener acceso de **\_ escritura completo** en el repositorio WMI (también conocido como repositorio CIM).</span><span class="sxs-lookup"><span data-stu-id="4b244-172">The account running the consumer process must have **FULL\_WRITE** access to the WMI repository (also known as the CIM repository).</span></span> <span data-ttu-id="4b244-173">En la suscripción, las instancias de [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_ \_ EventConsumer**](--eventconsumer.md)y [**\_ \_ EventFilter**](--eventfilter.md) deben tener el mismo valor de identificador de seguridad (SID) individual en la propiedad **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="4b244-173">In the subscription, the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_\_EventConsumer**](--eventconsumer.md), and [**\_\_EventFilter**](--eventfilter.md) instances must have the same individual security identifier (SID) value in the **CreatorSID** property.</span></span> <span data-ttu-id="4b244-174">WMI almacena el SID en **CreatorSID** para cada instancia.</span><span class="sxs-lookup"><span data-stu-id="4b244-174">WMI stores the SID in the **CreatorSID** for each instance.</span></span>

## <a name="sids-and-permanent-subscriptions"></a><span data-ttu-id="4b244-175">SID y suscripciones permanentes</span><span class="sxs-lookup"><span data-stu-id="4b244-175">SIDs and Permanent Subscriptions</span></span>

<span data-ttu-id="4b244-176">Una suscripción permanente no funciona cuando el mismo usuario no crea el enlace, el consumidor y el filtro, lo que significa que [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_ \_ EventConsumer**](--eventconsumer.md)y [**\_ \_ EventFilter**](--eventfilter.md) deben tener el mismo valor de identificador de seguridad (SID) individual en la propiedad **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="4b244-176">A permanent subscription does not work when the binding, the consumer, and the filter are not created by the same user, which means that the [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md), [**\_\_EventConsumer**](--eventconsumer.md), and [**\_\_EventFilter**](--eventfilter.md) must have the same individual security identifier (SID) value in the **CreatorSID** property.</span></span> <span data-ttu-id="4b244-177">Instrumental de administración de Windows (WMI) almacena este valor.</span><span class="sxs-lookup"><span data-stu-id="4b244-177">Windows Management Instrumentation (WMI) stores this value.</span></span>

## <a name="creating-permanent-subscriptions-using-domain-accounts"></a><span data-ttu-id="4b244-178">Crear suscripciones permanentes mediante cuentas de dominio</span><span class="sxs-lookup"><span data-stu-id="4b244-178">Creating Permanent Subscriptions Using Domain Accounts</span></span>

<span data-ttu-id="4b244-179">Se deben tener en cuenta varios problemas al usar cuentas de dominio para crear suscripciones permanentes.</span><span class="sxs-lookup"><span data-stu-id="4b244-179">Several issues must be considered when using domain accounts to create permanent subscriptions.</span></span> <span data-ttu-id="4b244-180">Todas las suscripciones permanentes deben seguir funcionando cuando ningún usuario haya iniciado sesión, lo que significa que funcionan con la cuenta integrada LocalSystem.</span><span class="sxs-lookup"><span data-stu-id="4b244-180">Every permanent subscription should still work when no user is logged on, which means they function under the built-in LocalSystem account.</span></span>

<span data-ttu-id="4b244-181">Si un usuario del dominio es el creador de una suscripción permanente para consumidores sensibles a la seguridad ([**ActiveScriptEventConsumer**](activescripteventconsumer.md), [**CommandLineEventConsumer**](commandlineeventconsumer.md)), WMI comprueba si la propiedad **CreatorSID** de la clase [**\_ \_ EventFilter**](--eventfilter.md) , la clase [**\_ \_ FilterToConsumerBinding**](--filtertoconsumerbinding.md) y las instancias del consumidor pertenecen a un usuario que es miembro del grupo de administradores locales.</span><span class="sxs-lookup"><span data-stu-id="4b244-181">If a domain user is the creator of a permanent subscription for security sensitive consumers ([**ActiveScriptEventConsumer**](activescripteventconsumer.md), [**CommandLineEventConsumer**](commandlineeventconsumer.md)), then WMI verifies whether the **CreatorSID** property of the [**\_\_EventFilter**](--eventfilter.md) class, [**\_\_FilterToConsumerBinding**](--filtertoconsumerbinding.md) class, and the consumer instances belong to a user who is member of local Administrators group.</span></span>

<span data-ttu-id="4b244-182">En el ejemplo de código siguiente se muestra cómo se puede especificar la propiedad **CreatorSID** .</span><span class="sxs-lookup"><span data-stu-id="4b244-182">The following code example shows how you can specify the **CreatorSID** property.</span></span>

``` syntax
 instance of __EventFilter as $FILTER
    {
        // this is the Administrators SID in array of bytes format
        CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};    
        // Add filter code here ...
    }

    instance of ActiveScriptEventConsumer as $CONSUMER
    {
       CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};
       // Add consumer code here ...
    }

    instance of __FilterToConsumerBinding
    {
       CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0};
       Consumer = $CONSUMER;
       Filter = $FILTER;
       // Add binding code here ...
    }
```

<span data-ttu-id="4b244-183">En situaciones entre dominios, agregue usuarios autenticados al grupo de acceso de autorización de Windows.</span><span class="sxs-lookup"><span data-stu-id="4b244-183">For cross domain situations, add Authenticated Users to the "Windows Authorization Access Group".</span></span>

## <a name="related-topics"></a><span data-ttu-id="4b244-184">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="4b244-184">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4b244-185">Proteger eventos WMI</span><span class="sxs-lookup"><span data-stu-id="4b244-185">Securing WMI Events</span></span>](securing-wmi-events.md)
</dt> <dt>

[<span data-ttu-id="4b244-186">Recibir un evento de WMI</span><span class="sxs-lookup"><span data-stu-id="4b244-186">Receiving a WMI Event</span></span>](receiving-a-wmi-event.md)
</dt> </dl>

 

 
