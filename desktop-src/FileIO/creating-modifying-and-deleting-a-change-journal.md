---
description: Los administradores pueden crear, eliminar y volver a crear diarios de cambios.
ms.assetid: 26cbacc2-d26b-434b-91b5-31aedc96da13
title: Creación, modificación y eliminación de un diario de cambios
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50c8cf7296f93549e7d9ec05f5d614131cc342ce
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105668381"
---
# <a name="creating-modifying-and-deleting-a-change-journal"></a><span data-ttu-id="6f6d1-103">Creación, modificación y eliminación de un diario de cambios</span><span class="sxs-lookup"><span data-stu-id="6f6d1-103">Creating, Modifying, and Deleting a Change Journal</span></span>

<span data-ttu-id="6f6d1-104">Los administradores pueden crear, eliminar y volver a crear diarios de cambios a su vez.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-104">Administrators can create, delete, and re-create change journals at will.</span></span> <span data-ttu-id="6f6d1-105">Un administrador debe eliminar un diario cuando el valor de número de secuencia actualizada (USN) actual se aproxime al valor USN máximo posible, como indica el miembro **MaxUsn** de la estructura de [**\_ \_ datos del diario USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) .</span><span class="sxs-lookup"><span data-stu-id="6f6d1-105">An administrator should delete a journal when the current update sequence number (USN) value approaches the maximum possible USN value, as indicated by the **MaxUsn** member of the [**USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) structure.</span></span> <span data-ttu-id="6f6d1-106">Un administrador también puede eliminar y volver a crear un diario de cambios para recuperar espacio en disco.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-106">An administrator might also delete and re-create a change journal to reclaim disk space.</span></span> <span data-ttu-id="6f6d1-107">Para realizar esta y todas las demás operaciones del diario de cambios no programáticos, debe tener privilegios de administrador del sistema.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-107">To perform this and all other non-programmatic change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="6f6d1-108">Es decir, debe ser miembro del grupo administradores.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-108">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="6f6d1-109">Para crear o modificar un diario de cambios en un volumen especificado mediante programación, use el código de control de [**\_ \_ \_ diario FSCTL Create USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="6f6d1-109">To create or modify a change journal on a specified volume programmatically, use the [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) control code.</span></span>

<span data-ttu-id="6f6d1-110">Cuando se crea un diario de cambios nuevo o se modifica uno existente, el sistema de archivos NTFS establece la información de ese diario de cambios a partir de la información de la estructura de [**datos del diario de creación de \_ USN \_ \_**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) , que usa el [**diario de FSCTL para \_ crear \_ USN \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) como entrada.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-110">When you create a new change journal or modify an existing one, the NTFS file system sets information for that change journal from information in the [**CREATE\_USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) structure, which [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) takes as input.</span></span> <span data-ttu-id="6f6d1-111">**Crear \_ Los \_ \_ datos del diario USN** tienen los miembros **tamañomáximo** y **AllocationDelta**.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-111">**CREATE\_USN\_JOURNAL\_DATA** has the members **MaximumSize** and **AllocationDelta**.</span></span>

<span data-ttu-id="6f6d1-112">**Tamañomáximo** es el tamaño máximo de destino para el diario de cambios en bytes.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-112">**MaximumSize** is the target maximum size for the change journal in bytes.</span></span> <span data-ttu-id="6f6d1-113">El diario de cambios puede aumentar el tamaño de este valor, pero en los puntos de control del sistema de archivos NTFS, el sistema de archivos NTFS examina el diario y lo recorta cuando su tamaño supera el valor de **tamañomáximo** más el valor de **AllocationDelta**.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-113">The change journal can grow larger than this value, but at NTFS file system checkpoints the NTFS file system examines the journal and trims it when its size exceeds the value of **MaximumSize** plus the value of **AllocationDelta**.</span></span> <span data-ttu-id="6f6d1-114">(En los puntos de control del sistema de archivos NTFS, el sistema operativo escribe los registros en el archivo de registro del sistema de archivos NTFS que permiten al sistema de archivos NTFS determinar qué procesamiento es necesario para recuperarse de un error).</span><span class="sxs-lookup"><span data-stu-id="6f6d1-114">(At NTFS file system checkpoints, the operating system writes records to the NTFS file system log file that allow the NTFS file system to determine what processing is required to recover from a failure.)</span></span>

<span data-ttu-id="6f6d1-115">**AllocationDelta** es el número de bytes que se agregan al final y se quitan del principio del diario de cambios cada vez que se asigna o se cancela la asignación de memoria.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-115">**AllocationDelta** is the number of bytes added to the end and removed from the beginning of the change journal each time memory is allocated or deallocated.</span></span> <span data-ttu-id="6f6d1-116">En otras palabras, la asignación y desasignación tienen lugar en unidades de este tamaño.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-116">In other words, allocation and deallocation take place in units of this size.</span></span> <span data-ttu-id="6f6d1-117">Un número entero múltiplo de un tamaño de clúster es un valor razonable para este miembro.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-117">An integer multiple of a cluster size is a reasonable value for this member.</span></span>

<span data-ttu-id="6f6d1-118">Si un administrador modifica un diario de cambios existente para que tenga un valor de **MaximumSize** mayor, por ejemplo, si un volumen se está reindexando con demasiada frecuencia, el diario de cambios solo recibirá nuevas entradas hasta que supere el nuevo tamaño máximo.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-118">If an administrator modifies an existing change journal to have a larger **MaximumSize** value, for example if a volume is being re-indexed too often, the change journal simply receives new entries until it exceeds the new maximum size.</span></span>

<span data-ttu-id="6f6d1-119">Para eliminar un diario de cambios, use el código de control de [**\_ diario de eliminación de \_ USN \_ de FSCTL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="6f6d1-119">To delete a change journal, use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code.</span></span> <span data-ttu-id="6f6d1-120">Cuando se usa esta operación, se recorren todos los archivos del volumen y se restablece el USN de cada archivo a cero.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-120">When you use this operation, it walks through all of the files on the volume and resets the USN for each file to zero.</span></span> <span data-ttu-id="6f6d1-121">A continuación, la operación elimina el diario de cambios existente.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-121">The operation then deletes the existing change journal.</span></span> <span data-ttu-id="6f6d1-122">Esta operación persiste a través de los reinicios del sistema hasta que se complete.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-122">This operation persists across system restarts until it completes.</span></span> <span data-ttu-id="6f6d1-123">Si se intenta leer, crear o modificar el diario de cambios durante este proceso, se producirá un error de código **\_ de error \_ \_ de eliminación en \_ curso**.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-123">Any attempt to read, create, or modify the change journal during this process fails with the error code **ERROR\_JOURNAL\_DELETE\_IN\_PROGRESS**.</span></span>

<span data-ttu-id="6f6d1-124">También puede usar el código de control de [**\_ \_ \_ diario FSCTL eliminar USN**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) para determinar si está en curso una eliminación iniciada por otro proceso.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-124">You can also use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code to determine if a deletion started by some other process is in progress.</span></span> <span data-ttu-id="6f6d1-125">Por ejemplo, la aplicación, cuando se inicia, puede determinar si hay una eliminación en curso.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-125">For example, your application, when it is started, can determine if a deletion is in progress.</span></span> <span data-ttu-id="6f6d1-126">Dado que las eliminaciones del diario se conservan a través de reinicios del sistema, los servicios y las aplicaciones que se inician al reiniciar el sistema deben comprobar si hay una eliminación en curso.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-126">Because journal deletions persist across system restarts, services and applications started at system restart should check for an ongoing deletion.</span></span>

<span data-ttu-id="6f6d1-127">Los diarios de cambios no se crean necesariamente en el inicio.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-127">Change journals are not necessarily created at startup.</span></span> <span data-ttu-id="6f6d1-128">Para crear un diario de cambios, un administrador puede hacerlo explícitamente o iniciar otro servicio que requiera un diario de cambios.</span><span class="sxs-lookup"><span data-stu-id="6f6d1-128">To create a change journal, an administrator may do so explicitly or start another service that requires a change journal.</span></span>

 

 
