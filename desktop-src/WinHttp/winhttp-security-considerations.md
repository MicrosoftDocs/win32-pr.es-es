---
description: 'Las siguientes consideraciones de seguridad se aplican a las aplicaciones que usan WinHTTP: los certificados de servidor solo se comprueban una vez por sesión.'
ms.assetid: 287e85ed-a324-4785-872a-26e4ab37986d
title: Consideraciones de seguridad de WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc06725ba03631eb4d5e5c29f8cfa0aae69b5022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104497488"
---
# <a name="winhttp-security-considerations"></a><span data-ttu-id="1c933-103">Consideraciones de seguridad de WinHTTP</span><span class="sxs-lookup"><span data-stu-id="1c933-103">WinHTTP Security Considerations</span></span>

<span data-ttu-id="1c933-104">Las siguientes consideraciones de seguridad se aplican a las aplicaciones que usan WinHTTP:</span><span class="sxs-lookup"><span data-stu-id="1c933-104">The following security considerations apply to applications that use WinHTTP:</span></span>

-   <span data-ttu-id="1c933-105">**Los certificados de servidor solo se comprueban una vez por sesión.**</span><span class="sxs-lookup"><span data-stu-id="1c933-105">**Server certificates are only verified once per session.**</span></span> <span data-ttu-id="1c933-106">Una vez comprobado un certificado, sigue siendo válido mientras dure la sesión actual.</span><span class="sxs-lookup"><span data-stu-id="1c933-106">After a certificate has been verified, it remains valid for the duration of the current session.</span></span> <span data-ttu-id="1c933-107">Siempre y cuando la huella digital del certificado coincida, lo que indica que el certificado no ha cambiado, el certificado se seguirá validando.</span><span class="sxs-lookup"><span data-stu-id="1c933-107">As long as the certificate fingerprint matches, which indicates that the certificate has not changed, the certificate continues to be re-validated.</span></span> <span data-ttu-id="1c933-108">Como resultado, cualquier cambio en los criterios de validación, a través del Protocolo, la comprobación de revocación o las marcas de certificado-error-omitir, no surte efecto una vez comprobado el certificado.</span><span class="sxs-lookup"><span data-stu-id="1c933-108">As a result, any change in the validation criteria, through the protocol, revocation-check, or certificate-error-ignore flags, does not take effect once the certificate is verified.</span></span> <span data-ttu-id="1c933-109">Para forzar que este cambio surta efecto inmediatamente, se debe finalizar la sesión actual y se puede iniciar una nueva.</span><span class="sxs-lookup"><span data-stu-id="1c933-109">To force such a change to take effect immediately, the current session must be ended and a new one started.</span></span> <span data-ttu-id="1c933-110">Del mismo modo, solo se puede detectar la expiración de un certificado durante el transcurso de una sesión si la propia aplicación comprueba el servidor de certificados periódicamente para recuperar los datos de expiración.</span><span class="sxs-lookup"><span data-stu-id="1c933-110">Similarly, expiration of a certificate during the course of a session can only be detected if the application itself checks the certificate server periodically to retrieve expiration data.</span></span>
-   <span data-ttu-id="1c933-111">**El proxy automático implica la descarga y ejecución de scripts.**</span><span class="sxs-lookup"><span data-stu-id="1c933-111">**Auto-proxy involves downloading and executing scripts.**</span></span> <span data-ttu-id="1c933-112">La compatibilidad con la detección automática del proxy implica detectar a través de DHCP o DNS, descargar y ejecutar scripts de proxy como scripts de Java.</span><span class="sxs-lookup"><span data-stu-id="1c933-112">The automatic proxy discovery support involves detecting through DHCP or DNS, downloading, and executing proxy scripts such as Java scripts.</span></span> <span data-ttu-id="1c933-113">Para lograr un mayor grado de seguridad, una aplicación debe evitar pasar la marca de **\_ \_ \_ InProcess de ejecución de AutoProxy WinHTTP** , de modo que la detección de proxy automático se inicie fuera de proceso.</span><span class="sxs-lookup"><span data-stu-id="1c933-113">To achieve a higher degree of security, an application must avoid passing the **WINHTTP\_AUTOPROXY\_RUN\_INPROCESS** flag, so that the auto-proxy discovery is initiated out-of-process.</span></span> <span data-ttu-id="1c933-114">Incluso después, WinHTTP intenta ejecutar de forma predeterminada un script de proxy automático en proceso si el script no se ejecuta correctamente fuera de proceso.</span><span class="sxs-lookup"><span data-stu-id="1c933-114">Even then, WinHTTP tries by default to run an auto-proxy script in-process if the script fails to run properly out-of-process.</span></span> <span data-ttu-id="1c933-115">Si cree que este comportamiento de reserva supone un riesgo inaceptable, deshabilite el comportamiento de reserva con la marca de **\_ \_ \_ \_ solo outprocess de la ejecución de AutoProxy WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="1c933-115">If you believe that this fallback behavior poses an unacceptable risk, disable the fallback behavior with the **WINHTTP\_AUTOPROXY\_RUN\_OUTPROCESS\_ONLY** flag.</span></span>
-   <span data-ttu-id="1c933-116">**\_Las funciones de devolución de llamada de estado de WinHTTP \_ deben volver rápidamente.**</span><span class="sxs-lookup"><span data-stu-id="1c933-116">**WINHTTP\_STATUS\_CALLBACK functions must return promptly.**</span></span> <span data-ttu-id="1c933-117">Al escribir una de estas funciones de devolución de llamada, tenga cuidado de que no se bloquee.</span><span class="sxs-lookup"><span data-stu-id="1c933-117">When you write one of these callback functions, be careful that it does not block.</span></span> <span data-ttu-id="1c933-118">Por ejemplo, ni la devolución de llamada ni ninguna función a la que llama deberían mostrar un cuadro de diálogo de usuario o esperar un evento.</span><span class="sxs-lookup"><span data-stu-id="1c933-118">For example, neither the callback nor any function it calls should display a user dialog or wait for an event.</span></span> <span data-ttu-id="1c933-119">Si una función de [*\_ devolución de \_ llamada de estado de WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) está bloqueada, afecta a la programación interna de WinHTTP y hace que se deniegue el servicio a otras solicitudes dentro del mismo proceso.</span><span class="sxs-lookup"><span data-stu-id="1c933-119">If a [*WINHTTP\_STATUS\_CALLBACK*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) function does block, it affects WinHTTP's internal scheduling and causes other requests within the same process to be denied service.</span></span>
-   <span data-ttu-id="1c933-120">**\_Las funciones de devolución de llamada de estado de WinHTTP \_ deben ser reentrantes.**</span><span class="sxs-lookup"><span data-stu-id="1c933-120">**WINHTTP\_STATUS\_CALLBACK functions must be reentrant.**</span></span> <span data-ttu-id="1c933-121">Al escribir una devolución de llamada, evite las variables estáticas u otras construcciones que no sean seguras en la reentrada y evite llamar a otras funciones que no sean reentrantes.</span><span class="sxs-lookup"><span data-stu-id="1c933-121">When writing a callback, avoid static variables or other constructs that are unsafe under reentrance, and avoid calling other functions that are not reentrant.</span></span>
-   <span data-ttu-id="1c933-122">**Si la operación asincrónica es posible, pase valores NULL para los parámetros OUT.**</span><span class="sxs-lookup"><span data-stu-id="1c933-122">**If asynchronous operation is possible, pass NULLs for OUT parameters.**</span></span> <span data-ttu-id="1c933-123">Si ha habilitado la operación asincrónica mediante el registro de una función de devolución de llamada, pase siempre los valores **null** para dichos parámetros como *lpdwDataAvailable* para [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* para [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)o *lpdwBytesWritten* para [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata).</span><span class="sxs-lookup"><span data-stu-id="1c933-123">If you have enabled asynchronous operation by registering a callback function, always pass **NULL** values for such OUT parameters as *lpdwDataAvailable* for [**WinHttpQueryDataAvailable**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *lpdwBytesRead* for [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata), or *lpdwBytesWritten* for [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata).</span></span> <span data-ttu-id="1c933-124">En algunas circunstancias, el subproceso que realiza la llamada se termina antes de que se complete la operación y, si los parámetros OUT no son **null**, la función puede acabar escribiendo en la memoria que ya se ha liberado.</span><span class="sxs-lookup"><span data-stu-id="1c933-124">Under some circumstances, the calling thread is terminated before the operation completes, and if the OUT parameters are not **NULL**, the function can end up writing to memory that has already been freed.</span></span>
-   <span data-ttu-id="1c933-125">**La autenticación de Passport no es infalible.**</span><span class="sxs-lookup"><span data-stu-id="1c933-125">**Passport authentication is not foolproof.**</span></span> <span data-ttu-id="1c933-126">Cualquier esquema de autenticación basada en cookies es vulnerable a los ataques.</span><span class="sxs-lookup"><span data-stu-id="1c933-126">Any cookie-based authentication scheme is vulnerable to attack.</span></span> <span data-ttu-id="1c933-127">La versión 1,4 de Passport está basada en cookies y, por tanto, está sujeta a las vulnerabilidades asociadas a cualquier cookie o esquema de autenticación basada en formularios.</span><span class="sxs-lookup"><span data-stu-id="1c933-127">Passport version 1.4 is cookie based, and therefore subject to the vulnerabilities that are associated with any cookie or form-based authentication scheme.</span></span> <span data-ttu-id="1c933-128">La compatibilidad con Passport está deshabilitada de forma predeterminada en WinHTTP; se puede habilitar mediante [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="1c933-128">Passport support is disabled by default in WinHTTP; it can be enabled using [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="1c933-129">**La autenticación básica solo se debe usar a través de una conexión segura.**</span><span class="sxs-lookup"><span data-stu-id="1c933-129">**Basic authentication should only be used over a secure connection.**</span></span> <span data-ttu-id="1c933-130">La autenticación básica, que envía el nombre de usuario y la contraseña en texto no cifrado (consulte [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), debe usarse solo en conexiones SSL o TLS cifradas.</span><span class="sxs-lookup"><span data-stu-id="1c933-130">Basic authentication, which sends the user name and password in clear text (see [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), should be used only over encrypted SSL or TLS connections.</span></span>
-   <span data-ttu-id="1c933-131">**La configuración de la Directiva de inicio de sesión automático en "Low" puede suponer un riesgo.**</span><span class="sxs-lookup"><span data-stu-id="1c933-131">**Setting Auto-Logon Policy to "low" can pose a risk.**</span></span> <span data-ttu-id="1c933-132">Cuando la Directiva de inicio de sesión automático se establece en baja, se puede usar una credencial de inicio de sesión de usuario para autenticarse en cualquier sitio.</span><span class="sxs-lookup"><span data-stu-id="1c933-132">When the Auto-Logon Policy is set to low, a user's logon credential can be used to authenticate against any site.</span></span> <span data-ttu-id="1c933-133">Sin embargo, no es una buena práctica de seguridad autenticarse en sitios en los que no confíe.</span><span class="sxs-lookup"><span data-stu-id="1c933-133">However, it is not good security practice to authenticate against sites you do not trust.</span></span>
-   <span data-ttu-id="1c933-134">**No se usan conexiones SSL 2,0 a menos que se habiliten explícitamente.**</span><span class="sxs-lookup"><span data-stu-id="1c933-134">**SSL 2.0 connections are not used unless explicitly enabled.**</span></span> <span data-ttu-id="1c933-135">Los protocolos de seguridad TLS 1,0 y SSL 3,0 se consideran más seguros que SSL 2,0.</span><span class="sxs-lookup"><span data-stu-id="1c933-135">The TLS 1.0 and SSL 3.0 security protocols are considered more secure than SSL 2.0.</span></span> <span data-ttu-id="1c933-136">De forma predeterminada, WinHTTP solicita TLS 1,0 o SSL 3,0 al negociar una conexión SSL, no SSL 2,0.</span><span class="sxs-lookup"><span data-stu-id="1c933-136">By default, WinHTTP requests TLS 1.0 or SSL 3.0 when negotiating an SSL connection, not SSL 2.0.</span></span> <span data-ttu-id="1c933-137">La compatibilidad con SSL 2,0 en WinHTTP solo se puede habilitar llamando a [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="1c933-137">SSL 2.0 support in WinHTTP can only be enabled by calling [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="1c933-138">**La comprobación de la revocación de certificados se debe solicitar explícitamente.**</span><span class="sxs-lookup"><span data-stu-id="1c933-138">**Certificate-revocation checking must be explicitly requested.**</span></span> <span data-ttu-id="1c933-139">De forma predeterminada, al realizar la autenticación de certificados, WinHTTP no comprueba si se ha revocado el certificado del servidor.</span><span class="sxs-lookup"><span data-stu-id="1c933-139">By default, when performing certificate authentication, WinHTTP does not check whether the server's certificate has been revoked.</span></span> <span data-ttu-id="1c933-140">La comprobación de la revocación de certificados se puede habilitar mediante [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="1c933-140">Certificate-revocation checking can be enabled using [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span>
-   <span data-ttu-id="1c933-141">**Las aplicaciones deben asegurarse de que una sesión se asigna a una única identidad.**</span><span class="sxs-lookup"><span data-stu-id="1c933-141">**Applications must ensure that a session maps to a single identity.**</span></span> <span data-ttu-id="1c933-142">Una sesión de WinHTTP se debe asignar a una sola identidad; es decir, una sesión de WinHTTP se utiliza para administrar la actividad de Internet de un solo usuario autenticado o un grupo de usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="1c933-142">A WinHTTP session should map to one and only one identity; that is, a WinHTTP session is used to manage the Internet activity of a single authenticated user, or a group of anonymous users.</span></span> <span data-ttu-id="1c933-143">Sin embargo, dado que WinHTTP no aplica esta asignación automáticamente, la aplicación debe tomar medidas para asegurarse de que solo interviene una identidad.</span><span class="sxs-lookup"><span data-stu-id="1c933-143">However, because WinHTTP does not enforce this mapping automatically, your application must take steps to ensure that only a single identity is involved.</span></span>
-   <span data-ttu-id="1c933-144">**Se deben sincronizar las operaciones en un identificador de solicitud de WinHTTP.**</span><span class="sxs-lookup"><span data-stu-id="1c933-144">**Operations on a WinHTTP request handle should be synchronized.**</span></span> <span data-ttu-id="1c933-145">Por ejemplo, una aplicación debe evitar cerrar un identificador de solicitud en un subproceso mientras otro subproceso está enviando o recibiendo una solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c933-145">For example, an application should avoid closing a request handle on one thread while another thread is sending or receiving a request.</span></span> <span data-ttu-id="1c933-146">Para finalizar una solicitud asincrónica, cierre el identificador de solicitud durante una notificación de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="1c933-146">To terminate an asynchronous request, close the request handle during a callback notification.</span></span> <span data-ttu-id="1c933-147">Para finalizar una solicitud sincrónica, cierre el identificador cuando se devuelva la llamada de WinHTTP anterior.</span><span class="sxs-lookup"><span data-stu-id="1c933-147">To terminate a synchronous request, close the handle when the previous WinHTTP call returns.</span></span>
-   <span data-ttu-id="1c933-148">**Los archivos de seguimiento contienen información confidencial.**</span><span class="sxs-lookup"><span data-stu-id="1c933-148">**Trace files contain sensitive information.**</span></span> <span data-ttu-id="1c933-149">Los archivos de seguimiento están protegidos mediante listas de Access-Controls (ACL) para que solo se pueda tener acceso a ellos mediante el administrador local o la cuenta de usuario que lo creó. Evite poner en peligro los archivos de seguimiento por cualquier acceso no autorizado.</span><span class="sxs-lookup"><span data-stu-id="1c933-149">Trace files are protected using Access-Control Lists (ACLs) so that one can normally be accessed only by the local administrator or by the user account that created it.Avoid compromising trace files by any unauthorized access.</span></span>
-   <span data-ttu-id="1c933-150">**Evite pasar datos confidenciales a través** de [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span><span class="sxs-lookup"><span data-stu-id="1c933-150">**Avoid passing sensitive data through** [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).</span></span> <span data-ttu-id="1c933-151">No suministre un nombre de usuario, una contraseña o cualquier otra credencial a **WinHttpSetOption** porque no tiene ningún control sobre el esquema de autenticación que se utiliza, y los datos confidenciales se pueden enviar de forma inesperada en texto no cifrado.</span><span class="sxs-lookup"><span data-stu-id="1c933-151">Do not supply a user name, password or any other credentials to **WinHttpSetOption** because you have no control over the authentication scheme that is used, and the sensitive data could unexpectedly be sent in clear text.</span></span> <span data-ttu-id="1c933-152">Use [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) y **WinHttpSetCredentials** en lugar de **WinHttpSetOption** para establecer las credenciales.</span><span class="sxs-lookup"><span data-stu-id="1c933-152">Use [**WinHttpQueryAuthSchemes**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) and **WinHttpSetCredentials** instead of **WinHttpSetOption** for setting credentials.</span></span>
-   <span data-ttu-id="1c933-153">**La redirección automática puede suponer un riesgo para la seguridad.**</span><span class="sxs-lookup"><span data-stu-id="1c933-153">**Automatic redirection can pose a security risk.**</span></span> <span data-ttu-id="1c933-154">De forma predeterminada, el redireccionamiento (un mensaje 302) se sigue automáticamente incluso para una publicación.</span><span class="sxs-lookup"><span data-stu-id="1c933-154">By default, redirection (a 302 message) is followed automatically even for a POST.</span></span> <span data-ttu-id="1c933-155">Para evitar la posibilidad de redireccionamientos falsos, las aplicaciones deben deshabilitar la redirección automática o supervisar el redireccionamiento en las devoluciones de llamada al publicar información confidencial.</span><span class="sxs-lookup"><span data-stu-id="1c933-155">To avoid the possibility of spurious redirects, applications should disable auto-redirect or monitor re-direction in callbacks when posting sensitive information.</span></span>
-   <span data-ttu-id="1c933-156">**Los encabezados definidos por el usuario se transfieren entre redirecciones sin cambios.**</span><span class="sxs-lookup"><span data-stu-id="1c933-156">**User-defined headers are transferred across redirects unchanged.**</span></span> <span data-ttu-id="1c933-157">Los encabezados definidos por el usuario, como las cookies agregadas con **WinHTTPAddRequestHeaders**, se transfieren entre redirecciones sin modificaciones, mientras que los encabezados generados por WinHTTP se actualizan automáticamente.</span><span class="sxs-lookup"><span data-stu-id="1c933-157">User-defined headers, such as cookies added with **WinHTTPAddRequestHeaders**, are transferred across redirects without modification, while headers generated by WinHTTP are automatically updated.</span></span> <span data-ttu-id="1c933-158">Si la transferencia de un encabezado definido por el usuario entre redirecciones supone un riesgo de seguridad, use la devolución de llamada de [*\_ devolución de \_ llamada de estado de WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) con la FINALización de **\_ \_ \_ redireccionamiento del estado de devolución de llamada de WinHTTP** para modificar el encabezado en cuestión siempre que se produzca una redirección.</span><span class="sxs-lookup"><span data-stu-id="1c933-158">If transferring a user-defined header across redirects poses a security risk, use the [*WINHTTP\_STATUS\_CALLBACK*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) callback with the **WINHTTP\_CALLBACK\_STATUS\_REDIRECT** completion to modify the header in question whenever a redirect occurs.</span></span>
-   <span data-ttu-id="1c933-159">**WinHTTP no es reentrante en modo sincrónico.**</span><span class="sxs-lookup"><span data-stu-id="1c933-159">**WinHTTP is not reentrant in synchronous mode.**</span></span> <span data-ttu-id="1c933-160">Dado que WinHTTP no es reentrante en modo sincrónico, no programe llamadas a procedimientos asincrónicos (APC) que puedan llamar a WinHTTP en un subproceso de aplicación que se ejecute dentro de una función WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="1c933-160">Because WinHTTP is not reentrant in synchronous mode, do not schedule asynchronous procedure calls (APC) that can call into WinHTTP on an application thread that executes inside a WinHTTP function.</span></span> <span data-ttu-id="1c933-161">En el modo sincrónico, WinHTTP realiza una "espera de alerta" y, si el subproceso en espera es anterior a la ejecución de una APC y después vuelve a entrar en WinHTTP de nuevo, el estado interno de WinHTTP puede resultar dañado.</span><span class="sxs-lookup"><span data-stu-id="1c933-161">While in synchronous mode, WinHTTP performs an "alertable wait," and if the waiting thread is pre-empted to execute an APC and then later re-enters WinHTTP again, WinHTTP's internal state can be corrupted.</span></span>

 

 
