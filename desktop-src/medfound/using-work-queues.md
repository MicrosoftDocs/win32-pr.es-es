---
description: En este tema se describe cómo usar las colas de trabajos en Microsoft Media Foundation.
ms.assetid: 6be05df7-e8ff-4110-8f73-a62eb31fd414
title: Uso de colas de trabajo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2d7bb41b830742ca871d44cadac9bd26a9967aa1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104275809"
---
# <a name="using-work-queues"></a><span data-ttu-id="b8baa-103">Uso de colas de trabajo</span><span class="sxs-lookup"><span data-stu-id="b8baa-103">Using Work Queues</span></span>

<span data-ttu-id="b8baa-104">En este tema se describe cómo usar las colas de trabajos en Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="b8baa-104">This topic describes how to use work queues in Microsoft Media Foundation.</span></span>

-   [<span data-ttu-id="b8baa-105">Uso de colas de trabajo</span><span class="sxs-lookup"><span data-stu-id="b8baa-105">Using Work Queues</span></span>](#using-work-queues)
-   [<span data-ttu-id="b8baa-106">Cerrando colas de trabajo</span><span class="sxs-lookup"><span data-stu-id="b8baa-106">Shutting Down Work Queues</span></span>](#shutting-down-work-queues)
-   [<span data-ttu-id="b8baa-107">Usar elementos de trabajo programados</span><span class="sxs-lookup"><span data-stu-id="b8baa-107">Using Scheduled Work Items</span></span>](#using-scheduled-work-items)
-   [<span data-ttu-id="b8baa-108">Usar devoluciones de llamada periódicas</span><span class="sxs-lookup"><span data-stu-id="b8baa-108">Using Periodic Callbacks</span></span>](#using-periodic-callbacks)
-   [<span data-ttu-id="b8baa-109">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="b8baa-109">Related topics</span></span>](#related-topics)

## <a name="using-work-queues"></a><span data-ttu-id="b8baa-110">Uso de colas de trabajo</span><span class="sxs-lookup"><span data-stu-id="b8baa-110">Using Work Queues</span></span>

<span data-ttu-id="b8baa-111">Una cola de trabajo es una manera eficaz de realizar operaciones asincrónicas en otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="b8baa-111">A work queue is an efficient way to perform asynchronous operations on another thread.</span></span> <span data-ttu-id="b8baa-112">Conceptualmente, los elementos de trabajo se colocan en la cola y la cola tiene un subproceso que extrae cada elemento de la cola y lo envía.</span><span class="sxs-lookup"><span data-stu-id="b8baa-112">Conceptually, you put work items in the queue, and the queue has a thread that pulls each item from the queue and dispatches it.</span></span> <span data-ttu-id="b8baa-113">Los elementos de trabajo se implementan como devoluciones de llamada mediante la interfaz [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="b8baa-113">Work items are implemented as callbacks by using the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span>

<span data-ttu-id="b8baa-114">Media Foundation crea varias colas de trabajo estándar, denominadas *colas de trabajo de plataforma*.</span><span class="sxs-lookup"><span data-stu-id="b8baa-114">Media Foundation creates several standard work queues, called *platform work queues*.</span></span> <span data-ttu-id="b8baa-115">Las aplicaciones también pueden crear sus propias colas de trabajo, denominadas *colas de trabajo privadas*.</span><span class="sxs-lookup"><span data-stu-id="b8baa-115">Applications can also create their own work queues, called *private work queues*.</span></span> <span data-ttu-id="b8baa-116">Para obtener una lista de las colas de trabajo de la plataforma, vea [identificadores de cola de trabajo](work-queue-identifiers.md).</span><span class="sxs-lookup"><span data-stu-id="b8baa-116">For a list of the platform work queues, see [Work Queue Identifiers](work-queue-identifiers.md).</span></span> <span data-ttu-id="b8baa-117">Para crear una cola de trabajo privada, llame a [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue).</span><span class="sxs-lookup"><span data-stu-id="b8baa-117">To create a private work queue, call [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue).</span></span> <span data-ttu-id="b8baa-118">Esta función devuelve un identificador para la nueva cola de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-118">This function returns an identifier for the new work queue.</span></span> <span data-ttu-id="b8baa-119">Para colocar un elemento en la cola, llame a [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) o [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span><span class="sxs-lookup"><span data-stu-id="b8baa-119">To put an item in the queue, call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) or [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span></span> <span data-ttu-id="b8baa-120">En ambos casos, debe especificar una interfaz de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="b8baa-120">In both cases, you must specify a callback interface.</span></span>

-   <span data-ttu-id="b8baa-121">[**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) toma un puntero a la interfaz [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) , además de un objeto de estado opcional que implementa **IUnknown**.</span><span class="sxs-lookup"><span data-stu-id="b8baa-121">[**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) takes a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface, plus an optional state object that implements **IUnknown**.</span></span> <span data-ttu-id="b8baa-122">Estos son los mismos parámetros que se usan en métodos asincrónicos, como se describe en el tema [métodos de devolución de llamada asincrónica](asynchronous-callback-methods.md).</span><span class="sxs-lookup"><span data-stu-id="b8baa-122">These are the same parameters used in asynchronous methods, as described in the topic [Asynchronous Callback Methods](asynchronous-callback-methods.md).</span></span> <span data-ttu-id="b8baa-123">Internamente, esta función crea un objeto de resultado asincrónico, que se pasa al método de [**invocación**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) de la devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="b8baa-123">Internally, this function creates an asynchronous result object, which is passed to the callback's [**Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) method.</span></span>
-   <span data-ttu-id="b8baa-124">[**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex) toma un puntero a la interfaz [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) .</span><span class="sxs-lookup"><span data-stu-id="b8baa-124">[**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex) takes a pointer to the [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) interface.</span></span> <span data-ttu-id="b8baa-125">Esta interfaz representa un objeto de resultado asincrónico.</span><span class="sxs-lookup"><span data-stu-id="b8baa-125">This interface represents an asynchronous result object.</span></span> <span data-ttu-id="b8baa-126">Cree este objeto llamando a [**MFCreateAsyncResult**](/windows/desktop/api/mfapi/nf-mfapi-mfcreateasyncresult) y especificando la interfaz de devolución de llamada y, opcionalmente, un objeto de estado.</span><span class="sxs-lookup"><span data-stu-id="b8baa-126">Create this object by calling [**MFCreateAsyncResult**](/windows/desktop/api/mfapi/nf-mfapi-mfcreateasyncresult) and specifying your callback interface and, optionally, a state object.</span></span>

<span data-ttu-id="b8baa-127">En ambos casos, el subproceso de la cola de trabajo llama al método [**IMFAsyncCallback:: Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) .</span><span class="sxs-lookup"><span data-stu-id="b8baa-127">In both cases, the work queue thread calls your [**IMFAsyncCallback::Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) method.</span></span> <span data-ttu-id="b8baa-128">Use el método **Invoke** para realizar el elemento de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-128">Use the **Invoke** method to perform the work item.</span></span>

<span data-ttu-id="b8baa-129">Si más de un subproceso o componente comparte la misma cola de trabajo, puede llamar a [**MFLockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflockworkqueue) para bloquear la cola de trabajo, lo que evita que la plataforma la libere.</span><span class="sxs-lookup"><span data-stu-id="b8baa-129">If more than one thread or component shares the same work queue, you can call [**MFLockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflockworkqueue) to lock the work queue, which prevents the platform from releasing it.</span></span> <span data-ttu-id="b8baa-130">Para cada llamada a [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) o **MFLockWorkQueue**, debe llamar a [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue) una vez para liberar la cola de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-130">For each call to [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) or **MFLockWorkQueue**, you must call [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue) once to release the work queue.</span></span> <span data-ttu-id="b8baa-131">Por ejemplo, si crea una nueva cola de trabajo y, a continuación, la bloquea una vez, debe llamar a **MFUnlockWorkQueue** dos veces, una vez para la llamada a **MFAllocateWorkQueue** y otra para la llamada a **MFLockWorkQueue**.</span><span class="sxs-lookup"><span data-stu-id="b8baa-131">For example, if you create a new work queue and then lock it once, you must call **MFUnlockWorkQueue** twice, once for the call to **MFAllocateWorkQueue** and once for the call to **MFLockWorkQueue**.</span></span>

<span data-ttu-id="b8baa-132">El código siguiente muestra cómo crear una nueva cola de trabajo, colocar un elemento de trabajo en la cola y liberar la cola de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-132">The following code shows how to create a new work queue, put a work item in the queue, and release the work queue.</span></span>

<span data-ttu-id="b8baa-133">Consulte [mejoras en la cola de trabajo y el subproceso](media-foundation-work-queue-and-threading-improvements.md) para obtener información adicional sobre las colas de trabajos en Windows 8.</span><span class="sxs-lookup"><span data-stu-id="b8baa-133">See [Work Queue and Threading Improvements](media-foundation-work-queue-and-threading-improvements.md) for additional information on work queues in Windows 8.</span></span>


```C++
DWORD idWorkQueue = 0;
HRESULT hr = S_OK;

// Create a new work queue.
hr = MFAllocateWorkQueue(&idWorkQueue);

// Put an item on the queue.
if (SUCCEEDED(hr))
{
    hr = MFPutWorkItem(idWorkQueue, pCallback, NULL);
}

// Wait for the callback to be invoked.
if (SUCCEEDED(hr))
{
    WaitForSingleObject(hEvent, INFINITE);
}

// Release the work queue.
if (SUCCEEDED(hr))
{
    hr = MFUnlockWorkQueue(idWorkQueue);
}
```



<span data-ttu-id="b8baa-134">En este ejemplo se da por supuesto que *pCallback* es un puntero a la interfaz [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b8baa-134">This example assumes that *pCallback* is a pointer to the application's [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="b8baa-135">También se supone que la devolución de llamada establece el identificador de evento *hEvent* .</span><span class="sxs-lookup"><span data-stu-id="b8baa-135">It also assumes that the callback sets the *hEvent* event handle.</span></span> <span data-ttu-id="b8baa-136">El código espera a que se establezca este evento antes de llamar a [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue).</span><span class="sxs-lookup"><span data-stu-id="b8baa-136">The code waits for this event to be set before calling [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue).</span></span>

<span data-ttu-id="b8baa-137">Los subprocesos de la cola de trabajo siempre se crean en el proceso del llamador.</span><span class="sxs-lookup"><span data-stu-id="b8baa-137">Work queue threads are always created in the caller's process.</span></span> <span data-ttu-id="b8baa-138">En cada cola de trabajo, las devoluciones de llamada se serializan.</span><span class="sxs-lookup"><span data-stu-id="b8baa-138">Within each work queue, the callbacks are serialized.</span></span> <span data-ttu-id="b8baa-139">Si llama a [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) dos veces con la misma cola de trabajo, no se invoca la segunda devolución de llamada hasta que se devuelve la primera devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="b8baa-139">If you call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) twice with the same work queue, the second callback is not invoked until the first callback has returned.</span></span>

## <a name="shutting-down-work-queues"></a><span data-ttu-id="b8baa-140">Cerrando colas de trabajo</span><span class="sxs-lookup"><span data-stu-id="b8baa-140">Shutting Down Work Queues</span></span>

<span data-ttu-id="b8baa-141">Antes de llamar a [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), libere los recursos que usan los subprocesos de la cola de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-141">Before calling [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), release any resources that are being used by work queue threads.</span></span> <span data-ttu-id="b8baa-142">Para sincronizar este proceso, puede bloquear la plataforma Media Foundation, lo que evita que la función **MFShutdown** cierre todos los subprocesos de la cola de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-142">To synchronize this process, you can lock the Media Foundation platform, which prevents the **MFShutdown** function from closing any work queue threads.</span></span> <span data-ttu-id="b8baa-143">Si se llama a **MFShutdown** mientras la plataforma está bloqueada, **MFShutdown** espera unos cientos de milisegundos para que la plataforma se desbloquee.</span><span class="sxs-lookup"><span data-stu-id="b8baa-143">If **MFShutdown** is called while the platform is locked, **MFShutdown** waits a few hundred milliseconds for the platform to be unlocked.</span></span> <span data-ttu-id="b8baa-144">Si no se desbloquea dentro de ese tiempo, **MFShutdown** cierra los subprocesos de la cola de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-144">If it is not unlocked within that time, **MFShutdown** closes the work queue threads.</span></span>

<span data-ttu-id="b8baa-145">La implementación predeterminada de [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) bloquea automáticamente la plataforma Media Foundation cuando se crea el objeto de resultado.</span><span class="sxs-lookup"><span data-stu-id="b8baa-145">The default implementation of [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) automatically locks the Media Foundation platform when the result object is created.</span></span> <span data-ttu-id="b8baa-146">Al liberar la interfaz, se desbloquea la plataforma.</span><span class="sxs-lookup"><span data-stu-id="b8baa-146">Releasing the interface unlocks the platform.</span></span> <span data-ttu-id="b8baa-147">Por lo tanto, casi nunca necesitará bloquear la plataforma directamente.</span><span class="sxs-lookup"><span data-stu-id="b8baa-147">Therefore, you will almost never need to lock the platform directly.</span></span> <span data-ttu-id="b8baa-148">Pero si escribe su propia implementación personalizada de **IMFAsyncResult**, debe bloquear y desbloquear manualmente la plataforma.</span><span class="sxs-lookup"><span data-stu-id="b8baa-148">But if you write your own custom implementation of **IMFAsyncResult**, then you should manually lock and unlock the platform.</span></span> <span data-ttu-id="b8baa-149">Para bloquear la plataforma, llame a [**MFLockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mflockplatform).</span><span class="sxs-lookup"><span data-stu-id="b8baa-149">To lock the platform, call [**MFLockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mflockplatform).</span></span> <span data-ttu-id="b8baa-150">Para desbloquear la plataforma, llame a [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform).</span><span class="sxs-lookup"><span data-stu-id="b8baa-150">To unlock the platform, call [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform).</span></span> <span data-ttu-id="b8baa-151">Para obtener un ejemplo, vea [objetos de resultado asincrónicos personalizados](custom-asynchronous-result-objects.md).</span><span class="sxs-lookup"><span data-stu-id="b8baa-151">For an example, see [Custom Asynchronous Result Objects](custom-asynchronous-result-objects.md).</span></span>

<span data-ttu-id="b8baa-152">Después de llamar a [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), debe asegurarse de que la plataforma esté desbloqueada en el período de tiempo de espera de 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="b8baa-152">After you call [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), you need to ensure that the platform is unlocked within the 5-second time-out period.</span></span> <span data-ttu-id="b8baa-153">Para ello, libera todos los punteros de [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) y llama a [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform) si la plataforma se bloqueó manualmente.</span><span class="sxs-lookup"><span data-stu-id="b8baa-153">Do this by releasing all [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) pointers, and by calling [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform) if you locked the platform manually.</span></span> <span data-ttu-id="b8baa-154">Asegúrese de liberar todos los recursos utilizados por los subprocesos de la cola de trabajo o la aplicación podría perder memoria.</span><span class="sxs-lookup"><span data-stu-id="b8baa-154">Make sure to release any resources that are being used by work queue threads, or your application might leak memory.</span></span>

<span data-ttu-id="b8baa-155">Normalmente, si la aplicación se cierra y libera todos los objetos de Media Foundation antes de llamar a [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), no tiene que preocuparse por el bloqueo.</span><span class="sxs-lookup"><span data-stu-id="b8baa-155">Typically, if your application shuts down and releases every Media Foundation object before calling [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), you do not have to worry about locking.</span></span> <span data-ttu-id="b8baa-156">El mecanismo de bloqueo simplemente permite que los subprocesos de la cola de trabajo salgan correctamente después de llamar a **MFShutdown**.</span><span class="sxs-lookup"><span data-stu-id="b8baa-156">The locking mechanism simply allows work queue threads to exit gracefully after you call **MFShutdown**.</span></span>

## <a name="using-scheduled-work-items"></a><span data-ttu-id="b8baa-157">Usar elementos de trabajo programados</span><span class="sxs-lookup"><span data-stu-id="b8baa-157">Using Scheduled Work Items</span></span>

<span data-ttu-id="b8baa-158">Puede programar una devolución de llamada para que se produzca después de un período de tiempo establecido mediante una llamada a [**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) o [**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex).</span><span class="sxs-lookup"><span data-stu-id="b8baa-158">You can schedule a callback to occur after a set period of time by calling [**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) or [**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex).</span></span>

-   <span data-ttu-id="b8baa-159">[**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) toma un puntero a la devolución de llamada, un objeto de estado opcional y un intervalo de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="b8baa-159">[**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) takes a pointer to your callback, an optional state object, and a time-out interval.</span></span>
-   <span data-ttu-id="b8baa-160">[**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex) toma un puntero a un objeto de resultado asincrónico y un valor de tiempo de espera.</span><span class="sxs-lookup"><span data-stu-id="b8baa-160">[**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex) takes a pointer to an asynchronous result object and a time-out value.</span></span>

<span data-ttu-id="b8baa-161">Especifique el tiempo de espera como un valor negativo en milisegundos.</span><span class="sxs-lookup"><span data-stu-id="b8baa-161">Specify the time-out as a negative value in milliseconds.</span></span> <span data-ttu-id="b8baa-162">Por ejemplo, para programar una devolución de llamada que se va a invocar en 5 segundos, use el valor − 5000.</span><span class="sxs-lookup"><span data-stu-id="b8baa-162">For example, to schedule a callback to be invoked in 5 seconds, use the value −5000.</span></span> <span data-ttu-id="b8baa-163">Ambas funciones devuelven un valor de **\_ clave MFWORKITEM** , que puede usar para cancelar la devolución de llamada pasándola a la función [**MFCancelWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfcancelworkitem) .</span><span class="sxs-lookup"><span data-stu-id="b8baa-163">Both functions return an **MFWORKITEM\_KEY** value, which you can use to cancel the callback by passing it to the [**MFCancelWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfcancelworkitem) function.</span></span>

<span data-ttu-id="b8baa-164">Los elementos de trabajo programados siempre utilizan la cola de trabajo de la \_ \_ plataforma del temporizador de cola de devolución de llamada MFASYNC \_ .</span><span class="sxs-lookup"><span data-stu-id="b8baa-164">Scheduled work items always use the MFASYNC\_CALLBACK\_QUEUE\_TIMER platform work queue.</span></span>

## <a name="using-periodic-callbacks"></a><span data-ttu-id="b8baa-165">Usar devoluciones de llamada periódicas</span><span class="sxs-lookup"><span data-stu-id="b8baa-165">Using Periodic Callbacks</span></span>

<span data-ttu-id="b8baa-166">La función [**MFAddPeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfaddperiodiccallback) programa una devolución de llamada que se invocará periódicamente hasta que la cancele.</span><span class="sxs-lookup"><span data-stu-id="b8baa-166">The [**MFAddPeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfaddperiodiccallback) function schedules a callback to be invoked periodically until you cancel it.</span></span> <span data-ttu-id="b8baa-167">El intervalo de devolución de llamada es fijo. las aplicaciones no pueden cambiarla.</span><span class="sxs-lookup"><span data-stu-id="b8baa-167">The callback interval is fixed; applications cannot change it.</span></span> <span data-ttu-id="b8baa-168">Para averiguar el intervalo exacto, llame a [**MFGetTimerPeriodicity**](/windows/desktop/api/mfapi/nf-mfapi-mfgettimerperiodicity).</span><span class="sxs-lookup"><span data-stu-id="b8baa-168">To find out the exact interval, call [**MFGetTimerPeriodicity**](/windows/desktop/api/mfapi/nf-mfapi-mfgettimerperiodicity).</span></span> <span data-ttu-id="b8baa-169">El intervalo está en el orden de 10 milisegundos, por lo que esta función está pensada para situaciones en las que se necesita un "paso" frecuente, como la implementación de un reloj de presentación.</span><span class="sxs-lookup"><span data-stu-id="b8baa-169">The interval is on the order of 10 milliseconds, so this function is meant for situations where you need a frequent "tick," such as implementing a presentation clock.</span></span> <span data-ttu-id="b8baa-170">Si desea programar una operación para que se produzca con menos frecuencia, use un elemento de trabajo programado, como se describió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b8baa-170">If you want to schedule an operation to occur less frequently, use a scheduled work item, as described previously.</span></span>

<span data-ttu-id="b8baa-171">A diferencia de las otras devoluciones de llamada descritas en este tema, la devolución de llamada periódica no utiliza la interfaz [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="b8baa-171">Unlike the other callbacks described in this topic, the periodic callback does not use the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="b8baa-172">En su lugar, utiliza un puntero de función.</span><span class="sxs-lookup"><span data-stu-id="b8baa-172">Instead, it uses a function pointer.</span></span> <span data-ttu-id="b8baa-173">Para obtener más información, vea [**devolución de llamada MFPERIODICCALLBACK**](/windows/win32/api/mfapi/nc-mfapi-mfperiodiccallback).</span><span class="sxs-lookup"><span data-stu-id="b8baa-173">For more information, see [**MFPERIODICCALLBACK Callback**](/windows/win32/api/mfapi/nc-mfapi-mfperiodiccallback).</span></span>

<span data-ttu-id="b8baa-174">Para cancelar la devolución de llamada periódica, llame a [**MFRemovePeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfremoveperiodiccallback).</span><span class="sxs-lookup"><span data-stu-id="b8baa-174">To cancel the periodic callback, call [**MFRemovePeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfremoveperiodiccallback).</span></span>

<span data-ttu-id="b8baa-175">Las devoluciones de llamada periódicas usan la \_ \_ cola de trabajo de \_ plataforma del temporizador de cola de devolución de llamada MFASYNC</span><span class="sxs-lookup"><span data-stu-id="b8baa-175">Periodic callbacks use the MFASYNC\_CALLBACK\_QUEUE\_TIMER platform work queue.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b8baa-176">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="b8baa-176">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b8baa-177">Colas de trabajo</span><span class="sxs-lookup"><span data-stu-id="b8baa-177">Work Queues</span></span>](work-queues.md)
</dt> <dt>

[<span data-ttu-id="b8baa-178">**MFASYNCRESULT**</span><span class="sxs-lookup"><span data-stu-id="b8baa-178">**MFASYNCRESULT**</span></span>](/windows/win32/api/mfapi/ns-mfapi-mfasyncresult)
</dt> <dt>

[<span data-ttu-id="b8baa-179">Mejoras en la cola de trabajo y subprocesos</span><span class="sxs-lookup"><span data-stu-id="b8baa-179">Work Queue and Threading Improvements</span></span>](media-foundation-work-queue-and-threading-improvements.md)
</dt> </dl>

 

 
