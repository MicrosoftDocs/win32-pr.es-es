---
title: E/s de múltiples rutas admite ahora bloques de solicitud de almacenamiento extendido
description: E/s de múltiples rutas admite ahora bloques de solicitud de almacenamiento extendido
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/10/2020
ms.locfileid: "104359481"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a><span data-ttu-id="128d9-103">E/s de múltiples rutas admite ahora bloques de solicitud de almacenamiento extendido</span><span class="sxs-lookup"><span data-stu-id="128d9-103">Multipath I/O now supports extended storage request blocks</span></span>

## <a name="platforms"></a><span data-ttu-id="128d9-104">Plataformas</span><span class="sxs-lookup"><span data-stu-id="128d9-104">Platforms</span></span>

<span data-ttu-id="128d9-105">**Servidores** : Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="128d9-105">**Servers** – Windows Server 2012</span></span> 

## <a name="description"></a><span data-ttu-id="128d9-106">Descripción</span><span class="sxs-lookup"><span data-stu-id="128d9-106">Description</span></span>

<span data-ttu-id="128d9-107">En Windows Server 2012, una nueva estructura, el bloque de solicitud de almacenamiento \_ \_ (SRB extendido) reemplaza \_ el \_ bloque de solicitud SCSI (SRB) en la pila de almacenamiento principal.</span><span class="sxs-lookup"><span data-stu-id="128d9-107">In Windows Server 2012, a new structure, the STORAGE\_REQUEST\_BLOCK (extended SRB) replaces the SCSI\_REQUEST\_BLOCK (legacy SRB) in the core storage stack.</span></span> <span data-ttu-id="128d9-108">Extended SRBs Replica la funcionalidad de la SRBs heredada, pero también es extensible y escalable.</span><span class="sxs-lookup"><span data-stu-id="128d9-108">Extended SRBs replicate the functionality of the legacy SRBs, but are also extensible and scalable.</span></span>

<span data-ttu-id="128d9-109">E/s de múltiples rutas (MPIO) admite SRBs extendidos y permite que los módulos específicos del dispositivo (DSM) especifiquen también la compatibilidad con SRB extendida.</span><span class="sxs-lookup"><span data-stu-id="128d9-109">Multipath I/O (MPIO) supports extended SRBs and allows Device Specific Modules (DSMs) to specify extended SRB support as well.</span></span> <span data-ttu-id="128d9-110">Sin embargo, para que la pila de almacenamiento de un dispositivo de múltiples rutas use SRBss extendidos, **todos los componentes de la pila deben admitir SRBs extendidos, incluido DSM**.</span><span class="sxs-lookup"><span data-stu-id="128d9-110">However, in order for a multipath device’s storage stack to use extended SRBs, **all components in the stack must support extended SRBs, including the DSM**.</span></span> <span data-ttu-id="128d9-111">Tenga en cuenta que el DSM de Microsoft en Box, MSDSM, admite SRBs extendido.</span><span class="sxs-lookup"><span data-stu-id="128d9-111">Note that the Microsoft in-box DSM, MSDSM, does support extended SRBs.</span></span>

<span data-ttu-id="128d9-112">La \_ estructura de paso \_ a través \_ de SCSI no forma parte de la estructura de paso a través de MPIO extendido, ya que el paso de SCSI extendido puede ser de un tamaño variable, según el depurador de la línea de comandos (CDB).</span><span class="sxs-lookup"><span data-stu-id="128d9-112">The SCSI\_PASS\_THROUGH\_EX structure is not part of the extended MPIO pass through structure since the extended SCSI pass through can be of a variable size, depending on the command line debugger (CDB).</span></span> <span data-ttu-id="128d9-113">En su lugar, el pase de MPIO extendido tiene un campo que describe el desplazamiento desde el principio de la estructura de paso a través de MPIO extendido hasta la \_ estructura de paso \_ a través de SCSI \_ .</span><span class="sxs-lookup"><span data-stu-id="128d9-113">Instead, the extended MPIO pass through has a field that describes the offset from the beginning of the extended MPIO pass through structure to the SCSI\_PASS\_THROUGH\_EX structure.</span></span> <span data-ttu-id="128d9-114">El llamador debe asegurarse de que asignan un búfer con el tamaño adecuado y establecen el desplazamiento correcto del SCSI.</span><span class="sxs-lookup"><span data-stu-id="128d9-114">The caller must make sure they allocate a buffer of the appropriate size and set the SCSI pass through offset correctly.</span></span> <span data-ttu-id="128d9-115">Siempre que el autor de la llamada siga las reglas de paso a través de SCSI extendido, no debería haber ningún trabajo adicional para que use el paso de MPIO extendido.</span><span class="sxs-lookup"><span data-stu-id="128d9-115">As long as the caller follows the rules for extended SCSI pass-throughs, then there should not be any extra work for them to use the extended MPIO pass through.</span></span>

> [!Note]  
> <span data-ttu-id="128d9-116">Si el DSM no es compatible con SRBs extendidos, MPIO producirá un error en las solicitudes de paso a través de MPIO extendidas que tienen la marca de ioctl MPIO establecida en la \_ \_ \_ \_ marca DSM.</span><span class="sxs-lookup"><span data-stu-id="128d9-116">If the DSM does not support extended SRBs, MPIO will fail extended MPIO pass through requests that have the MPIO\_IOCTL\_FLAG\_INVOLVE\_DSM flag set.</span></span>

 

## <a name="manifestation"></a><span data-ttu-id="128d9-117">Manifestación</span><span class="sxs-lookup"><span data-stu-id="128d9-117">Manifestation</span></span>

<span data-ttu-id="128d9-118">Si alguna parte de la pila de almacenamiento del dispositivo, incluido DSM, no admite SRBs extendidos, la pila de almacenamiento revertirá al uso de SRBs heredadas.</span><span class="sxs-lookup"><span data-stu-id="128d9-118">If any part of the device’s storage stack, including DSM, does not support extended SRBs, the storage stack will revert to using legacy SRBs.</span></span>

## <a name="solution"></a><span data-ttu-id="128d9-119">Solución</span><span class="sxs-lookup"><span data-stu-id="128d9-119">Solution</span></span>

<span data-ttu-id="128d9-120">Solo hay dos requisitos de MPIO para que DSM admita bloques de \_ solicitud de almacenamiento \_ :</span><span class="sxs-lookup"><span data-stu-id="128d9-120">There are only two MPIO requirements for a DSM to support STORAGE\_REQUEST\_BLOCKS:</span></span>

-   <span data-ttu-id="128d9-121">DSM debe notificar su tipo como DsmType6</span><span class="sxs-lookup"><span data-stu-id="128d9-121">The DSM must report its type as DsmType6</span></span>
-   <span data-ttu-id="128d9-122">DSM debe proporcionar la \_ \_ \_ función compatible con el tipo de dirección de DSM</span><span class="sxs-lookup"><span data-stu-id="128d9-122">The DSM must provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function</span></span>

<span data-ttu-id="128d9-123">Si el DSM no notifica DsmType6 o si informa de DsmType6, pero no proporciona la \_ función compatible con el tipo de dirección de DSM \_ \_ , MPIO ASUMIrá que DSM no admite SRBs extendido.</span><span class="sxs-lookup"><span data-stu-id="128d9-123">If the DSM does not report DsmType6 or if it reports DsmType6 but does not provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function, MPIO will assume the DSM does not support extended SRBs.</span></span>

<span data-ttu-id="128d9-124">La \_ función compatible con el tipo de dirección DSM \_ \_ acepta dos parámetros, uno de los cuales es un tipo de dirección.</span><span class="sxs-lookup"><span data-stu-id="128d9-124">The DSM\_ADDRESS\_TYPE\_SUPPORTED function accepts two parameters, one of which is an address type.</span></span> <span data-ttu-id="128d9-125">Este tipo de dirección debe ser uno de los \_ valores de tipo de dirección de almacenamiento \_ \_ \* definidos en SRB. h.</span><span class="sxs-lookup"><span data-stu-id="128d9-125">This address type must be one of the STORAGE\_ADDRESS\_TYPE\_\* values defined in srb.h.</span></span> <span data-ttu-id="128d9-126">El DSM debe devolver TRUE si admite el tipo de dirección dado y FALSE si no es así.</span><span class="sxs-lookup"><span data-stu-id="128d9-126">The DSM must return TRUE if it supports the given address type and FALSE if it does not.</span></span> <span data-ttu-id="128d9-127">La definición de "soporte" es en última instancia hasta el DSM.</span><span class="sxs-lookup"><span data-stu-id="128d9-127">The definition of “support” is ultimately up to the DSM.</span></span> <span data-ttu-id="128d9-128">MPIO usa esta función para asegurarse de que el DSM no se comportará correctamente si se le entrega una SRB extendida con una \_ estructura de dirección Stor del tipo dado.</span><span class="sxs-lookup"><span data-stu-id="128d9-128">MPIO uses this function to ensure that the DSM will not misbehave if it is handed an extended SRB with a STOR\_ADDRESS structure of the given type.</span></span> <span data-ttu-id="128d9-129">Como tal, MPIO normalmente llama a esta función cuando se está enumerando un dispositivo de múltiples rutas, pero se puede llamar a la función en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="128d9-129">As such, MPIO generally calls this function when a multipath device is being enumerated, but the function could be called at any time.</span></span>

<span data-ttu-id="128d9-130">Si un DSM no toca nunca una dirección de almacenamiento de información de SRB extendida \_ , puede devolver true para cualquier valor de tipo de dirección de almacenamiento válido \_ \_ \_ \* .</span><span class="sxs-lookup"><span data-stu-id="128d9-130">If a DSM never touches an extended SRB’s STOR\_ADDRESS, then it can return TRUE for any valid STORAGE\_ADDRESS\_TYPE\_\* value.</span></span> <span data-ttu-id="128d9-131">Revise el DSM de ejemplo en el WDK.</span><span class="sxs-lookup"><span data-stu-id="128d9-131">Review the sample DSM in the WDK.</span></span>

<span data-ttu-id="128d9-132">**Otras notas importantes**</span><span class="sxs-lookup"><span data-stu-id="128d9-132">**Other important notes**</span></span>

-   <span data-ttu-id="128d9-133">Los DSM que admiten SRBs extendidos deben ser capaces de \_ administrar \_ estructuras de bloques de solicitud SCSI y estructuras de bloques de solicitud de almacenamiento \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="128d9-133">DSMs that support extended SRBs must be able to handle both SCSI\_REQUEST\_BLOCK structures and STORAGE\_REQUEST\_BLOCK structures.</span></span> <span data-ttu-id="128d9-134">El hecho de que un DSM informe de que admite SRBs extendidos no significa que recibirá de forma exclusiva SRBs extendido.</span><span class="sxs-lookup"><span data-stu-id="128d9-134">Just because a DSM reports that it supports extended SRBs does not mean that it will exclusively receive extended SRBs.</span></span> <span data-ttu-id="128d9-135">Todavía puede recibir cualquier número de SRBs heredados además de SRBs extendido y, por tanto, debe ser capaz de controlar ambos.</span><span class="sxs-lookup"><span data-stu-id="128d9-135">It may still receive any number of legacy SRBs in addition to extended SRBs, and therefore must be able to handle both.</span></span>
-   <span data-ttu-id="128d9-136">Hemos proporcionado un archivo de encabezado en el WDK llamado srbhelper. h que contiene funciones insertadas para ayudar a los controladores que deben controlar los SRBs extendidos y heredados.</span><span class="sxs-lookup"><span data-stu-id="128d9-136">We have provided a header file in the WDK called srbhelper.h that contains inline functions to help drivers that must handle both extended and legacy SRBs.</span></span> <span data-ttu-id="128d9-137">Nuestro ejemplo DSM usa este encabezado para que pueda usarlo como ejemplo de cómo usar estas funciones.</span><span class="sxs-lookup"><span data-stu-id="128d9-137">Our sample DSM uses this header so you can use it as an example of how to use these functions.</span></span>
-   <span data-ttu-id="128d9-138">Un DSM que no admita SRBs extendidos nunca tendrá que administrar SRBs extendidos.</span><span class="sxs-lookup"><span data-stu-id="128d9-138">A DSM that does not support extended SRBs will never have to handle extended SRBs.</span></span>
-   <span data-ttu-id="128d9-139">Es posible que un MPIO cause que la pila de almacenamiento revierta en SRBs heredados en caso de que el DSM no admita un tipo de dirección de almacenamiento determinado \_ \_ \_ \* (pero, de lo contrario, admita SRBs extendido).</span><span class="sxs-lookup"><span data-stu-id="128d9-139">It’s possible that a MPIO will cause the storage stack to fall back on legacy SRBs in the event that the DSM does not support a given STORAGE\_ADDRESS\_TYPE\_\* (but otherwise supports extended SRBs).</span></span>
-   <span data-ttu-id="128d9-140">"BTL8" es el único \_ \_ tipo de dirección \_ \* de almacenamiento definido actualmente para Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="128d9-140">“BTL8” is the only STORAGE\_ADDRESS\_TYPE\_\*currently defined for Windows Server 2012.</span></span>

 

 




