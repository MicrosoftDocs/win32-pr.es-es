---
description: El almacén de certificados es fundamental para todas las operaciones de administración de certificados.
ms.assetid: e5c7c882-cbfc-4343-952c-b13c67326756
title: Extensión de la funcionalidad de CertOpenStore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cce198578cc482ba0488bd97ae0f1d7f923511b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104565020"
---
# <a name="extending-certopenstore-functionality"></a><span data-ttu-id="ea9a9-103">Extensión de la funcionalidad de CertOpenStore</span><span class="sxs-lookup"><span data-stu-id="ea9a9-103">Extending CertOpenStore Functionality</span></span>

<span data-ttu-id="ea9a9-104">El [*almacén de certificados*](../secgloss/c-gly.md) es fundamental para todas las operaciones de administración de certificados.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-104">The [*certificate store*](../secgloss/c-gly.md) is central to all certificate management operations.</span></span> <span data-ttu-id="ea9a9-105">La funcionalidad de la función [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) se puede extender mediante el uso de una función de proveedor de almacén de certificados instalable (o registrada).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-105">The functionality of the [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) function can be extended through the use of an installable (or registered) certificate-store-provider function.</span></span> <span data-ttu-id="ea9a9-106">Para obtener información general sobre cómo instalar o registrar funciones para su uso con CryptoAPI, consulte [información general sobre OID](oid-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-106">For an overview of how to install or register functions for use with the CryptoAPI, see [OID Overview](oid-overview.md).</span></span>

> [!Note]  
> <span data-ttu-id="ea9a9-107">Los almacenes de certificados personalizados no se migran automáticamente al realizar implementaciones automatizadas.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-107">Custom certificate stores are not automatically migrated when performing automated deployments.</span></span> <span data-ttu-id="ea9a9-108">Para migrar almacenes de certificados personalizados, debe crear un manifiesto para migrar los almacenes personalizados y usar el Herramienta de migración de estado de usuario de Windows (USMT).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-108">To migrate custom certificate stores, you must create a manifest for migrating the custom stores and use the Windows User State Migration Tool (USMT).</span></span> <span data-ttu-id="ea9a9-109">La herramienta USMT está disponible para su descarga desde el centro de descarga de Microsoft en <https://www.microsoft.com/download/details.aspx?id=10837> .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-109">The USMT is available for download from the Microsoft Download Center at <https://www.microsoft.com/download/details.aspx?id=10837>.</span></span>

 

<span data-ttu-id="ea9a9-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) abre un almacén vacío en la memoria y llama a la función de proveedor de almacén (si está registrado o instalado) mediante el [*identificador de objeto*](../secgloss/o-gly.md) (OID) que se pasó en el parámetro *lpszStoreProvider* .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) opens an empty store in memory and calls the store provider function (if it is registered or installed) by using the [*object identifier*](../secgloss/o-gly.md) (OID) that was passed in the *lpszStoreProvider* parameter.</span></span> <span data-ttu-id="ea9a9-111">Para obtener una lista de los tipos de proveedores predefinidos que se proporcionan con CryptoAPI, consulte **CertOpenStore**.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-111">For a list of the predefined provider types that are supplied with the CryptoAPI, see **CertOpenStore**.</span></span>

<span data-ttu-id="ea9a9-112">La función de proveedor de almacén copia sus certificados y [*listas de revocación de certificados*](../secgloss/c-gly.md) (CRL) en el almacén en memoria especificado por el identificador de *hCertStore* que se le ha pasado.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-112">The store provider function copies its certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs) to the in-memory store specified by the *hCertStore* handle passed to it.</span></span> <span data-ttu-id="ea9a9-113">La nueva función de proveedor de almacén puede usar cualquiera de las funciones del almacén de certificados CryptoAPI, como, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) o [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), para agregar sus certificados y CRL al almacén en memoria.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-113">The new store provider function can use any of the CryptoAPI certificate store functions, such as, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) or [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), to add its certificates and CRLs to the in-memory store.</span></span> <span data-ttu-id="ea9a9-114">Además, la función de proveedor de almacenamiento devuelve opcionalmente valores para todos los miembros de datos de la estructura de [**información de Prov del almacén de certificados \_ \_ \_**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-114">In addition, the store-provider function optionally returns values for all of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="ea9a9-115">La función solo necesita actualizar esta estructura si admite funciones de devolución de llamada adicionales.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-115">The function only needs to update this structure if it supports additional callback functions.</span></span> <span data-ttu-id="ea9a9-116">Por ejemplo, si el almacén debía ser un almacén de solo lectura, es probable que la compatibilidad con otras funciones de devolución de llamada no fuera necesaria.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-116">For example, if the store was to be a read-only store, the support of other callback functions probably would not be needed.</span></span> <span data-ttu-id="ea9a9-117">Para obtener más información y los prototipos de las funciones de devolución de llamada posibles, vea [funciones de devolución de llamada del proveedor del almacén de certificados](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-117">For details and prototypes of the possible callback functions, see [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

<span data-ttu-id="ea9a9-118">El almacén TrustedPeople por usuario está restringido a los almacenes físicos predefinidos.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-118">The per user TrustedPeople store is restricted to predefined physical stores.</span></span> <span data-ttu-id="ea9a9-119">No se puede extender el almacén de TrustedPeople por usuario.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-119">You cannot extend the per user TrustedPeople store.</span></span> <span data-ttu-id="ea9a9-120">Sin embargo, puede extender el almacén TrustedPeople del equipo local.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-120">However, you can extend the local machine TrustedPeople store.</span></span>

<span data-ttu-id="ea9a9-121">**Windows XP y Windows Server 2003:** El almacén TrustedPeople por usuario no está restringido a los almacenes físicos predefinidos.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-121">**Windows XP and Windows Server 2003:** The per user TrustedPeople store is not restricted to predefined physical stores.</span></span>

<span data-ttu-id="ea9a9-122">Uno de los miembros de datos de la estructura de [**\_ \_ \_ información del almacén de certificados**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) es la matriz *rgpvStoreProvFunc* .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-122">One of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure is the *rgpvStoreProvFunc* array.</span></span> <span data-ttu-id="ea9a9-123">Si la función de proveedor de almacén necesita admitir una o varias de las funciones de devolución de llamada, debe proporcionar punteros para esta matriz.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-123">If the store provider function needs to support one or more of the callback functions, it must provide pointers for this array.</span></span> <span data-ttu-id="ea9a9-124">Estos punteros deben apuntar a las funciones de devolución de llamada que se van a usar para otras actividades del almacén de certificados (por ejemplo, cerrar el almacén).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-124">These pointers must point to the callback functions that are to be used for other certificate-store activities (such as closing the store).</span></span> <span data-ttu-id="ea9a9-125">En la ilustración siguiente se muestra el flujo de este proceso.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-125">The following illustration shows the flow of this process.</span></span>

![funcionalidad de CertOpenStore](images/openstor.png)

<span data-ttu-id="ea9a9-127">Como se muestra en la siguiente ilustración, una vez abierto el almacén, otras funciones CryptoAPI (como [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) utilizan la matriz de punteros para tener acceso a las funciones de devolución de llamada que realizan la tarea deseada.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-127">As shown in the following illustration, after the store has been opened, other CryptoAPI functions (such as [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) use the array of pointers to access the callback functions that perform the intended task.</span></span> <span data-ttu-id="ea9a9-128">La definición de la estructura de [**\_ \_ \_ información del almacén de certificados**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) y los prototipos de las funciones de devolución de llamada predeterminadas que se proporcionan con CryptoAPI se muestran en funciones de devolución de llamada del proveedor del almacén de [certificados](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-128">The definition of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure and the prototypes of the default callback functions that are supplied with the CryptoAPI are shown in [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

![funcionalidad de certclosestore](images/closstor.png)

<span data-ttu-id="ea9a9-130">Las API de almacenamiento permiten que un proveedor de almacén Mantenga los certificados, las CRL y [*las listas*](../secgloss/c-gly.md) de certificados de confianza (CTL) fuera de la caché del almacén (por ejemplo, una base de datos externa de certificados, como la proporcionada por la base de datos del servidor de certificados de Microsoft).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-130">The store APIs allow a store provider to maintain the certificates, CRLs, and [*certificate trust lists*](../secgloss/c-gly.md) (CTLs) outside the cache of the store (for example, an external database of certificates, such as provided by the Microsoft Certificate Server Database).</span></span>

<span data-ttu-id="ea9a9-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) envía a través del parámetro *pszStoreProvider* a la función de proveedor instalable [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) adecuada.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) dispatches through the *pszStoreProvider* parameter to the appropriate [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) installable provider function.</span></span> <span data-ttu-id="ea9a9-132">El proveedor devuelve información en el parámetro *pStoreProvInfo* que apunta a una estructura de información de Prov del almacén de [**certificados \_ \_ \_**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-132">The provider returns information in the *pStoreProvInfo* parameter that points to a [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="ea9a9-133">La estructura de **\_ \_ \_ información del almacén de certificados** contiene un miembro **dwStoreProvFlags** .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-133">The **CERT\_STORE\_PROV\_INFO** structure contains a **dwStoreProvFlags** member.</span></span> <span data-ttu-id="ea9a9-134">La \_ marca de marca external del almacén de certificados se ha \_ \_ \_ agregado para permitir que el proveedor indique que los certificados, las CRL y las CTL son externos a la memoria caché del almacén.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-134">The CERT\_STORE\_PROV\_EXTERNAL\_FLAG flag was added to allow the provider to indicate that the certificates, CRLs, and CTLs are external to the cache of the store.</span></span>

<span data-ttu-id="ea9a9-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) devuelve una matriz de funciones de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) returns an array of callback functions.</span></span> <span data-ttu-id="ea9a9-136">Un proveedor puede implementar las siguientes funciones de devolución de llamada:</span><span class="sxs-lookup"><span data-stu-id="ea9a9-136">A provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="ea9a9-137">función \_ de \_ cierre de Prov de almacén de \_ certificados \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-137">CERT\_STORE\_PROV\_CLOSE\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-138">función \_ de \_ \_ certificado de lectura Prov del almacén \_ \_ de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-138">CERT\_STORE\_PROV\_READ\_CERT\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-139">función \_ de \_ \_ certificado de escritura de Prov de almacén \_ \_ de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-139">CERT\_STORE\_PROV\_WRITE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-140">el \_ almacén de certificados \_ eliminar el \_ \_ certificado \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-140">CERT\_STORE\_PROV\_DELETE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-141">propiedad de certificado de conjunto de certificados del almacén de certificados \_ \_ \_ \_ \_ \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-141">CERT\_STORE\_PROV\_SET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-142">el \_ almacén de certificados \_ Prov \_ Read \_ CRL \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-142">CERT\_STORE\_PROV\_READ\_CRL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-143">el almacén de certificados de la \_ \_ escritura de \_ \_ CRL \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-143">CERT\_STORE\_PROV\_WRITE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-144">\_FUNC. \_ eliminación \_ de \_ CRL \_ del almacén de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-144">CERT\_STORE\_PROV\_DELETE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-145">\_propiedad de \_ conjunto \_ de \_ \_ propiedades CRL \_ del almacén de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-145">CERT\_STORE\_PROV\_SET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-146">almacén de certificados \_ \_ Prov \_ Read \_ CTL \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-146">CERT\_STORE\_PROV\_READ\_CTL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-147">almacén de certificados de la \_ \_ escritura de \_ \_ CTL \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-147">CERT\_STORE\_PROV\_WRITE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-148">el almacén de certificados de la \_ \_ eliminación de \_ \_ CTL \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-148">CERT\_STORE\_PROV\_DELETE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-149">función \_ de \_ \_ \_ propiedad CTL del \_ conjunto \_ de certificados del almacén de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-149">CERT\_STORE\_PROV\_SET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="ea9a9-150">En las llamadas a las funciones de devolución de llamada de escritura de \_ certificado, escritura \_ CRL y escritura \_ CTL cuando \_ se establece la marca Add de la escritura del almacén de certificados \_ \_ \_ \_ , los 16 bits superiores del parámetro *dwFlags* contienen el valor *dwAddDisposition* .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-150">On calls to the WRITE\_CERT, WRITE\_CRL, and WRITE\_CTL callback functions when the CERT\_STORE\_PROV\_WRITE\_ADD\_FLAG is set, the upper 16 bits of the *dwFlags* parameter contains the *dwAddDisposition* value.</span></span> <span data-ttu-id="ea9a9-151">Para admitir almacenes externos, un proveedor puede implementar las siguientes funciones de devolución de llamada:</span><span class="sxs-lookup"><span data-stu-id="ea9a9-151">To support external stores, a provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="ea9a9-152">el \_ Prov del almacén de certificados \_ encontrar el \_ \_ certificado \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-152">CERT\_STORE\_PROV\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-153">el almacén de certificados no se \_ \_ encuentra disponible en la búsqueda de \_ \_ \_ CERT \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-153">CERT\_STORE\_PROV\_FREE\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-154">propiedad del certificado de obtención del almacén de certificados \_ \_ \_ \_ \_ \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-154">CERT\_STORE\_PROV\_GET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-155">función de CRL de la \_ \_ \_ búsqueda de \_ almacén de certificados \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-155">CERT\_STORE\_PROV\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-156">el almacén de certificados de la \_ \_ búsqueda de \_ \_ \_ CRL Free \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-156">CERT\_STORE\_PROV\_FREE\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-157">función \_ de \_ \_ propiedad de \_ CRL de obtención \_ \_ de almacén de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-157">CERT\_STORE\_PROV\_GET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-158">función \_ de \_ \_ \_ CTL \_ de aprovisionamiento de almacén de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-158">CERT\_STORE\_PROV\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-159">almacén de certificados de la \_ \_ búsqueda de \_ \_ CTL Free \_ \_ FUNC</span><span class="sxs-lookup"><span data-stu-id="ea9a9-159">CERT\_STORE\_PROV\_FREE\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="ea9a9-160">función de la \_ \_ \_ propiedad de \_ CTL obtener CTL \_ \_ del almacén de certificados</span><span class="sxs-lookup"><span data-stu-id="ea9a9-160">CERT\_STORE\_PROV\_GET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="ea9a9-161">Las funciones de devolución de llamada de certificado tienen las siguientes firmas:</span><span class="sxs-lookup"><span data-stu-id="ea9a9-161">The certificate callback functions have the following signatures:</span></span>

``` syntax
typedef struct _CERT_STORE_PROV_FIND_INFO {
    DWORD               cbSize;
    DWORD               dwMsgAndCertEncodingType;
    DWORD               dwFindFlags;
    DWORD               dwFindType;
    const void          *pvFindPara;
} CERT_STORE_PROV_FIND_INFO, *PCERT_STORE_PROV_FIND_INFO;
typedef const CERT_STORE_PROV_FIND_INFO CCERT_STORE_PROV_FIND_INFO,
    *PCCERT_STORE_PROV_FIND_INFO;

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_STORE_PROV_FIND_INFO pFindInfo,
        IN PCCERT_CONTEXT pPrevCertContext,
        IN DWORD dwFlags,
        IN OUT void **ppvStoreProvFindInfo,
        OUT PCCERT_CONTEXT *ppProvCertContext
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FREE_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN void *pvStoreProvFindInfo,
        IN DWORD dwFlags
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_GET_CERT_PROPERTY)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN DWORD dwPropId,
        IN DWORD dwFlags,
        OUT void *pvData,
        IN OUT DWORD *pcbData
        );
```

<span data-ttu-id="ea9a9-162">Las firmas de las funciones de devolución de llamada de CTL y CTL son idénticas a las anteriores con el puntero al [**\_ contexto de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) reemplazado con un puntero a un [**\_ contexto de CRL**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) o de [**CTL \_**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-162">The signatures for the CRL and CTL callback functions are identical to the above with the pointer to the [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) replaced with a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) or [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span></span>

<span data-ttu-id="ea9a9-163">\_Se llama a la devolución de llamada de búsqueda de certificado cuando las API de almacenamiento enumeran, buscan o agregan certificados.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-163">The FIND\_CERT callback is called when the store APIs enumerate, find, or add certificates.</span></span> <span data-ttu-id="ea9a9-164">*pPrevCertContext* y *ppvStoreProvFindInfo* se establecen en **null** para iniciar una nueva búsqueda.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-164">*pPrevCertContext* and *ppvStoreProvFindInfo* are set to **NULL** to initiate a new FIND.</span></span> <span data-ttu-id="ea9a9-165">La *ppvStoreProvFindInfo* devuelta se vuelve a pasar en la siguiente búsqueda en el momento en el que el proveedor puede liberarla.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-165">The returned *ppvStoreProvFindInfo* is passed back on the next find at which time it may be freed by the provider.</span></span> <span data-ttu-id="ea9a9-166">El proveedor puede establecer todas las propiedades del certificado, algunas o ninguna de ellas.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-166">The provider may set all, some, or none of the certificate properties.</span></span> <span data-ttu-id="ea9a9-167">El proveedor tiene la opción de diferir hasta que \_ \_ se llame a la devolución de llamada de la propiedad Get cert.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-167">The provider has the option to defer until the GET\_CERT\_PROPERTY callback is called.</span></span> <span data-ttu-id="ea9a9-168">Se recomienda que los proveedores establezcan tantas propiedades como sea posible para permitir la copia en otro almacén.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-168">It is recommended for providers to set as many properties as possible to allow copying to another store.</span></span>

<span data-ttu-id="ea9a9-169">Los siguientes tipos de búsqueda de certificado se admiten en [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span><span class="sxs-lookup"><span data-stu-id="ea9a9-169">The following certificate find types are supported in [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span></span>

-   <span data-ttu-id="ea9a9-170">CERT \_ Buscar \_ any</span><span class="sxs-lookup"><span data-stu-id="ea9a9-170">CERT\_FIND\_ANY</span></span>
-   <span data-ttu-id="ea9a9-171">CERTIFICADO de \_ búsqueda de \_ \_ hash SHA1</span><span class="sxs-lookup"><span data-stu-id="ea9a9-171">CERT\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="ea9a9-172">CERTIFICADO de \_ búsqueda \_ MD5 \_ hash</span><span class="sxs-lookup"><span data-stu-id="ea9a9-172">CERT\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="ea9a9-173">\_propiedad de búsqueda de certificado \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-173">CERT\_FIND\_PROPERTY</span></span>
-   <span data-ttu-id="ea9a9-174">CERTIFICADO de \_ búsqueda de \_ \_ clave pública</span><span class="sxs-lookup"><span data-stu-id="ea9a9-174">CERT\_FIND\_PUBLIC\_KEY</span></span>
-   <span data-ttu-id="ea9a9-175">\_nombre del \_ firmante de búsqueda de certificado \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-175">CERT\_FIND\_SUBJECT\_NAME</span></span>
-   <span data-ttu-id="ea9a9-176">CERTIFICADO \_ Buscar \_ atributo de asunto \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-176">CERT\_FIND\_SUBJECT\_ATTR</span></span>
-   <span data-ttu-id="ea9a9-177">\_nombre de \_ emisor de búsqueda de certificado \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-177">CERT\_FIND\_ISSUER\_NAME</span></span>
-   <span data-ttu-id="ea9a9-178">CERT \_ Buscar el \_ atributo issuer \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-178">CERT\_FIND\_ISSUER\_ATTR</span></span>
-   <span data-ttu-id="ea9a9-179">CERT \_ Buscar \_ asunto \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="ea9a9-179">CERT\_FIND\_SUBJECT\_STR\_A</span></span>
-   <span data-ttu-id="ea9a9-180">CERT \_ Buscar \_ asunto \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="ea9a9-180">CERT\_FIND\_SUBJECT\_STR\_W</span></span>
-   <span data-ttu-id="ea9a9-181">CERTIFICADO \_ \_ de búsqueda de emisores \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="ea9a9-181">CERT\_FIND\_ISSUER\_STR\_A</span></span>
-   <span data-ttu-id="ea9a9-182">CERTIFICADO de \_ búsqueda de \_ emisores en \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="ea9a9-182">CERT\_FIND\_ISSUER\_STR\_W</span></span>
-   <span data-ttu-id="ea9a9-183">\_especificación de \_ clave de búsqueda de certificado \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-183">CERT\_FIND\_KEY\_SPEC</span></span>
-   <span data-ttu-id="ea9a9-184">uso del certificado de \_ búsqueda de \_ ENHKEY \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-184">CERT\_FIND\_ENHKEY\_USAGE</span></span>

<span data-ttu-id="ea9a9-185">\_Se llama a la devolución de llamada de buscar certificado para cada uno de los tipos de búsqueda anteriores.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-185">The FIND\_CERT callback is called for each of the above find types.</span></span> <span data-ttu-id="ea9a9-186">Los parámetros que se pasan a [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) se copian directamente en la \_ estructura del Prov. buscar información del almacén de certificados \_ \_ \_ antes de que se llame a la devolución de llamada de búsqueda de \_ certificado.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-186">The parameters passed to [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CERT callback is called.</span></span> <span data-ttu-id="ea9a9-187">Para obtener más información acerca de los valores de campo de los diferentes tipos de búsqueda de la estructura de información de la búsqueda del almacén de certificados \_ \_ \_ \_ , vea **CertFindCertificateInStore**.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-187">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCertificateInStore**.</span></span>

<span data-ttu-id="ea9a9-188">Los siguientes tipos de búsqueda de certificado admiten las API [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) y [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) y ayudan a determinar si el certificado ya existe en el almacén antes de agregar:</span><span class="sxs-lookup"><span data-stu-id="ea9a9-188">The following certificate find types support the [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) and [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) APIs and help determine whether the certificate already exists in the store before adding:</span></span>

-   <span data-ttu-id="ea9a9-189">certificado de \_ búsqueda \_ de certificado \_</span><span class="sxs-lookup"><span data-stu-id="ea9a9-189">CERT\_FIND\_SUBJECT\_CERT</span></span>
-   <span data-ttu-id="ea9a9-190">\_ \_ emisor \_ de búsqueda de certificado de</span><span class="sxs-lookup"><span data-stu-id="ea9a9-190">CERT\_FIND\_ISSUER\_OF</span></span>
-   <span data-ttu-id="ea9a9-191">CERTIFICADO \_ encontrar \_ existente</span><span class="sxs-lookup"><span data-stu-id="ea9a9-191">CERT\_FIND\_EXISTING</span></span>

<span data-ttu-id="ea9a9-192">En el caso de CERT \_ \_ \_ , busque CERT, el parámetro *pvFindPara* apunta a una estructura de [**\_ información de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) que contiene el emisor y la SerialNumber del sujeto.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-192">For CERT\_FIND\_SUBJECT\_CERT, the *pvFindPara* parameter points to a [**CERT\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) structure that contains the Issuer and SerialNumber of the subject.</span></span> <span data-ttu-id="ea9a9-193">En el caso del \_ \_ emisor \_ de la búsqueda de certificados, *pvFindPara* apunta a una estructura de [**\_ contexto de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) del sujeto.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-193">For CERT\_FIND\_ISSUER\_OF, *pvFindPara* points to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) structure, of the subject.</span></span> <span data-ttu-id="ea9a9-194">En el caso de CERT \_ Find \_ Existing, *pvFindPara* apunta a un **\_ contexto** de certificado del certificado para comprobar su existencia en el almacén.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-194">For CERT\_FIND\_EXISTING, *pvFindPara* points to a **CERT\_CONTEXT** of the certificate to check for its existence in the store.</span></span>

<span data-ttu-id="ea9a9-195">\_ \_ Se llama a la devolución de llamada de búsqueda de certificado gratuita cuando el certificado devuelto por la devolución de llamada de búsqueda \_ de certificado no se liberó por su uso en un siguiente certificado de búsqueda posterior \_ , por lo que su [*recuento de referencias*](../secgloss/r-gly.md) se ha reducido a cero o porque se ha liberado mediante una llamada a [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span><span class="sxs-lookup"><span data-stu-id="ea9a9-195">The FREE\_FIND\_CERT callback is called when the certificate returned by the FIND\_CERT callback was not released by being used in a subsequent next FIND\_CERT, thus having its [*reference count*](../secgloss/r-gly.md) decremented to zero, or by being released by a call to [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span></span> <span data-ttu-id="ea9a9-196">Antes de que se llame a la devolución de llamada de cierre, todos los certificados devueltos por la devolución de llamada de FIND \_ CERT deben liberarse en el proveedor pasando a una llamada a la devolución de llamada de búsqueda de certificado \_ o una llamada a la \_ devolución de llamada de búsqueda de certificado gratuita \_ .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-196">Before the CLOSE callback is called, all certificates returned by the FIND\_CERT callback should be released to the provider by being passed to a call to the FIND\_CERT callback or a call to the FREE\_FIND\_CERT callback.</span></span> <span data-ttu-id="ea9a9-197">Lo mismo se aplica a las devoluciones de llamada CRL y CTL.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-197">The same applies to the CRL and CTL callbacks.</span></span>

<span data-ttu-id="ea9a9-198">\_ \_ [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) llama a la devolución de llamada de la propiedad Get CERT si no encuentra la propiedad especificada para el parámetro *pCertContext* .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-198">The GET\_CERT\_PROPERTY callback is called by [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) if it cannot find the specified property for the *pCertContext* parameter.</span></span> <span data-ttu-id="ea9a9-199">Lo mismo se aplica a la \_ propiedad Get CRL \_ y a la \_ propiedad Get CTL \_ .</span><span class="sxs-lookup"><span data-stu-id="ea9a9-199">The same is true for GET\_CRL\_PROPERTY and GET\_CTL\_PROPERTY.</span></span>

<span data-ttu-id="ea9a9-200">\_Se llama a la devolución de llamada de la CRL de búsqueda cuando las API de almacén enumeran u obtienen CRL y antes de agregar una CRL.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-200">The FIND\_CRL callback is called when the store APIs enumerate or get CRLs and before adding a CRL.</span></span> <span data-ttu-id="ea9a9-201">Se definirán los siguientes tipos de búsqueda de CRL:</span><span class="sxs-lookup"><span data-stu-id="ea9a9-201">The following CRL find types will be defined:</span></span>

<span data-ttu-id="ea9a9-202">En el caso de \_ la búsqueda de CRL \_ emitida \_ por, *pvFindPara* es un puntero a un [**\_ contexto de certificado**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) del emisor de CRL.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-202">For CRL\_FIND\_ISSUED\_BY, *pvFindPara* is a pointer to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) of the CRL issuer.</span></span> <span data-ttu-id="ea9a9-203">En el caso de \_ la CRL buscar \_ existente, *pvFindPara* es un puntero a un [**\_ contexto de CRL**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) de la CRL para determinar si ya existe en el almacén.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-203">For CRL\_FIND\_EXISTING, *pvFindPara* is a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) of the CRL to determine whether it already exists in the store.</span></span>

<span data-ttu-id="ea9a9-204">\_Se llama a la devolución de llamada de búsqueda CTL cuando las API de almacenamiento enumeran o buscan CTL.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-204">The FIND\_CTL callback is called when the store APIs enumerate or find CTLs.</span></span> <span data-ttu-id="ea9a9-205">Los siguientes tipos de búsqueda de CTL se admiten en [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span><span class="sxs-lookup"><span data-stu-id="ea9a9-205">The following CTL find types are supported in [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span></span>

-   <span data-ttu-id="ea9a9-206">CTL \_ Buscar \_ cualquiera</span><span class="sxs-lookup"><span data-stu-id="ea9a9-206">CTL\_FIND\_ANY</span></span>
-   <span data-ttu-id="ea9a9-207">CTL \_ Buscar \_ \_ hash SHA1</span><span class="sxs-lookup"><span data-stu-id="ea9a9-207">CTL\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="ea9a9-208">CTL \_ Buscar \_ \_ hash MD5</span><span class="sxs-lookup"><span data-stu-id="ea9a9-208">CTL\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="ea9a9-209">CTL \_ Buscar \_ uso</span><span class="sxs-lookup"><span data-stu-id="ea9a9-209">CTL\_FIND\_USAGE</span></span>
-   <span data-ttu-id="ea9a9-210">CTL \_ Buscar \_ asunto</span><span class="sxs-lookup"><span data-stu-id="ea9a9-210">CTL\_FIND\_SUBJECT</span></span>
-   <span data-ttu-id="ea9a9-211">CTL \_ Buscar \_ existente</span><span class="sxs-lookup"><span data-stu-id="ea9a9-211">CTL\_FIND\_EXISTING</span></span>

<span data-ttu-id="ea9a9-212">\_Se llama a la devolución de llamada de búsqueda CTL para cada uno de los tipos de búsqueda anteriores.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-212">The FIND\_CTL callback is called for each of the above find types.</span></span> <span data-ttu-id="ea9a9-213">Los parámetros que se pasan a [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) se copian directamente en la \_ estructura del Prov. buscar información del almacén de certificados \_ \_ \_ antes de que se llame a la devolución de llamada de búsqueda \_ CTL.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-213">The parameters passed to [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CTL callback is called.</span></span> <span data-ttu-id="ea9a9-214">Para obtener más información acerca de los valores de campo de los diferentes tipos de búsqueda de la estructura de información de la búsqueda del almacén de certificados \_ \_ \_ \_ , vea **CertFindCTLInStore**.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-214">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCTLInStore**.</span></span>

<span data-ttu-id="ea9a9-215">El \_ tipo de \_ búsqueda CTL existente buscar CTL ayuda a determinar si la CTL ya existe en el almacén antes de realizar una operación de agregar CTL.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-215">The CTL\_FIND\_EXISTING CTL find type helps determine whether the CTL already exists in the store before doing a CTL add.</span></span>

<span data-ttu-id="ea9a9-216">En la \_ búsqueda de CTL \_ existente, *pvFindPara* es un puntero a la estructura de [**\_ contexto CTL**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) de la CTL para determinar si ya existe en el almacén.</span><span class="sxs-lookup"><span data-stu-id="ea9a9-216">For CTL\_FIND\_EXISTING, *pvFindPara* is a pointer to the [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) structure of the CTL to determine whether it already exists in the store.</span></span>

 

 
