---
description: En este tema se describe cómo las transformaciones de Media Foundation deben controlar las marcas de tiempo.
ms.assetid: 4ab576ce-becd-4736-921e-e463c0dff841
title: Marcas de tiempo y duraciones
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2323c11fa0e3ec2b2b2d5ba1cefe4f5d5fa80c5b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155312"
---
# <a name="time-stamps-and-durations"></a><span data-ttu-id="e8d8a-103">Marcas de tiempo y duraciones</span><span class="sxs-lookup"><span data-stu-id="e8d8a-103">Time Stamps and Durations</span></span>

<span data-ttu-id="e8d8a-104">En este tema se describe cómo las [transformaciones de Media Foundation](media-foundation-transforms.md) deben controlar las marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-104">This topic describes how [Media Foundation Transforms](media-foundation-transforms.md) should handle time stamps.</span></span>

<span data-ttu-id="e8d8a-105">Una MFT debe establecer una marca de tiempo y una duración como sea posible en todos los ejemplos de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-105">An MFT must set as accurate a time stamp and duration as possible on all output samples.</span></span> <span data-ttu-id="e8d8a-106">En el caso de un MFT sencillo que toma un búfer de entrada y lo procesa completamente en un búfer de salida, la MFT solo debe copiar la marca de tiempo y la duración directamente de la muestra de entrada en el ejemplo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-106">For a simple MFT that takes one input buffer and completely processes it into an output buffer, the MFT should just copy the time stamp and duration directly from the input sample to the output sample.</span></span> <span data-ttu-id="e8d8a-107">Sin embargo, muchas transformaciones son más complejas que esta y pueden requerir cálculos más complejos de tiempo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-107">However, many transforms are more complex than this and may require more complex calculations of output time.</span></span> <span data-ttu-id="e8d8a-108">Todos los MFTs deben cumplir las siguientes reglas básicas:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-108">All MFTs should observe the following basic rules:</span></span>

-   <span data-ttu-id="e8d8a-109">Una MFT debe intentar colocar una marca de tiempo y una duración en todos los ejemplos de salida de vídeo o audio sin comprimir si se proporciona una marca de tiempo o una duración precisas en los ejemplos de entrada o se puede calcular.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-109">An MFT should try to put a time stamp and duration on all uncompressed video or audio output samples if an accurate time stamp or duration is given on the input samples or can be calculated.</span></span> <span data-ttu-id="e8d8a-110">La interpolación puede ser necesaria para algunas marcas de tiempo de salida, especialmente para los descodificadores.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-110">Interpolation may be required for some output time stamps, especially for decoders.</span></span>
-   <span data-ttu-id="e8d8a-111">Las marcas de tiempo y las duraciones de los ejemplos de entrada deben conservarse en los ejemplos de salida tanto como sea posible.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-111">The time stamps and durations of the input samples should be preserved on the output samples as much as possible.</span></span>
-   <span data-ttu-id="e8d8a-112">Es posible que las marcas de tiempo de salida o las duraciones no coincidan con la entrada porque la MFT está reteniendo los datos o dividiendo la salida en partes de tamaño diferente que la entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-112">The output time stamps or durations might not match the input because the MFT is holding back data or breaking the output into different-sized pieces than the input.</span></span> <span data-ttu-id="e8d8a-113">En ese caso, el MFT debe calcular la marca de tiempo de salida del ejemplo de entrada más antiguo que contiene los datos usados para crear el ejemplo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-113">In that case, the MFT should calculate the output time stamp from the earliest input sample that contains data used to create the output sample.</span></span> <span data-ttu-id="e8d8a-114">Para calcular la marca de tiempo de salida, agregue la marca de tiempo de entrada del ejemplo de entrada adecuado a la duración de los datos que ya se han transformado desde ese ejemplo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-114">To calculate the output time stamp, add the input time stamp of the appropriate input sample to the duration of data that has already been transformed from that sample.</span></span> <span data-ttu-id="e8d8a-115">En el segundo ejemplo al final de esta sección se muestra esta idea.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-115">The second example at the end of this section illustrates this idea.</span></span>
-   <span data-ttu-id="e8d8a-116">Si los ejemplos de entrada tienen duración, se debe conservar esa duración.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-116">If the input samples have duration, that duration should be preserved.</span></span> <span data-ttu-id="e8d8a-117">Si una muestra de entrada no tiene duración, la MFT debe calcular una duración si es posible a partir del tamaño del búfer de salida o la velocidad de datos proporcionada por el tipo de medio.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-117">If an input sample does not have duration, the MFT should calculate a duration if possible from the size of the output buffer or the data rate given by the media type.</span></span>
-   <span data-ttu-id="e8d8a-118">Las duraciones calculadas deben truncarse (redondearse hacia abajo), no redondeadas al incremento más próximo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-118">Calculated durations should be truncated (rounded down), not rounded to the nearest increment.</span></span> <span data-ttu-id="e8d8a-119">La canalización tiene suficiente demora para controlar las duraciones que son ligeramente inexactas, pero es más fácil que la canalización controle una duración de un 1% demasiado corta que una duración de 1% demasiado larga.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-119">The pipeline has enough slack to handle durations that are slightly inaccurate, but it is easier for the pipeline to handle a duration that is 1% too short than a duration that is 1% too long.</span></span> <span data-ttu-id="e8d8a-120">Dicho esto, no hay ningún motivo para acortar deliberadamente las duraciones, aparte de redondear.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-120">That said, there is no reason to deliberately shorten the durations, other than by rounding.</span></span>

### <a name="decoders"></a><span data-ttu-id="e8d8a-121">Descodificadores</span><span class="sxs-lookup"><span data-stu-id="e8d8a-121">Decoders</span></span>

<span data-ttu-id="e8d8a-122">Un descodificador convierte los paquetes comprimidos en datos sin comprimir.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-122">A decoder converts compressed packets into uncompressed data.</span></span> <span data-ttu-id="e8d8a-123">Dado que la salida está sin comprimir, los descodificadores tienen una obligación especial de obtener las marcas de tiempo y las duraciones correctas.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-123">Because the output is uncompressed, decoders have a special obligation to get the time stamps and durations correct.</span></span> <span data-ttu-id="e8d8a-124">Algunos formatos comprimidos, en especial MPEG-2, no tienen marcas de tiempo en todos los paquetes entrantes y, a menudo, no tienen ninguna duración en ningún paquete.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-124">Some compressed formats, most notably MPEG-2, do not have time stamps on all input packets and often have no duration on any packet.</span></span> <span data-ttu-id="e8d8a-125">Para estos formatos, el descodificador es responsable de colocar una marca de tiempo y una duración válidas en cada ejemplo de salida, mediante la suma de las duraciones implícitas de toda la salida desde el último ejemplo de entrada con marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-125">For these formats, the decoder is responsible for putting a valid time stamp and duration on every output sample, by summing the implied durations of all the output since the last time-stamped input sample.</span></span>

<span data-ttu-id="e8d8a-126">En el caso de vídeo, si la duración no está disponible en el formato comprimido, el descodificador debe calcular la duración como inverso de la velocidad de fotogramas, convertido a unidades de 100-nanosegundos y redondeado hacia abajo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-126">For video, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the frame rate, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="e8d8a-127">En el caso de audio, si la duración no está disponible en el formato comprimido, el descodificador debe calcular la duración como el inverso de la velocidad de muestra de audio multiplicado por el número de muestras en el búfer de salida, convertido a unidades de 100-nanosegundos y redondeado hacia abajo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-127">For audio, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the audio sample rate multiplied by the number of samples in the output buffer, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="e8d8a-128">La única vez que una transformación debe generar una muestra sin una marca de tiempo es si la MFT nunca ha recibido una marca de tiempo en una muestra de entrada, o si no hay ninguna manera de calcular una marca de tiempo de salida precisa de la marca de tiempo de entrada anterior.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-128">The only time a transform should output a sample without a time stamp is if the MFT has never received a time stamp on an input sample, or if there is no way to calculate an accurate output time stamp from the previous input time stamp.</span></span>

### <a name="audio-decoders"></a><span data-ttu-id="e8d8a-129">Descodificadores de audio</span><span class="sxs-lookup"><span data-stu-id="e8d8a-129">Audio Decoders</span></span>

<span data-ttu-id="e8d8a-130">En el caso de los descodificadores de audio, la duración de cada ejemplo de salida se calcula a partir de la velocidad de muestreo de audio y el número de muestras de PCM por canal en el búfer de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-130">For audio decoders, the duration of each output sample is calculated from the audio sampling rate and the number of PCM samples per channel in the output buffer.</span></span>

<span data-ttu-id="e8d8a-131">La manera correcta de calcular las marcas de tiempo de salida depende de si los ejemplos de entrada contienen marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-131">The correct way to calculate output time stamps depends on whether the input samples contain time stamps.</span></span>

<span data-ttu-id="e8d8a-132">Si los ejemplos de entrada contienen marcas de tiempo, el descodificador calcula las marcas de tiempo de salida a partir de las marcas de tiempo de entrada, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-132">If the input samples contain time stamps, the decoder calculates the output time stamps from the input time stamps, as follows:</span></span>

-   <span data-ttu-id="e8d8a-133">Si cada búfer de entrada contiene uno o varios marcos comprimidos completos, sin fotogramas parciales, la marca de tiempo de salida es igual a la marca de tiempo de entrada, menos la latencia conocida del descodificador.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-133">If each input buffer contains a one or more complete compressed frames, with no partial frames, the output time stamp equals the input time stamp, minus the known latency of the decoder.</span></span> <span data-ttu-id="e8d8a-134">Por ejemplo, un descodificador Dolby Digital (AC-3) tiene una latencia de ejemplos 256 PCM.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-134">For example, a Dolby Digital (AC-3) decoder has a latency of 256 PCM samples.</span></span> <span data-ttu-id="e8d8a-135">Por ejemplo, con una frecuencia de muestreo de 48 kHz, la latencia es de 5,33 milisegundos (MS).</span><span class="sxs-lookup"><span data-stu-id="e8d8a-135">For example, at 48-kHz sampling rate, the latency is 5.33 milliseconds (msec).</span></span> <span data-ttu-id="e8d8a-136">Por lo tanto, si la marca de tiempo de entrada es de 1000 ms, la marca de tiempo de salida es 1000 – 5,33 = 994,66 ms.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-136">Therefore, if the input time stamp is 1000 msec, the output time stamp is 1000 – 5.33 = 994.66 msec.</span></span> <span data-ttu-id="e8d8a-137">Si el búfer de entrada incluye más de un fotograma comprimido completo, el descodificador generará un ejemplo de salida para cada fotograma de la muestra de entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-137">If the input buffer includes more than one whole compressed frame, the decoder will produce one output sample for every frame in the input sample.</span></span> <span data-ttu-id="e8d8a-138">Todos los ejemplos de salida tendrán una marca de tiempo correctamente, de modo que no haya huecos.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-138">All output samples will be time stamped correctly such that there are no gaps.</span></span>
-   <span data-ttu-id="e8d8a-139">Dependiendo del formato de transporte, un búfer de entrada podría contener fotogramas parciales.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-139">Depending on the transport format, an input buffer might contain partial frames.</span></span> <span data-ttu-id="e8d8a-140">Por ejemplo, un búfer puede contener parte de un fotograma del búfer de entrada anterior, seguido de uno o varios marcos completos, seguido del inicio del fotograma siguiente.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-140">For example, a buffer might contain part of a frame from the previous input buffer, followed by one or more complete frames, followed by the start of the next frame.</span></span> <span data-ttu-id="e8d8a-141">En este caso, generalmente es correcto asumir que la marca de tiempo de entrada corresponde al primer fotograma que se inicia dentro del búfer.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-141">In this case, it is generally correct to assume that the input time stamp corresponds to the first frame that starts within the buffer.</span></span> <span data-ttu-id="e8d8a-142">(Es decir, un marco parcial que comenzó en el búfer anterior no se incluye en la marca de tiempo del búfer actual). Calcular la marca de tiempo de salida en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-142">(That is, a partial frame that started in the previous buffer is not included in the time stamp for the current buffer.) Calculate the output time stamp accordingly.</span></span>

<span data-ttu-id="e8d8a-143">Si los ejemplos de entrada no contienen marcas de tiempo:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-143">If the input samples do not contain any time stamps:</span></span>

-   <span data-ttu-id="e8d8a-144">El descodificador debe generar sus propias marcas de tiempo y establecer la primera marca de tiempo de salida en cero.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-144">The decoder should generate its own time stamps, setting the first output time stamp to zero.</span></span>
-   <span data-ttu-id="e8d8a-145">La duración de ejemplo se calcula a partir del número de muestras de salida del búfer y la velocidad de muestra.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-145">The sample duration is calculated from the number of output samples in the buffer and the sample rate.</span></span>
-   <span data-ttu-id="e8d8a-146">Las marcas de tiempo subsiguientes se calculan a partir de la marca de tiempo y la duración anteriores: marca de tiempo actual + duración actual = siguiente marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-146">Subsequent time stamps are calculated from the previous time stamp and duration: Current time stamp + current duration = next time stamp.</span></span> <span data-ttu-id="e8d8a-147">No debe haber huecos en las marcas de tiempo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-147">There should be no gaps in the output time stamps.</span></span>

<span data-ttu-id="e8d8a-148">Si el flujo de entrada contiene inicialmente marcas de tiempo, pero por algún motivo cambia a ninguna marca de tiempo, el descodificador debe continuar generando sus propias marcas de tiempo de salida, de modo que sean continuas y no haya ningún intervalo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-148">If the input stream initially contains time stamps, but for some reason switches to no time stamps, the decoder should continue to generate its own output time stamps, such that they are continuous and there is no gap.</span></span>

<span data-ttu-id="e8d8a-149">Si el flujo de entrada contiene marcas de tiempo, pero hay huecos en las horas, el descodificador simplemente propagará estos huecos.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-149">If the input stream contains time stamps, but there are gaps in the times, the decoder will simply propagate these gaps.</span></span> <span data-ttu-id="e8d8a-150">En otras palabras, el descodificador no debe intentar corregir las marcas de tiempo incoherentes en el flujo de entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-150">In other words, the decoder should not attempt to fix inconsistent time stamps in the input stream.</span></span>

### <a name="mixers"></a><span data-ttu-id="e8d8a-151">Mezcladores</span><span class="sxs-lookup"><span data-stu-id="e8d8a-151">Mixers</span></span>

> [!Note]  
> <span data-ttu-id="e8d8a-152">En Windows Vista, la canalización de Media Foundation no admite MFTs con más de una entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-152">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="e8d8a-153">Se admiten MFTs de varias entradas en Windows 7.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-153">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="e8d8a-154">Un mezclador toma varias entradas y las mezcla en una salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-154">A mixer takes multiple inputs and mixes them into one output.</span></span> <span data-ttu-id="e8d8a-155">Si los flujos de entrada no están totalmente bloqueados o se desplazan ligeramente en el tiempo entre sí, puede haber ambigüedad sobre el tiempo que se debe establecer en la salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-155">If the input streams are not completely rate-locked, or are slightly offset in time from each other, there can be ambiguity about which time to set on the output.</span></span> <span data-ttu-id="e8d8a-156">Estas son algunas instrucciones, según el tipo de medio:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-156">Here are some guidelines, depending on the media type:</span></span>

-   <span data-ttu-id="e8d8a-157">Audio.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-157">Audio.</span></span> <span data-ttu-id="e8d8a-158">En el inicio o inmediatamente después de una purga o vaciado, un mezclador de audio debe esperar para producir muestras de salida hasta que se haya recibido un ejemplo de entrada en todos los flujos de entrada necesarios.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-158">At startup or immediately after a drain or flush, an audio mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="e8d8a-159">En ese momento, debe elegir la marca de tiempo más temprana de las muestras iniciales que se usará como línea base para las marcas de tiempo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-159">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="e8d8a-160">El resto de flujos se deben rellenar con un silencio para componer cualquier diferencia de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-160">The other streams should be padded with silence to make up any time discrepancy.</span></span> <span data-ttu-id="e8d8a-161">Si se recibe un ejemplo en un flujo de entrada opcional, también se debe factorizar en el cálculo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-161">If a sample is received on an optional input stream, it should also be factored into the calculation.</span></span> <span data-ttu-id="e8d8a-162">A partir de ese momento, la MFT debe procurar generar una cadena continua y no rota de marcas de tiempo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-162">From that point on, the MFT should strive to produce a continuous and unbroken chain of output time stamps.</span></span> <span data-ttu-id="e8d8a-163">En general, la MFT no debe intentar tener en cuenta una derivación de flujo relativa a otra.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-163">In general, the MFT should not try to account for one stream drifting relative to another.</span></span> <span data-ttu-id="e8d8a-164">En su lugar, debe calcular las marcas de tiempo de salida a partir de la marca de tiempo de línea de base, la tasa de salida y los tamaños de búfer.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-164">Instead, it should calculate the output time stamps from the baseline time stamp, the output rate, and the buffer sizes.</span></span> <span data-ttu-id="e8d8a-165">Cuando se produce otra purga o vaciado, el MFT debe restablecer las marcas de tiempo de línea de base.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-165">When another drain or flush occurs, the MFT should reset its baseline time stamps.</span></span>

-   <span data-ttu-id="e8d8a-166">Video.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-166">Video.</span></span> <span data-ttu-id="e8d8a-167">En el inicio o inmediatamente después de una purga o vaciado, un mezclador de vídeo debe esperar para producir muestras de salida hasta que se haya recibido un ejemplo de entrada en todos los flujos de entrada necesarios.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-167">At startup or immediately after a drain or flush, a video mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="e8d8a-168">En ese momento, debe elegir la marca de tiempo más temprana de las muestras iniciales que se usará como línea base para las marcas de tiempo de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-168">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="e8d8a-169">En general, debe procurar mantener marcas de tiempo de salida continuas y normales y duraciones fijas, incluso si la entrada no es tan regular, si es necesario, repitiendo los fotogramas de entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-169">In general, it should strive to keep continuous and regular output time stamps and fixed durations, even if the input is not as regular, if necessary by repeating input frames.</span></span>

### <a name="encoders"></a><span data-ttu-id="e8d8a-170">Codificadores</span><span class="sxs-lookup"><span data-stu-id="e8d8a-170">Encoders</span></span>

<span data-ttu-id="e8d8a-171">Un codificador convierte audio o vídeo sin comprimir en paquetes comprimidos.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-171">An encoder converts uncompressed audio or video into compressed packets.</span></span> <span data-ttu-id="e8d8a-172">Un codificador debe seguir estas instrucciones:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-172">An encoder should follow these guidelines:</span></span>

-   <span data-ttu-id="e8d8a-173">El codificador debe seguir las convenciones del formato de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-173">The encoder should follow the conventions of the output format.</span></span> <span data-ttu-id="e8d8a-174">Si el formato no suele ser una marca de tiempo en cada ejemplo, como en MPEG-2, no todos los ejemplos de salida deben tener una marca de tiempo y una duración.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-174">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="e8d8a-175">Las marcas de tiempo de entrada deben conservarse en el formato de salida, si el formato tiene campos para las marcas de tiempo, a menos que haya más información de tiempo disponible de otro origen, como la propia aplicación.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-175">The input time stamps should be preserved in the output format, if the format has fields for time stamps, unless better time information is a available from another source, such as the application itself.</span></span>

### <a name="multiplexers"></a><span data-ttu-id="e8d8a-176">Multiplexores</span><span class="sxs-lookup"><span data-stu-id="e8d8a-176">Multiplexers</span></span>

> [!Note]  
> <span data-ttu-id="e8d8a-177">En Windows Vista, la canalización de Media Foundation no admite MFTs con más de una entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-177">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="e8d8a-178">Se admiten MFTs de varias entradas en Windows 7.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-178">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="e8d8a-179">Un multiplexor combina dos secuencias de audio o vídeo diferentes en un formato intercalado, como la secuencia de transporte AVI o MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-179">A multiplexer combines two different audio or video streams into one interleaved format, such as AVI or MPEG-2 Transport Stream.</span></span> <span data-ttu-id="e8d8a-180">Un multiplexor debe seguir estas instrucciones:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-180">A multiplexer should follow these guidelines:</span></span>

-   <span data-ttu-id="e8d8a-181">El multiplexor debe seguir las convenciones del formato de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-181">The multiplexer should follow the conventions of the output format.</span></span> <span data-ttu-id="e8d8a-182">Si el formato no suele ser una marca de tiempo en cada ejemplo, como en MPEG-2, no todos los ejemplos de salida deben tener una marca de tiempo y una duración.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-182">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="e8d8a-183">La marca de tiempo debe reflejar la hora más temprana en que se colocaría en cualquier fotograma que comience en ese paquete o la hora de la primera muestra de audio que se descodificaría de ese paquete.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-183">The time stamp should reflect the earliest time that would be placed on any frame that begins in that packet, or the time of the first audio sample that would be decoded from that packet.</span></span> <span data-ttu-id="e8d8a-184">Omita esta directriz si entra en conflicto con las convenciones del formato de salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-184">Ignore this guideline if it conflicts with the conventions of the output format.</span></span>

### <a name="demultiplexers"></a><span data-ttu-id="e8d8a-185">Demultiplexadores</span><span class="sxs-lookup"><span data-stu-id="e8d8a-185">Demultiplexers</span></span>

<span data-ttu-id="e8d8a-186">Un desmultiplexador divide un formato intercalado, como un flujo de transporte AVI o MPEG-2, en las secuencias de audio y vídeo subyacentes.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-186">A demultiplexer splits an interleaved format, such as AVI or MPEG-2 Transport Stream, into the underlying audio and video streams.</span></span>

<span data-ttu-id="e8d8a-187">Si el formato contiene información específica de la marca de tiempo que se puede usar para calcular las marcas de tiempo de salida precisas en función de las marcas de tiempo de entrada, se debe usar esa información.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-187">If the format contains specific time stamp information that can be used to calculate accurate output time stamps based on the input time stamps, that information should be used.</span></span> <span data-ttu-id="e8d8a-188">Sin embargo, si el formato contiene horas en una base completamente diferente que no tienen ninguna relación con las marcas de tiempo de entrada, y no se puede calcular un desplazamiento exacto de la marca de tiempo de entrada, se deben omitir las horas propias del formato.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-188">However, if the format contains times in a completely different base that bear no relation to the input time stamps, and an accurate offset to the input time stamp cannot be calculated, the format's own times should be ignored.</span></span>

<span data-ttu-id="e8d8a-189">Si el formato no tiene información de marca de tiempo utilizable, el demultiplexador debe seguir estas reglas:</span><span class="sxs-lookup"><span data-stu-id="e8d8a-189">If the format does not have usable time stamp information, the demultiplexer should follow these rules:</span></span>

-   <span data-ttu-id="e8d8a-190">Los flujos de salida sin comprimir deben tener marcas de tiempo y duraciones válidas si es posible, calculadas a partir de la marca de tiempo de entrada anterior más cercana.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-190">Uncompressed output streams should have valid time stamps and durations if possible, calculated from the closest previous input time stamp.</span></span>

-   <span data-ttu-id="e8d8a-191">Los flujos de salida comprimidos deben tener marcas de tiempo en el primer ejemplo de salida derivado de un ejemplo de entrada con una marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-191">Compressed output streams should have time stamps on only the first output sample derived from an input sample with a time stamp.</span></span> <span data-ttu-id="e8d8a-192">Si el ejemplo de entrada no tiene una marca de tiempo, ningún ejemplo de salida derivado de ese ejemplo de entrada debe tener una marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-192">If the input sample does not have a time stamp, no output samples derived from that input sample should have a time stamp.</span></span> <span data-ttu-id="e8d8a-193">Si el ejemplo de entrada se divide en varios ejemplos de salida, solo el primer ejemplo de salida debe tener una marca de tiempo y el resto no debe tener ninguna marca de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-193">If the input sample is broken into multiple output samples, only the first output sample should have a time stamp, and the rest should have no time stamps.</span></span>

### <a name="examples"></a><span data-ttu-id="e8d8a-194">Ejemplos</span><span class="sxs-lookup"><span data-stu-id="e8d8a-194">Examples</span></span>

<span data-ttu-id="e8d8a-195">Ejemplo 1.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-195">Example 1.</span></span> <span data-ttu-id="e8d8a-196">Supongamos que un efecto de vídeo siempre toma un fotograma de entrada sin comprimir, aplica el efecto y lo copia en la salida.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-196">Suppose that a video effect always takes an uncompressed input frame, applies the effect, and copies it to the output.</span></span> <span data-ttu-id="e8d8a-197">Nunca mantiene ningún fotograma ni almacena en búfer ninguna entrada.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-197">It never holds back any frames or buffers any input.</span></span> <span data-ttu-id="e8d8a-198">Este MFT simplemente copia la marca de tiempo y la duración de la muestra de entrada en el ejemplo de salida, si están disponibles, y no realiza cálculos de tiempo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-198">This MFT simply copies the time stamp and duration from the input sample to the output sample, if they are available, and does no time calculations at all.</span></span>

<span data-ttu-id="e8d8a-199">Ejemplo 2.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-199">Example 2.</span></span> <span data-ttu-id="e8d8a-200">Supongamos que un efecto de audio transforma todo menos de 10 milisegundos (MS) de cada búfer de entrada, guardando el 10 ms extra para combinarlo con el siguiente búfer.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-200">Suppose that an audio effect transforms all but 10 milliseconds (ms) of each input buffer, saving the extra 10 ms to combine with the next buffer.</span></span> <span data-ttu-id="e8d8a-201">Obtiene una secuencia de ejemplos que tienen una duración de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-201">It gets a stream of samples that all have a duration of 50 ms.</span></span> <span data-ttu-id="e8d8a-202">Los tiempos de entrada se muestran en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-202">The input times are shown in the following table.</span></span>



| <span data-ttu-id="e8d8a-203">Muestra</span><span class="sxs-lookup"><span data-stu-id="e8d8a-203">Sample</span></span> | <span data-ttu-id="e8d8a-204">Hora de entrada</span><span class="sxs-lookup"><span data-stu-id="e8d8a-204">Input time</span></span> | <span data-ttu-id="e8d8a-205">Duración de entrada</span><span class="sxs-lookup"><span data-stu-id="e8d8a-205">Input duration</span></span> | <span data-ttu-id="e8d8a-206">Hora de salida</span><span class="sxs-lookup"><span data-stu-id="e8d8a-206">Output time</span></span> | <span data-ttu-id="e8d8a-207">Duración de la salida</span><span class="sxs-lookup"><span data-stu-id="e8d8a-207">Output duration</span></span> |
|--------|------------|----------------|-------------|-----------------|
| <span data-ttu-id="e8d8a-208">1</span><span class="sxs-lookup"><span data-stu-id="e8d8a-208">1</span></span>      | <span data-ttu-id="e8d8a-209">20</span><span class="sxs-lookup"><span data-stu-id="e8d8a-209">20</span></span>         | <span data-ttu-id="e8d8a-210">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-210">50</span></span>             | <span data-ttu-id="e8d8a-211">20</span><span class="sxs-lookup"><span data-stu-id="e8d8a-211">20</span></span>          | <span data-ttu-id="e8d8a-212">40</span><span class="sxs-lookup"><span data-stu-id="e8d8a-212">40</span></span>              |
| <span data-ttu-id="e8d8a-213">2</span><span class="sxs-lookup"><span data-stu-id="e8d8a-213">2</span></span>      | <span data-ttu-id="e8d8a-214">70</span><span class="sxs-lookup"><span data-stu-id="e8d8a-214">70</span></span>         | <span data-ttu-id="e8d8a-215">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-215">50</span></span>             | <span data-ttu-id="e8d8a-216">60</span><span class="sxs-lookup"><span data-stu-id="e8d8a-216">60</span></span>          | <span data-ttu-id="e8d8a-217">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-217">50</span></span>              |
| <span data-ttu-id="e8d8a-218">3</span><span class="sxs-lookup"><span data-stu-id="e8d8a-218">3</span></span>      | <span data-ttu-id="e8d8a-219">121</span><span class="sxs-lookup"><span data-stu-id="e8d8a-219">121</span></span>        | <span data-ttu-id="e8d8a-220">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-220">50</span></span>             | <span data-ttu-id="e8d8a-221">110</span><span class="sxs-lookup"><span data-stu-id="e8d8a-221">110</span></span>         | <span data-ttu-id="e8d8a-222">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-222">50</span></span>              |
| <span data-ttu-id="e8d8a-223">4</span><span class="sxs-lookup"><span data-stu-id="e8d8a-223">4</span></span>      | <span data-ttu-id="e8d8a-224">171</span><span class="sxs-lookup"><span data-stu-id="e8d8a-224">171</span></span>        | <span data-ttu-id="e8d8a-225">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-225">50</span></span>             | <span data-ttu-id="e8d8a-226">161</span><span class="sxs-lookup"><span data-stu-id="e8d8a-226">161</span></span>         | <span data-ttu-id="e8d8a-227">50</span><span class="sxs-lookup"><span data-stu-id="e8d8a-227">50</span></span>              |



 

<span data-ttu-id="e8d8a-228">Tenga en cuenta la discrepancia de 1 ms entre la duración real del ejemplo 2 y la duración implícita según la siguiente marca de tiempo (121?</span><span class="sxs-lookup"><span data-stu-id="e8d8a-228">Note the 1-ms discrepancy between the actual duration of sample 2 and the implied duration based on the next time stamp (121 ?</span></span> <span data-ttu-id="e8d8a-229">70 = 51).</span><span class="sxs-lookup"><span data-stu-id="e8d8a-229">70 = 51).</span></span>

<span data-ttu-id="e8d8a-230">Dado que la MFT contiene 10 ms, genera el primer 40 ms de la muestra de entrada 1 como muestra de salida 1, con una marca de tiempo de 20 MS y una duración de 40 ms.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-230">Because the MFT holds back 10 ms, it outputs the first 40 ms of input sample 1 as output sample 1, with a time stamp of 20 ms and a duration of 40 ms.</span></span>

<span data-ttu-id="e8d8a-231">El ejemplo de salida 2 combina los 10 ms previamente retenidos con 40 ms de la muestra de entrada 2.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-231">Output sample 2 combines the 10 ms previously held back with 40 ms of input sample 2.</span></span> <span data-ttu-id="e8d8a-232">A este ejemplo se le asigna una marca de tiempo de 60 ms (la marca de tiempo de la muestra de entrada anterior, 20 MS, más la duración de los datos ya procesados de ese ejemplo, 40 ms).</span><span class="sxs-lookup"><span data-stu-id="e8d8a-232">This sample is given a time stamp of 60 ms (the time stamp of the previous input sample, 20ms, plus the duration of the data already processed from that sample, 40ms).</span></span> <span data-ttu-id="e8d8a-233">Se le asigna una duración de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-233">It is given a duration of 50ms.</span></span>

<span data-ttu-id="e8d8a-234">Del mismo modo, el ejemplo siguiente tiene una marca de tiempo de 110ms (70ms + 40 ms) con una duración de 50 ms.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-234">Similarly, the next sample has a time stamp of 110ms (70ms + 40ms) with a duration of 50 ms.</span></span>

<span data-ttu-id="e8d8a-235">El siguiente cálculo es más interesante.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-235">The next calculation is more interesting.</span></span> <span data-ttu-id="e8d8a-236">La marca de tiempo implícita de la hora de salida y la duración anteriores sería 160 ms (marca de tiempo 110 MS + Duration 50 ms).</span><span class="sxs-lookup"><span data-stu-id="e8d8a-236">The implied time stamp from the previous output time and duration would be 160 ms (time stamp 110 ms + duration 50 ms).</span></span> <span data-ttu-id="e8d8a-237">Sin embargo, se supone que la marca de tiempo de salida se calcula a partir de la marca de tiempo de entrada del ejemplo de entrada más antiguo que se superpone a la muestra de salida en el tiempo, más la longitud de los datos ya procesados desde ese ejemplo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-237">However, the output time stamp is supposed to be calculated from the input time stamp of the earliest input sample that overlaps the output sample in time, plus the length of any data already processed from that sample.</span></span> <span data-ttu-id="e8d8a-238">El ejemplo de entrada superpuesto más cercano es el ejemplo 4 (marca de tiempo = 171), pero no es el más antiguo.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-238">The closest overlapping input sample is the sample 4 (time stamp = 171), but this is not the earliest one.</span></span> <span data-ttu-id="e8d8a-239">El ejemplo superpuesto más antiguo es Sample 3 (marca de tiempo = 121).</span><span class="sxs-lookup"><span data-stu-id="e8d8a-239">The earliest overlapping sample is sample 3 (time stamp = 121).</span></span> <span data-ttu-id="e8d8a-240">Al agregar el 40 ms que ya se ha procesado desde ese ejemplo, el resultado es 161.</span><span class="sxs-lookup"><span data-stu-id="e8d8a-240">Adding the 40ms that has already been processed from that sample, the result is 161.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e8d8a-241">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="e8d8a-241">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e8d8a-242">Escribir una MFT personalizada</span><span class="sxs-lookup"><span data-stu-id="e8d8a-242">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



