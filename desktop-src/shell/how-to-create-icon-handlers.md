---
description: Describe cómo crear un controlador para asignaciones de iconos personalizadas.
ms.assetid: 23ed3a21-cf62-4440-b983-fae23aa56890
title: Cómo crear controladores de iconos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c620b6f6a4c05f8996a26c8365e4f4201ee0b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985459"
---
# <a name="how-to-create-icon-handlers"></a><span data-ttu-id="80da3-103">Cómo crear controladores de iconos</span><span class="sxs-lookup"><span data-stu-id="80da3-103">How to Create Icon Handlers</span></span>

<span data-ttu-id="80da3-104">A menudo, un [tipo de archivo](fa-file-types.md) tiene un icono personalizado asociado a él para que sus miembros sean fácilmente reconocibles en el explorador de Windows.</span><span class="sxs-lookup"><span data-stu-id="80da3-104">A [file type](fa-file-types.md) often has a custom icon associated with it, to make its members easily recognizable in Windows Explorer.</span></span> <span data-ttu-id="80da3-105">La manera más sencilla de asignar un icono personalizado a un tipo de archivo es registrar el archivo del icono.</span><span class="sxs-lookup"><span data-stu-id="80da3-105">The simplest way to assign a custom icon to a file type is to register the icon's file.</span></span> <span data-ttu-id="80da3-106">Sin embargo, un icono registrado de este modo será el mismo para todos los miembros del tipo de archivo.</span><span class="sxs-lookup"><span data-stu-id="80da3-106">However, an icon registered in this way will be the same for all members of the file type.</span></span> <span data-ttu-id="80da3-107">Puede tener mucha más flexibilidad a la hora de asignar iconos a los miembros del tipo de archivo implementando un *controlador de icono*.</span><span class="sxs-lookup"><span data-stu-id="80da3-107">You can have much more flexibility in assigning icons to the members of the file type by implementing an *icon handler*.</span></span>

<span data-ttu-id="80da3-108">Un controlador de icono es un tipo de controlador de extensión de Shell que permite asignar de forma dinámica iconos a los miembros de un tipo de archivo.</span><span class="sxs-lookup"><span data-stu-id="80da3-108">An icon handler is a type of Shell extension handler that allows you to dynamically assign icons to the members of a file type.</span></span> <span data-ttu-id="80da3-109">Cada vez que se muestra un archivo del tipo, el shell consulta el icono correspondiente al controlador.</span><span class="sxs-lookup"><span data-stu-id="80da3-109">Every time a file of the type is displayed, the Shell queries the handler for the appropriate icon.</span></span> <span data-ttu-id="80da3-110">Por ejemplo, un controlador de iconos puede asignar iconos diferentes a los distintos miembros del tipo de archivo o variar el icono en función del estado actual del archivo.</span><span class="sxs-lookup"><span data-stu-id="80da3-110">For instance, an icon handler can assign different icons to different members of the file type, or vary the icon based on the current state of the file.</span></span>

<span data-ttu-id="80da3-111">Los procedimientos generales para implementar y registrar un controlador de extensión de Shell se explican en [crear controladores de extensión de Shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="80da3-111">The general procedures for implementing and registering a Shell extension handler are discussed in [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="80da3-112">Este documento se centra en los aspectos de la implementación que son específicos de los controladores de iconos.</span><span class="sxs-lookup"><span data-stu-id="80da3-112">This document focuses on those aspects of implementation that are specific to icon handlers.</span></span>

-   [<span data-ttu-id="80da3-113">Implementar controladores de iconos</span><span class="sxs-lookup"><span data-stu-id="80da3-113">Implementing Icon Handlers</span></span>](#step-1-implementing-icon-handlers)
-   [<span data-ttu-id="80da3-114">Implementar la interfaz IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="80da3-114">Implementing the IExtractIcon Interface</span></span>](#step-2-implementing-the-iextracticon-interface)
-   [<span data-ttu-id="80da3-115">Registrar controladores de iconos</span><span class="sxs-lookup"><span data-stu-id="80da3-115">Registering Icon Handlers</span></span>](#step-3-registering-icon-handlers)
-   [<span data-ttu-id="80da3-116">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="80da3-116">Related topics</span></span>](#related-topics)

## <a name="instructions"></a><span data-ttu-id="80da3-117">Instrucciones</span><span class="sxs-lookup"><span data-stu-id="80da3-117">Instructions</span></span>

### <a name="step-1-implementing-icon-handlers"></a><span data-ttu-id="80da3-118">Paso 1: implementar controladores de iconos</span><span class="sxs-lookup"><span data-stu-id="80da3-118">Step 1: Implementing Icon Handlers</span></span>

<span data-ttu-id="80da3-119">Al igual que todos los controladores de extensión de Shell, los controladores de iconos son objetos de modelo de objetos componentes (COM) en proceso implementados como archivos dll.</span><span class="sxs-lookup"><span data-stu-id="80da3-119">Like all Shell extension handlers, icon handlers are in-process Component Object Model (COM) objects implemented as DLLs.</span></span> <span data-ttu-id="80da3-120">Deben exportar dos interfaces además de [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) y [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span><span class="sxs-lookup"><span data-stu-id="80da3-120">They must export two interfaces in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) and [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span></span>

<span data-ttu-id="80da3-121">El shell inicializa el controlador a través de su interfaz [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="80da3-121">The Shell initializes the handler through its [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="80da3-122">Utiliza esta interfaz para solicitar el identificador de clase (CLSID) del controlador y proporciona el nombre del archivo.</span><span class="sxs-lookup"><span data-stu-id="80da3-122">It uses this interface to request the handler's class identifier (CLSID) and provides it with the file's name.</span></span> <span data-ttu-id="80da3-123">El resto de la operación se lleva a cabo a través de la interfaz [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) .</span><span class="sxs-lookup"><span data-stu-id="80da3-123">The rest of the operation takes place through the [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface.</span></span> <span data-ttu-id="80da3-124">Para obtener información general sobre cómo implementar controladores de extensión de Shell, incluida la interfaz **IPersistFile** , vea [crear controladores de extensión de Shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="80da3-124">For a general discussion of how to implement Shell extension handlers, including the **IPersistFile** interface, see [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="80da3-125">En el resto de este documento se explica cómo implementar la interfaz **IExtractIcon** .</span><span class="sxs-lookup"><span data-stu-id="80da3-125">The remainder of this document discusses how to implement the **IExtractIcon** interface.</span></span>

### <a name="step-2-implementing-the-iextracticon-interface"></a><span data-ttu-id="80da3-126">Paso 2: implementación de la interfaz IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="80da3-126">Step 2: Implementing the IExtractIcon Interface</span></span>

<span data-ttu-id="80da3-127">Una vez inicializada la interfaz, el shell usa la interfaz [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) del controlador para solicitar el icono adecuado.</span><span class="sxs-lookup"><span data-stu-id="80da3-127">After the interface is initialized, the Shell uses the handler's [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface to request the appropriate icon.</span></span> <span data-ttu-id="80da3-128">La interfaz tiene dos métodos: [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) y [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="80da3-128">The interface has two methods: [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) and [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="80da3-129">Los iconos se identifican por su ubicación en el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="80da3-129">Icons are identified by their location in the file system.</span></span> <span data-ttu-id="80da3-130">Se llama al método [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) para solicitar esta información.</span><span class="sxs-lookup"><span data-stu-id="80da3-130">The [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) method is called to request this information.</span></span> <span data-ttu-id="80da3-131">Establezca el parámetro *szIconFile* en el nombre de archivo.</span><span class="sxs-lookup"><span data-stu-id="80da3-131">Set the *szIconFile* parameter to the file name.</span></span> <span data-ttu-id="80da3-132">Si hay más de un icono en el archivo, establezca *piIndex* en el índice del icono.</span><span class="sxs-lookup"><span data-stu-id="80da3-132">If there is more than one icon in the file, set *piIndex* to the icon's index.</span></span> <span data-ttu-id="80da3-133">Asigne los valores adecuados a las dos variables de marca.</span><span class="sxs-lookup"><span data-stu-id="80da3-133">Assign appropriate values to the two flag variables.</span></span> <span data-ttu-id="80da3-134">Si no desea especificar un nombre de archivo o si no desea que el shell Extraiga el icono, establezca la marca **Gil \_ NOTFILENAME** en el parámetro *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="80da3-134">If you do not want to specify a file name, or if you do not want the Shell to extract the icon, set the **GIL\_NOTFILENAME** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="80da3-135">No es necesario asignar un valor a *szIconFile*, pero el controlador debe proporcionar los identificadores de icono cuando el shell llama a [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="80da3-135">You do not need to assign a value to *szIconFile*, but the handler must provide icon handles when the Shell calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="80da3-136">Si devuelve un nombre de archivo, el shell normalmente intenta cargar el icono desde su memoria caché.</span><span class="sxs-lookup"><span data-stu-id="80da3-136">If you return a file name, the Shell normally attempts to load the icon from its cache.</span></span> <span data-ttu-id="80da3-137">Para evitar la carga de un icono almacenado en caché, establezca la marca **Gil \_ DONTCACHE** en el parámetro *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="80da3-137">To prevent the loading of a cached icon, set the **GIL\_DONTCACHE** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="80da3-138">Si no se carga un icono almacenado en caché, el shell llama a [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) para solicitar el identificador de icono.</span><span class="sxs-lookup"><span data-stu-id="80da3-138">If a cached icon is not loaded, the Shell then calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) to request the icon handle.</span></span>

<span data-ttu-id="80da3-139">Si [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation)especifica un archivo e índice, se pasan a [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) en los parámetros *pszFile* y *nIconIndex* , respectivamente.</span><span class="sxs-lookup"><span data-stu-id="80da3-139">If a file and index were specified by [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), they are passed to [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) in the *pszFile* and *nIconIndex* parameters, respectively.</span></span> <span data-ttu-id="80da3-140">Si se proporciona un nombre de archivo, el controlador puede devolver S \_ false para que el shell Extraiga el icono.</span><span class="sxs-lookup"><span data-stu-id="80da3-140">If a file name is provided, your handler can return S\_FALSE to have the Shell extract the icon.</span></span> <span data-ttu-id="80da3-141">De lo contrario, el controlador debe extraer o producir iconos grandes y pequeños, y asignar sus identificadores de HICON a los parámetros *phiconLarge* y *phiconSmall* .</span><span class="sxs-lookup"><span data-stu-id="80da3-141">Otherwise, your handler must extract or otherwise produce large and small icons, and assign their HICON handles to the *phiconLarge* and *phiconSmall* parameters.</span></span> <span data-ttu-id="80da3-142">El shell agrega los iconos a su memoria caché para agilizar las llamadas posteriores al controlador.</span><span class="sxs-lookup"><span data-stu-id="80da3-142">The Shell adds the icons to its cache to expedite subsequent calls to the handler.</span></span>

### <a name="step-3-registering-icon-handlers"></a><span data-ttu-id="80da3-143">Paso 3: registrar controladores de iconos</span><span class="sxs-lookup"><span data-stu-id="80da3-143">Step 3: Registering Icon Handlers</span></span>

<span data-ttu-id="80da3-144">Al [registrar estáticamente un icono](icon.md) para un [tipo de archivo](fa-file-types.md), se crea una subclave **DefaultIcon** en el identificador de programa (ProgID) para el tipo de archivo.</span><span class="sxs-lookup"><span data-stu-id="80da3-144">When you [statically register an icon](icon.md) for a [file type](fa-file-types.md), you create a **DefaultIcon** subkey under the ProgID for the file type.</span></span> <span data-ttu-id="80da3-145">Su valor predeterminado se establece en el archivo que contiene el icono.</span><span class="sxs-lookup"><span data-stu-id="80da3-145">Its default value is set to the file that contains the icon.</span></span> <span data-ttu-id="80da3-146">Para registrar un controlador de iconos, debe tener todavía la subclave **DefaultIcon** , pero su valor predeterminado debe establecerse en "%1".</span><span class="sxs-lookup"><span data-stu-id="80da3-146">To register an icon handler, you must still have the **DefaultIcon** subkey, but its default value must be set to "%1".</span></span> <span data-ttu-id="80da3-147">Agregue una subclave **IconHandler** a la subclave **Shellex** de la subclave ProgID y establezca su valor predeterminado en la forma de cadena del GUID CLSID del controlador.</span><span class="sxs-lookup"><span data-stu-id="80da3-147">Add an **IconHandler** subkey to the **Shellex** subkey of the ProgID subkey, and set its default value to the string form of the handler's CLSID GUID.</span></span> <span data-ttu-id="80da3-148">Para obtener información general sobre cómo registrar controladores de extensión de Shell, vea [crear controladores de extensión de Shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="80da3-148">For a general discussion of how to register Shell extension handlers, see [Creating Shell Extension Handlers](handlers.md).</span></span>

<span data-ttu-id="80da3-149">En el ejemplo siguiente se modifica la entrada del registro desde la [Personalización de iconos](icon.md) para que el tipo de archivo. MYP ahora use un controlador de menú contextual en lugar de un icono definido estáticamente.</span><span class="sxs-lookup"><span data-stu-id="80da3-149">The following example modifies the registry entry from [Customizing Icons](icon.md) so that the .myp file type now uses a shortcut menu handler instead of a statically defined icon.</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = %1
      Shellex
         IconHandler
            (Default) = {The handler's CLSID GUID}
```

## <a name="related-topics"></a><span data-ttu-id="80da3-150">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="80da3-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="80da3-151">Creación de controladores de extensiones de shell</span><span class="sxs-lookup"><span data-stu-id="80da3-151">Creating Shell Extension Handlers</span></span>](handlers.md)
</dt> <dt>

[<span data-ttu-id="80da3-152">**IPersistFile**</span><span class="sxs-lookup"><span data-stu-id="80da3-152">**IPersistFile**</span></span>](/windows/win32/api/objidl/nn-objidl-ipersistfile)
</dt> <dt>

[<span data-ttu-id="80da3-153">**IExtractIcon**</span><span class="sxs-lookup"><span data-stu-id="80da3-153">**IExtractIcon**</span></span>](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona)
</dt> </dl>

 

 
