---
title: Instancias de controlador
description: Instancias de controlador
ms.assetid: 93dba9e8-bfb3-4714-9466-cf5c78babcf2
keywords:
- Controladores instalables, instancias
- Controladores instalables, varias instancias
- varias instancias de controlador
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37148dcb12fbfa2984d4e55424102b5985165d9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "103775126"
---
# <a name="driver-instances"></a><span data-ttu-id="61a07-106">Instancias de controlador</span><span class="sxs-lookup"><span data-stu-id="61a07-106">Driver Instances</span></span>

<span data-ttu-id="61a07-107">Windows permite varias instancias de un controlador instalable.</span><span class="sxs-lookup"><span data-stu-id="61a07-107">Windows allows for multiples instances of an installable driver.</span></span> <span data-ttu-id="61a07-108">El sistema crea una instancia del controlador cada vez que se abre el controlador y destruye la instancia cuando se cierra el controlador.</span><span class="sxs-lookup"><span data-stu-id="61a07-108">The system creates an instance of the driver each time the driver is opened and destroys the instance when the driver is closed.</span></span> <span data-ttu-id="61a07-109">Las instancias de controlador son especialmente útiles para los controladores instalables que admiten varios dispositivos o que se abren en varias aplicaciones o en la misma aplicación varias veces.</span><span class="sxs-lookup"><span data-stu-id="61a07-109">Driver instances are especially useful for installable drivers that support multiple devices or that are opened by multiple applications or by the same application multiple times.</span></span>

<span data-ttu-id="61a07-110">Para ayudar al controlador a realizar un seguimiento de las instancias, el sistema envía un identificador de instancia de controlador con cada mensaje de controlador una vez creada la instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-110">To help the driver keep track of the instances, the system sends a driver instance handle with each driver message after the instance has been created.</span></span> <span data-ttu-id="61a07-111">Dado que este identificador identifica de forma única la instancia, los controladores instalables a menudo asocian el identificador con la memoria y otros recursos que se han asignado específicamente para la instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-111">Because this handle uniquely identifies the instance, installable drivers often associate the handle with memory and other resources that they have specifically allocated for the instance.</span></span>

<span data-ttu-id="61a07-112">Cuando se abre la primera instancia, el sistema envía los mensajes de [**\_ carga DRV**](drv-load.md), [**DRV \_ enable**](drv-enable.md)y [**DRV \_ Open**](drv-open.md) al controlador en ese orden.</span><span class="sxs-lookup"><span data-stu-id="61a07-112">When the first instance is opened, the system sends the [**DRV\_LOAD**](drv-load.md), [**DRV\_ENABLE**](drv-enable.md), and [**DRV\_OPEN**](drv-open.md) messages to the driver in that order.</span></span> <span data-ttu-id="61a07-113">Los \_ mensajes DRV Load y DRV \_ enable notifican al controlador que ahora está en la memoria y están habilitados para su funcionamiento.</span><span class="sxs-lookup"><span data-stu-id="61a07-113">The DRV\_LOAD and DRV\_ENABLE messages notify the driver that it is now in memory and is enabled for operation.</span></span> <span data-ttu-id="61a07-114">El \_ mensaje abierto DRV identifica el identificador de instancia y puede incluir información de configuración de la instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-114">The DRV\_OPEN message identifies the instance handle and may include configuration information for the instance.</span></span> <span data-ttu-id="61a07-115">En cada apertura subsiguiente de una instancia del mismo controlador, el sistema solo envía un \_ mensaje abierto DRV.</span><span class="sxs-lookup"><span data-stu-id="61a07-115">On each subsequent opening of an instance of the same driver, the system sends only a DRV\_OPEN message.</span></span>

<span data-ttu-id="61a07-116">Al procesar un \_ mensaje de carga drv, un controlador normalmente Lee las opciones de configuración del registro, configura el controlador y cualquier hardware asociado y asigna memoria para el uso de todas las instancias del controlador.</span><span class="sxs-lookup"><span data-stu-id="61a07-116">When processing a DRV\_LOAD message, a driver typically reads configuration settings from the registry, configures the driver and any associated hardware, and allocates memory for use by all instances of the driver.</span></span> <span data-ttu-id="61a07-117">Si un controlador no puede completar la configuración o asignar memoria, devuelve cero para indicar al sistema que quite inmediatamente el controlador de la memoria y que no se envíen los mensajes posteriores.</span><span class="sxs-lookup"><span data-stu-id="61a07-117">If a driver cannot complete the configuration or allocate memory, it returns zero to direct the system to immediately remove the driver from memory and prevent any subsequent messages from being sent.</span></span> <span data-ttu-id="61a07-118">Al procesar el \_ mensaje de habilitación drv, el controlador prepara el hardware para recibir y procesar solicitudes de entrada y salida (e/s).</span><span class="sxs-lookup"><span data-stu-id="61a07-118">When processing the DRV\_ENABLE message, the driver prepares the hardware to receive and process input and output (I/O) requests.</span></span> <span data-ttu-id="61a07-119">La preparación puede incluir la instalación de controladores de interrupción.</span><span class="sxs-lookup"><span data-stu-id="61a07-119">The preparation may include installing interrupt handlers.</span></span>

<span data-ttu-id="61a07-120">Al procesar el \_ mensaje abierto drv, el controlador asigna la memoria o los recursos requeridos por la instancia determinada del controlador y, a continuación, devuelve un valor distinto de cero.</span><span class="sxs-lookup"><span data-stu-id="61a07-120">When processing the DRV\_OPEN message, the driver allocates memory or resources required by the given instance of the driver and then returns a nonzero value.</span></span> <span data-ttu-id="61a07-121">El sistema utiliza este valor distinto de cero como *identificador de controlador* en los mensajes de controlador posteriores para la instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-121">The system uses this nonzero value as the *driver identifier* in subsequent driver messages for the instance.</span></span> <span data-ttu-id="61a07-122">El controlador puede usar este identificador para cualquier propósito.</span><span class="sxs-lookup"><span data-stu-id="61a07-122">The driver can use this identifier for any purpose.</span></span> <span data-ttu-id="61a07-123">Por ejemplo, algunos controladores utilizan un identificador de memoria para el identificador con el fin de obtener un acceso rápido a la memoria que contiene información sobre la instancia determinada.</span><span class="sxs-lookup"><span data-stu-id="61a07-123">For example, some drivers use a memory handle for the identifier to gain quick access to memory containing information about the given instance.</span></span>

<span data-ttu-id="61a07-124">Muchos controladores instalables procesan el segundo parámetro del mensaje Open de DRV, lo que \_ permite al sistema y a las aplicaciones enviar información adicional al controlador al abrir una instancia de.</span><span class="sxs-lookup"><span data-stu-id="61a07-124">Many installable drivers process the second parameter of the DRV\_OPEN message, giving the system and applications the means to send additional information to the driver when opening an instance.</span></span> <span data-ttu-id="61a07-125">El parámetro puede ser un valor único o una dirección de una estructura que contenga un conjunto de valores.</span><span class="sxs-lookup"><span data-stu-id="61a07-125">The parameter can be a single value or an address of a structure containing a set of values.</span></span> <span data-ttu-id="61a07-126">Al procesar DRV \_ Open, el controlador comprueba el parámetro para determinar si es un valor y usa los valores especificados, si los hay, para completar la creación de la instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-126">When processing DRV\_OPEN, the driver checks the parameter to determine whether it is a value and uses the given values, if any, to complete the creation of the instance.</span></span>

<span data-ttu-id="61a07-127">El sistema envía un mensaje [**DRV \_ Close**](drv-close.md) cada vez que se cierra una instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-127">The system sends a [**DRV\_CLOSE**](drv-close.md) message each time an instance is closed.</span></span> <span data-ttu-id="61a07-128">El identificador de instancia enviado con el mensaje identifica la instancia que se va a cerrar.</span><span class="sxs-lookup"><span data-stu-id="61a07-128">The instance handle sent with the message identifies which instance to close.</span></span> <span data-ttu-id="61a07-129">Cuando se cierra la última instancia restante, el sistema envía los \_ mensajes DRV Close, [**DRV \_ Disable**](drv-disable.md)y [**DRV \_ Free**](drv-free.md) en ese orden.</span><span class="sxs-lookup"><span data-stu-id="61a07-129">When the last remaining instance is closed, the system sends the DRV\_CLOSE, [**DRV\_DISABLE**](drv-disable.md), and [**DRV\_FREE**](drv-free.md) messages in that order.</span></span> <span data-ttu-id="61a07-130">El \_ mensaje de cierre DRV dirige el controlador para cerrar la instancia, y los \_ mensajes DRV Disable y DRV \_ Free notifican al controlador que ahora está deshabilitado y se liberarán inmediatamente de la memoria.</span><span class="sxs-lookup"><span data-stu-id="61a07-130">The DRV\_CLOSE message directs the driver to close the instance, and the DRV\_DISABLE and DRV\_FREE messages notify the driver that it is now disabled and will be immediately freed from memory.</span></span>

<span data-ttu-id="61a07-131">Al procesar el \_ mensaje de cierre drv, el controlador libera normalmente cualquier memoria o recursos asignados a la instancia.</span><span class="sxs-lookup"><span data-stu-id="61a07-131">When processing the DRV\_CLOSE message, the driver typically frees any memory or resources allocated for the instance.</span></span> <span data-ttu-id="61a07-132">Al procesar el \_ mensaje DRV disable, el controlador coloca cualquier hardware en un estado inactivo, lo que puede incluir la eliminación de controladores de interrupción.</span><span class="sxs-lookup"><span data-stu-id="61a07-132">When processing the DRV\_DISABLE message, the driver places any hardware in an inactive state, which may include the removal of interrupt handlers.</span></span> <span data-ttu-id="61a07-133">Al procesar el mensaje de disponibilidad de DRV \_ , el controlador libera cualquier memoria o recursos que todavía estén asignados.</span><span class="sxs-lookup"><span data-stu-id="61a07-133">When processing the DRV\_FREE message, the driver frees any memory or resources that are still allocated.</span></span>

<span data-ttu-id="61a07-134">No es necesario que los controladores instalables admitan varias instancias.</span><span class="sxs-lookup"><span data-stu-id="61a07-134">Installable drivers are not required to support multiple instances.</span></span> <span data-ttu-id="61a07-135">Un controlador puede impedir que se cree cualquier instancia devolviendo cero para el [**mensaje \_ abierto DRV**](drv-open.md) .</span><span class="sxs-lookup"><span data-stu-id="61a07-135">A driver can prevent any instance from being created by returning zero for the [**DRV\_OPEN**](drv-open.md) message.</span></span>

 

 




