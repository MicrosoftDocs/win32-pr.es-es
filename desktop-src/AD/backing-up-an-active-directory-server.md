---
title: Copia de seguridad de un servidor Active Directory
description: Una copia de seguridad de Active Directory Server requiere que realice una copia de seguridad de la base de datos y los registros de transacciones. En este tema se proporciona un tutorial sobre cómo una aplicación de copia de seguridad hace una copia de seguridad del servicio de directorio de Active Directory.
ms.assetid: 250b2f40-6d43-4aa5-a588-b0cd4839828d
ms.tgt_platform: multiple
keywords:
- copia de seguridad de Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5affde952ee543afe1bb9b794cce074a74382aa7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/16/2019
ms.locfileid: "104075023"
---
# <a name="backing-up-an-active-directory-server"></a><span data-ttu-id="07c93-105">Copia de seguridad de un servidor Active Directory</span><span class="sxs-lookup"><span data-stu-id="07c93-105">Backing Up an Active Directory Server</span></span>

<span data-ttu-id="07c93-106">Una copia de seguridad de Active Directory Server requiere que realice una copia de seguridad de la base de datos y los registros de transacciones.</span><span class="sxs-lookup"><span data-stu-id="07c93-106">An Active Directory server backup requires you to back up the database and the transaction logs.</span></span> <span data-ttu-id="07c93-107">En este tema se proporciona un tutorial sobre cómo una aplicación de copia de seguridad hace una copia de seguridad del servicio de directorio de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="07c93-107">This topic provides a walkthrough of how a backup application backs up the Active Directory directory service.</span></span>

<span data-ttu-id="07c93-108">El autor de la llamada de estas funciones de copia de seguridad debe tener el privilegio de **\_ \_ nombre de copia de seguridad** de.</span><span class="sxs-lookup"><span data-stu-id="07c93-108">The caller of these backup functions must have the **SE\_BACKUP\_NAME** privilege.</span></span> <span data-ttu-id="07c93-109">Puede usar la función [**DsSetAuthIdentity**](dssetauthidentity.md) para establecer el contexto de seguridad en el que se llama a las funciones de copia de seguridad y restauración de directorios.</span><span class="sxs-lookup"><span data-stu-id="07c93-109">You can use the [**DsSetAuthIdentity**](dssetauthidentity.md) function to set the security context under which the directory backup/restore functions are called.</span></span>

<span data-ttu-id="07c93-110">**Para realizar una copia de seguridad de un servidor de Active Directory, realice los pasos siguientes:**</span><span class="sxs-lookup"><span data-stu-id="07c93-110">**To backup an Active Directory server, perform the following steps**</span></span>

1.  <span data-ttu-id="07c93-111">Llame a la función [**DsIsNTDSOnline**](dsisntdsonline.md) para determinar si Active Directory Domain Services se están ejecutando.</span><span class="sxs-lookup"><span data-stu-id="07c93-111">Call the [**DsIsNTDSOnline**](dsisntdsonline.md) function to determine if Active Directory Domain Services are running.</span></span>
2.  <span data-ttu-id="07c93-112">Si Active Directory Domain Services se están ejecutando, llame a la función [**DsBackupPrepare**](dsbackupprepare.md) para inicializar un identificador de contexto de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="07c93-112">If Active Directory Domain Services are running, call the [**DsBackupPrepare**](dsbackupprepare.md) function to initialize a backup context handle.</span></span> <span data-ttu-id="07c93-113">Si Active Directory Domain Services no se están ejecutando, no se puede realizar una copia de seguridad y la aplicación de copia de seguridad no debe realizar la operación de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="07c93-113">If Active Directory Domain Services are not running, it cannot be backed up and the backup application must fail the backup operation.</span></span>
3.  <span data-ttu-id="07c93-114">Llame a la función [**DsBackupGetDatabaseNames**](dsbackupgetdatabasenames.md) para obtener una lista de archivos de los que se va a realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="07c93-114">Call the [**DsBackupGetDatabaseNames**](dsbackupgetdatabasenames.md) function to get a list of files to back up.</span></span> <span data-ttu-id="07c93-115">Para liberar la memoria devuelta por esta función, llame a la función [**DsBackupFree**](dsbackupfree.md) .</span><span class="sxs-lookup"><span data-stu-id="07c93-115">To release the memory returned by this function, call the [**DsBackupFree**](dsbackupfree.md) function.</span></span>
4.  <span data-ttu-id="07c93-116">Para cada nombre de la lista de archivos devuelta, llame a la función [**DsBackupOpenFile**](dsbackupopenfile.md) seguida de llamadas repetidas a la función [**DsBackupRead**](dsbackupread.md) hasta que se haya leído todo el archivo.</span><span class="sxs-lookup"><span data-stu-id="07c93-116">For each name in the returned list of files, call the [**DsBackupOpenFile**](dsbackupopenfile.md) function followed by repeated calls to the [**DsBackupRead**](dsbackupread.md) function until the entire file has been read.</span></span> <span data-ttu-id="07c93-117">Cuando haya terminado de leer el archivo, llame a la función [**DsBackupClose**](dsbackupclose.md) para cerrarlo.</span><span class="sxs-lookup"><span data-stu-id="07c93-117">When you have finished reading the file, call the [**DsBackupClose**](dsbackupclose.md) function to close it.</span></span>
5.  <span data-ttu-id="07c93-118">Una vez que haya realizado una copia de seguridad de todos los archivos de base de datos, llame a la función [**DsBackupGetBackupLogs**](dsbackupgetbackuplogs.md) para obtener una lista de registros de transacciones.</span><span class="sxs-lookup"><span data-stu-id="07c93-118">After all database files are backed up, call the [**DsBackupGetBackupLogs**](dsbackupgetbackuplogs.md) function to get a list of transaction logs.</span></span> <span data-ttu-id="07c93-119">Esta lista se trata como la lista de archivos de base de datos.</span><span class="sxs-lookup"><span data-stu-id="07c93-119">This list is handled just like the list of database files.</span></span>
6.  <span data-ttu-id="07c93-120">Cuando haya terminado de realizar la copia de seguridad del registro de transacciones, llame a la función [**DsBackupTruncateLogs**](dsbackuptruncatelogs.md) para eliminar todos los registros de transacciones confirmados de los que se realizó una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="07c93-120">When you have finished backing up the transaction log, call the [**DsBackupTruncateLogs**](dsbackuptruncatelogs.md) function to delete all committed transaction logs that were backed up.</span></span>
7.  <span data-ttu-id="07c93-121">Guarde el contenido del token de expiración proporcionado por la función [**DsBackupPrepare**](dsbackupprepare.md) .</span><span class="sxs-lookup"><span data-stu-id="07c93-121">Save the contents of the expiry token provided by the [**DsBackupPrepare**](dsbackupprepare.md) function.</span></span> <span data-ttu-id="07c93-122">Se puede guardar en un archivo o en otra memoria persistente.</span><span class="sxs-lookup"><span data-stu-id="07c93-122">This can be saved in a file or some other persistent memory.</span></span> <span data-ttu-id="07c93-123">Este token se debe pasar a la función [**DsRestorePrepare**](dsrestoreprepare.md) para iniciar una operación de restauración.</span><span class="sxs-lookup"><span data-stu-id="07c93-123">This token must be passed to the [**DsRestorePrepare**](dsrestoreprepare.md) function to initiate a restore operation.</span></span>
8.  <span data-ttu-id="07c93-124">Libere la memoria para el token de expiración pasando el puntero de token a la función [**DsBackupFree**](dsbackupfree.md) .</span><span class="sxs-lookup"><span data-stu-id="07c93-124">Free the memory for the expiry token by passing the token pointer to the [**DsBackupFree**](dsbackupfree.md) function.</span></span>
9.  <span data-ttu-id="07c93-125">Por último, llame a la función [**DsBackupEnd**](dsbackupend.md) para liberar todos los recursos asociados al identificador de contexto de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="07c93-125">Finally, call the [**DsBackupEnd**](dsbackupend.md) function to release all resources associated with the backup context handle.</span></span>

 

 




