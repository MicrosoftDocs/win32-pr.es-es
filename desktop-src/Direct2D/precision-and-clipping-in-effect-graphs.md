---
title: Recorte numérico y de precisión en gráficos de efectos
description: Las aplicaciones que representan efectos mediante Direct2D deben tener cuidado para lograr el nivel deseado de calidad y previsibilidad con respecto a la precisión numérica.
ms.assetid: 6fd1d77f-e613-534f-3205-bad11fa24c30
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 90628661ec8cd3f16ff6a6149aecbb7e8be3e5a9
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/20/2020
ms.locfileid: "104078208"
---
# <a name="precision-and-numerical-clipping-in-effect-graphs"></a><span data-ttu-id="fdcd8-103">Recorte numérico y de precisión en gráficos de efectos</span><span class="sxs-lookup"><span data-stu-id="fdcd8-103">Precision and numerical clipping in effect graphs</span></span>

<span data-ttu-id="fdcd8-104">Las aplicaciones que representan efectos mediante Direct2D deben tener cuidado para lograr el nivel deseado de calidad y previsibilidad con respecto a la precisión numérica.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-104">Applications that render effects using Direct2D must take care to achieve the desired level of quality and predictability with respect to numerical precision.</span></span> <span data-ttu-id="fdcd8-105">En este tema se describen los procedimientos recomendados y los valores relevantes en Direct2D que son útiles si:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-105">This topic describes best practices and relevant settings in Direct2D which are useful if:</span></span>

-   <span data-ttu-id="fdcd8-106">El gráfico de efectos depende de una precisión numérica alta o de colores fuera del \[ intervalo de 0, 1 y desea asegurarse de que \] siempre estarán disponibles.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-106">Your effect graph relies on high numerical precision or colors outside of the \[0, 1\] range, and you want to make sure these will always be available</span></span>
-   <span data-ttu-id="fdcd8-107">O bien, el gráfico de efectos se basa en la implementación de representación para fijar los colores intermedios en el \[ intervalo de 0, 1 \] y desea asegurarse de que esta fijación siempre se produce</span><span class="sxs-lookup"><span data-stu-id="fdcd8-107">Or, your effect graph relies on the rendering implementation to clamp intermediate colors to the \[0, 1\] range, and you want to ensure this clamping always occurs</span></span>

<span data-ttu-id="fdcd8-108">A menudo, Direct2D divide un gráfico de efectos en secciones y representa cada sección en un paso independiente.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-108">Direct2D often divides an effect graph into sections, and renders each section in a separate step.</span></span> <span data-ttu-id="fdcd8-109">El resultado de algunos pasos puede almacenarse en texturas de Direct3D intermedias que, de forma predeterminada, tienen un intervalo numérico y una precisión limitados.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-109">The output of some steps may be stored in intermediate Direct3D textures which by default have limited numerical range and precision.</span></span> <span data-ttu-id="fdcd8-110">Direct2D no ofrece ninguna garantía sobre si se usan estas texturas intermedias.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-110">Direct2D makes no guarantees about if or where these intermediate textures are used.</span></span> <span data-ttu-id="fdcd8-111">Este comportamiento puede variar según las funcionalidades de GPU, así como entre las versiones de Windows.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-111">This behavior may vary according to GPU capabilities as well as between Windows versions.</span></span>

<span data-ttu-id="fdcd8-112">En Windows 10, Direct2D usa menos texturas intermedias debido a su uso de la vinculación del sombreador.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-112">In Windows 10, Direct2D uses fewer intermediate textures due to its use of shader linking.</span></span> <span data-ttu-id="fdcd8-113">Por tanto, Direct2D puede generar resultados diferentes con la configuración predeterminada que en versiones anteriores de Windows.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-113">Direct2D may therefore produce different results with default settings than in prior Windows releases.</span></span> <span data-ttu-id="fdcd8-114">Esto afecta principalmente a escenarios en los que la vinculación del sombreador es posible en un gráfico de efectos y ese grafo también contiene efectos que generan colores de salida de intervalo extendido.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-114">This primarily affects scenarios where shader linking is possible in an effect graph, and that graph also contains effects that produce extended-range output colors.</span></span>

## <a name="overview-of-effect-rendering-and-intermediates"></a><span data-ttu-id="fdcd8-115">Información general sobre la representación de efectos e intermedios</span><span class="sxs-lookup"><span data-stu-id="fdcd8-115">Overview of effect rendering and intermediates</span></span>

<span data-ttu-id="fdcd8-116">Para representar un gráfico de efectos, Direct2D busca primero el gráfico subyacente de "transformaciones", donde una transformación es un nodo de gráfico que se usa dentro de un efecto.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-116">To render an effect graph, Direct2D first finds the underlying graph of “transforms,” where a transform is a graph node used within an effect.</span></span> <span data-ttu-id="fdcd8-117">Hay diferentes tipos de transformaciones, incluidas las que proporcionan sombreadores de Direct3D para que Direct2D los use.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-117">There are different types of transforms, including those which provide Direct3D shaders for Direct2D to use.</span></span>

<span data-ttu-id="fdcd8-118">Por ejemplo, Direct2D puede representar un gráfico de efectos de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-118">For example, Direct2D may render an effect graph as follows:</span></span>

![gráfico de efectos con texturas intermedias](images/precision-and-clipping-1.png)

<span data-ttu-id="fdcd8-120">Direct2D busca oportunidades para reducir el número de texturas intermedias que se usan para representar el gráfico de efectos. esta lógica es opaca para las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-120">Direct2D looks for opportunities to reduce the number intermediate textures used to render the effect graph; this logic is opaque to applications.</span></span> <span data-ttu-id="fdcd8-121">Por ejemplo, Direct2D puede representar el siguiente gráfico mediante una llamada a Draw de Direct3D y sin texturas intermedias:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-121">For example, the following graph can be rendered by Direct2D using one Direct3D draw call and no intermediate textures:</span></span>

![gráfico de efecto sin texturas intermedias](images/precision-and-clipping-2.png)

<span data-ttu-id="fdcd8-123">Antes de Windows 10, Direct2D siempre usaría texturas intermedias si se usaran varios sombreadores de píxeles en el mismo gráfico de efectos.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-123">Prior to Windows 10, Direct2D would always use intermediate textures if multiple pixels shaders were used within the same effect graph.</span></span> <span data-ttu-id="fdcd8-124">La mayoría de los efectos integrados que solo ajustan los valores de color (por ejemplo, brillo o saturación) lo hacen mediante sombreadores de píxeles.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-124">Most built-in effects that simply adjust color values (for example, Brightness or Saturation) do so using pixel shaders.</span></span>

<span data-ttu-id="fdcd8-125">En Windows 10, Direct2D ahora puede evitar el uso de texturas intermedias en estos casos.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-125">In Windows 10, Direct2D may now avoid using intermediate textures in such cases.</span></span> <span data-ttu-id="fdcd8-126">Para ello, vincula internamente los sombreadores de píxeles adyacentes.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-126">It does this by internally linking adjacent pixel shaders.</span></span> <span data-ttu-id="fdcd8-127">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-127">For example:</span></span>

![gráfico de efectos de Windows 10 con varios sombreadores de píxeles y sin texturas intermedias](images/precision-and-clipping-3.png)

<span data-ttu-id="fdcd8-129">Tenga en cuenta que no todos los sombreadores de píxeles adyacentes de un gráfico se pueden vincular entre sí y, por lo tanto, solo ciertos gráficos generarán una salida diferente en Windows 10.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-129">Note that not all adjacent pixel shaders in a graph may be linked together, and therefore only certain graphs will produce different output on Windows 10.</span></span> <span data-ttu-id="fdcd8-130">Para obtener detalles completos, consulte [vinculación del sombreador de efectos](effect-shader-linking.md).</span><span class="sxs-lookup"><span data-stu-id="fdcd8-130">For full details see [Effect Shader Linking](effect-shader-linking.md).</span></span> <span data-ttu-id="fdcd8-131">Las restricciones principales son:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-131">The primary restrictions are:</span></span>

-   <span data-ttu-id="fdcd8-132">Un efecto no se vinculará con efectos que consuman su salida, si el primer efecto está conectado como una entrada a varios efectos.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-132">An effect will not be linked with effects consuming its output, if the first effect is connected as an input to multiple effects.</span></span>
-   <span data-ttu-id="fdcd8-133">Un efecto no se vinculará con un conjunto de efectos como entrada, si el primer efecto muestrea su entrada en una posición lógica diferente de la salida.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-133">An effect will not be linked with an effect set as its input, if the first effect samples its input at a different logical position than its output.</span></span> <span data-ttu-id="fdcd8-134">Por ejemplo, un efecto de la matriz de colores podría estar vinculado a su entrada, pero un efecto de circunvolución no será.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-134">For example, a Color Matrix effect might be linked with its input, but a Convolution effect will not be.</span></span>

## <a name="built-in-effect-behavior"></a><span data-ttu-id="fdcd8-135">Comportamiento de efectos integrados</span><span class="sxs-lookup"><span data-stu-id="fdcd8-135">Built-in effect behavior</span></span>

<span data-ttu-id="fdcd8-136">Muchos efectos integrados pueden producir colores fuera del \[ intervalo de 0, 1 \] en el espacio de colores unpremultiplied, incluso cuando sus colores de entrada están dentro de ese intervalo.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-136">Many built-in effects may produce colors outside of the \[0, 1\] range in the unpremultiplied color space, even when their input colors are within that range.</span></span> <span data-ttu-id="fdcd8-137">Cuando esto sucede, estos colores pueden estar sujetos al recorte numérico.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-137">When this happens, such colors may be subject to numerical clipping.</span></span> <span data-ttu-id="fdcd8-138">Tenga en cuenta que es importante tener en cuenta el intervalo de colores en el espacio de unpremultiplied, aunque los efectos integrados normalmente generan colores en el espacio premultiplicado.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-138">Note that it’s important to consider the color range in unpremultiplied space, even though built-in effects typically produce colors in premultiplied space.</span></span> <span data-ttu-id="fdcd8-139">Esto garantiza que los colores permanecen dentro del alcance, incluso si otros efectos unpremultiply posteriormente.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-139">This ensures that colors stay within range, even if other effects subsequently unpremultiply them.</span></span>

<span data-ttu-id="fdcd8-140">Algunos de los efectos que pueden emitir estos colores fuera del intervalo ofrecen una propiedad "ClampOutput".</span><span class="sxs-lookup"><span data-stu-id="fdcd8-140">Some of the effects which may emit these out-of-range colors offer a “ClampOutput” property.</span></span> <span data-ttu-id="fdcd8-141">Entre ellas se incluyen las siguientes:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-141">These include:</span></span>

-   [<span data-ttu-id="fdcd8-142">Matriz de colores</span><span class="sxs-lookup"><span data-stu-id="fdcd8-142">Color Matrix</span></span>](color-matrix.md)
-   [<span data-ttu-id="fdcd8-143">Compuesto aritmético</span><span class="sxs-lookup"><span data-stu-id="fdcd8-143">Arithmetic Composite</span></span>](arithmetic-composite.md)
-   [<span data-ttu-id="fdcd8-144">Convolve</span><span class="sxs-lookup"><span data-stu-id="fdcd8-144">Convolve</span></span>](convolve-matrix.md)
-   [<span data-ttu-id="fdcd8-145">Efectos de transferencia</span><span class="sxs-lookup"><span data-stu-id="fdcd8-145">Transfer effects</span></span>](built-in-effects.md)

<span data-ttu-id="fdcd8-146">El establecimiento de la propiedad ClampOutput en TRUE en estos efectos garantiza que se logre un resultado coherente, independientemente de factores como la vinculación del sombreador.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-146">Setting the ClampOutput property to TRUE on these effects ensures a consistent result will be achieved regardless of factors such as shader linking.</span></span> <span data-ttu-id="fdcd8-147">Tenga en cuenta que la compresión se produce en el espacio de unpremultiplied.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-147">Note that clamping occurs in unpremultiplied space.</span></span>

<span data-ttu-id="fdcd8-148">Otros efectos integrados también pueden producir colores de salida más allá del \[ intervalo de 0, 1 \] en el espacio de unpremultiplied, incluso cuando sus colores son píxeles (y propiedades de "color", si los hay) dentro de ese intervalo.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-148">Other built-in effects may also produce output colors beyond the \[0, 1\] range in unpremultiplied space, even when their colors pixels (and “Color” properties if any) are within that range.</span></span> <span data-ttu-id="fdcd8-149">Entre ellas se incluyen las siguientes:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-149">These include:</span></span>

-   <span data-ttu-id="fdcd8-150">[Transformación y escalado de efectos](built-in-effects.md) (cuando la propiedad modo de interpolación es cúbica o cúbica de alta calidad)</span><span class="sxs-lookup"><span data-stu-id="fdcd8-150">[Transforming and Scaling effects](built-in-effects.md) (When the Interpolation Mode property is Cubic or High Quality Cubic)</span></span>
-   [<span data-ttu-id="fdcd8-151">Efectos de iluminación</span><span class="sxs-lookup"><span data-stu-id="fdcd8-151">Lighting effects</span></span>](built-in-effects.md)
-   <span data-ttu-id="fdcd8-152">[Detección perimetral](edge-detection-effect.md) (cuando la propiedad bordes superpuesto es true)</span><span class="sxs-lookup"><span data-stu-id="fdcd8-152">[Edge detection](edge-detection-effect.md) (When the Overlay Edges property is TRUE)</span></span>
-   [<span data-ttu-id="fdcd8-153">Exposiciones</span><span class="sxs-lookup"><span data-stu-id="fdcd8-153">Exposure</span></span>](exposure-effect.md)
-   <span data-ttu-id="fdcd8-154">[Composite](composite.md) (cuando la propiedad de modo es Plus)</span><span class="sxs-lookup"><span data-stu-id="fdcd8-154">[Composite](composite.md) (When the Mode property is Plus)</span></span>
-   [<span data-ttu-id="fdcd8-155">Temperatura y matiz</span><span class="sxs-lookup"><span data-stu-id="fdcd8-155">Temperature and Tint</span></span>](temperature-and-tint-effect.md)
-   [<span data-ttu-id="fdcd8-156">Sepia</span><span class="sxs-lookup"><span data-stu-id="fdcd8-156">Sepia</span></span>](sepia-effect.md)
-   [<span data-ttu-id="fdcd8-157">Saturación</span><span class="sxs-lookup"><span data-stu-id="fdcd8-157">Saturation</span></span>](saturation.md)

## <a name="forcing-numerical-clipping-within-an-effect-graph"></a><span data-ttu-id="fdcd8-158">Forzar el recorte numérico dentro de un gráfico de efectos</span><span class="sxs-lookup"><span data-stu-id="fdcd8-158">Forcing numerical clipping within an effect graph</span></span>

<span data-ttu-id="fdcd8-159">Aunque el uso de los efectos mostrados anteriormente no tienen una propiedad ClampOutput, las aplicaciones deben considerar la posibilidad de aplicar la fijación numérica.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-159">While using effects listed above which do not have a ClampOutput property, applications should consider forcing numerical clamping.</span></span> <span data-ttu-id="fdcd8-160">Esto se puede hacer insertando un efecto adicional en el gráfico que corsujete sus píxeles.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-160">This can be done by inserting an additional effect into the graph that clamps its pixels.</span></span> <span data-ttu-id="fdcd8-161">Se puede usar un efecto de matriz de colores, con su propiedad ' ClampOutput ' establecida en TRUE y saliendo de la propiedad ' ColorMatrix ' como valor predeterminado (de paso a través).</span><span class="sxs-lookup"><span data-stu-id="fdcd8-161">A Color Matrix effect may be used, with its ‘ClampOutput’ property set to TRUE and leaving the ‘ColorMatrix’ property as the default (pass-through) value.</span></span>

<span data-ttu-id="fdcd8-162">Una segunda opción para lograr resultados coherentes es solicitar que Direct2D use texturas intermedias con mayor precisión.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-162">A second option to achieve consistent results is to request that Direct2D use intermediate textures which have greater precision.</span></span> <span data-ttu-id="fdcd8-163">Esto se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-163">This is described below.</span></span>

## <a name="controlling-precision-of-intermediate-textures"></a><span data-ttu-id="fdcd8-164">Controlar la precisión de las texturas intermedias</span><span class="sxs-lookup"><span data-stu-id="fdcd8-164">Controlling precision of intermediate textures</span></span>

<span data-ttu-id="fdcd8-165">Direct2D proporciona varias maneras de controlar la precisión de un gráfico.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-165">Direct2D provides a few ways to control the precision of a graph.</span></span> <span data-ttu-id="fdcd8-166">Antes de usar los formatos de alta precisión en Direct2D, las aplicaciones deben asegurarse de que son suficientemente compatibles con la GPU.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-166">Before using high precision formats in Direct2D, applications must ensure they are supported sufficiently by the GPU.</span></span> <span data-ttu-id="fdcd8-167">Para comprobarlo, use [**ID2D1DeviceContext:: IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span><span class="sxs-lookup"><span data-stu-id="fdcd8-167">To check this, use [**ID2D1DeviceContext::IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span></span>

<span data-ttu-id="fdcd8-168">Las aplicaciones pueden crear un dispositivo Direct3D mediante WARP (emulación de software) para garantizar que todas las precisiones de búfer se admiten independientemente del hardware de GPU real en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-168">Applications may create a Direct3D device using WARP (software emulation) to guarantee that all buffer precisions are supported independent of the actual GPU hardware on the device.</span></span> <span data-ttu-id="fdcd8-169">Esto se recomienda en escenarios como aplicar efectos a una fotografía mientras se guardan en el disco.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-169">This is recommended in scenarios such as applying effects to a photo while saving to disk.</span></span> <span data-ttu-id="fdcd8-170">Aunque Direct2D admita formatos de búfer de alta precisión en la GPU, se recomienda usar WARP en este escenario en GPU de nivel de característica 9. X, debido a la precisión limitada de la aritmética del sombreador y el muestreo en algunas GPU móviles de baja energía.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-170">Even if Direct2D supports high precision buffer formats on the GPU, using WARP is recommended in this scenario on feature level 9.X GPUs, due to the limited precision of shader arithmetic and sampling on some low-power mobile GPUs.</span></span>

<span data-ttu-id="fdcd8-171">En cada caso siguiente, la precisión solicitada es realmente la precisión mínima que usará Direct2D.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-171">In each case below, the requested precision is actually the minimum precision Direct2D will use.</span></span> <span data-ttu-id="fdcd8-172">Se puede usar una precisión mayor si no se requieren intermedios.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-172">Higher precision may be used if intermediates are not required.</span></span> <span data-ttu-id="fdcd8-173">Direct2D también puede compartir texturas intermedias para distintas partes del mismo gráfico o de gráficos diferentes.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-173">Direct2D may also share intermediate textures for different parts of the same graph or different graphs entirely.</span></span> <span data-ttu-id="fdcd8-174">En este caso, Direct2D usa la precisión máxima solicitada para todas las operaciones implicadas.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-174">In this case Direct2D uses the maximum precision requested for all involved operations.</span></span>

### <a name="precision-selection-from-id2d1devicecontextsetrenderingcontrols"></a><span data-ttu-id="fdcd8-175">Selección de precisión desde ID2D1DeviceContext:: SetRenderingControls</span><span class="sxs-lookup"><span data-stu-id="fdcd8-175">Precision selection from ID2D1DeviceContext::SetRenderingControls</span></span>

<span data-ttu-id="fdcd8-176">La manera más sencilla de controlar la precisión de las texturas intermedias de Direct2d es usar [**ID2D1DeviceContext:: SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span><span class="sxs-lookup"><span data-stu-id="fdcd8-176">The simplest way to control the precision of Direct2D’s intermediate textures is to use [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span></span> <span data-ttu-id="fdcd8-177">Controla la precisión de todas las texturas intermedias, siempre que una precisión no se establezca también manualmente en efectos o transformaciones directamente.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-177">This controls the precision of all intermediate textures, as long as a precision is not also set manually on effects or transforms directly.</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  // Get the current rendering controls
  D2D1_RENDERING_CONTROLS renderingControls = {};
  Context->GetRenderingControls(&renderingControls);

  // Switch the precision within the rendering controls and set it
  renderingControls.bufferPrecision = D2D1_BUFFER_PRECISION_32BPC_FLOAT;
  Context->SetRenderingControls(&renderingControls);
}
              
```



### <a name="precision-selection-from-inputs-and-render-targets"></a><span data-ttu-id="fdcd8-178">Selección de precisión de destinos de entrada y representación</span><span class="sxs-lookup"><span data-stu-id="fdcd8-178">Precision selection from inputs and render targets</span></span>

<span data-ttu-id="fdcd8-179">Las aplicaciones también pueden basarse en la precisión de las entradas en un gráfico de efectos para controlar la precisión de las texturas intermedias.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-179">Applications may also rely on the precision of the inputs to an effect graph to control the precision of intermediate textures.</span></span> <span data-ttu-id="fdcd8-180">Esto es así siempre que no se especifique una precisión de búfer mediante [**ID2D1DeviceContext:: SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls))y no se establezca manualmente en efectos y transformación directamente.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-180">This is true as long as a buffer precision is not specified using [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)), and is not set manually on effects and transform directly.</span></span>

<span data-ttu-id="fdcd8-181">Las precisiones de las entradas a efectos se propagan a través del gráfico para seleccionar la precisión de los intermedios de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-181">The precisions of inputs to effects are propagated through the graph to select the precision of downstream intermediates.</span></span> <span data-ttu-id="fdcd8-182">Cuando se cumplen las distintas ramas del gráfico de efectos, se usa la mayor precisión de cualquier entrada.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-182">Where different branches in the effect graph meet, the greatest precision of any input is used.</span></span>

<span data-ttu-id="fdcd8-183">La precisión seleccionada en función de un mapa de bits de Direct2D se determina a partir de su formato de píxel.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-183">The precision selected based on a Direct2D bitmap is determined from its pixel format.</span></span> <span data-ttu-id="fdcd8-184">La precisión seleccionada para un [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) se determina a partir del formato de píxel de WIC del IWICBitmapSource subyacente que se usa para crear el **ID2D1ImageSource**.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-184">The precision selected for an [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) is determined from the WIC pixel format of the underlying IWICBitmapSource used to create the **ID2D1ImageSource**.</span></span> <span data-ttu-id="fdcd8-185">Tenga en cuenta que Direct2D no permite la creación de orígenes de imagen con orígenes de WIC mediante el uso de precisión no compatible con Direct2D y la GPU.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-185">Note that Direct2D doesn’t allow image sources to be created with WIC sources using precisions unsupported by Direct2D and the GPU.</span></span>

<span data-ttu-id="fdcd8-186">Es posible que Direct2D no pueda asignar un efecto a una precisión en función de sus entradas.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-186">It is possible that Direct2D cannot assign an effect a precision based on its inputs.</span></span> <span data-ttu-id="fdcd8-187">Esto sucede cuando un efecto no tiene ninguna entrada o cuando se usa un [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) , que no tiene ninguna precisión específica.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-187">This happens when an effect has no inputs, or when an [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) is used, which has no specific precision.</span></span> <span data-ttu-id="fdcd8-188">En este caso, la precisión de las texturas intermedias se determina a partir del conjunto de mapas de bits como destino de representación actual del contexto.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-188">In this case, the precision of intermediate textures is determined from the bitmap set as the context’s current render target.</span></span>

### <a name="precision-selection-directly-on-the-effect-and-transforms"></a><span data-ttu-id="fdcd8-189">Selección de precisión directamente en el efecto y las transformaciones</span><span class="sxs-lookup"><span data-stu-id="fdcd8-189">Precision selection directly on the effect and transforms</span></span>

<span data-ttu-id="fdcd8-190">La precisión mínima para las texturas intermedias también se puede establecer en ubicaciones explícitas dentro de un gráfico de efectos.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-190">The minimum precision for intermediate textures may also be set at explicit locations within an effect graph.</span></span> <span data-ttu-id="fdcd8-191">Esto solo se recomienda para escenarios avanzados.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-191">This is only recommended for advanced scenarios.</span></span>

<span data-ttu-id="fdcd8-192">La precisión mínima se puede establecer mediante una propiedad en un efecto como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-192">The minimum precision may be set using a property on an effect as follows:</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = Effect->SetValue(D2D1_PROPERTY_PRECISION, D2D1_BUFFER_PRECISION_32BPC_FLOAT);
}
              
```



<span data-ttu-id="fdcd8-193">Dentro de una implementación de efecto, la precisión mínima se puede establecer mediante ID2D1RenderInfo:: SetOutputPrecision de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-193">Within an effect implementation, the minimum precision may be set using ID2D1RenderInfo::SetOutputPrecision as follows:</span></span>


```cpp
if (EffectContext->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = RenderInfo->SetOutputBuffer(
  D2D1_BUFFER_PRECISION_32BPC_FLOAT,
  D2D1_CHANNEL_DEPTH_4);
}
              
```



<span data-ttu-id="fdcd8-194">Tenga en cuenta que el conjunto de precisión de un efecto se propagará a efectos descendentes en el mismo gráfico de efecto, a menos que se establezca una precisión diferente en esos efectos de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-194">Note that the precision set on an effect will propagate to downstream effects in the same effect graph, unless a different precision is set on those downstream effects.</span></span> <span data-ttu-id="fdcd8-195">La precisión establecida en una transformación dentro de un efecto no afecta a la precisión de los nodos de transformación de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="fdcd8-195">The precision set on a transform within an effect does not affect the precision for downstream transform nodes.</span></span>

<span data-ttu-id="fdcd8-196">A continuación se muestra la lógica recursiva completa que se usa para determinar la precisión mínima de un búfer intermedio que almacena la salida de un nodo de transformación determinado:</span><span class="sxs-lookup"><span data-stu-id="fdcd8-196">Below is the full recursive logic used to determine the minimum precision for an intermediate buffer storing the output of a given transform node:</span></span>

![Lógica de precisión mínima de búfer intermedio](images/precision-and-clipping-4.png)

 

 