---
description: En este tema se describe cómo los objetos de canalización personalizados pueden admitir velocidades de reproducción variables, incluida la reproducción inversa. Para obtener información sobre el uso del control de tasa desde una aplicación, vea Rate (control).
ms.assetid: 077678db-ca5a-423b-9430-93497113d639
title: Control de tasa de implementación
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5fd78cbbb95316a0d4ed12a50c9d3aa8954fe8a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104083036"
---
# <a name="implementing-rate-control"></a><span data-ttu-id="bac1f-104">Control de tasa de implementación</span><span class="sxs-lookup"><span data-stu-id="bac1f-104">Implementing Rate Control</span></span>

<span data-ttu-id="bac1f-105">En este tema se describe cómo los objetos de canalización personalizados pueden admitir velocidades de reproducción variables, incluida la reproducción inversa.</span><span class="sxs-lookup"><span data-stu-id="bac1f-105">This topic describes how custom pipeline objects can support variable playback rates, including reverse playback.</span></span> <span data-ttu-id="bac1f-106">Para obtener información sobre el uso del control de tasa desde una aplicación, vea [Rate (control](rate-control.md)).</span><span class="sxs-lookup"><span data-stu-id="bac1f-106">For information about using rate control from an application, see [Rate Control](rate-control.md).</span></span>

<span data-ttu-id="bac1f-107">Este tema contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="bac1f-107">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="bac1f-108">Orígenes multimedia</span><span class="sxs-lookup"><span data-stu-id="bac1f-108">Media Sources</span></span>](#media-sources)
-   [<span data-ttu-id="bac1f-109">Media Foundation transformaciones</span><span class="sxs-lookup"><span data-stu-id="bac1f-109">Media Foundation Transforms</span></span>](#media-foundation-transforms)
    -   [<span data-ttu-id="bac1f-110">Reproducción inversa</span><span class="sxs-lookup"><span data-stu-id="bac1f-110">Reverse Playback</span></span>](#reverse-playback)
-   [<span data-ttu-id="bac1f-111">Receptores de medios</span><span class="sxs-lookup"><span data-stu-id="bac1f-111">Media Sinks</span></span>](#media-sinks)
-   [<span data-ttu-id="bac1f-112">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="bac1f-112">Related topics</span></span>](#related-topics)

<span data-ttu-id="bac1f-113">Si está escribiendo un objeto de canalización de Microsoft Media Foundation (un origen multimedia, una transformación o un receptor multimedia), es posible que necesite admitir velocidades de reproducción variables.</span><span class="sxs-lookup"><span data-stu-id="bac1f-113">If you are writing a Microsoft Media Foundation pipeline object (a media source, transform, or media sink), you might need to support variable playback rates.</span></span> <span data-ttu-id="bac1f-114">Para ello, implemente las interfaces siguientes:</span><span class="sxs-lookup"><span data-stu-id="bac1f-114">To do so, implement the following interfaces:</span></span>

1.  <span data-ttu-id="bac1f-115">Implemente la interfaz [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) .</span><span class="sxs-lookup"><span data-stu-id="bac1f-115">Implement the [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) interface.</span></span>
2.  <span data-ttu-id="bac1f-116">Admite el servicio de **\_ \_ control \_ de tarifas de MF** .</span><span class="sxs-lookup"><span data-stu-id="bac1f-116">Support the **MF\_RATE\_CONTROL\_SERVICE** service.</span></span> <span data-ttu-id="bac1f-117">(Consulte [interfaces de servicio](service-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="bac1f-117">(See [Service Interfaces](service-interfaces.md).)</span></span>
3.  <span data-ttu-id="bac1f-118">Implemente la interfaz [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , que obtiene las velocidades de reproducción admitidas por el objeto.</span><span class="sxs-lookup"><span data-stu-id="bac1f-118">Implement the [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) interface, which gets the playback rates supported by the object.</span></span>
4.  <span data-ttu-id="bac1f-119">Implemente la interfaz [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) , que obtiene o establece la velocidad de reproducción.</span><span class="sxs-lookup"><span data-stu-id="bac1f-119">Implement the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface, which gets or sets the playback rate.</span></span>

## <a name="media-sources"></a><span data-ttu-id="bac1f-120">Orígenes multimedia</span><span class="sxs-lookup"><span data-stu-id="bac1f-120">Media Sources</span></span>

<span data-ttu-id="bac1f-121">Si un origen multimedia admite el control de velocidad, debe implementar [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) y [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span><span class="sxs-lookup"><span data-stu-id="bac1f-121">If a media source supports rate control, it should implement both [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) and [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span></span> <span data-ttu-id="bac1f-122">De lo contrario, la sesión multimedia informa de que la velocidad de reproducción mínima y máxima es 1,0, independientemente de qué otros componentes se encuentran en la canalización.</span><span class="sxs-lookup"><span data-stu-id="bac1f-122">Otherwise, the Media Session reports that the minimum and maximum playback rate is 1.0, regardless of what other components are in the pipeline.</span></span>

<span data-ttu-id="bac1f-123">La velocidad de reproducción no afecta a los tiempos de presentación de los ejemplos, por lo que el origen multimedia no debe ajustar sus marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="bac1f-123">The playback rate does not affect the presentation times of the samples, so the media source should not adjust its time stamps.</span></span> <span data-ttu-id="bac1f-124">En su lugar, el reloj de la presentación se ejecuta a una velocidad mayor o menor.</span><span class="sxs-lookup"><span data-stu-id="bac1f-124">Instead, the presentation clock runs at a faster or slower speed.</span></span> <span data-ttu-id="bac1f-125">Para la reproducción inversa, el origen proporciona muestras en orden inverso, con marcas de tiempo decrecientes.</span><span class="sxs-lookup"><span data-stu-id="bac1f-125">For reverse playback, the source delivers samples in reverse order, with decreasing time stamps.</span></span>

<span data-ttu-id="bac1f-126">El parámetro *fThin* del método [**IMFRateControl:: SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate) indica si el origen de medios debe *fino* el contenido.</span><span class="sxs-lookup"><span data-stu-id="bac1f-126">The *fThin* parameter of the [**IMFRateControl::SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate) method indicates whether media source should *thin* the content.</span></span> <span data-ttu-id="bac1f-127">El ligero se aplica principalmente a las secuencias de vídeo.</span><span class="sxs-lookup"><span data-stu-id="bac1f-127">Thinning applies primarily to video streams.</span></span> <span data-ttu-id="bac1f-128">En el modo delgado, el origen quita los fotogramas Delta y entrega solo fotogramas clave.</span><span class="sxs-lookup"><span data-stu-id="bac1f-128">In thinned mode, the source drops delta frames and deliver only key frames.</span></span> <span data-ttu-id="bac1f-129">En velocidades de reproducción muy altas, el origen podría omitir algunos fotogramas clave (por ejemplo, entregarlos todos los demás fotogramas clave).</span><span class="sxs-lookup"><span data-stu-id="bac1f-129">At very high playback rates, the source might skip some key frames (for example, deliver every other key frame).</span></span>

<span data-ttu-id="bac1f-130">El origen no tiene que quitar ejemplos de audio en modo delgado.</span><span class="sxs-lookup"><span data-stu-id="bac1f-130">The source does not have to drop audio samples in thinned mode.</span></span> <span data-ttu-id="bac1f-131">Sin embargo, con una velocidad de reproducción muy alta, el origen podría no ser capaz de leer los datos nough Fast para rellenar las solicitudes de ejemplo de la canalización.</span><span class="sxs-lookup"><span data-stu-id="bac1f-131">At very high playback rates, however, the source might not be able to read data fast nough to fill the pipeline's sample requests.</span></span> <span data-ttu-id="bac1f-132">En ese caso, es posible que el origen tenga que quitar algunos datos de audio.</span><span class="sxs-lookup"><span data-stu-id="bac1f-132">In that case, the source might need to drop some audio data.</span></span> <span data-ttu-id="bac1f-133">Si es así, debe intentar proporcionar ejemplos de audio cercanos al tiempo a los ejemplos de vídeo (suponiendo que el origen tiene ambos tipos de secuencias).</span><span class="sxs-lookup"><span data-stu-id="bac1f-133">If so, it should attempt to deliver audio samples that are close in time to the video samples (assuming that the source has both types of stream).</span></span>

<span data-ttu-id="bac1f-134">Cuando una secuencia realiza una transición entre el modo delgado y no delgado, envía un evento [MEStreamThinMode](mestreamthinmode.md) .</span><span class="sxs-lookup"><span data-stu-id="bac1f-134">When a stream transitions between thinned and non-thinned mode, it sends an [MEStreamThinMode](mestreamthinmode.md) event.</span></span>

<span data-ttu-id="bac1f-135">Cuando el origen multimedia completa una llamada a [**SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate), envía el evento [MESourceRateChanged](mesourceratechanged.md) .</span><span class="sxs-lookup"><span data-stu-id="bac1f-135">When the media source completes a call to [**SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate), it sends the [MESourceRateChanged](mesourceratechanged.md) event.</span></span>

<span data-ttu-id="bac1f-136">Durante la reproducción inversa:</span><span class="sxs-lookup"><span data-stu-id="bac1f-136">During reverse playback:</span></span>

-   <span data-ttu-id="bac1f-137">El origen de medios ofrece ejemplos en orden inverso, sin ajustar las marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="bac1f-137">The media source delivers samples in reverse order, without adjusting the time stamps.</span></span>
-   <span data-ttu-id="bac1f-138">Las marcas de tiempo dentro de un flujo se deben reducir de monotónica.</span><span class="sxs-lookup"><span data-stu-id="bac1f-138">Time stamps within a stream should monotonically decrease.</span></span>
-   <span data-ttu-id="bac1f-139">El principio del contenido se considera el final de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="bac1f-139">The beginning of the content is considered the end of the stream.</span></span> <span data-ttu-id="bac1f-140">Después de que cada secuencia de medios entregue el primer ejemplo en la secuencia (es decir, tiempo de presentación = 0), envía el evento [MEEndOfStream](meendofstream.md) .</span><span class="sxs-lookup"><span data-stu-id="bac1f-140">After each media stream delivers the first sample in the stream (that is, presentation time = 0), it sends the [MEEndOfStream](meendofstream.md) event.</span></span>

## <a name="media-foundation-transforms"></a><span data-ttu-id="bac1f-141">Media Foundation transformaciones</span><span class="sxs-lookup"><span data-stu-id="bac1f-141">Media Foundation Transforms</span></span>

<span data-ttu-id="bac1f-142">En general, una transformación de Media Foundation (MFT) no necesita compatibilidad explícita con el control de velocidad, a menos que la MFT implemente una reproducción inversa no simplificada.</span><span class="sxs-lookup"><span data-stu-id="bac1f-142">In general, a Media Foundation transform (MFT) does not need explicit support for rate control, unless the MFT implements non-thinned reverse playback.</span></span>

<span data-ttu-id="bac1f-143">Si una MFT no implementa la interfaz [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , la sesión multimedia asume lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="bac1f-143">If an MFT does not implement the [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) interface, the Media Session assumes the following:</span></span>

-   <span data-ttu-id="bac1f-144">La MFT admite las tarifas de reproducción de arbitrarias para la reproducción hacia delante, tanto las delgadas como las no reducidas.</span><span class="sxs-lookup"><span data-stu-id="bac1f-144">The MFT supports arbitary playback rates for forward playback, both thinned and non-thinned.</span></span>
-   <span data-ttu-id="bac1f-145">La MFT admite la reproducción inversa simplificada, pero no admite la reproducción inversa no simplificada.</span><span class="sxs-lookup"><span data-stu-id="bac1f-145">The MFT supports thinned reverse playback, but does not support non-thinned reverse playback.</span></span>

<span data-ttu-id="bac1f-146">Si alguna de estas condiciones no se cumple, el MFT debe implementar [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) y [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span><span class="sxs-lookup"><span data-stu-id="bac1f-146">If either of these conditions is not true, the MFT should implement [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) and [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span></span>

### <a name="reverse-playback"></a><span data-ttu-id="bac1f-147">Reproducción inversa</span><span class="sxs-lookup"><span data-stu-id="bac1f-147">Reverse Playback</span></span>

<span data-ttu-id="bac1f-148">La sesión multimedia puede reproducirse en orden inverso incluso si una o varias transformaciones de la canalización no admiten explícitamente la reproducción inversa.</span><span class="sxs-lookup"><span data-stu-id="bac1f-148">The Media Session can play in reverse even if one or more transforms in the pipeline do not explicitly support reverse playback.</span></span>

<span data-ttu-id="bac1f-149">Si una MFT no expone la interfaz [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , la sesión multimedia utiliza el *ligero* para la reproducción inversa, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="bac1f-149">If an MFT does not expose the [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) interface, the Media Session uses *thinning* for reverse playback, as follows:</span></span>

-   <span data-ttu-id="bac1f-150">La sesión multimedia envía fotogramas clave a la MFT de la manera habitual, llamando a [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="bac1f-150">The Media Session sends key frames to the MFT in the usual way, by calling [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>

-   <span data-ttu-id="bac1f-151">La sesión multimedia quita los fotogramas Delta y los reemplaza con eventos [MEStreamTick](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="bac1f-151">The Media Session drops delta frames and replaces them with [MEStreamTick](mestreamtick.md) events.</span></span>

-   <span data-ttu-id="bac1f-152">Entre cada ejemplo, la sesión multimedia vacía la MFT para evitar errores causados por el hecho de que las marcas de tiempo están disminuyendo.</span><span class="sxs-lookup"><span data-stu-id="bac1f-152">Between each sample, the Media Session flushes the MFT, to avoid any errors caused by the fact that the time stamps are decreasing.</span></span>

<span data-ttu-id="bac1f-153">Un ejemplo se considera un fotograma clave si tiene el atributo [MFSampleExtension \_ CleanPoint](mfsampleextension-cleanpoint-attribute.md) establecido en **true** y se considera un fotograma Delta si este atributo es **false** o no está establecido.</span><span class="sxs-lookup"><span data-stu-id="bac1f-153">A sample is considered a key frame if it has the [MFSampleExtension\_CleanPoint](mfsampleextension-cleanpoint-attribute.md) attribute set to **TRUE**, and is considered a delta frame if this attribute is **FALSE** or not set.</span></span>

<span data-ttu-id="bac1f-154">Si la MFT implementa [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport), la sesión multimedia usa esta interfaz para detectar si la MFT admite la reproducción inversa no simplificada.</span><span class="sxs-lookup"><span data-stu-id="bac1f-154">If the MFT implements [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport), the Media Session uses this interface to discover whether the MFT supports non-thinned reverse playback.</span></span> <span data-ttu-id="bac1f-155">Si la MFT admite la reproducción inversa no simplificada, la sesión multimedia entrega todos los ejemplos, en orden inverso, sin quitar muestras ni vaciar la MFT.</span><span class="sxs-lookup"><span data-stu-id="bac1f-155">If the MFT supports non-thinned reverse playback, the Media Session delivers all of the samples, in reverse order, without dropping samples or flushing the MFT.</span></span>

<span data-ttu-id="bac1f-156">Si una MFT admite la reproducción inversa no simplificada, debe implementar la interfaz [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) .</span><span class="sxs-lookup"><span data-stu-id="bac1f-156">If an MFT supports non-thinned reverse playback, it should implement the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface.</span></span> <span data-ttu-id="bac1f-157">La sesión multimedia usará esta interfaz para notificar a la MFT cuando se produzca la reproducción inversa.</span><span class="sxs-lookup"><span data-stu-id="bac1f-157">The Media Session will use this interface to notify the MFT when reverse playback occurs.</span></span> <span data-ttu-id="bac1f-158">En ese momento, el MFT debe estar preparado para que se reduzcan las marcas de tiempo y para que los fotogramas Delta lleguen en orden inverso.</span><span class="sxs-lookup"><span data-stu-id="bac1f-158">At that point, the MFT must be prepared for the time stamps to decrease and for delta frames to arrive in reverse order.</span></span> <span data-ttu-id="bac1f-159">Normalmente, un descodificador necesitará almacenar en búfer muestras hasta que haya recibido un grupo completo de imágenes (GOP) y, a continuación, descodificar el GOP completo y generar los fotogramas descodificados en el orden correcto (inverso).</span><span class="sxs-lookup"><span data-stu-id="bac1f-159">A decoder will typically need to buffer samples until it has received an entire group of pictures (GOP), then decode the entire GOP and output the decoded frames in the correct (reverse) order.</span></span>

## <a name="media-sinks"></a><span data-ttu-id="bac1f-160">Receptores de medios</span><span class="sxs-lookup"><span data-stu-id="bac1f-160">Media Sinks</span></span>

<span data-ttu-id="bac1f-161">Si un receptor de medios tiene pocas *tasas*, la sesión multimedia supone que el receptor de medios puede controlar cualquier velocidad de reproducción.</span><span class="sxs-lookup"><span data-stu-id="bac1f-161">If a media sink is *rateless*, the Media Session assumes that media sink can handle any playback rate.</span></span> <span data-ttu-id="bac1f-162">No es necesario que el receptor de medios implemente [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport).</span><span class="sxs-lookup"><span data-stu-id="bac1f-162">The media sink does not need to implement [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport).</span></span> <span data-ttu-id="bac1f-163">(Un receptor de medios sin velocidad devuelve el MEDIASINK \_ Marca sin tasa del método [**IMFMediaSink:: GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) ).</span><span class="sxs-lookup"><span data-stu-id="bac1f-163">(A rateless media sink returns the MEDIASINK\_RATELESS flag from the [**IMFMediaSink::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.)</span></span>

<span data-ttu-id="bac1f-164">De lo contrario, un receptor de medios debe implementar [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) si puede controlar velocidades de reproducción distintas de 1,0.</span><span class="sxs-lookup"><span data-stu-id="bac1f-164">Otherwise, a media sink should implement [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) if it can handle playback rates other than 1.0.</span></span>

<span data-ttu-id="bac1f-165">Los receptores de medios no deben implementar [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span><span class="sxs-lookup"><span data-stu-id="bac1f-165">Media sinks should not implement [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span></span> <span data-ttu-id="bac1f-166">Cuando cambia la velocidad de reproducción, el reloj de la presentación llama al método [**IMFClockStateSink:: OnClockSetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfclockstatesink-onclocksetrate) del receptor de medios.</span><span class="sxs-lookup"><span data-stu-id="bac1f-166">When the playback rate changes, the presentation clock calls the media sink's [**IMFClockStateSink::OnClockSetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfclockstatesink-onclocksetrate) method.</span></span>

## <a name="related-topics"></a><span data-ttu-id="bac1f-167">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="bac1f-167">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="bac1f-168">Control de tasa</span><span class="sxs-lookup"><span data-stu-id="bac1f-168">Rate Control</span></span>](rate-control.md)
</dt> <dt>

[<span data-ttu-id="bac1f-169">Búsqueda, avance rápido y reproducción inversa</span><span class="sxs-lookup"><span data-stu-id="bac1f-169">Seeking, Fast Forward, and Reverse Play</span></span>](seeking--fast-forward--and-reverse-play.md)
</dt> </dl>

 

 



