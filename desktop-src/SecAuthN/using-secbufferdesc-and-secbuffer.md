---
description: A menudo, la comunicación implica grandes cantidades de datos o datos de longitud desconocida.
ms.assetid: e7b12b9e-8caa-4dad-b81f-b609ccb92c9f
title: Usar SecBufferDesc y SecBuffer
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca7d8155a610263838d2baf2a7d1c8fc96ec874
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "103911854"
---
# <a name="using-secbufferdesc-and-secbuffer"></a><span data-ttu-id="6ef9b-103">Usar SecBufferDesc y SecBuffer</span><span class="sxs-lookup"><span data-stu-id="6ef9b-103">Using SecBufferDesc and SecBuffer</span></span>

<span data-ttu-id="6ef9b-104">A menudo, la comunicación implica grandes cantidades de datos o datos de longitud desconocida.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-104">Communication often involves potentially large amounts of data or data of unknown length.</span></span> <span data-ttu-id="6ef9b-105">El envío y la recepción de datos se realizan de manera similar o idéntica en ambos casos.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-105">Sending and receiving data is done in similar or identical fashion in both of these cases.</span></span> <span data-ttu-id="6ef9b-106">Para tratar con una longitud desconocida y potencialmente grandes cantidades de datos, la comunicación SSPI se realiza con dos estructuras, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) y [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span><span class="sxs-lookup"><span data-stu-id="6ef9b-106">To deal with unknown length and potentially large amounts of data, SSPI communication is done using two structures, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) and [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span></span>

<span data-ttu-id="6ef9b-107">Una estructura [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) es un contenedor para una matriz de estructuras [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="6ef9b-107">A [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) structure is a container for an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="6ef9b-108">Una estructura **SecBufferDesc** tiene los siguientes miembros:</span><span class="sxs-lookup"><span data-stu-id="6ef9b-108">A **SecBufferDesc** structure has the following members:</span></span>

-   <span data-ttu-id="6ef9b-109">Número de versión</span><span class="sxs-lookup"><span data-stu-id="6ef9b-109">Version number</span></span>
-   <span data-ttu-id="6ef9b-110">Número de elementos [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="6ef9b-110">Number of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) elements</span></span>
-   <span data-ttu-id="6ef9b-111">Dirección de la matriz de estructuras [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="6ef9b-111">Address of the array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures</span></span>

<span data-ttu-id="6ef9b-112">Una estructura [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) contiene los tres miembros siguientes:</span><span class="sxs-lookup"><span data-stu-id="6ef9b-112">A [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structure contains the following three members:</span></span>

-   <span data-ttu-id="6ef9b-113">Número de bytes en el búfer</span><span class="sxs-lookup"><span data-stu-id="6ef9b-113">Number of bytes in the buffer</span></span>
-   <span data-ttu-id="6ef9b-114">Tipo de información contenida en el elemento de datos</span><span class="sxs-lookup"><span data-stu-id="6ef9b-114">Type of information contained in the data item</span></span>
-   <span data-ttu-id="6ef9b-115">Los propios bytes</span><span class="sxs-lookup"><span data-stu-id="6ef9b-115">The bytes themselves</span></span>

<span data-ttu-id="6ef9b-116">Un mensaje SSPI completo se compone a menudo de una matriz de estructuras [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="6ef9b-116">A whole SSPI message often consists of an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span>

<span data-ttu-id="6ef9b-117">Los siguientes tipos de datos de búfer se definen como se indica a continuación.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-117">The following buffer data types are defined as follows.</span></span>



| <span data-ttu-id="6ef9b-118">Tipo de búfer</span><span class="sxs-lookup"><span data-stu-id="6ef9b-118">Buffer type</span></span>                | <span data-ttu-id="6ef9b-119">Significado</span><span class="sxs-lookup"><span data-stu-id="6ef9b-119">Meaning</span></span>                                                                                                                                |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="6ef9b-120">SECBUFFER \_ vacío</span><span class="sxs-lookup"><span data-stu-id="6ef9b-120">SECBUFFER\_EMPTY</span></span>           | <span data-ttu-id="6ef9b-121">Undefined, reemplazado por la función de [*paquete de seguridad*](../secgloss/s-gly.md)</span><span class="sxs-lookup"><span data-stu-id="6ef9b-121">Undefined, replaced by the [*security package*](../secgloss/s-gly.md) function</span></span> |
| <span data-ttu-id="6ef9b-122">datos de SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="6ef9b-122">SECBUFFER\_DATA</span></span>            | <span data-ttu-id="6ef9b-123">Datos de paquetes</span><span class="sxs-lookup"><span data-stu-id="6ef9b-123">Packet data</span></span>                                                                                                                            |
| <span data-ttu-id="6ef9b-124">\_token SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="6ef9b-124">SECBUFFER\_TOKEN</span></span>           | <span data-ttu-id="6ef9b-125">Token de seguridad</span><span class="sxs-lookup"><span data-stu-id="6ef9b-125">Security token</span></span>                                                                                                                         |
| <span data-ttu-id="6ef9b-126">PARÁMETROS de SECBUFFER \_ pkg \_</span><span class="sxs-lookup"><span data-stu-id="6ef9b-126">SECBUFFER\_PKG\_PARAMS</span></span>     | <span data-ttu-id="6ef9b-127">Parámetros específicos del paquete</span><span class="sxs-lookup"><span data-stu-id="6ef9b-127">Package-specific parameters</span></span>                                                                                                            |
| <span data-ttu-id="6ef9b-128">\_falta SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="6ef9b-128">SECBUFFER\_MISSING</span></span>         | <span data-ttu-id="6ef9b-129">Falta el indicador de datos</span><span class="sxs-lookup"><span data-stu-id="6ef9b-129">Missing data indicator</span></span>                                                                                                                 |
| <span data-ttu-id="6ef9b-130">SECBUFFER \_ extra</span><span class="sxs-lookup"><span data-stu-id="6ef9b-130">SECBUFFER\_EXTRA</span></span>           | <span data-ttu-id="6ef9b-131">Datos adicionales</span><span class="sxs-lookup"><span data-stu-id="6ef9b-131">Extra data</span></span>                                                                                                                             |
| <span data-ttu-id="6ef9b-132">\_flujo SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="6ef9b-132">SECBUFFER\_STREAM</span></span>          | <span data-ttu-id="6ef9b-133">Datos de flujo de seguridad</span><span class="sxs-lookup"><span data-stu-id="6ef9b-133">Security stream data</span></span>                                                                                                                   |
| <span data-ttu-id="6ef9b-134">\_finalizador de flujo SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="6ef9b-134">SECBUFFER\_STREAM\_TRAILER</span></span> | <span data-ttu-id="6ef9b-135">Finalizador de flujo de seguridad</span><span class="sxs-lookup"><span data-stu-id="6ef9b-135">Security stream trailer</span></span>                                                                                                                |
| <span data-ttu-id="6ef9b-136">SECBUFFER \_ encabezado de secuencia \_</span><span class="sxs-lookup"><span data-stu-id="6ef9b-136">SECBUFFER\_STREAM\_HEADER</span></span>  | <span data-ttu-id="6ef9b-137">Encabezado de flujo de seguridad</span><span class="sxs-lookup"><span data-stu-id="6ef9b-137">Security stream header</span></span>                                                                                                                 |



 

<span data-ttu-id="6ef9b-138">Los tipos de búfer anteriores se pueden combinar mediante **una operación OR bit a bit** con cualquiera de los siguientes tipos de búfer.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-138">The buffer types above can be combined using a bitwise-**OR** operation with either of the following buffer types.</span></span>



| <span data-ttu-id="6ef9b-139">Tipo de búfer</span><span class="sxs-lookup"><span data-stu-id="6ef9b-139">Buffer type</span></span>         | <span data-ttu-id="6ef9b-140">Significado</span><span class="sxs-lookup"><span data-stu-id="6ef9b-140">Meaning</span></span>                                                                          |
|---------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="6ef9b-141">SECBUFFER \_ ATTRMASK</span><span class="sxs-lookup"><span data-stu-id="6ef9b-141">SECBUFFER\_ATTRMASK</span></span> | <span data-ttu-id="6ef9b-142">Enmascara los atributos de seguridad separando las marcas de atributo del tipo de búfer.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-142">Mask security attributes by separating the attribute flags from the buffer type.</span></span> |
| <span data-ttu-id="6ef9b-143">SECBUFFER \_ ReadOnly</span><span class="sxs-lookup"><span data-stu-id="6ef9b-143">SECBUFFER\_READONLY</span></span> | <span data-ttu-id="6ef9b-144">El búfer es de solo lectura</span><span class="sxs-lookup"><span data-stu-id="6ef9b-144">Buffer is read-only</span></span>                                                              |



 

<span data-ttu-id="6ef9b-145">Antes de cada llamada a una API SSPI que requiere un parámetro [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) , se declaran e inicializan uno o varios elementos de la matriz [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="6ef9b-145">Before each call to an SSPI API that requires a [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) parameter, one or more [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) array elements are declared and initialized.</span></span> <span data-ttu-id="6ef9b-146">Por ejemplo, puede haber dos búferes de seguridad: uno que contenga los datos de los mensajes de entrada y el otro para el token de seguridad opaco de salida devuelto por el paquete de seguridad.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-146">For example, there can be two security buffers: one that contains input message data and the other for the output opaque security token returned by the security package.</span></span> <span data-ttu-id="6ef9b-147">El orden de los búferes de seguridad en el descriptor del búfer de seguridad no es importante, pero cada búfer se debe etiquetar con su tipo adecuado.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-147">The order of security buffers in the security buffer descriptor is not important, but each buffer must be tagged with its appropriate type.</span></span> <span data-ttu-id="6ef9b-148">Se puede usar una etiqueta de solo lectura con cualquier búfer de entrada que no deba modificar el [*paquete de seguridad*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9b-148">A read-only tag can be used with any input buffer that must not be modified by the [*security package*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="6ef9b-149">Es importante el tamaño del búfer de salida que se espera que contenga el token de seguridad.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-149">The size of the output buffer that is expected to contain the security token is important.</span></span> <span data-ttu-id="6ef9b-150">Una aplicación puede encontrar el tamaño máximo del token de un paquete de seguridad durante la configuración inicial.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-150">An application can find the maximum token size for a security package during initial setup.</span></span> <span data-ttu-id="6ef9b-151">La llamada a [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) devuelve una matriz de punteros a la información del paquete de seguridad.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-151">The call to [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) returns an array of pointers to security package information.</span></span> <span data-ttu-id="6ef9b-152">La estructura de información de paquetes de seguridad contiene el tamaño máximo de los tokens para cada paquete.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-152">The security package information structure contains the maximum token size for each package.</span></span> <span data-ttu-id="6ef9b-153">En el ejemplo, la información está en el miembro **cbMaxToken** de la estructura [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) .</span><span class="sxs-lookup"><span data-stu-id="6ef9b-153">In the example, the information is in the **cbMaxToken** member of the [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) structure.</span></span> <span data-ttu-id="6ef9b-154">La misma información se puede obtener posteriormente mediante [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span><span class="sxs-lookup"><span data-stu-id="6ef9b-154">The same information can be obtained later using [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span></span>

<span data-ttu-id="6ef9b-155">La aplicación inicializa los punteros y tamaños de búfer en la descripción del búfer para indicar dónde se pueden encontrar los datos del mensaje y otra información.</span><span class="sxs-lookup"><span data-stu-id="6ef9b-155">The application initializes the buffer pointers and sizes in the buffer description to indicate where message data and other information can be found.</span></span>

<span data-ttu-id="6ef9b-156">Para obtener más información, consulte el [código de ejemplo SecBuffer y SecBufferDesc](secbuffer-and-secbufferdesc-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="6ef9b-156">For details, see [SecBuffer and SecBufferDesc Example Code](secbuffer-and-secbufferdesc-example-code.md).</span></span>

 

 
