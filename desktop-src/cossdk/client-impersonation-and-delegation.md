---
description: En algunas circunstancias, una aplicación de servidor necesita presentar una identidad de clientes a los recursos a los que se tiene acceso en el nombre de los clientes, normalmente para hacer que las comprobaciones de acceso o la autenticación se realicen en la identidad de los clientes.
ms.assetid: fd75eb54-eefe-411f-a7aa-0bc8628f8778
title: Suplantación y delegación de cliente
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7557dcde4cadf559dd8e116cf4e7bece4221aaae
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105666191"
---
# <a name="client-impersonation-and-delegation"></a><span data-ttu-id="76df1-103">Suplantación y delegación de cliente</span><span class="sxs-lookup"><span data-stu-id="76df1-103">Client Impersonation and Delegation</span></span>

<span data-ttu-id="76df1-104">En algunas circunstancias, una aplicación de servidor necesita presentar la identidad de un cliente a los recursos a los que tiene acceso en nombre del cliente, normalmente para hacer que las comprobaciones de acceso o la autenticación se realicen en la identidad del cliente.</span><span class="sxs-lookup"><span data-stu-id="76df1-104">In some circumstances, a server application needs to present a client's identity to resources it accesses on the client's behalf, usually to cause access checks or authentication to be performed against the client's identity.</span></span> <span data-ttu-id="76df1-105">En cierta medida, el servidor puede actuar bajo la identidad del cliente, una acción a la que se hace referencia como suplantar al cliente.</span><span class="sxs-lookup"><span data-stu-id="76df1-105">To a certain extent, the server can act under the client's identity—an action referred to as impersonating the client.</span></span>

<span data-ttu-id="76df1-106">La *suplantación* es la capacidad de un subproceso de ejecutarse en un contexto de seguridad diferente del proceso que posee el subproceso.</span><span class="sxs-lookup"><span data-stu-id="76df1-106">*Impersonation* is the ability of a thread to execute in a security context different from that of the process owning the thread.</span></span> <span data-ttu-id="76df1-107">El subproceso de servidor utiliza un token de acceso que representa las credenciales del cliente y, con esto, puede tener acceso a los recursos a los que el cliente puede tener acceso.</span><span class="sxs-lookup"><span data-stu-id="76df1-107">The server thread uses an access token representing the client's credentials, and with this, it can access resources that the client can access.</span></span>

<span data-ttu-id="76df1-108">El uso de la suplantación garantiza que el servidor puede hacer exactamente lo que puede hacer el cliente.</span><span class="sxs-lookup"><span data-stu-id="76df1-108">Using impersonation ensures that the server can do precisely what the client can do.</span></span> <span data-ttu-id="76df1-109">El acceso a los recursos puede estar restringido o expandirse, en función de lo que el cliente tenga permiso para hacerlo.</span><span class="sxs-lookup"><span data-stu-id="76df1-109">Access to resources may be either restricted or expanded, depending on what the client has permission to do.</span></span>

<span data-ttu-id="76df1-110">Puede decidir que un servidor suplante a un cliente al conectarse a una base de datos para que la base de datos pueda autenticar y autorizar el cliente para sí mismo.</span><span class="sxs-lookup"><span data-stu-id="76df1-110">You might choose to have a server impersonate a client when connecting to a database so that the database can authenticate and authorize the client for itself.</span></span> <span data-ttu-id="76df1-111">O bien, si la aplicación tiene acceso a los archivos que están protegidos con un descriptor de seguridad y para permitir que el cliente obtenga acceso autorizado a la información de estos archivos, la aplicación puede suplantar al cliente antes de tener acceso a los archivos.</span><span class="sxs-lookup"><span data-stu-id="76df1-111">Or, if your application accesses files that are protected with a security descriptor and to enable the client to obtain authorized access to information in these files, the application can impersonate the client before accessing the files.</span></span>

## <a name="how-to-implement-impersonation"></a><span data-ttu-id="76df1-112">Cómo implementar la suplantación</span><span class="sxs-lookup"><span data-stu-id="76df1-112">How to Implement Impersonation</span></span>

<span data-ttu-id="76df1-113">La suplantación requiere la participación del cliente y del servidor (y, en algunos casos, de los administradores del sistema).</span><span class="sxs-lookup"><span data-stu-id="76df1-113">Impersonation requires participation by both client and server (and, in some cases, system administrators).</span></span> <span data-ttu-id="76df1-114">El cliente debe indicar su voluntad para permitir que el servidor use su identidad y el servidor debe asumir explícitamente la identidad del cliente mediante programación.</span><span class="sxs-lookup"><span data-stu-id="76df1-114">The client must indicate its willingness to let the server use its identity, and the server must explicitly assume the client's identity programmatically.</span></span> <span data-ttu-id="76df1-115">Para obtener más información, consulte los temas [requisitos del cliente para la suplantación](client-side-requirements-for-impersonation.md) y [los requisitos del servidor para la suplantación](server-side-requirements-for-impersonation.md).</span><span class="sxs-lookup"><span data-stu-id="76df1-115">For details, see the topics [Client-Side Requirements for Impersonation](client-side-requirements-for-impersonation.md) and [Server-Side Requirements for Impersonation](server-side-requirements-for-impersonation.md).</span></span>

## <a name="administrative-requirements-for-delegate-level-impersonation"></a><span data-ttu-id="76df1-116">Requisitos administrativos para la suplantación de Delegate-Level</span><span class="sxs-lookup"><span data-stu-id="76df1-116">Administrative Requirements for Delegate-Level Impersonation</span></span>

<span data-ttu-id="76df1-117">Para usar eficazmente la forma más eficaz de suplantación, la *delegación*, que es la suplantación de clientes a través de la red, las cuentas de usuario de cliente y servidor deben estar configuradas correctamente en el servicio de Active Directory para que sea compatible (además de la autoridad de concesión de cliente para realizar la suplantación de nivel de delegado), de la manera siguiente:</span><span class="sxs-lookup"><span data-stu-id="76df1-117">To effectively use the most powerful form of impersonation, *delegation*, which is the impersonation of clients over the network, the client and server user accounts must be properly configured in the Active Directory Service to support it (in addition to the client granting authority to do delegate-level impersonation), as follows:</span></span>

-   <span data-ttu-id="76df1-118">La identidad del servidor se debe marcar como "de confianza para delegación" en el servicio de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="76df1-118">The server identity must be marked as "Trusted for delegation" in the Active Directory Service.</span></span>
-   <span data-ttu-id="76df1-119">La identidad del cliente no se debe marcar como "la cuenta es importante y no se puede delegar" en el servicio de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="76df1-119">The client identity must not be marked as "Account is sensitive and cannot be delegated" in the Active Directory Service.</span></span>

<span data-ttu-id="76df1-120">Estas características de configuración proporcionan al administrador de dominio un alto grado de control sobre la delegación, que es deseable, dada la cantidad de confianza (y, por tanto, el riesgo de seguridad) que conlleva.</span><span class="sxs-lookup"><span data-stu-id="76df1-120">These configuration features give the domain administrator a high degree of control over delegation, which is desirable, given how much trust (and hence security risk) is involved.</span></span> <span data-ttu-id="76df1-121">Para obtener más información acerca de la delegación, consulte [delegación y suplantación](/windows/desktop/com/delegation-and-impersonation).</span><span class="sxs-lookup"><span data-stu-id="76df1-121">For more detail about delegation, see [Delegation and Impersonation](/windows/desktop/com/delegation-and-impersonation).</span></span>

## <a name="cloaking"></a><span data-ttu-id="76df1-122">Esconder</span><span class="sxs-lookup"><span data-stu-id="76df1-122">Cloaking</span></span>

<span data-ttu-id="76df1-123">Junto con la autoridad que un cliente concede a un servidor a través del nivel de suplantación, la capacidad de Cloaking del servidor determina en gran medida cómo se comportará la suplantación.</span><span class="sxs-lookup"><span data-stu-id="76df1-123">Along with the authority a client grants a server through the impersonation level, the server's cloaking capability largely determines how impersonation will behave.</span></span> <span data-ttu-id="76df1-124">La ocultación afecta a qué identidad presenta realmente el servidor cuando realiza llamadas en el nombre del cliente (es decir, el propio o el del cliente).</span><span class="sxs-lookup"><span data-stu-id="76df1-124">Cloaking affects what identity is actually presented by the server when it makes calls on the client's behalf—its own or the client's.</span></span> <span data-ttu-id="76df1-125">Para obtener más información, consulte [Cloaking](cloaking.md).</span><span class="sxs-lookup"><span data-stu-id="76df1-125">For details, see [Cloaking](cloaking.md).</span></span>

## <a name="performance-implications"></a><span data-ttu-id="76df1-126">Implicaciones de rendimiento</span><span class="sxs-lookup"><span data-stu-id="76df1-126">Performance Implications</span></span>

<span data-ttu-id="76df1-127">La suplantación puede afectar significativamente al rendimiento y al escalado.</span><span class="sxs-lookup"><span data-stu-id="76df1-127">Impersonation can significantly affect performance and scaling.</span></span> <span data-ttu-id="76df1-128">Por lo general, es más caro suplantar a un cliente en una llamada que para hacer la llamada directamente.</span><span class="sxs-lookup"><span data-stu-id="76df1-128">It is generally more expensive to impersonate a client on a call than to make the call directly.</span></span> <span data-ttu-id="76df1-129">A continuación se indican algunos de los problemas que se deben tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="76df1-129">Following are some of the issues to consider:</span></span>

-   <span data-ttu-id="76df1-130">La sobrecarga computacional de pasar la identidad en patrones complicados, especialmente si está habilitado el Cloaking dinámico.</span><span class="sxs-lookup"><span data-stu-id="76df1-130">The computational overhead of passing around identity in complicated patterns, particularly if dynamic cloaking is enabled.</span></span>
-   <span data-ttu-id="76df1-131">La complejidad general de la aplicación de comprobaciones de seguridad redundantes en numerosos lugares, en lugar de hacerlo de forma centralizada en el nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="76df1-131">The general complexity of enforcing redundant security checking in numerous places, instead of just centrally in the middle tier.</span></span>
-   <span data-ttu-id="76df1-132">Los recursos, como las conexiones de base de datos, cuando se abre la suplantación de un cliente, no se pueden reutilizar en varios clientes, un obstáculo muy grande para el escalado adecuado.</span><span class="sxs-lookup"><span data-stu-id="76df1-132">Resources such as database connections, when opened impersonating a client, cannot be reused across multiple clients—a very large roadblock to scaling well.</span></span>

<span data-ttu-id="76df1-133">A veces, la única solución efectiva a un problema es usar la suplantación, pero esta decisión debe sopesarse con cuidado.</span><span class="sxs-lookup"><span data-stu-id="76df1-133">Sometimes the only effective solution to a problem is to use impersonation, but this decision should be carefully weighed.</span></span> <span data-ttu-id="76df1-134">Para obtener más información sobre estos problemas, consulte [seguridad de aplicaciones de niveles múltiples](multi-tier-application-security.md).</span><span class="sxs-lookup"><span data-stu-id="76df1-134">For a further discussion of these issues, see [Multi-Tier Application Security](multi-tier-application-security.md).</span></span>

## <a name="queued-components"></a><span data-ttu-id="76df1-135">Componentes en cola</span><span class="sxs-lookup"><span data-stu-id="76df1-135">Queued Components</span></span>

<span data-ttu-id="76df1-136">[Los componentes en cola](com--queued-components.md) no admiten la suplantación.</span><span class="sxs-lookup"><span data-stu-id="76df1-136">[Queued components](com--queued-components.md) do not support impersonation.</span></span> <span data-ttu-id="76df1-137">Cuando un cliente realiza una llamada a un objeto en cola, la llamada se realiza realmente a la grabadora, que la empaqueta como parte de un mensaje en el servidor.</span><span class="sxs-lookup"><span data-stu-id="76df1-137">When a client makes a call to a queued object, the call is actually made to the recorder, which packages it as part of a message to the server.</span></span> <span data-ttu-id="76df1-138">A continuación, el agente de escucha lee el mensaje de la cola y lo pasa al reproductor, que invoca el componente de servidor real y realiza la misma llamada de método.</span><span class="sxs-lookup"><span data-stu-id="76df1-138">The listener then reads the message from the queue and passes it to the player, which invokes the actual server component and makes the same method call.</span></span> <span data-ttu-id="76df1-139">Como tal, cuando el servidor recibe la llamada, el token de cliente original no está disponible a través de la suplantación.</span><span class="sxs-lookup"><span data-stu-id="76df1-139">As such, when the server receives the call, the original client token is unavailable via impersonation.</span></span> <span data-ttu-id="76df1-140">La seguridad basada en roles se sigue aplicando, sin embargo, y la seguridad mediante programación con la interfaz [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) funcionará.</span><span class="sxs-lookup"><span data-stu-id="76df1-140">Role-based security still applies, however, and programmatic security using the [**ISecurityCallContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) interface will work.</span></span> <span data-ttu-id="76df1-141">Para obtener más información, vea [seguridad de componentes en cola](queued-components-security.md).</span><span class="sxs-lookup"><span data-stu-id="76df1-141">For details, see [Queued Components Security](queued-components-security.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="76df1-142">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="76df1-142">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="76df1-143">Autenticación de cliente</span><span class="sxs-lookup"><span data-stu-id="76df1-143">Client Authentication</span></span>](client-authentication.md)
</dt> <dt>

[<span data-ttu-id="76df1-144">Seguridad de aplicaciones de biblioteca</span><span class="sxs-lookup"><span data-stu-id="76df1-144">Library Application Security</span></span>](library-application-security.md)
</dt> <dt>

[<span data-ttu-id="76df1-145">Seguridad de aplicaciones de niveles múltiples</span><span class="sxs-lookup"><span data-stu-id="76df1-145">Multi-Tier Application Security</span></span>](multi-tier-application-security.md)
</dt> <dt>

[<span data-ttu-id="76df1-146">Seguridad de componentes mediante programación</span><span class="sxs-lookup"><span data-stu-id="76df1-146">Programmatic Component Security</span></span>](programmatic-component-security.md)
</dt> <dt>

[<span data-ttu-id="76df1-147">Administración de la seguridad basada en roles</span><span class="sxs-lookup"><span data-stu-id="76df1-147">Role-Based Security Administration</span></span>](role-based-security-administration.md)
</dt> <dt>

[<span data-ttu-id="76df1-148">Usar la Directiva de restricción de software en COM+</span><span class="sxs-lookup"><span data-stu-id="76df1-148">Using the Software Restriction Policy in COM+</span></span>](using-the-software-restriction-policy-in-com-.md)
</dt> </dl>

 

 
