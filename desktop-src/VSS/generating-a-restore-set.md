---
description: Un conjunto de restauración es una lista de todos los archivos que se van a restaurar y las ubicaciones en las que se restaurarán.
ms.assetid: 3196c26c-3407-4c00-a800-c3497df583e5
title: Generar un conjunto de restauración
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db3447ba6d258a5f22fff958761abc7ac0e4f27f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105697019"
---
# <a name="generating-a-restore-set"></a><span data-ttu-id="c7264-103">Generar un conjunto de restauración</span><span class="sxs-lookup"><span data-stu-id="c7264-103">Generating A Restore Set</span></span>

<span data-ttu-id="c7264-104">Un conjunto de restauración es una lista de todos los archivos que se van a restaurar y las ubicaciones en las que se restaurarán.</span><span class="sxs-lookup"><span data-stu-id="c7264-104">A restore set is a list of all files to be restored and the locations to which they will be restored.</span></span>

<span data-ttu-id="c7264-105">Al igual que al generar la lista de archivos de copia de seguridad (vea [generar un conjunto de copia de seguridad](generating-a-backup-set.md)), un algoritmo para determinar qué archivos se van a restaurar y dónde restaurarlos debe continuar la [*instancia*](vssgloss-w.md) del escritor por instancia de escritor y en función componente por componente para cada instancia del escritor.</span><span class="sxs-lookup"><span data-stu-id="c7264-105">As when generating the backup file list (see [Generating A Backup Set](generating-a-backup-set.md)), an algorithm for determining which files to restore and where to restore them must proceed [*writer instance*](vssgloss-w.md) by writer instance, and on a component-by-component basis for each writer instance.</span></span>

<span data-ttu-id="c7264-106">Es necesario asociar cada archivo en el medio de copia de seguridad con el componente que lo administra.</span><span class="sxs-lookup"><span data-stu-id="c7264-106">It is necessary to associate each file on the backup media with the component that managed it.</span></span> <span data-ttu-id="c7264-107">También es necesario obtener el [*método restore*](vssgloss-r.md)del componente de administración, así como la información de [*destino de restauración*](vssgloss-r.md) del archivo y sus asignaciones de [*Ubicación alternativas*](vssgloss-a.md) (si existen).</span><span class="sxs-lookup"><span data-stu-id="c7264-107">It is also necessary to obtain the managing component's [*restore method*](vssgloss-r.md), and the file's [*restore target*](vssgloss-r.md) information, and its [*alternate location mappings*](vssgloss-a.md) (if any).</span></span>

<span data-ttu-id="c7264-108">Algunos archivos también pueden requerir operaciones de [*archivos parciales*](vssgloss-p.md) o [*destinos dirigidos*](vssgloss-d.md) para la restauración.</span><span class="sxs-lookup"><span data-stu-id="c7264-108">Some files may also require [*partial files*](vssgloss-p.md) operations or [*directed targets*](vssgloss-d.md) for restore.</span></span>

<span data-ttu-id="c7264-109">Mediante el examen de la capacidad de selección de los componentes para las rutas de acceso [*lógicas*](vssgloss-l.md) y [*de copia de seguridad*](vssgloss-s.md) (vea [trabajar con las rutas de acceso lógicas y de selección](working-with-selectability-and-logical-paths.md)), un solicitante puede determinar la estructura de componentes de la operación de copia de seguridad que se va a restaurar.</span><span class="sxs-lookup"><span data-stu-id="c7264-109">By examining the components' [*selectability for backup*](vssgloss-s.md) and [*logical paths*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester is able to determine the component structure of the backup operation it is going to restore.</span></span>

<span data-ttu-id="c7264-110">Con la estructura de componentes de la copia de seguridad establecida, el solicitante puede obtener la información del [*conjunto de archivos*](vssgloss-f.md) de cada componente (especificación de archivo, ruta de acceso y marca de recursividad).</span><span class="sxs-lookup"><span data-stu-id="c7264-110">With the component structure of the backup established, the requester can get each component's [*file set*](vssgloss-f.md) information (file specification, path, and recursion flag).</span></span> <span data-ttu-id="c7264-111">Después, un solicitante puede generar un conjunto de restauración.</span><span class="sxs-lookup"><span data-stu-id="c7264-111">A requester can then generate a restore set.</span></span>

<span data-ttu-id="c7264-112">Los archivos que requieren [*archivos parciales*](vssgloss-p.md)o [*destinos dirigidos*](vssgloss-d.md) proporcionan sus propias instrucciones de restauración detalladas (vea [ubicaciones de copia de seguridad y restauración no predeterminadas](non-default-backup-and-restore-locations.md)), que se pueden agregar al conjunto de restauración.</span><span class="sxs-lookup"><span data-stu-id="c7264-112">Files requiring [*partial files*](vssgloss-p.md), or [*directed targets*](vssgloss-d.md) provide their own detailed restoration instructions (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)), which can then be added to the restore set.</span></span>

<span data-ttu-id="c7264-113">Un mecanismo típico para generar un conjunto de restauración para los archivos que no están relacionados con las operaciones de archivos parciales o los [*destinos dirigidos*](vssgloss-d.md) puede continuar haciendo lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c7264-113">A typical mechanism for generating a restore set for files not involved with partial files operations, or [*directed targets*](vssgloss-d.md) might proceed by doing the following:</span></span>

1.  <span data-ttu-id="c7264-114">Obtenga una lista de archivos en el medio de copia de seguridad, incluidas sus rutas de acceso originales.</span><span class="sxs-lookup"><span data-stu-id="c7264-114">Obtain a list of files on the backup media, including their original paths.</span></span>

2.  <span data-ttu-id="c7264-115">Para identificar la clase y el componente del [*escritor*](vssgloss-w.md) de cada archivo en el medio de copia de seguridad, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="c7264-115">Identify the [*writer class*](vssgloss-w.md) and component for each file on the backup media by doing the following:</span></span>

    -   <span data-ttu-id="c7264-116">Para cada escritor, obtenga información de componentes ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) llamando a [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) en todos sus componentes.</span><span class="sxs-lookup"><span data-stu-id="c7264-116">For each writer, obtain component information ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) by calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) on all its components.</span></span>
    -   <span data-ttu-id="c7264-117">Para cada componente, obtenga información del descriptor de archivo ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) para cada conjunto de archivos que contiene el componente (en función de los tipos de datos que contiene el componente mediante una llamada a [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent:: GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile)y [**IVssWMComponent:: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span><span class="sxs-lookup"><span data-stu-id="c7264-117">For each component, obtain file descriptor ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) information for every set of files the component contains (depending on the types of data the component contains by calling [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent::GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile), and [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span></span>
    -   <span data-ttu-id="c7264-118">Compare la información de nombre y ruta de acceso del archivo con la que devuelve la información de ruta de acceso contenida en el descriptor de archivo para cada conjunto de archivos de un componente (devuelto por [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc:: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)y [**IVssWMFiledesc:: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) en la información de ruta de acceso de los archivos almacenados para determinar si el archivo forma parte del componente.</span><span class="sxs-lookup"><span data-stu-id="c7264-118">Compare the file's name and path information against that returned by the path information contained in the file descriptor for each set of files in a component (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) against stored files path information to determine whether the file is part of the component.</span></span>
        > [!Note]  
        > <span data-ttu-id="c7264-119">Debe omitir cualquier información de ubicación alternativa en el descriptor de archivo recuperado de un componente que se encuentra en un documento de metadatos de escritor almacenado (es decir, [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) no devuelve **null**).</span><span class="sxs-lookup"><span data-stu-id="c7264-119">You should ignore any alternate location information in the file descriptor retrieved from a component found in a stored Writer Metadata Document (that is, [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) does not return **NULL**).</span></span> <span data-ttu-id="c7264-120">Esta ubicación alternativa es la [*ruta de acceso alternativa*](vssgloss-a.md), que solo se usa durante la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="c7264-120">This alternate location is the [*alternate path*](vssgloss-a.md), which is used only during backup.</span></span>

         

3.  <span data-ttu-id="c7264-121">Obtenga información de asignación alternativa para cada archivo en el medio de copia de seguridad:</span><span class="sxs-lookup"><span data-stu-id="c7264-121">Obtain alternate mapping information for each file on the backup media:</span></span>

    -   <span data-ttu-id="c7264-122">Las asignaciones de archivos alternativas se almacenan en el escritor, no en el nivel de componente, y se obtienen del objeto [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) devuelto por [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="c7264-122">Alternate file mappings are stored at the writer, not the component level, and are obtained from the object [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span></span>
    -   <span data-ttu-id="c7264-123">Puede determinar si un archivo determinado tiene una asignación de ubicación alternativa comprobando la ruta de acceso y el nombre del archivo con la ruta de acceso y la especificación del archivo contenidos en la asignación de ubicación alternativa devuelta por [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), a través de [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc:: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)y [**IVssWMFiledesc:: GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span><span class="sxs-lookup"><span data-stu-id="c7264-123">You can determine if a particular file has an alternate location mapping by checking the file's path and name against the path and file specification contained in the alternate location mapping returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), via [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span></span> <span data-ttu-id="c7264-124">(Si se usó una ruta de acceso alternativa durante la copia de seguridad, esta información debe omitirse durante esta comprobación en el procesamiento de una restauración).</span><span class="sxs-lookup"><span data-stu-id="c7264-124">(If an alternate path was used during backup, that information should be ignored during this check in processing a restore.)</span></span>
    -   <span data-ttu-id="c7264-125">Si un archivo y una ubicación alternativa asignan los descriptores de archivo, use el método [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) del objeto [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) devuelto por [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) para buscar la ubicación alternativa en la que puede restaurar el archivo.</span><span class="sxs-lookup"><span data-stu-id="c7264-125">If a file and an alternate location mappings file descriptors match, you then use the [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) method of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) object returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to find the alternate location to which you can restore the file.</span></span>
    -   <span data-ttu-id="c7264-126">La asignación de ubicación alternativa obtenida de esta manera no coincidirá necesariamente con la que devolvió el documento componentes de copia de seguridad de [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="c7264-126">The alternate location mapping obtained in this way will not necessarily agree with that returned from the Backup Components Document by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="c7264-127">El valor [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) no está en blanco solo si se usa la asignación de ubicación alternativa para un archivo.</span><span class="sxs-lookup"><span data-stu-id="c7264-127">The [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) value is nonblank only if the alternate location mapping is used for a file.</span></span>

4.  <span data-ttu-id="c7264-128">Con esta información de archivos y componentes, se puede consultar el documento componentes de copia de seguridad para obtener información acerca de destinos de restauración, opciones y nuevas ubicaciones de restauración para cada archivo.</span><span class="sxs-lookup"><span data-stu-id="c7264-128">With this file and component information, the Backup Components Document can be queried to obtain information about restore targets, options, and new restore locations for each file.</span></span> <span data-ttu-id="c7264-129">Esta información puede combinarse con la lista de archivos, componentes y ubicaciones alternativas.</span><span class="sxs-lookup"><span data-stu-id="c7264-129">This information can be combined with the list of files, components, and alternate locations.</span></span>

5.  <span data-ttu-id="c7264-130">Los archivos que no están protegidos por escritores se pueden seleccionar de una manera coherente con las operaciones de restauración tradicionales.</span><span class="sxs-lookup"><span data-stu-id="c7264-130">Files not protected by writers can be selected in a manner consistent with traditional restore operations.</span></span>

<span data-ttu-id="c7264-131">En este momento, un solicitante debe tener una lista de todos los archivos que necesita restaurar, junto con instrucciones sobre cómo restaurarlos, y puede empezar a restaurar archivos en función de:</span><span class="sxs-lookup"><span data-stu-id="c7264-131">At this point, a requester should have a list of all the files it needs to restore, along with instructions about how to restore them, and can begin restoring files on the basis of:</span></span>

-   <span data-ttu-id="c7264-132">Si las asignaciones de ubicación alternativas o la ubicación del archivo original se va a usar como destino para la restauración dependerá de la presencia o ausencia de un archivo en esa ubicación de destino y de la configuración de componentes de [**VSS \_ restore \_ target**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) y [**VSS \_ RESTOREMETHOD \_ enum**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (vea [ubicaciones de copia de seguridad y restauración no predeterminadas](non-default-backup-and-restore-locations.md)).</span><span class="sxs-lookup"><span data-stu-id="c7264-132">Whether alternate location mappings, or the original file location is to be used as the target for the restore will depend on the presence or absence of a file at that target location and component settings of [**VSS\_RESTORE\_TARGET**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) and [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)).</span></span>
-   <span data-ttu-id="c7264-133">Si un intento de restauración se realiza correctamente dependerá de problemas como los permisos de acceso del destino, si los archivos de destino están bloqueados y otros problemas convencionales implicados en la restauración de archivos.</span><span class="sxs-lookup"><span data-stu-id="c7264-133">Whether an attempt at restoration succeeds will depend on issues such as the access permissions of the target, if target files are locked, and other conventional issues involved in file restoration.</span></span>
-   <span data-ttu-id="c7264-134">El éxito o el error de la restauración de un componente determinado para una instancia del escritor determinada debe conservarse en el documento componentes de copia de seguridad llamando a [**IVssBackupComponents:: SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="c7264-134">The success or failure of restoring a given component for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span></span> <span data-ttu-id="c7264-135">Esto hará que la información sea accesible para los escritores Cuando procese el evento postrestore.</span><span class="sxs-lookup"><span data-stu-id="c7264-135">This will make the information accessible to writers when they process the PostRestore event.</span></span>
-   <span data-ttu-id="c7264-136">Si un archivo se restaura en una asignación de ubicación alternativa, el solicitante debe llamar a [**IVssBackupComponents:: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="c7264-136">If a file is restored to an alternate location mapping, the requester must call [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span></span> <span data-ttu-id="c7264-137">Esto permitirá que los escritores determinen si sus archivos se han restaurado en ubicaciones alternativas a través de [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="c7264-137">This will allow writers to determine whether their files have been restored to alternate locations through the [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="c7264-138">Los solicitantes pueden ser deseables para restaurar archivos en ubicaciones completamente nuevas.</span><span class="sxs-lookup"><span data-stu-id="c7264-138">Requesters may find it desirable to restore files to completely new locations.</span></span> <span data-ttu-id="c7264-139">Esto es aceptable, pero el solicitante debe indicar Esto al escritor mediante el método [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) .</span><span class="sxs-lookup"><span data-stu-id="c7264-139">This is acceptable, but the requester must indicate this to the writer by using the [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) method.</span></span>

 

 



