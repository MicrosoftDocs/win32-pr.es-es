---
description: Las tareas anteriores a la copia de seguridad en VSS se centran en crear una instantánea de los volúmenes que contienen datos para la copia de seguridad.
ms.assetid: e6b082af-719b-4426-8217-0fc940f5884d
title: Información general de las tareas anteriores a la copia de seguridad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 709345b8aa0421699efe26ad2901cc497b7d4ac0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "105696990"
---
# <a name="overview-of-pre-backup-tasks"></a><span data-ttu-id="b037a-103">Información general de las tareas anteriores a la copia de seguridad</span><span class="sxs-lookup"><span data-stu-id="b037a-103">Overview of Pre-Backup Tasks</span></span>

<span data-ttu-id="b037a-104">Las tareas anteriores a la copia de seguridad en VSS se centran en crear una instantánea de los volúmenes que contienen datos para la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b037a-104">Pre-backup tasks under VSS are focused on creating a shadow copy of the volumes containing data for backup.</span></span> <span data-ttu-id="b037a-105">La aplicación de copia de seguridad guardará los datos de la instantánea, no del volumen real.</span><span class="sxs-lookup"><span data-stu-id="b037a-105">The backup application will save data from the shadow copy, not the actual volume.</span></span> <span data-ttu-id="b037a-106">Para obtener más información, vea [información general sobre el procesamiento de una copia de seguridad en VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="b037a-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="b037a-107">Los solicitantes suelen esperar a que los escritores se preparen para la copia de seguridad y la creación de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-107">Requesters typically wait for writers to prepare for backup and creating the shadow copy.</span></span> <span data-ttu-id="b037a-108">El escritor debe determinar si va a participar en la copia de seguridad y, si es así, configurar sus archivos y para que estén listos para la copia de seguridad y la instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-108">The writer must determine if it is to participate in the backup and, if it is, configure its files and itself to be ready for backup and shadow copy.</span></span> <span data-ttu-id="b037a-109">En la tabla siguiente se muestra la secuencia de acciones y eventos necesarios para preparar una operación de copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b037a-109">The following table shows the sequence of actions and events that are required to prepare for a backup operation.</span></span>



| <span data-ttu-id="b037a-110">Acción del solicitante</span><span class="sxs-lookup"><span data-stu-id="b037a-110">Requester action</span></span>                                                                                                                                                                                                                                                                                                            | <span data-ttu-id="b037a-111">Evento</span><span class="sxs-lookup"><span data-stu-id="b037a-111">Event</span></span>                                                                      | <span data-ttu-id="b037a-112">Acción del escritor</span><span class="sxs-lookup"><span data-stu-id="b037a-112">Writer action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b037a-113">El solicitante puede establecer las opciones de copia de seguridad (vea [**IVssBackupComponents:: SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions)).</span><span class="sxs-lookup"><span data-stu-id="b037a-113">The requester can set backup options (see [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions))</span></span>                                                                                                                                                                                          | <span data-ttu-id="b037a-114">None</span><span class="sxs-lookup"><span data-stu-id="b037a-114">None</span></span>                                                                       | <span data-ttu-id="b037a-115">None</span><span class="sxs-lookup"><span data-stu-id="b037a-115">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="b037a-116">Se admiten las operaciones de copia de seguridad incrementales y diferenciales mediante el examen de las marcas de copia de seguridad almacenadas (vea [**IVssComponent:: GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents:: SetPreviousBackupStamp).**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)</span><span class="sxs-lookup"><span data-stu-id="b037a-116">Support incremental and differential backup operations by examining any stored backup stamps (see [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))</span></span>                                               | <span data-ttu-id="b037a-117">None</span><span class="sxs-lookup"><span data-stu-id="b037a-117">None</span></span>                                                                       | <span data-ttu-id="b037a-118">None</span><span class="sxs-lookup"><span data-stu-id="b037a-118">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="b037a-119">Notificar a los escritores que se preparen para una operación de copia de seguridad mediante [ **IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)</span><span class="sxs-lookup"><span data-stu-id="b037a-119">Notify writers to prepare for a backup operation using [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)</span></span>                                                                                                                                                                              | [<span data-ttu-id="b037a-120">*PrepareForBackup*</span><span class="sxs-lookup"><span data-stu-id="b037a-120">*PrepareForBackup*</span></span>](vssgloss-p.md)  | <span data-ttu-id="b037a-121">Los preparativos del escritor incluyen la determinación de si se debe hacer una copia de seguridad de los archivos, si el escritor participará en la inmovilización de instantáneas, así como para crear metadatos específicos del escritor (vea [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: GetBackupOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter:: AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata)y [**IVssComponent:**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp)</span><span class="sxs-lookup"><span data-stu-id="b037a-121">Writer preparations include determining if files are to be backed up, whether the writer will participate in the shadow copy freeze, as well as creating writer-specific metadata (see [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::GetBackupOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter::AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata), and [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> |
| <span data-ttu-id="b037a-122">El solicitante espera a que los escritores se configuren para la copia de seguridad mediante [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="b037a-122">The requester waits for writers to set up for backup using [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="b037a-123">También debe comprobar el estado del escritor (consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus).**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span><span class="sxs-lookup"><span data-stu-id="b037a-123">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus))</span></span>     | <span data-ttu-id="b037a-124">None</span><span class="sxs-lookup"><span data-stu-id="b037a-124">None</span></span>                                                                       | <span data-ttu-id="b037a-125">None</span><span class="sxs-lookup"><span data-stu-id="b037a-125">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="b037a-126">El solicitante solicita una instantánea mediante [ **IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)</span><span class="sxs-lookup"><span data-stu-id="b037a-126">Requester requests a shadow copy using [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)</span></span>                                                                                                                                                                                                    | <span data-ttu-id="b037a-127">None</span><span class="sxs-lookup"><span data-stu-id="b037a-127">None</span></span>                                                                       | <span data-ttu-id="b037a-128">None</span><span class="sxs-lookup"><span data-stu-id="b037a-128">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="b037a-129">None</span><span class="sxs-lookup"><span data-stu-id="b037a-129">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="b037a-130">*PrepareForSnapshot*</span><span class="sxs-lookup"><span data-stu-id="b037a-130">*PrepareForSnapshot*</span></span>](vssgloss-p.md) | <span data-ttu-id="b037a-131">[**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): pone el escritor en un estado listo para la instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-131">[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): Put the writer into a shadow copy ready state.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="b037a-132">None</span><span class="sxs-lookup"><span data-stu-id="b037a-132">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="b037a-133">*Inmovilizar*</span><span class="sxs-lookup"><span data-stu-id="b037a-133">*Freeze*</span></span>](vssgloss-f.md)                      | <span data-ttu-id="b037a-134">[**CVssWriter:: alfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): configuración final antes de la instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-134">[**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): Final setup before the shadow copy.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="b037a-135">None</span><span class="sxs-lookup"><span data-stu-id="b037a-135">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="b037a-136">*Reanudar*</span><span class="sxs-lookup"><span data-stu-id="b037a-136">*Thaw*</span></span>](vssgloss-t.md)                          | <span data-ttu-id="b037a-137">[**CVssWriter:: Alreanudar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): el funcionamiento normal (incluida la e/s) se puede reanudar.</span><span class="sxs-lookup"><span data-stu-id="b037a-137">[**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): Normal functioning (including I/O) can resume.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="b037a-138">None</span><span class="sxs-lookup"><span data-stu-id="b037a-138">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="b037a-139">*Instantánea*</span><span class="sxs-lookup"><span data-stu-id="b037a-139">*PostSnapshot*</span></span>](vssgloss-p.md)          | <span data-ttu-id="b037a-140">[**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): limpiezas finales de los preparados de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="b037a-140">[**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): Final clean ups of shadow copy preparations.</span></span> <span data-ttu-id="b037a-141">Vea [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) y [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="b037a-141">See [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) and [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="b037a-142">El solicitante espera la finalización de la instantánea mediante: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), también debe comprobar el estado del escritor (consulte [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span><span class="sxs-lookup"><span data-stu-id="b037a-142">Requester waits for completion of shadow copy using: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), it should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span></span><br/> | <span data-ttu-id="b037a-143">None</span><span class="sxs-lookup"><span data-stu-id="b037a-143">None</span></span>                                                                       | <span data-ttu-id="b037a-144">None</span><span class="sxs-lookup"><span data-stu-id="b037a-144">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |



 

## <a name="requester-pre-backup-tasks"></a><span data-ttu-id="b037a-145">Tareas anteriores a la copia de seguridad del solicitante</span><span class="sxs-lookup"><span data-stu-id="b037a-145">Requester Pre-Backup Tasks</span></span>

<span data-ttu-id="b037a-146">Además, antes de crear un evento [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , un solicitante también puede establecer opciones de copia de seguridad para escritores individuales mediante [**IVssBackupComponents:: SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) en función de los detalles de cada escritor y de si un solicitante es consciente de ellos.</span><span class="sxs-lookup"><span data-stu-id="b037a-146">In addition, before creating a [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, a requester may also set backup options for individual writers using [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) depending on the specifics of each writer and whether a requester is aware of them.</span></span>

<span data-ttu-id="b037a-147">Para admitir operaciones incrementales y diferenciales, los solicitantes pueden en este momento examinar los componentes para las marcas de tiempo de la operación de copia de seguridad anterior (mediante [**IVssComponent:: GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) y usar esa información para establecer una marca de tiempo anterior para que un escritor lo procese (mediante [**IVssBackupComponents:: SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)).</span><span class="sxs-lookup"><span data-stu-id="b037a-147">To support incremental and differential operations, requesters may at this point choose to examine components for time stamps of earlier backup operation (using [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) and use that information to set a previous time stamp for a writer to process (using [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)).</span></span> <span data-ttu-id="b037a-148">Para obtener más información [, vea copias de seguridad incrementales y diferenciales](incremental-and-differential-backups.md) .</span><span class="sxs-lookup"><span data-stu-id="b037a-148">See [Incremental and Differential Backups](incremental-and-differential-backups.md) for more information.</span></span>

<span data-ttu-id="b037a-149">Ahora, un solicitante puede dirigir los escritores del sistema para completar los preparativos de la copia de seguridad y controlar la creación de una instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-149">A requester can now direct the system's writers to complete pre-backup preparations and to handle the creation of a shadow copy.</span></span>

<span data-ttu-id="b037a-150">En primer lugar, el solicitante genera un evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) llamando a [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).</span><span class="sxs-lookup"><span data-stu-id="b037a-150">First, the requester generates a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).</span></span>

<span data-ttu-id="b037a-151">Después de que todos los escritores participantes devuelvan el control del evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) (que un solicitante determina mediante la instancia de la interfaz [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) devuelta por **PrepareForBackup**), el solicitante puede iniciar la instantánea llamando a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), que, a medida que progresa, generará [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*reanudar*](vssgloss-t.md)y [*postsnapshot*](vssgloss-p.md) eventos para que los escritores los controlen.</span><span class="sxs-lookup"><span data-stu-id="b037a-151">After all participating writers return from handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event (which a requester determines by using the instance of the [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) interface returned by **PrepareForBackup**), the requester can initiate the shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), which, as it progresses, will generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md) events for the writers to handle.</span></span>

<span data-ttu-id="b037a-152">Hay algunos casos en los que es posible que un solicitante no necesite crear una instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-152">There are some cases where a requester may not need to create a shadow copy.</span></span> <span data-ttu-id="b037a-153">En concreto, cada [*conjunto de archivos*](vssgloss-f.md) administrado por uno de los componentes de un escritor determinado tiene una máscara de copia de seguridad de especificación de archivo (indicada por una operación OR bit a bit de los valores del tipo de copia de seguridad de la especificación de [**\_ archivo \_ \_ \_ VSS**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) ) establecida durante el evento de [*identificación*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="b037a-153">Specifically, each [*file set*](vssgloss-f.md) managed by one of a given writer's components has a File Specification Backup mask (indicated by a bitwise OR of [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) values) set during the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="b037a-154">Esta máscara especifica, entre otras cosas, si un conjunto de archivos requiere que se realice una copia sombra del sistema antes de realizar la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b037a-154">This mask specifies, among other things, whether a file set requires the system to be shadow copied before its backup is performed.</span></span>

<span data-ttu-id="b037a-155">Si no es necesario realizar una copia de seguridad de los conjuntos de archivos de los que se va a hacer una copia de seguridad en los volúmenes, no es necesario llamar a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="b037a-155">If no file sets to be backed up on any volumes require a shadow copy, then [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) need not be called.</span></span>

## <a name="writer-pre-backup-tasks"></a><span data-ttu-id="b037a-156">Tareas de copia de seguridad previa del escritor</span><span class="sxs-lookup"><span data-stu-id="b037a-156">Writer Pre-Backup Tasks</span></span>

<span data-ttu-id="b037a-157">Al controlar el evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , VSS llamará al método [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) de cada redactor, un método virtual, que, de forma predeterminada, simplemente devuelve true.</span><span class="sxs-lookup"><span data-stu-id="b037a-157">When handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, VSS will call each writer's [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method, a virtual method, which by default simply returns true.</span></span>

<span data-ttu-id="b037a-158">Los escritores pueden invalidar esta implementación predeterminada y usar el control para buscar información acerca de la próxima copia de seguridad y tomar medidas.</span><span class="sxs-lookup"><span data-stu-id="b037a-158">Writers can override this default implementation and use the handling to find information about the upcoming backup and take action.</span></span>

<span data-ttu-id="b037a-159">Un escritor puede determinar la información sobre el tipo de operación de copia de seguridad conformada mediante los siguientes métodos:</span><span class="sxs-lookup"><span data-stu-id="b037a-159">A writer can determine information about the sort of backup operation contemplated by using the following methods:</span></span>

1.  [<span data-ttu-id="b037a-160">**CVssWriter::GetBackupType**</span><span class="sxs-lookup"><span data-stu-id="b037a-160">**CVssWriter::GetBackupType**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype)
2.  [<span data-ttu-id="b037a-161">**CVssWriter::IsBootableStateBackedUp**</span><span class="sxs-lookup"><span data-stu-id="b037a-161">**CVssWriter::IsBootableStateBackedUp**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup)
3.  [<span data-ttu-id="b037a-162">**CVssWriter::AreComponentsSelected**</span><span class="sxs-lookup"><span data-stu-id="b037a-162">**CVssWriter::AreComponentsSelected**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected)

<span data-ttu-id="b037a-163">Un escritor determina si los archivos que administra estarán implicados en la instantánea mediante [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected).</span><span class="sxs-lookup"><span data-stu-id="b037a-163">A writer determines if the files it manages will be involved in the shadow copy by using [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected).</span></span>

<span data-ttu-id="b037a-164">Lo que es más importante, cuando VSS llama al método [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) , pasa una instancia de la interfaz [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , que permite el acceso directo a través de la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) a los de sus componentes [*incluidos explícitamente*](vssgloss-e.md) en el documento de componentes de copia de seguridad del solicitante.</span><span class="sxs-lookup"><span data-stu-id="b037a-164">More important, when VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method, it passes in an instance of the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, which allows direct access through the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to those of its components [*explicitly included*](vssgloss-e.md) in the requester's Backup Components Document.</span></span> <span data-ttu-id="b037a-165">El escritor usaba las instancias de la interfaz **IVssComponent** que definen los conjuntos de componentes para obtener acceso a su componente *incluido implícitamente* (consulte [seleccionar y trabajar con propiedades de componentes](selectability-and-working-with-component-properties.md)).</span><span class="sxs-lookup"><span data-stu-id="b037a-165">The writer used the instances of the **IVssComponent** interface that define component sets to gain access to its *implicitly included* component (see [Selectability and working with Component Properties](selectability-and-working-with-component-properties.md)).</span></span>

<span data-ttu-id="b037a-166">Durante el control del evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , los escritores usan la interfaz [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) para realizar operaciones componente a componente (o conjunto de componentes por conjunto de componentes), incluidas las siguientes:</span><span class="sxs-lookup"><span data-stu-id="b037a-166">During the handling of the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, writers use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to perform component-by-component (or component set by component set) operations, including:</span></span>

1.  <span data-ttu-id="b037a-167">Agregar [*archivos parciales*](vssgloss-p.md) (si se admiten) mediante una llamada a [**IVssComponent:: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="b037a-167">Adding [*partial files*](vssgloss-p.md) (if supported) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>
2.  <span data-ttu-id="b037a-168">Establecer los metadatos privados que el escritor deberá controlar la restauración.</span><span class="sxs-lookup"><span data-stu-id="b037a-168">Setting any private metadata that the writer will need to handle the restore.</span></span>
3.  <span data-ttu-id="b037a-169">Si el escritor admite copias de seguridad incrementales y diferenciales (vea [copias de seguridad incrementales y diferenciales](incremental-and-differential-backups.md)), haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b037a-169">If the writer supports incremental and differential backups (see [Incremental and Differential Backups](incremental-and-differential-backups.md)), doing the following:</span></span>
    -   <span data-ttu-id="b037a-170">Comprobando las marcas de tiempo de copia de seguridad anteriores mediante una llamada a [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="b037a-170">Checking for previous backup time stamps by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>
    -   <span data-ttu-id="b037a-171">Agregar los [*archivos de diferencias*](vssgloss-d.md) necesarios llamando a [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span><span class="sxs-lookup"><span data-stu-id="b037a-171">Adding any required [*differenced files*](vssgloss-d.md) by calling [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span></span>
    -   <span data-ttu-id="b037a-172">Si el escritor admite el esquema de marca de tiempo de **VSS \_ BS \_** , agrega cadenas de marca de tiempo de copia de seguridad en el propio formato del escritor mediante [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="b037a-172">If the writer supports the **VSS\_BS\_TIMESTAMPED** schema, adding backup time-stamp strings in the writer's own format using [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span>
4.  <span data-ttu-id="b037a-173">Iniciar operaciones asincrónicas que consumen mucho tiempo, como la sincronización de datos en varios discos.</span><span class="sxs-lookup"><span data-stu-id="b037a-173">Initiating very time-consuming asynchronous operations, such as synchronizing data across multiple disks.</span></span> <span data-ttu-id="b037a-174">Esto permitirá que el escritor siga funcionando mientras se procesa la operación, incluido el control de otros eventos de VSS.</span><span class="sxs-lookup"><span data-stu-id="b037a-174">This will allow the writer to continue working while the operation is processed, including handling other VSS events.</span></span> <span data-ttu-id="b037a-175">Estas operaciones deben finalizar antes del evento [*Freeze*](vssgloss-f.md) .</span><span class="sxs-lookup"><span data-stu-id="b037a-175">These operations must terminate before the [*Freeze*](vssgloss-f.md) event.</span></span>

<span data-ttu-id="b037a-176">La llamada del solicitante a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) inicia la instantánea y genera los siguientes eventos para que los escritores los controlen:</span><span class="sxs-lookup"><span data-stu-id="b037a-176">The requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) initiates the shadow copy and generates the following events for the writers to handle:</span></span>

-   [<span data-ttu-id="b037a-177">*PrepareForSnapshot*</span><span class="sxs-lookup"><span data-stu-id="b037a-177">*PrepareForSnapshot*</span></span>](vssgloss-p.md)
-   [<span data-ttu-id="b037a-178">*Inmovilizar*</span><span class="sxs-lookup"><span data-stu-id="b037a-178">*Freeze*</span></span>](vssgloss-f.md)
-   [<span data-ttu-id="b037a-179">*Reanudar*</span><span class="sxs-lookup"><span data-stu-id="b037a-179">*Thaw*</span></span>](vssgloss-t.md)
-   [<span data-ttu-id="b037a-180">*Instantánea*</span><span class="sxs-lookup"><span data-stu-id="b037a-180">*PostSnapshot*</span></span>](vssgloss-p.md)

<span data-ttu-id="b037a-181">Tres de los controladores del escritor ([**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter:: alfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)y [**CVssWriter:: alreanudar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) son métodos virtuales puros y cada escritor debe implementarlos en lugar de confiar en los valores predeterminados.</span><span class="sxs-lookup"><span data-stu-id="b037a-181">Three of the writer's handlers—[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)—are pure virtual methods, and each writer must implement them rather than relying on defaults.</span></span> <span data-ttu-id="b037a-182">Dependiendo de las necesidades de un escritor, se pueden codificar como métodos ficticios, simplemente devolviendo **true**.</span><span class="sxs-lookup"><span data-stu-id="b037a-182">Depending on a writer's needs, they may be coded as dummy methods, simply returning **TRUE**.</span></span>

<span data-ttu-id="b037a-183">Dado que normalmente hay un período de tiempo limitado entre la emisión de un evento [*Freeze*](vssgloss-f.md) y la emisión de un evento [*procongelar*](vssgloss-t.md) , la mayor parte del trabajo principal en la preparación de la instantánea, como el apagado de procesos, la creación de archivos temporales o la purga de colas de e/s, se administraría en [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot).</span><span class="sxs-lookup"><span data-stu-id="b037a-183">Because there is typically a narrow time window between the issuing of a [*Freeze*](vssgloss-f.md) event and the issuing of a [*Thaw*](vssgloss-t.md) event, most of the major work in preparing for the shadow copy—such as shutting down processes, creating temporary files, or draining I/O queues—would be handled in [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot).</span></span>

<span data-ttu-id="b037a-184">Cómo un escritor podría usar [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) para controlar su e/s antes de que la creación de una instantánea dependa en gran medida de la arquitectura del escritor.</span><span class="sxs-lookup"><span data-stu-id="b037a-184">How a writer might use [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) to handle its I/O before the creation of a shadow copy is highly dependent on the writer's own architecture.</span></span>

<span data-ttu-id="b037a-185">Los escritores que pueden permitirse mantener todas las escrituras y mantener los datos en un estado coherente absoluto antes de la [*inmovilización*](vssgloss-f.md)deben hacerlo.</span><span class="sxs-lookup"><span data-stu-id="b037a-185">Writers that can afford to hold all writes and keep the data in an absolute consistent state before [*Freeze*](vssgloss-f.md), should do so.</span></span>

<span data-ttu-id="b037a-186">Si el escritor no puede inmovilizar su e/s, debe tomar medidas para crear un origen estable para la copia de seguridad y reducir el tiempo de recuperación de una instantánea.</span><span class="sxs-lookup"><span data-stu-id="b037a-186">If the writer cannot freeze its I/O, then it should take actions to create a stable source for backup and to reduce the recovery time for a shadow copy.</span></span> <span data-ttu-id="b037a-187">Ejemplos de esto pueden incluir solicitudes de e/s de entrada en cola o generar un conjunto duplicado de archivos en una [*ruta de acceso alternativa*](vssgloss-a.md) que se utilizará como origen de una copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b037a-187">Examples of this might include queuing incoming I/O requests or generating a duplicate set of files in an [*alternate path*](vssgloss-a.md) to be used as the source of a backup.</span></span>

<span data-ttu-id="b037a-188">El método [**CVssWriter:: alfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) realiza tareas simples y cortas, como comprobar que la e/s izquierda [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) en el estado correcto y que las tareas asincrónicas iniciadas por [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) se han completado.</span><span class="sxs-lookup"><span data-stu-id="b037a-188">The [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) method performs simple, short tasks such as verifying that the [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) left I/O in the correct state, and that any asynchronous tasks started by [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) completed.</span></span> <span data-ttu-id="b037a-189">Este método es la última oportunidad de un escritor de vetar una instantánea si hay problemas (vea los [errores y vetos del escritor](writer-errors-and-vetoes.md)).</span><span class="sxs-lookup"><span data-stu-id="b037a-189">This method is a writer's last chance to veto a shadow copy if there are problems (see [Writer Errors and Vetoes](writer-errors-and-vetoes.md)).</span></span>

<span data-ttu-id="b037a-190">Por lo general, es posible que un escritor reanude la operación normal después de un evento de [*reanudación*](vssgloss-t.md) : es posible que una instantánea no esté lista inmediatamente para la copia de seguridad después de la reanudación, pero un escritor debe ser capaz de reanudar el funcionamiento normal.</span><span class="sxs-lookup"><span data-stu-id="b037a-190">It is generally possible for a writer to resume normal operation following a [*Thaw*](vssgloss-t.md) event: a shadow copy may not be immediately ready for backup after the Thaw, but a writer should be able to resume normal operation.</span></span> <span data-ttu-id="b037a-191">Por lo tanto, los escritores usan normalmente [**CVssWriter:: Alreanudar**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) para volver a un estado de precongelación.</span><span class="sxs-lookup"><span data-stu-id="b037a-191">Therefore, typically [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) is used by writers to return to a pre-freeze state.</span></span> <span data-ttu-id="b037a-192">Sin embargo, los archivos temporales creados para admitir la instantánea deben dejarse en vigor hasta el evento [*postsnapshot*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="b037a-192">However, any temporary files created to support the shadow copy should be left in place until the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="b037a-193">Normalmente, se usaría [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) para este tipo de limpieza.</span><span class="sxs-lookup"><span data-stu-id="b037a-193">Typically, you would use [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) for this sort of cleanup.</span></span> <span data-ttu-id="b037a-194">Dado que muchas aplicaciones no requieren este tipo de limpieza, **CVssWriter:: OnPostSnapshot** es un método virtual con una implementación predeterminada que simplemente devuelve **true**.</span><span class="sxs-lookup"><span data-stu-id="b037a-194">Because many applications do not require this sort of cleanup, **CVssWriter::OnPostSnapshot** is a virtual method with a default implementation that simply returns **TRUE**.</span></span> <span data-ttu-id="b037a-195">Si se realiza una copia de seguridad incremental o diferencial, el escritor puede llamar a [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) y [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="b037a-195">If an incremental or differential backup is being performed, the writer may call [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) and [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span> <span data-ttu-id="b037a-196">Para obtener más información, consulte [rol de escritor en copias de seguridad de almacenes complejos](writer-role-in-backing-up-complex-stores.md).</span><span class="sxs-lookup"><span data-stu-id="b037a-196">For more information, see [Writer Role in Backing Up Complex Stores](writer-role-in-backing-up-complex-stores.md).</span></span> <span data-ttu-id="b037a-197">Otro método al que se puede llamar en este momento es [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span><span class="sxs-lookup"><span data-stu-id="b037a-197">Another method that can be called at this time is [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span></span>

 

 




