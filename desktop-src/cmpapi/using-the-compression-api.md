---
description: Muchas aplicaciones necesitan usar la compresión y descompresión de datos sin pérdida de información. La API de compresión simplifica esto al exponer algoritmos de compresión de Windows a través de una API pública.
ms.assetid: D603A7DE-D4A1-4515-9702-B03C81504661
title: Uso de la API de compresión
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 01eff163f4ea1ccf03e1cd4ac9cb16a26afeb265
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104153394"
---
# <a name="using-the-compression-api"></a><span data-ttu-id="9976e-104">Uso de la API de compresión</span><span class="sxs-lookup"><span data-stu-id="9976e-104">Using the Compression API</span></span>

<span data-ttu-id="9976e-105">Muchas aplicaciones necesitan usar la compresión y descompresión de datos sin pérdida de información.</span><span class="sxs-lookup"><span data-stu-id="9976e-105">Many applications need to use lossless data compression and decompression.</span></span> <span data-ttu-id="9976e-106">La API de compresión simplifica esto al exponer algoritmos de compresión de Windows a través de una API pública.</span><span class="sxs-lookup"><span data-stu-id="9976e-106">The Compression API simplifies this by exposing Windows compression algorithms through a public API.</span></span> <span data-ttu-id="9976e-107">Cada algoritmo de compresión tiene un conjunto de propiedades que controla su comportamiento.</span><span class="sxs-lookup"><span data-stu-id="9976e-107">Each compression algorithm has a set of properties that controls its behavior.</span></span> <span data-ttu-id="9976e-108">La API de compresión expone una interfaz que permite al desarrollador establecer o consultar los valores de estas propiedades.</span><span class="sxs-lookup"><span data-stu-id="9976e-108">The Compression API exposes an interface that enables the developer to set or query the values of these properties.</span></span> <span data-ttu-id="9976e-109">Todas las propiedades de los algoritmos de compresión admitidos tienen valores predeterminados que representan los valores de estas propiedades que se usan habitualmente.</span><span class="sxs-lookup"><span data-stu-id="9976e-109">All properties for the supported compression algorithms have default values representing commonly used values of these properties.</span></span> <span data-ttu-id="9976e-110">Si se requiere una propiedad para la compresión y la descompresión, los valores predeterminados serán idénticos, asegurándose de que se usan valores idénticos para la compresión y la descompresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-110">If a property is required for both compression and decompression, the default values will be identical, ensuring identical values are used for compression and decompression.</span></span>

## <a name="selecting-the-compression-algorithm"></a><span data-ttu-id="9976e-111">Seleccionar el algoritmo de compresión</span><span class="sxs-lookup"><span data-stu-id="9976e-111">Selecting the compression algorithm</span></span>

<span data-ttu-id="9976e-112">Después de que un desarrollador decida que una aplicación necesita comprimir o descomprimir datos, el paso siguiente consiste en elegir un algoritmo de compresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-112">After a developer decides that an application needs to compress or decompress data, the next step is to choose a compression algorithm.</span></span> <span data-ttu-id="9976e-113">Esto puede depender de las pruebas para encontrar la mejor combinación de velocidad, razón de compresión y requisito de memoria para una aplicación determinada.</span><span class="sxs-lookup"><span data-stu-id="9976e-113">This may depend upon tests to find the best performing combination of speed, compression ratio, and memory requirement for a particular application.</span></span> <span data-ttu-id="9976e-114">La lista siguiente proporciona una comparación relativa de los algoritmos de compresión que admite actualmente la API de compresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-114">The following list gives a relative comparison of the compression algorithms currently supported by the Compression API.</span></span> <span data-ttu-id="9976e-115">No todas las opciones están disponibles para todos los algoritmos de compresión y la comparación es aproximada, ya que el rendimiento puede depender de los datos de entrada.</span><span class="sxs-lookup"><span data-stu-id="9976e-115">Not every option is available for every compression algorithm, and the comparison is approximate because performance can depend on the input data.</span></span>

<span data-ttu-id="9976e-116">XPRESS (**compress \_ algorithm \_ Xpress**)</span><span class="sxs-lookup"><span data-stu-id="9976e-116">XPRESS (**COMPRESS\_ALGORITHM\_XPRESS**)</span></span>

-   <span data-ttu-id="9976e-117">Muy rápido con pocos requisitos de recursos</span><span class="sxs-lookup"><span data-stu-id="9976e-117">Very fast with low resource requirements</span></span>
-   <span data-ttu-id="9976e-118">Razón de compresión media</span><span class="sxs-lookup"><span data-stu-id="9976e-118">Medium compression ratio</span></span>
-   <span data-ttu-id="9976e-119">Velocidades de compresión y descompresión elevadas</span><span class="sxs-lookup"><span data-stu-id="9976e-119">High compression and decompression speeds</span></span>
-   <span data-ttu-id="9976e-120">Requisito de memoria insuficiente</span><span class="sxs-lookup"><span data-stu-id="9976e-120">Low memory requirement</span></span>
-   <span data-ttu-id="9976e-121">Admite la **opción \_ comprimir \_ \_ nivel de clase de información** disponible en la enumeración [**comprimir \_ \_ clase de información**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="9976e-121">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option available in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="9976e-122">El valor predeterminado es **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="9976e-122">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="9976e-123">En algunos datos, el valor **(DWORD) 1** puede mejorar la razón de compresión con una velocidad de compresión ligeramente más lenta.</span><span class="sxs-lookup"><span data-stu-id="9976e-123">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="9976e-124">XPRESS con codificación Huffman (**compress \_ algorithm \_ Xpress \_ García**)</span><span class="sxs-lookup"><span data-stu-id="9976e-124">XPRESS with Huffman encoding (**COMPRESS\_ALGORITHM\_XPRESS\_HUFF**)</span></span>

-   <span data-ttu-id="9976e-125">La razón de compresión es mayor que **compress \_ algorithm \_ Xpress**</span><span class="sxs-lookup"><span data-stu-id="9976e-125">Compression ratio is higher than **COMPRESS\_ALGORITHM\_XPRESS**</span></span>
-   <span data-ttu-id="9976e-126">Razón de compresión media</span><span class="sxs-lookup"><span data-stu-id="9976e-126">Medium compression ratio</span></span>
-   <span data-ttu-id="9976e-127">Velocidades de compresión y descompresión medianos alta</span><span class="sxs-lookup"><span data-stu-id="9976e-127">Medium to high compression and decompression speeds</span></span>
-   <span data-ttu-id="9976e-128">Requisito de memoria insuficiente</span><span class="sxs-lookup"><span data-stu-id="9976e-128">Low memory requirement</span></span>
-   <span data-ttu-id="9976e-129">Admite la **opción \_ comprimir \_ \_ nivel de clase de información** en la enumeración [**comprimir \_ \_ clase de información**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="9976e-129">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="9976e-130">El valor predeterminado es **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="9976e-130">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="9976e-131">En algunos datos, el valor **(DWORD) 1** puede mejorar la razón de compresión con una velocidad de compresión ligeramente más lenta.</span><span class="sxs-lookup"><span data-stu-id="9976e-131">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="9976e-132">MSZIP (**comprimir \_ algoritmo \_ MSZIP**)</span><span class="sxs-lookup"><span data-stu-id="9976e-132">MSZIP (**COMPRESS\_ALGORITHM\_MSZIP**)</span></span>

-   <span data-ttu-id="9976e-133">Usa más recursos que **compress \_ algorithm \_ Xpress \_ García**</span><span class="sxs-lookup"><span data-stu-id="9976e-133">Uses more resources than **COMPRESS\_ALGORITHM\_XPRESS\_HUFF**</span></span>
-   <span data-ttu-id="9976e-134">Genera un bloque comprimido similar a RFC 1951.</span><span class="sxs-lookup"><span data-stu-id="9976e-134">Generates a compressed block similar to RFC 1951.</span></span>
-   <span data-ttu-id="9976e-135">Razón de compresión media a alta</span><span class="sxs-lookup"><span data-stu-id="9976e-135">Medium to high compression ratio</span></span>
-   <span data-ttu-id="9976e-136">Velocidad de compresión media y velocidad de descompresión alta</span><span class="sxs-lookup"><span data-stu-id="9976e-136">Medium compression speed and high decompression speed</span></span>
-   <span data-ttu-id="9976e-137">Requisito de memoria media</span><span class="sxs-lookup"><span data-stu-id="9976e-137">Medium memory requirement</span></span>

<span data-ttu-id="9976e-138">LZMS (**comprimir \_ algoritmo \_ LZMS**)</span><span class="sxs-lookup"><span data-stu-id="9976e-138">LZMS (**COMPRESS\_ALGORITHM\_LZMS**)</span></span>

-   <span data-ttu-id="9976e-139">Buen algoritmo si el tamaño de los datos que se van a comprimir es superior a 2 MB.</span><span class="sxs-lookup"><span data-stu-id="9976e-139">Good algorithm if the size of the data to be compressed is over 2MB.</span></span>
-   <span data-ttu-id="9976e-140">Razón de compresión alta</span><span class="sxs-lookup"><span data-stu-id="9976e-140">High compression ratio</span></span>
-   <span data-ttu-id="9976e-141">Velocidad de compresión baja y velocidad de descompresión alta</span><span class="sxs-lookup"><span data-stu-id="9976e-141">Low compression speed and high decompression speed</span></span>
-   <span data-ttu-id="9976e-142">Requisitos de memoria media y alta</span><span class="sxs-lookup"><span data-stu-id="9976e-142">Medium to high memory requirement</span></span>
-   <span data-ttu-id="9976e-143">Admite la opción de **tamaño de bloque comprimir \_ \_ clase \_ \_ de información** en la enumeración [**comprimir \_ \_ clase de información**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="9976e-143">Supports the **COMPRESS\_INFORMATION\_CLASS\_BLOCK\_SIZE** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="9976e-144">Se sugiere un tamaño mínimo de 1 MB para obtener una mejor relación de compresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-144">A minimum size of 1 MB is suggested to get a better compression ratio.</span></span>

## <a name="deciding-which-compression-api-mode-to-use"></a><span data-ttu-id="9976e-145">Decidir qué modo de API de compresión usar</span><span class="sxs-lookup"><span data-stu-id="9976e-145">Deciding which Compression API mode to use</span></span>

<span data-ttu-id="9976e-146">Después de que un desarrollador Seleccione el algoritmo de compresión, la siguiente decisión es cuál de los dos modos de la API de compresión usar: modo de búfer o modo de bloque.</span><span class="sxs-lookup"><span data-stu-id="9976e-146">After a developer selects the compression algorithm, the next decision is which of the two modes of the Compression API to use: buffer mode or block mode.</span></span> <span data-ttu-id="9976e-147">El modo de búfer se desarrolló para facilitar su uso y se recomienda para la mayoría de los casos.</span><span class="sxs-lookup"><span data-stu-id="9976e-147">Buffer mode was developed for ease of use and is recommended for most cases.</span></span>

<span data-ttu-id="9976e-148">El modo de búfer divide automáticamente el búfer de entrada en bloques de un tamaño adecuado para el algoritmo de compresión seleccionado.</span><span class="sxs-lookup"><span data-stu-id="9976e-148">Buffer mode automatically splits up the input buffer into blocks of a size that is appropriate for the selected compression algorithm.</span></span> <span data-ttu-id="9976e-149">El modo de búfer aplica formato y almacena automáticamente el tamaño de búfer sin comprimir en el búfer comprimido.</span><span class="sxs-lookup"><span data-stu-id="9976e-149">The buffer mode automatically formats and stores the uncompressed buffer size in the compressed buffer.</span></span> <span data-ttu-id="9976e-150">El tamaño del búfer comprimido no se guarda automáticamente y la aplicación tiene que guardarlo para la descompresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-150">The size of the compressed buffer is not automatically saved, and the application needs to save this for decompression.</span></span> <span data-ttu-id="9976e-151">No incluya la marca **compress \_ raw** en el parámetro *algorithm* cuando llame a [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) y [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) para usar el modo de búfer.</span><span class="sxs-lookup"><span data-stu-id="9976e-151">Do not include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use buffer mode.</span></span> <span data-ttu-id="9976e-152">Para obtener un ejemplo de código de una aplicación de modo de búfer, consulte la sección [uso de la API de compresión en modo de búfer](using-the-compression-api-in-buffer-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="9976e-152">For a code example of a buffer mode application, see the [Using the Compression API in buffer mode](using-the-compression-api-in-buffer-mode.md) section.</span></span>

<span data-ttu-id="9976e-153">El modo de bloqueo permite al desarrollador controlar el tamaño de bloque, pero la aplicación requiere más trabajo.</span><span class="sxs-lookup"><span data-stu-id="9976e-153">Block mode enables the developer to control the block size, but requires more work be done by the application.</span></span> <span data-ttu-id="9976e-154">Al usar el modo de bloqueo, la aplicación tiene que interrumpir los datos de entrada en piezas de tamaño adecuado al comprimir y, a continuación, volver a colocar los fragmentos al descomprimir.</span><span class="sxs-lookup"><span data-stu-id="9976e-154">When using block mode, the application has to break the input data into appropriately sized pieces when compressing and then put the pieces back together when decompressing.</span></span> <span data-ttu-id="9976e-155">El modo de bloqueo produce un error si el tamaño del búfer de entrada es mayor que el tamaño de bloque interno del algoritmo de compresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-155">The block mode fails if the size of the input buffer is greater than the internal block size of the compression algorithm.</span></span> <span data-ttu-id="9976e-156">El tamaño de bloque interno es de 32 KB para MSZIP y 1 GB para los algoritmos de compresión XPRESS.</span><span class="sxs-lookup"><span data-stu-id="9976e-156">The internal block size is 32KB for the MSZIP and 1GB for the XPRESS compression algorithms.</span></span> <span data-ttu-id="9976e-157">El tamaño de bloque interno para LZMS es configurable hasta 64 GB con un aumento de uso de memoria correspondiente.</span><span class="sxs-lookup"><span data-stu-id="9976e-157">The internal block size for LZMS is configurable up to 64GB with a corresponding increase in memory use.</span></span> <span data-ttu-id="9976e-158">El tamaño del búfer comprimido no se guarda automáticamente y la aplicación también necesita guardarlo para la descompresión.</span><span class="sxs-lookup"><span data-stu-id="9976e-158">The size of the compressed buffer is not automatically saved, and the application also needs to save this for decompression.</span></span> <span data-ttu-id="9976e-159">El valor del parámetro *UncompressedBufferSize* de [**descomprimir**](/windows/desktop/api/compressapi/nf-compressapi-decompress) debe ser exactamente igual al tamaño original de los datos sin comprimir y no solo al tamaño del búfer de salida.</span><span class="sxs-lookup"><span data-stu-id="9976e-159">The value of *UncompressedBufferSize* parameter of [**Decompress**](/windows/desktop/api/compressapi/nf-compressapi-decompress) must be exactly equal to the original size of the uncompressed data and not just the size of the output buffer.</span></span> <span data-ttu-id="9976e-160">Esto significa que la aplicación debe guardar el tamaño original exacto de los datos sin comprimir, así como los datos comprimidos y el tamaño comprimido, al usar el modo de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="9976e-160">This means your application should save the exact original size of the uncompressed data, as well as the compressed data and compressed size, when using block mode.</span></span> <span data-ttu-id="9976e-161">Incluya la **marca compress \_ raw** en el parámetro *algorithm* cuando llame a [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) y [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) para usar el modo de bloqueo.</span><span class="sxs-lookup"><span data-stu-id="9976e-161">Include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call both [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use block mode.</span></span> <span data-ttu-id="9976e-162">Para obtener un ejemplo de código de una aplicación en modo de bloque, consulte la sección [uso de la API de compresión en modo de bloqueo](using-the-compression-api-in-block-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="9976e-162">For a code example of a block mode application, see the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section.</span></span>

## <a name="custom-memory-allocation"></a><span data-ttu-id="9976e-163">Asignación de memoria personalizada</span><span class="sxs-lookup"><span data-stu-id="9976e-163">Custom memory allocation</span></span>

<span data-ttu-id="9976e-164">Las aplicaciones en modo de búfer y de bloque tienen la opción de especificar una rutina de asignación de memoria personalizada cuando llaman a [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) y [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span><span class="sxs-lookup"><span data-stu-id="9976e-164">Buffer and block mode applications have the option to specify a custom memory allocation routine when they call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span></span> <span data-ttu-id="9976e-165">El parámetro *AllocationRoutines* especifica la estructura de [**\_ \_ rutinas de asignación de compresión**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) que contiene la rutina de asignación de memoria.</span><span class="sxs-lookup"><span data-stu-id="9976e-165">The *AllocationRoutines* parameter specifies the [**COMPRESS\_ALLOCATION\_ROUTINES**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) structure that contains the memory allocation routine.</span></span> <span data-ttu-id="9976e-166">A continuación, la aplicación puede establecer el tamaño de bloque para el compresor mediante [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span><span class="sxs-lookup"><span data-stu-id="9976e-166">The application can then set the block size for the compressor using [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span></span> <span data-ttu-id="9976e-167">Consulte la sección [uso de la API de compresión en modo de bloqueo](using-the-compression-api-in-block-mode.md) para ver un ejemplo de una rutina de asignación personalizada simple.</span><span class="sxs-lookup"><span data-stu-id="9976e-167">See the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section for an example of a simple customized allocation routine.</span></span>

 

 



