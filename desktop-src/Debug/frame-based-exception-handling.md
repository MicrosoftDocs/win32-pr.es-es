---
description: Un controlador de excepciones basado en marcos permite solucionar la posibilidad de que se produzca una excepción en una secuencia determinada de código. Un controlador de excepciones basado en marco consta de los siguientes elementos.
ms.assetid: 07aac772-f917-48b7-91a9-3b5d4cb43600
title: Control de excepciones basado en marcos
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12b268b5d02de83bca22a1d3311905b05be1f748
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104496384"
---
# <a name="frame-based-exception-handling"></a><span data-ttu-id="fe9c7-104">Control de excepciones basado en marcos</span><span class="sxs-lookup"><span data-stu-id="fe9c7-104">Frame-based Exception Handling</span></span>

<span data-ttu-id="fe9c7-105">Un *controlador de excepciones basado en marcos* permite solucionar la posibilidad de que se produzca una excepción en una secuencia determinada de código.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-105">A *frame-based exception handler* allows you to deal with the possibility that an exception may occur in a certain sequence of code.</span></span> <span data-ttu-id="fe9c7-106">Un controlador de excepciones basado en marco consta de los siguientes elementos.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-106">A frame-based exception handler consists of the following elements.</span></span>

-   <span data-ttu-id="fe9c7-107">Un cuerpo protegido del código</span><span class="sxs-lookup"><span data-stu-id="fe9c7-107">A guarded body of code</span></span>
-   <span data-ttu-id="fe9c7-108">Una expresión de filtro</span><span class="sxs-lookup"><span data-stu-id="fe9c7-108">A filter expression</span></span>
-   <span data-ttu-id="fe9c7-109">Un bloque de controlador de excepciones</span><span class="sxs-lookup"><span data-stu-id="fe9c7-109">An exception-handler block</span></span>

<span data-ttu-id="fe9c7-110">Los controladores de excepciones basados en marcos se declaran en la sintaxis específica del lenguaje.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-110">Frame-based exception handlers are declared in language-specific syntax.</span></span> <span data-ttu-id="fe9c7-111">Por ejemplo, en el compilador de optimización de C/C++ de Microsoft, se implementan mediante **\_ \_ try** y **\_ \_ Except**.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-111">For example, in the Microsoft C/C++ Optimizing Compiler, they are implemented using **\_\_try** and **\_\_except**.</span></span> <span data-ttu-id="fe9c7-112">Para obtener más información, vea [Sintaxis de controlador](handler-syntax.md).</span><span class="sxs-lookup"><span data-stu-id="fe9c7-112">For more information, see [Handler Syntax](handler-syntax.md).</span></span>

<span data-ttu-id="fe9c7-113">El *cuerpo protegido del código* es un conjunto de una o varias instrucciones para las que la expresión de filtro y el bloque de controlador de excepciones proporcionan protección de control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-113">The *guarded body of code* is a set of one or more statements for which the filter expression and the exception-handler block provide exception-handling protection.</span></span> <span data-ttu-id="fe9c7-114">El cuerpo protegido puede ser un bloque de código, un conjunto de bloques anidados o un procedimiento o una función completos.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-114">The guarded body can be a block of code, a set of nested blocks, or an entire procedure or function.</span></span> <span data-ttu-id="fe9c7-115">Mediante el compilador de optimización de C/C++ de Microsoft, un cuerpo protegido se incluye entre llaves ( {} ) después de la palabra clave **\_ \_ try** .</span><span class="sxs-lookup"><span data-stu-id="fe9c7-115">Using the Microsoft C/C++ Optimizing Compiler, a guarded body is enclosed by braces ({}) following the **\_\_try** keyword.</span></span>

<span data-ttu-id="fe9c7-116">La *expresión de filtro* de un controlador de excepciones basado en marcos es una expresión evaluada por el sistema cuando se produce una excepción en el cuerpo protegido.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-116">The *filter expression* of a frame-based exception handler is an expression that is evaluated by the system when an exception occurs within the guarded body.</span></span> <span data-ttu-id="fe9c7-117">Esta evaluación da como resultado una de las siguientes acciones del sistema.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-117">This evaluation results in one of the following actions by the system.</span></span>

-   <span data-ttu-id="fe9c7-118">El sistema detiene su búsqueda de un controlador de excepciones, restaura el estado del equipo y continúa la ejecución del subproceso en el punto en el que se produjo la excepción.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-118">The system stops its search for an exception handler, restores the machine state, and continues thread execution at the point at which the exception occurred.</span></span>
-   <span data-ttu-id="fe9c7-119">El sistema continúa buscando un controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-119">The system continues its search for an exception handler.</span></span>
-   <span data-ttu-id="fe9c7-120">El sistema transfiere el control al controlador de excepciones y la ejecución de subprocesos continúa secuencialmente en el marco de pila en el que se encuentra el controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-120">The system transfers control to the exception handler, and thread execution continues sequentially in the stack frame in which the exception handler is found.</span></span> <span data-ttu-id="fe9c7-121">Si el controlador no está en el marco de pila en el que se produjo la excepción, el sistema desenreda la pila, saliendo del marco de pila actual y de cualquier otro marco de pila hasta que vuelva al marco de pila del controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-121">If the handler is not in the stack frame in which the exception occurred, the system unwinds the stack, leaving the current stack frame and any other stack frames until it is back to the exception handler's stack frame.</span></span> <span data-ttu-id="fe9c7-122">Antes de que se ejecute un controlador de excepciones, los controladores de terminación se ejecutan para los cuerpos protegidos del código que finalizaron como resultado de la transferencia de control al controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-122">Before an exception handler is executed, termination handlers are executed for any guarded bodies of code that terminated as a result of the transfer of control to the exception handler.</span></span> <span data-ttu-id="fe9c7-123">Para obtener más información sobre los controladores de terminación, consulte [control de finalización](termination-handling.md).</span><span class="sxs-lookup"><span data-stu-id="fe9c7-123">For more information about termination handlers, refer to [Termination Handling](termination-handling.md).</span></span>

<span data-ttu-id="fe9c7-124">La expresión de filtro puede ser una expresión simple o puede invocar una *función de filtro* que intenta controlar la excepción.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-124">The filter expression can be a simple expression, or it can invoke a *filter function* that attempts to handle the exception.</span></span> <span data-ttu-id="fe9c7-125">Puede llamar a las funciones [**GetExceptionCode**](getexceptioncode.md) y [**GetExceptionInformation**](getexceptioninformation.md) desde una expresión de filtro para obtener información sobre la excepción que se está filtrando.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-125">You can call the [**GetExceptionCode**](getexceptioncode.md) and [**GetExceptionInformation**](getexceptioninformation.md) functions from within a filter expression to get information about the exception being filtered.</span></span> <span data-ttu-id="fe9c7-126">**GetExceptionCode** devuelve un código que identifica el tipo de excepción y **GetExceptionInformation** devuelve un puntero a una estructura [**de \_ punteros de excepción**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) que contiene punteros a estructuras [**de \_ registro**](/windows/desktop/api/WinNT/ns-winnt-exception_record) de [**contexto**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) y de excepción.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-126">**GetExceptionCode** returns a code that identifies the type of exception, and **GetExceptionInformation** returns a pointer to an [**EXCEPTION\_POINTERS**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) structure that contains pointers to [**CONTEXT**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) and [**EXCEPTION\_RECORD**](/windows/desktop/api/WinNT/ns-winnt-exception_record) structures.</span></span>

<span data-ttu-id="fe9c7-127">No se puede llamar a estas funciones desde una función de filtro, pero sus valores devueltos se pueden pasar como parámetros a una función de filtro.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-127">These functions cannot be called from within a filter function, but their return values can be passed as parameters to a filter function.</span></span> <span data-ttu-id="fe9c7-128">[**GetExceptionCode**](getexceptioncode.md) se puede usar en el bloque de controlador de excepciones, pero [**GetExceptionInformation**](getexceptioninformation.md) no puede porque la información a la que apunta está normalmente en la pila y se destruye cuando el control se transfiere a un controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-128">[**GetExceptionCode**](getexceptioncode.md) can be used within the exception-handler block, but [**GetExceptionInformation**](getexceptioninformation.md) cannot because the information it points to is typically on the stack and is destroyed when control is transferred to an exception handler.</span></span> <span data-ttu-id="fe9c7-129">Sin embargo, una aplicación puede copiar la información en un almacenamiento seguro para que esté disponible para el controlador de excepciones.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-129">However, an application can copy the information to safe storage to make it available to the exception handler.</span></span>

<span data-ttu-id="fe9c7-130">La ventaja de una función de filtro es que puede controlar una excepción y devolver un valor que hace que el sistema continúe la ejecución desde el punto en el que se produjo la excepción.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-130">The advantage of a filter function is that it can handle an exception and return a value that causes the system to continue execution from the point at which the exception occurred.</span></span> <span data-ttu-id="fe9c7-131">En cambio, con un bloque de controlador de excepciones, la ejecución continúa secuencialmente desde el controlador de excepciones en lugar de desde el punto de la excepción.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-131">With an exception-handler block, in contrast, execution continues sequentially from the exception handler rather than from the point of the exception.</span></span>

<span data-ttu-id="fe9c7-132">Controlar una excepción puede ser tan sencillo como anotar un error y establecer una marca que se examinará más adelante, imprimiendo una advertencia o un mensaje de error o realizando alguna otra acción limitada.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-132">Handling an exception may be as simple as noting an error and setting a flag that will be examined later, printing a warning or error message, or taking some other limited action.</span></span> <span data-ttu-id="fe9c7-133">Si se puede continuar la ejecución, también puede ser necesario cambiar el estado de la máquina modificando el registro de contexto.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-133">If execution can be continued, it may also be necessary to change the machine state by modifying the context record.</span></span> <span data-ttu-id="fe9c7-134">Para obtener un ejemplo de una función de filtro que controla una excepción de error de página, vea [usar las funciones de memoria virtual](../memory/using-the-memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="fe9c7-134">For an example of a filter function that handles a page fault exception, see [Using the Virtual Memory Functions](../memory/using-the-memory-management-functions.md).</span></span>

<span data-ttu-id="fe9c7-135">La función [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) se puede usar como una función de filtro en una expresión de filtro.</span><span class="sxs-lookup"><span data-stu-id="fe9c7-135">The [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) function can be used as a filter function in a filter expression.</span></span> <span data-ttu-id="fe9c7-136">Devuelve \_ \_ el controlador de ejecución de excepciones a menos que se esté depurando el proceso, en cuyo caso devuelve la búsqueda de la excepción \_ continue \_ .</span><span class="sxs-lookup"><span data-stu-id="fe9c7-136">It returns EXCEPTION\_EXECUTE\_HANDLER unless the process is being debugged, in which case it returns EXCEPTION\_CONTINUE\_SEARCH.</span></span>

 

 
