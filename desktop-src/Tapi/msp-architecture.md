---
description: En la arquitectura de TAPI, todas las profesionales se ejecutan en el contexto de TAPISRV, que se implementa como un proceso de servicio en SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Arquitectura MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8c1229ddce90f79c122c47572b4567d230b0b4e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423603"
---
# <a name="msp-architecture"></a><span data-ttu-id="8f902-103">Arquitectura MSP</span><span class="sxs-lookup"><span data-stu-id="8f902-103">MSP Architecture</span></span>

<span data-ttu-id="8f902-104">En la arquitectura de TAPI, todas las profesionales se ejecutan en el contexto de TAPISRV, que se implementa como un proceso de servicio en SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="8f902-104">In TAPI architecture, all TSPs are run in the context of TAPISRV, which is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="8f902-105">Las aplicaciones TAPI viven en su propio proceso.</span><span class="sxs-lookup"><span data-stu-id="8f902-105">TAPI applications live in their own process.</span></span> <span data-ttu-id="8f902-106">Las aplicaciones TAPI cargan Tapi3.dll y los MSP necesarios en su propio proceso, y el archivo DLL de TAPI se comunica con TAPISRV a través de una interfaz RPC privada.</span><span class="sxs-lookup"><span data-stu-id="8f902-106">TAPI applications load Tapi3.dll and any needed MSPs into their own process, and the TAPI DLL communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="8f902-107">En el diagrama siguiente se muestra la interacción de estos componentes.</span><span class="sxs-lookup"><span data-stu-id="8f902-107">The following diagram illustrates the interaction of these components.</span></span>

![interacciones entre tapisrv, aplicaciones TAPI y MSP](images/tsp-msp1.png)

<span data-ttu-id="8f902-109">Un proveedor de servicios multimedia (MSP) proporciona streaming multimedia mediante las abstracciones de terminales, secuencias y subsecuencias.</span><span class="sxs-lookup"><span data-stu-id="8f902-109">A media service provider (MSP) provides media streaming using the abstractions of Terminals, Streams, and SubStreams.</span></span>

<span data-ttu-id="8f902-110">Un terminal es un receptor u origen para una secuencia de medios.</span><span class="sxs-lookup"><span data-stu-id="8f902-110">A Terminal is a sink or source for a media stream.</span></span> <span data-ttu-id="8f902-111">Puede tratarse de un objeto físico, como un altavoz o un micrófono, o puede ser una abstracción de un dispositivo, como una ventana de vídeo.</span><span class="sxs-lookup"><span data-stu-id="8f902-111">It may be a physical object, such as a speaker or a microphone, or it may be an abstraction of a device, such as a video window.</span></span> <span data-ttu-id="8f902-112">El [objeto terminal](terminal-object.md) expone la interfaz [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) .</span><span class="sxs-lookup"><span data-stu-id="8f902-112">The [Terminal Object](terminal-object.md) exposes the [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) interface.</span></span> <span data-ttu-id="8f902-113">La clase de terminal se describe mediante el GUID de la [**clase de terminal**](terminal-class.md) .</span><span class="sxs-lookup"><span data-stu-id="8f902-113">The class of terminal is described by the [**Terminal Class**](terminal-class.md) GUID.</span></span> <span data-ttu-id="8f902-114">Un MSP puede definir sus propias clases de terminal.</span><span class="sxs-lookup"><span data-stu-id="8f902-114">An MSP may define its own terminal classes.</span></span>

<span data-ttu-id="8f902-115">Las secuencias dividen el medio de una llamada en función del tipo o tipo de [**medio**](tapimediatype--constants.md) , la [**Dirección**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)de la secuencia y la dirección de destino del medio.</span><span class="sxs-lookup"><span data-stu-id="8f902-115">Streams divide the media of a call based on the [**media type**](tapimediatype--constants.md) or type, the stream's [**direction**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction), and the destination address of the media.</span></span> <span data-ttu-id="8f902-116">Por ejemplo, una secuencia de audio entrante desde un módem es un objeto de flujo, una secuencia de vídeo saliente a una dirección IP y un puerto es un objeto de flujo, las secuencias de vídeo procedentes de un grupo de multidifusión IP también se consideran un objeto de flujo.</span><span class="sxs-lookup"><span data-stu-id="8f902-116">For example, an incoming audio stream from a modem is a stream object, an outgoing video stream to an IP address and port is a stream object, the video streams coming from a IP multicast group are also considered as one stream object.</span></span> <span data-ttu-id="8f902-117">El objeto de secuencia se representa mediante la interfaz [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="8f902-117">The Stream object is represented by the [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) interface.</span></span>

<span data-ttu-id="8f902-118">Las subsecuencias permiten un mayor control sobre los medios.</span><span class="sxs-lookup"><span data-stu-id="8f902-118">SubStreams allow finer control over the media.</span></span> <span data-ttu-id="8f902-119">Por ejemplo, en el caso de multidifusión IP, el objeto de flujo de vídeo entrante podría representar varias personas.</span><span class="sxs-lookup"><span data-stu-id="8f902-119">For example, in the IP multicast case, the incoming video stream object might represent several people.</span></span> <span data-ttu-id="8f902-120">Lo más probable es que la aplicación desee que cada participante tenga un representador independiente.</span><span class="sxs-lookup"><span data-stu-id="8f902-120">The application will most likely want each participant to have a separate renderer.</span></span> <span data-ttu-id="8f902-121">El flujo de vídeo entrante puede dividirse en varios subflujos, uno para cada persona.</span><span class="sxs-lookup"><span data-stu-id="8f902-121">The incoming video stream can be divided into several substreams, one for each person.</span></span> <span data-ttu-id="8f902-122">Una subsecuencia se corresponderá con una persona y se puede configurar y controlar por separado.</span><span class="sxs-lookup"><span data-stu-id="8f902-122">One substream would correspond to one person, and can be configured and controlled separately.</span></span> <span data-ttu-id="8f902-123">El objeto de subsecuencia se representa mediante la interfaz [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="8f902-123">The SubStream object is represented by the [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) interface.</span></span>

<span data-ttu-id="8f902-124">Cuando una aplicación llama a [**ITAddress:: CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) para configurar una llamada, debe especificar el tipo de medio necesario.</span><span class="sxs-lookup"><span data-stu-id="8f902-124">When an application calls [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) to set up a call, it must specify the type of media required.</span></span> <span data-ttu-id="8f902-125">En una llamada de salida, simplemente indica a TAPI cuando se crea la llamada.</span><span class="sxs-lookup"><span data-stu-id="8f902-125">On an outgoing call, it simply tells TAPI when the call is created.</span></span> <span data-ttu-id="8f902-126">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="8f902-126">For example:</span></span>

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

<span data-ttu-id="8f902-127">En este caso, la aplicación está creando una llamada de audio y vídeo saliente.</span><span class="sxs-lookup"><span data-stu-id="8f902-127">In this case, the application is creating an outgoing audio-video call.</span></span>

<span data-ttu-id="8f902-128">Los tipos de medios que se pasan en indican el medio en el que está interesado la aplicación a lo largo de la duración de la llamada.</span><span class="sxs-lookup"><span data-stu-id="8f902-128">The media types passed in indicate the media that the application is interested in over the lifetime of the call.</span></span> <span data-ttu-id="8f902-129">Por ejemplo, la aplicación puede especificar audio y vídeo al crear la llamada, pero seleccionar solo los terminales de audio al principio.</span><span class="sxs-lookup"><span data-stu-id="8f902-129">For example, the application may specify audio and video when creating the call, but select only audio terminals at the beginning.</span></span> <span data-ttu-id="8f902-130">El MSP iniciará el streaming solo de audio, pero no rechazará una solicitud de vídeo local o remota realizada más tarde en la duración de la llamada.</span><span class="sxs-lookup"><span data-stu-id="8f902-130">The MSP will start streaming only audio, but will not reject a local or remote video request made later in the lifetime of the call.</span></span>

<span data-ttu-id="8f902-131">Cuando la aplicación llama a [**ITBasicCallControl:: Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 llama a [**TSPI \_ lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) en el TSP.</span><span class="sxs-lookup"><span data-stu-id="8f902-131">When the application then calls [**ITBasicCallControl::Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 calls [**TSPI\_lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) in the TSP.</span></span> <span data-ttu-id="8f902-132">Después de establecer una llamada, MSP y TSP pueden comunicarse según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="8f902-132">After a call is established, the MSP and TSP can communicate as necessary.</span></span>

<span data-ttu-id="8f902-133">Cuando se está desconectando una llamada, el MSP y el TSP se comunican a través de la interrupción de la llamada.</span><span class="sxs-lookup"><span data-stu-id="8f902-133">When a call is disconnecting, it is up to the MSP and TSP to communicate about tearing down the call.</span></span> <span data-ttu-id="8f902-134">Tapi3.dll llamará a [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) si la aplicación llama a [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span><span class="sxs-lookup"><span data-stu-id="8f902-134">Tapi3.dll will call [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) if the application calls [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span></span>

 

 
