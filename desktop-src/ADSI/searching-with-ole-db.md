---
title: Buscar con OLE DB
description: En el caso de los clientes de automatización que utilizan Objetos de datos ActiveX (ADO) y todos los clientes que no son de automatización, ADSI proporciona un proveedor de OLE DB que admite un subconjunto de OLE DB interfaces de consulta.
ms.assetid: f4e48b60-82dd-4c39-879b-0bc8f40747d2
ms.tgt_platform: multiple
keywords:
- Buscar con OLE DB ADSI
- consultas ADSI, buscar con OLE DB
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 92b6b0c056a63174233271b9b059ebffa9d4d841
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/21/2020
ms.locfileid: "103793893"
---
# <a name="searching-with-ole-db"></a><span data-ttu-id="6a016-105">Buscar con OLE DB</span><span class="sxs-lookup"><span data-stu-id="6a016-105">Searching with OLE DB</span></span>

<span data-ttu-id="6a016-106">En el caso de los clientes de automatización que utilizan Objetos de datos ActiveX (ADO) y todos los clientes que no son de automatización, ADSI proporciona un proveedor de OLE DB que admite un subconjunto de OLE DB interfaces de consulta.</span><span class="sxs-lookup"><span data-stu-id="6a016-106">For both Automation clients using ActiveX Data Objects (ADO) and all non-Automation clients, ADSI supplies an OLE DB provider that supports a subset of OLE DB query interfaces.</span></span> <span data-ttu-id="6a016-107">El código de cliente que ya usa OLE DB interfaces para las consultas puede usar las mismas interfaces para consultar los servicios de directorio.</span><span class="sxs-lookup"><span data-stu-id="6a016-107">Client code that already uses OLE DB interfaces for queries can use the same interfaces to query directory services.</span></span>

<span data-ttu-id="6a016-108">En la implementación de OLE DB, un servicio de directorio se expone como un objeto de origen de datos.</span><span class="sxs-lookup"><span data-stu-id="6a016-108">Under the OLE DB implementation, a directory service is exposed as a Data Source object.</span></span> <span data-ttu-id="6a016-109">Los objetos de origen de datos son generadores de objetos de sesión y admiten [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) para conectarse al directorio, [IDBCreateSession](/previous-versions/windows/desktop/ms724076(v=vs.85)) para crear el objeto de sesión, [IDBProperties](/previous-versions/windows/desktop/ms719607(v=vs.85)) para proporcionar datos de autenticación al espacio de nombres subyacente y proporcionar el comando de consulta y [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist) para guardar los datos necesarios para crear el objeto de origen de datos en el servicio de directorio subyacente.</span><span class="sxs-lookup"><span data-stu-id="6a016-109">Data Source objects are factories for session objects and support [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) to connect to the directory, [IDBCreateSession](/previous-versions/windows/desktop/ms724076(v=vs.85)) to create the session object, [IDBProperties](/previous-versions/windows/desktop/ms719607(v=vs.85)) to supply authentication data to the underlying namespace and supply the query command and [**IPersist**](/windows/win32/api/objidl/nn-objidl-ipersist) to save the data necessary to create the data source object to the underlying directory service.</span></span>

<span data-ttu-id="6a016-110">**Para realizar una consulta Active Directory mediante OLE DB**</span><span class="sxs-lookup"><span data-stu-id="6a016-110">**To perform an Active Directory query using OLE DB**</span></span>

1.  <span data-ttu-id="6a016-111">Recupere la interfaz [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) del proveedor de OLE DB.</span><span class="sxs-lookup"><span data-stu-id="6a016-111">Retrieve the [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) interface from the OLE DB provider.</span></span> <span data-ttu-id="6a016-112">En el caso de Active Directory, utilice el identificador de clase **CLSID \_ ADsDSOObject**.</span><span class="sxs-lookup"><span data-stu-id="6a016-112">In the case of Active Directory, use the class identifier **CLSID\_ADsDSOObject**.</span></span>
2.  <span data-ttu-id="6a016-113">Cree una matriz de [DBPROP](/previous-versions/windows/desktop/ms717970(v=vs.85)) de datos de conexión que especifique el nombre de usuario y la contraseña.</span><span class="sxs-lookup"><span data-stu-id="6a016-113">Build a [DBPROP](/previous-versions/windows/desktop/ms717970(v=vs.85)) array of connection data specifying user name and password.</span></span>
3.  <span data-ttu-id="6a016-114">Consulte la interfaz [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) recuperada en el paso 1 para la interfaz [IDBProperties](/previous-versions/windows/desktop/ms719607(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="6a016-114">Query the [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) interface retrieved in Step 1 for the [IDBProperties](/previous-versions/windows/desktop/ms719607(v=vs.85)) interface.</span></span>
4.  <span data-ttu-id="6a016-115">Llame al método [IDBProperties:: SetProperties](/previous-versions/windows/desktop/ms723049(v=vs.85)) pasando la matriz [DBPROP](/previous-versions/windows/desktop/ms717970(v=vs.85)) creada en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="6a016-115">Call the [IDBProperties::SetProperties](/previous-versions/windows/desktop/ms723049(v=vs.85)) method passing in the [DBPROP](/previous-versions/windows/desktop/ms717970(v=vs.85)) array created in Step 2.</span></span>
5.  <span data-ttu-id="6a016-116">Llame al método [IDBInitialize:: Initialize](/previous-versions/windows/desktop/ms718026(v=vs.85)) para establecer la conexión con el proveedor de OLE DB; es decir, el proveedor de Active Directory, en este caso.</span><span class="sxs-lookup"><span data-stu-id="6a016-116">Call the [IDBInitialize::Initialize](/previous-versions/windows/desktop/ms718026(v=vs.85)) method to establish the connection to the OLE DB provider; that is the Active Directory provider, in this case.</span></span>
6.  <span data-ttu-id="6a016-117">Consulte la interfaz [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) para la interfaz [IDBCreateSession](/previous-versions/windows/desktop/ms724076(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="6a016-117">Query the [IDBInitialize](/previous-versions/windows/desktop/ms713706(v=vs.85)) interface for the [IDBCreateSession](/previous-versions/windows/desktop/ms724076(v=vs.85)) interface.</span></span>
7.  <span data-ttu-id="6a016-118">Llame al método [IDBCreateSession:: createSession](/previous-versions/windows/desktop/ms714942(v=vs.85)) solicitando una nueva interfaz de tipo [IDBCreateCommand](/previous-versions/windows/desktop/ms711625(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="6a016-118">Call the [IDBCreateSession::CreateSession](/previous-versions/windows/desktop/ms714942(v=vs.85)) method requesting a new interface of type [IDBCreateCommand](/previous-versions/windows/desktop/ms711625(v=vs.85)).</span></span>
8.  <span data-ttu-id="6a016-119">Llame al método [IDBCreateCommand:: CreateCommand](/previous-versions/windows/desktop/ms709772(v=vs.85)) para crear una interfaz [ICommandText](/previous-versions/windows/desktop/ms714914(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="6a016-119">Call the [IDBCreateCommand::CreateCommand](/previous-versions/windows/desktop/ms709772(v=vs.85)) method to create an [ICommandText](/previous-versions/windows/desktop/ms714914(v=vs.85)) interface.</span></span>
9.  <span data-ttu-id="6a016-120">Llame al método [ICommandText:: SetCommandText](/previous-versions/windows/desktop/ms709757(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="6a016-120">Call the [ICommandText::SetCommandText](/previous-versions/windows/desktop/ms709757(v=vs.85)) method.</span></span> <span data-ttu-id="6a016-121">Pase el dialecto preferido y el texto del comando de consulta real en dicho dialecto.</span><span class="sxs-lookup"><span data-stu-id="6a016-121">Pass in the preferred dialect and the actual query command text in that dialect.</span></span> <span data-ttu-id="6a016-122">**DBGUID \_ LDAPDialect** o **DBGUID \_ DBSQL** se pueden usar como dialecto.</span><span class="sxs-lookup"><span data-stu-id="6a016-122">Either **DBGUID\_LDAPDialect** or **DBGUID\_DBSQL** may be used as the dialect.</span></span>
10. <span data-ttu-id="6a016-123">Llamar a [ICommand:: Execute](/previous-versions/windows/desktop/ms718095(v=vs.85)); se devuelve una interfaz [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) que es la interfaz para el conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="6a016-123">Call [ICommand::Execute](/previous-versions/windows/desktop/ms718095(v=vs.85)); an [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) interface is returned which is the interface to the result set.</span></span>
11. <span data-ttu-id="6a016-124">Consulte la interfaz [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) para la interfaz [IColumnsInfo](/previous-versions/windows/desktop/ms725401(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="6a016-124">Query the [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) interface for the [IColumnsInfo](/previous-versions/windows/desktop/ms725401(v=vs.85)) interface.</span></span>
12. <span data-ttu-id="6a016-125">Llame al método [IColumnsInfo:: GetColumnInfo](/previous-versions/windows/desktop/ms722704(v=vs.85)) para recuperar los datos de columna del conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="6a016-125">Call the [IColumnsInfo::GetColumnInfo](/previous-versions/windows/desktop/ms722704(v=vs.85)) method to retrieve column data about the result set.</span></span>
13. <span data-ttu-id="6a016-126">Rellene una matriz de estructuras [DBBINDING](/previous-versions/windows/desktop/ms716845(v=vs.85)) , que describe al proveedor de OLE DB cómo exponer los tipos de datos cada columna al código de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="6a016-126">Populate an array of [DBBINDING](/previous-versions/windows/desktop/ms716845(v=vs.85)) structures, describing to the OLE DB provider how to expose the data types on a per-column basis to the application code.</span></span> <span data-ttu-id="6a016-127">Este paso le permite especificar qué tipo se incluye en una columna determinada.</span><span class="sxs-lookup"><span data-stu-id="6a016-127">This step enables you to specify which TYPE is contained in a particular column.</span></span> <span data-ttu-id="6a016-128">Además, los desplazamientos de las columnas, con respecto a la fila devuelta, se establecen aquí columna por columna.</span><span class="sxs-lookup"><span data-stu-id="6a016-128">Also the offsets of the columns, relative to the returned row, are set here on a column-by-column basis.</span></span>
14. <span data-ttu-id="6a016-129">Consulte la interfaz [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) para la interfaz [IAccessor](/previous-versions/windows/desktop/ms719672(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="6a016-129">Query the [IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85)) interface for the [IAccessor](/previous-versions/windows/desktop/ms719672(v=vs.85)) interface.</span></span>
15. <span data-ttu-id="6a016-130">Llame al método [IAccessor:: CreateAccessor](/previous-versions/windows/desktop/ms720969(v=vs.85)) , que devuelve una matriz de identificadores de descriptor de acceso.</span><span class="sxs-lookup"><span data-stu-id="6a016-130">Call the [IAccessor::CreateAccessor](/previous-versions/windows/desktop/ms720969(v=vs.85)) method, which returns an array of accessor handles.</span></span> <span data-ttu-id="6a016-131">Esta matriz se utiliza a continuación para tener acceso a las filas del conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="6a016-131">This array is then used to access the rows of the result set.</span></span>
16. <span data-ttu-id="6a016-132">Llame a [IRowset:: GetNextRows](/previous-versions/windows/desktop/ms709827(v=vs.85)) pasando los identificadores de fila y el número de filas que se van a obtener.</span><span class="sxs-lookup"><span data-stu-id="6a016-132">Call [IRowset::GetNextRows](/previous-versions/windows/desktop/ms709827(v=vs.85)) passing in the row handles, and number of rows to get.</span></span>
17. <span data-ttu-id="6a016-133">Llame a [IRowset:: GetData](/previous-versions/windows/desktop/ms716988(v=vs.85)) pasando un identificador de fila, del conjunto devuelto en el paso 16.</span><span class="sxs-lookup"><span data-stu-id="6a016-133">Call [IRowset::GetData](/previous-versions/windows/desktop/ms716988(v=vs.85)) passing in a row handle, from the set returned in Step 16.</span></span> <span data-ttu-id="6a016-134">Se devuelve un puntero sin formato a la fila.</span><span class="sxs-lookup"><span data-stu-id="6a016-134">A raw pointer to the row is returned.</span></span>

<span data-ttu-id="6a016-135">Para obtener más información sobre la sintaxis del filtro de búsqueda, consulte [Sintaxis de filtro de búsqueda](search-filter-syntax.md).</span><span class="sxs-lookup"><span data-stu-id="6a016-135">For more information about the search filter syntax, see [Search Filter Syntax](search-filter-syntax.md).</span></span>

<span data-ttu-id="6a016-136">Para leer los datos de fila no procesados devueltos, use la estructura [DBBINDING](/previous-versions/windows/desktop/ms716845(v=vs.85)) , creada en el paso 13, calcule los desplazamientos de columna en el puntero de datos sin procesar devueltos en el paso 17.</span><span class="sxs-lookup"><span data-stu-id="6a016-136">To read the unprocessed row data returned, use the [DBBINDING](/previous-versions/windows/desktop/ms716845(v=vs.85)) structure, created in Step 13, compute the column offsets in the unprocessed data pointer returned in Step 17.</span></span> <span data-ttu-id="6a016-137">Lea la parte de estado de la columna para obtener un resultado de recuperación en esa columna.</span><span class="sxs-lookup"><span data-stu-id="6a016-137">Read the status portion of the column for a retrieval result on that column.</span></span>

<span data-ttu-id="6a016-138">Para obtener más información y un ejemplo de código que muestra cómo buscar Active Directory mediante el proveedor de OLE DB ADSI, vea el [código de ejemplo para usar OLE DB para buscar Active Directory](example-code-for-using-ole-db-to-search-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="6a016-138">For more information and a code example that shows how to search Active Directory using the ADSI OLE DB provider, see [Example Code for Using OLE DB to Search Active Directory](example-code-for-using-ole-db-to-search-active-directory.md).</span></span>

 

 