---
description: La función de devolución de llamada CPlApplet procesa todos los mensajes enviados a un elemento del panel de control por Windows. Los mensajes enviados a la función se encuentran en un orden específico. Con el mismo token, el elemento. cpl requiere que los mensajes se procesen de una forma específica.
ms.assetid: 70302698-f9d5-4de4-a662-4815002eea52
title: Procesamiento de mensajes del panel de control
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b8b43c6e265030279a6644547f41e3630208325
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "104002505"
---
# <a name="control-panel-message-processing"></a><span data-ttu-id="56b15-105">Procesamiento de mensajes del panel de control</span><span class="sxs-lookup"><span data-stu-id="56b15-105">Control Panel Message Processing</span></span>

<span data-ttu-id="56b15-106">La función de devolución de llamada [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) procesa todos los mensajes enviados a un elemento del panel de control por Windows.</span><span class="sxs-lookup"><span data-stu-id="56b15-106">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) callback function processes all messages sent to a Control Panel item by Windows.</span></span> <span data-ttu-id="56b15-107">Los mensajes enviados a la función se encuentran en un orden específico.</span><span class="sxs-lookup"><span data-stu-id="56b15-107">Messages sent to the function are in a specific order.</span></span> <span data-ttu-id="56b15-108">Con el mismo token, el elemento. cpl requiere que los mensajes se procesen de una forma específica.</span><span class="sxs-lookup"><span data-stu-id="56b15-108">By the same token, the .cpl item requires the messages to be processed in a specific way.</span></span>

<span data-ttu-id="56b15-109">En primer lugar, la función [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) recibe el \_ mensaje CPL init cuando Windows carga por primera vez el elemento del panel de control.</span><span class="sxs-lookup"><span data-stu-id="56b15-109">First, the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function receives the CPL\_INIT message when Windows first loads the Control Panel item.</span></span> <span data-ttu-id="56b15-110">La función debe llevar a cabo cualquier inicialización, como la asignación de memoria, y devolver un valor distinto de cero.</span><span class="sxs-lookup"><span data-stu-id="56b15-110">The function should carry out any initialization, such as allocating memory, and return nonzero.</span></span> <span data-ttu-id="56b15-111">Si **CPlApplet** no puede completar la inicialización, debe devolver cero, dirigirse a Windows para finalizar la comunicación y liberar el archivo dll.</span><span class="sxs-lookup"><span data-stu-id="56b15-111">If **CPlApplet** cannot complete the initialization, it must return zero, directing Windows to terminate communication and release the DLL.</span></span>

<span data-ttu-id="56b15-112">Después, si el \_ mensaje CPL init se ejecutó correctamente, Windows envía el \_ mensaje CPL GETCOUNT.</span><span class="sxs-lookup"><span data-stu-id="56b15-112">Next, if the CPL\_INIT message succeeded, Windows sends the CPL\_GETCOUNT message.</span></span> <span data-ttu-id="56b15-113">A continuación, la función debe devolver el número de elementos del panel de control que admite el archivo. dll.</span><span class="sxs-lookup"><span data-stu-id="56b15-113">The function must then return the number of Control Panel items supported by the .dll file.</span></span>

<span data-ttu-id="56b15-114">A continuación, la función [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) recibe un \_ mensaje CPL de consulta y un \_ mensaje CPL NEWINQUIRE para cada elemento del panel de control que admite el archivo. dll.</span><span class="sxs-lookup"><span data-stu-id="56b15-114">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function then receives one CPL\_INQUIRE message and one CPL\_NEWINQUIRE message for each Control Panel item supported by the .dll file.</span></span> <span data-ttu-id="56b15-115">La función rellena una estructura [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) o [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) con información sobre el elemento, como su nombre, icono y una cadena descriptiva.</span><span class="sxs-lookup"><span data-stu-id="56b15-115">The function fills in a [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure with information about your item, such as its name, icon, and a descriptive string.</span></span> <span data-ttu-id="56b15-116">La mayoría de las aplicaciones deben procesar el \_ mensaje CPL consulta y omitir el \_ mensaje CPL NEWINQUIRE.</span><span class="sxs-lookup"><span data-stu-id="56b15-116">Most applications should process the CPL\_INQUIRE message and ignore the CPL\_NEWINQUIRE message.</span></span> <span data-ttu-id="56b15-117">El \_ mensaje CPL consulta proporciona información en un formulario que Windows puede almacenar en caché, lo que da como resultado un rendimiento mucho mejor.</span><span class="sxs-lookup"><span data-stu-id="56b15-117">The CPL\_INQUIRE message provides information in a form that Windows can cache, which results in much better performance.</span></span> <span data-ttu-id="56b15-118">El \_ mensaje CPL NEWINQUIRE se usa solo si necesita cambiar el icono o las cadenas de visualización del elemento en función del estado del equipo.</span><span class="sxs-lookup"><span data-stu-id="56b15-118">The CPL\_NEWINQUIRE message is used only if you need to change your item's icon or display strings based on the state of the computer.</span></span> <span data-ttu-id="56b15-119">Los elementos del panel de control que usan CPL \_ NEWINQUIRE no se pueden encontrar en una búsqueda en el menú **Inicio** en Windows Vista porque se basa en el almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="56b15-119">Control Panel items that use CPL\_NEWINQUIRE cannot be found by a **Start** menu search in Windows Vista because it relies on caching.</span></span>

<span data-ttu-id="56b15-120">La función [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) siguiente recibe un \_ mensaje CPL DBLCLK como notificación de que el usuario ha elegido el icono que representa el elemento del panel de control.</span><span class="sxs-lookup"><span data-stu-id="56b15-120">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function next receives a CPL\_DBLCLK message as a notification that the user has chosen the icon that represents the Control Panel item.</span></span> <span data-ttu-id="56b15-121">La función podría recibir este mensaje varias veces.</span><span class="sxs-lookup"><span data-stu-id="56b15-121">The function might receive this message any number of times.</span></span> <span data-ttu-id="56b15-122">El mensaje incluye el identificador de elemento y el puntero **lpData** devuelto en la estructura [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) o [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) en la llamada a [**CPL \_ require**](cpl-inquire.md) o [**CPL \_ NEWINQUIRE**](cpl-newinquire.md).</span><span class="sxs-lookup"><span data-stu-id="56b15-122">The message includes the item identifier and the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the call to [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md).</span></span> <span data-ttu-id="56b15-123">La función debe mostrar el cuadro de diálogo correspondiente y procesar la entrada de usuario subsiguiente.</span><span class="sxs-lookup"><span data-stu-id="56b15-123">The function should display the corresponding dialog box and process subsequent user input.</span></span>

<span data-ttu-id="56b15-124">Además de CPL \_ DBLCLK, el \_ mensaje CPL STARTWPARMS se puede enviar si se invoca un elemento del panel de control con parámetros de entrada, como desde un símbolo del sistema o desde otro programa.</span><span class="sxs-lookup"><span data-stu-id="56b15-124">Besides CPL\_DBLCLK, the CPL\_STARTWPARMS message can be sent if a Control Panel item is invoked with input parameters, such as from a command prompt or from another program.</span></span> <span data-ttu-id="56b15-125">El mensaje incluye el identificador de elemento junto con la cadena de parámetro adicional.</span><span class="sxs-lookup"><span data-stu-id="56b15-125">The message includes the item identifier along with the additional parameter string.</span></span>

<span data-ttu-id="56b15-126">Antes de que finalice la aplicación de control, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) recibe el \_ mensaje CPL STOP una vez por cada elemento del panel de control admitido por el archivo. dll.</span><span class="sxs-lookup"><span data-stu-id="56b15-126">Before the controlling application terminates, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) receives the CPL\_STOP message once for each Control Panel item supported by the .dll file.</span></span> <span data-ttu-id="56b15-127">El mensaje incluye el identificador del elemento del panel de control y el puntero **lpData** devuelto en la estructura [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) o [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) en la llamada a [**CPL \_ require**](cpl-inquire.md) o [**CPL \_ NEWINQUIRE**](cpl-newinquire.md).</span><span class="sxs-lookup"><span data-stu-id="56b15-127">The message includes the identifier for the Control Panel item and the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the call to [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md).</span></span> <span data-ttu-id="56b15-128">La función debe liberar cualquier memoria asignada para el cuadro de diálogo especificado.</span><span class="sxs-lookup"><span data-stu-id="56b15-128">The function should free any memory that it allocated for the specified dialog box.</span></span>

<span data-ttu-id="56b15-129">Después del último CPL \_ Stop Message, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) recibe un \_ mensaje CPL EXIT.</span><span class="sxs-lookup"><span data-stu-id="56b15-129">After the last CPL\_STOP message, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) receives a CPL\_EXIT message.</span></span> <span data-ttu-id="56b15-130">La función debe liberar toda la memoria asignada restante y anular el registro de cualquier clase de ventana privada que pueda haber registrado.</span><span class="sxs-lookup"><span data-stu-id="56b15-130">The function should free all remaining allocated memory and unregister any private window classes that it might have registered.</span></span> <span data-ttu-id="56b15-131">Inmediatamente después de que la función vuelva de este mensaje, Windows libera el elemento del panel de control llamando a la función [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="56b15-131">Immediately after the function returns from this message, Windows releases the Control Panel item by calling the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

## <a name="related-topics"></a><span data-ttu-id="56b15-132">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="56b15-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="56b15-133">Elementos del panel de control</span><span class="sxs-lookup"><span data-stu-id="56b15-133">Control Panel Items</span></span>](control-panel-applications.md)
</dt> <dt>

[<span data-ttu-id="56b15-134">Directrices de la experiencia de usuario</span><span class="sxs-lookup"><span data-stu-id="56b15-134">User Experience Guidelines</span></span>](user-experience-guidelines.md)
</dt> <dt>

[<span data-ttu-id="56b15-135">Registrar elementos del panel de control</span><span class="sxs-lookup"><span data-stu-id="56b15-135">Registering Control Panel Items</span></span>](registering-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="56b15-136">Usar CPLApplet</span><span class="sxs-lookup"><span data-stu-id="56b15-136">Using CPLApplet</span></span>](using-cplapplet.md)
</dt> <dt>

[<span data-ttu-id="56b15-137">Ejecutar elementos del panel de control</span><span class="sxs-lookup"><span data-stu-id="56b15-137">Executing Control Panel Items</span></span>](executing-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="56b15-138">Extender elementos del panel de control del sistema</span><span class="sxs-lookup"><span data-stu-id="56b15-138">Extending System Control Panel Items</span></span>](extending-system-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="56b15-139">Asignar categorías del panel de control</span><span class="sxs-lookup"><span data-stu-id="56b15-139">Assigning Control Panel Categories</span></span>](assigning-control-panel-categories.md)
</dt> <dt>

[<span data-ttu-id="56b15-140">Crear vínculos de tarea que se pueden buscar para un elemento del panel de control</span><span class="sxs-lookup"><span data-stu-id="56b15-140">Creating Searchable Task Links for a Control Panel Item</span></span>](creating-searchable-task-links.md)
</dt> <dt>

[<span data-ttu-id="56b15-141">Acceder al panel de control en modo seguro en Windows Vista</span><span class="sxs-lookup"><span data-stu-id="56b15-141">Accessing the Control Panel in Safe Mode under Windows Vista</span></span>](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
