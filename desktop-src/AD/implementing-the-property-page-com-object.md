---
title: Implementación de la página de propiedades de objeto COM
description: Una extensión de la hoja de propiedades es un objeto COM implementado como un servidor en proceso.
ms.assetid: 77a71086-1949-4828-801e-073ea5a6838b
ms.tgt_platform: multiple
keywords:
- Implementación de la página de propiedades de objeto COM
- Objeto COM de la página de propiedades, implementar
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 55962002ca059ad6e9c137925d1ba21ba9adc513
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/17/2020
ms.locfileid: "103904493"
---
# <a name="implementing-the-property-page-com-object"></a><span data-ttu-id="6a718-105">Implementación de la página de propiedades de objeto COM</span><span class="sxs-lookup"><span data-stu-id="6a718-105">Implementing the Property Page COM Object</span></span>

<span data-ttu-id="6a718-106">Una extensión de la hoja de propiedades es un objeto COM implementado como un servidor en proceso.</span><span class="sxs-lookup"><span data-stu-id="6a718-106">A property sheet extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="6a718-107">La extensión de la hoja de propiedades debe implementar las interfaces [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) y [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) .</span><span class="sxs-lookup"><span data-stu-id="6a718-107">The property sheet extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) interfaces.</span></span> <span data-ttu-id="6a718-108">Se crea una instancia de una extensión de la hoja de propiedades cuando el usuario muestra la hoja de propiedades de un objeto de una clase para la que se ha registrado la extensión de la hoja de propiedades en el especificador de presentación de la clase.</span><span class="sxs-lookup"><span data-stu-id="6a718-108">A property sheet extension is instantiated when the user displays the property sheet for an object of a class for which the property sheet extension has been registered in the display specifier of the class.</span></span>

-   [<span data-ttu-id="6a718-109">Implementación de IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="6a718-109">Implementing IShellExtInit</span></span>](#implementing-ishellextinit)
-   [<span data-ttu-id="6a718-110">Implementación de IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="6a718-110">Implementing IShellPropSheetExt</span></span>](#implementing-ishellpropsheetext)
-   [<span data-ttu-id="6a718-111">Pasar el objeto de extensión a la página de propiedades</span><span class="sxs-lookup"><span data-stu-id="6a718-111">Passing the Extension Object to the Property Page</span></span>](#passing-the-extension-object-to-the-property-page)
-   [<span data-ttu-id="6a718-112">Trabajar con el objeto de notificación</span><span class="sxs-lookup"><span data-stu-id="6a718-112">Working With the Notification Object</span></span>](#working-with-the-notification-object)
-   [<span data-ttu-id="6a718-113">Varios</span><span class="sxs-lookup"><span data-stu-id="6a718-113">Miscellaneous</span></span>](#miscellaneous)
-   [<span data-ttu-id="6a718-114">Hojas de propiedades de selección múltiple</span><span class="sxs-lookup"><span data-stu-id="6a718-114">Multiple-Selection Property Sheets</span></span>](#multiple-selection-property-sheets)
-   [<span data-ttu-id="6a718-115">Novedades de Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="6a718-115">New with Windows Server 2003</span></span>](#new-with-windows-server-2003)
-   [<span data-ttu-id="6a718-116">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="6a718-116">Related topics</span></span>](#related-topics)

## <a name="implementing-ishellextinit"></a><span data-ttu-id="6a718-117">Implementación de IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="6a718-117">Implementing IShellExtInit</span></span>

<span data-ttu-id="6a718-118">Después de crear una instancia del objeto COM de la extensión de la hoja de propiedades, se llama al método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) .</span><span class="sxs-lookup"><span data-stu-id="6a718-118">After the property sheet extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="6a718-119">**IShellExtInit:: Initialize** proporciona la extensión de la hoja de propiedades con un objeto [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) que contiene los datos que pertenecen al objeto de directorio que se aplica a la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-119">**IShellExtInit::Initialize** supplies the property sheet extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data that pertains to the directory object that the property sheet applies.</span></span>

<span data-ttu-id="6a718-120">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contiene datos en el formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="6a718-120">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="6a718-121">El formato de datos **\_ DSOBJECTNAMES de CFSTR** es un **HGLOBAL** que contiene una estructura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="6a718-121">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="6a718-122">La estructura **DSOBJECTNAMES** contiene los datos del objeto de directorio que se aplica a la extensión de la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-122">The **DSOBJECTNAMES** structure contains directory object data that the property sheet extension applies.</span></span>

<span data-ttu-id="6a718-123">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) también contiene datos en el formato [**CFSTR \_ DS \_ Display \_ Spec \_ Options**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="6a718-123">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="6a718-124">El formato de datos **CFSTR \_ DS \_ Display \_ Spec \_ Options** es un **HGLOBAL** que contiene una estructura [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="6a718-124">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="6a718-125">**DSDISPLAYSPECOPTIONS** contiene datos de configuración para su uso por la extensión.</span><span class="sxs-lookup"><span data-stu-id="6a718-125">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="6a718-126">Si se devuelve un valor distinto de **S \_ OK** de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), no se muestra la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-126">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the property sheet is not displayed.</span></span>

<span data-ttu-id="6a718-127">No se usan los parámetros *pidlFolder* y *HkeyProgID* del método [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) .</span><span class="sxs-lookup"><span data-stu-id="6a718-127">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

<span data-ttu-id="6a718-128">La extensión puede guardar el puntero [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) incrementando el recuento de referencias de **IDataObject**.</span><span class="sxs-lookup"><span data-stu-id="6a718-128">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer can be saved by the extension by incrementing the reference count of the **IDataObject**.</span></span> <span data-ttu-id="6a718-129">Esta interfaz se debe liberar cuando ya no se necesite.</span><span class="sxs-lookup"><span data-stu-id="6a718-129">This interface must be released when no longer required.</span></span>

## <a name="implementing-ishellpropsheetext"></a><span data-ttu-id="6a718-130">Implementación de IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="6a718-130">Implementing IShellPropSheetExt</span></span>

<span data-ttu-id="6a718-131">Después de que [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) devuelva, se llama al método [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) .</span><span class="sxs-lookup"><span data-stu-id="6a718-131">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method is called.</span></span> <span data-ttu-id="6a718-132">La extensión de la hoja de propiedades debe agregar la página o páginas durante este método.</span><span class="sxs-lookup"><span data-stu-id="6a718-132">The property sheet extension must add the page or pages during this method.</span></span> <span data-ttu-id="6a718-133">Una página de propiedades se crea rellenando una estructura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) y pasando después esta estructura a la función [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="6a718-133">A property page is created by filling a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="6a718-134">A continuación, se agrega la página de propiedades a la hoja de propiedades mediante una llamada a la función de devolución de llamada que se pasa a **IShellPropSheetExt:: AddPages** en el parámetro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="6a718-134">The property page is then added to the property sheet by calling the callback function passed to **IShellPropSheetExt::AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="6a718-135">Si se devuelve un valor distinto de **S \_ OK** de [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), no se muestra la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-135">If any value other than **S\_OK** is returned from [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), the property sheet is not displayed.</span></span>

<span data-ttu-id="6a718-136">Si no se requiere la extensión de la hoja de propiedades para agregar páginas a la hoja de propiedades, no debe llamar a la función de devolución de llamada que se pasa a [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) en el parámetro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="6a718-136">If the property sheet extension is not required to add any pages to the property sheet, it should not call the callback function passed to [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="6a718-137">No se usa el método [**IShellPropSheetExt:: ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) .</span><span class="sxs-lookup"><span data-stu-id="6a718-137">The [**IShellPropSheetExt::ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) method is not used.</span></span>

## <a name="passing-the-extension-object-to-the-property-page"></a><span data-ttu-id="6a718-138">Pasar el objeto de extensión a la página de propiedades</span><span class="sxs-lookup"><span data-stu-id="6a718-138">Passing the Extension Object to the Property Page</span></span>

<span data-ttu-id="6a718-139">El objeto de extensión de la hoja de propiedades es independiente de la página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-139">The property sheet extension object is independent from the property page.</span></span> <span data-ttu-id="6a718-140">En muchos casos, es conveniente poder usar el objeto de extensión u otro objeto de la página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-140">In many cases, it is desirable to be able to use the extension object, or some other object, from the property page.</span></span> <span data-ttu-id="6a718-141">Para ello, establezca el miembro **lParam** de la estructura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) en el puntero de objeto.</span><span class="sxs-lookup"><span data-stu-id="6a718-141">To do this, set the **lParam** member of [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure to the object pointer.</span></span> <span data-ttu-id="6a718-142">A continuación, la página de propiedades puede recuperar este valor cuando procesa el mensaje de [**\_ INITDIALOG de WM**](../dlgbox/wm-initdialog.md) .</span><span class="sxs-lookup"><span data-stu-id="6a718-142">The property page can then retrieve this value when it processes the [**WM\_INITDIALOG**](../dlgbox/wm-initdialog.md) message.</span></span> <span data-ttu-id="6a718-143">En el caso de una página de propiedades, el parámetro *lParam* del mensaje de **\_ INITDIALOG de WM** es un puntero a la estructura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="6a718-143">For a property page, the *lParam* parameter of the **WM\_INITDIALOG** message is a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="6a718-144">Recupere el puntero de objeto convirtiendo el *lParam* del mensaje de **\_ INITDIALOG de WM** en un puntero de **PROPSHEETPAGE** y, a continuación, recuperando el miembro **lParam** de la estructura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="6a718-144">Retrieve the object pointer by casting the *lParam* of the **WM\_INITDIALOG** message to a **PROPSHEETPAGE** pointer and then retrieving the **lParam** member of the **PROPSHEETPAGE** structure.</span></span>

<span data-ttu-id="6a718-145">En el ejemplo de código de C++ siguiente se muestra cómo pasar un objeto a una página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-145">The following C++ code example shows how to pass an object to a property page.</span></span>


```C++
case WM_INITDIALOG:
    {
        LPPROPSHEETPAGE pPage = (LPPROPSHEETPAGE)lParam;

        if(NULL != pPage)
        {
            CPropSheetExt *pPropSheetExt;
            pPropSheetExt = (CPropSheetExt*)pPage->lParam;

            if(pPropSheetExt)
            {
                return pPropSheetExt>OnInitDialog(wParam, lParam);
            }
        }
    }
    break;
```



<span data-ttu-id="6a718-146">Tenga en cuenta que después de llamar a [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) , la hoja de propiedades liberará el objeto de extensión de la hoja de propiedades y nunca lo volverá a usar.</span><span class="sxs-lookup"><span data-stu-id="6a718-146">Be aware that after [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) is called, the property sheet will release the property sheet extension object and never use it again.</span></span> <span data-ttu-id="6a718-147">Esto significa que el objeto de extensión se eliminaría antes de que se muestre la página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-147">This means that the extension object would be deleted before the property page is displayed.</span></span> <span data-ttu-id="6a718-148">Cuando la página intente obtener acceso al puntero del objeto, se habrá liberado la memoria y el puntero no será válido.</span><span class="sxs-lookup"><span data-stu-id="6a718-148">When the page attempts to access the object pointer, the memory will have been freed and the pointer will not be valid.</span></span> <span data-ttu-id="6a718-149">Para corregirlo, incremente el recuento de referencias del objeto de extensión cuando se agregue la página y, a continuación, libere el objeto cuando se destruya el cuadro de diálogo de la página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-149">To correct this, increment the reference count for the extension object when the page is added and then release the object when the property page dialog is destroyed.</span></span> <span data-ttu-id="6a718-150">Esto crea otro problema porque el cuadro de diálogo Página de propiedades no se crea hasta la primera vez que se muestra la página.</span><span class="sxs-lookup"><span data-stu-id="6a718-150">This creates another issue because the property page dialog box is not created until the first time the page is displayed.</span></span> <span data-ttu-id="6a718-151">Si el usuario nunca selecciona la página de la extensión, la página nunca se crea ni se destruye.</span><span class="sxs-lookup"><span data-stu-id="6a718-151">If the user never selects the extension page, the page never gets created and destroyed.</span></span> <span data-ttu-id="6a718-152">Esto hace que el objeto de extensión no se libere nunca, por lo que se produce una fuga de memoria.</span><span class="sxs-lookup"><span data-stu-id="6a718-152">This results in the extension object never getting released, so a memory leak occurs.</span></span> <span data-ttu-id="6a718-153">Para evitar esto, implemente una función de devolución de llamada de página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-153">To avoid this, implement a property page callback function.</span></span> <span data-ttu-id="6a718-154">Para ello, agregue la marca **PSP \_ USECALLBACK** al miembro **DwFlags** de la estructura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) y establezca el miembro **pfnCallback** de la estructura **PROPSHEETPAGE** en la dirección de la función [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) implementada.</span><span class="sxs-lookup"><span data-stu-id="6a718-154">To do this, add the **PSP\_USECALLBACK** flag to the **dwFlags** member of the [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and set the **pfnCallback** member of the **PROPSHEETPAGE** structure to the address of the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function implemented.</span></span> <span data-ttu-id="6a718-155">Cuando la función **PropSheetPageProc** recibe la notificación de **\_ versión PSPCB** , el parámetro *ppsp* del **PropSheetPageProc** contiene un puntero a la estructura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="6a718-155">When the **PropSheetPageProc** function receives the **PSPCB\_RELEASE** notification, the *ppsp* parameter of the **PropSheetPageProc** contains a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="6a718-156">El miembro **lParam** de la estructura **PROPSHEETPAGE** contiene el puntero de extensión que se puede usar para liberar el objeto.</span><span class="sxs-lookup"><span data-stu-id="6a718-156">The **lParam** member of the **PROPSHEETPAGE** structure contains the extension pointer which can be used to release the object.</span></span>

<span data-ttu-id="6a718-157">En el ejemplo de código de C++ siguiente se muestra cómo liberar un objeto de extensión.</span><span class="sxs-lookup"><span data-stu-id="6a718-157">The following C++ code example shows how to release an extension object.</span></span>


```C++
UINT CALLBACK CPropSheetExt::PageCallbackProc(  HWND hWnd,
                                                UINT uMsg,
                                                LPPROPSHEETPAGE ppsp)
{
    switch(uMsg)
    {
    case PSPCB_CREATE:
        // Must return TRUE to enable the page to be created.
        return TRUE;

    case PSPCB_RELEASE:
        {
            /*
            Release the object. This is called even if the page dialog box was 
            never actually created.
            */
            CPropSheetExt *pPropSheetExt = (CPropSheetExt*)ppsp->lParam;

            if(pPropSheetExt)
            {
                pPropSheetExt->Release();
            }
        }
        break;
    }

    return FALSE;
}
```



## <a name="working-with-the-notification-object"></a><span data-ttu-id="6a718-158">Trabajar con el objeto de notificación</span><span class="sxs-lookup"><span data-stu-id="6a718-158">Working With the Notification Object</span></span>

<span data-ttu-id="6a718-159">Dado que las páginas de extensión de la hoja de propiedades se muestran en una hoja de propiedades creada por un componente desconocido para la extensión, es necesario utilizar un "administrador" para controlar la transferencia de datos entre las páginas de extensión y la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-159">Because the property sheet extension pages are displayed within a property sheet created by a component unknown to the extension, it is necessary to use a "manager" to handle the data transfer between the extension pages and the property sheet.</span></span> <span data-ttu-id="6a718-160">Este "administrador" se denomina objeto de notificación.</span><span class="sxs-lookup"><span data-stu-id="6a718-160">This "manager" is called the notification object.</span></span> <span data-ttu-id="6a718-161">El objeto de notificación funciona como un moderador entre las páginas individuales y la hoja de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-161">The notification object operates as a moderator between the individual pages and the property sheet.</span></span>

<span data-ttu-id="6a718-162">Cuando se inicializa el objeto de extensión de la hoja de propiedades, la extensión debe crear un objeto de notificación llamando a [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), pasando los [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtenidos de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) y el nombre del objeto de directorio.</span><span class="sxs-lookup"><span data-stu-id="6a718-162">When the property sheet extension object is initialized, the extension must create a notification object by calling [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passing the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and the directory object name.</span></span> <span data-ttu-id="6a718-163">No es necesario incrementar el recuento de referencias de la interfaz **IDataObject** , ya que el objeto de notificación creado por la función **ADsPropCreateNotifyObj** lo hará.</span><span class="sxs-lookup"><span data-stu-id="6a718-163">It is not necessary to increment the reference count of the **IDataObject** interface, because the notification object created by **ADsPropCreateNotifyObj** function will do this.</span></span> <span data-ttu-id="6a718-164">El identificador de objeto de notificación proporcionado por **ADsPropCreateNotifyObj** debe guardarse para su uso posterior.</span><span class="sxs-lookup"><span data-stu-id="6a718-164">The notification object handle provided by **ADsPropCreateNotifyObj** should be saved for later use.</span></span> <span data-ttu-id="6a718-165">Se puede llamar a **ADsPropCreateNotifyObj** durante **IShellExtInit:: Initialize** o [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span><span class="sxs-lookup"><span data-stu-id="6a718-165">**ADsPropCreateNotifyObj** can be either called during **IShellExtInit::Initialize** or [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span></span> <span data-ttu-id="6a718-166">Cuando se cierra la extensión de la hoja de propiedades, debe enviar un mensaje de [**\_ salida de \_ notificación \_ de WM ADSPROP**](wm-adsprop-notify-exit.md) al objeto de notificación.</span><span class="sxs-lookup"><span data-stu-id="6a718-166">When the property sheet extension is shut down, it must send a [**WM\_ADSPROP\_NOTIFY\_EXIT**](wm-adsprop-notify-exit.md) message to the notification object.</span></span> <span data-ttu-id="6a718-167">Esto hace que el objeto de notificación se destruya a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="6a718-167">This causes the notification object to destroy itself.</span></span> <span data-ttu-id="6a718-168">Esto se recomienda cuando la función [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) recibe la notificación **de \_ versión de PSPCB** .</span><span class="sxs-lookup"><span data-stu-id="6a718-168">This is best done when the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function receives the **PSPCB\_RELEASE** notification.</span></span>

<span data-ttu-id="6a718-169">La extensión de la hoja de propiedades puede obtener datos además de los proporcionados por el formato del portapapeles de [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) mediante una llamada a [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span><span class="sxs-lookup"><span data-stu-id="6a718-169">The property sheet extension can obtain data in addition to that provided by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format by calling [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span></span> <span data-ttu-id="6a718-170">Una de las ventajas de usar **ADsPropGetInitInfo** es que proporciona un objeto [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) que se usa para trabajar mediante programación con el objeto de directorio.</span><span class="sxs-lookup"><span data-stu-id="6a718-170">One of the advantages of using **ADsPropGetInitInfo** is that it provides an [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object used to programmatically work with the directory object.</span></span>

> [!Note]  
> <span data-ttu-id="6a718-171">A diferencia de la mayoría de los métodos y funciones COM, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) no incrementa el recuento de referencias para el objeto [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) .</span><span class="sxs-lookup"><span data-stu-id="6a718-171">Unlike most COM methods and functions, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) does not increment the reference count for the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object.</span></span> <span data-ttu-id="6a718-172">No se debe liberar **IDirectoryObject** a menos que primero se incremente el recuento de referencias manualmente.</span><span class="sxs-lookup"><span data-stu-id="6a718-172">The **IDirectoryObject** must not be released unless the reference count is manually incremented first.</span></span>

 

<span data-ttu-id="6a718-173">Cuando se crea por primera vez la página de propiedades, la extensión debe registrar la página con el objeto de notificación llamando a [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) con el identificador de ventana de la página.</span><span class="sxs-lookup"><span data-stu-id="6a718-173">When the property page is first created, the extension should register the page with the notification object by calling [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) with the window handle of the page.</span></span>

<span data-ttu-id="6a718-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) es una función de utilidad que puede usar la extensión de la hoja de propiedades para determinar si se puede escribir una propiedad.</span><span class="sxs-lookup"><span data-stu-id="6a718-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) is a utility function that the property sheet extension can use to determine if a property can be written.</span></span>

## <a name="miscellaneous"></a><span data-ttu-id="6a718-175">Varios</span><span class="sxs-lookup"><span data-stu-id="6a718-175">Miscellaneous</span></span>

<span data-ttu-id="6a718-176">El identificador de la página de propiedades se pasa al procedimiento del cuadro de diálogo de la página.</span><span class="sxs-lookup"><span data-stu-id="6a718-176">The handle of the property page is passed to the page dialog box procedure.</span></span> <span data-ttu-id="6a718-177">La hoja de propiedades es el elemento primario directo de la página de propiedades, por lo que se puede obtener el identificador de la hoja de propiedades mediante una llamada a la función [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) con el identificador de la página de propiedades.</span><span class="sxs-lookup"><span data-stu-id="6a718-177">The property sheet is the direct parent of the property page, so the handle of the property sheet can be obtained by calling the [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) function with the property page handle.</span></span>

<span data-ttu-id="6a718-178">Cuando el contenido de la página de extensión cambia, la extensión debe usar la macro [**PropSheet \_ Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) para notificar a la hoja de propiedades los cambios.</span><span class="sxs-lookup"><span data-stu-id="6a718-178">When the contents of the extension page changes, the extension should use the [**PropSheet\_Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) macro to notify the property sheet of changes.</span></span> <span data-ttu-id="6a718-179">A continuación, la hoja de propiedades habilitará el botón aplicar.</span><span class="sxs-lookup"><span data-stu-id="6a718-179">The property sheet will then enable the Apply button.</span></span>

## <a name="multiple-selection-property-sheets"></a><span data-ttu-id="6a718-180">Multiple-Selection hojas de propiedades</span><span class="sxs-lookup"><span data-stu-id="6a718-180">Multiple-Selection Property Sheets</span></span>

<span data-ttu-id="6a718-181">Con Windows Server 2003 y los sistemas operativos posteriores, los complementos de MMC administrativos Active Directory admiten extensiones de la hoja de propiedades para varios objetos de directorio.</span><span class="sxs-lookup"><span data-stu-id="6a718-181">With Windows Server 2003 and later operating systems, the Active Directory administrative MMC snap-ins support property sheet extensions for multiple directory objects.</span></span> <span data-ttu-id="6a718-182">Estas hojas de propiedades se muestran cuando se ven las propiedades de más de un elemento a la vez.</span><span class="sxs-lookup"><span data-stu-id="6a718-182">These property sheets are displayed when the properties are viewed for more than one item at a time.</span></span> <span data-ttu-id="6a718-183">La principal diferencia entre una extensión de hoja de propiedades de selección única y una extensión de la hoja de propiedades de selección múltiple es que la estructura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) proporcionada por el formato del portapapeles de [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) en [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) contendrá más de una estructura [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="6a718-183">The primary difference between a single-selection property sheet extension and a multiple-selection property sheet extension is that the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure supplied by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format in [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) will contain more than one [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure.</span></span>

<span data-ttu-id="6a718-184">Cuando se crea el objeto de notificación, una extensión de la hoja de propiedades de selección múltiple debe pasar un nombre único proporcionado por el complemento en lugar de un nombre creado por la extensión.</span><span class="sxs-lookup"><span data-stu-id="6a718-184">When the notification object is created, a multi-selection property sheet extension must pass a unique name that is provided by the snap-in rather than a name created by the extension.</span></span> <span data-ttu-id="6a718-185">Para obtener el nombre único, solicite el formato del portapapeles de [**\_ \_ MULTISELECTPROPPAGE de CFSTR DS**](cfstr-ds-multiselectproppage.md) de la [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtenida de [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span><span class="sxs-lookup"><span data-stu-id="6a718-185">To obtain the unique name, request the [**CFSTR\_DS\_MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) clipboard format from the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="6a718-186">Estos datos son un **HGLOBAL** que contiene una cadena Unicode terminada en null que es el nombre único.</span><span class="sxs-lookup"><span data-stu-id="6a718-186">This data is an **HGLOBAL** that contains a null-terminated Unicode string that is the unique name.</span></span> <span data-ttu-id="6a718-187">Este nombre único se pasa a la función [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) para crear el objeto de notificación.</span><span class="sxs-lookup"><span data-stu-id="6a718-187">This unique name is then passed to the [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) function to create the notification object.</span></span> <span data-ttu-id="6a718-188">La función de ejemplo **CreateADsNotificationObject** del [código de ejemplo para la implementación del objeto com de la hoja de propiedades](example-code-for-implementation-of-the-property-sheet-com-object.md) muestra cómo hacerlo correctamente, así como la compatibilidad con versiones anteriores del complemento que no admiten hojas de propiedades de selección múltiple.</span><span class="sxs-lookup"><span data-stu-id="6a718-188">The **CreateADsNotificationObject** example function in [Example Code for Implementation of the Property Sheet COM Object](example-code-for-implementation-of-the-property-sheet-com-object.md) demonstrates how to do this correctly, as well as being compatible with earlier versions of the snap-in that do not support multi-selection property sheets.</span></span>

<span data-ttu-id="6a718-189">En el caso de las hojas de propiedades de selección múltiple, el sistema solo se enlaza al primer objeto de la matriz [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="6a718-189">For multiple-selection property sheets, the system only binds to the first object in the [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) array.</span></span> <span data-ttu-id="6a718-190">Por este motivo, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) solo proporciona los atributos [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) y grabable para el primer objeto de la matriz.</span><span class="sxs-lookup"><span data-stu-id="6a718-190">Because of this, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) only supplies the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) and write-able attributes for the first object in the array.</span></span> <span data-ttu-id="6a718-191">Los demás objetos de la matriz no están enlazados a.</span><span class="sxs-lookup"><span data-stu-id="6a718-191">The other objects in the array are not bound to.</span></span>

<span data-ttu-id="6a718-192">Una extensión de la hoja de propiedades de selección múltiple se registra en el atributo [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) .</span><span class="sxs-lookup"><span data-stu-id="6a718-192">A multiple-selection property sheet extension is registered under the [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) attribute.</span></span>

## <a name="new-with-windows-server-2003"></a><span data-ttu-id="6a718-193">Novedades de Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="6a718-193">New with Windows Server 2003</span></span>

<span data-ttu-id="6a718-194">Las siguientes características son nuevas en Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="6a718-194">The following features are new with Windows Server 2003.</span></span>

<span data-ttu-id="6a718-195">Si la página de propiedades encuentra un error, se puede llamar a [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) con los datos de error adecuados.</span><span class="sxs-lookup"><span data-stu-id="6a718-195">If the property page encounters an error, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) can be called with the appropriate error data.</span></span> <span data-ttu-id="6a718-196">**ADsPropSendErrorMessage** almacenará todos los mensajes de error en una cola.</span><span class="sxs-lookup"><span data-stu-id="6a718-196">**ADsPropSendErrorMessage** will store all error messages in a queue.</span></span> <span data-ttu-id="6a718-197">Estos mensajes se mostrarán la próxima vez que se llame a [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) .</span><span class="sxs-lookup"><span data-stu-id="6a718-197">These messages will be displayed the next time [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) is called.</span></span> <span data-ttu-id="6a718-198">Cuando **ADsPropShowErrorDialog** devuelve, se eliminan los mensajes en cola.</span><span class="sxs-lookup"><span data-stu-id="6a718-198">When **ADsPropShowErrorDialog** returns, the queued messages are deleted.</span></span>

<span data-ttu-id="6a718-199">Windows Server 2003 presenta la función [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) .</span><span class="sxs-lookup"><span data-stu-id="6a718-199">Windows Server 2003 introduces the [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) function.</span></span> <span data-ttu-id="6a718-200">Esta función es similar a [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), pero incluye el título de la página.</span><span class="sxs-lookup"><span data-stu-id="6a718-200">This function is similar to [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), but includes the page title.</span></span> <span data-ttu-id="6a718-201">Esto permite que el cuadro de diálogo de error que muestra [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) proporcione datos más útiles al usuario.</span><span class="sxs-lookup"><span data-stu-id="6a718-201">This enables the error dialog box displayed by [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) to provide more useful data to the user.</span></span> <span data-ttu-id="6a718-202">Si la extensión de la hoja de propiedades utiliza la función **ADsPropShowErrorDialog** , la extensión debe usar **ADsPropSetHwndWithTitle** en lugar de **ADsPropSetHwnd**.</span><span class="sxs-lookup"><span data-stu-id="6a718-202">If the property sheet extension uses the **ADsPropShowErrorDialog** function, the extension should use **ADsPropSetHwndWithTitle** rather than **ADsPropSetHwnd**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="6a718-203">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="6a718-203">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="6a718-204">Código de ejemplo para la implementación del objeto COM de la hoja de propiedades</span><span class="sxs-lookup"><span data-stu-id="6a718-204">Example Code for Implementation of the Property Sheet COM Object</span></span>](example-code-for-implementation-of-the-property-sheet-com-object.md)
</dt> </dl>

 

 