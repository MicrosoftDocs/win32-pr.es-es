---
description: Recuperación de un error de Invalid-Device
ms.assetid: 1f5c3458-70ca-45ba-ac33-5c7b9f092320
title: Recuperación de un error de Invalid-Device
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca20c32be46367f53a14ce26c39f980e3649b652
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104153398"
---
# <a name="recovering-from-an-invalid-device-error"></a><span data-ttu-id="b68c1-103">Recuperación de un error de Invalid-Device</span><span class="sxs-lookup"><span data-stu-id="b68c1-103">Recovering from an Invalid-Device Error</span></span>

<span data-ttu-id="b68c1-104">Muchos de los métodos de WASAPI devuelven el código de error AUDCLNT \_ E \_ \_ se invalidan si el dispositivo de punto de conexión de audio que utiliza la aplicación cliente deja de ser válido.</span><span class="sxs-lookup"><span data-stu-id="b68c1-104">Many of the methods in WASAPI return error code AUDCLNT\_E\_DEVICE\_INVALIDATED if the audio endpoint device that the client application is using becomes invalid.</span></span> <span data-ttu-id="b68c1-105">Este código de error indica que el dispositivo de punto de conexión se ha desconectado, o que el hardware de audio o los recursos de hardware asociados se han reconfigurado, deshabilitado, quitado o no está disponible para su uso.</span><span class="sxs-lookup"><span data-stu-id="b68c1-105">This error code indicates that the endpoint device has been unplugged, or that the audio hardware or associated hardware resources have been reconfigured, disabled, removed, or otherwise made unavailable for use.</span></span> <span data-ttu-id="b68c1-106">Con frecuencia, la aplicación puede recuperarse de este error.</span><span class="sxs-lookup"><span data-stu-id="b68c1-106">Frequently, the application can recover from this error.</span></span>

>[!NOTE]
> <span data-ttu-id="b68c1-107">Para obtener información sobre cómo recuperarse de errores de dispositivo no válidos al usar las API de audio espacial (ISAC), consulte [recuperación de un error de Invalid-Device (sonido espacial)](recovering-from-an-invalid-device-error-spatial-sound.md) .</span><span class="sxs-lookup"><span data-stu-id="b68c1-107">For information on recovering from invalid device errors when using spatial audio APIs (ISAC), see [Recovering from an Invalid-Device Error (Spatial Sound)](recovering-from-an-invalid-device-error-spatial-sound.md)</span></span>

<span data-ttu-id="b68c1-108">La estrategia que debe usar una aplicación para recuperarse de un \_ \_ \_ error invalidado del dispositivo AUDCLNT depende de cuál de las siguientes técnicas use la aplicación para seleccionar un dispositivo de punto de conexión de audio:</span><span class="sxs-lookup"><span data-stu-id="b68c1-108">The strategy that an application should use to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error depends on which of the following techniques the application uses to select an audio endpoint device:</span></span>

-   <span data-ttu-id="b68c1-109">Seleccione siempre el dispositivo de captura o representación de audio predeterminado.</span><span class="sxs-lookup"><span data-stu-id="b68c1-109">Always select the default audio rendering or capture device.</span></span>
-   <span data-ttu-id="b68c1-110">Seleccione un dispositivo de punto de conexión de audio específico.</span><span class="sxs-lookup"><span data-stu-id="b68c1-110">Select a specific audio endpoint device.</span></span>

<span data-ttu-id="b68c1-111">En el último caso, la aplicación selecciona automáticamente un dispositivo específico según los requisitos internos o permite al usuario seleccionar explícitamente un dispositivo en una lista de dispositivos disponibles.</span><span class="sxs-lookup"><span data-stu-id="b68c1-111">In the latter case, either the application automatically selects a specific device based on internal requirements or it allows the user to explicitly select a device from a list of available devices.</span></span>

<span data-ttu-id="b68c1-112">Una aplicación que usa el dispositivo predeterminado puede intentar recuperarse de un \_ \_ \_ error invalidado del dispositivo AUDCLNT E:</span><span class="sxs-lookup"><span data-stu-id="b68c1-112">An application that uses the default device can attempt to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="b68c1-113">Libere la interfaz [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) y cualquier otra interfaz WASAPI que haya adquirido en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-113">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="b68c1-114">Llame al método [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) para obtener el dispositivo de audio predeterminado actual.</span><span class="sxs-lookup"><span data-stu-id="b68c1-114">Call the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method to get the current default audio device.</span></span>
3.  <span data-ttu-id="b68c1-115">Intente activar [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) en el dispositivo de audio predeterminado.</span><span class="sxs-lookup"><span data-stu-id="b68c1-115">Attempt to activate [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) on the default audio device.</span></span>

<span data-ttu-id="b68c1-116">Al seguir los pasos anteriores, la aplicación tiende a responder correctamente, independientemente de la causa del \_ \_ \_ error invalidado del dispositivo AUDCLNT E.</span><span class="sxs-lookup"><span data-stu-id="b68c1-116">By following the preceding steps, the application tends to respond appropriately regardless of the cause of the AUDCLNT\_E\_DEVICE\_INVALIDATED error.</span></span> <span data-ttu-id="b68c1-117">Si la reconfiguración del dispositivo predeterminado provocó el error (por ejemplo, si el usuario cambia el formato de secuencia usado por el dispositivo), estos pasos, si se realizan correctamente, permiten que la aplicación siga usando el mismo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-117">If reconfiguration of the default device caused the error (for example, if the user changed the stream format used by the device), then these steps, if they succeed, enable the application to continue to use the same device.</span></span> <span data-ttu-id="b68c1-118">Si el usuario ha deshabilitado o quitado el dispositivo que estaba usando la aplicación y hay otro dispositivo disponible para asumir el rol de dispositivo predeterminado, la aplicación puede continuar usando el nuevo dispositivo predeterminado.</span><span class="sxs-lookup"><span data-stu-id="b68c1-118">If the user disabled or removed the device that the application was using and another device is available to assume the role of default device, then the application can continue by using the new default device.</span></span> <span data-ttu-id="b68c1-119">En cualquier caso, la aplicación se adapta automáticamente sin requerir la intervención del usuario.</span><span class="sxs-lookup"><span data-stu-id="b68c1-119">In either case, the application adapts automatically without requiring intervention by the user.</span></span>

<span data-ttu-id="b68c1-120">Una aplicación que selecciona un dispositivo específico puede intentar recuperarse del \_ \_ \_ error invalidado del dispositivo AUDCLNT E, como se indica a continuación:</span><span class="sxs-lookup"><span data-stu-id="b68c1-120">An application that selects a specific device can attempt to recover from the AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="b68c1-121">Libere la interfaz [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) y cualquier otra interfaz WASAPI que haya adquirido en el dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-121">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="b68c1-122">Intenta activar una interfaz [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) en el mismo dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-122">Attempt to activate an [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface on the same device.</span></span>
3.  <span data-ttu-id="b68c1-123">Si se produce un error en el paso 2, la aplicación puede, opcionalmente, pedir al usuario que seleccione otro dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-123">If step 2 fails, then the application can, as an option, prompt the user to select another device.</span></span>

<span data-ttu-id="b68c1-124">El paso 2 puede realizarse correctamente si el dispositivo que usa la aplicación se ha reconfigurado pero no se ha deshabilitado o quitado.</span><span class="sxs-lookup"><span data-stu-id="b68c1-124">Step 2 can succeed if the device being used by the application was reconfigured but not disabled or removed.</span></span> <span data-ttu-id="b68c1-125">Si se realiza correctamente, el paso 2 permite que la aplicación siga usando automáticamente el mismo dispositivo sin necesidad de que el usuario intervenga.</span><span class="sxs-lookup"><span data-stu-id="b68c1-125">If successful, step 2 enables the application to automatically continue to use the same device without requiring intervention by the user.</span></span> <span data-ttu-id="b68c1-126">El paso 3 es adecuado si la aplicación permite al usuario seleccionar otro dispositivo explícitamente después de que el usuario haya deshabilitado o quitado el dispositivo usado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="b68c1-126">Step 3 is appropriate if the application allows the user to explicitly select another device after the user has disabled or removed the previously used device.</span></span>

<span data-ttu-id="b68c1-127">Una aplicación puede determinar con mayor precisión la causa de un error de dispositivo no válido al registrarse para recibir una notificación cuando una sesión pierde su conexión con un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-127">An application can determine more precisely the cause of an invalid-device error by registering to receive a notification when a session loses its connection to a device.</span></span> <span data-ttu-id="b68c1-128">Para habilitar esta notificación, la aplicación implementa una interfaz [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) y llama al método [**IAudioSessionControl:: RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) para registrar la interfaz.</span><span class="sxs-lookup"><span data-stu-id="b68c1-128">To enable this notification, the application implements an [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and calls the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method to register the interface.</span></span> <span data-ttu-id="b68c1-129">Cuando un error de dispositivo no válido hace que se desconecte la sesión, WASAPI llama al método [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) en la interfaz registrada.</span><span class="sxs-lookup"><span data-stu-id="b68c1-129">When an invalid-device error causes the session to be disconnected, WASAPI calls the [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) method in the registered interface.</span></span> <span data-ttu-id="b68c1-130">A través de este método, WASAPI informa a la aplicación de la razón de la desconexión.</span><span class="sxs-lookup"><span data-stu-id="b68c1-130">Through this method, WASAPI informs the application of the reason for the disconnection.</span></span> <span data-ttu-id="b68c1-131">En Windows Vista, la llamada a **OnSessionDisconnected** identifica los siguientes motivos:</span><span class="sxs-lookup"><span data-stu-id="b68c1-131">In Windows Vista, the **OnSessionDisconnected** call identifies the following reasons:</span></span>

-   <span data-ttu-id="b68c1-132">El usuario quitó el dispositivo de punto de conexión de audio.</span><span class="sxs-lookup"><span data-stu-id="b68c1-132">The user removed the audio endpoint device.</span></span>
-   <span data-ttu-id="b68c1-133">El servicio audio de Windows se ha cerrado.</span><span class="sxs-lookup"><span data-stu-id="b68c1-133">The Windows audio service has shut down.</span></span>
-   <span data-ttu-id="b68c1-134">El formato de flujo preferido cambió para el dispositivo al que está conectada la sesión de audio.</span><span class="sxs-lookup"><span data-stu-id="b68c1-134">The preferred stream format changed for the device that the audio session is connected to.</span></span>
-   <span data-ttu-id="b68c1-135">El usuario cerró la sesión de Windows Terminal Services (WTS) en la que se estaba ejecutando la sesión de audio.</span><span class="sxs-lookup"><span data-stu-id="b68c1-135">The user logged off the Windows Terminal Services (WTS) session that the audio session was running in.</span></span> <span data-ttu-id="b68c1-136">Para obtener más información acerca de las sesiones de WTS, consulte la documentación de Windows SDK.</span><span class="sxs-lookup"><span data-stu-id="b68c1-136">For more information about WTS sessions, see the Windows SDK documentation.</span></span>
-   <span data-ttu-id="b68c1-137">La sesión de WTS en la que se estaba ejecutando la sesión de audio estaba desconectada.</span><span class="sxs-lookup"><span data-stu-id="b68c1-137">The WTS session that the audio session was running in was disconnected.</span></span>
-   <span data-ttu-id="b68c1-138">La sesión de audio (modo compartido) se desconectó para que el dispositivo de extremo de audio esté disponible para una conexión de modo exclusivo.</span><span class="sxs-lookup"><span data-stu-id="b68c1-138">The (shared-mode) audio session was disconnected to make the audio endpoint device available for an exclusive-mode connection.</span></span>

<span data-ttu-id="b68c1-139">En respuesta al evento de desconexión, WASAPI cierra todas las secuencias que pertenecen a la sesión.</span><span class="sxs-lookup"><span data-stu-id="b68c1-139">In response to the disconnection event, WASAPI closes all of the streams that belong to the session.</span></span> <span data-ttu-id="b68c1-140">Si una aplicación intenta posteriormente acceder a un flujo cerrado a través de un método WASAPI como [**IAudioClient:: GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), entonces se produce un error en el método y se devuelve el código de error AUDCLNT \_ E \_ \_ invalidado.</span><span class="sxs-lookup"><span data-stu-id="b68c1-140">If an application subsequently attempts to access a closed stream through a WASAPI method such as [**IAudioClient::GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), then the method fails and returns error code AUDCLNT\_E\_DEVICE\_INVALIDATED.</span></span>

<span data-ttu-id="b68c1-141">Una ventaja adicional para recibir notificaciones a través de la interfaz [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) es que las notificaciones llegan de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="b68c1-141">An additional benefit to receiving notifications through the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface is that the notifications arrive asynchronously.</span></span> <span data-ttu-id="b68c1-142">Por lo tanto, aunque la secuencia no se esté ejecutando, la aplicación seguirá recibiendo notificaciones oportunas de errores de dispositivo no válidos que pueden impedir la ejecución de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="b68c1-142">Thus, even when the stream is not running, the application will still receive timely notification of invalid-device errors that can prevent the stream from running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b68c1-143">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="b68c1-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b68c1-144">Administración de flujos</span><span class="sxs-lookup"><span data-stu-id="b68c1-144">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



