---
title: Información técnica de COM
ms.assetid: 519c87cc-b442-4187-af2a-124a1e4e8b49
description: 'Más información sobre: información técnica de COM'
keywords:
- Información técnica de COM COM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: be5dc95ffae5166d86cd8110cab1a6b90e6ffa5c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104153031"
---
# <a name="com-technical-overview"></a><span data-ttu-id="cbedf-104">Información técnica de COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-104">COM Technical Overview</span></span>

<span data-ttu-id="cbedf-105">En este tema se proporciona información general sobre el modelo de objetos componentes (COM) de Microsoft:</span><span class="sxs-lookup"><span data-stu-id="cbedf-105">This topic provides an overview of the Microsoft Component Object Model (COM):</span></span>

-   [<span data-ttu-id="cbedf-106">Introducción a COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-106">Introduction to COM</span></span>](#introduction-to-com)
-   [<span data-ttu-id="cbedf-107">Objetos e interfaces</span><span class="sxs-lookup"><span data-stu-id="cbedf-107">Objects and Interfaces</span></span>](#objects-and-interfaces)
-   [<span data-ttu-id="cbedf-108">Implementación de interfaz</span><span class="sxs-lookup"><span data-stu-id="cbedf-108">Interface implementation</span></span>](#interface-implementation)
-   [<span data-ttu-id="cbedf-109">La interfaz IUnknown</span><span class="sxs-lookup"><span data-stu-id="cbedf-109">The IUnknown Interface</span></span>](#the-iunknown-interface)
-   [<span data-ttu-id="cbedf-110">El modelo cliente/servidor</span><span class="sxs-lookup"><span data-stu-id="cbedf-110">The Client/Server Model</span></span>](#the-clientserver-model)
-   [<span data-ttu-id="cbedf-111">Administrador de control de servicios</span><span class="sxs-lookup"><span data-stu-id="cbedf-111">Service Control Manager</span></span>](#service-control-manager)
-   [<span data-ttu-id="cbedf-112">Reusabilidad</span><span class="sxs-lookup"><span data-stu-id="cbedf-112">Reusability</span></span>](#reusability)
-   [<span data-ttu-id="cbedf-113">Objetos de almacenamiento y flujo</span><span class="sxs-lookup"><span data-stu-id="cbedf-113">Storage and Stream Objects</span></span>](#storage-and-stream-objects)
-   [<span data-ttu-id="cbedf-114">Transferencia de datos</span><span class="sxs-lookup"><span data-stu-id="cbedf-114">Data Transfer</span></span>](#data-transfer)
-   [<span data-ttu-id="cbedf-115">Comunicación remota</span><span class="sxs-lookup"><span data-stu-id="cbedf-115">Remoting</span></span>](#remoting)
-   [<span data-ttu-id="cbedf-116">Seguridad</span><span class="sxs-lookup"><span data-stu-id="cbedf-116">Security</span></span>](#security)
-   [<span data-ttu-id="cbedf-117">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="cbedf-117">Related topics</span></span>](#related-topics)

## <a name="introduction-to-com"></a><span data-ttu-id="cbedf-118">Introducción a COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-118">Introduction to COM</span></span>

<span data-ttu-id="cbedf-119">El modelo de objetos componentes (COM) de Microsoft define un estándar de interoperabilidad binaria para crear bibliotecas de software reutilizables que interactúan en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="cbedf-119">The Microsoft Component Object Model (COM) defines a binary interoperability standard for creating reusable software libraries that interact at run time.</span></span> <span data-ttu-id="cbedf-120">Puede usar las bibliotecas COM sin el requisito de compilarlas en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-120">You can use COM libraries without the requirement of compiling them into your application.</span></span> <span data-ttu-id="cbedf-121">COM es la base de una serie de productos y tecnologías de Microsoft, como Windows Media Player y Windows Server.</span><span class="sxs-lookup"><span data-stu-id="cbedf-121">COM is the foundation for a number of Microsoft products and technologies, such as Windows Media Player and Windows Server.</span></span>

<span data-ttu-id="cbedf-122">COM define un estándar binario que se aplica a muchos sistemas operativos y plataformas de hardware.</span><span class="sxs-lookup"><span data-stu-id="cbedf-122">COM defines a binary standard that applies to many operating systems and hardware platforms.</span></span> <span data-ttu-id="cbedf-123">En lo que se refiere a la informática de red, COM define un protocolo y un formato de conexión estándar para la interacción entre los objetos que se ejecutan en diferentes plataformas de hardware.</span><span class="sxs-lookup"><span data-stu-id="cbedf-123">For network computing, COM defines a standard wire format and protocol for interaction among objects that run on different hardware platforms.</span></span> <span data-ttu-id="cbedf-124">COM es independiente del lenguaje de implementación, lo que significa que se pueden crear bibliotecas COM mediante lenguajes de programación diferentes, como C++ y los del .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cbedf-124">COM is independent of implementation language, which means that you can create COM libraries by using different programming languages, such as C++ and those in the .NET Framework.</span></span>

<span data-ttu-id="cbedf-125">La especificación COM proporciona todos los conceptos fundamentales que permiten la reutilización de software multiplataforma:</span><span class="sxs-lookup"><span data-stu-id="cbedf-125">The COM specification provides all of the fundamental concepts that enable cross-platform software reuse:</span></span>

-   <span data-ttu-id="cbedf-126">Estándar binario para las llamadas de función entre componentes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-126">A binary standard for function calls between components.</span></span>
-   <span data-ttu-id="cbedf-127">Aprovisionamiento para agrupaciones fuertemente tipadas de funciones en interfaces.</span><span class="sxs-lookup"><span data-stu-id="cbedf-127">A provision for strongly-typed groupings of functions into interfaces.</span></span>
-   <span data-ttu-id="cbedf-128">Una interfaz base que proporciona polimorfismo, detección de características y seguimiento de la duración de los objetos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-128">A base interface that provides polymorphism, feature discovery, and object lifetime tracking.</span></span>
-   <span data-ttu-id="cbedf-129">Mecanismo que identifica de forma única los componentes y sus interfaces.</span><span class="sxs-lookup"><span data-stu-id="cbedf-129">A mechanism that uniquely identifies components and their interfaces.</span></span>
-   <span data-ttu-id="cbedf-130">Un cargador de componentes que crea instancias de componente a partir de una implementación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-130">A component loader that creates component instances from a deployment.</span></span>

<span data-ttu-id="cbedf-131">COM tiene varias partes que funcionan conjuntamente para habilitar la creación de aplicaciones que se crean a partir de componentes reutilizables:</span><span class="sxs-lookup"><span data-stu-id="cbedf-131">COM has a number of parts that work together to enable the creation of applications that are built from reusable components:</span></span>

-   <span data-ttu-id="cbedf-132">*Sistema host* que proporciona un entorno en tiempo de ejecución que se ajusta a la especificación com.</span><span class="sxs-lookup"><span data-stu-id="cbedf-132">A *host system* that provides a run-time environment that conforms to the COM specification.</span></span>
-   <span data-ttu-id="cbedf-133">*Interfaces* que definen contratos de características y *componentes* que implementan interfaces.</span><span class="sxs-lookup"><span data-stu-id="cbedf-133">*Interfaces* that define feature contracts, and *components* that implement interfaces.</span></span>
-   <span data-ttu-id="cbedf-134">*Servidores* que proporcionan componentes al sistema y *clientes* que usan las características proporcionadas por los componentes de.</span><span class="sxs-lookup"><span data-stu-id="cbedf-134">*Servers* that provide components to the system, and *clients* that use the features provided by components.</span></span>
-   <span data-ttu-id="cbedf-135">Un *registro* que realiza un seguimiento de dónde se implementan los componentes en hosts locales y remotos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-135">A *registry* that tracks where components are deployed on local and remote hosts.</span></span>
-   <span data-ttu-id="cbedf-136">*Administrador de control de servicios* que busca componentes en hosts locales y remotos y conecta servidores a los clientes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-136">A *Service Control Manager* that locates components on local and remote hosts and connects servers to clients.</span></span>
-   <span data-ttu-id="cbedf-137">Un protocolo de *almacenamiento estructurado* que define cómo navegar por el contenido de los archivos en el sistema de archivos del host.</span><span class="sxs-lookup"><span data-stu-id="cbedf-137">A *structured storage* protocol that defines how to navigate the contents of files on the host's file system.</span></span>

<span data-ttu-id="cbedf-138">Habilitar la reutilización de código entre hosts y plataformas es fundamental para COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-138">Enabling code re-use across hosts and platforms is central to COM.</span></span> <span data-ttu-id="cbedf-139">Una implementación de interfaz reutilizable se denomina *componente*, un *objeto de componente* o un *objeto com*.</span><span class="sxs-lookup"><span data-stu-id="cbedf-139">A reusable interface implementation is named a *component*, a *component object*, or a *COM object*.</span></span> <span data-ttu-id="cbedf-140">Un componente implementa una o más interfaces COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-140">A component implements one or more COM interfaces.</span></span>

<span data-ttu-id="cbedf-141">Puede definir una biblioteca COM personalizada diseñando las interfaces que implementa la biblioteca.</span><span class="sxs-lookup"><span data-stu-id="cbedf-141">You define a custom COM library by designing the interfaces that your library implements.</span></span> <span data-ttu-id="cbedf-142">Los consumidores de la biblioteca pueden detectar y usar sus características sin tener que conocer los detalles de implementación e implementación de la biblioteca.</span><span class="sxs-lookup"><span data-stu-id="cbedf-142">Consumers of your library can discover and use its features without any knowledge of your library's deployment and implementation details.</span></span>

## <a name="objects-and-interfaces"></a><span data-ttu-id="cbedf-143">Objetos e interfaces</span><span class="sxs-lookup"><span data-stu-id="cbedf-143">Objects and Interfaces</span></span>

<span data-ttu-id="cbedf-144">Un objeto COM expone sus características a través de una *interfaz*, que es una colección de funciones miembro.</span><span class="sxs-lookup"><span data-stu-id="cbedf-144">A COM object exposes its features through an *interface*, which is a collection of member functions.</span></span> <span data-ttu-id="cbedf-145">Una interfaz COM define el comportamiento esperado y las responsabilidades de un componente, y especifica un contrato fuertemente tipado que proporciona un conjunto pequeño de operaciones relacionadas.</span><span class="sxs-lookup"><span data-stu-id="cbedf-145">A COM interface defines the expected behavior and responsibilities of a component, and it specifies a strongly-typed contract that provides a small set of related operations.</span></span> <span data-ttu-id="cbedf-146">Toda la comunicación entre los componentes COM se produce a través de las interfaces, y todos los servicios que ofrece un componente se exponen a través de su interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-146">All communication among COM components occurs through interfaces, and all services offered by a component are exposed through its interface.</span></span> <span data-ttu-id="cbedf-147">Un llamador solo puede tener acceso a las funciones miembro de interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-147">A caller can access only the interface member functions.</span></span> <span data-ttu-id="cbedf-148">El estado interno no está disponible para un llamador a menos que se exponga en la interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-148">Internal state is unavailable to a caller unless it is exposed in the interface.</span></span>

<span data-ttu-id="cbedf-149">Las interfaces están fuertemente tipadas.</span><span class="sxs-lookup"><span data-stu-id="cbedf-149">Interfaces are strongly typed.</span></span> <span data-ttu-id="cbedf-150">Cada interfaz tiene su propio identificador de interfaz único, denominado IID, que elimina las colisiones que podrían producirse con nombres legibles para el usuario.</span><span class="sxs-lookup"><span data-stu-id="cbedf-150">Every interface has its own unique interface identifier, named an IID, which eliminates collisions that could occur with human-readable names.</span></span> <span data-ttu-id="cbedf-151">El IID es un identificador único global (GUID), que es el mismo que el identificador único universal (UUID) definido por el entorno de computación distribuida (DCE) de Open Software Foundation (OSF).</span><span class="sxs-lookup"><span data-stu-id="cbedf-151">The IID is a globally unique identifier (GUID), which is the same as the Universally Unique ID (UUID) defined by the Open Software Foundation (OSF) Distributed Computing Environment (DCE).</span></span> <span data-ttu-id="cbedf-152">Al crear una nueva interfaz, debe crear un nuevo identificador para esa interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-152">When you create a new interface, you must create a new identifier for that interface.</span></span> <span data-ttu-id="cbedf-153">Cuando un llamador usa una interfaz, debe utilizar el identificador único.</span><span class="sxs-lookup"><span data-stu-id="cbedf-153">When a caller uses an interface, it must use the unique identifier.</span></span> <span data-ttu-id="cbedf-154">Esta identificación explícita mejora la solidez al eliminar los conflictos de nomenclatura que darían lugar a errores en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="cbedf-154">This explicit identification improves robustness by eliminating naming conflicts that would result in run-time failure.</span></span>

<span data-ttu-id="cbedf-155">Al definir una nueva interfaz, puede crear una definición de interfaz mediante el lenguaje de definición de interfaz (IDL).</span><span class="sxs-lookup"><span data-stu-id="cbedf-155">When you define a new interface, you can create an interface definition by using the interface definition language (IDL).</span></span> <span data-ttu-id="cbedf-156">A partir de esta definición de interfaz, el compilador IDL de Microsoft genera archivos de encabezado para que los usen las aplicaciones que usan la interfaz y el código fuente para controlar las llamadas a procedimientos remotos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-156">From this interface definition, the Microsoft IDL compiler generates header files for use by applications using the interface, and source code to handle remote procedure calls.</span></span> <span data-ttu-id="cbedf-157">El IDL proporcionado por Microsoft se basa en extensiones simples a DCE IDL, un estándar del sector para la informática distribuida basada en la llamada a procedimiento remoto (RPC).</span><span class="sxs-lookup"><span data-stu-id="cbedf-157">The IDL supplied by Microsoft is based on simple extensions to DCE IDL, an industry standard for Remote Procedure Call (RPC)-based distributed computing.</span></span> <span data-ttu-id="cbedf-158">IDL es una herramienta para la comodidad del diseñador de interfaces y no es fundamental para la interoperabilidad COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-158">IDL is a tool for the convenience of the interface designer and is not central to COM interoperability.</span></span> <span data-ttu-id="cbedf-159">Con IDL, no es necesario crear archivos de encabezado manualmente para cada entorno de programación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-159">With IDL, you do not need to create header files manually for each programming environment.</span></span> <span data-ttu-id="cbedf-160">Para obtener más información, vea [definir interfaces com](defining-com-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-160">For more information, see [Defining COM Interfaces](defining-com-interfaces.md).</span></span>

<span data-ttu-id="cbedf-161">La herencia se usa con moderación en las interfaces COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-161">Inheritance is used sparingly in COM interfaces.</span></span> <span data-ttu-id="cbedf-162">COM solo admite la herencia de interfaz para reutilizar un contrato asociado a una interfaz base.</span><span class="sxs-lookup"><span data-stu-id="cbedf-162">COM supports interface inheritance only to reuse a contract associated with a base interface.</span></span> <span data-ttu-id="cbedf-163">COM no admite la herencia selectiva; por consiguiente, si una interfaz hereda de otra, incluye todas las funciones que define la interfaz base.</span><span class="sxs-lookup"><span data-stu-id="cbedf-163">COM does not support selective inheritance; therefore, if one interface inherits from another, it includes all of the functions that the base interface defines.</span></span> <span data-ttu-id="cbedf-164">Además, las interfaces solo utilizan la herencia única, en lugar de la herencia múltiple, para obtener funciones de una interfaz base.</span><span class="sxs-lookup"><span data-stu-id="cbedf-164">In addition, interfaces use only single inheritance, instead of multiple inheritance, to obtain functions from a base interface.</span></span>

## <a name="interface-implementation"></a><span data-ttu-id="cbedf-165">Implementación de interfaz</span><span class="sxs-lookup"><span data-stu-id="cbedf-165">Interface implementation</span></span>

<span data-ttu-id="cbedf-166">No se puede crear una instancia de una interfaz COM por sí misma.</span><span class="sxs-lookup"><span data-stu-id="cbedf-166">You cannot create an instance of a COM interface by itself.</span></span> <span data-ttu-id="cbedf-167">En su lugar, se crea una instancia de una clase que implementa la interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-167">Instead, you create an instance of a class that implements the interface.</span></span> <span data-ttu-id="cbedf-168">En C++, una interfaz COM se modela como una *clase base abstracta*, lo que significa que la interfaz es una clase de C++ que solo contiene funciones miembro virtuales puras.</span><span class="sxs-lookup"><span data-stu-id="cbedf-168">In C++, a COM interface is modeled as an *abstract base class*, which means that the interface is a C++ class that contains only pure virtual member functions.</span></span> <span data-ttu-id="cbedf-169">Una biblioteca de C++ implementa objetos COM heredando las firmas de función miembro de una o varias interfaces, invalidando cada función miembro y proporcionando una implementación para cada función.</span><span class="sxs-lookup"><span data-stu-id="cbedf-169">A C++ library implements COM objects by inheriting the member function signatures from one or more interfaces, overriding each member function, and providing an implementation for each function.</span></span>

<span data-ttu-id="cbedf-170">Puede usar cualquier lenguaje de programación que admita el concepto de punteros de función para implementar una interfaz COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-170">You can use any programming language that supports the concept of function pointers to implement a COM interface.</span></span> <span data-ttu-id="cbedf-171">Por ejemplo, en C, una interfaz es una estructura que contiene un puntero a una tabla de punteros de función, uno para cada método de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-171">For example, in C, an interface is a structure containing a pointer to a table of function pointers, one for each method in the interface.</span></span>

<span data-ttu-id="cbedf-172">Cuando se implementa una interfaz, la clase debe proporcionar una implementación para cada función de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-172">When you implement an interface, your class must provide an implementation for every function in the interface.</span></span> <span data-ttu-id="cbedf-173">Si la clase no tiene ningún trabajo que hacer en una función de interfaz, la implementación puede ser una sola instrucción return.</span><span class="sxs-lookup"><span data-stu-id="cbedf-173">If the class has no work to do in an interface function, the implementation may be a single return statement.</span></span>

<span data-ttu-id="cbedf-174">Una clase COM se identifica mediante el uso de un identificador de clase (CLSID) de 128 bits único que asocia una clase a una implementación determinada en el sistema de archivos, que para Windows es una DLL o un archivo EXE.</span><span class="sxs-lookup"><span data-stu-id="cbedf-174">A COM class is identified by using a unique 128-bit Class ID (CLSID) that associates a class with a particular deployment in the file system, which for Windows is a DLL or EXE.</span></span> <span data-ttu-id="cbedf-175">Un CLSID es un GUID, lo que significa que ninguna otra clase tiene el mismo CLSID.</span><span class="sxs-lookup"><span data-stu-id="cbedf-175">A CLSID is a GUID, which means that no other class has the same CLSID.</span></span> <span data-ttu-id="cbedf-176">El uso de identificadores de clase únicos evita los conflictos de nombres entre las clases.</span><span class="sxs-lookup"><span data-stu-id="cbedf-176">The use of unique class identifiers prevents name collisions among classes.</span></span> <span data-ttu-id="cbedf-177">Por ejemplo, dos proveedores diferentes pueden escribir una clase denominada CStack, pero ambas clases tienen un CLSID único, por lo que se evita cualquier posibilidad de una colisión.</span><span class="sxs-lookup"><span data-stu-id="cbedf-177">For example, two different vendors can write a class named CStack, but both classes have a unique CLSID, so any possibility of a collision is avoided.</span></span>

<span data-ttu-id="cbedf-178">Puede obtener un nuevo CLSID mediante la función [**CoCreateGuid**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateguid) o mediante una herramienta de creación de com, como Visual Studio, que llama a esta función internamente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-178">You obtain a new CLSID by using the [**CoCreateGuid**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateguid) function or by using a COM authoring tool, such as Visual Studio, that calls this function internally.</span></span>

## <a name="the-iunknown-interface"></a><span data-ttu-id="cbedf-179">La interfaz IUnknown</span><span class="sxs-lookup"><span data-stu-id="cbedf-179">The IUnknown Interface</span></span>

<span data-ttu-id="cbedf-180">Todas las interfaces COM heredan de la interfaz [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-180">All COM interfaces inherit from the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="cbedf-181">La interfaz **IUnknown** contiene las operaciones com fundamentales para el polimorfismo y la administración de la duración de la instancia.</span><span class="sxs-lookup"><span data-stu-id="cbedf-181">The **IUnknown** interface contains the fundamental COM operations for polymorphism and instance lifetime management.</span></span> <span data-ttu-id="cbedf-182">La interfaz **IUnknown** tiene tres funciones miembro, denominadas [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref)y [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="cbedf-182">The **IUnknown** interface has three member functions, named [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref), and [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span> <span data-ttu-id="cbedf-183">Todos los objetos COM son necesarios para implementar la interfaz **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="cbedf-183">All COM objects are required to implement the **IUnknown** interface.</span></span>

<span data-ttu-id="cbedf-184">La función miembro [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) proporciona el polimorfismo para com.</span><span class="sxs-lookup"><span data-stu-id="cbedf-184">The [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) member function provides polymorphism for COM.</span></span> <span data-ttu-id="cbedf-185">Llame a **QueryInterface** para determinar en tiempo de ejecución si un objeto com admite una interfaz determinada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-185">Call **QueryInterface** to determine at run time whether a COM object supports a particular interface.</span></span> <span data-ttu-id="cbedf-186">El objeto COM devuelve un puntero de interfaz en el `ppvObject` parámetro si implementa la interfaz solicitada; en caso contrario, devuelve `NULL` .</span><span class="sxs-lookup"><span data-stu-id="cbedf-186">The COM object returns an interface pointer in the `ppvObject` parameter if it implements the requested interface, otherwise it returns `NULL`.</span></span> <span data-ttu-id="cbedf-187">La función miembro **QueryInterface** habilita la navegación entre todas las interfaces que admite un objeto com.</span><span class="sxs-lookup"><span data-stu-id="cbedf-187">The **QueryInterface** member function enables navigation among all of the interfaces that a COM object supports.</span></span>

<span data-ttu-id="cbedf-188">La duración de una instancia del objeto COM se controla mediante su *recuento de referencias*.</span><span class="sxs-lookup"><span data-stu-id="cbedf-188">The lifetime of a COM object instance is controlled by its *reference count*.</span></span> <span data-ttu-id="cbedf-189">[**Las funciones miembro**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) de [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) y [](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) controlan el recuento.</span><span class="sxs-lookup"><span data-stu-id="cbedf-189">The [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) member functions [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) and [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) control the count.</span></span> <span data-ttu-id="cbedf-190">**AddRef** incrementa el recuento y la **versión** disminuye el recuento.</span><span class="sxs-lookup"><span data-stu-id="cbedf-190">**AddRef** increments the count and **Release** decrements the count.</span></span> <span data-ttu-id="cbedf-191">Cuando el recuento de referencias llega a cero, la función miembro **Release** puede liberar la instancia, ya que no la está usando ningún autor de llamada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-191">When the reference count reaches zero, the **Release** member function may free the instance, because no callers are using it.</span></span>

## <a name="the-clientserver-model"></a><span data-ttu-id="cbedf-192">El modelo cliente/servidor</span><span class="sxs-lookup"><span data-stu-id="cbedf-192">The Client/Server Model</span></span>

<span data-ttu-id="cbedf-193">Una clase COM implementa varias interfaces COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-193">A COM class implements a number of COM interfaces.</span></span> <span data-ttu-id="cbedf-194">La implementación de consta de archivos binarios que se ejecutan cuando un llamador interactúa con una instancia de la clase COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-194">The implementation consists of binaries that run when a caller interacts with an instance of the COM class.</span></span> <span data-ttu-id="cbedf-195">COM permite el uso de una clase en aplicaciones diferentes, incluidas las aplicaciones escritas sin conocimiento de una clase determinada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-195">COM enables using a class in different applications, including applications written without knowledge of a particular class.</span></span> <span data-ttu-id="cbedf-196">En una plataforma de Windows, las clases existen en una biblioteca de vínculos dinámicos (DLL) o en otra aplicación (EXE).</span><span class="sxs-lookup"><span data-stu-id="cbedf-196">On a Windows platform, classes exist either in a dynamic-linked library (DLL) or in another application (EXE).</span></span>

<span data-ttu-id="cbedf-197">En su sistema host, COM mantiene una base de datos de registro de todos los CLSID de los objetos COM instalados en el sistema.</span><span class="sxs-lookup"><span data-stu-id="cbedf-197">On its host system, COM maintains a registration database of all the CLSIDs for the COM objects installed on the system.</span></span> <span data-ttu-id="cbedf-198">La base de datos de registro es una asignación entre cada CLSID y la ubicación del archivo DLL o EXE que hospeda la clase correspondiente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-198">The registration database is a mapping between each CLSID and the location of the DLL or EXE that houses the corresponding class.</span></span> <span data-ttu-id="cbedf-199">COM consulta esta base de datos cada vez que un llamador desea crear una instancia de una clase COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-199">COM queries this database whenever a caller wants to create an instance of a COM class.</span></span> <span data-ttu-id="cbedf-200">El autor de la llamada solo necesita conocer el CLSID para solicitar una nueva instancia de la clase.</span><span class="sxs-lookup"><span data-stu-id="cbedf-200">The caller needs to know only the CLSID to request a new instance of the class.</span></span>

<span data-ttu-id="cbedf-201">La interacción entre un objeto COM y sus llamadores se modela como una relación entre cliente y servidor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-201">The interaction between a COM object and its callers is modeled as a client/server relationship.</span></span> <span data-ttu-id="cbedf-202">El cliente es el autor de la llamada que solicita un objeto COM del sistema y el servidor es el módulo que contiene objetos COM que proporciona servicios a los clientes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-202">The client is the caller that requests a COM object from the system, and the server is the module that houses COM objects that provides services to clients.</span></span>

<span data-ttu-id="cbedf-203">Un cliente COM es cualquier llamador que pase un CLSID al sistema para solicitar una instancia de un objeto COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-203">A COM client is any caller that passes a CLSID to the system to request an instance of a COM object.</span></span> <span data-ttu-id="cbedf-204">La manera más sencilla de crear una instancia es llamar a la función COM, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span><span class="sxs-lookup"><span data-stu-id="cbedf-204">The simplest way to create an instance is to call the COM function, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span></span>

<span data-ttu-id="cbedf-205">La función [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) crea una instancia del CLSID especificado y devuelve un puntero de interfaz del tipo solicitado por el cliente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-205">The [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) function creates one instance of the specified CLSID and returns an interface pointer of the type requested by the client.</span></span> <span data-ttu-id="cbedf-206">El cliente es responsable de administrar la duración de la instancia llamando a su función de [**versión**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) cuando el cliente ha terminado de usarla.</span><span class="sxs-lookup"><span data-stu-id="cbedf-206">The client is responsible for managing the lifetime of the instance by calling its [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) function when the client has finished using it.</span></span> <span data-ttu-id="cbedf-207">Para crear varios objetos basados en un único CLSID, llame a la función [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-207">To create multiple objects based on a single CLSID, call the [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) function.</span></span> <span data-ttu-id="cbedf-208">Para conectarse a un objeto que ya se ha creado y se está ejecutando, llame a la función [**GetActiveObject**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-getactiveobject) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-208">To connect to an object that is already created and running, call the [**GetActiveObject**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-getactiveobject) function.</span></span>

<span data-ttu-id="cbedf-209">Un servidor COM proporciona una implementación COM al sistema.</span><span class="sxs-lookup"><span data-stu-id="cbedf-209">A COM server provides a COM implementation to the system.</span></span> <span data-ttu-id="cbedf-210">Un servidor asocia un CLSID a una clase COM, hospeda la implementación de la clase, implementa un generador de clases para crear instancias de la clase y proporciona la descarga del servidor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-210">A server associates a CLSID with a COM class, houses the implementation of the class, implements a class factory for creating instances of the class, and provides for unloading the server.</span></span>

> [!Note]  
> <span data-ttu-id="cbedf-211">Un servidor COM no es el mismo que el objeto COM que proporciona al sistema.</span><span class="sxs-lookup"><span data-stu-id="cbedf-211">A COM server is not the same as the COM object that it provides to the system.</span></span>

 

<span data-ttu-id="cbedf-212">Para habilitar la creación de un objeto COM, un servidor COM debe proporcionar una implementación de la interfaz [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-212">To enable creating a COM object, a COM server must provide an implementation of the [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) interface.</span></span> <span data-ttu-id="cbedf-213">Los clientes pueden llamar al método [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) para solicitar una nueva instancia de un objeto com, pero normalmente dichas solicitudes se encapsulan en la función [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-213">Clients can call the [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) method to request a new instance of a COM object, but usually such requests are encapsulated in the [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) function.</span></span>

<span data-ttu-id="cbedf-214">Puede implementar un servidor COM como una biblioteca compartida que se carga en el proceso del cliente en tiempo de ejecución (DLL en plataformas Windows) o como un módulo ejecutable (EXE en plataformas Windows).</span><span class="sxs-lookup"><span data-stu-id="cbedf-214">You can deploy a COM server either as a shared library that is loaded into the client's process at run time (DLL on Windows platforms) or as an executable module (EXE on Windows platforms).</span></span> <span data-ttu-id="cbedf-215">Para obtener más información, vea [registrar aplicaciones com](registering-com-applications.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-215">For more information, see [Registering COM Applications](registering-com-applications.md).</span></span>

## <a name="service-control-manager"></a><span data-ttu-id="cbedf-216">Administrador de control de servicios</span><span class="sxs-lookup"><span data-stu-id="cbedf-216">Service Control Manager</span></span>

<span data-ttu-id="cbedf-217">El administrador de control de servicios (SCM) controla la solicitud de cliente para una instancia de un objeto COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-217">The Service Control Manager (SCM) handles the client request for an instance of a COM object.</span></span> <span data-ttu-id="cbedf-218">En la siguiente lista se muestra la secuencia de eventos:</span><span class="sxs-lookup"><span data-stu-id="cbedf-218">The following list shows the sequence of events:</span></span>

-   <span data-ttu-id="cbedf-219">Un cliente solicita un puntero de interfaz a un objeto COM de la biblioteca COM mediante una llamada a una función como [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) con el CLSID del objeto com.</span><span class="sxs-lookup"><span data-stu-id="cbedf-219">A client requests an interface pointer to a COM object from the COM Library by calling a function such as [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) with the CLSID of the COM object.</span></span>
-   <span data-ttu-id="cbedf-220">La biblioteca COM consulta al SCM para encontrar el servidor que corresponde al CLSID solicitado.</span><span class="sxs-lookup"><span data-stu-id="cbedf-220">The COM Library queries the SCM to find the server that corresponds with the requested CLSID.</span></span>
-   <span data-ttu-id="cbedf-221">El SCM localiza el servidor y solicita la creación del objeto COM del generador de clases proporcionado por el servidor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-221">The SCM locates the server and requests the creation of the COM object from the class factory that is provided by the server.</span></span>
-   <span data-ttu-id="cbedf-222">Si se realiza correctamente, la biblioteca COM devuelve un puntero de interfaz al cliente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-222">If successful, the COM Library returns an interface pointer to the client.</span></span>

<span data-ttu-id="cbedf-223">Una vez que el sistema COM conecta un objeto de servidor a un cliente, el cliente y el objeto se comunican directamente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-223">After the COM system connects a server object to a client, the client and object communicate directly.</span></span> <span data-ttu-id="cbedf-224">No se ha agregado ninguna sobrecarga por la llamada a través de un tiempo de ejecución intermediario.</span><span class="sxs-lookup"><span data-stu-id="cbedf-224">There is no added overhead from calling through an intermediary run time.</span></span>

<span data-ttu-id="cbedf-225">Al registrar un servidor COM con el sistema host, puede especificar diferentes maneras para que se active el servidor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-225">When you register a COM server with the host system, you can specify different ways for the server to be activated.</span></span> <span data-ttu-id="cbedf-226">La lista siguiente muestra las tres formas en que el SCM puede activar un servidor COM:</span><span class="sxs-lookup"><span data-stu-id="cbedf-226">The following list shows the three ways that the SCM can activate a COM server:</span></span>

-   <span data-ttu-id="cbedf-227">En proceso: el SCM devuelve la ruta de acceso del archivo DLL que contiene la implementación del servidor de objetos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-227">In-process: The SCM returns the file path of the DLL that contains the object server implementation.</span></span> <span data-ttu-id="cbedf-228">La biblioteca COM carga el archivo DLL y lo consulta para su puntero de interfaz de generador de clases.</span><span class="sxs-lookup"><span data-stu-id="cbedf-228">The COM Library loads the DLL and queries it for its class factory interface pointer.</span></span>
-   <span data-ttu-id="cbedf-229">Local: el SCM inicia el ejecutable local que registra un generador de clases en el inicio y el puntero de interfaz está disponible para el sistema y los clientes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-229">Local: The SCM starts the local executable which registers a class factory on startup, and its interface pointer is available to the system and clients.</span></span>
-   <span data-ttu-id="cbedf-230">Remoto: el SCM local adquiere un puntero de interfaz de generador de clases del SCM que se ejecuta en un equipo remoto.</span><span class="sxs-lookup"><span data-stu-id="cbedf-230">Remote: The local SCM acquires a class factory interface pointer from the SCM that is running on a remote computer.</span></span>

<span data-ttu-id="cbedf-231">Cuando un cliente solicita un objeto COM, la biblioteca COM se pone en contacto con el SCM en el host local.</span><span class="sxs-lookup"><span data-stu-id="cbedf-231">When a client requests a COM object, the COM Library contacts the SCM on the local host.</span></span> <span data-ttu-id="cbedf-232">El SCM busca el servidor COM adecuado, que puede ser local o remoto, y el servidor devuelve un puntero de interfaz al generador de clases del servidor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-232">The SCM locates the appropriate COM server, which may be local or remote, and the server returns an interface pointer to the server's class factory.</span></span> <span data-ttu-id="cbedf-233">Cuando el generador de clases está disponible, la biblioteca COM o el cliente pueden utilizar el generador de clases para crear el objeto solicitado.</span><span class="sxs-lookup"><span data-stu-id="cbedf-233">When the class factory is available, the COM Library or the client can use the class factory to create the requested object.</span></span> <span data-ttu-id="cbedf-234">Para obtener más información, vea [implementar IClassFactory](implementing-iclassfactory.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-234">For more information, see [Implementing IClassFactory](implementing-iclassfactory.md).</span></span>

## <a name="reusability"></a><span data-ttu-id="cbedf-235">Reusabilidad</span><span class="sxs-lookup"><span data-stu-id="cbedf-235">Reusability</span></span>

<span data-ttu-id="cbedf-236">COM admite la *reutilización de caja negra*, lo que significa que los detalles de implementación de un componente reutilizable no se exponen a los clientes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-236">COM supports *black-box reusability*, which means that the implementation details of a reusable component are not exposed to clients.</span></span> <span data-ttu-id="cbedf-237">Para lograr una reutilización de cuadro negro, COM admite dos mecanismos a través de los cuales un objeto puede volver a usar otro.</span><span class="sxs-lookup"><span data-stu-id="cbedf-237">To achieve black-box reusability, COM supports two mechanisms through which one object may reuse another.</span></span> <span data-ttu-id="cbedf-238">Las dos formas de reutilizar se denominan *contención* y *agregación*.</span><span class="sxs-lookup"><span data-stu-id="cbedf-238">The two forms of reuse are named *containment* and *aggregation*.</span></span> <span data-ttu-id="cbedf-239">Por Convención, el objeto que se va a reutilizar se denomina el *objeto interno* y el objeto que hace uso del objeto interno se denomina el *objeto externo*.</span><span class="sxs-lookup"><span data-stu-id="cbedf-239">By convention, the object being reused is named the *inner object*, and the object that is making use of the inner object is named the *outer object*.</span></span>

<span data-ttu-id="cbedf-240">En la contención, el objeto externo se comporta como un cliente del objeto interno.</span><span class="sxs-lookup"><span data-stu-id="cbedf-240">In containment, the outer object behaves as a client of the inner object.</span></span> <span data-ttu-id="cbedf-241">El objeto externo es un contenedor lógico para el objeto interno y, cuando el objeto externo utiliza los servicios del objeto interno, el objeto externo delega la implementación en las interfaces del objeto interno.</span><span class="sxs-lookup"><span data-stu-id="cbedf-241">The outer object is a logical container for the inner object, and when the outer object uses the services of the inner object, the outer object delegates implementation to the inner object's interfaces.</span></span> <span data-ttu-id="cbedf-242">Esto significa que el objeto externo se implementa en términos de los servicios del objeto interno.</span><span class="sxs-lookup"><span data-stu-id="cbedf-242">This means that the outer object is implemented in terms of the inner object's services.</span></span> <span data-ttu-id="cbedf-243">Es posible que el objeto externo no admita las mismas interfaces que el objeto interno y que el objeto externo pueda usar la interfaz de un objeto interno como ayuda para implementar partes de una interfaz diferente en el objeto externo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-243">The outer object may not support the same interfaces as the inner object, and the outer object may use an inner object's interface to help with implementing parts of a different interface on the outer object.</span></span>

<span data-ttu-id="cbedf-244">En la agregación, el objeto externo expone interfaces del objeto interno como si se hubieran implementado en el objeto externo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-244">In aggregation, the outer object exposes interfaces from the inner object as if they were implemented on the outer object.</span></span> <span data-ttu-id="cbedf-245">Esto resulta útil cuando el objeto externo siempre delegaría cada llamada en una de sus interfaces a la misma interfaz del objeto interno.</span><span class="sxs-lookup"><span data-stu-id="cbedf-245">This is useful when the outer object would always delegate every call on one of its interfaces to the same interface of the inner object.</span></span> <span data-ttu-id="cbedf-246">La agregación es una comodidad que permite que el objeto externo Evite la sobrecarga de implementación adicional.</span><span class="sxs-lookup"><span data-stu-id="cbedf-246">Aggregation is a convenience that enables the outer object to avoid extra implementation overhead.</span></span>

<span data-ttu-id="cbedf-247">Para obtener más información, vea [reutilizar objetos](reusing-objects.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-247">For more information, see [Reusing Objects](reusing-objects.md).</span></span>

## <a name="storage-and-stream-objects"></a><span data-ttu-id="cbedf-248">Objetos de almacenamiento y flujo</span><span class="sxs-lookup"><span data-stu-id="cbedf-248">Storage and Stream Objects</span></span>

<span data-ttu-id="cbedf-249">Los objetos COM guardan el estado en un archivo mediante el *almacenamiento estructurado*, que es una forma de almacenamiento persistente que permite la navegación del contenido de un archivo mediante la semántica del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-249">COM objects save state to a file by using *structured storage*, which is a form of persistent storage that enables navigation of a file's contents by using file system semantics.</span></span> <span data-ttu-id="cbedf-250">Tratar el contenido de un archivo de esta manera permite características como el acceso incremental, las transacciones y el uso compartido entre los procesos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-250">Treating a file's contents in this manner enables features such as incremental access, transactions, and sharing among processes.</span></span>

<span data-ttu-id="cbedf-251">La especificación de almacenamiento persistente COM proporciona dos tipos de elementos de almacenamiento: objetos de almacenamiento y objetos de secuencia.</span><span class="sxs-lookup"><span data-stu-id="cbedf-251">The COM persistent storage specification provides for two types of storage elements: storage objects and stream objects.</span></span> <span data-ttu-id="cbedf-252">Estos objetos se implementan mediante la biblioteca COM y las aplicaciones de usuario raramente implementan estos elementos de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="cbedf-252">These objects are implemented by the COM Library, and user applications rarely implement these storage elements.</span></span> <span data-ttu-id="cbedf-253">Los objetos de almacenamiento implementan la interfaz [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) y los objetos de secuencia implementan la interfaz [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-253">Storage objects implement the [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) interface, and stream objects implement the [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) interface.</span></span>

<span data-ttu-id="cbedf-254">Un objeto de flujo contiene datos y es conceptualmente similar a un único archivo en un sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-254">A stream object contains data and is conceptually similar to a single file in a file system.</span></span> <span data-ttu-id="cbedf-255">Cada flujo tiene derechos de acceso y un único puntero de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="cbedf-255">Each stream has access rights and a single seek pointer.</span></span> <span data-ttu-id="cbedf-256">A través de la interfaz [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) , puede leer, escribir, buscar y realizar otras operaciones en los datos subyacentes de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="cbedf-256">Through the [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) interface, you can read, write, seek, and perform other operations on the stream's underlying data.</span></span> <span data-ttu-id="cbedf-257">Un flujo se denomina mediante una cadena de texto.</span><span class="sxs-lookup"><span data-stu-id="cbedf-257">A stream is named by using a text string.</span></span> <span data-ttu-id="cbedf-258">Puede contener cualquier estructura interna, ya que es un flujo plano de bytes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-258">It can contain any internal structure, because it is a flat stream of bytes.</span></span> <span data-ttu-id="cbedf-259">Además, las funciones de la interfaz **IStream** son similares a las funciones basadas en el identificador de archivo estándar, como las de la biblioteca en tiempo de ejecución de C de ANSI.</span><span class="sxs-lookup"><span data-stu-id="cbedf-259">In addition, the functions in the **IStream** interface are similar to standard file-handle based functions, such as those in the ANSI C run-time library.</span></span>

<span data-ttu-id="cbedf-260">Un objeto de almacenamiento es conceptualmente similar a un directorio en un sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-260">A storage object is conceptually similar to a directory in a file system.</span></span> <span data-ttu-id="cbedf-261">Cada almacenamiento puede contener cualquier número de objetos de subalmacenamiento y cualquier número de flujos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-261">Each storage can contain any number of sub-storage objects and any number of streams.</span></span> <span data-ttu-id="cbedf-262">Cada almacenamiento tiene sus propios derechos de acceso.</span><span class="sxs-lookup"><span data-stu-id="cbedf-262">Each storage has its own access rights.</span></span> <span data-ttu-id="cbedf-263">A través de la interfaz [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) , puede realizar operaciones como enumerar, mover, copiar, cambiar el nombre, crear y eliminar elementos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-263">Through the [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) interface, you can perform operations such as enumerating, moving, copying, renaming, creating, and deleting elements.</span></span> <span data-ttu-id="cbedf-264">Un objeto de almacenamiento no almacena los datos definidos por la aplicación, pero almacena implícitamente los nombres de los elementos (almacenamientos y flujos) que contiene.</span><span class="sxs-lookup"><span data-stu-id="cbedf-264">A storage object does not store application-defined data, but it stores implicitly the names of the elements (storages and streams) that it contains.</span></span>

<span data-ttu-id="cbedf-265">Los objetos de almacenamiento y de secuencia se pueden compartir entre los procesos cuando se implementan según la especificación COM en una plataforma de host.</span><span class="sxs-lookup"><span data-stu-id="cbedf-265">Storage and stream objects are sharable among processes when they are implemented according to the COM specification on a host platform.</span></span> <span data-ttu-id="cbedf-266">Esto permite que los objetos que se ejecutan en proceso o fuera de proceso tengan el mismo acceso incremental al almacenamiento de archivos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-266">This enables objects that are running in-process or out-of-process to have equal incremental access to their file storage.</span></span> <span data-ttu-id="cbedf-267">Dado que COM se carga en cada proceso por separado, utiliza mecanismos de memoria compartida admitidos por el sistema operativo para comunicar el estado de los elementos abiertos y sus modos de acceso entre los procesos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-267">Because COM is loaded into each process separately, it uses operating-system supported shared memory mechanisms to communicate the state of opened elements and their access modes between processes.</span></span>

<span data-ttu-id="cbedf-268">Cada objeto de almacenamiento y de secuencia de un archivo estructurado tiene un nombre para identificarlo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-268">Every storage and stream object in a structured file has a name to identify it.</span></span> <span data-ttu-id="cbedf-269">El nombre es una cadena que sigue una convención determinada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-269">The name is a string that follows a particular convention.</span></span> <span data-ttu-id="cbedf-270">Para obtener más información, vea [Storage Object naming Conventions](/windows/desktop/Stg/storage-object-naming-conventions).</span><span class="sxs-lookup"><span data-stu-id="cbedf-270">For more information, see [Storage Object Naming Conventions](/windows/desktop/Stg/storage-object-naming-conventions).</span></span> <span data-ttu-id="cbedf-271">El nombre se pasa a las funciones [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) para especificar en qué elemento del almacenamiento se va a operar.</span><span class="sxs-lookup"><span data-stu-id="cbedf-271">The name is passed to [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) functions to specify which element in the storage to operate on.</span></span> <span data-ttu-id="cbedf-272">Los nombres de los objetos de almacenamiento raíz son los mismos que los nombres de archivo del sistema de archivos subyacente, y estos nombres deben seguir las convenciones y restricciones del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-272">Names of root storage objects are the same as file names in the underlying file system, and these names must follow the file system's conventions and restrictions.</span></span> <span data-ttu-id="cbedf-273">Cadenas que se pasan a las funciones relacionadas con el almacenamiento en las que los archivos de nombre se pasan al sistema de archivos sin interpretación o cambios.</span><span class="sxs-lookup"><span data-stu-id="cbedf-273">Strings passed to storage-related functions which name files are passed through to the file system without interpretation or changes.</span></span>

<span data-ttu-id="cbedf-274">Los nombres de los elementos incluidos en los objetos de almacenamiento se administran mediante la implementación del objeto de almacenamiento en cuestión.</span><span class="sxs-lookup"><span data-stu-id="cbedf-274">Names of elements that are contained within storage objects are managed by the implementation of the particular storage object in question.</span></span> <span data-ttu-id="cbedf-275">Todas las implementaciones de objetos de almacenamiento deben admitir nombres de elementos de 32 caracteres de longitud y algunas implementaciones pueden admitir nombres más largos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-275">All implementations of storage objects must support element names that are 32 characters in length, and some implementations may support longer names.</span></span> <span data-ttu-id="cbedf-276">Los nombres se almacenan con el uso de mayúsculas y minúsculas, pero se comparan sin distinción de mayúsculas y minúsculas.</span><span class="sxs-lookup"><span data-stu-id="cbedf-276">Names are stored with case preserved, but they are compared as case-insensitive.</span></span> <span data-ttu-id="cbedf-277">Las aplicaciones que definen los nombres de los elementos de almacenamiento deben elegir nombres que funcionen en cualquier situación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-277">Applications that define storage element names must choose names that work in either situation.</span></span>

<span data-ttu-id="cbedf-278">Puede tener acceso a todos los elementos de un archivo de almacenamiento estructurado mediante las funciones e interfaces implementadas por COM.</span><span class="sxs-lookup"><span data-stu-id="cbedf-278">You access every element in a structured storage file by using functions and interfaces that are implemented by COM.</span></span> <span data-ttu-id="cbedf-279">Esto significa que otras aplicaciones pueden examinar el archivo navegando con las funciones de la interfaz [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) que proporcionan servicios similares al directorio.</span><span class="sxs-lookup"><span data-stu-id="cbedf-279">This means that other applications can browse the file by navigating with the [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) interface functions that provide directory-like services.</span></span> <span data-ttu-id="cbedf-280">Además, otras aplicaciones pueden utilizar los datos del archivo, sin tener que ejecutar la aplicación que escribió el archivo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-280">Also, other applications can use the file's data, without having to run the application that wrote the file.</span></span> <span data-ttu-id="cbedf-281">Cuando una aplicación COM tiene acceso a los archivos de almacenamiento estructurado de otra aplicación, se aplican los derechos de acceso estándar de Windows y la aplicación debe tener privilegios suficientes.</span><span class="sxs-lookup"><span data-stu-id="cbedf-281">When a COM application accesses the structured storage files of another application, standard Windows access rights apply, and the application must have sufficient privileges.</span></span>

<span data-ttu-id="cbedf-282">Un objeto COM puede leerse y escribirse en el almacenamiento persistente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-282">A COM object can read and write itself to persistent storage.</span></span> <span data-ttu-id="cbedf-283">Un cliente consulta una de las interfaces relacionadas con la persistencia en el objeto COM, según el contexto de la operación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-283">A client queries for one of the persistence-related interfaces on the COM object, depending on the context of the operation.</span></span> <span data-ttu-id="cbedf-284">Los objetos COM pueden implementar cualquier combinación de las siguientes interfaces:</span><span class="sxs-lookup"><span data-stu-id="cbedf-284">COM objects can implement any combination of the following interfaces:</span></span>

-   <span data-ttu-id="cbedf-285">[**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage): el objeto com Lee y escribe su estado persistente en un objeto de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="cbedf-285">[**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage): The COM object reads and writes its persistent state to a storage object.</span></span> <span data-ttu-id="cbedf-286">El cliente proporciona el objeto con un puntero [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) a través de esta interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-286">The client provides the object with an [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) pointer through this interface.</span></span> <span data-ttu-id="cbedf-287">Esta es la única interfaz de persistencia que incluye semántica para el acceso incremental.</span><span class="sxs-lookup"><span data-stu-id="cbedf-287">This is the only persistence interface that includes semantics for incremental access.</span></span>
-   <span data-ttu-id="cbedf-288">[**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream): el objeto com Lee y escribe su estado persistente en un objeto de secuencia.</span><span class="sxs-lookup"><span data-stu-id="cbedf-288">[**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream): The COM object reads and writes its persistent state to a stream object.</span></span> <span data-ttu-id="cbedf-289">El cliente proporciona el objeto con un puntero [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) a través de esta interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-289">The client provides the object with an [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) pointer through this interface.</span></span>
-   <span data-ttu-id="cbedf-290">[**IPersistFile**](/windows/desktop/api/ObjIdl/nn-objidl-ipersistfile): el objeto com Lee y escribe su estado persistente directamente en un archivo en el sistema subyacente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-290">[**IPersistFile**](/windows/desktop/api/ObjIdl/nn-objidl-ipersistfile): The COM object reads and writes its persistent state directly to a file on the underlying system.</span></span> <span data-ttu-id="cbedf-291">Esta interfaz no implica [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) o [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) a menos que se tenga acceso al archivo subyacente a través de estas interfaces, pero la interfaz **IPersistFile** no tiene ninguna semántica para los almacenamientos y las secuencias.</span><span class="sxs-lookup"><span data-stu-id="cbedf-291">This interface does not involve [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) unless the underlying file is accessed through these interfaces, but the **IPersistFile** interface has no semantics for storages and streams.</span></span> <span data-ttu-id="cbedf-292">El cliente proporciona el objeto con un nombre de archivo y llama a las funciones [**Save**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-save) o [**Load**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-load) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-292">The client provides the object with a file name and calls the [**Save**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-save) or [**Load**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-load) functions.</span></span>

## <a name="data-transfer"></a><span data-ttu-id="cbedf-293">Transferencia de datos</span><span class="sxs-lookup"><span data-stu-id="cbedf-293">Data Transfer</span></span>

<span data-ttu-id="cbedf-294">El almacenamiento estructurado proporciona la base para el intercambio de datos entre los objetos y procesos COM, que se denomina *transferencia de datos uniforme*.</span><span class="sxs-lookup"><span data-stu-id="cbedf-294">Structured storage provides the basis for data exchange between COM objects and processes, which is named *uniform data transfer*.</span></span> <span data-ttu-id="cbedf-295">Antes de implementar COM en OLE 2, la transferencia de datos en Windows se especificaba mediante *protocolos de transferencia*, como el portapapeles y los protocolos de arrastrar y colocar.</span><span class="sxs-lookup"><span data-stu-id="cbedf-295">Before COM was implemented in OLE 2, data transfer on Windows was specified by *transfer protocols*, such as the clipboard and drag-drop protocols.</span></span> <span data-ttu-id="cbedf-296">Cada protocolo de transferencia tenía su propio conjunto de funciones que enlazaron el protocolo a la consulta, y se necesitaba código específico para administrar cada protocolo y procedimiento de intercambio.</span><span class="sxs-lookup"><span data-stu-id="cbedf-296">Each transfer protocol had its own set of functions that bound the protocol to the query, and specific code was required to handle each different protocol and exchange procedure.</span></span> <span data-ttu-id="cbedf-297">La transferencia de datos uniforme representa todas las transferencias de datos mediante la interfaz [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) , que separa las operaciones comunes de intercambio de datos del Protocolo de transferencia.</span><span class="sxs-lookup"><span data-stu-id="cbedf-297">Uniform data transfer represents all data transfers by using the [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface, which separates common data exchange operations from the transfer protocol.</span></span>

<span data-ttu-id="cbedf-298">La interfaz [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) encapsula las operaciones estándar get y set en datos, consultas y enumeraciones, y notificaciones que detectan cuándo cambian los datos en un objeto.</span><span class="sxs-lookup"><span data-stu-id="cbedf-298">The [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface encapsulates the standard get and set operations on data, queries and enumerations, and notifications that detect when data changes in an object.</span></span> <span data-ttu-id="cbedf-299">La transferencia de datos uniforme permite descripciones enriquecidas de formatos de datos, así como el uso de medios de almacenamiento diferentes para la transferencia de datos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-299">Uniform data transfer enables rich descriptions of data formats, as well as the use of different storage media for the data transfer.</span></span>

<span data-ttu-id="cbedf-300">Durante la transferencia de datos uniforme, todos los protocolos intercambian un puntero a una interfaz [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-300">During uniform data transfer, all protocols exchange a pointer to an [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="cbedf-301">El servidor es el origen de los datos e implementa un objeto de datos, que se puede usar en cualquier protocolo de intercambio de datos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-301">The server is the source of the data and implements one data object, which is usable in any data exchange protocol.</span></span> <span data-ttu-id="cbedf-302">El cliente consume los datos y solicita datos de un objeto de datos cuando recibe un puntero **IDataObject** de cualquier protocolo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-302">The client consumes the data and requests data from a data object when it receives an **IDataObject** pointer from any protocol.</span></span> <span data-ttu-id="cbedf-303">Una vez que se ha producido el intercambio de puntero, ambos lados controlan el intercambio de datos de manera uniforme, a través de la interfaz **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="cbedf-303">After the pointer exchange has occurred, both sides handle data exchange in a uniform fashion, through the **IDataObject** interface.</span></span>

<span data-ttu-id="cbedf-304">COM define dos estructuras de datos que permiten la transferencia de datos uniforme.</span><span class="sxs-lookup"><span data-stu-id="cbedf-304">COM defines two data structures that enable uniform data transfer.</span></span> <span data-ttu-id="cbedf-305">La estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) representa un formato generalizado del portapapeles y la estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) representa el medio de transferencia como un identificador de memoria.</span><span class="sxs-lookup"><span data-stu-id="cbedf-305">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure represents a generalized clipboard format, and the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure represents the transfer medium as a memory handle.</span></span>

<span data-ttu-id="cbedf-306">El cliente crea una estructura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) para indicar el tipo de datos que solicita de un origen de datos, y lo usa el origen de datos para describir los formatos que proporciona.</span><span class="sxs-lookup"><span data-stu-id="cbedf-306">The client creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to indicate the type of data that it requests from a data source, and it is used by the data source to describe what formats it provides.</span></span> <span data-ttu-id="cbedf-307">El cliente consulta a un origen de datos sus formatos disponibles solicitando su interfaz [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-307">The client queries a data source for its available formats by requesting its [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="cbedf-308">Para obtener más información, vea [la estructura FORMATETC](the-formatetc-structure.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-308">For more information, see [The FORMATETC Structure](the-formatetc-structure.md).</span></span>

<span data-ttu-id="cbedf-309">El cliente crea una estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) y la pasa al método [**GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) y el objeto de datos devuelve los datos de la estructura **STGMEDIUM** proporcionada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-309">The client creates a [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure and passes it to the [**GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) method, and the data object returns the data in the provided **STGMEDIUM** structure.</span></span>

<span data-ttu-id="cbedf-310">La estructura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) permite a los clientes y a los orígenes de datos elegir el medio de intercambio más eficaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-310">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure enables both clients and data sources to choose the most efficient exchange medium.</span></span> <span data-ttu-id="cbedf-311">Por ejemplo, si los datos que se van a intercambiar son muy grandes, el origen de datos puede indicar un medio basado en disco como su formato preferido, en lugar de la memoria principal.</span><span class="sxs-lookup"><span data-stu-id="cbedf-311">For example, if the data to be exchanged is very large, the data source can indicate a disk-based medium as its preferred format, instead of main memory.</span></span> <span data-ttu-id="cbedf-312">Esta flexibilidad permite intercambios de datos eficaces que pueden ser tan rápidos como pasar un puntero a un [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) o una [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span><span class="sxs-lookup"><span data-stu-id="cbedf-312">This flexibility enables efficient data exchanges that can be as fast as passing a pointer to an [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) or an [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span></span> <span data-ttu-id="cbedf-313">Para obtener más información, vea [la estructura STGMEDIUM](the-stgmedium-structure.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-313">For more information, see [The STGMEDIUM Structure](the-stgmedium-structure.md).</span></span>

<span data-ttu-id="cbedf-314">Un cliente de un origen de datos puede requerir una notificación cuando cambian los datos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-314">A client of a data source may require notification when the data changes.</span></span> <span data-ttu-id="cbedf-315">COM administra las notificaciones de cambios de datos mediante un objeto de *receptor de notificaciones* , que implementa la interfaz [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-315">COM handles data-change notifications by using an *advise sink* object, which implements the [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) interface.</span></span> <span data-ttu-id="cbedf-316">El objeto de receptor de notificaciones y la interfaz **IAdviseSink** se implementan mediante el cliente, que pasa un puntero **IAdviseSink** al origen de datos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-316">The advise sink object and the **IAdviseSink** interface are implemented by the client, which passes an **IAdviseSink** pointer to the data source.</span></span> <span data-ttu-id="cbedf-317">Cuando el origen de datos detecta un cambio en los datos subyacentes, llama a un método **IAdviseSink** para notificar al cliente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-317">When the data source detects a change in the underlying data, it calls an **IAdviseSink** method to notify the client.</span></span> <span data-ttu-id="cbedf-318">Para obtener más información, consulte [notificación de datos](data-notification.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-318">For more information, see [Data Notification](data-notification.md).</span></span>

## <a name="remoting"></a><span data-ttu-id="cbedf-319">Comunicación remota</span><span class="sxs-lookup"><span data-stu-id="cbedf-319">Remoting</span></span>

<span data-ttu-id="cbedf-320">COM permite el cálculo remoto y distribuido.</span><span class="sxs-lookup"><span data-stu-id="cbedf-320">COM enables remote and distributed computation.</span></span> <span data-ttu-id="cbedf-321">La *comunicación remota de interfaz* permite que una función miembro devuelva un puntero de interfaz a un objeto com que se encuentra en un proceso diferente o en un equipo host diferente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-321">*Interface remoting* enables a member function to return an interface pointer to a COM object that is in a different process or on a different host computer.</span></span> <span data-ttu-id="cbedf-322">La infraestructura que realiza la interacción remota de la interfaz es transparente tanto para el cliente como para el servidor de objetos.</span><span class="sxs-lookup"><span data-stu-id="cbedf-322">The infrastructure that performs the interface remoting is transparent to both the client and the object server.</span></span> <span data-ttu-id="cbedf-323">Ni el cliente ni el servidor necesitan los detalles de implementación de otro para comunicarse a través de una interfaz remota.</span><span class="sxs-lookup"><span data-stu-id="cbedf-323">Neither the client nor the server need one another's deployment details to communicate through a remoted interface.</span></span> <span data-ttu-id="cbedf-324">Un cliente llama a funciones miembro en la misma interfaz para comunicarse con un objeto COM que está en proceso, fuera de proceso en el host local o en un equipo remoto.</span><span class="sxs-lookup"><span data-stu-id="cbedf-324">A client calls member functions on the same interface to communicate with a COM object that is in-process, out-of-process on the local host, or on a remote computer.</span></span> <span data-ttu-id="cbedf-325">El cliente no distingue las llamadas locales y remotas en la misma interfaz.</span><span class="sxs-lookup"><span data-stu-id="cbedf-325">Local and remote calls on the same interface are indistinguishable to the client.</span></span>

<span data-ttu-id="cbedf-326">Para comunicarse con un objeto COM, un cliente siempre llama a una implementación en proceso.</span><span class="sxs-lookup"><span data-stu-id="cbedf-326">To communicate with a COM object, a client always calls an in-process implementation.</span></span> <span data-ttu-id="cbedf-327">Si el objeto COM está en proceso, la llamada es directa.</span><span class="sxs-lookup"><span data-stu-id="cbedf-327">If the COM object is in-process, the call is direct.</span></span> <span data-ttu-id="cbedf-328">Si el objeto COM está fuera de proceso o remoto, COM proporciona una implementación de *proxy* que reenvía la llamada al objeto mediante el protocolo de llamada a procedimiento remoto (RPC).</span><span class="sxs-lookup"><span data-stu-id="cbedf-328">If the COM object is out-of-process or remote, COM provides a *proxy* implementation that forwards the call to the object by using the Remote Procedure Call (RPC) protocol.</span></span>

<span data-ttu-id="cbedf-329">Un objeto COM siempre recibe llamadas de un cliente a través de una implementación en curso.</span><span class="sxs-lookup"><span data-stu-id="cbedf-329">A COM object always receives calls from a client through an in-process implementation.</span></span> <span data-ttu-id="cbedf-330">Si el autor de la llamada está en proceso, la llamada es directa.</span><span class="sxs-lookup"><span data-stu-id="cbedf-330">If the caller is in-process, the call is direct.</span></span> <span data-ttu-id="cbedf-331">Si el llamador está fuera de proceso o remoto, COM proporciona una implementación de *código auxiliar* que recibe la llamada a procedimiento remoto del proxy en el proceso del cliente.</span><span class="sxs-lookup"><span data-stu-id="cbedf-331">If the caller is out-of-process or remote, COM provides a *stub* implementation that receives the remote procedure call from the proxy in the client process.</span></span>

<span data-ttu-id="cbedf-332">El *cálculo de referencias* es el procedimiento para empaquetar la pila de llamadas para su transmisión desde proxy a código auxiliar.</span><span class="sxs-lookup"><span data-stu-id="cbedf-332">*Marshaling* is the procedure for packaging the call stack for transmission from proxy to stub.</span></span> <span data-ttu-id="cbedf-333">La anulación del *cálculo de referencias* es el desempaquetado que se produce en el extremo receptor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-333">*Unmarshaling* is the unpackaging that occurs at the receiving end.</span></span> <span data-ttu-id="cbedf-334">Los valores devueltos se calculan y se deserializan del código auxiliar en el proxy.</span><span class="sxs-lookup"><span data-stu-id="cbedf-334">Return values are marshaled and unmarshaled from the stub to the proxy.</span></span> <span data-ttu-id="cbedf-335">Este tipo de comunicación también se conoce como enviar una llamada *a través de la conexión*.</span><span class="sxs-lookup"><span data-stu-id="cbedf-335">This kind of communication is also referred to as sending a call *over the wire*.</span></span>

<span data-ttu-id="cbedf-336">Cada tipo de datos distinto tiene reglas para la serialización.</span><span class="sxs-lookup"><span data-stu-id="cbedf-336">Each different data type has rules for marshaling.</span></span> <span data-ttu-id="cbedf-337">Los punteros de interfaz también tienen un protocolo de serialización, que se encapsula en la función [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-337">Interface pointers also have a marshaling protocol, which is encapsulated in the [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) function.</span></span> <span data-ttu-id="cbedf-338">En la mayoría de los casos, el cálculo de referencias de la *interfaz estándar*, proporcionado por el sistema, es suficiente, pero un objeto com puede implementar opcionalmente el cálculo de referencias de la *interfaz personalizada* para controlar la creación de proxies de objetos remotos a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="cbedf-338">In most cases, *standard interface marshaling*, which is provided by the system, is sufficient, but a COM object optionally may implement *custom interface marshaling* to control the creation of remote object proxies to itself.</span></span> <span data-ttu-id="cbedf-339">Para obtener más información, consulte [comunicación entre objetos](inter-object-communication.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-339">For more information, see [Inter-Object Communication](inter-object-communication.md).</span></span>

## <a name="security"></a><span data-ttu-id="cbedf-340">Seguridad</span><span class="sxs-lookup"><span data-stu-id="cbedf-340">Security</span></span>

<span data-ttu-id="cbedf-341">COM proporciona dos formas de seguridad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-341">COM provides two forms of application security.</span></span> <span data-ttu-id="cbedf-342">Una es la *seguridad de activación*, que especifica cómo se crean los nuevos objetos, cómo se conectan los clientes a objetos nuevos y existentes, y cómo se protegen determinados servicios públicos, como la tabla de clases y la tabla de objetos en ejecución.</span><span class="sxs-lookup"><span data-stu-id="cbedf-342">One is *activation security*, which specifies how new objects are created, how clients connect to new and existing objects, and how certain public services, such as the Class Table and the Running Object Table are secured.</span></span> <span data-ttu-id="cbedf-343">La otra es la *seguridad de llamadas*, que especifica cómo funciona la seguridad en una conexión establecida entre un cliente y un objeto com.</span><span class="sxs-lookup"><span data-stu-id="cbedf-343">The other is *call security*, which specifies how security operates in an established connection between a client to a COM object.</span></span>

<span data-ttu-id="cbedf-344">El administrador de control de servicios (SCM) aplica automáticamente la seguridad de activación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-344">Activation security is applied automatically by the Service Control Manager (SCM).</span></span> <span data-ttu-id="cbedf-345">Cuando el SCM recibe una solicitud para recuperar un objeto COM, comprueba la solicitud en la información de seguridad almacenada en el registro.</span><span class="sxs-lookup"><span data-stu-id="cbedf-345">When the SCM receives a request to retrieve a COM object, it checks the request against security information that is stored in the registry.</span></span>

<span data-ttu-id="cbedf-346">Las implementaciones de SCM suelen ofrecer una configuración controlada por el registro para la administración de clases implementadas y para cuentas de usuario específicas en el host.</span><span class="sxs-lookup"><span data-stu-id="cbedf-346">SCM implementations usually offer registry-driven configuration for administering deployed classes and for specific user accounts on the host.</span></span> <span data-ttu-id="cbedf-347">Para obtener más información, vea [seguridad de activación](activation-security.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-347">For more information, see [Activation Security](activation-security.md).</span></span>

<span data-ttu-id="cbedf-348">La seguridad de llamada se aplica automáticamente o la aplica la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-348">Call security is applied automatically or is enforced by the application.</span></span> <span data-ttu-id="cbedf-349">Si la aplicación proporciona información de instalación, COM realiza las comprobaciones necesarias para proteger la aplicación.</span><span class="sxs-lookup"><span data-stu-id="cbedf-349">If the application provides setup information, COM performs the necessary checks to secure the application.</span></span>

<span data-ttu-id="cbedf-350">El mecanismo automático comprueba la seguridad del proceso, pero no los objetos o métodos individuales.</span><span class="sxs-lookup"><span data-stu-id="cbedf-350">The automatic mechanism checks security for the process, but not for individual objects or methods.</span></span> <span data-ttu-id="cbedf-351">Si una aplicación requiere una seguridad más específica, COM proporciona funciones que pueden usar las aplicaciones para realizar su propia comprobación de seguridad.</span><span class="sxs-lookup"><span data-stu-id="cbedf-351">If an application requires more fine-grained security, COM provides functions that applications may use do their own security checking.</span></span>

<span data-ttu-id="cbedf-352">Los mecanismos automáticos y personalizados se pueden usar juntos, por lo que una aplicación puede pedir a COM que realice la comprobación de seguridad automática y, a continuación, realice sus propias tareas.</span><span class="sxs-lookup"><span data-stu-id="cbedf-352">The automatic and custom mechanisms can be used together, so an application may ask COM to perform automatic security checking and then perform its own.</span></span>

<span data-ttu-id="cbedf-353">Los servicios de seguridad de llamadas COM se dividen en las siguientes categorías:</span><span class="sxs-lookup"><span data-stu-id="cbedf-353">COM call security services are divided into the following categories:</span></span>

-   <span data-ttu-id="cbedf-354">Funciones generales a las que llaman los clientes y los servidores, lo que permite que se inicialice el mecanismo de seguridad automático y que se registren los servicios de autenticación automática.</span><span class="sxs-lookup"><span data-stu-id="cbedf-354">General functions that are called by both clients and servers, which enable the automatic security mechanism to be initialized and automatic authentication services to be registered.</span></span> <span data-ttu-id="cbedf-355">Las API de seguridad de llamadas generales son las funciones [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) y [**CoQueryAuthenticationServices**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryauthenticationservices) .</span><span class="sxs-lookup"><span data-stu-id="cbedf-355">The general call security APIs are the [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and [**CoQueryAuthenticationServices**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryauthenticationservices) functions.</span></span>
-   <span data-ttu-id="cbedf-356">Interfaces en servidores proxy de cliente, que permiten al cliente controlar la seguridad en las llamadas a interfaces individuales.</span><span class="sxs-lookup"><span data-stu-id="cbedf-356">Interfaces on client proxies, which enable the client to control the security on calls to individual interfaces.</span></span> <span data-ttu-id="cbedf-357">La interfaz [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) y las funciones [**CoQueryProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryproxyblanket), [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)y [**CoCopyProxy**](/windows/desktop/api/combaseapi/nf-combaseapi-cocopyproxy) proporcionan seguridad de llamada en un objeto remoto.</span><span class="sxs-lookup"><span data-stu-id="cbedf-357">The [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) interface and the [**CoQueryProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryproxyblanket), [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), and [**CoCopyProxy**](/windows/desktop/api/combaseapi/nf-combaseapi-cocopyproxy) functions provide call security on a remote object.</span></span>
-   <span data-ttu-id="cbedf-358">Funciones del lado servidor e interfaces de contexto de llamada, que permiten al servidor recuperar información de seguridad sobre una llamada y suplantar al llamador.</span><span class="sxs-lookup"><span data-stu-id="cbedf-358">Server-side functions and call-context interfaces, which enable the server to retrieve security information about a call and to impersonate the caller.</span></span> <span data-ttu-id="cbedf-359">La interfaz [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) y las funciones [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext), [**CoImpersonateClient**](/windows/desktop/api/combaseapi/nf-combaseapi-coimpersonateclient)y [**CoRevertToSelf**](/windows/desktop/api/combaseapi/nf-combaseapi-coreverttoself) proporcionan seguridad de llamadas del lado servidor.</span><span class="sxs-lookup"><span data-stu-id="cbedf-359">The [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) interface and the [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext), [**CoImpersonateClient**](/windows/desktop/api/combaseapi/nf-combaseapi-coimpersonateclient), and [**CoRevertToSelf**](/windows/desktop/api/combaseapi/nf-combaseapi-coreverttoself) functions provide server-side call security.</span></span>

<span data-ttu-id="cbedf-360">A menudo, el cliente consulta el objeto COM para la interfaz [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) , que se implementa localmente mediante la capa de comunicación remota.</span><span class="sxs-lookup"><span data-stu-id="cbedf-360">Often, the client queries the COM object for the [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) interface, which is implemented locally by the remoting layer.</span></span> <span data-ttu-id="cbedf-361">El cliente utiliza esta interfaz para controlar la seguridad de los proxies de interfaz individuales en el objeto COM antes de efectuar una llamada en una de las interfaces.</span><span class="sxs-lookup"><span data-stu-id="cbedf-361">The client uses this interface to control the security of individual interface proxies on the COM object before making a call on one of the interfaces.</span></span>

<span data-ttu-id="cbedf-362">Cuando una llamada llega al servidor, el servidor puede llamar a la función [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext) para recuperar una interfaz [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) , lo que permite al servidor comprobar la autenticación del cliente y suplantar al cliente, si es necesario.</span><span class="sxs-lookup"><span data-stu-id="cbedf-362">When a call arrives at the server, the server may call the [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext) function to retrieve an [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) interface, which allows the server to check the client's authentication and to impersonate the client, if necessary.</span></span> <span data-ttu-id="cbedf-363">El objeto **IServerSecurity** es válido para la duración de la llamada.</span><span class="sxs-lookup"><span data-stu-id="cbedf-363">The **IServerSecurity** object is valid for the duration of the call.</span></span>

<span data-ttu-id="cbedf-364">Llame a la función [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) para inicializar el nivel de seguridad y establecer los valores especificados como el valor predeterminado de seguridad.</span><span class="sxs-lookup"><span data-stu-id="cbedf-364">Call the [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) function to initialize the security layer and set the specified values as the security default.</span></span> <span data-ttu-id="cbedf-365">Si un proceso no llama a **CoInitializeSecurity**, com lo llama automáticamente la primera vez que se calculan las referencias de una interfaz o se anula su serialización, registrando la seguridad predeterminada del sistema.</span><span class="sxs-lookup"><span data-stu-id="cbedf-365">If a process does not call **CoInitializeSecurity**, COM calls it automatically the first time an interface is marshaled or unmarshaled, registering the system default security.</span></span> <span data-ttu-id="cbedf-366">La función **CoInitializeSecurity** permite al cliente establecer la seguridad de llamada predeterminada para el proceso, lo que evita el uso de [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) en servidores proxy individuales.</span><span class="sxs-lookup"><span data-stu-id="cbedf-366">The **CoInitializeSecurity** function allows the client to establish default call security for the process, which avoids the use of [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) on individual proxies.</span></span> <span data-ttu-id="cbedf-367">La función **CoInitializeSecurity** permite a un servidor registrar los servicios de autenticación automática para el proceso.</span><span class="sxs-lookup"><span data-stu-id="cbedf-367">The **CoInitializeSecurity** function enables a server to register automatic authentication services for the process.</span></span> <span data-ttu-id="cbedf-368">Para obtener más información, consulte Configuración de la [seguridad de Process-Wide con CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span><span class="sxs-lookup"><span data-stu-id="cbedf-368">For more information, see [Setting Process-Wide Security with CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="cbedf-369">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="cbedf-369">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cbedf-370">Clientes y servidores COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-370">COM Clients and Servers</span></span>](com-clients-and-servers.md)
</dt> <dt>

[<span data-ttu-id="cbedf-371">Definición de interfaces COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-371">Defining COM Interfaces</span></span>](defining-com-interfaces.md)
</dt> <dt>

[<span data-ttu-id="cbedf-372">Registro de aplicaciones COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-372">Registering COM Applications</span></span>](registering-com-applications.md)
</dt> <dt>

[<span data-ttu-id="cbedf-373">Seguridad en COM</span><span class="sxs-lookup"><span data-stu-id="cbedf-373">Security in COM</span></span>](security-in-com.md)
</dt> <dt>

[<span data-ttu-id="cbedf-374">Procesos, subprocesos y apartamentos</span><span class="sxs-lookup"><span data-stu-id="cbedf-374">Processes, Threads, and Apartments</span></span>](processes--threads--and-apartments.md)
</dt> </dl>

 

 
