---
title: Montones compartidos
description: Compartir es útil para arquitecturas multiproceso y multiadaptador.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/26/2019
ms.locfileid: "74103839"
---
# <a name="shared-heaps"></a><span data-ttu-id="0d762-103">Montones compartidos</span><span class="sxs-lookup"><span data-stu-id="0d762-103">Shared Heaps</span></span>

<span data-ttu-id="0d762-104">Compartir es útil para arquitecturas multiproceso y multiadaptador.</span><span class="sxs-lookup"><span data-stu-id="0d762-104">Sharing is useful for multi-process and multi-adapter architectures.</span></span>

-   [<span data-ttu-id="0d762-105">Información general de uso compartido</span><span class="sxs-lookup"><span data-stu-id="0d762-105">Sharing overview</span></span>](#sharing-overview)
-   [<span data-ttu-id="0d762-106">Uso compartido de montones entre procesos</span><span class="sxs-lookup"><span data-stu-id="0d762-106">Sharing heaps across processes</span></span>](#sharing-heaps-across-processes)
-   [<span data-ttu-id="0d762-107">Uso compartido de montones entre adaptadores</span><span class="sxs-lookup"><span data-stu-id="0d762-107">Sharing heaps across adapters</span></span>](#sharing-heaps-across-adapters)
-   [<span data-ttu-id="0d762-108">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="0d762-108">Related topics</span></span>](#related-topics)

## <a name="sharing-overview"></a><span data-ttu-id="0d762-109">Información general de uso compartido</span><span class="sxs-lookup"><span data-stu-id="0d762-109">Sharing overview</span></span>

<span data-ttu-id="0d762-110">Los montones compartidos permiten dos cosas: compartir datos en un montón en uno o varios procesos y evitar una elección no determinista del diseño de textura sin definir para los recursos que se colocan en el montón.</span><span class="sxs-lookup"><span data-stu-id="0d762-110">Shared heaps enable two things: sharing data in a heap across one or more processes, and precluding a non-deterministic choice of undefined texture layout for resources placed within the heap.</span></span> <span data-ttu-id="0d762-111">El uso compartido de montones entre adaptadores también elimina la necesidad de calcular las referencias de la CPU de los datos.</span><span class="sxs-lookup"><span data-stu-id="0d762-111">Sharing heaps across adapters also removes the need for CPU marshaling of the data.</span></span>

<span data-ttu-id="0d762-112">Se pueden compartir tanto montones como recursos confirmados.</span><span class="sxs-lookup"><span data-stu-id="0d762-112">Both heaps and committed resources can be shared.</span></span> <span data-ttu-id="0d762-113">Compartir un recurso confirmado realmente comparte el montón implícito junto con la descripción del recurso confirmado, de modo que se puede asignar una descripción del recurso compatible al montón desde otro dispositivo.</span><span class="sxs-lookup"><span data-stu-id="0d762-113">Sharing a committed resource actually shares the implicit heap along with the committed resource description, such that a compatible resource description can be mapped to the heap from another device.</span></span>

<span data-ttu-id="0d762-114">Todos los métodos son de subprocesamiento libre y heredan la semántica D3D11 existente del diseño de uso compartido de identificadores NT.</span><span class="sxs-lookup"><span data-stu-id="0d762-114">All methods are free-threaded and inherit the existing D3D11 semantics of the NT handle sharing design.</span></span>

-   [<span data-ttu-id="0d762-115">**ID3D12Device::CreateSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="0d762-115">**ID3D12Device::CreateSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [<span data-ttu-id="0d762-116">**ID3D12Device::OpenSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="0d762-116">**ID3D12Device::OpenSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [<span data-ttu-id="0d762-117">**ID3D12Device::OpenSharedHandleByName**</span><span class="sxs-lookup"><span data-stu-id="0d762-117">**ID3D12Device::OpenSharedHandleByName**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a><span data-ttu-id="0d762-118">Uso compartido de montones entre procesos</span><span class="sxs-lookup"><span data-stu-id="0d762-118">Sharing heaps across processes</span></span>

<span data-ttu-id="0d762-119">Los montones compartidos se especifican con el \_ \_ \_ miembro compartido de la marca de montón D3D12 de la enumeración [**D3D12 \_ heap \_ Flags**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="0d762-119">Shared heaps are specified with the D3D12\_HEAP\_FLAG\_SHARED member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="0d762-120">No se admiten montones compartidos en montones accesibles desde la CPU: D3D12 de tipo \_ \_ de montón \_ D3D12, \_ tipo de montón \_ \_ READBACK y D3D12 \_ tipo de montón \_ \_ personalizado sin la propiedad de \_ Página CPU de D3D12 \_ \_ \_ no \_ disponible.</span><span class="sxs-lookup"><span data-stu-id="0d762-120">Shared heaps are not supported on CPU-accessible heaps: D3D12\_HEAP\_TYPE\_UPLOAD, D3D12\_HEAP\_TYPE\_READBACK, and D3D12\_HEAP\_TYPE\_CUSTOM without D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE.</span></span>

<span data-ttu-id="0d762-121">Impedir una elección no determinista del diseño de textura sin definir puede perjudicar significativamente escenarios de representación aplazados en algunas GPU, por lo que no es el comportamiento predeterminado de los recursos colocados y confirmados.</span><span class="sxs-lookup"><span data-stu-id="0d762-121">Precluding a non-deterministic choice of undefined texture layout can significantly impair deferred rendering scenarios on some GPUs, so it is not the default behavior for placed and committed resources.</span></span> <span data-ttu-id="0d762-122">La representación diferida está desemparejada en algunas arquitecturas de GPU porque los diseños de texturas deterministas reducen el ancho de banda de memoria efectivo que se logra al representar simultáneamente en varias texturas de destino de representación con el mismo formato y tamaño.</span><span class="sxs-lookup"><span data-stu-id="0d762-122">Deferred rendering is impaired on some GPU architectures because deterministic texture layouts decrease the effective memory bandwidth achieved when rendering simultaneously to multiple render target textures of the same format and size.</span></span> <span data-ttu-id="0d762-123">Las arquitecturas de GPU no aprovechan los diseños de texturas no deterministas con el fin de admitir patrones normalizados de swizzle y diseños estandarizados de forma eficaz para la representación diferida.</span><span class="sxs-lookup"><span data-stu-id="0d762-123">GPU architectures are evolving away from leveraging non-deterministic texture layouts in order to support standardized swizzle patterns and standardized layouts efficiently for deferred rendering.</span></span>

<span data-ttu-id="0d762-124">Los montones compartidos también tienen otros costos menores:</span><span class="sxs-lookup"><span data-stu-id="0d762-124">Shared heaps come with other minor costs as well:</span></span>

-   <span data-ttu-id="0d762-125">Los datos del montón compartido no se pueden reciclar como montones en proceso debido a problemas de divulgación de información, por lo que la memoria física se zero'ed con más frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0d762-125">Shared heap data cannot be recycled as flexibly as in-process heaps due to information disclosure concerns, so physical memory is zero'ed more often.</span></span>
-   <span data-ttu-id="0d762-126">Hay una sobrecarga de CPU adicional y un mayor uso de la memoria del sistema durante la creación y destrucción de montones compartidos.</span><span class="sxs-lookup"><span data-stu-id="0d762-126">There is a minor additional CPU overhead and increased system memory usage during creation and destruction of shared heaps.</span></span>

## <a name="sharing-heaps-across-adapters"></a><span data-ttu-id="0d762-127">Uso compartido de montones entre adaptadores</span><span class="sxs-lookup"><span data-stu-id="0d762-127">Sharing heaps across adapters</span></span>

<span data-ttu-id="0d762-128">Los montones compartidos entre adaptadores se especifican con \_ la \_ marca \_ de montón D3D12 \_ miembro compartido Cross \_ Adapter de la enumeración [**D3D12 \_ heap \_ Flags**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="0d762-128">Shared heaps across adapters is specified with the D3D12\_HEAP\_FLAG\_SHARED\_CROSS\_ADAPTER member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="0d762-129">Los montones compartidos de adaptador cruzado permiten que varios adaptadores compartan datos sin calcular las referencias de la CPU de los datos entre ellos.</span><span class="sxs-lookup"><span data-stu-id="0d762-129">Cross adapter shared heaps enable multiple adapters to share data without the CPU marshaling the data between them.</span></span> <span data-ttu-id="0d762-130">Mientras que las distintas funcionalidades de adaptador determinan cómo los adaptadores eficientes pueden pasar datos entre ellos, la simple habilitación de las copias de GPU aumenta el ancho de banda efectivo conseguido.</span><span class="sxs-lookup"><span data-stu-id="0d762-130">While varying adapter capabilities determine how efficient adapters can pass data between them, merely enabling GPU copies increases the effective bandwidth achieved.</span></span> <span data-ttu-id="0d762-131">Algunos diseños de textura están permitidos en montones de adaptadores cruzados para admitir un intercambio de datos de textura, incluso si no se admiten estos diseños de textura.</span><span class="sxs-lookup"><span data-stu-id="0d762-131">Some texture layouts are allowed on cross adapter heaps to support an interchange of texture data, even if such texture layouts are not otherwise supported.</span></span> <span data-ttu-id="0d762-132">Se pueden aplicar determinadas restricciones a estas texturas, como solo admitir la copia.</span><span class="sxs-lookup"><span data-stu-id="0d762-132">Certain restrictions may apply to such textures, such as only supporting copying.</span></span>

<span data-ttu-id="0d762-133">El uso compartido entre adaptadores funciona con montones creados mediante una llamada a [**ID3D12Device:: CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="0d762-133">Cross-adapter sharing works with heaps created by calling [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="0d762-134">Las aplicaciones pueden crear recursos a través de [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span><span class="sxs-lookup"><span data-stu-id="0d762-134">Applications can then create resources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span></span> <span data-ttu-id="0d762-135">También lo permiten los recursos o montones creados por [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) , pero solo para los recursos de D3D12 de \_ dimensión de recursos TEXTURE2D principales de fila \_ \_ (consulte la [**dimensión de \_ recursos \_ de D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span><span class="sxs-lookup"><span data-stu-id="0d762-135">It is also allowed by resources/heaps created by [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) but only for row-major D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D resources (refer to [**D3D12\_RESOURCE\_DIMENSION**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span></span> <span data-ttu-id="0d762-136">El uso compartido entre adaptadores no funciona con [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span><span class="sxs-lookup"><span data-stu-id="0d762-136">Cross-adapter sharing does not work with [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span></span>

<span data-ttu-id="0d762-137">Para el uso compartido entre adaptadores, se siguen aplicando todas las reglas habituales de uso compartido de recursos entre colas.</span><span class="sxs-lookup"><span data-stu-id="0d762-137">For cross-adapter sharing, all of the usual cross-queue resource sharing rules still apply.</span></span> <span data-ttu-id="0d762-138">Las aplicaciones deben emitir las barreras adecuadas para garantizar la sincronización correcta y la coherencia entre los dos adaptadores.</span><span class="sxs-lookup"><span data-stu-id="0d762-138">Applications must issue the appropriate barriers to ensure proper synchronization and coherence between the two adapters.</span></span> <span data-ttu-id="0d762-139">Las aplicaciones deben usar barreras entre adaptadores para coordinar la programación de las listas de comandos enviadas a varios adaptadores.</span><span class="sxs-lookup"><span data-stu-id="0d762-139">Applications should use cross-adapter fences to coordinate the scheduling of command lists submitted to multiple adapters.</span></span> <span data-ttu-id="0d762-140">No hay ningún mecanismo para compartir recursos entre adaptadores a través de las versiones de la API de D3D.</span><span class="sxs-lookup"><span data-stu-id="0d762-140">There is no mechanism to share cross-adapter resources across D3D API versions.</span></span> <span data-ttu-id="0d762-141">Los recursos compartidos entre adaptadores solo se admiten en la memoria del sistema.</span><span class="sxs-lookup"><span data-stu-id="0d762-141">Cross-adapter shared resources are only supported in system memory.</span></span> <span data-ttu-id="0d762-142">Los recursos o montones compartidos entre adaptadores se admiten en montones \_ \_ predeterminados de tipo de montón D3D12 y en \_ \_ montones personalizados de tipo de montón D3D12 \_ \_ (con el grupo de memoria L0 y las propiedades de la página CPU de lectura y combinación).</span><span class="sxs-lookup"><span data-stu-id="0d762-142">Cross-adapter shared heaps/resources are supported in D3D12\_HEAP\_TYPE\_DEFAULT heaps and D3D12\_HEAP\_TYPE\_CUSTOM heaps (with the L0 memory pool, and write-combine CPU page properties).</span></span> <span data-ttu-id="0d762-143">Los controladores deben asegurarse de que las operaciones de lectura y escritura de GPU en montones compartidos entre adaptadores son coherentes con otras GPU del sistema.</span><span class="sxs-lookup"><span data-stu-id="0d762-143">Drivers must be sure that GPU read/write operations to cross-adapter shared heaps are coherent with other GPUs on the system.</span></span> <span data-ttu-id="0d762-144">Por ejemplo, es posible que el controlador tenga que excluir los datos del montón de residir en memorias caché de GPU que normalmente no es necesario vaciar cuando la CPU no puede acceder directamente a los datos del montón.</span><span class="sxs-lookup"><span data-stu-id="0d762-144">For example, the driver may need to exclude the heap data from residing in GPU caches that typically don’t need to be flushed when the CPU cannot directly access the heap data.</span></span>

<span data-ttu-id="0d762-145">Las aplicaciones deben limitar el uso de montones de adaptadores cruzados solo a los escenarios que requieren la funcionalidad que proporcionan.</span><span class="sxs-lookup"><span data-stu-id="0d762-145">Applications should confine the usage of cross adapter heaps to only those scenarios which require the functionality they provide.</span></span> <span data-ttu-id="0d762-146">Los montones de adaptadores cruzados se encuentran en \_ el grupo de memoria D3D12 \_ \_ L0, que no siempre es lo que [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) sugiere.</span><span class="sxs-lookup"><span data-stu-id="0d762-146">Cross-adapter heaps are located in D3D12\_MEMORY\_POOL\_L0, which is not always what [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggests.</span></span> <span data-ttu-id="0d762-147">El bloque de memoria no es eficaz para las arquitecturas de adaptador discreto/NUMA.</span><span class="sxs-lookup"><span data-stu-id="0d762-147">That memory pool is not efficient for discrete/ NUMA adapter architectures.</span></span> <span data-ttu-id="0d762-148">Además, los diseños de textura más eficientes no están siempre disponibles.</span><span class="sxs-lookup"><span data-stu-id="0d762-148">And, the most efficient texture layouts are not always available.</span></span>

<span data-ttu-id="0d762-149">También se aplican las siguientes limitaciones:</span><span class="sxs-lookup"><span data-stu-id="0d762-149">The following limitations also apply:</span></span>

-   <span data-ttu-id="0d762-150">Las marcas del montón relacionadas con los niveles del montón deben ser D3D12 el \_ indicador de montón \_ \_ permiten \_ todos los \_ búferes \_ y \_ texturas.</span><span class="sxs-lookup"><span data-stu-id="0d762-150">The heap flags related to heap tiers must be D3D12\_HEAP\_FLAG\_ALLOW\_ALL\_BUFFERS\_AND\_TEXTURES.</span></span>
-   <span data-ttu-id="0d762-151">\_ \_ También se debe establecer la marca de montón D3D12 \_ compartida.</span><span class="sxs-lookup"><span data-stu-id="0d762-151">D3D12\_HEAP\_FLAG\_SHARED must also be set.</span></span>
-   <span data-ttu-id="0d762-152">Debe establecerse el tipo predeterminado de montón de D3D12 \_ \_ o el \_ \_ \_ tipo de montón D3D12 \_ personalizado con el \_ grupo de memoria D3D12 \_ \_ L0 y la \_ propiedad de página de CPU D3D12 \_ \_ \_ no \_ disponible.</span><span class="sxs-lookup"><span data-stu-id="0d762-152">Either D3D12\_HEAP\_TYPE\_DEFAULT must be set or D3D12\_HEAP\_TYPE\_CUSTOM with D3D12\_MEMORY\_POOL\_L0 and D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE must be set.</span></span>
-   <span data-ttu-id="0d762-153">Solo los recursos con la \_ marca de recurso D3D12 permiten el \_ \_ \_ \_ adaptador cruzado en montones entre adaptadores.</span><span class="sxs-lookup"><span data-stu-id="0d762-153">Only resources with D3D12\_RESOURCE\_FLAG\_ALLOW\_CROSS\_ADAPTER may be placed on cross-adapter heaps.</span></span>

<span data-ttu-id="0d762-154">Para obtener más información sobre el uso de varios adaptadores, consulte la sección [sistemas de varios adaptadores](multi-engine.md) .</span><span class="sxs-lookup"><span data-stu-id="0d762-154">For more information on using multiple adapters, refer to the [Multi-adapter systems](multi-engine.md) section.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0d762-155">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="0d762-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0d762-156">Subasignación dentro de montones</span><span class="sxs-lookup"><span data-stu-id="0d762-156">Suballocation Within Heaps</span></span>](suballocation-within-heaps.md)
</dt> </dl>

 

 




