---
title: Actualización de compatibilidad de disco Advanced Format (4K)
description: Actualización de compatibilidad de disco Advanced Format (4K)
ms.assetid: 2C9EB0CF-D27B-457A-8FE6-24824BCC084C
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fbad505575c4479bd750f09ccd83bc4da4c39667
ms.sourcegitcommit: 78b64f3865e64768b5319d4f010032ee68924a98
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/13/2021
ms.locfileid: "107314978"
---
# <a name="advanced-format-4k-disk-compatibility-update"></a><span data-ttu-id="0f1a1-103">Actualización de compatibilidad de disco Advanced Format (4K)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-103">Advanced format (4K) disk compatibility update</span></span>

## <a name="platforms"></a><span data-ttu-id="0f1a1-104">Plataformas</span><span class="sxs-lookup"><span data-stu-id="0f1a1-104">Platforms</span></span>

<span data-ttu-id="0f1a1-105">**Clientes**   de   Windows XP, Windows Vista, Windows 7, Windows 7 SP1, Windows 8</span><span class="sxs-lookup"><span data-stu-id="0f1a1-105">**Clients**   Windows XP, Windows Vista, Windows 7, Windows 7 SP1, Windows 8</span></span>  
<span data-ttu-id="0f1a1-106">**Servidores**   de   Windows Server 2003, Windows Server 2008, Windows Server 2008 R2, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2 y Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="0f1a1-106">**Servers**   Windows Server 2003, Windows Server 2008, Windows Server 2008 R2, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2, Windows Server 2016</span></span>  


## <a name="description"></a><span data-ttu-id="0f1a1-107">Descripción</span><span class="sxs-lookup"><span data-stu-id="0f1a1-107">Description</span></span>

<span data-ttu-id="0f1a1-108">Este artículo es una versión actualizada del artículo titulado actualización de compatibilidad de disco de emulación de 512 bytes (512e) que se lanzó para Windows 7 SP1 y Windows Server 2008 R2 SP1.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-108">This article is an updated version of the article titled  512-byte Emulation (512e) Disk Compatibility Update  which was released for Windows 7 SP1 and Windows Server 2008 R2 SP1.</span></span> <span data-ttu-id="0f1a1-109">Esta actualización contiene mucha información nueva, algunas de las cuales solo es aplicable a Windows 8 y Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-109">This update contains much new info, some of which is applicable only to Windows 8 and Windows Server 2012.</span></span>

<span data-ttu-id="0f1a1-110">Las densidades áreas aumentan anualmente y, con la reciente llegada de discos de 3 TB, los mecanismos de corrección de errores que se usan para tratar la disminución de la señal a la relación de ruido (SNR) se están convirtiendo en un espacio ineficaz. es decir, se requiere una mayor cantidad de sobrecarga para asegurarse de que se pueda usar el medio.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-110">Areal densities are increasing yearly, and with the recent advent of 3 TB disks, the error correction mechanisms used to deal with the decreasing signal-to-noise-ratio (SNR) are becoming space inefficient; that is, an increased amount of overhead is required to ensure the media is usable.</span></span> <span data-ttu-id="0f1a1-111">Una de las soluciones del sector de almacenamiento para mejorar este mecanismo de corrección de errores consiste en introducir un formato de medios físicos diferente que incluye un tamaño de sector físico mayor.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-111">One of the storage industry solutions for improving this error correction mechanism is to introduce a different physical media format that includes a larger physical sector size.</span></span> <span data-ttu-id="0f1a1-112">Este nuevo formato de medio físico se denomina formato avanzado.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-112">This new physical media format is called Advanced Format.</span></span> <span data-ttu-id="0f1a1-113">Por lo tanto, ya no es seguro hacer ninguna suposición con respecto al tamaño de sector de los dispositivos de almacenamiento modernos y los desarrolladores deberán estudiar las suposiciones subyacentes a su código para determinar si hay un impacto.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-113">Therefore, it is no longer safe to make any assumptions regarding the sector size of modern storage devices, and developers will need to study the assumptions underlying their code to determine if there is an impact.</span></span>

<span data-ttu-id="0f1a1-114">En este tema se presenta el efecto de los dispositivos de almacenamiento de formato avanzado en el software, se explica lo que las aplicaciones pueden hacer para ayudar a admitir este tipo de medios y se describe la infraestructura que Microsoft presentó con Windows Vista, Windows 7 y Windows 8 para permitir que los desarrolladores admitan estos tipos de dispositivos.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-114">This topic introduces the effect of Advanced Format storage devices on software, discusses what apps can do to help support this type of media, and discusses the infrastructure that Microsoft introduced with Windows Vista, Windows 7, and Windows 8 to enable developers to support these types of devices.</span></span> <span data-ttu-id="0f1a1-115">Aunque el material presentado en este tema proporciona directrices para mejorar la compatibilidad con los discos con formato avanzado, la información se aplica generalmente a todos los sistemas con discos de formato avanzado que ejecutan Windows Vista, Windows 7 y Windows 8.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-115">While the material presented in this topic provides guidelines for improving compatibility with Advanced Format disks, the info applies generally to all systems with Advanced Format disks running Windows Vista, Windows 7, and Windows 8.</span></span>

<span data-ttu-id="0f1a1-116">**Resumen de las nuevas características relacionadas con el sector grande**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-116">**Summary of new large sector related features**</span></span>

<span data-ttu-id="0f1a1-117">En la lista siguiente se resumen las nuevas características que se ofrecen como parte de Windows 8 y Windows Server 2012 para ayudar a mejorar la experiencia de cliente y de desarrollador con discos de sector grande.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-117">The below list summarizes the new features delivered as part of Windows 8 and Windows Server 2012 to help improve customer and developer experience with large sector disks.</span></span> <span data-ttu-id="0f1a1-118">Descripción más detallada de cada elemento.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-118">More detailed description for each item follow.</span></span>

-   <span data-ttu-id="0f1a1-119">Se basa en la compatibilidad de Windows 7 SP1 con los discos 4K con emulación (512e) y proporciona compatibilidad completa con la bandeja de entrada para los discos con un tamaño de sector de 4K sin emulación (4K nativo).</span><span class="sxs-lookup"><span data-stu-id="0f1a1-119">Builds upon the Windows 7 SP1 support for 4K disks with emulation (512e), and provides full inbox support for disks with 4K sector size without emulation (4K Native).</span></span> <span data-ttu-id="0f1a1-120">Algunos escenarios y aplicaciones compatibles incluyen:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-120">Some supported apps and scenarios include:</span></span>
    -   <span data-ttu-id="0f1a1-121">Capacidad para instalar Windows y arrancar desde un disco del sector 4K sin emulación (disco nativo 4K)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-121">Ability to install Windows to and boot from a 4K sector disk without emulation (4K Native Disk)</span></span>
    -   <span data-ttu-id="0f1a1-122">VHD y nuevo formato de archivo VHDX</span><span class="sxs-lookup"><span data-stu-id="0f1a1-122">VHD and new VHDX file format</span></span>
    -   <span data-ttu-id="0f1a1-123">Compatibilidad completa con Hyper-v</span><span class="sxs-lookup"><span data-stu-id="0f1a1-123">Full HyperV support</span></span>
    -   <span data-ttu-id="0f1a1-124">Copias de seguridad de Windows</span><span class="sxs-lookup"><span data-stu-id="0f1a1-124">Windows backup</span></span>
    -   <span data-ttu-id="0f1a1-125">Compatibilidad completa en el sistema de archivos NT (NTFS)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-125">Full support in the NT file system (NTFS)</span></span>
    -   <span data-ttu-id="0f1a1-126">Compatibilidad total con nuevos grupos y espacios de almacenamiento (SSP)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-126">Full support with new Storage Spaces and Pools (SSP)</span></span>
    -   <span data-ttu-id="0f1a1-127">Compatibilidad total con Windows Defender</span><span class="sxs-lookup"><span data-stu-id="0f1a1-127">Full support with Windows Defender</span></span>
-   <span data-ttu-id="0f1a1-128">Proporciona una nueva API para consultar el tamaño del sector físico (FileFsSectorSizeInformation):</span><span class="sxs-lookup"><span data-stu-id="0f1a1-128">Provides a new API to query for physical sector size (FileFsSectorSizeInformation):</span></span>
    -   <span data-ttu-id="0f1a1-129">Disponible para volúmenes de red</span><span class="sxs-lookup"><span data-stu-id="0f1a1-129">Available for network volumes</span></span>
    -   <span data-ttu-id="0f1a1-130">Se puede emitir a cualquier identificador de archivo</span><span class="sxs-lookup"><span data-stu-id="0f1a1-130">Can be issued to any file handle</span></span>
    -   <span data-ttu-id="0f1a1-131">Disponible para aplicaciones sin privilegios</span><span class="sxs-lookup"><span data-stu-id="0f1a1-131">Available for unprivileged apps</span></span>
    -   <span data-ttu-id="0f1a1-132">Modelo de uso más descriptivo</span><span class="sxs-lookup"><span data-stu-id="0f1a1-132">Friendlier usage model</span></span>
-   <span data-ttu-id="0f1a1-133">Incluye la utilidad de línea de comandos fsutil mejorada para consultar el tamaño del sector lógico y físico del volumen con información de alineación (la versión básica de la utilidad sin información de alineación está disponible para Windows 7 con Microsoft KB 982018 y Windows Server 2008 R2 con Microsoft KB 982018)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-133">Includes enhanced  fsutil  command line utility to query for logical and physical sector size of volume with alignment info (basic version of utility without alignment info is available for Windows 7 with Microsoft KB 982018 and Windows Server 2008 R2 with Microsoft KB 982018)</span></span>

<span data-ttu-id="0f1a1-134">**Introducción a los discos con formato avanzado (4K)**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-134">**Introduction to advanced format (4K) disks**</span></span>

<span data-ttu-id="0f1a1-135">Uno de los problemas de la introducción de este cambio en el formato multimedia es la posibilidad de introducir problemas de compatibilidad con el software y el hardware existentes.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-135">One of the problems of introducing this change in the media format is the potential for introducing compatibility issues with existing software and hardware.</span></span> <span data-ttu-id="0f1a1-136">Como solución de compatibilidad temporal, el sector de almacenamiento presenta inicialmente discos que emulan un disco de sector de 512 bytes normal, pero facilitan la información disponible sobre el tamaño de sector real a través de los comandos estándar de ATA y SCSI.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-136">As a temporary compatibility solution, the storage industry is initially introducing disks that emulate a regular 512-byte sector disk, but make available info about the true sector size through standard ATA and SCSI commands.</span></span> <span data-ttu-id="0f1a1-137">Como resultado de esta emulación, hay, en esencia, dos tamaños de sector:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-137">As a result of this emulation, there are, in essence, two sector sizes:</span></span>

<span data-ttu-id="0f1a1-138">**Sector lógico:** Unidad que se usa para el direccionamiento de bloque lógico para los medios.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-138">**Logical sector:** The unit that is used for logical block addressing for the media.</span></span> <span data-ttu-id="0f1a1-139">También podemos considerarla como la unidad más pequeña de escritura que el almacenamiento puede aceptar.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-139">We can also think of it as the smallest unit of write that the storage can accept.</span></span> <span data-ttu-id="0f1a1-140">Esta es la emulación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-140">This is the  emulation.</span></span>   
<span data-ttu-id="0f1a1-141">**Sector físico:** Unidad para la que se completan las operaciones de lectura y escritura en el dispositivo en una sola operación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-141">**Physical sector:** The unit for which read and write operations to the device are completed in a single operation.</span></span> <span data-ttu-id="0f1a1-142">Esta es la unidad de escritura atómica.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-142">This is the unit of atomic write.</span></span>  
 <span data-ttu-id="0f1a1-143">La mayoría de las API de Windows actuales, como IOCTL \_ Disk \_ Get \_ Drive \_ Geometry devolverán el tamaño del sector lógico, pero el tamaño del sector físico se puede recuperar a través del código de control de propiedad de consulta de almacenamiento de ioctl, con la información pertinente incluida en el campo BytesPerPhysicalSector de la estructura del <a href="/windows/desktop/api/winioctl/ns-winioctl-storage_access_alignment_descriptor"> \_ \_ \_ descriptor de alineación de acceso de almacenamiento</a> . <a href="/windows-hardware/drivers/ddi/content/ntddstor/ni-ntddstor-ioctl_storage_query_property"> \_ \_ \_ </a></span><span class="sxs-lookup"><span data-stu-id="0f1a1-143">Most current Windows APIs, such as IOCTL\_DISK\_GET\_DRIVE\_GEOMETRY will return the logical sector size, but the physical sector size can be retrieved through the <a href="/windows-hardware/drivers/ddi/content/ntddstor/ni-ntddstor-ioctl_storage_query_property">IOCTL\_STORAGE\_QUERY\_PROPERTY</a> control code, with the relevant info contained in the BytesPerPhysicalSector field in the <a href="/windows/desktop/api/winioctl/ns-winioctl-storage_access_alignment_descriptor">STORAGE\_ACCESS\_ALIGNMENT\_DESCRIPTOR</a> structure.</span></span> <span data-ttu-id="0f1a1-144">Esto se describe con más detalle más adelante en el artículo.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-144">This is discussed in more detail later in the article.</span></span>

<span data-ttu-id="0f1a1-145">**Tipos iniciales de medios de sectores grandes**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-145">**Initial types of large sector media**</span></span>

<span data-ttu-id="0f1a1-146">El sector del almacenamiento es rápidamente el trabajo de transición a este nuevo tipo de formato avanzado de almacenamiento para los medios que tienen un tamaño de sector físico de 4 KB.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-146">The storage industry is quickly ramping up efforts to transition to this new Advanced Format type of storage for media having a 4 KB physical sector size.</span></span> <span data-ttu-id="0f1a1-147">Se publicarán dos tipos de medios en el mercado:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-147">Two types of media will be released to the market:</span></span>

<span data-ttu-id="0f1a1-148">**4 KB nativo:** Este medio no tiene ninguna capa de emulación y expone directamente 4 KB como su tamaño de sector físico y lógico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-148">**4 KB native:** This media has no emulation layer and directly exposes 4 KB as its logical and physical sector size.</span></span> <span data-ttu-id="0f1a1-149">El problema general con este nuevo tipo de medio es que la mayoría de las aplicaciones y los sistemas operativos no consultan y alinean las operaciones de e/s con el tamaño del sector físico, lo que puede dar lugar a operaciones de e/s inesperadas.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-149">The overall issue with this new type of media is that the majority of apps and operating systems do not query for and align I/Os to the physical sector size, which can result in unexpected failed I/Os.</span></span>  
<span data-ttu-id="0f1a1-150">**emulación de 512 bytes (512e):** Este medio tiene un nivel de emulación como se describe en la sección anterior y expone 512 bytes como su tamaño de sector lógico (similar a un disco normal hoy), pero hace que su información de tamaño de sector físico (4 KB) esté disponible.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-150">**512-byte emulation (512e):** This media has an emulation layer as discussed in the previous section and exposes 512-bytes as its logical sector size (similar to a regular disk today), but makes its physical sector size info (4 KB) available.</span></span> <span data-ttu-id="0f1a1-151">El problema general con este nuevo tipo de medio es que la mayoría de los sistemas operativos y aplicaciones no entienden la existencia del tamaño del sector físico, lo que puede dar lugar a una serie de problemas, como se explica a continuación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-151">The overall issue with this new type of media is that the majority of app and operating systems do not understand the existence of the physical sector size, which can result in a number of issues as will be discussed below.</span></span>  
<span data-ttu-id="0f1a1-152">**Compatibilidad total con Windows para medios de gran sector**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-152">**Overall Windows support for large sector media**</span></span>

<span data-ttu-id="0f1a1-153">En esta tabla se documenta la Directiva oficial de soporte técnico de Microsoft para varios medios y sus tamaños de sector presentados.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-153">This table documents the official Microsoft support policy for various media and their resulting reported sector sizes.</span></span> <span data-ttu-id="0f1a1-154">Consulte este [artículo de Knowledge Base](https://support.microsoft.com/kb/2510009) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-154">See this [KB article](https://support.microsoft.com/kb/2510009) for details.</span></span>



| <span data-ttu-id="0f1a1-155">Nombres comunes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-155">Common Names</span></span>                                  | <span data-ttu-id="0f1a1-156">Tamaño de sector lógico informado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-156">Reported Logical Sector Size</span></span> | <span data-ttu-id="0f1a1-157">Tamaño de sector físico indicado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-157">Reported Physical Sector Size</span></span> | <span data-ttu-id="0f1a1-158">Versión de Windows compatible con</span><span class="sxs-lookup"><span data-stu-id="0f1a1-158">Windows Version with Support</span></span>                                                                                                                                                                                                                                                                             |
|-----------------------------------------------|------------------------------|-------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="0f1a1-159">512-Byte nativo, 512n</span><span class="sxs-lookup"><span data-stu-id="0f1a1-159">512-byte Native, 512n</span></span>                         | <span data-ttu-id="0f1a1-160">512 bytes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-160">512 bytes</span></span>                    | <span data-ttu-id="0f1a1-161">512 bytes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-161">512 bytes</span></span>                     | <span data-ttu-id="0f1a1-162">Todas las versiones de Windows</span><span class="sxs-lookup"><span data-stu-id="0f1a1-162">All Windows versions</span></span>                                                                                                                                                                                                                                                                                     |
| <span data-ttu-id="0f1a1-163">Formato avanzado, 512e, AF, emulación de 512 bytes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-163">Advanced Format, 512e, AF, 512-byte Emulation</span></span> | <span data-ttu-id="0f1a1-164">512 bytes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-164">512 bytes</span></span>                    | <span data-ttu-id="0f1a1-165">4 KB</span><span class="sxs-lookup"><span data-stu-id="0f1a1-165">4 KB</span></span>                          | <span data-ttu-id="0f1a1-166">Windows Vista con MS KB 2553708</span><span class="sxs-lookup"><span data-stu-id="0f1a1-166">Windows Vista w/ MS KB 2553708</span></span> <br/> <span data-ttu-id="0f1a1-167">Windows Server 2008 \* w/MS KB 2553708</span><span class="sxs-lookup"><span data-stu-id="0f1a1-167">Windows Server 2008\* w/ MS KB 2553708</span></span> <br/> <span data-ttu-id="0f1a1-168">Windows 7 w/MS KB 982018</span><span class="sxs-lookup"><span data-stu-id="0f1a1-168">Windows 7 w/ MS KB 982018</span></span> <br/> <span data-ttu-id="0f1a1-169">Windows Server 2008 R2 \* w/MS KB 982018</span><span class="sxs-lookup"><span data-stu-id="0f1a1-169">Windows Server 2008 R2\* w/ MS KB 982018</span></span> <br/> <span data-ttu-id="0f1a1-170">Todas las versiones de Windows de Windows 7 SP1 y posteriores.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-170">All Windows versions from Windows 7 SP1 and beyond.</span></span> <br/> <span data-ttu-id="0f1a1-171">Todas las versiones de servidor de Server 2008 R2 SP1 y versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-171">All Server versions from Server 2008 R2 SP1 and beyond.</span></span> <br/> <br/> <span data-ttu-id="0f1a1-172">\*Excepto para Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-172">\*Except for Hyper-V.</span></span> <span data-ttu-id="0f1a1-173">Vea la sección ["requisitos de compatibilidad de aplicaciones para unidades de sector grande"](https://support.microsoft.com/help/2510009/microsoft-support-policy-for-4k-sector-hard-drives-in-windows) .</span><span class="sxs-lookup"><span data-stu-id="0f1a1-173">See the ["Application support requirements for large-sector drives"](https://support.microsoft.com/help/2510009/microsoft-support-policy-for-4k-sector-hard-drives-in-windows) section.</span></span> |
| <span data-ttu-id="0f1a1-174">Formato avanzado, AF, 4K nativo, 4Kn</span><span class="sxs-lookup"><span data-stu-id="0f1a1-174">Advance Format, AF, 4K Native, 4Kn</span></span>            | <span data-ttu-id="0f1a1-175">4 KB</span><span class="sxs-lookup"><span data-stu-id="0f1a1-175">4 KB</span></span>                         | <span data-ttu-id="0f1a1-176">4 KB</span><span class="sxs-lookup"><span data-stu-id="0f1a1-176">4 KB</span></span>                          | <span data-ttu-id="0f1a1-177">Todas las versiones de Windows de Windows 8 y posteriores</span><span class="sxs-lookup"><span data-stu-id="0f1a1-177">All Windows versions from Windows 8 and beyond</span></span> <br/> <span data-ttu-id="0f1a1-178">Todas las versiones de servidor de Windows Server 2012 y versiones posteriores</span><span class="sxs-lookup"><span data-stu-id="0f1a1-178">All Server versions from Windows Server 2012 and beyond</span></span> <br/>                                                                                                                                                                                                                                                      |
| <span data-ttu-id="0f1a1-179">Otros</span><span class="sxs-lookup"><span data-stu-id="0f1a1-179">Other</span></span>                                         | <span data-ttu-id="0f1a1-180">No 4 KB o 512 bytes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-180">Not 4 KB or 512 bytes</span></span>        | <span data-ttu-id="0f1a1-181">No 4 KB o 512 bytes</span><span class="sxs-lookup"><span data-stu-id="0f1a1-181">Not 4 KB or 512 bytes</span></span>         | <span data-ttu-id="0f1a1-182">No compatible</span><span class="sxs-lookup"><span data-stu-id="0f1a1-182">Not supported</span></span>                                                                                                                                                                                                                                                                                            |



 

> [!Note]  
> <span data-ttu-id="0f1a1-183">Aunque no se sobrerayó en la tabla anterior, Windows XP, Windows Server 2003 y Windows Server 2003 R2 no admiten medios 512e o 4Kn.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-183">While not stressed in the preceding table, Windows XP, Windows Server 2003, and Windows Server 2003 R2 do not support 512e or 4Kn media.</span></span> <span data-ttu-id="0f1a1-184">Aunque el sistema puede arrancar y ser capaz de funcionar mínimamente, puede haber escenarios desconocidos de problemas de funcionalidad, pérdida de datos o rendimiento poco óptimo.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-184">While the system may boot up and be able to operate minimally, there may be unknown scenarios of functionality issues, data loss, or sub-optimal performance.</span></span> <span data-ttu-id="0f1a1-185">Por lo tanto, Microsoft se recomienda encarecidamente no usar medios de 512e con Windows XP u otros productos basados en el código base de Windows XP (como Windows Home Server 1,0, Windows Server 2003, Windows Server 2003 R2, Windows XP 64-bit Edition, Windows XP Embedded, Windows Small Business Server 2003 y Windows Small Business Server 2003 R2).</span><span class="sxs-lookup"><span data-stu-id="0f1a1-185">Thus, Microsoft strongly cautions against using 512e media with Windows XP or other products based on the Windows XP codebase (such as Windows Home Server 1.0, Windows Server 2003, Windows Server 2003 R2, Windows XP 64-bit Edition, Windows XP Embedded, Windows Small Business Server 2003, and Windows Small Business Server 2003 R2).</span></span>

 

## <a name="how-emulation-works-read-modify-write-rmw"></a><span data-ttu-id="0f1a1-186">Cómo funciona la emulación: lectura, modificación y escritura (RMW)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-186">How emulation works: read-modify-write (RMW)</span></span>

<span data-ttu-id="0f1a1-187">Un medio de almacenamiento tiene una unidad determinada en la que se puede modificar el medio físico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-187">A storage medium has a certain unit within which the physical medium can be modified.</span></span> <span data-ttu-id="0f1a1-188">Es decir, los medios solo se pueden escribir o volver a escribir en unidades del tamaño de sector físico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-188">That is, the media can only be written, or rewritten, in units of the physical sector size.</span></span> <span data-ttu-id="0f1a1-189">Por lo tanto, las operaciones de escritura que no se realicen en este nivel de unidad necesitarán pasos adicionales, lo que le guiaremos a través del ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-189">Thus, writes that are not performed at this unit level would require additional steps, which we will walk through the example below.</span></span>

<span data-ttu-id="0f1a1-190">En este escenario, una aplicación necesita actualizar el contenido de un registro de Stor ubicado en un sector lógico de 512 bytes.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-190">In this scenario, an app needs to update the contents of a Datastor record located within a 512-byte logical sector.</span></span> <span data-ttu-id="0f1a1-191">En este diagrama se ilustran los pasos necesarios para que el dispositivo de almacenamiento complete la escritura:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-191">This diagram illustrates the steps necessary for the storage device to complete the write:</span></span>

![pasos para que un dispositivo de almacenamiento complete una escritura](images/512ermwsteps.png)

<span data-ttu-id="0f1a1-193">Como se muestra arriba, este proceso implica algún trabajo por parte del dispositivo de almacenamiento que puede provocar una pérdida de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-193">As illustrated above, this process involves some work by the storage device that can result in a performance loss.</span></span> <span data-ttu-id="0f1a1-194">Para evitar este trabajo adicional, las aplicaciones deben actualizarse a:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-194">To avoid this additional work, apps must be updated to:</span></span>

-   <span data-ttu-id="0f1a1-195">Consultar el tamaño del sector físico</span><span class="sxs-lookup"><span data-stu-id="0f1a1-195">Query for the physical sector size</span></span>
-   <span data-ttu-id="0f1a1-196">Asegurarse de que las escrituras se alineen con el tamaño de sector físico indicado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-196">Ensure writes are aligned to that reported physical sector size</span></span>

<span data-ttu-id="0f1a1-197">Aunque esto puede parecer solo un problema de rendimiento, puede haber un problema más grave.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-197">While this may initially appear to be only a performance issue, there can be more serious issue.</span></span> <span data-ttu-id="0f1a1-198">Vamos a analizar esto en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-198">Let s discuss this in the next section.</span></span>

<span data-ttu-id="0f1a1-199">**Resistencia: costo oculto de lectura-modificación-escritura**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-199">**Resiliency: the hidden cost of read-modify-write**</span></span>

<span data-ttu-id="0f1a1-200">La resistencia habla de la capacidad de una aplicación para recuperar el estado entre las sesiones.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-200">Resiliency speaks of the ability of an app to recover state between sessions.</span></span> <span data-ttu-id="0f1a1-201">Hemos detectado lo que es necesario para que un dispositivo de almacenamiento de 512e pueda realizar un sector de 512 bytes para escribir el ciclo de lectura/modificación-escritura.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-201">We have seen what is necessary for a 512e storage device to perform a 512-byte sector write   the Read-Modify-Write cycle.</span></span> <span data-ttu-id="0f1a1-202">Echemos un vistazo a lo que sucedería si se interrumpiera el proceso de sobrescribir el sector físico anterior en el medio.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-202">Let s look at what would happen if the process of overwriting the previous physical sector on the media was interrupted.</span></span> <span data-ttu-id="0f1a1-203">¿Cuáles son las consecuencias?</span><span class="sxs-lookup"><span data-stu-id="0f1a1-203">What would be the consequences?</span></span>

-   <span data-ttu-id="0f1a1-204">Dado que la mayoría de las unidades de disco duro se actualizan de forma local, el sector físico, es decir, la parte del medio en el que se encontró el sector físico podría haberse dañado con información incompleta debido a una sobrescritura parcial.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-204">Because most hard disk drives update in place, the physical sector   that is, the portion of the media where the physical sector was located   could have been corrupted with incomplete info due to a partial overwrite.</span></span> <span data-ttu-id="0f1a1-205">Además, puede pensar en ello como si hubiera perdido los 8 sectores lógicos (que el sector físico contiene lógicamente).</span><span class="sxs-lookup"><span data-stu-id="0f1a1-205">Put another way, you can think of it as potentially having lost all 8 logical sectors (which the physical sector logically contains).</span></span>
-   <span data-ttu-id="0f1a1-206">Aunque la mayoría de las aplicaciones con un almacén de datos están diseñadas con la capacidad de recuperarse de errores de medios, de la pérdida de ocho sectores o de otro modo, la pérdida de ocho registros de confirmación, puede hacer imposible que el almacén de datos se recupere correctamente.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-206">While most apps with a data store are designed with the capability to recover from media errors, the loss of eight sectors, or put another way, the loss of eight commit records, can potentially make it impossible for the data store to recover gracefully.</span></span> <span data-ttu-id="0f1a1-207">Es posible que un administrador tenga que restaurar manualmente la base de datos a partir de una copia de seguridad o incluso puede tener que realizar una regeneración larga.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-207">An administrator may need to manually restore the database from a backup or may even need to perform a lengthy rebuild.</span></span>
-   <span data-ttu-id="0f1a1-208">Un impacto más importante es que el acto de otra aplicación que produce un ciclo de lectura-modificación-escritura puede provocar que se pierdan los datos incluso si la aplicación no se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-208">One more important impact is that the act of another app causing a Read-Modify-Write cycle can potentially cause your data to be lost   even if your app is not running!</span></span> <span data-ttu-id="0f1a1-209">Esto se debe a que los datos y los demás datos de la aplicación pueden encontrarse en el mismo sector físico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-209">This is simply because your data and the other app s data could be located within the same physical sector.</span></span>

<span data-ttu-id="0f1a1-210">Teniendo esto en cuenta, es importante que el software de la aplicación vuelva a evaluar las suposiciones tomadas en el código y tenga en cuenta la distinción de tamaño de sector físico lógico, junto con algunos escenarios de cliente interesantes que se describen más adelante en este artículo.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-210">With this in mind, it is important that app software reevaluate any assumptions taken in the code, and be aware of the logical-physical sector size distinction, along with some interesting customer scenarios discussed later in this article.</span></span>

<span data-ttu-id="0f1a1-211">**Hacer lo correcto (evitar Read-Modify-Write)**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-211">**Doing the right thing (avoiding read-modify-write)**</span></span>

<span data-ttu-id="0f1a1-212">Aunque algunos proveedores de almacenamiento pueden estar introduciendo algunos niveles de mitigación en determinados dispositivos de almacenamiento de 512e para intentar facilitar los problemas de rendimiento y resistencia del ciclo de lectura-modificación-escritura, solo hay muchas mitigaciones que pueden controlar en términos de carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-212">While some storage vendors may be introducing some levels of mitigation within certain 512e storage devices to try to ease the performance and resiliency issues of the Read-Modify-Write cycle, there is only so much any mitigation can handle in terms of workload.</span></span> <span data-ttu-id="0f1a1-213">Como tal, las aplicaciones no deben basarse en esta mitigación como una solución a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-213">As such, apps should not rely on this mitigation as a long-term solution.</span></span> <span data-ttu-id="0f1a1-214">Además, no hay ninguna garantía de que todas las clases de discos tengan esta mitigación implementada, ni tampoco se garantiza que la mitigación esté bien diseñada.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-214">Moreover, there is no guarantee that all classes of disks will have this mitigation in place, nor is there a guarantee that the mitigation is well-designed.</span></span>

<span data-ttu-id="0f1a1-215">La solución a esto no es una mitigación en el disco, sino para diseñar aplicaciones que realicen el conjunto adecuado de cosas para ayudar a admitir este tipo de medios.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-215">The solution to this is not in-drive mitigation, but to design apps to do the right set of things to help support this type of media.</span></span> <span data-ttu-id="0f1a1-216">En esta sección se describen escenarios comunes en los que las aplicaciones pueden tener problemas con discos de sector grande y se sugiere una vía de investigación para probar y resolver cada problema.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-216">This section discusses common scenarios where apps may have issues with large sector disks, and suggests an avenue of investigation to try and resolve each issue.</span></span>

<span data-ttu-id="0f1a1-217">**Problema 1: la partición no está alineada con un límite de sector físico**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-217">**Issue 1: the partition is not aligned to a physical sector boundary**</span></span>

<span data-ttu-id="0f1a1-218">Cuando el administrador o el usuario crea particiones en el disco, es posible que la primera partición no se haya creado en un límite alineado.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-218">When the administrator/user partitions the disk, the first partition may not have been created on an aligned boundary.</span></span> <span data-ttu-id="0f1a1-219">Esto puede hacer que todas las escrituras posteriores se desalineen en los límites del sector físico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-219">This may cause all subsequent writes to become unaligned to physical sector boundaries.</span></span> <span data-ttu-id="0f1a1-220">A partir de Windows Vista SP1 y Windows Server 2008, la primera partición se coloca en los primeros 1024 KB del disco (para los discos de 4 GB o más, de lo contrario, la alineación es de 64 KB) que está alineada con un límite de sector físico de 4 KB.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-220">As of Windows Vista SP1 and Windows Server 2008, the first partition is placed at the first 1024 KB of the disk (for disks 4GB or larger, otherwise the alignment is 64 KB) that is aligned to a 4 KB physical sector boundary.</span></span> <span data-ttu-id="0f1a1-221">Sin embargo, dada la partición predeterminada en Windows XP, una utilidad de creación de particiones de terceros o un uso incorrecto de las API de Windows, es posible que las particiones creadas no estén alineadas con un límite de sector físico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-221">However, given the default partitioning in Windows XP, a 3rd party partitioning utility or incorrect usage of Windows APIs, created partitions may not be aligned to a physical sector boundary.</span></span> <span data-ttu-id="0f1a1-222">Los desarrolladores deberán asegurarse de que se usan las API correctas para ayudar a garantizar la alineación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-222">Developers will need to ensure that the correct APIs are used to help ensure alignment.</span></span> <span data-ttu-id="0f1a1-223">Las API recomendadas para ayudar a garantizar la alineación de la partición se describen a continuación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-223">The recommended APIs to help ensure partition alignment are outlined below.</span></span>

<span data-ttu-id="0f1a1-224">Las API IVdsPack:: CreateVolume y IVdsPack2:: CreateVolume2 no usan el parámetro de alineación especificado cuando se crea un nuevo volumen, sino que usan el valor predeterminado de alineación para el sistema operativo (anterior a Windows Vista SP1 usará 63 bytes y, después, Windows Vista SP1 usará los valores predeterminados indicados anteriormente).</span><span class="sxs-lookup"><span data-stu-id="0f1a1-224">The IVdsPack::CreateVolume and IVdsPack2::CreateVolume2 APIs do not use the specified alignment parameter when a new volume is created, but rather use the alignment value default for the operating system (Pre-Windows Vista SP1 will use 63 bytes, and post Windows Vista SP1 will use the defaults stated above).</span></span> <span data-ttu-id="0f1a1-225">En su lugar, use las API IVdsCreatePartitionEx:: CreatePartitionEx o IVdsAdvancedDisk:: CreatePartition que usan el parámetro de alineación especificado para las aplicaciones que necesitan crear particiones.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-225">Instead, use the IVdsCreatePartitionEx::CreatePartitionEx or IVdsAdvancedDisk::CreatePartition APIs that use the specified alignment parameter for those apps that need to create partitions.</span></span>

<span data-ttu-id="0f1a1-226">La mejor manera de asegurarse de que la alineación sea correcta es hacerlo bien cuando se crea la partición inicialmente.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-226">The best way to help ensure that alignment is correct is to do it right when initially creating the partition.</span></span> <span data-ttu-id="0f1a1-227">En caso contrario, la aplicación tendrá que tener en cuenta la alineación al realizar operaciones de escritura o de inicialización, lo que puede ser un proceso muy complejo.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-227">Otherwise your app will need to take alignment into account when performing writes or at initialization   which can be a very complex process.</span></span>

<span data-ttu-id="0f1a1-228">**Problema 2: Escrituras no almacenadas en búfer no alineadas con el tamaño de sector físico**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-228">**Issue 2: unbuffered writes not aligned to physical sector size**</span></span>

<span data-ttu-id="0f1a1-229">El problema más sencillo es que las escrituras no almacenadas en búfer no se alinean con el tamaño de sector físico indicado de los medios de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-229">The simplest issue is that unbuffered writes are not aligned to the reported physical sector size of the storage media.</span></span> <span data-ttu-id="0f1a1-230">Por otro lado, las escrituras almacenadas en búfer se alinean con el tamaño de página 4 KB, lo que casualmente es el tamaño de sector físico de la primera generación de medios de sector grande.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-230">Buffered writes, on the other hand, are aligned to the page size   4 KB   which coincidently is the physical sector size of the first generation of large sector media.</span></span> <span data-ttu-id="0f1a1-231">Sin embargo, la mayoría de las aplicaciones con un almacén de datos realizan escrituras no almacenadas en búfer y, por lo tanto, deberán asegurarse de que estas escrituras se realicen en unidades del tamaño de sector físico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-231">However, most apps with a data store perform unbuffered writes, and thus will need to ensure these writes are performed in units of the physical sector size.</span></span>

<span data-ttu-id="0f1a1-232">Algunos ejemplos de escenarios en los que la e/s de la aplicación resultante no está alineada:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-232">Some examples of scenarios where the resulting app I/O is unaligned:</span></span>

<span data-ttu-id="0f1a1-233">**Los registros de confirmación se rellenan en los sectores de 512 bytes:** Las aplicaciones con un almacén de datos suelen tener algún tipo de registro de confirmación que mantiene información sobre los cambios en los metadatos o mantiene la estructura del almacén de datos.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-233">**Commit records are padded to 512-byte sectors:** Apps with a data store typically have some form of commit record that either maintains info about metadata changes or maintains the structure of the data store.</span></span> <span data-ttu-id="0f1a1-234">Con el fin de garantizar que la pérdida de un sector no afecte a varios registros, este registro de confirmación se rellena normalmente en un tamaño de sector.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-234">In order to ensure that the loss of a sector does not affect multiple records, this commit record is typically padded out to a sector size.</span></span> <span data-ttu-id="0f1a1-235">Con un disco con un tamaño de sector físico mayor, la aplicación tendrá que consultar el tamaño de sector físico tal como se muestra en la sección anterior y asegurarse de que cada registro de confirmación se rellene hasta ese tamaño.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-235">With a disk with a larger physical sector size, the app will need to query for the physical sector size as shown in the prior section, and ensure each commit record is padded to that size.</span></span> <span data-ttu-id="0f1a1-236">Con un disco de 4K, esto garantiza que no se produzcan errores de e/s.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-236">With a 4K disk, this ensures I/Os do not fail.</span></span> <span data-ttu-id="0f1a1-237">Con un disco 512e, no solo evita el ciclo de lectura-modificación-escritura, sino que ayuda a garantizar que si se perdió un sector físico, solo se perdería un registro de confirmación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-237">With a 512e disk, not only does this avoid the Read-Modify-Write cycle, it helps ensure that if a physical sector was lost, only one Commit Record would be lost.</span></span>  
<span data-ttu-id="0f1a1-238">**Los archivos de registro se escriben en fragmentos no alineados:** La e/s no almacenada en búfer se usa normalmente al actualizar o anexar a un archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-238">**Log files are written to in unaligned chunks:** Unbuffered I/O is typically used when updating or appending to a log file.</span></span> <span data-ttu-id="0f1a1-239">Las aplicaciones pueden cambiar a e/s almacenadas en búfer, o almacenar internamente las actualizaciones de registro en unidades del tamaño de sector físico para evitar errores de e/s o desencadenar una lectura/modificación-escritura.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-239">Apps can either switch to buffered I/O, or internally buffer the log updates to units of the physical sector size to avoid failed I/Os or triggering a Read-Modify-Write.</span></span>  
 <span data-ttu-id="0f1a1-240">Para ayudar a determinar si la aplicación emite e/s no almacenada en búfer, asegúrese de incluir la marca de archivo \_ \_ sin \_ marca de almacenamiento en búfer en el parámetro *dwFlagsAndAttributes* cuando llame a la función CreateFile.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-240">To help determine if your app issues unbuffered I/O, make sure to include the FILE\_FLAG\_NO\_BUFFERING flag in the *dwFlagsAndAttributes* parameter when you are call the CreateFile function.</span></span>

<span data-ttu-id="0f1a1-241">Además, si está alineando actualmente las escrituras en el tamaño del sector, lo más probable es que este tamaño de sector sea solo el tamaño del sector lógico, ya que la mayoría de las API existentes que consultan el tamaño del sector del medio simplemente consultan la unidad de direccionamiento que es, el tamaño del sector lógico.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-241">Moreover, if you are currently aligning the writes to the sector size, this sector size is most likely just the logical sector size, as most existing APIs that query for the sector size of the media just query the unit of addressing   that is, the logical sector size.</span></span> <span data-ttu-id="0f1a1-242">El tamaño de sector de interés es el tamaño del sector físico, que es la unidad real de atomicidad.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-242">The sector size of interest here is the physical sector size, which is the real unit of atomicity.</span></span> <span data-ttu-id="0f1a1-243">Algunos ejemplos de API que recuperan el tamaño del sector lógico son:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-243">Some examples of APIs that retrieve the logical sector size are:</span></span>

-   <span data-ttu-id="0f1a1-244">GetDiskFreeSpace, GetDiskFreeSpaceEx</span><span class="sxs-lookup"><span data-stu-id="0f1a1-244">GetDiskFreeSpace, GetDiskFreeSpaceEx</span></span>
-   <span data-ttu-id="0f1a1-245">FileFsVolumeInformation</span><span class="sxs-lookup"><span data-stu-id="0f1a1-245">FileFsVolumeInformation</span></span>
-   <span data-ttu-id="0f1a1-246">el \_ disco ioctl \_ obtiene la \_ \_ geometría de unidad, el \_ disco ioctl obtener la geometría de \_ \_ unidad \_ \_ ex</span><span class="sxs-lookup"><span data-stu-id="0f1a1-246">IOCTL\_DISK\_GET\_DRIVE\_GEOMETRY, IOCTL\_DISK\_GET\_DRIVE\_GEOMETRY\_EX</span></span>
-   <span data-ttu-id="0f1a1-247">IVdsDisk:: GetProperties, IVdsDisk3:: GetProperties2</span><span class="sxs-lookup"><span data-stu-id="0f1a1-247">IVdsDisk::GetProperties, IVdsDisk3::GetProperties2</span></span>

<span data-ttu-id="0f1a1-248">Aquí puede consultar el tamaño del sector físico:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-248">Here s how you can query for the physical sector size:</span></span>

<span data-ttu-id="0f1a1-249">**Método preferido para Windows 8**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-249">**Preferred method for Windows 8**</span></span>

<span data-ttu-id="0f1a1-250">Con Windows 8, Microsoft ha incorporado una nueva API que permite a los desarrolladores integrar fácilmente la compatibilidad con 4K dentro de sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-250">With Windows 8, Microsoft has introduced a new API that enables developers to easily integrate 4K support within their apps.</span></span> <span data-ttu-id="0f1a1-251">Esta nueva API admite incluso un mayor número de escenarios que el método heredado para Windows Vista y Windows 7 que se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-251">This new API supports even greater numbers of scenarios than the legacy method for Windows Vista and Windows 7 discussed below.</span></span> <span data-ttu-id="0f1a1-252">Esta API habilita estos escenarios de llamada:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-252">This API enables these calling scenarios:</span></span>

-   <span data-ttu-id="0f1a1-253">Llamar desde una aplicación sin privilegios</span><span class="sxs-lookup"><span data-stu-id="0f1a1-253">Calling from an unprivileged app</span></span>
-   <span data-ttu-id="0f1a1-254">Llamar a cualquier identificador de archivo válido</span><span class="sxs-lookup"><span data-stu-id="0f1a1-254">Calling to any valid file handle</span></span>
-   <span data-ttu-id="0f1a1-255">Llamar a un identificador de archivo en un volumen remoto a través de SMB2</span><span class="sxs-lookup"><span data-stu-id="0f1a1-255">Calling to a file handle on a remote volume over SMB2</span></span>
-   <span data-ttu-id="0f1a1-256">Modelo de programación simplificado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-256">Simplified programming model</span></span>

<span data-ttu-id="0f1a1-257">La API está en forma de una nueva clase de información, FileFsSectorSizeInformation, con la información de tamaño de sector de FS del archivo de estructura asociado \_ \_ \_ \_ , que se define de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-257">The API is in the form of a new info class, FileFsSectorSizeInformation, with associated structure FILE\_FS\_SECTOR\_SIZE\_INFORMATION, defined as follows:</span></span>


```
typedef struct _FILE_FS_SECTOR_SIZE_INFORMATION {  
    ULONG LogicalBytesPerSector;  
    ULONG PhysicalBytesPerSectorForAtomicity;  
    ULONG PhysicalBytesPerSectorForPerformance;  
    ULONG FileSystemEffectivePhysicalBytesPerSectorForAtomicity;  
    ULONG Flags;  
    ULONG ByteOffsetForSectorAlignment;  
    ULONG ByteOffsetForPartitionAlignment;  
} FILE_FS_SECTOR_SIZE_INFORMATION, *PFILE_FS_SECTOR_SIZE_INFORMATION;
```



<span data-ttu-id="0f1a1-258">**Método heredado para Windows 7 y Windows Vista**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-258">**Legacy method for Windows 7 and Windows Vista**</span></span>

<span data-ttu-id="0f1a1-259">Windows Vista y Windows Server 2008 introdujeron las API para consultar el tamaño del sector físico del dispositivo de almacenamiento conectado para los controladores de almacenamiento basados en AHCI.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-259">Windows Vista and Windows Server 2008 introduced APIs to query for the physical sector size of the attached storage device for AHCI-based storage controllers.</span></span> <span data-ttu-id="0f1a1-260">Con Windows 7 y Windows Server 2008 R2, a partir de SP1 (o Microsoft Knowledge Base 982018), esta compatibilidad se extiende a los controladores de almacenamiento basados en Storport.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-260">With Windows 7 and Windows Server 2008 R2, as of SP1 (or Microsoft Knowledge Base 982018), this support is extended to Storport-based storage controllers.</span></span> <span data-ttu-id="0f1a1-261">Microsoft ha proporcionado un [ejemplo de código](/windows/desktop/api/winioctl/ns-winioctl-storage_access_alignment_descriptor) en MSDN que detalla cómo una aplicación puede consultar el tamaño del sector físico del volumen.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-261">Microsoft has provided a [code sample](/windows/desktop/api/winioctl/ns-winioctl-storage_access_alignment_descriptor) on MSDN detailing how an app can query for the physical sector size of the volume.</span></span>

<span data-ttu-id="0f1a1-262">Aunque el ejemplo de código anterior le permite obtener el tamaño del sector físico del volumen, debe realizar algunas comprobaciones básicas del tamaño del sector físico indicado antes de usarlo, ya que es posible que algunos controladores no devuelvan datos con el formato correcto:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-262">While the code sample above allows you to get the physical sector size of the volume, you should do some basic sanity checking of the reported physical sector size before using it, as it has been observed that some drivers may not return correctly formatted data:</span></span>

-   <span data-ttu-id="0f1a1-263">Asegúrese de que el tamaño de sector físico indicado es >= el tamaño de sector lógico indicado; Si no es así, la aplicación debe usar un tamaño de sector físico igual al tamaño de sector lógico indicado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-263">Make sure that the reported physical sector size is >= the reported logical sector size; if it is not, your app should use a physical sector size equal to the reported logical sector size</span></span>
-   <span data-ttu-id="0f1a1-264">Asegúrese de que el tamaño de sector físico indicado sea una potencia de dos. Si no es así, la aplicación debe usar un tamaño de sector físico igual al tamaño de sector lógico indicado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-264">Make sure that the reported physical sector size is a power of two; if it is not, your app should use a physical sector size equal to the reported logical sector size</span></span>
-   <span data-ttu-id="0f1a1-265">Si el tamaño del sector físico es un valor de potencia de dos entre 512 y 4 KB, debería considerar la posibilidad de usar un tamaño de sector físico redondeado hacia abajo al tamaño del sector lógico indicado.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-265">If the physical sector size is a power-of-two value between 512-bytes and 4 KB, you should consider using a physical sector size rounded down to the reported logical sector size</span></span>
-   <span data-ttu-id="0f1a1-266">Si el tamaño del sector físico es un valor de potencia de dos superior a 4 KB, debe evaluar la capacidad de la aplicación para controlar este escenario antes de usar ese valor. de lo contrario, debería considerar el uso de un tamaño de sector físico redondeado a 4 KB.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-266">If the physical sector size is a power-of-two value greater than 4 KB, you should evaluate your app s ability to handle this scenario before using that value; otherwise, you should consider using a physical sector size rounded down to 4 KB</span></span>

<span data-ttu-id="0f1a1-267">El uso de este IOCTL para obtener el tamaño del sector físico tiene varias limitaciones.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-267">Using this IOCTL to get the physical sector size does have several limitations.</span></span> <span data-ttu-id="0f1a1-268">Este:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-268">It:</span></span>

-   <span data-ttu-id="0f1a1-269">Requiere privilegios elevados. Si la aplicación no se ejecuta con privilegios, puede que tenga que escribir una aplicación de servicio de Windows como se indicó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-269">Requires elevated privilege; if your app is not running with privilege, you may need to write a Windows Service Application as noted above</span></span>
-   <span data-ttu-id="0f1a1-270">No admite volúmenes SMB; también es posible que tenga que escribir una aplicación de servicio de Windows para admitir la consulta de tamaño de sector físico en estos volúmenes.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-270">Does not support SMB volumes; you may also need to write a Windows Service Application to support physical sector size querying on these volumes</span></span>
-   <span data-ttu-id="0f1a1-271">No se puede emitir a ningún identificador de archivo (IOCTL debe emitirse a un identificador de volumen)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-271">Cannot be issued to any file handle (the IOCTL must be issued to a Volume Handle)</span></span>

<span data-ttu-id="0f1a1-272">**Problema 3: formatos de archivo que se basan en sectores de 512 bytes**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-272">**Issue 3: file formats relying on 512-byte sectors**</span></span>

<span data-ttu-id="0f1a1-273">Algunas aplicaciones con formatos de archivo estándar (como VHD 1,0) pueden tener estos archivos codificados de forma rígida para asumir un tamaño de sector de 512 bytes.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-273">Some apps with standard file formats (such as VHD 1.0) may have these files hard-coded to assume a 512-byte sector size.</span></span> <span data-ttu-id="0f1a1-274">Por lo tanto, las actualizaciones y escrituras en este archivo darían como resultado un ciclo de lectura-modificación-escritura en el dispositivo, lo que podría dar lugar a problemas de rendimiento y resistencia para los clientes.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-274">Thus, updates and writes to this file would result in a Read-Modify-Write cycle on the device  which will potentially result in performance and resiliency issues for your customers.</span></span> <span data-ttu-id="0f1a1-275">Sin embargo, hay maneras de que una aplicación proporcione compatibilidad para trabajar en este tipo de medios, por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-275">However, there are ways for an app to provide support for operating on this type of media, for example:</span></span>

-   <span data-ttu-id="0f1a1-276">Use el almacenamiento en búfer para asegurarse de que las escrituras se realicen en unidades del tamaño de sector físico</span><span class="sxs-lookup"><span data-stu-id="0f1a1-276">Use buffering to ensure that writes are performed in units of the physical sector size</span></span>
-   <span data-ttu-id="0f1a1-277">Implementar un interno de lectura/modificación-escritura que puede ayudar a garantizar que las actualizaciones se realicen en unidades del tamaño de sector físico indicado</span><span class="sxs-lookup"><span data-stu-id="0f1a1-277">Implement an internal Read-Modify-Write that can help ensure that updates are performed in units of the reported physical sector size</span></span>
-   <span data-ttu-id="0f1a1-278">Si es posible, rellenar los registros en un sector físico, de tal forma que el relleno se interprete como espacio vacío</span><span class="sxs-lookup"><span data-stu-id="0f1a1-278">If possible, pad records out to a physical sector, in such a way that the padding would be interpreted as empty space</span></span>
-   <span data-ttu-id="0f1a1-279">Considere la posibilidad de volver a diseñar una versión de la estructura de datos de la aplicación compatible con sectores mayores</span><span class="sxs-lookup"><span data-stu-id="0f1a1-279">Consider redesigning a version of the app data structure with support for larger sectors</span></span>

<span data-ttu-id="0f1a1-280">**Problema 4: el tamaño del sector físico indicado puede cambiar entre sesiones**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-280">**Issue 4: the reported physical sector size can change between sessions**</span></span>

<span data-ttu-id="0f1a1-281">Hay muchos escenarios en los que el tamaño de sector físico indicado del almacenamiento subyacente que hospeda el Stor puede cambiar.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-281">There are many scenarios where the reported physical sector size of the underlying storage that hosts the Datastor may change.</span></span> <span data-ttu-id="0f1a1-282">Lo más común es cuando se migra el Stor a otro volumen, o incluso a través de la red.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-282">The most common of these is when you migrate the Datastor to another volume, or even across the network.</span></span> <span data-ttu-id="0f1a1-283">Un cambio en el tamaño del sector físico indicado puede ser un evento inesperado para muchas aplicaciones y puede dar lugar a que algunas aplicaciones no se reinicialicen.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-283">A change in the reported physical sector size may be an unexpected event for many apps and potentially can result in some apps failing to re-initialize.</span></span>

<span data-ttu-id="0f1a1-284">Este no es el escenario más sencillo de admitir y se menciona aquí como aviso.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-284">This is not the easiest scenario to support, and is mentioned here as an advisory.</span></span> <span data-ttu-id="0f1a1-285">Debe tener en cuenta los requisitos de movilidad de sus clientes y ajustar su soporte en consecuencia para ayudar a garantizar que los clientes no se vean afectados negativamente mediante el uso de medios de 4K o de 512e.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-285">You should consider the mobility requirements of your customers and adjust your support accordingly to help ensure customers are not negatively impacted by using 4K native or 512e media.</span></span>

<span data-ttu-id="0f1a1-286">**Cómo un usuario puede recuperar el tamaño del sector lógico y físico para un volumen**</span><span class="sxs-lookup"><span data-stu-id="0f1a1-286">**How a user can retrieve the logical and physical sector size for a volume**</span></span>

<span data-ttu-id="0f1a1-287">En la caja con Windows hay una utilidad para mostrar la información de tamaño de sector para un volumen.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-287">In-box with Windows is a utility to display the sector size info for a volume.</span></span> <span data-ttu-id="0f1a1-288">Las versiones de Windows con fsutil compatible son:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-288">Versions of Windows with supported  fsutil  are:</span></span>

-   <span data-ttu-id="0f1a1-289">Windows 8</span><span class="sxs-lookup"><span data-stu-id="0f1a1-289">Windows 8</span></span>
-   <span data-ttu-id="0f1a1-290">Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="0f1a1-290">Windows Server 2012</span></span>
-   <span data-ttu-id="0f1a1-291">Windows 7 SP1 con Microsoft KB 982018</span><span class="sxs-lookup"><span data-stu-id="0f1a1-291">Windows 7 SP1 with Microsoft KB 982018</span></span>
-   <span data-ttu-id="0f1a1-292">Windows 7 con Microsoft KB 982018</span><span class="sxs-lookup"><span data-stu-id="0f1a1-292">Windows 7 with Microsoft KB 982018</span></span>
-   <span data-ttu-id="0f1a1-293">Windows Server 2008 R2 SP1 con Microsoft KB 982018 (V3)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-293">Windows Server 2008 R2 SP1 with Microsoft KB 982018 (v3)</span></span>
-   <span data-ttu-id="0f1a1-294">Windows Server 2008 R2 con Microsoft KB 982018 (V3)</span><span class="sxs-lookup"><span data-stu-id="0f1a1-294">Windows Server 2008 R2 with Microsoft KB 982018 (v3)</span></span>
-   <span data-ttu-id="0f1a1-295">Windows Vista con Microsoft KB 2553708</span><span class="sxs-lookup"><span data-stu-id="0f1a1-295">Windows Vista with Microsoft KB 2553708</span></span>
-   <span data-ttu-id="0f1a1-296">Windows Server 2008 con Microsoft KB 2553708</span><span class="sxs-lookup"><span data-stu-id="0f1a1-296">Windows Server 2008 with Microsoft KB 2553708</span></span>

<span data-ttu-id="0f1a1-297">Para obtener la información de tamaño de sector, llame a la utilidad como se indica a continuación desde un símbolo del sistema con privilegios elevados:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-297">To get the sector size info, call the utility as follows from an elevated command prompt:</span></span>


```
fsutil fsinfo ntfsinfo <drive letter>
```



<span data-ttu-id="0f1a1-298">Un disco de sector 4K con emulación de 512 bytes tiene el campo bytes por sector establecido en 512 y el campo bytes por sector físico establecido en 4096 de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-298">A 4K Sector Disk with 512-byte Emulation has the  Bytes Per Sector  field set to 512 and the  Bytes Per Physical Sector  field set to 4096 as follows:</span></span>

![bytes por sector y por sector físico de un disco de sector de 4k con emulación de 512 bytes](images/4ksectordiskwith512emulation.png)

<span data-ttu-id="0f1a1-300">Un disco nativo 4K tiene los campos bytes por sector y bytes por sector físico establecidos en 4096 de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0f1a1-300">A 4K Native Disk has the  Bytes Per Sector  and  Bytes Per Physical Sector  fields both set to 4096 as follows:</span></span>

![bytes por sector y por sector físico de un disco nativo de 4k](images/4knativedisk.png)

> [!Note]  
> <span data-ttu-id="0f1a1-302">Si el campo byte por sector físico muestra no compatible, significa que el controlador de almacenamiento no admite la \_ propiedad de consulta de almacenamiento ioctl o que \_ \_ se produjo un error al recuperar la información.</span><span class="sxs-lookup"><span data-stu-id="0f1a1-302">If the  Byte Per Physical Sector  field displays  Not Supported  then either the storage driver does not support IOCTL\_STORAGE\_QUERY\_PROPERTY, or there was an error in retrieving the info.</span></span>

 

## <a name="resources"></a><span data-ttu-id="0f1a1-303">Recursos</span><span class="sxs-lookup"><span data-stu-id="0f1a1-303">Resources</span></span>

-   [<span data-ttu-id="0f1a1-304">Instrucción de soporte general de Windows</span><span class="sxs-lookup"><span data-stu-id="0f1a1-304">Windows General Support Statement</span></span>](https://support.microsoft.com/kb/2510009)
-   [<span data-ttu-id="0f1a1-305">Microsoft KB 982018</span><span class="sxs-lookup"><span data-stu-id="0f1a1-305">Microsoft KB 982018</span></span>](https://support.microsoft.com/kb/982018)
-   [<span data-ttu-id="0f1a1-306">Microsoft KB 2553708</span><span class="sxs-lookup"><span data-stu-id="0f1a1-306">Microsoft KB 2553708</span></span>](https://support.microsoft.com/kb/2553708)
-   [<span data-ttu-id="0f1a1-307">Revisión para Windows 7 y Windows Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="0f1a1-307">Hotfix for Windows 7 and Windows Server 2008 R2</span></span>](https://support.microsoft.com/kb/982018)
-   [<span data-ttu-id="0f1a1-308">Revisión para Windows Vista y Windows Server 2008</span><span class="sxs-lookup"><span data-stu-id="0f1a1-308">Hotfix for Windows Vista and Windows Server 2008</span></span>](https://support.microsoft.com/kb/2553708)
-   [<span data-ttu-id="0f1a1-309">Declaración de compatibilidad de HyperV</span><span class="sxs-lookup"><span data-stu-id="0f1a1-309">HyperV Support Statement</span></span>](https://support.microsoft.com/kb/2515143)
-   [<span data-ttu-id="0f1a1-310">Información general sobre el \_ código de \_ control de propiedad de consulta de almacenamiento ioctl \_</span><span class="sxs-lookup"><span data-stu-id="0f1a1-310">General information about the IOCTL\_STORAGE\_QUERY\_PROPERTY control code</span></span>](/windows-hardware/drivers/ddi/ntddstor/ni-ntddstor-ioctl_storage_query_property)
-   [<span data-ttu-id="0f1a1-311">\_Código de \_ control de propiedad de consulta de almacenamiento ioctl \_</span><span class="sxs-lookup"><span data-stu-id="0f1a1-311">IOCTL\_STORAGE\_QUERY\_PROPERTY Control Code</span></span>](/windows/win32/api/winioctl/ni-winioctl-ioctl_storage_query_property)
-   [<span data-ttu-id="0f1a1-312">Información general sobre la \_ estructura de \_ descriptor de alineación de acceso de almacenamiento \_</span><span class="sxs-lookup"><span data-stu-id="0f1a1-312">General information about the STORAGE\_ACCESS\_ALIGNMENT\_DESCRIPTOR structure</span></span>](/windows-hardware/drivers/ddi/ntddstor/ns-ntddstor-_storage_access_alignment_descriptor)
-   [<span data-ttu-id="0f1a1-313">Descripción de la terminología estándar que se usa para describir las actualizaciones de software de Microsoft</span><span class="sxs-lookup"><span data-stu-id="0f1a1-313">Description of the standard terminology used to describe Microsoft software updates</span></span>](https://support.microsoft.com/kb/824684/)
-   [<span data-ttu-id="0f1a1-314">Código de ejemplo de WDK con detalles sobre cómo extraer la información de alineación de acceso de almacenamiento de la \_ estructura de descriptor de alineación de acceso de almacenamiento \_ \_ al realizar una llamada al \_ código de control de \_ propiedad de consulta de almacenamiento ioctl \_</span><span class="sxs-lookup"><span data-stu-id="0f1a1-314">WDK sample code with details for how to extract the reported storage access alignment info from the STORAGE\_ACCESS\_ALIGNMENT\_DESCRIPTOR structure when making a call to the IOCTL\_STORAGE\_QUERY\_PROPERTY control code</span></span>](/windows/win32/api/winioctl/ns-winioctl-storage_access_alignment_descriptor)
-   <span data-ttu-id="0f1a1-315">[Información general sobre las opciones de Command-Line de ImageX](/previous-versions/windows/it-pro/windows-7/dd799302(v=ws.10))</span><span class="sxs-lookup"><span data-stu-id="0f1a1-315">[General information about ImageX Command-Line Options](/previous-versions/windows/it-pro/windows-7/dd799302(v=ws.10))</span></span>
-   [<span data-ttu-id="0f1a1-316">Requisitos del controlador del chipset Intel para admitir unidades del sector de 4 KB</span><span class="sxs-lookup"><span data-stu-id="0f1a1-316">Intel Chipset driver requirements to support 4 KB Sector Drives</span></span>](https://www.intel.com/support/chipsets/imsm/sb/CS-031502.htm)

 

