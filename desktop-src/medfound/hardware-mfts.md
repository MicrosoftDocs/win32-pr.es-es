---
description: En este tema se describe cómo escribir una transformación de Media Foundation (MFT) que actúa como proxy para un codificador de hardware, un descodificador o un procesador de señal digital (DSP).
ms.assetid: 9922d403-5d0d-433f-ad9f-c86142ac0f46
title: MFTs de hardware
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ac5ce05b4fdad6040b51f66f543c1737fc3918d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2021
ms.locfileid: "104275772"
---
# <a name="hardware-mfts"></a><span data-ttu-id="9df8f-103">MFTs de hardware</span><span class="sxs-lookup"><span data-stu-id="9df8f-103">Hardware MFTs</span></span>

> [!Note]  
> <span data-ttu-id="9df8f-104">Este tema se aplica a Windows 7 o posterior.</span><span class="sxs-lookup"><span data-stu-id="9df8f-104">This topic applies to Windows 7 or later.</span></span>

 

<span data-ttu-id="9df8f-105">En este tema se describe cómo escribir una transformación de Media Foundation (MFT) que actúa como proxy para un codificador de hardware, un descodificador o un procesador de señal digital (DSP).</span><span class="sxs-lookup"><span data-stu-id="9df8f-105">This topic describes how to write a Media Foundation transform (MFT) that acts as a proxy to a hardware encoder, decoder, or digital signal processor (DSP).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9df8f-106">Si un códec de hardware usa el controlador de la clase multimedia AVStream, no necesita un MFT personalizado.</span><span class="sxs-lookup"><span data-stu-id="9df8f-106">If a hardware codec uses the AVStream multimedia class driver, it does not require a custom MFT.</span></span> <span data-ttu-id="9df8f-107">Media Foundation proporciona un proxy AVStream para este propósito.</span><span class="sxs-lookup"><span data-stu-id="9df8f-107">Media Foundation provides an AVStream proxy for this purpose.</span></span> <span data-ttu-id="9df8f-108">La información de este tema solo se aplica en el caso especial en el que el códec de hardware no usa AVStream.</span><span class="sxs-lookup"><span data-stu-id="9df8f-108">The information in this topic applies only in the special case where the hardware codec does not use AVStream.</span></span> <span data-ttu-id="9df8f-109">Para obtener más información, consulte [compatibilidad con códecs de hardware en AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span><span class="sxs-lookup"><span data-stu-id="9df8f-109">For more information, see [Hardware Codec Support in AVStream](https://msdn.microsoft.com/library/dd568169.aspx).</span></span>

 

<span data-ttu-id="9df8f-110">Este tema contiene las siguientes secciones:</span><span class="sxs-lookup"><span data-stu-id="9df8f-110">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="9df8f-111">Introducción</span><span class="sxs-lookup"><span data-stu-id="9df8f-111">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="9df8f-112">Atributos de MFT de hardware</span><span class="sxs-lookup"><span data-stu-id="9df8f-112">Hardware MFT Attributes</span></span>](#hardware-mft-attributes)
-   [<span data-ttu-id="9df8f-113">Secuencia de protocolo de enlace de hardware</span><span class="sxs-lookup"><span data-stu-id="9df8f-113">Hardware Handshake Sequence</span></span>](#hardware-handshake-sequence)
-   [<span data-ttu-id="9df8f-114">Procesamiento de datos</span><span class="sxs-lookup"><span data-stu-id="9df8f-114">Data Processing</span></span>](#data-processing)
-   [<span data-ttu-id="9df8f-115">Descodificador/codificador emparejados</span><span class="sxs-lookup"><span data-stu-id="9df8f-115">Paired Decoder/Encoder</span></span>](#paired-decoderencoder)
-   [<span data-ttu-id="9df8f-116">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="9df8f-116">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="9df8f-117">Introducción</span><span class="sxs-lookup"><span data-stu-id="9df8f-117">Introduction</span></span>

<span data-ttu-id="9df8f-118">Cualquier códec de hardware que no esté basado en AVStream debe proporcionar su propio MFT para que actúe como proxy para el controlador.</span><span class="sxs-lookup"><span data-stu-id="9df8f-118">Any hardware codec that is not based on AVStream must provide its own MFT to act as a proxy to the driver.</span></span> <span data-ttu-id="9df8f-119">Un códec de hardware puede incorporar varios bloques funcionales distintos:</span><span class="sxs-lookup"><span data-stu-id="9df8f-119">A hardware codec might incorporate several distinct functional blocks:</span></span>

-   <span data-ttu-id="9df8f-120">Codificador</span><span class="sxs-lookup"><span data-stu-id="9df8f-120">Encoder</span></span>
-   <span data-ttu-id="9df8f-121">Descodificador</span><span class="sxs-lookup"><span data-stu-id="9df8f-121">Decoder</span></span>
-   <span data-ttu-id="9df8f-122">Escala de fotogramas/conversión de formato</span><span class="sxs-lookup"><span data-stu-id="9df8f-122">Frame scaling/format conversion</span></span>

<span data-ttu-id="9df8f-123">Cada una de estas funciones debe administrarse mediante un MFT independiente.</span><span class="sxs-lookup"><span data-stu-id="9df8f-123">Each of these functions should be managed by a separate MFT.</span></span> <span data-ttu-id="9df8f-124">Un MFT de hardware nunca debe actuar como "transcodificador" multipropósito.</span><span class="sxs-lookup"><span data-stu-id="9df8f-124">A hardware MFT should never act as a multi-purpose "transcoder."</span></span> <span data-ttu-id="9df8f-125">En su lugar, coloque las funciones de codificación en una MFT del codificador y descodifique las funciones en un MFT del descodificador.</span><span class="sxs-lookup"><span data-stu-id="9df8f-125">Instead, put encoding functions into an encoder MFT and decoding functions into a decoder MFT.</span></span> <span data-ttu-id="9df8f-126">Si el hardware ofrece conversiones de formato y escalado de fotogramas, coloque esas funciones en un procesador de vídeo independiente registrado en la categoría de **\_ \_ \_ procesador de vídeo categoría de MFT** .</span><span class="sxs-lookup"><span data-stu-id="9df8f-126">If the hardware offers frame scaling and format conversions, place those functions in a separate video processor, registered in the **MFT\_CATEGORY\_VIDEO\_PROCESSOR** category.</span></span> <span data-ttu-id="9df8f-127">Si el hardware no admite la escala de fotogramas o la conversión de formato, Media Foundation proporciona un procesador de vídeo de software.</span><span class="sxs-lookup"><span data-stu-id="9df8f-127">If the hardware does not support frame scaling or format conversion, Media Foundation provides a software video processor.</span></span>

<span data-ttu-id="9df8f-128">Los MFTs de hardware tienen los siguientes requisitos generales:</span><span class="sxs-lookup"><span data-stu-id="9df8f-128">Hardware MFTs have the following general requirements:</span></span>

-   <span data-ttu-id="9df8f-129">El MFTs de hardware debe usar el nuevo modelo de procesamiento asincrónico, como se describe en [MFTs asincrónico](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="9df8f-129">Hardware MFTs must use the new asynchronous processing model, as described in [Asynchronous MFTs](asynchronous-mfts.md).</span></span>
-   <span data-ttu-id="9df8f-130">Los MFTs de hardware deben admitir los cambios de formato dinámico, tal y como se describe en [cambios de formato dinámico](basic-mft-processing-model.md).</span><span class="sxs-lookup"><span data-stu-id="9df8f-130">Hardware MFTs must support dynamic format changes, as described in [Dynamic Format Changes](basic-mft-processing-model.md).</span></span>

## <a name="hardware-mft-attributes"></a><span data-ttu-id="9df8f-131">Atributos de MFT de hardware</span><span class="sxs-lookup"><span data-stu-id="9df8f-131">Hardware MFT Attributes</span></span>

<span data-ttu-id="9df8f-132">Un MFT de hardware debe implementar los métodos siguientes relacionados con los atributos:</span><span class="sxs-lookup"><span data-stu-id="9df8f-132">A hardware MFT must implement following methods related to attributes:</span></span>

-   <span data-ttu-id="9df8f-133">[**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): devuelve un almacén de atributos para los atributos globales de MFT.</span><span class="sxs-lookup"><span data-stu-id="9df8f-133">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes): Returns an attribute store for global MFT attributes.</span></span>
-   <span data-ttu-id="9df8f-134">[**IMFTransform:: GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): devuelve un almacén de atributos para un flujo de entrada.</span><span class="sxs-lookup"><span data-stu-id="9df8f-134">[**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes): Returns an attribute store for an input stream.</span></span>
-   <span data-ttu-id="9df8f-135">[**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): devuelve un almacén de atributos para un flujo de salida.</span><span class="sxs-lookup"><span data-stu-id="9df8f-135">[**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes): Returns an attribute store for an output stream.</span></span>

<span data-ttu-id="9df8f-136">Cuando se crea por primera vez la MFT, debe establecer los atributos siguientes en su propio almacén de atributos global (es decir, el almacén de atributos devuelto por [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span><span class="sxs-lookup"><span data-stu-id="9df8f-136">When the MFT is first created, it must set the following attributes on its own global attribute store (that is, the attribute store returned by [**GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes)):</span></span>



| <span data-ttu-id="9df8f-137">Atributo</span><span class="sxs-lookup"><span data-stu-id="9df8f-137">Attribute</span></span>                                                                                    | <span data-ttu-id="9df8f-138">Descripción</span><span class="sxs-lookup"><span data-stu-id="9df8f-138">Description</span></span>                                                                                                                                                                            |
|----------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="9df8f-139">MF \_ transformación \_ asincrónica</span><span class="sxs-lookup"><span data-stu-id="9df8f-139">MF\_TRANSFORM\_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="9df8f-140">Debe establecerse en **true**.</span><span class="sxs-lookup"><span data-stu-id="9df8f-140">Must be set to **TRUE**.</span></span> <span data-ttu-id="9df8f-141">Indica que MFT realiza el procesamiento asincrónico.</span><span class="sxs-lookup"><span data-stu-id="9df8f-141">Indicates that the MFT performs asynchronous processing.</span></span>                                                                                                      |
| [<span data-ttu-id="9df8f-142">\_Atributo de \_ \_ dirección URL de hardware enum de MFT \_</span><span class="sxs-lookup"><span data-stu-id="9df8f-142">MFT\_ENUM\_HARDWARE\_URL\_Attribute</span></span>](mft-enum-hardware-url-attribute.md)                   | <span data-ttu-id="9df8f-143">Contiene el vínculo simbólico para el dispositivo de hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-143">Contains the symbolic link for the hardware device.</span></span><br/> <span data-ttu-id="9df8f-144">El cargador de topología usa la presencia de este atributo para probar si una MFT representa un dispositivo de hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-144">The topology loader uses the presence of this attribute to test whether an MFT represents a hardware device.</span></span><br/> |
| [<span data-ttu-id="9df8f-145">**la MFT \_ admite el \_ \_ cambio de formato dinámico \_**</span><span class="sxs-lookup"><span data-stu-id="9df8f-145">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="9df8f-146">Debe establecerse en **true**.</span><span class="sxs-lookup"><span data-stu-id="9df8f-146">Must be set to **TRUE**.</span></span> <span data-ttu-id="9df8f-147">Indica que la MFT admite cambios de formato dinámico.</span><span class="sxs-lookup"><span data-stu-id="9df8f-147">Indicates that the MFT supports dynamic format changes.</span></span>                                                                                                       |



 

## <a name="hardware-handshake-sequence"></a><span data-ttu-id="9df8f-148">Secuencia de protocolo de enlace de hardware</span><span class="sxs-lookup"><span data-stu-id="9df8f-148">Hardware Handshake Sequence</span></span>

<span data-ttu-id="9df8f-149">Si dos MFTs representan el mismo dispositivo físico, pueden intercambiar datos dentro del hardware, por ejemplo, a través de un bus de hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-149">If two MFTs represent the same physical device, they can exchange data within the hardware—for example, over a hardware bus.</span></span> <span data-ttu-id="9df8f-150">No es necesario copiar los datos en la memoria del sistema y, a continuación, volver al dispositivo.</span><span class="sxs-lookup"><span data-stu-id="9df8f-150">There is no need to copy the data into system memory and then back to the device.</span></span>

<span data-ttu-id="9df8f-151">En el diagrama siguiente, el MFTs con la etiqueta "A" y "B" representa bloques funcionales dentro del mismo hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-151">In the following diagram, the MFTs labeled "A" and "B" represent functional blocks within the same hardware.</span></span> <span data-ttu-id="9df8f-152">Por ejemplo, en un escenario de transcodificación, "A" podría representar un descodificador de hardware y "B" podría representar un codificador de hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-152">For example, in a transcoding scenario, "A" might represent a hardware decoder and "B" might represent a hardware encoder.</span></span> <span data-ttu-id="9df8f-153">El flujo de datos entre "A" y "B" se produce en el hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-153">The data flow between "A" and "B" occurs within the hardware.</span></span> <span data-ttu-id="9df8f-154">La MFT con la etiqueta "C" es un MFT de software.</span><span class="sxs-lookup"><span data-stu-id="9df8f-154">The MFT labeled "C" is a software MFT.</span></span> <span data-ttu-id="9df8f-155">El flujo de datos de "B" a "C" utiliza la memoria del sistema.</span><span class="sxs-lookup"><span data-stu-id="9df8f-155">Data flow from "B" to "C" uses system memory.</span></span>

![diagrama que muestra cuadros con la etiqueta a a c y un códec de hardware: a apunta a b y el códec, el códec apunta a b y b apunta a c](images/proxy-mft.png)

<span data-ttu-id="9df8f-157">Para establecer una conexión de hardware, los dos MFTs de hardware deben usar un canal de comunicación privado.</span><span class="sxs-lookup"><span data-stu-id="9df8f-157">To establish a hardware connection, the two hardware MFTs must use a private communication channel.</span></span> <span data-ttu-id="9df8f-158">Esta conexión se establece durante la negociación del formato, antes de que se establezcan los tipos de medios y antes de la primera llamada a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="9df8f-158">This connection is established during format negotiation, before the media types are set and before the first call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span> <span data-ttu-id="9df8f-159">El proceso de conexión funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="9df8f-159">The connection process works as follows:</span></span>

1.  <span data-ttu-id="9df8f-160">El cargador de topología comprueba MFTs para comprobar la presencia del atributo [de \_ \_ atributo de \_ dirección \_ URL de hardware enum de MFT](mft-enum-hardware-url-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-160">The topology loader checks both MFTs for the presence of the [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) attribute.</span></span> <span data-ttu-id="9df8f-161">Tenga en cuenta que no examina el valor de este atributo.</span><span class="sxs-lookup"><span data-stu-id="9df8f-161">Note that it does not examine the value of this attribute.</span></span>
2.  <span data-ttu-id="9df8f-162">Si [el \_ \_ atributo de \_ dirección \_ URL de hardware de enumeración de MFT](mft-enum-hardware-url-attribute.md) está presente en ambos MFTs, el cargador de topología hace lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="9df8f-162">If [MFT\_ENUM\_HARDWARE\_URL\_Attribute](mft-enum-hardware-url-attribute.md) is present on both MFTs, the topology loader does the following:</span></span>
    1.  <span data-ttu-id="9df8f-163">El cargador de topología llama a [**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) en el MFT ascendente (a).</span><span class="sxs-lookup"><span data-stu-id="9df8f-163">The topology loader calls [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes) on the upstream MFT (A).</span></span> <span data-ttu-id="9df8f-164">Este método devuelve un puntero [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-164">This method returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="9df8f-165">Permita que este puntero se dediga *pUpstream*.</span><span class="sxs-lookup"><span data-stu-id="9df8f-165">Let this pointer be denoted *pUpstream*.</span></span>
    2.  <span data-ttu-id="9df8f-166">El cargador de topología llama a [**IMFTransform:: GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) en la MFT de nivel inferior (B).</span><span class="sxs-lookup"><span data-stu-id="9df8f-166">The topology loader calls [**IMFTransform::GetInputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes) on the downstream MFT (B).</span></span> <span data-ttu-id="9df8f-167">Esta llamada también devuelve un puntero [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-167">This call also returns an [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer.</span></span> <span data-ttu-id="9df8f-168">Permita que este puntero se dediga *pDownstream*.</span><span class="sxs-lookup"><span data-stu-id="9df8f-168">Let this pointer be denoted *pDownstream*.</span></span>
    3.  <span data-ttu-id="9df8f-169">El cargador de topología establece el atributo de [ \_ \_ \_ atributo Stream conectado de MFT](mft-connected-stream-attribute.md) en *pDownstream* mediante una llamada a [**IMFAttributes:: setunknown (**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span><span class="sxs-lookup"><span data-stu-id="9df8f-169">The topology loader sets the [MFT\_CONNECTED\_STREAM\_ATTRIBUTE](mft-connected-stream-attribute.md) attribute on *pDownstream* by calling [**IMFAttributes::SetUnknown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfattributes-setunknown).</span></span> <span data-ttu-id="9df8f-170">El valor del atributo es el puntero *pUpstream* .</span><span class="sxs-lookup"><span data-stu-id="9df8f-170">The value of the attribute is the *pUpstream* pointer.</span></span>
    4.  <span data-ttu-id="9df8f-171">El cargador de topología establece el [atributo MFT \_ conectado \_ a \_ HW \_ Stream](mft-connected-to-hw-stream.md) en **true** en *pDownstream* y *pUpstream*.</span><span class="sxs-lookup"><span data-stu-id="9df8f-171">The topology loader sets the [MFT\_CONNECTED\_TO\_HW\_STREAM](mft-connected-to-hw-stream.md) attribute to **TRUE** on both *pDownstream* and *pUpstream*.</span></span>
3.  <span data-ttu-id="9df8f-172">En este punto, la MFT de bajada tiene un puntero al almacén de atributos de la MFT ascendente, tal como se muestra en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="9df8f-172">At this point, the downstream MFT has a pointer to the upstream MFT's attribute store, as shown in the following diagram.</span></span>

    ![diagrama con cada MFTs que apunta a su flujo, cada secuencia que apunta a su almacén y el almacén de entrada con una línea discontinua en el almacén de salida](images/proxy-mft2.png)

    > [!Note]  
    > <span data-ttu-id="9df8f-174">Para mayor claridad, este diagrama muestra los flujos y los almacenes de atributos como objetos distintos, pero esto no es necesario para la implementación.</span><span class="sxs-lookup"><span data-stu-id="9df8f-174">For clarity, this diagram shows the streams and the attribute stores as distinct objects, but that is not required for the implementation.</span></span>

     

4.  <span data-ttu-id="9df8f-175">La MFT de nivel inferior usa el puntero [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) para establecer un canal de comunicación privado con el MFT ascendente.</span><span class="sxs-lookup"><span data-stu-id="9df8f-175">The downstream MFT uses the [**IMFAttributes**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes) pointer to establish a private communication channel with the upstream MFT.</span></span> <span data-ttu-id="9df8f-176">Dado que el canal es privado, la implementación define el mecanismo exacto.</span><span class="sxs-lookup"><span data-stu-id="9df8f-176">Because the channel is private, the exact mechanism is defined by the implementation.</span></span> <span data-ttu-id="9df8f-177">Por ejemplo, MFT podría consultar una interfaz COM privada.</span><span class="sxs-lookup"><span data-stu-id="9df8f-177">For example, the MFT might query for a private COM interface.</span></span>

<span data-ttu-id="9df8f-178">Durante el paso 4, la MFT de bajada debe comprobar si los dos MFTs comparten el mismo dispositivo físico.</span><span class="sxs-lookup"><span data-stu-id="9df8f-178">During step 4, the downstream MFT must verify whether the two MFTs share the same physical device.</span></span> <span data-ttu-id="9df8f-179">Si no es así, deben revertirse al uso de la memoria del sistema para el transporte de datos.</span><span class="sxs-lookup"><span data-stu-id="9df8f-179">If not, they must fall back to using system memory for data transport.</span></span> <span data-ttu-id="9df8f-180">Esto permite que la MFT funcione correctamente con el software MFTs y otros dispositivos de hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-180">This enables the MFT to operate correctly with software MFTs and other hardware devices.</span></span>

<span data-ttu-id="9df8f-181">Si el protocolo de enlace se realiza correctamente y los dos MFTs comparten un canal de datos privado, no usan el modelo de procesamiento de datos estándar (descrito en la sección siguiente) en el punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="9df8f-181">If the handshake succeeds and the two MFTs share a private data channel, they do not use the standard data processing model (described in the next section) at the connection point.</span></span> <span data-ttu-id="9df8f-182">En concreto, la MFT de nivel inferior no envía eventos [METransformNeedInput](metransformneedinput.md) ; para obtener más información, consulte la sección siguiente de este tema.</span><span class="sxs-lookup"><span data-stu-id="9df8f-182">Specifically, the downstream MFT does not send [METransformNeedInput](metransformneedinput.md) events; for more details, refer to the next section in this topic.</span></span>

## <a name="data-processing"></a><span data-ttu-id="9df8f-183">Procesamiento de datos</span><span class="sxs-lookup"><span data-stu-id="9df8f-183">Data Processing</span></span>

<span data-ttu-id="9df8f-184">Cuando un MFT de hardware utiliza la memoria del sistema para el transporte de datos, el proceso funciona de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="9df8f-184">When a hardware MFT uses system memory for data transport, the process works as follows:</span></span>

1.  <span data-ttu-id="9df8f-185">Para solicitar más entradas, el MFT envía un evento [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-185">To request more input, the MFT sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>
2.  <span data-ttu-id="9df8f-186">El evento [METransformNeedInput](metransformneedinput.md) hace que la canalización llame a [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="9df8f-186">The [METransformNeedInput](metransformneedinput.md) event causes the pipeline to call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>
3.  <span data-ttu-id="9df8f-187">Cuando el MFT tiene datos de salida, el MFT envía un evento [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-187">When the MFT has output data, the MFT sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
4.  <span data-ttu-id="9df8f-188">El evento [METransformHaveOutput](metransformhaveoutput.md) hace que la canalización llame a [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="9df8f-188">The [METransformHaveOutput](metransformhaveoutput.md) event causes the pipeline to call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="9df8f-189">Para obtener más información, consulte [MFTs asincrónico](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="9df8f-189">For details, refer to [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

<span data-ttu-id="9df8f-190">Sin embargo, si la MFT usa un canal de hardware, no envía estos eventos en el punto de conexión de hardware, ya que toda la transferencia de datos se realiza internamente en el hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-190">If the MFT uses a hardware channel, however, it does not send these events at the hardware connection point, because all data transfer happens internally within the hardware.</span></span> <span data-ttu-id="9df8f-191">Por lo tanto, la canalización no llama a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) o [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) en el punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="9df8f-191">Therefore, the pipeline does not call [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) or [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at the connection point.</span></span>

<span data-ttu-id="9df8f-192">Por ejemplo, considere el primer diagrama de este tema.</span><span class="sxs-lookup"><span data-stu-id="9df8f-192">For example, consider the first diagram in this topic.</span></span> <span data-ttu-id="9df8f-193">Dada esta configuración, el procesamiento de datos tendría lugar de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="9df8f-193">Given this configuration, data processing would occur as follows:</span></span>

1.  <span data-ttu-id="9df8f-194">"A" envía [METransformNeedInput](metransformneedinput.md) para solicitar datos.</span><span class="sxs-lookup"><span data-stu-id="9df8f-194">"A" sends [METransformNeedInput](metransformneedinput.md) to request data.</span></span>
2.  <span data-ttu-id="9df8f-195">La canalización llama a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) en "a".</span><span class="sxs-lookup"><span data-stu-id="9df8f-195">The pipeline calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on "A".</span></span>
3.  <span data-ttu-id="9df8f-196">"A" y "B" procesan los datos en el hardware.</span><span class="sxs-lookup"><span data-stu-id="9df8f-196">"A" and "B" process the data in hardware.</span></span>
4.  <span data-ttu-id="9df8f-197">Una vez completado el procesamiento, "B" envía un evento [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-197">When the processing is complete, "B" sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
5.  <span data-ttu-id="9df8f-198">La canalización llama a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) en "B".</span><span class="sxs-lookup"><span data-stu-id="9df8f-198">The pipeline calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) on "B".</span></span>

## <a name="paired-decoderencoder"></a><span data-ttu-id="9df8f-199">Descodificador/codificador emparejados</span><span class="sxs-lookup"><span data-stu-id="9df8f-199">Paired Decoder/Encoder</span></span>

<span data-ttu-id="9df8f-200">Si un descodificador y un codificador se encuentran en el mismo chip de hardware, puede ser preferible utilizarlos juntos al transcodificar.</span><span class="sxs-lookup"><span data-stu-id="9df8f-200">If a decoder and encoder are located on the same hardware chip, it may be preferable to use them together when transcoding.</span></span> <span data-ttu-id="9df8f-201">Es decir, la selección de una debe hacer que la otra se seleccione en la canalización de transcodificación.</span><span class="sxs-lookup"><span data-stu-id="9df8f-201">That is, selecting one should cause the other to be selected in the transcoding pipeline.</span></span> <span data-ttu-id="9df8f-202">Para asegurarse de que se eligen los códecs de hardware coincidentes, ambos códecs MFTs deben ofrecer un tipo de medio personalizado.</span><span class="sxs-lookup"><span data-stu-id="9df8f-202">To ensure that matching hardware codecs are chosen, both codec MFTs should offer a custom media type.</span></span> <span data-ttu-id="9df8f-203">Para crear un tipo de medio personalizado:</span><span class="sxs-lookup"><span data-stu-id="9df8f-203">To create a custom media type:</span></span>

-   <span data-ttu-id="9df8f-204">Establezca el atributo de [**\_ \_ \_ tipo principal MF MT**](mf-mt-major-type-attribute.md) en **MFMediaType \_ audio** o **MFMediaType \_ video**, según corresponda.</span><span class="sxs-lookup"><span data-stu-id="9df8f-204">Set the [**MF\_MT\_MAJOR\_TYPE**](mf-mt-major-type-attribute.md) attribute to **MFMediaType\_Audio** or **MFMediaType\_Video**, as appropriate.</span></span>
-   <span data-ttu-id="9df8f-205">Establezca el atributo de [**\_ \_ subtipo MF MT**](mf-mt-subtype-attribute.md) en un valor GUID personalizado.</span><span class="sxs-lookup"><span data-stu-id="9df8f-205">Set the [**MF\_MT\_SUBTYPE**](mf-mt-subtype-attribute.md) attribute to a custom GUID value.</span></span>

<span data-ttu-id="9df8f-206">Otros atributos de tipo son opcionales.</span><span class="sxs-lookup"><span data-stu-id="9df8f-206">Other type attributes are optional.</span></span> <span data-ttu-id="9df8f-207">El descodificador devuelve el tipo personalizado de su [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype)y el codificador devuelve el tipo personalizado de su método [**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) .</span><span class="sxs-lookup"><span data-stu-id="9df8f-207">The decoder returns the custom type from its [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype), and the encoder returns the custom type from its [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) method.</span></span> <span data-ttu-id="9df8f-208">En ambos casos, el tipo personalizado debe ser la primera entrada de la lista (*dwTypeIndex* = 0).</span><span class="sxs-lookup"><span data-stu-id="9df8f-208">In both cases, the custom type must be the first entry in the list (*dwTypeIndex* = 0).</span></span>

<span data-ttu-id="9df8f-209">Para trabajar con los códecs de software, el códec también debe devolver al menos un formato estándar, como NV12 para vídeo.</span><span class="sxs-lookup"><span data-stu-id="9df8f-209">To work with software codecs, the codec should also return at least one standard format, such as NV12 for video.</span></span> <span data-ttu-id="9df8f-210">Los formatos estándar deben aparecer después del tipo personalizado (*dwTypeIndex* > 0).</span><span class="sxs-lookup"><span data-stu-id="9df8f-210">Standard formats should appear after the custom type (*dwTypeIndex* > 0).</span></span> <span data-ttu-id="9df8f-211">Si los dos códecs siempre deben estar emparejados y no pueden interoperar con los códecs de software, el MFTs debe devolver solo el formato personalizado y no devolver ningún formato estándar.</span><span class="sxs-lookup"><span data-stu-id="9df8f-211">If the two codecs must always be paired and cannot interoperate with software codecs, the MFTs should return only the custom format and not return any standard formats.</span></span>

> [!Note]  
> <span data-ttu-id="9df8f-212">Si un descodificador no devuelve ningún formato estándar, no se puede usar para la reproducción con el [representador de vídeo mejorado](enhanced-video-renderer.md).</span><span class="sxs-lookup"><span data-stu-id="9df8f-212">If a decoder does not return any standard formats, it cannot be used for playback with the [Enhanced Video Renderer](enhanced-video-renderer.md).</span></span> <span data-ttu-id="9df8f-213">En ese caso, se debe registrar como un descodificador de solo transcodificación.</span><span class="sxs-lookup"><span data-stu-id="9df8f-213">In that case, it should be registered as a transcode-only decoder.</span></span> <span data-ttu-id="9df8f-214">Vea [descodificadores de solo transcodificación](implementing-a-codec-mft.md).</span><span class="sxs-lookup"><span data-stu-id="9df8f-214">See [Transcode-Only Decoders](implementing-a-codec-mft.md).</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="9df8f-215">Temas relacionados</span><span class="sxs-lookup"><span data-stu-id="9df8f-215">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9df8f-216">Escribir una MFT personalizada</span><span class="sxs-lookup"><span data-stu-id="9df8f-216">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> <dt>

[<span data-ttu-id="9df8f-217">Implementar un MFT de códec</span><span class="sxs-lookup"><span data-stu-id="9df8f-217">Implementing a Codec MFT</span></span>](implementing-a-codec-mft.md)
</dt> <dt>

[<span data-ttu-id="9df8f-218">Media Foundation transformaciones</span><span class="sxs-lookup"><span data-stu-id="9df8f-218">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 




