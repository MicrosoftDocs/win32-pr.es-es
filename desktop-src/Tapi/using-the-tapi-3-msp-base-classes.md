---
description: En el procedimiento siguiente se describe cómo implementar un MSP mediante la versión 2,1 de ATL o la versión 3,0 de ATL y las clases base de MSP.
ms.assetid: 7485c34a-3c8a-412f-9cb9-8eb895084292
title: Uso de las clases base de TAPI 3 MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eb8ad4fd160cf0fc4c7dd682a44f3a4ff0bcec25
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "105688586"
---
# <a name="using-the-tapi-3-msp-base-classes"></a><span data-ttu-id="d8c78-103">Uso de las clases base de TAPI 3 MSP</span><span class="sxs-lookup"><span data-stu-id="d8c78-103">Using The TAPI 3 MSP Base Classes</span></span>

<span data-ttu-id="d8c78-104">En el procedimiento siguiente se describe cómo implementar un MSP mediante la versión 2,1 de ATL o la versión 3,0 de ATL y las clases base de MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-104">The following procedure describes how to implement an MSP using ATL version 2.1 or ATL version 3.0 and the MSP base classes.</span></span> <span data-ttu-id="d8c78-105">Para obtener más información y una lista de bibliotecas y encabezados, consulte [las clases base de TAPI 3 MSP](tapi-3-msp-base-classes.md).</span><span class="sxs-lookup"><span data-stu-id="d8c78-105">For more information and a list of libraries and headers, see [TAPI 3 MSP Base Classes](tapi-3-msp-base-classes.md).</span></span> <span data-ttu-id="d8c78-106">En el contenido de este tema se supone que el desarrollador está familiarizado con ATL y COM, y que tiene experiencia en la implementación de archivos DLL COM mediante ATL.</span><span class="sxs-lookup"><span data-stu-id="d8c78-106">The content contained in this topic assumes that the developer has a working understanding of ATL and COM, and has experience implementing COM DLLs using ATL.</span></span>

<span data-ttu-id="d8c78-107">**Para implementar y MSP con ATL 2,1 o ATL 3,0**</span><span class="sxs-lookup"><span data-stu-id="d8c78-107">**To implement and MSP using ATL 2.1 or ATL 3.0**</span></span>

1.  <span data-ttu-id="d8c78-108">Cree un archivo IDL para su MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-108">Create an IDL file for your MSP.</span></span> <span data-ttu-id="d8c78-109">Este archivo define un CLSID para su MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-109">This file defines a CLSID for your MSP.</span></span> <span data-ttu-id="d8c78-110">Declare la "coclase" de MSP como implementación de la interfaz [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) y declare esta interfaz como la interfaz predeterminada en el objeto de clase.</span><span class="sxs-lookup"><span data-stu-id="d8c78-110">Declare your MSP "coclass" as implementing the [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) interface, and declare this interface as the default interface on your class object.</span></span> <span data-ttu-id="d8c78-111">Para la definición de **ITMSPAddress**, importe el archivo "MSP. idl".</span><span class="sxs-lookup"><span data-stu-id="d8c78-111">For the definition of **ITMSPAddress**, import the file "msp.idl".</span></span> <span data-ttu-id="d8c78-112">Incluya su "coclass" de MSP en una biblioteca de tipos para su MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-112">Include your MSP "coclass" in a type library for your MSP.</span></span> <span data-ttu-id="d8c78-113">Si su MSP es compatible con interfaces privadas (personalizadas), defina aquí y inclúyalo en la biblioteca de tipos.</span><span class="sxs-lookup"><span data-stu-id="d8c78-113">If your MSP supports private (custom) interfaces, define them here and include them in your type library.</span></span> <span data-ttu-id="d8c78-114">El siguiente ejemplo de código es un archivo IDL tal y como se ha descrito anteriormente, sin interfaces personalizadas.</span><span class="sxs-lookup"><span data-stu-id="d8c78-114">The following code example is an IDL file as described above, without custom interfaces.</span></span>

    ``` syntax
    import "msp.idl";
    [
          uuid(4DDB6D35-3BC1-11d2-86F2-006008B0E5D2),
          version(2.0),
          helpstring("Wave MSP 2.0 Type Library")
    ]
    library WAVEMSPLib
    {
    importlib("stdole32.tlb");
    importlib("stdole2.tlb");

    [
    uuid(4DDB6D36-3BC1-11d2-86F2-006008B0E5D2),
    helpstring("Wave MSP Class")
    ]
    coclass WaveMSP
    {
    [default] interface ITMSPAddress;
    };
    };
    ```

2.  <span data-ttu-id="d8c78-115">Modifique su TSP para anunciar el CLSID de su MSP cuando Tapi3.dll lo solicite.</span><span class="sxs-lookup"><span data-stu-id="d8c78-115">Modify your TSP to advertise the CLSID of your MSP when Tapi3.dll requests it.</span></span> <span data-ttu-id="d8c78-116">Asegúrese de que (1) el TSP puede negociar TAPI \_ VERSION3 \_ 0 o superior en la función TSPI [**TSPI \_ lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) la estructura de TSP [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) tiene la marca LINEDEVCAPFLAGS \_ MSP establecida en el miembro **DWDEVCAPFLAGS** y (3) el TSP devuelve el CLSID de MSP en la función TSPI TSPI [**\_ lineMSPIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify).</span><span class="sxs-lookup"><span data-stu-id="d8c78-116">Ensure that (1) your TSP can negotiate TAPI\_VERSION3\_0 or higher in the TSPI function [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) your TSP [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) structure has the LINEDEVCAPFLAGS\_MSP flag set in the **dwDevCapFlags** member, and (3) your TSP returns your MSP CLSID in the TSPI function [**TSPI\_lineMSPIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify).</span></span> <span data-ttu-id="d8c78-117">Debe ser el mismo CLSID especificado en el archivo IDL; por ejemplo, la segunda línea "UUID" en el archivo IDL de ejemplo del paso anterior.</span><span class="sxs-lookup"><span data-stu-id="d8c78-117">This should be the same CLSID specified in your IDL file; for example, the second "uuid" line in the example IDL file in the previous step.</span></span>
3.  <span data-ttu-id="d8c78-118">Compile la aplicación de ejemplo MSPBase, que se encuentra en el kit de desarrollo de software (SDK) de la plataforma, para crear la biblioteca MSPBaseSample. lib.</span><span class="sxs-lookup"><span data-stu-id="d8c78-118">Compile the MSPBase sample application, located in the Platform Software Development Kit (SDK), to create the MSPBaseSample.lib library.</span></span>
4.  <span data-ttu-id="d8c78-119">Vincule el archivo DLL de MSP con la biblioteca MSPBaseSample. lib.</span><span class="sxs-lookup"><span data-stu-id="d8c78-119">Link your MSP DLL with the MSPBaseSample.lib library.</span></span>
5.  <span data-ttu-id="d8c78-120">Incluya Mspbase. h desde las definiciones de clase base de SDK para MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-120">Include Mspbase.h from the SDK for MSP base class definitions.</span></span>
6.  <span data-ttu-id="d8c78-121">Implemente las exportaciones de DLL (por ejemplo, DllMain).</span><span class="sxs-lookup"><span data-stu-id="d8c78-121">Implement your DLL exports (for example, DllMain).</span></span> <span data-ttu-id="d8c78-122">Microsoft Visual C++ los generará automáticamente.</span><span class="sxs-lookup"><span data-stu-id="d8c78-122">Microsoft Visual C++ will generate these for you.</span></span> <span data-ttu-id="d8c78-123">En DllMain, en la Asociación del proceso de DLL \_ \_ y \_ \_ la desasociación de procesos dll, respectivamente, use las macros **MSPLOGREGISTER** y **MSPLOGDEREGISTER** para habilitar las características de registro para el archivo dll.</span><span class="sxs-lookup"><span data-stu-id="d8c78-123">In DllMain, on DLL\_PROCESS\_ATTACH and DLL\_PROCESS\_DETACH, respectively, use the **MSPLOGREGISTER** and **MSPLOGDEREGISTER** macros to enable up logging features for your DLL.</span></span> <span data-ttu-id="d8c78-124">Especifique el nombre de la DLL en la llamada **MSPLOGDEREGISTER** .</span><span class="sxs-lookup"><span data-stu-id="d8c78-124">Specify the name of your DLL in the **MSPLOGDEREGISTER** call.</span></span>
7.  <span data-ttu-id="d8c78-125">Use la macro LOG, definida en Msplog. h, para generar mensajes de seguimiento de la misma manera que las clases base.</span><span class="sxs-lookup"><span data-stu-id="d8c78-125">Use the LOG macro, defined in Msplog.h, to output trace messages in the same fashion as the base classes.</span></span> <span data-ttu-id="d8c78-126">Defina el símbolo de preprocesador MSPLOG para incluir el registro en el archivo DLL; déjelo sin definir para compilar un archivo DLL que no tenga registro.</span><span class="sxs-lookup"><span data-stu-id="d8c78-126">Define the MSPLOG preprocessor symbol to include logging in your DLL; leave it undefined to build a DLL that does not have logging.</span></span>
8.  <span data-ttu-id="d8c78-127">Derive una clase de CMSPAddress que implemente direcciones para el MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-127">Derive a class from CMSPAddress that implements addresses for your MSP.</span></span> <span data-ttu-id="d8c78-128">Declare un mapa de objetos ATL global que indique a ATL que cree una instancia de la clase de dirección cuando se le pida que **cocree** el CLSID que especificó en el archivo IDL.</span><span class="sxs-lookup"><span data-stu-id="d8c78-128">Declare a global ATL object map which instructs ATL to create an instance of your address class when asked to **CoCreate** on the CLSID you specified in your IDL file.</span></span> <span data-ttu-id="d8c78-129">Además, derive la clase address de la plantilla de ATL **CComCoClass** e incluya una declaración declare \_ Registry \_ RESOURCEID en la clase Address.</span><span class="sxs-lookup"><span data-stu-id="d8c78-129">Also, derive your address class from the ATL **CComCoClass** template, and include a DECLARE\_REGISTRY\_RESOURCEID declaration in your address class.</span></span> <span data-ttu-id="d8c78-130">Construya un script de recursos y un archivo de encabezado correspondientes, como para cualquier otro archivo DLL COM de ATL.</span><span class="sxs-lookup"><span data-stu-id="d8c78-130">Construct a corresponding resource script and header file, as for any other ATL COM DLL.</span></span>
9.  <span data-ttu-id="d8c78-131">Implemente las invalidaciones de CMSPAddress necesarias para la clase Address.</span><span class="sxs-lookup"><span data-stu-id="d8c78-131">Implement the required CMSPAddress overrides for your address class.</span></span> <span data-ttu-id="d8c78-132">Para [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) y [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), llame a las plantillas de función auxiliares proporcionadas.</span><span class="sxs-lookup"><span data-stu-id="d8c78-132">For [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) and [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), call the provided helper function templates.</span></span> <span data-ttu-id="d8c78-133">En el caso de [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), solo tiene que devolver un mapa de bits **DWORD** con todos los TAPIMEDIAMODES ORed compatibles con MSP juntos.</span><span class="sxs-lookup"><span data-stu-id="d8c78-133">For [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), simply return a **DWORD** bitmap with all of your MSP-supported TAPIMEDIAMODEs ORed together.</span></span> <span data-ttu-id="d8c78-134">Para [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) y [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), devuelva e \_ NOTIMPL y compile y vincule su MSP en este momento.</span><span class="sxs-lookup"><span data-stu-id="d8c78-134">For [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), return E\_NOTIMPL and compile and link your MSP at this point.</span></span> <span data-ttu-id="d8c78-135">Ahora, compruebe que puede registrar y crear instancias de MSP desde las aplicaciones TAPI 3, pero no crear llamadas correctamente.</span><span class="sxs-lookup"><span data-stu-id="d8c78-135">Now, verify that you can register and instantiate your MSP from TAPI 3 applications, but not successfully create calls.</span></span>
10. <span data-ttu-id="d8c78-136">Derive una clase de CMSPCallMultiGraph para implementar los objetos de llamada MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-136">Derive a class from CMSPCallMultiGraph to implement your MSP call objects.</span></span> <span data-ttu-id="d8c78-137">Puede que desee derivar de [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) en lugar de [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) si el modelo Filter-Graph-per-Stream no se ajusta a sus requisitos; Esto aumentará la complejidad de la tarea (en la redacción de este documento, todos los MSP derivan objetos de llamada directamente de **CMSPCallMultiGraph**).</span><span class="sxs-lookup"><span data-stu-id="d8c78-137">You may want to derive from [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) instead of [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) if the filter-graph-per-stream model does not fit your requirements; this will increase the complexity of the task (as of this writing, all MSPs derive call objects directly from **CMSPCallMultiGraph**).</span></span> <span data-ttu-id="d8c78-138">En el objeto address, implemente [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) y [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) para crear y cerrar el tipo específico de objeto de llamada mediante las plantillas de función auxiliares proporcionadas.</span><span class="sxs-lookup"><span data-stu-id="d8c78-138">In your address object, implement [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) to create and shut down your specific type of call object using the provided helper function templates.</span></span> <span data-ttu-id="d8c78-139">En el objeto de llamada, invalide [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) para devolver E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="d8c78-139">In your call object, override [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to return E\_NOTIMPL.</span></span> <span data-ttu-id="d8c78-140">Invalide [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) y [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) de forma idéntica a los métodos de dirección correspondientes.</span><span class="sxs-lookup"><span data-stu-id="d8c78-140">Override [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) and [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) in a manner identical to the corresponding address methods.</span></span> <span data-ttu-id="d8c78-141">Una vez más, debería poder compilar y vincular el MSP; ahora debería poder crear y cerrar llamadas, pero las llamadas no realizarán ningún flujo útil.</span><span class="sxs-lookup"><span data-stu-id="d8c78-141">Again, you should be able to compile and link your MSP; it should now be able to create and shut down calls, but the calls will not do any useful streaming.</span></span>
11. <span data-ttu-id="d8c78-142">Derive una clase de CMSPStream para implementar los objetos de secuencia MSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-142">Derive a class from CMSPStream to implement your MSP stream objects.</span></span> <span data-ttu-id="d8c78-143">En el objeto de llamada, implemente [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) para crear e inicializar el objeto de secuencia (normalmente mediante una llamada a la función **CreateInstance** de ATL seguida por el **\_ InternalQueryInterface** de ATL para [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) seguido de una llamada a **init** en el objeto de secuencia).</span><span class="sxs-lookup"><span data-stu-id="d8c78-143">In your call object, implement [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to create and initialize your stream object (typically by calling the ATL **CreateInstance** followed by the ATL **\_InternalQueryInterface** for [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) followed by calling **Init** on your stream object).</span></span> <span data-ttu-id="d8c78-144">Para admitir un número fijo de flujos (esto es común para los MSP que no admiten la modificación de configuraciones de secuencia por otros puntos de conexión en la llamada), invalide **init**, [**CreateStream (**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream)y [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) en el objeto de llamada.</span><span class="sxs-lookup"><span data-stu-id="d8c78-144">To support a fixed number of streams (this is common for MSPs which do not support modification of stream configurations by other endpoints on the call), override **Init**, [**CreateStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream), and [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) on your call object.</span></span> <span data-ttu-id="d8c78-145">(La llamada **init** crea todas las secuencias inicialmente y **CreateStream (** y **RemoveStream** devuelven los códigos de error de TAPI adecuados para evitar que la aplicación cree o quite secuencias).</span><span class="sxs-lookup"><span data-stu-id="d8c78-145">(The call **Init** creates all of your streams initially, and **CreateStream** and **RemoveStream** return the appropriate TAPI error codes to prevent the application from creating or removing streams).</span></span> <span data-ttu-id="d8c78-146">De lo contrario, invalide el método **init** de la llamada para crear una configuración inicial predeterminada de secuencias mediante los tipos de medios solicitados para la llamada.</span><span class="sxs-lookup"><span data-stu-id="d8c78-146">Otherwise, override the call's **Init** method to create some initial default configuration of streams using the media types requested for the call.</span></span> <span data-ttu-id="d8c78-147">Al crear cualquier objeto de secuencia predeterminado en el método **init** de la llamada, use el método auxiliar [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) .</span><span class="sxs-lookup"><span data-stu-id="d8c78-147">When creating any default stream objects in your call's **Init** method, use the [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) helper method.</span></span>
12. <span data-ttu-id="d8c78-148">Implemente el objeto de secuencia.</span><span class="sxs-lookup"><span data-stu-id="d8c78-148">Implement your stream object.</span></span> <span data-ttu-id="d8c78-149">La única invalidación necesaria es el método [**Get \_ Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) , que simplemente devuelve un nombre descriptivo para la secuencia.</span><span class="sxs-lookup"><span data-stu-id="d8c78-149">The only required override is the [**get\_Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) method, which simply returns a friendly name for the stream.</span></span> <span data-ttu-id="d8c78-150">Además, tendrá que reemplazar otros métodos.</span><span class="sxs-lookup"><span data-stu-id="d8c78-150">In addition, you will need to override several other methods.</span></span> <span data-ttu-id="d8c78-151">El hecho de que los métodos que se van a invalidar dependan de la implementación y de la decisión de realizar las distintas tareas implicadas en la creación y deconstrucción del gráfico de filtros.</span><span class="sxs-lookup"><span data-stu-id="d8c78-151">Exactly which methods to override depends on your implementation and when you decide to perform the various tasks involved in constructing and deconstructing your filter graph.</span></span> <span data-ttu-id="d8c78-152">Estas tareas incluyen la creación de los filtros, códecs, etc. de "transporte" adecuados, y su inserción y eliminación de los gráficos de filtros en los momentos adecuados.</span><span class="sxs-lookup"><span data-stu-id="d8c78-152">These tasks include creating the appropriate "transport" filters, codecs, and so on, and inserting them and removing them from the filter graphs at the appropriate times.</span></span> <span data-ttu-id="d8c78-153">También tendrá que usar la interfaz [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) en los objetos de terminal para conectar los terminales seleccionados a las secuencias.</span><span class="sxs-lookup"><span data-stu-id="d8c78-153">You will also have to use the [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) interface on terminal objects to connect the selected terminals to your streams.</span></span> <span data-ttu-id="d8c78-154">Puede que desee invalidar [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) y [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) en el objeto de flujo para limitar las configuraciones de terminal que aceptarán las secuencias; limitar cada flujo a un único terminal simplificará especialmente la construcción de los gráficos de filtros, pero sacrificará la funcionalidad de la aplicación, como la vista previa de vídeo.</span><span class="sxs-lookup"><span data-stu-id="d8c78-154">You may want to override [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) on your stream object to limit the terminal configurations that your streams will accept; limiting each stream to a single terminal will especially simplify construction of your filter graphs, but will sacrifice application functionality such as video preview.</span></span> <span data-ttu-id="d8c78-155">En función de la implementación, colocará el código de la construcción, la desconstrucción y la conexión de terminal en los métodos [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)y [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) , o en sus propios métodos basados en la comunicación de TSP privado.</span><span class="sxs-lookup"><span data-stu-id="d8c78-155">Depending on your implementation, you will place your graph construction, deconstruction, and terminal connection code in the [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, or in your own methods based on private TSP communication.</span></span> <span data-ttu-id="d8c78-156">Tenga en cuenta que una secuencia sin terminales seleccionados debe realizar un seguimiento del estado del gráfico deseado; una llamada a **StartStream** seguida por una llamada a **SelectTerminal** en este tipo de flujo debe dar como resultado un flujo de datos.</span><span class="sxs-lookup"><span data-stu-id="d8c78-156">Be aware that a stream with no terminals selected must track the desired graph state; a **StartStream** call followed by a **SelectTerminal** call on such a stream must result in a data stream.</span></span> <span data-ttu-id="d8c78-157">Invalide la mayoría de estos métodos para asegurarse de que la construcción, la desconstrucción, la conexión y la desconexión correctas se producen en cada caso en función del estado de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="d8c78-157">Override most of these methods to ensure that the correct construction, deconstruction, connection, and disconnection happens in each case depending on the state of the stream.</span></span>
13. <span data-ttu-id="d8c78-158">Implemente la comunicación de TSP.</span><span class="sxs-lookup"><span data-stu-id="d8c78-158">Implement your TSP communication.</span></span> <span data-ttu-id="d8c78-159">Invalide [**CMSPAddress:: ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) y/o [**CMSPCallBase:: ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata)y/o llamando a [**postEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) en el objeto Address o [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) en el objeto Call (desde los objetos Call o Stream).</span><span class="sxs-lookup"><span data-stu-id="d8c78-159">Override [**CMSPAddress::ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) and/or [**CMSPCallBase::ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata), and/or by calling [**PostEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) on your address object, or [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) on your call object (from either your call or stream objects).</span></span>
14. <span data-ttu-id="d8c78-160">Use postEvent en el objeto Address o HandleStreamEvent en el objeto Call (desde los objetos Call o Stream) para enviar eventos multimedia de llamada a la aplicación a través de Tapi3.dll.</span><span class="sxs-lookup"><span data-stu-id="d8c78-160">Use PostEvent on your address object, or HandleStreamEvent on your call object (from either your call or stream objects) to send call media events to the application via Tapi3.dll.</span></span> <span data-ttu-id="d8c78-161">Normalmente lo hará en el objeto de flujo, en métodos invalidados, incluidos los métodos [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)y [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) , en función de cómo implemente las secuencias.</span><span class="sxs-lookup"><span data-stu-id="d8c78-161">You will typically do this on your stream object, in overridden methods including the [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, depending on how you implement your streams.</span></span>
15. <span data-ttu-id="d8c78-162">Implemente cualquier interfaz privada o subsecuencias que desee en los objetos existentes (dirección, llamada y secuencia).</span><span class="sxs-lookup"><span data-stu-id="d8c78-162">Implement any desired private interfaces or substreams on your existing objects (address, call, and stream).</span></span> <span data-ttu-id="d8c78-163">Normalmente no hay ninguno.</span><span class="sxs-lookup"><span data-stu-id="d8c78-163">Usually there are none.</span></span> <span data-ttu-id="d8c78-164">Tenga en cuenta que al implementar las interfaces privadas, especifique el LIBId de la biblioteca de tipos desde el archivo IDL.</span><span class="sxs-lookup"><span data-stu-id="d8c78-164">Be aware that when implementing your private interfaces, specify the LIBID of your type library from your IDL file.</span></span> <span data-ttu-id="d8c78-165">Es decir, los programadores de aplicaciones deben usar la biblioteca de tipos MSP al usar las interfaces personalizadas.</span><span class="sxs-lookup"><span data-stu-id="d8c78-165">That is, application programmers must use your MSP type library when using your custom interfaces.</span></span> <span data-ttu-id="d8c78-166">Las interfaces MSP estándar, implementadas en las clases base de MSP, usan el LIBInte Tapi3.dll y, por tanto, son accesibles para todas las aplicaciones TAPI 3.</span><span class="sxs-lookup"><span data-stu-id="d8c78-166">The standard MSP interfaces, implemented in the MSP base classes, use the Tapi3.dll LIBID and are therefore accessible to all TAPI 3 applications.</span></span>
16. <span data-ttu-id="d8c78-167">Si implementa objetos de terminal estáticos o dinámicos específicos de MSP o reemplazos para los terminales estáticos predeterminados (no típicos), puede usar las clases base de terminal proporcionadas.</span><span class="sxs-lookup"><span data-stu-id="d8c78-167">If implementing MSP-specific static or dynamic terminal objects or replacements for the default static terminals (not typical), you can use the provided terminal base classes.</span></span> <span data-ttu-id="d8c78-168">Tendrá que reemplazar varios métodos en el objeto address para proporcionar métodos alternativos o adicionales para crear objetos de terminal.</span><span class="sxs-lookup"><span data-stu-id="d8c78-168">You will have to override various methods on your address object to provide alternative or additional methods of creating terminal objects.</span></span>
17. <span data-ttu-id="d8c78-169">Implemente la interfaz IObjectSafety en la dirección, la llamada, la secuencia y los objetos de terminal.</span><span class="sxs-lookup"><span data-stu-id="d8c78-169">Implement the IObjectSafety interface on your Address, Call, Stream, and Terminal objects.</span></span> <span data-ttu-id="d8c78-170">Para usar el [asignador de envío](dispatch-mapper.md) para consultar interfaces en los objetos MSP, marque los objetos como seguros para el scripting en estas interfaces.</span><span class="sxs-lookup"><span data-stu-id="d8c78-170">To use [Dispatch Mapper](dispatch-mapper.md) to query for interfaces on your MSP objects, mark your objects as safe for scripting on these interfaces.</span></span> <span data-ttu-id="d8c78-171">Para ello, implemente la interfaz **IObjectSafety** en el objeto.</span><span class="sxs-lookup"><span data-stu-id="d8c78-171">To do this, implement the **IObjectSafety** interface on your object.</span></span> <span data-ttu-id="d8c78-172">Si se deriva de **CMSPObjectSafetyImpl** (una clase auxiliar que se proporciona en Msputils. h) y se agrega **IOBJECTSAFETY** al mapa com ATL de la clase \_ , los objetos estarán seguros para el scripting en todas las interfaces que exponen.</span><span class="sxs-lookup"><span data-stu-id="d8c78-172">Deriving from **CMSPObjectSafetyImpl** (a helper class provided in Msputils.h) and adding **IObjectSafety** to your class's ATL COM\_MAP will make your objects safe for scripting on all the interfaces they expose.</span></span> <span data-ttu-id="d8c78-173">Tenga en cuenta que el uso del asignador de envío en objetos MSP podría ser implícito.</span><span class="sxs-lookup"><span data-stu-id="d8c78-173">Be aware that using Dispatch Mapper on MSP objects could be implicit.</span></span> <span data-ttu-id="d8c78-174">La dirección MSP y la llamada MSP se agregan mediante la dirección TAPI y los objetos de llamada TAPI.</span><span class="sxs-lookup"><span data-stu-id="d8c78-174">MSP Address and MSP Call are aggregated by TAPI Address and TAPI Call objects.</span></span> <span data-ttu-id="d8c78-175">Si se usa el asignador de envío en los objetos TAPI para consultar las interfaces expuestas por los objetos MSP agregados, se consultarán los objetos MSP agregados para la seguridad de las interfaces solicitadas.</span><span class="sxs-lookup"><span data-stu-id="d8c78-175">If Dispatch Mapper is used on the TAPI objects to query for the interfaces exposed by the aggregated MSP objects, the aggregated MSP objects will be queried for safety of the requested interfaces.</span></span>

 

 
